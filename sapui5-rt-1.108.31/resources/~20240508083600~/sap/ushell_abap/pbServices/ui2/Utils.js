// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/Log","sap/ushell_abap/pbServices/ui2/Error","sap/ui/Device"],function(e,t,r,n){"use strict";var i=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),r=this,n=function(){},i=function(){return r.apply(this instanceof n?this:e,t.concat(Array.prototype.slice.call(arguments)))};n.prototype=this.prototype;i.prototype=new n;return i}}var s;i.absoluteUrl=function(e,t){t=t||location.href;if(t.indexOf("://")<0&&t.charAt(0)!=="/"){throw new r("Illegal base URL: "+t)}if(!e||e.indexOf("://")>=0||e.charAt(0)==="/"){return i.addCacheBusterTokenUsingUshellConfig(e)}if(t.search(/^([^:]*:)?\/\/[^/]+$/)<0){t=t.replace(/\/[^/]*$/,"")}return i.addCacheBusterTokenUsingUshellConfig(t+"/"+e)};i.callHandler=function(e,r,n){var s;if(n){setTimeout(function(){i.callHandler(e,r,false)},0);return}try{e()}catch(e){s=e.message||e.toString();t.error("Call to success handler failed: "+s,e.stack);if(r){r(s)}}};i.get=function(e,n,o,a,u,c){if(typeof o!=="function"){throw new r("Missing success handler")}if(typeof a!=="function"){throw new r("Missing error handler")}if(n&&c){throw new r("Caching of XML responses not supported")}if(typeof i.addCacheBusterTokenUsingUshellConfig==="function"){e=i.addCacheBusterTokenUsingUshellConfig(e)}u=u||new XMLHttpRequest;u.onreadystatechange=function(){var r,u;if(this.readyState!==4){return}if(this.status!==200){t.error("Error "+this.status+" in response for URL "+e,null);a(e+": "+this.status+" "+this.statusText,this.responseText);return}t.debug("Received response for URL "+e,null);if(n){u=this.responseXML;if(u===null||!u.documentElement){a(e+": no valid XML");return}r=u}else{r=this.responseText;if(c){s.put(e,r)}}i.callHandler(o.bind(null,r),a)};if(!n&&s.containsKey(e)){t.debug("Return cached response for URL "+e,null);i.callHandler(o.bind(null,s.get(e)),a)}else{try{if(u.readyState<XMLHttpRequest.OPENED){u.open("GET",e,true)}else{t.debug("XHR Request was already opened for "+e,null)}u.send();t.debug("Sent request to URL "+e,null)}catch(r){t.error("Error '"+(r.message||r)+"' in request to URL "+e,null);throw r}}};i.addCacheBusterToken=function(e,t,r,n){if(t.test(e)){e=e.replace(t,r);e=e.replace(/\[CacheBusterToken\]/g,n)}return e};i.removeCBAndNormalizeUrl=function(t){var r,n,i,s;if(typeof t!=="string"||t===""||o(t)){return t}function o(t){var r=new e(t),n=r.path();if(r.is("absolute")){return false}if(n&&n.charAt(0)==="/"){return false}return true}r=t.match(/(.*)(\/~[\w-]+~[A-Z0-9]?)(.*)/);if(r){n=r[1];i=r[2];s=r[3]}function a(t){return new e(t).normalizePathname().toString()}function u(t){var r=new e(t).segment(),n,i=0;for(n=0;n<r.length&&i>=0;n+=1){if(r[n]===".."){i=i-1}else{i=i+1}}return i<0}if(i){if(s&&u(s)){t=n+s}}return a(t)};i.addCacheBusterTokenUsingUshellConfig=function(e){var t=window["sap-ushell-config"]&&window["sap-ushell-config"].cacheBusting,r=t&&t.patterns,n=e,s=[],o,a=[];s=i.getParameterMap();o=s["sap-ushell-nocb"]&&s["sap-ushell-nocb"][0];if((o==="true"||o==="X")&&typeof e==="string"){e=e.replace(/\/~[\w-]+~[A-Z0-9]?/,"");return e}if(!t||typeof e!=="string"||e===""||/[/=]~[\w-]+~[A-Z0-9]?[/#?&]/.test(e)||/[/=]~[\w-]+~[A-Z0-9]?$/.test(e)){return e}if(t&&t.urls){if(e.charAt(e.length-1)==="/"){e=e.substr(0,e.length-1)}if(t.urls.hasOwnProperty(e)){return e+"/"+t.urls[e].cacheBusterToken}if(t.urls.hasOwnProperty(e+"/")){return e+"/"+t.urls[e+"/"].cacheBusterToken}}if(!r){return e}Object.keys(r).forEach(function(e){if(r.hasOwnProperty(e)){var t=r[e];t.pattern=new RegExp(e);a.push(t)}});a.sort(function(e,t){return e.order-t.order});a.every(function(r){if(r.pattern.test(e)){if(!r.cacheBusterToken){r.cacheBusterToken=t.cacheBusterToken}n=i.addCacheBusterToken(e,r.pattern,r.replacement,r.cacheBusterToken);return false}return true});return n};i.clearCache=function(){s=new i.Map};i.getFormFactor=function(){if(n.system.desktop){return n.system.SYSTEMTYPE.DESKTOP}if(n.system.tablet){return n.system.SYSTEMTYPE.TABLET}if(n.system.phone){return n.system.SYSTEMTYPE.PHONE}};i.getParameterMap=function(e){var t,n,i={},s,o,a,u,c,l=arguments.length>0?e:location.search;if(l&&l.charAt(0)!=="?"){throw new r("Illegal search string "+l)}if(!l||l==="?"){return{}}u=l.substring(1).replace(/\+/g," ").split(/[&;]/);c=u.length<500?u.length:500;for(t=0,n=c;t<n;t+=1){s=u[t];o="";a=s.indexOf("=");if(a>=0){o=s.slice(a+1);o=decodeURIComponent(o);s=s.slice(0,a)}s=decodeURIComponent(s);if(!Object.prototype.hasOwnProperty.call(i,s)){i[s]=[]}i[s].push(o)}return i};i.getParameterValue=function(e,t){var n,s;if(typeof t!=="string"){throw new r("Missing parameter name")}e=e.split("#")[0];s=e.indexOf("?");if(s>=0){n=i.getParameterMap(e.slice(s));if(n[t]){return n[t][0]}}return""};i.isArray=function(e){return Object.prototype.toString.apply(e)==="[object Array]"};i.isString=function e(t){return/String/.test(Object.prototype.toString.call(t))};i.parseXml=function(e){var t;if(!e||typeof e!=="string"){return null}t=(new DOMParser).parseFromString(e,"text/xml");if(t.getElementsByTagName("parsererror").length){throw new r("Invalid XML: "+e)}return t};i.Map=function(){this.entries={}};i.Map.prototype.put=function(e,t){var r=this.get(e);this.entries[e]=t;return r};i.Map.prototype.containsKey=function(e){if(typeof e!=="string"){throw new r("Not a string key: "+e)}return Object.prototype.hasOwnProperty.call(this.entries,e)};i.Map.prototype.get=function(e){if(this.containsKey(e)){return this.entries[e]}return undefined};i.Map.prototype.keys=function(){return Object.keys(this.entries)};i.Map.prototype.remove=function(e){delete this.entries[e]};i.Map.prototype.toString=function(){var e=["Map("];e.push(JSON.stringify(this.entries));e.push(")");return e.join("")};i.clearCache();return i});
//# sourceMappingURL=Utils.js.map
// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/ODataService","sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ushell_abap/pbServices/ui2/Error"],function(e,n,t,i){"use strict";var a=function(t,r,s,o){var c,g=this;function d(e){return e.replace(/'/g,"''").replace(/&/g,"%26")}function p(e,n,t){var i;if(typeof e==="string"){i=e}else{if(e.instanceId){return"ChipInstanceBags(pageId='"+encodeURIComponent(e.pageId)+"',instanceId='"+encodeURIComponent(e.instanceId)+"',id='"+encodeURIComponent(n)+"')"+(t?"?$expand=ChipInstanceProperties":"")}i=e.id}return"Bags(pageId='"+encodeURIComponent(i)+"',id='"+encodeURIComponent(n)+"')"+(t?"?$expand=Properties":"")}a.extractBatchResponseEntry=function(e){if(e.statusCode==="201"){return e.data}if(e.statusCode==="204"){return undefined}return e.message||""};this.batch=function(n,t,i,r){var s=[];function o(e){var n,t=[];for(n=0;n<e.length;n+=1){t[n]=a.extractBatchResponseEntry(e[n])}return t}i=i||function(){};r=r||g.getDefaultErrorHandler();c.check(i,r);n=n||[];t=t||[];if(n.length>0){s.push({__changeRequests:n})}s=s.concat(t);if(s.length===0){e.callHandler(i.bind(null,[],[]),r,true);return}c.batch({__batchRequests:s},function(t){var a=t.__batchResponses,g=a[0].__changeResponses;if(a[0].response&&a[0].message){c.onError("POST",c.getBaseUrl()+"$batch",r,undefined,t.__batchResponses[0]);return}if(g&&g.length!==n.length||a.length!==s.length){r("Number of requests differs from number of responses in $batch");return}if(g){e.callHandler(i.bind(null,o(g),o(a.slice(1))),r,false)}else{e.callHandler(i.bind(null,[],o(a)),r,false)}},r)};this.isPersonalization=function(){return!!s};this.readMetadata=function(n,t,i){var a=c.getBaseUrl()+"$metadata"+(i?"?"+Date.now():"");t=t||this.getDefaultErrorHandler();c.check(n,t);OData.read(a,function(i){e.callHandler(n.bind(null,i),t)},c.onError.bind(c,"GET",a,t,undefined),OData.metadataHandler)};this.deleteBag=function(e,n,t,a){if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!n){throw new i("Missing bag ID","PageBuildingService")}c.del(p(e,n,false),t,a)};this.readBag=function(e,n,t,a){if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!n){throw new i("Missing bag ID","PageBuildingService")}c.read(p(e,n,true),t,a)};this.readAllCatalogs=function(e,n,t,i,a,r){var s="id";r=r===undefined?true:r;if(a&&typeof a==="string"){s=a}var o="Pages('"+encodeURIComponent(e)+"')/allCatalogs?$expand=Chips/ChipBags/ChipProperties&"+"$orderby="+s;if(i&&typeof i==="string"){o=o+"&$filter="+encodeURIComponent(i)}if(this.readAllCatalogs.cacheBusterTokens&&this.readAllCatalogs.cacheBusterTokens.get(e)){o+="&sap-cache-id="+this.readAllCatalogs.cacheBusterTokens.get(e)}c.read(o,n,t,r)};this.readCatalogs=function(e,n,t){var i="Catalogs?$orderby=id";if(t&&typeof t==="string"){i=i+"&$filter="+encodeURIComponent(t)}c.read(i,e,n)};this.readAllCatalogsForUser=function(e,n,t){var i=e?"?$filter="+encodeURIComponent(e):"";c.read("Pages('unused')/allCatalogs"+i,n,t)};this.getReferencingCatalogIds=function(e,n,t){if(typeof n!=="function"){n=t;t=arguments[3]}function a(t){var i=[],a=t.results||[];a.forEach(function(n){if(n.referenceChipId===e){if(i.indexOf(n.catalogId)===-1){i.push(n.catalogId)}}});n(i)}if(typeof e!=="string"){throw new i("sReferencedChipId must be a string","PageBuildingService")}if(typeof n!=="function"){throw new i("fnSuccess is mandatory","PageBuildingService")}c.read("Chips?$filter="+encodeURIComponent("referenceChipId eq '"+d(e)+"'"),a,function(e){new i(e,"PageBuildingService");t.apply(null,arguments)})};this.createPageBasedCatalog=function(e,n,t,a){if(!e){throw new i("Missing domain ID","PageBuildingService")}c.create("Catalogs",{domainId:e,title:n,type:"CATALOG_PAGE"},t,a)};this.createCatalog=function(e,n,t){c.create("Catalogs",e,n,t)};this.deleteCatalog=function(e,n,t){c.del(e,n,t)};this.cloneCatalog=function(e,n,t,a,r){if(!e){throw new i("Missing source catalog ID","PageBuildingService")}if(!n){throw new i("Missing new domain ID","PageBuildingService")}if(n.indexOf(":")>=0){throw new i("Illegal domain ID: "+n,"PageBuildingService")}c.create("CloneCatalog?sourceId='"+encodeURIComponent(e)+"'&targetId='"+encodeURIComponent(n)+(t!==undefined?"'&title='"+encodeURIComponent(t)+"'":"'"),{},a,r)};this.clonePageChipInstance=function(e,n,t,a,r){if(!e){throw new i("Missing source page ID","PageBuildingService")}if(!n){throw new i("Missing source CHIP instance ID","PageBuildingService")}if(!t){throw new i("Missing target page ID","PageBuildingService")}c.create("ClonePageChipInstance?sourcePageId='"+encodeURIComponent(e)+"'&sourceChipInstanceId='"+encodeURIComponent(n)+"'&targetPageId='"+encodeURIComponent(t)+"'",{},function(e){c.read("PageChipInstances(pageId='"+encodeURIComponent(e.pageId)+"',instanceId='"+encodeURIComponent(e.instanceId)+"')"+"?$expand=ChipInstanceBags/ChipInstanceProperties",a,r)},r)};this.readCatalog=function(e,n,t,a,r){var s;if(!e){throw new i("Missing catalog ID","PageBuildingService")}s="Catalogs('"+encodeURIComponent(e)+"')";if(!a){s+="?$expand=Chips";if(!r){s+="/ChipBags/ChipProperties"}}c.read(s,n,t)};this.updateCatalog=function(e,n,t){c.update(e,n,t)};this.readCatalogChips=function(e,n,t,a){var r,s="",o="?$filter=";if(!e){throw new i("Missing catalog ID","PageBuildingService")}r="Catalogs('"+encodeURIComponent(e)+"')/Chips";if(n){if(!n.length){throw new i("No CHIP IDs given","PageBuildingService")}n.forEach(function(e){s=s+o+"id%20eq%20'"+encodeURIComponent(e)+"'";o="%20or%20"});if(c.getBaseUrl().length+r.length+s.length>2e3){s=""}}c.read(r+s,t,a)};this.createPage=function(e,n,t,a,r,s){if(!e){throw new i("Missing page ID","PageBuildingService")}c.create("Pages",{id:e,catalogId:n,layout:t,title:a},r,s)};this.readPages=function(e,n,t){var i="Pages?";if(!t){i+="$expand=Catalog&"}c.read(i+"$orderby=id",e,n)};this.readPage=function(e,n,t,a){var r="Pages('"+encodeURIComponent(e)+"')";if(!e){throw new i("Missing page ID","PageBuildingService")}if(a===undefined){r+="?$expand=Bags/Properties,PageChipInstances/Chip/ChipBags/ChipProperties,"+"PageChipInstances/RemoteCatalog,"+"PageChipInstances/ChipInstanceBags/ChipInstanceProperties"}else if(a!==""){r+="?$expand="+a}c.read(r,n,t)};this.readPageSet=function(e,n,t,a){var r;var s=this;var o;a=a===undefined?true:a;if(!e){throw new i("Missing page set ID","PageBuildingService")}r="PageSets('"+encodeURIComponent(e)+"')?$expand="+"Pages/PageChipInstances/Chip/ChipBags/ChipProperties,"+"Pages/PageChipInstances/RemoteCatalog,"+"Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"AssignedPages,"+"DefaultPage";if(this.readPageSet.cacheBusterTokens&&this.readPageSet.cacheBusterTokens.get(e)){r+="&sap-cache-id="+this.readPageSet.cacheBusterTokens.get(e)}if(this.readPageSet.appendedParameters){o=Object.keys(this.readPageSet.appendedParameters);if(o.length>0){o.sort();o.forEach(function(e){r+="&"+encodeURIComponent(e)+"="+encodeURIComponent(s.readPageSet.appendedParameters[e])})}}c.read(r,n,t,a)};this.updatePageSet=function(e,n,t){c.update(e,n,t)};this.createPageInPageSet=function(e,n,t,a,r){if(!e){throw new i("Missing page set ID","PageBuildingService")}c.create("PageSets('"+encodeURIComponent(e)+"')/Pages",{catalogId:t||"",layout:"",title:n||""},a,r)};this.updatePage=function(e,n,t){c.update(e,n,t)};this.deletePage=function(e,n,t){if(!e){throw new i("Missing page ID","PageBuildingService")}c.del("Pages('"+encodeURIComponent(e)+"')",n,t)};this.createPageChipInstance=function(e,n,t,i,a,r,s,o){this.createPageChipInstanceFromRawData({pageId:e,instanceId:n,chipId:t,title:i,configuration:a,layoutData:r},s,o)};this.createPageChipInstanceFromRawData=function(e,n,t){if(typeof e!=="object"){throw new i("Invalid raw data","PageBuildingService")}if(!e.pageId){throw new i("Missing page ID","PageBuildingService")}if(!e.chipId){throw new i("Missing CHIP ID","PageBuildingService")}e.instanceId=e.instanceId||"";e.title=e.title||"";e.configuration=e.configuration||"";e.layoutData=e.layoutData||"";c.create("PageChipInstances",e,n,t)};this.updatePageChipInstance=function(e,n,t){c.update(e,n,t)};this.deletePageChipInstance=function(e,n,t,a){if(!e){throw new i("Missing page ID","PageBuildingService")}if(!n){throw new i("Missing instance ID","PageBuildingService")}c.del("PageChipInstances(pageId='"+encodeURIComponent(e)+"',instanceId='"+encodeURIComponent(n)+"')",t,a)};this.updateBagProperties=function(e,n,t,a,r,s,o){var g=[],d=[],p,l,h,u,f="__metadata";function I(e){var n={__metadata:{type:e[f].type,uri:e[f].uri}},t;for(t in e){if(Object.prototype.hasOwnProperty.call(e,t)&&t!==f&&t.indexOf("$")!==0&&typeof e[t]!=="object"){n[t]=e[t]}}return n}if(!e){throw new i("Missing parent object","PageBuildingService")}if(!n){throw new i("Missing bag ID","PageBuildingService")}if(typeof r==="function"){this.updateBagProperties(e,n,t,a,[],r,s);return}t=t||[];a=a||[];r=r||[];if(t.length===0&&a.length===0&&r.length===0){throw new i("No properties to update, create or reset","PageBuildingService")}for(p=0;p<t.length;p+=1){h=t[p];u=h[f].uri;l=u.indexOf(c.getBaseUrl());if(l>=0){u=u.slice(l+c.getBaseUrl().length)}g.push({requestUri:u,method:"PUT",data:I(h)})}u=e.instanceId?"ChipInstanceProperties":"Properties";for(p=0;p<a.length;p+=1){h=a[p];if(!h.name){throw new i("Missing property name","PageBuildingService")}if(e.instanceId){h.instanceId=e.instanceId;h.pageId=e.pageId}else{h.pageId=e.id}h.bagId=n;g.push({requestUri:u,method:"POST",data:h})}for(p=0;p<r.length;p+=1){h=r[p];u=h[f].uri;l=u.indexOf(c.getBaseUrl());if(l>=0){u=u.slice(l+c.getBaseUrl().length)}g.push({requestUri:u,method:"DELETE"});d.push({requestUri:u,method:"GET"})}this.batch(g,d,function(e,n){var i=e.slice(a.length+t.length),r;for(r=0;r<i.length;r+=1){if(i[r]===undefined){if(typeof n[r]==="object"){i[r]=n[r]}}}if(s){s(e.slice(0,t.length),e.slice(t.length,a.length+t.length),i)}},o)};this.createProperty=function(e,n,t,a,r,s,o){var g;if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!n){throw new i("Missing bag ID","PageBuildingService")}if(!t){throw new i("Missing property name","PageBuildingService")}if(typeof r==="function"){this.createProperty(e,n,t,a,undefined,r,s);return}g={bagId:n,name:t,pageId:e,translatable:r,value:a};if(typeof e!=="string"){if(e.instanceId){g.instanceId=e.instanceId;g.pageId=e.pageId}else{g.pageId=e.id}}c.create(g.instanceId?"ChipInstanceProperties":"Properties",g,s,o)};this.updateProperty=function(e,n,t){c.update(e,n,t)};this.deleteProperty=function(e,n,t){c.del(e,n,t)};this.readChip=function(e,n,t){if(!e){throw new i("Missing CHIP ID","PageBuildingService")}var a="Chips('"+encodeURIComponent(e)+"')?$expand=ChipBags/ChipProperties";if(o!==undefined){a=a+"&sap-cache-id="+o}c.read(a,n,t)};if(typeof t==="string"){c=a._createODataWrapper(t,this)}else{c=t}this.readAllCatalogs.cacheBusterTokens=new e.Map;this.readPageSet.cacheBusterTokens=new e.Map;if(!c.isStickySessionEnabled()&&!s){c.enableStickySession()}n.call(this,c,r)};a._createODataWrapper=function(e,n){return new t(e,n,true)};a.createPageBuildingService=function(e,n,t,i){return new a(e,n,t,i)};return a});
//# sourceMappingURL=PageBuildingService.js.map
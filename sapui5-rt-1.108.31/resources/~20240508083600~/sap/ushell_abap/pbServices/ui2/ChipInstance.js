// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],function(e,t,n,i){"use strict";var r=function(r,a,u,s){var c,o,f,l,g,h;var p=new t.Map;var d=false;var I=[];var C=this;var v=Object.assign({},a);function y(){a.referenceChipInstanceId="";a.referencePageId=""}function S(){y();if(s){s.updateScope()}}function P(){if(!c){throw new n(C+": CHIP instance is just a stub","ChipInstance")}}function b(e,n){if(!c){c=u.createApi(C,p)}i.debug("Initialized: "+C,null,"ChipInstance");t.callHandler(e,n)}function m(t){var n,i=u.getBagIds(),s;for(n=0;n<t.length;n+=1){o.put(t[n].id,new e(r,t[n],u.getBag(t[n].id),S))}for(n=0;n<i.length;n+=1){s={pageId:a.pageId,instanceId:a.instanceId,id:i[n],$tmp:true};if(!o.containsKey(s.id)){o.put(s.id,new e(r,s,u.getBag(s.id),S))}}}function w(){if(u.isStub()){throw new n(this+": initializeConfiguration expects that the CHIP is no stub anymore","ChipInstance",false)}if(!f){f={};u.updateConfiguration(f,a.configuration)}}this.persist=function(e,t){r.getPageBuildingService().updatePageChipInstance(a,function(){y();if(s){s.updateScope()}if(e){e()}},t)};this.attachFullscreen=function(e){if(typeof e!=="function"){throw new n(this+": fullscreen event handler is not a function","ChipInstance")}I.push(e)};this.attachRefresh=function(e){if(e&&typeof e!=="function"){throw new n(this+": refresh event handler is not a function","ChipInstance")}l=e};this.attachTitleChange=function(e){h=e};this.detachAll=function(){I=[];l=null};this.exit=function(){i.debug("Exit: "+C,null,"ChipInstance");c=null;o=new t.Map;f=null;g=null;h=null};this.getApi=function(){return c};this.getBagIds=function(){return o.keys()};this.getBag=function(t){var i;if(!t){throw new n("Missing bag ID","ChipInstance")}i=o.get(t);if(i){return i}i=new e(r,{pageId:a.pageId,instanceId:a.instanceId,id:t,$tmp:true},null,S);o.put(t,i);return i};this.getChip=function(){return u};this.getConfiguration=function(){return a.configuration};this.getConfigurationParameter=function(e){w();if(Object.prototype.hasOwnProperty.call(f,e)){return f[e]}return u.getConfigurationParameter(e)};this.getContract=function(e){P();return p.get(e)};this.getFullscreen=function(){return d};this.getId=function(){return a.instanceId};this.getImplementationAsSapui5=function(){i.error("Deprecated API call of 'ChipInstance.getImplementationAsSapui5'. Please use 'getImplementationAsSapui5Async' instead",null,"sap.ushell_abap.pbServices.ui2.ChipInstance");P();return u.getImplementationAsSapui5(c)};this.getImplementationAsSapui5Async=function(){try{P()}catch(e){return Promise.reject(e)}return u.getImplementationAsSapui5Async(c)};this.getLayoutData=function(){return a.layoutData};this.getPage=function(){return s};this.getTitle=function(){return g||a.title||u.getTitle()};this.getUpdated=function(e){function t(){i.error("Parse Error: CHIP instance's updated property has unexpected format","value of updated property: '"+a.updated+"'","ChipInstance")}var n,r;if(a.updated&&!e){n=/\((\d*)\)/.exec(a.updated);if(!n){t();return undefined}r=new Date(parseInt(n[1],10));if(isNaN(r.getTime())){t();return undefined}return r}return a.updated};this.isOutdated=function(){return a.outdated==="X"};this.isReadOnly=function(){P();return a.isReadOnly==="X"};this.isReference=function(){return!!a.referenceChipInstanceId||!!a.referencePageId};this.isBrokenReference=function(){return a.referenceChipInstanceId==="O"||a.referencePageId==="O"};this.getOriginalId=function(){return a.referenceChipInstanceId===""||a.referenceChipInstanceId==="O"?undefined:a.referenceChipInstanceId};this.getOriginalPageId=function(){return a.referencePageId===""||a.referencePageId==="O"?undefined:a.referencePageId};this.isStub=function(){return!c};this.load=function(e,n){var i;n=n||r.getPageBuildingService().getDefaultErrorHandler();i=b.bind(null,e,n);if(u.isStub()){u.load(i,n)}else{t.callHandler(i,n,true)}};this.remove=function(e,t){if(s&&s.removeChipInstance(C,e,t)){return}this.exit();r.getPageBuildingService().deletePageChipInstance(a.pageId,a.instanceId,e,t)};this.refresh=function(){if(l){try{l();return true}catch(e){i.error(C+": call to refresh handler failed: "+(e.message||e.toString()),null,"ChipInstance");return false}}return false};this.setFullscreen=function(e){var t,n;if(d!==e){d=e;for(t=0,n=I.length;t<n;t+=1){I[t]()}}};this.setLayoutData=function(e,n,i){if(a.layoutData===e){if(n){i=i||r.getPageBuildingService().getDefaultErrorHandler();t.callHandler(n,i,true)}return}a.layoutData=e;this.persist(n,i)};this.setTitle=function(e,n,i,u){var s;u=u||r.getPageBuildingService().getDefaultErrorHandler();if(g!==e){g=e;if(h){t.callHandler(h.bind(null,this),u,!n)}}if(n&&a.title!==g){s=a.title;a.title=g;g=undefined;this.persist(i,function(){a.title=s;g=undefined;u.apply(null,arguments)})}else if(i){t.callHandler(i,u,true)}};this.toString=function(e){var t=["ChipInstance({oChip:",u.toString(e),",bFullscreen:",d];if(e){t.push(",oAlterEgo:",JSON.stringify(a),",oApi:",JSON.stringify(c),",oBags:",o.toString(),",oConfiguration:",JSON.stringify(f),",oFactory:",r.toString(e),",aFullscreenHandlers.length:",I.length,',sTitle:"',g,'"')}t.push("})");return t.join("")};this.updateConfiguration=function(e,t,n){w();u.updateConfiguration(f,e);a.configuration=JSON.stringify(f);this.persist(t,n)};this._getConstructorData=function(){return{factory:r,alterEgo:v,chip:u,page:s}};this._getBags=function(){return o};this._setBags=function(e){o=e};o=new t.Map;m(a.ChipInstanceBags&&a.ChipInstanceBags.results||[]);delete a.Chip;i.debug("Created: "+this,null,"ChipInstance")};r.prototype.clone=function(){var e=this._getConstructorData();var t=new r(e.factory,e.alterEgo,e.chip,e.page);return new Promise(function(e,n){t.load(e,n)}).then(function(){t._setBags(this._getBags());return t}.bind(this))};return r});
//# sourceMappingURL=ChipInstance.js.map
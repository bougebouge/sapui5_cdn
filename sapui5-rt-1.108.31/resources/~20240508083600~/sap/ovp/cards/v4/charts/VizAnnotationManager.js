sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/v4/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ovp/helpers/V4/MetadataAnalyzer"],function(jQuery,e,t,a,r,i,n,o,s,l,u,f,c,v,p,g,m,A,d,h,P){"use strict";var E={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"$Type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut",V4_ANNOTATION:"annotations"};var y={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var _=["year","yearweek","yearmonth","yearquarter"];var C=[E.COLUMNSTACKED_CHARTTYPE,E.DONUT_CHARTTYPE,E.COLUMN_CHARTTYPE,E.BAR_CHARTTYPE,E.VERTICALBULLET_CHARTTYPE,E.LINE_CHARTTYPE,E.COMBINATION_CHARTTYPE,E.BUBBLE_CHARTTYPE];var T=[E.COLUMNSTACKED_CHARTTYPE];var N;var I=new d("OVP.charts.VizAnnotationManager");function R(e,t,a){var r=e.getMetaModel().getObject("/"+t+"/"+a+"@");return r["@com.sap.vocabularies.Common.v1.IsCalendarYear"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]}function D(t,r,i,n,o,s,l){var u="{";if(!t||!t.getSetting("ovpCardProperties")){I.error(y.ANALYTICAL_CONFIG_ERROR);u+="}";return u}var f=t.getSetting("dataModel");var c;if(l&&l.$EnumMember){c=l.$EnumMember.split("/");if(c&&c[1]!="Donut"&&o===undefined){return null}}var v=[];var p=[];var g=[];var d=[];var h=[];var _=[];var C=[];var T=[];var N=i&&i.Parameters;var R=n&&n.SortOrder;var D=n&&n.MaxItems,M=null;var V;var L;var Y;var x=null;var $=E.TEXT_KEY;var U=E.TEXT_KEY_V4;var F=E.UNIT_KEY;var K="@"+E.UNIT_KEY_V4_ISOCurrency;var w="@"+E.UNIT_KEY_V4_Unit;var H={};if(typeof D==="number"||typeof D==="string"&&!isNaN(D)){M=parseInt(D,10)}if(M){if(M==="0"){I.error("OVP-AC: Analytic card Error: maxItems is configured as "+M);u+="}";return u}if(!/^\d+$/.test(M)){I.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");u+="}";return u}}var G=t.getSetting("ovpCardProperties"),z=G.getProperty("/parameters");var j=G.getProperty("/metaModel");var W=G.getProperty("/measureAggregate");var X=P.getEntitySetName(j,r.$Type);N=N||!!z;if(N){var q=a.resolveParameterizedEntitySet(f,r,i,z);u+="path: '"+q+"'"}else{u+="path: '/"+X+"'"}var Q=[];x=t.getSetting("ovpCardProperties").getProperty("/entitySet");if(!f||!x){return u}var Z=ue(f,x);ye(f,Z,r.$Type);var J=t.getSetting("ovpCardProperties").getProperty("/cardLayout");var ee=1,te;var ae=B();var re;var ie;if(o&&J&&J.colSpan&&J.colSpan>1){te=J.colSpan-ee;for(var ne in ae){if((ie=ae[ne].reference)&&ae[ie]){var oe=A({},ae[ie]);ae[ne]=oe}if(ne===c[1]||ae[ne].time&&ae[ne].time.type===c[1].toLowerCase()){re=ae[ne];break}}var se=k(o,re,f,x);if(se){re=re.time}else{re=re.default}var le=t.getSetting("ovpCardProperties").getProperty("/dataStep");if(!le){if(re.resize&&re.resize.hasOwnProperty("dataStep")&&!isNaN(re.resize.dataStep)){le=re.resize.dataStep}}le=parseInt(le,10);if(te>0&&le&&!isNaN(le)){M=parseInt(M,10)+le*te}}if(i){var G=t.getSetting("ovpCardProperties");Q=a.getFilters(G,i)}if(Q.length>0){u+=", filters: "+JSON.stringify(Q)}var fe=j.getObject("/"+r.$Type+"/@");m(s,function(e,t){V=t.Measure.$PropertyPath;if(t.DataPoint&&t.DataPoint.$AnnotationPath){var a=fe[t.DataPoint.$AnnotationPath];if(a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){var r=a.ForecastValue.PropertyPath||a.ForecastValue.Path;h.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path);if(Z&&Z[r]){var i;if(Z[r].annotations&&Z[r].annotations[K]){i=Z[r].annotations[K].$Path?Z[r].annotations[K].$Path:undefined}else if(Z[r].annotations&&Z[r].annotations[w]){i=Z[r].annotations[w].$Path?Z[r].annotations[w].$Path:undefined}else if(Z[r][F]){i=Z[r][F]}if(i){if((_?Array.prototype.indexOf.call(_,i):-1)===-1){_.push(i)}}}}if(a.TargetValue&&(a.TargetValue.PropertyPath||a.TargetValue.Path)){var n=a.TargetValue.PropertyPath||a.TargetValue.Path;h.push(a.TargetValue.PropertyPath||a.TargetValue.Path);if(Z&&Z[n]){var i;if(Z[n].annotations&&Z[n].annotations[K]){i=Z[n].annotations[K].$Path?Z[n].annotations[K].$Path:undefined}else if(Z[n].annotations&&Z[n].annotations[w]){i=Z[n].annotations[w].$Path?Z[n].annotations[w].$Path:undefined}else if(Z[n][F]){i=Z[n][F]}if(i){if((_?Array.prototype.indexOf.call(_,i):-1)===-1){_.push(i)}}}}}h.push(V);if(Z&&Z[V]){if(Z[V][U]){if(Z[V][U].String&&V!=Z[V][U].String){h.push(Z[V][U].String?Z[V][U].String:V)}else if(Z[V][U].Path&&V!=Z[V][U].Path){h.push(Z[V][U].Path?Z[V][U].Path:V)}}else if(Z[V][$]&&V!=Z[V][$]){h.push(Z[V][$]?Z[V][$]:V)}}if(Z&&Z[V]){var i;if(Z[V].annotations&&Z[V].annotations[K]){i=Z[V].annotations[K].$Path?Z[V].annotations[K].$Path:undefined}else if(Z[V].annotations&&Z[V].annotations[w]){i=Z[V].annotations[w].$Path?Z[V].annotations[w].$Path:undefined}else if(Z[V][F]){i=Z[V][F]}if(i){if((_?Array.prototype.indexOf.call(_,i):-1)===-1){_.push(i)}}}});m(o,function(e,t){V=t.Dimension.$PropertyPath;v.push(V);if(Z&&Z[V]){if(Z[V]["annotations"]&&Z[V]["annotations"]["@"+U]){if(typeof Z[V]["annotations"]["@"+U]==="string"&&Z[V]["annotations"]["@"+U]&&V!=Z[V]["annotations"]["@"+U]){v.push(Z[V]["annotations"]["@"+U])}else if(Z[V]["annotations"]["@"+U].$Path&&V!=Z[V]["annotations"]["@"+U].$Path){Y=Z[V]["annotations"]["@"+U].$Path;var a=Y.split("/");if(a.length>1){L=O(j,fe,Y);if(L!==""){v.push(Y);p.push(L);d=S(j,fe,Y);if(d.length>0){g=g.concat(d)}}}else{v.push(Y?Y:V)}}}else if(Z[V][$]&&V!=Z[V][$]){v.push(Z[V][$]?Z[V][$]:V)}}});if(g.length>0){var ce=0;while(ce<g.length){if(v.indexOf(g[ce])!==-1){g.splice(ce,1)}else{ce++}}}if(h.length>0){m(h,function(e,t){t+="Aggregate";H[t]=true})}if(v.length>0){m(v,function(e,t){H[t]=true})}if(R){var ve=n.SortOrder;if(!ve.length){ve=e.getSortAnnotationCollection(f,n,r)}if(ve.length<1){I.warning(y.CARD_WARNING+y.SORTORDER_WARNING)}else{var pe="";var ge;var me;var Ae;for(var de=0;de<ve.length;de++){ge=ve[de];Ae=ge.Property.$PropertyPath;if(h.includes(Ae)){Ae+="Aggregate"}T.push(Ae);if(typeof ge.Descending==="undefined"){me="true"}else{var he=ge.Descending.Bool||ge.Descending.Boolean;if(!he){I.warning(y.CARD_WARNING+y.BOOLEAN_ERROR);me="true"}else{me=he.toLowerCase()==="true"?"true":"false"}}pe=pe+"{path: '"+Ae+"',descending: "+me+"},"}u+=", sorter: ["+pe.substring(0,pe.length-1)+"]"}}var Pe=b(_,v);if(T.length>0){m(T,function(e,t){if(!H.hasOwnProperty(t)){Pe.push(t)}})}u+=", parameters: {$apply:'groupby(("+Pe.join(",")+"),";u+="aggregate(";var Ee=[];h.forEach(function(e,t){var a=W&&W["Axis"+(t+1)];var r=a?a:"sum";var i=[e," with ",r," as ",e,"Aggregate"].join("");Ee.push(i)});u+=Ee.join(",");u+="))";var _e=j.getObject("/"+r.$Type);if(_e){var Ce=a.getRequestFields(n);if(Ce&&Ce.length>0){m(Ce,function(e,t){if(!H.hasOwnProperty(t)){H[t]=true;C.push(t)}});if(C.length>0){u+=","+C.join(",")}}}if(p.length>0){u+="'"+","+" expand:'"+p.join(",")}var Te=a.checkFilterPreference(t.getSetting("ovpCardProperties"));if(Te){u+="', custom: {cardId: '"+t.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}"}else{u+="'}"}if(c&&c[1]==="Donut"&&o===undefined){u+=", length: 1"}else if(c&&c[1]==="Donut"&&o&&M){u+=", length: "+(parseInt(M,10)+1)}else if(M){u+=", length: "+M}u+="}";return u}D.requiresIContext=true;function O(e,t,a){var r="";var i=a.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(r){r=r+"/"}r=r+i[n]}else{return r}}}return r}function b(e,t){var a=e.length>0?t.concat(e):t;return a.filter(function(e,t){return a.indexOf(e)===t})}function S(e,t,a){var r=[];var i=[];var n;var o=a.split("/");if(o.length>1){for(var s=0;s<o.length-1;s++){var l=e.getODataAssociationEnd(t,o[s]);if(l){t=e.getODataEntityType(l.type);if(t){i=t&&t.key&&t.key.propertyRef;for(var u=0;u<i.length;u++){n=o[s]+"/"+i[u].name;r.push(n)}}}}}return r}function M(e,t){var a=false;var r;if(e.DataPoint&&e.DataPoint.$AnnotationPath){var i=t[e.DataPoint.$AnnotationPath];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){a=true;r=e}}if(a===true){return r}else{I.warning(y.CARD_WARNING+y.INVALID_FORECAST);return undefined}}function V(e,t){var a=false;var r;if(e.DataPoint&&e.DataPoint.$AnnotationPath){var i=t[e.DataPoint.$AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){a=true;r=e}}if(a===true){return r}else{I.warning(y.CARD_WARNING+y.INVALID_TARGET);return undefined}}function L(e,t){var a;m(t,function(t,r){if(r.name===e){if(r["com.sap.vocabularies.Common.v1.Label"]){a=r["com.sap.vocabularies.Common.v1.Label"].String?r["com.sap.vocabularies.Common.v1.Label"].String:r["com.sap.vocabularies.Common.v1.Label"].Path}else if(r["sap:label"]){a=r["sap:label"]}return false}});return a}function Y(e,t){var a=true;if(t==="line"||t==="column"||t==="bar"){m(e,function(e,t){if(t.getUid()==="valueAxis"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){a=false;I.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false}}})}else if(t==="vertical_bullet"){m(e,function(e,t){if(t.getUid()==="actualValues"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){a=false;I.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false}}})}if(a===true){return true}}function x(e,t,a){var r=E.TYPE_KEY;if(!e||!e[t]||!e[t][r]){return a}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var n=e[t][r];if((i?Array.prototype.indexOf.call(i,n):-1)!==-1){return Number(a)}return a}function $(e){if(e){return e}return""}function U(e,t){var a=e.getModel();var r=e.getVizType();if(r!="line"&&r!="bubble"){return}if(!t){t=r==="line"?"categoryAxis":"valueAxis"}var i=e.getModel("ovpCardProperties").getProperty("/entitySet");if(!a||!i){return}var n=ue(a,i);var o=e.getFeeds();for(var s=0;s<o.length;s++){if(o[s].getUid()===t){var l=o[s].getValues();if(!l){return}for(var u=0;u<l.length;u++){if(n[l[u][E.TYPE_KEY]]!="Edm.DateTime"){return}}e.setVizProperties({categoryAxis:{title:{visible:false}}});return}}}function F(e,t,a,r,i,n){r=typeof r==="undefined"?false:r;var o=false;var s;if(!e&&r){I.error(i+y.CARD_ERROR+a+y.IS_MANDATORY);return o}if(!e){I.warning(i+y.CARD_WARNING+a+y.IS_MISSING);o=true;return o}s=t["@"+e];if(!s||typeof s!=="object"){var l=r?I.error:I.warning;l(i+y.CARD_ERROR+"in "+a+". (@"+e+" "+y.NOT_WELL_FORMED);return o}if(n&&n==="sap.ovp.cards.v4.charts.analytical.analyticalChart"&&a==="Chart Annotation"&&(!s.ChartType||!s.ChartType.$EnumMember)){I.error(i+y.CARD_ERROR+y.MISSING_CHARTTYPE+y.CHART_ANNO);return o}o=true;return o}function K(e){var t=false;if(!e){return t}var a;var r;var i;var n;var o;var s;var l;var u="";var f;var c=e.getView();if(c){u="["+c.getId()+"] "}if(!(f=e.getCardPropertiesModel())){I.error(u+y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return t}l=f.getProperty("/entityType");var v=e.getMetaModel();var p=v.getData().$Annotations[l.$Type];if(!l||h(l)){I.error(u+y.CARD_ERROR+"in "+y.CARD_ANNO);return t}a=f.getProperty("/selectionAnnotationPath");r=f.getProperty("/chartAnnotationPath");n=f.getProperty("/presentationAnnotationPath");o=f.getProperty("/identificationAnnotationPath");s=f.getProperty("/dataPointAnnotationPath");i=f.getProperty("/contentFragment");t=F(a,p,"Selection Variant",false,u);t=F(r,p,"Chart Annotation",true,u,i)&&t;t=F(n,p,"Presentation Variant",false,u)&&t;t=F(o,p,"Identification Annotation",true,u)&&t;t=F(s,p,"Data Point",false,u)&&t;return t}function w(e,t,a){}function B(t){return e.getConfig(t)}function k(e,t,a,r){var i=false;var n;var o;var s;var l;var u;var f;if(!t.time||h(t.time)){return i}if(!e){return i}for(var c=0;c<e.length;c++){if(!e[c].Dimension||!(o=e[c].Dimension.$PropertyPath)){return i}n=ue(a,r);if(n&&n[o]){s=n[o][E.TYPE_KEY];l=n[o][E.DISPLAY_FORMAT_KEY];u=n[o][E.SEMANTICS_KEY];f=R(a,r,o)}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(l&&l.toLowerCase()==="date"){i=true}}else{i=true}}if(s==="Edm.String"&&(f||u&&_.indexOf(u)>-1)){i=true}if(i){e.unshift(e.splice(c,1)[0]);break}}return i}function H(e,t,a){var r="";var i=B(t);var n,o;if(!i){return r}r=i.default.type;n=e.getSetting("dataModel");o=e.getSetting("ovpCardProperties").getProperty("/entitySet");if(k(a,i,n,o)){r=i.time.type}return r}H.requiresIContext=true;function G(e,t,a){if(!e.length){return}var r=a==="dimension"?"Dimension":"Measure";var i=[];m(e,function(e,t){if(!t||!t[r]||!t[r].PropertyPath){I.error(y.INVALID_CHART_ANNO);return false}i.push(t[r].PropertyPath)});var n=jQuery.map(t.feeds,function(e){if(e.type===a){if(e.role){return e.role.split("|")}return[]}});n=jQuery.grep(n,function(e,t){return(n?Array.prototype.indexOf.call(n,e):-1)===t}).join(", ");I.error(y.CARD_ERROR+y.INVALID_REDUNDANT+a+"(s) "+i.join(", ")+". "+y.ALLOWED_ROLES+t.type+y.CHART_IS+n)}function z(e,t){var a;if(e){if(e.String){a=e.String}else if(e.Boolean||e.Bool){a=j(e)}else{a=W(e,t)}}return a}function j(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function W(e,t){var a;if(e){if(e.String){a=Number(e.String)}else if(e.Int){a=Number(e.Int)}else if(e.Decimal){a=Number(e.Decimal)}else if(e.Double){a=Number(e.Double)}else if(e.Single){a=Number(e.Single)}}if(t){var i=r.getFloatInstance({style:"short",minFractionDigits:2,maxFractionDigits:2});if(a){a=i.format(Number(a))}}return a}function X(e,t){function r(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return z(e)}}else{return""}}var i=e[e.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var n=t.CriticalityCalculation.ImprovementDirection.EnumMember;var o=r(t.CriticalityCalculation.DeviationRangeLowValue);var s=r(t.CriticalityCalculation.DeviationRangeHighValue);var l=r(t.CriticalityCalculation.ToleranceRangeLowValue);var u=r(t.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(i,n,o,s,l,u,a.criticalityConstants.StateValues)}else{var f=t.Criticality.EnumMember;var c=f?f.split("/"):[];if(c){return c[1]}}}function q(e,t,a){var r,i;m(t,function(t,a){if(a["com.sap.vocabularies.Common.v1.Label"]&&a["com.sap.vocabularies.Common.v1.Label"].String===e.measureNames){r=a.name;return false}else if(a["com.sap.vocabularies.Common.v1.Label"]&&a["com.sap.vocabularies.Common.v1.Label"].Path===e.measureNames){r=a.name;return false}else if(a["sap:label"]===e.measureNames){r=a.name;return false}});m(a,function(e,t){if(t.Measure.PropertyPath===r){if(!t.DataPoint||!t.DataPoint.$AnnotationPath){return false}i=t.DataPoint.$AnnotationPath;return false}});return i}function Q(e,t){if(e){if(e.Path){return e.Path}else{return z(e,t)}}else{return""}}function Z(e,t){function a(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var r=false;m(e,function(e,i){if(i.DataPoint&&i.DataPoint.$AnnotationPath){var n=t[i.DataPoint.$AnnotationPath.substring(1)];if(n&&n.CriticalityCalculation&&n.CriticalityCalculation.ImprovementDirection&&n.CriticalityCalculation.ImprovementDirection.EnumMember){var o=n.CriticalityCalculation.ImprovementDirection.EnumMember;var s=Q(n.CriticalityCalculation.DeviationRangeLowValue);var l=Q(n.CriticalityCalculation.DeviationRangeHighValue);var u=Q(n.CriticalityCalculation.ToleranceRangeLowValue);var f=Q(n.CriticalityCalculation.ToleranceRangeHighValue);if(a(o,"Minimize")||a(o,"Minimizing")){if(f&&l){r=true;return false}else{I.warning(y.CARD_WARNING+y.INVALID_CRITICALITY)}}else if(a(o,"Maximize")||a(o,"Maximizing")){if(u&&s){r=true;return false}else{I.warning(y.CARD_WARNING+y.INVALID_CRITICALITY)}}else if(a(o,"Target")){if(u&&s&&f&&l){r=true;return false}else{I.warning(y.CARD_WARNING+y.INVALID_CRITICALITY)}}}else if(n&&n.Criticality){r=true;return false}else{I.warning(y.CARD_WARNING+y.INVALID_IMPROVEMENT_DIR)}}});if(r===true&&e.length>1){I.warning(y.CARD_WARNING+y.INVALID_SEMANTIC_MEASURES)}return r}function J(e,t,a,r){function i(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var n=[null,null];var o=true;var s=e.Measure.PropertyPath;if(a[s]){if(a[s][E.LABEL_KEY_V4]){s=le(a[s][E.LABEL_KEY_V4].String?a[s][E.LABEL_KEY_V4].String:a[s][E.LABEL_KEY_V4].Path,r,a)}else if(a[s][E.LABEL_KEY]){s=a[s][E.LABEL_KEY]}else if(s){s=s}}var l=e.DataPoint.$AnnotationPath;var u=t[l.substring(1)];if(!u.CriticalityCalculation||!u.CriticalityCalculation.ImprovementDirection||!u.CriticalityCalculation.ImprovementDirection.EnumMember){return n}var f=u.CriticalityCalculation.ImprovementDirection.EnumMember;var c=Q(u.CriticalityCalculation.DeviationRangeLowValue,o);var v=Q(u.CriticalityCalculation.DeviationRangeHighValue,o);var g=Q(u.CriticalityCalculation.ToleranceRangeLowValue,o);var m=Q(u.CriticalityCalculation.ToleranceRangeHighValue,o);if(i(f,"Minimize")||i(f,"Minimizing")){if(m&&v){n[0]=p.getText("MINIMIZING_LESS",[s,m]);n[1]=p.getText("MINIMIZING_MORE",[s,v]);n[2]=p.getText("MINIMIZING_CRITICAL",[m,s,v])}}else if(i(f,"Maximize")||i(f,"Maximizing")){if(g&&c){n[0]=p.getText("MAXIMISING_MORE",[s,g]);n[1]=p.getText("MAXIMISING_LESS",[s,c]);n[2]=p.getText("MAXIMIZING_CRITICAL",[c,s,g])}}else if(i(f,"Target")){if(g&&c&&m&&v){n[0]=p.getText("TARGET_BETWEEN",[g,s,m]);n[1]=p.getText("TARGET_AROUND",[s,c,v]);n[2]=p.getText("TARGET_CRITICAL",[c,s,g,m,v])}}return n}function ee(e,t,a){if(t&&t.DataPoint&&t.DataPoint.$AnnotationPath){var r=t.DataPoint.$AnnotationPath,i=a[r];var n,o;if(i&&i.ValueFormat){n=i.ValueFormat}else if(i&&i.NumberFormat){n=i.NumberFormat}if(n&&n.NumberOfFractionalDigits){o=n.NumberOfFractionalDigits;if(e<Number(o)){e=Number(o)}}}return e}function te(e,t,a){if(t&&t.DataPoint&&t.DataPoint.$AnnotationPath){var r=a[t.DataPoint.$AnnotationPath];var i,n;if(r&&r.ValueFormat){i=r.ValueFormat}else if(r&&r.NumberFormat){i=r.NumberFormat}if(i){if(i.ScaleFactor&&i.ScaleFactor.Decimal){n=Number(i.ScaleFactor.Decimal)}else if(i.ScaleFactor&&i.ScaleFactor.Int){n=Number(i.ScaleFactor.Int)}if(!isNaN(n)){if(e===undefined){e=Number(n)}else if(e>Number(n)){e=Number(n)}}}}return e}function ae(e,t){if(e&&e[t]&&(e[t]["Org.OData.Measures.V1.ISOCurrency"]||e[t][E.SEMANTICS_KEY]&&e[t][E.SEMANTICS_KEY]===E.CURRENCY_CODE)){return true}return false}function re(e,t,a){if(e[t[a].$PropertyPath].$Type===E.EDM_INT32){return true}return false}function ie(e,t,a){if(e[t[a].$PropertyPath].$Type===E.EDM_INT64){return true}return false}function ne(e,t,r,i){var n,s,v,d,h;var P,_,D,O,b,S=false;var x;var $,U,F;var K,w=[],H=[];var z;var j;var W=i&&i.getView();var Q,ne;var se=W&&W.getModel("ui");var ve=se&&se.getProperty("/chartSettings");n=e.getModel("ovpCardProperties");if(l.checkIfAPIIsUsed(i)){S=n&&n.getData()&&n.getData().showDataLabel}h=ve?ve.showDataLabel:S;P=e.getVizType();_=B();for(var pe in _){if((j=_[pe].reference)&&_[j]){var ge=A({},_[j]);_[pe]=ge}if(_[pe].default.type===P||_[pe].time&&_[pe].time.type===P){D=_[pe];break}}if(!D){I.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.CARD_CONFIG_ERROR+P+" "+y.CARD_CONFIG_JSON);return}if(!n){I.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return}var me=e.getModel();var Ae=n.getProperty("/entitySet");if(!me||!Ae){return}var de=n.getProperty("/entityType").$Type;var he=i.getMetaModel().getData().$Annotations[de];var Pe={property:i.getMetaModel().getObject("/"+de+"/")};s=g.merge(true,{},he,Pe);if(!s){I.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return}var Ee=ue(me,Ae);ye(me,Ee,de);v=n.getProperty("/chartAnnotationPath");if(!v||!(d=s["@"+v])){I.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return}if(!(O=d.DimensionAttributes)||!O.length){I.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return}var Ne;if(!(b=d.MeasureAttributes)||!b.length){I.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return}else{var Ie=b[0].DataPoint?s[b[0].DataPoint.$AnnotationPath]:null;var Re=Ie&&Ie.ValueFormat&&Ie.ValueFormat.NumberOfFractionalDigits&&Ie.ValueFormat.NumberOfFractionalDigits;Ne=Re?Re:0}z=k(O,D,me,Ae);if(z){D=D.time}else{D=D.default}var De=n.getProperty("/ChartProperties")||n.getProperty("/chartProperties");if(n&&n.getProperty("/tabs")&&De===undefined){Q=W.byId("ovp_card_dropdown");ne=parseInt(Q.getSelectedKey(),10);De=n.getProperty("/tabs")&&n.getProperty("/tabs")[ne-1]&&(n.getProperty("/tabs")[ne-1]["ChartProperties"]||n.getProperty("/tabs")[ne-1]["chartProperties"])}var Oe=false;var be=Ne>0?"tooltipNoScaleFormatter/"+Ne.toString()+"/":"tooltipNoScaleFormatter/-1/";var Se=new o({formatString:be});Se.connect(e.getVizUid());Se.connect(e.getVizUid());e._oOvpVizFrameTooltip=Se;[D.dimensions,D.measures].forEach(function(e,t){var a=t?b:O;var r=t?"measure(s)":"dimension(s)";if(e.min&&a.length<e.min){I.error(y.CARD_ERROR+"in "+P+" "+y.CARD_LEAST+e.min+" "+r);Oe=true}if(e.max&&a.length>e.max){I.error(y.CARD_ERROR+"in "+P+y.CARD_MOST+e.max+" "+r);Oe=true}});if(Oe){return}var Me=true;if(D.properties&&D.properties.hasOwnProperty("hideLabel")&&!D.properties["hideLabel"]){Me=false}var Ve=true;var Le=false;if(P==="donut"){Le=true}e.removeAllAggregation();x={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:Ve?false:true,selectability:{legendSelection:Le?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:h||Le?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(D.properties&&D.properties.semanticColor===true&&Z(b,s)){var Ye=p.getText("GOOD");var xe=p.getText("BAD");var $e=p.getText("CRITICAL");var Ue=p.getText("OTHERS");if(b.length===1){var Fe=J(b[0],s,Ee,e);var Ye=Fe[0]||Ye,xe=Fe[1]||xe,$e=Fe[2]||$e,Ue=p.getText("OTHERS")}x.plotArea.dataPointStyle={rules:[{callback:function(e){var t=q(e,Ee,b);if(!t){return false}var r=s[t.substring(1)];var i=X(e,r);if(i===a.criticalityConstants.StateValues.Positive){return true}else if(i==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Ye},{callback:function(e){var t=q(e,Ee,b);if(!t){return false}var r=s[t.substring(1)];var i=X(e,r);if(i===a.criticalityConstants.StateValues.Critical){return true}else if(i==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:$e},{callback:function(e){var t=q(e,Ee,b);if(!t){return false}var r=s[t.substring(1)];var i=X(e,r);if(i===a.criticalityConstants.StateValues.Negative){return true}else if(i==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:xe},{callback:function(e){var t=q(e,Ee,b);if(!t){return false}var r=s[t.substring(1)];var i=X(e,r);if(i===a.criticalityConstants.StateValues.None){return true}else if(i==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:Ue}]}}var Ke=n.getProperty("/bEnableStableColors");var we=n.getProperty("/colorPalette");var Be;if(!Ke&&C.indexOf(d.ChartType.$EnumMember)>=0&&we&&Object.keys(we).length>=2&&Object.keys(we).length<=4){m(O,function(e,t){if(t&&t.Role&&t.Role.$EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Be=t.Dimension&&t.Dimension.$PropertyPath;return}});var ke;if(Be){if(Ee&&Ee[Be]){if(Ee[Be][E.LABEL_KEY_V4]){ke=le(Ee[Be][E.LABEL_KEY_V4]?Ee[Be][E.LABEL_KEY_V4]:Ee[Be][E.LABEL_KEY_V4].Path,e,Ee)}else if(Ee[Be][E.LABEL_KEY]){ke=Ee[Be][E.LABEL_KEY]}else if(Be){ke=Be}}if(we instanceof Array){var He=we.map(function(e){return e.color});var Ge=we.map(function(e){return e.legendText});var ze=Ge[0]!=undefined?Ge[0]:p.getText("OTHERS");var je=Ge[1]!=undefined?Ge[1]:p.getText("BAD");var We=Ge[2]!=undefined?Ge[2]:p.getText("CRITICAL");var Xe=Ge[3]!=undefined?Ge[3]:p.getText("GOOD")}x.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[ke]==="3"||e[ke]===3)){if(we instanceof Array){if(we.length<4){return false}}else if(we&&!we.hasOwnProperty(3)){return false}return true}},properties:{color:we instanceof Array&&He.length?He[3]:we[3]&&we[3]["color"]},displayName:Xe||we[3]&&we[3]["legendText"]},{callback:function(e){if(e&&(e[ke]==="2"||e[ke]===2)){if(we instanceof Array){if(we.length<3){return false}}else if(we&&!we.hasOwnProperty(2)){return false}return true}},properties:{color:we instanceof Array&&He.length?He[2]:we[2]&&we[2]["color"]},displayName:We||we[2]&&we[2]["legendText"]},{callback:function(e){if(e&&(e[ke]==="1"||e[ke]===1)){return true}},properties:{color:we instanceof Array&&He.length?He[1]:we[1]&&we[1]["color"]},displayName:je||we[1]&&we[1]["legendText"]},{callback:function(e){if(e&&(e[ke]==="0"||e[ke]===0)){return true}},properties:{color:we instanceof Array&&He.length?He[0]:we[0]&&we[0]["color"]},displayName:ze||we[0]&&we[0]["legendText"]}]}}}var qe=false;var Qe=false;if(d.ChartType.$EnumMember===E.SCATTER_CHARTTYPE||d.ChartType.$EnumMember===E.BUBBLE_CHARTTYPE||d.ChartType.$EnumMember===E.LINE_CHARTTYPE){if(d&&d.AxisScaling&&d.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var Ze=d.AxisScaling;if(Ze.AutoScaleBehavior&&Ze.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var Je=Ze.AutoScaleBehavior;if(Je.ZeroAlwaysVisible&&Je.ZeroAlwaysVisible=="true"){x.plotArea.adjustScale=false;qe=true}else if(Je.DataScope){x.plotArea.adjustScale=true;qe=true}}else if(Ze.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&Ze.ScaleBehavior&&Ze.ScaleBehavior.$EnumMember){var et=Ze.ScaleBehavior.$EnumMember;var tt=et.substring(et.lastIndexOf("/")+1,et.length);if(tt=="FixedScale"){Qe=true}}}else if(d&&d.AxisScaling&&d.AxisScaling.$EnumMember){var at=d.AxisScaling.$EnumMember.substring(d.AxisScaling.$EnumMember.lastIndexOf("/")+1,d.AxisScaling.$EnumMember.length);switch(at){case"AdjustToDataIncluding0":x.plotArea.adjustScale=false;qe=true;break;case"AdjustToData":x.plotArea.adjustScale=true;qe=true;break;case"MinMaxValues":Qe=true;break;default:break}}if(Qe){var rt=[];if(d["MeasureAttributes"][0]&&d["MeasureAttributes"][0].DataPoint&&d["MeasureAttributes"][0].DataPoint.$AnnotationPath){var it=d["MeasureAttributes"][0].DataPoint.$AnnotationPath;var nt=it.substring(it.lastIndexOf("@")+1,it.length);if(s&&s[nt]){var ot=s[nt];if(ot&&ot.MaximumValue&&ot.MinimumValue){rt.push({feed:"valueAxis",max:ot.MaximumValue,min:ot.MinimumValue});qe=true}else{I.error(y.ERROR_MISSING_AXISSCALES)}}}if(d.ChartType.$EnumMember!==E.LINE_CHARTTYPE&&d["MeasureAttributes"][1]&&d["MeasureAttributes"][1].DataPoint&&d["MeasureAttributes"][1].DataPoint.$AnnotationPath){var it=d["MeasureAttributes"][1].DataPoint.$AnnotationPath;var nt=it.substring(it.lastIndexOf("@")+1,it.length);if(s&&s[nt]){var ot=s[nt];if(ot&&ot.MaximumValue&&ot.MinimumValue){rt.push({feed:"valueAxis2",max:ot.MaximumValue,min:ot.MinimumValue});qe=true}else{I.error(y.ERROR_MISSING_AXISSCALES)}}}e.setVizScales(rt)}}U=O.slice();F=b.slice();var st=0;var lt=0;var ut;var ft;var ct=false;var vt=false;var pt;var gt=[];var mt=[],At=[];if((P==="column"||P==="bar"||P==="vertical_bullet")&&D.feeds&&D.feeds.length>0){var dt;for(dt=0;dt<D.feeds.length;dt++){if(D.feeds[dt].uid==="color"){D.feeds.splice(dt,1);break}}for(dt=0;dt<D.feeds.length;dt++){if(D.feeds[dt].uid==="categoryAxis"){delete D.feeds[dt].role;break}}if(n.getProperty("/colorPalette")){for(dt=0;dt<D.feeds.length;dt++){if(D.feeds[dt].uid==="categoryAxis"){D.feeds[dt].role="Category";break}}D.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}m(D.feeds,function(t,a){var r=a.uid;var i=[];if(a.type){var n,o,l;if(a.type==="dimension"){n=O.length;o="Dimension";l="dimensions";$=U;K=w}else{n=b.length;o="Measure";l="measures";$=F;K=H}var v=0,p=n;if(a.min){v=v>a.min?v:a.min}if(a.max){p=p<a.max?p:a.max}if(!a.role){var g=$.length;for(var A=0;A<g&&i.length<p;++A){var d=$[A];$.splice(A,1);--g;--A;i.push(d);if(Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_Unit]){pt=Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?Ee[d[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(Ee[d[o].$PropertyPath][E.UNIT_KEY]){pt=Ee[d[o].$PropertyPath][E.UNIT_KEY]}if(ae(Ee,pt)){ct=true}else{vt=true}if(!ct){st=ee(st,d,s);ut=te(ut,d,s)}else{lt=ee(lt,d,s);ft=te(ft,d,s)}}}else{var h=a.role.split("|");m(h,function(e,t){if(i.length===p){return false}var a=$.length;for(var r=0;r<a&&i.length<p;++r){var n=$[r];if(n&&n.Role&&n.Role.$EnumMember&&n.Role.$EnumMember.split("/")&&n.Role.$EnumMember.split("/")[1]){var l=n.Role.$EnumMember.split("/")[1];if(l===t){$.splice(r,1);--a;--r;i.push(n);if(Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_Unit]){pt=Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?Ee[n[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(Ee[n[o].$PropertyPath][E.UNIT_KEY]){pt=Ee[n[o].$PropertyPath][E.UNIT_KEY]}if(ae(Ee,pt)){ct=true}else{vt=true}if(!ct){st=ee(st,n,s);ut=te(ut,n,s)}else{lt=ee(lt,n,s);ft=te(ft,n,s)}}}else if((K?Array.prototype.indexOf.call(K,n):-1)===-1){K.push(n)}}});if(i.length<p){m(K,function(e,t){var a;var r;if((a=D[l].defaultRole)&&(h?Array.prototype.indexOf.call(h,a):-1)!==-1&&(r=($?Array.prototype.indexOf.call($,t):-1)!==-1)){$.splice(r,1);i.push(t);if(Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){pt=Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path?Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_Unit]){pt=Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path?Ee[t[o].$PropertyPath][E.UNIT_KEY_V4_Unit].$Path:undefined}else if(Ee[t[o].$PropertyPath][E.UNIT_KEY]){pt=Ee[t[o].$PropertyPath][E.UNIT_KEY]}if(ae(Ee,pt)){ct=true}else{vt=true}if(!ct){st=ee(st,t,s);ut=te(ut,t,s)}else{lt=ee(lt,t,s);ft=te(ft,t,s)}if(i.length===p){return false}}})}if(i.length<v){I.error(y.CARD_ERROR+y.MIN_FEEDS+P+" "+y.FEEDS_OBTAINED+i.length+" "+y.FEEDS_REQUIRED+v+" "+y.FEEDS);return false}}if(i.length){var _=[];var C;if(!(C=e.getDataset())){I.error(y.NO_DATASET);return false}N=s;m(i,function(t,a){if(!a||!a[o]||!a[o].$PropertyPath){I.error(y.INVALID_CHART_ANNO);return false}var i=a[o].$PropertyPath;var n=i;var s=i;var l=null;if(Ee&&Ee[i]){if(Ee[i]["annotations"]){if(Ee[i]["annotations"]["@"+E.LABEL_KEY_V4]){if(Ee[i]["annotations"]["@"+E.LABEL_KEY_V4]instanceof String&&Ee[i]["annotations"]["@"+E.LABEL_KEY_V4]){n=le(Ee[i]["annotations"]["@"+E.LABEL_KEY_V4],e,Ee)}else if(Ee[i]["annotations"]["@"+E.LABEL_KEY_V4].$Path){n=Ee[i]["annotations"]["@"+E.LABEL_KEY_V4].$Path}else{n=Ee[i]["annotations"]["@"+E.LABEL_KEY_V4]}}else if(Ee[i]["annotations"]["@"+E.LABEL_KEY]){n=Ee[i]["annotations"]["@"+E.LABEL_KEY]}else if(i){n=i}if(Ee[i]["annotations"]["@"+E.TEXT_KEY_V4]){s=Ee[i]["annotations"]["@"+E.TEXT_KEY_V4].$String?Ee[i]["annotations"]["@"+E.TEXT_KEY_V4].$String:Ee[i]["annotations"]["@"+E.TEXT_KEY_V4].$Path}else if(Ee[i]["annotations"]["@"+E.TEXT_KEY]){s=Ee[i]["annotations"]["@"+E.TEXT_KEY]}}else if(i){s=i}l=Ee[i].$Type||null}var c;if((l==="Edm.DateTime"||l==="Edm.DateTimeOffset")&&s===i){c="{path:'"+i+"', formatter: 'sap.ovp.cards.v4.charts.VizAnnotationManager.returnDateFormat'}"}else{if(Ee[i]&&Ee[i]["annotations"]&&Ee[i]["annotations"]["@"+E.TEXT_KEY_V4]&&Ee[i]["annotations"]["@"+E.TEXT_KEY_V4+"@"+E.TEXT_ARRANGEMENT_ANNO]){var v,p;v=Ee[i]["annotations"]["@"+E.TEXT_KEY_V4+"@"+E.TEXT_ARRANGEMENT_ANNO];p=v&&v.$EnumMember;if(!p){v=Ee[i]["annotations"]["@"+E.TEXT_KEY_V4]["@"+E.TEXT_ARRANGEMENT_ANNO];p=v&&v.$EnumMember}if(!p){var g=N;v=g&&g["@"+E.TEXT_ARRANGEMENT_ANNO];p=v&&v.$EnumMember}switch(p){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":c="{"+s+"}"+" "+"("+"{"+i+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":c="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":c="{"+s+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":c="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;default:c="{"+i+"}";break}}else{c="{"+s+"}"}}_.push(n);if(o==="Dimension"){if(r==="waterfallType"){var m=new u({name:n,value:"{"+i+"}"})}else{var m=new u({name:n,value:"{"+i+"}",displayValue:c})}var A=Ee[i][E.SEMANTICS_KEY];var d=R(e.getModel(),Ae,i);if(z&&(l==="Edm.DateTime"||d||l==="Edm.DateTimeOffset"||A&&A.lastIndexOf("year",0)===0)){m.setDataType("date")}C.addDimension(m);if((At?Array.prototype.indexOf.call(At,n):-1)===-1){At.push(n)}}else{C.addMeasure(new f({name:n,value:"{"+i+"}"}));if((mt?Array.prototype.indexOf.call(mt,n):-1)===-1&&r!="bubbleWidth"){mt.push(n)}}});e.addFeed(new c({uid:r,type:o,values:_}));if(r==="categoryAxis"){x[r]={title:{visible:Me?false:true,text:_.join(", ")},label:{formatString:ct?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{x[r]={title:{visible:Me?false:true,text:_.join(", ")},label:{formatString:ct?"CURR":"axisFormatter"}}}gt.push(x[r]);if(D.hasOwnProperty("vizProperties")){var T=0;var S=D.vizProperties.length;var M;var V;for(;T<S;T++){if(D.vizProperties[T].hasOwnProperty("value")){V=D.vizProperties[T].value}if(D.vizProperties[T].hasOwnProperty("path")){M=D.vizProperties[T].path.split(".");var L=M.length;var Y,B;var k;for(var G=0,k=M[0],Y=x,B=De;G<L;++G){if(G===L-1){if(B&&B.hasOwnProperty(k)){if(P==="donut"&&(B[k]==="value"||B[k]==="percentage")){V=B[k]}else if(P!="donut"){V=B[k]}}if(qe&&k!="adjustScale"||!qe&&k==="adjustScale"||!qe&&k!="adjustScale"){Y[k]=V}break}Y[k]=Y[k]||{};Y=Y[k];if(B){B[k]=B[k]||{};B=B[k]}k=M[G+1]}}}}if(a.hasOwnProperty("vizProperties")){var t=0;var j=a.vizProperties.length;var W;var X;var q;for(;t<j;t++){if(a.vizProperties[t].hasOwnProperty("method")){X=a.vizProperties[t].method;switch(X){case"count":W=_.length;if(a.vizProperties[t].hasOwnProperty("min")&&W<=a.vizProperties[t].min){W=a.vizProperties[t].min}else if(a.vizProperties[t].hasOwnProperty("max")&&W>=a.vizProperties[t].max){W=a.vizProperties[t].max}break;default:break}}else if(a.vizProperties[t].hasOwnProperty("value")){W=a.vizProperties[t].value}if(a.vizProperties[t].hasOwnProperty("path")){q=a.vizProperties[t].path.split(".");var Q=q.length;for(var A=0,Z=q[0],J=x;A<Q;++A){if(A===Q-1){J[Z]=W;break}J[Z]=J[Z]||{};J=J[Z];Z=q[A+1]}}}}}}});var ht=e.getFeeds();if(D.properties&&D.properties.semanticPattern===true&&Y(ht,P)){m(ht,function(t,a){if(ht[t].getType()==="Measure"&&(ht[t].getUid()==="valueAxis"||ht[t].getUid()==="actualValues")){var r;m(b,function(e,a){var i=L(a.Measure.$PropertyPath,Ee);if(i===ht[t].getValues()[0]){r=M(a,s);return false}});if(r){var i=L(r.Measure.$PropertyPath,Ee);var n=s[r.DataPoint.$AnnotationPath.substring(1)].ForecastValue.PropertyPath||s[r.DataPoint.$AnnotationPath.substring(1)].ForecastValue.Path;var o=L(n,Ee);var l=p.getText("ACTUAL",[i]);var u=p.getText("FORECAST",[o]);x.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:i},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:o},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:u}]};e.getDataset().addMeasure(new f({name:o,value:"{"+n+"}"}));var c=ht[t].getValues();c.push(o);ht[t].setValues(c)}return false}})}var Pt=false;if(we&&we.dimensionSettings&&Object.keys(we.dimensionSettings).length>0){var Et=Object.keys(we.dimensionSettings);for(var yt=0;yt<Et.length;yt++){var _t=Et[yt];var Ct=we.dimensionSettings[_t];if(Object.keys(Ct).length>10){Pt=true;break}}}if(Ke&&T.indexOf(d.ChartType.$EnumMember)>=0&&!Boolean(Pt)){var Tt=[];var Nt=true;for(var yt=0;yt<O.length;yt++){var It=O[yt].Dimension.$PropertyPath;Tt.push(It)}for(var yt=0;yt<Tt.length;yt++){var _t=Tt[yt];if(Et.indexOf(_t)>-1){var Rt=we.dimensionSettings[_t];var Dt=Object.keys(Rt);var Ot=[];for(var yt=0;yt<Dt.length;yt++){var bt=Rt[Dt[yt]];Ot.push(bt)}Nt=Nt&&Ot.every(Ce)}}if(Nt){var St=[];for(var yt=0;yt<Tt.length;yt++){var _t=Tt[yt];if(Et.indexOf(_t)>-1){var Rt=we.dimensionSettings[_t];var Dt=Object.keys(Rt);var Ot=[];for(var yt=0;yt<Dt.length;yt++){var bt=Rt[Dt[yt]];Ot.push(bt)}_e(Ot);for(var Mt=0;Mt<Ot.length;Mt++){var Vt=Ot[Mt].dimensionValue;var Lt=Ot[Mt].color;var bt={properties:{color:Lt}};bt.dataContext={};var Yt=oe(Ee,e,_t);bt.dataContext[Yt]=Vt;bt.displayName=Vt;St.push(bt)}}}x.plotArea.dataPointStyle=x.plotArea.dataPointStyle||{};x.plotArea.dataPointStyle["rules"]=St}else{var St=[];for(var yt=0;yt<Tt.length;yt++){var _t=Tt[yt];if(Et.indexOf(_t)>-1){var Rt=we.dimensionSettings[_t];var Dt=Object.keys(Rt);var Ot=[];for(var yt=0;yt<Dt.length;yt++){var bt=Rt[Dt[yt]];Ot.push(bt)}_e(Ot);var xt=Ot.map(Te)}}x.legend.order=function(e,t){var a=xt.indexOf(e);var r=xt.indexOf(t);return a>r?1:-1}}}if(D.properties&&D.properties.semanticPattern===true&&Y(ht,P)&&e.getVizType()==="vertical_bullet"){m(ht,function(t,a){if(ht[t].getType()==="Measure"&&(ht[t].getUid()==="valueAxis"||ht[t].getUid()==="actualValues")){var r;m(b,function(e,a){var i=L(a.Measure.PropertyPath,Ee);if(i===ht[t].getValues()[0]){r=V(a,s);return false}});if(r){var i=s[r.DataPoint.$AnnotationPath.substring(1)].TargetValue.PropertyPath||s[r.DataPoint.$AnnotationPath.substring(1)].TargetValue.Path;var n=L(i,Ee);e.getDataset().addMeasure(new f({name:n,value:"{"+i+"}"}));e.addFeed(new c({uid:"targetValues",type:"Measure",values:[n]}))}return false}})}if(ct&&vt){I.warning(p.getText("Currency_non_currency_measure"))}m(ht,function(e,t){var a=t.getProperty("type");if(a==="Measure"){var r=t.getProperty("values");var i=true;var n=d.MeasureAttributes.filter(function(e){var t=e[a].$PropertyPath;var i=Ee[t];return Object.keys(i).length>0&&r.indexOf(t)>=0});m(n,function(e,t){if(re(Ee,t,a)||ie(Ee,t,a)){i=false}else{i=true;return false}});if(!i){x[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var $t;if(ft===undefined){ft=""}if(ut===undefined){ut=""}if(ct){$t=ce(ft,ct)}else{$t=ce(ut,ct)}if(t){t.setScale($t)}fe(mt,At,r);var Ut="";m(ht,function(e,t){var a="-1";var r=t.getProperty("type");if(r==="Measure"){var i=gt.filter(function(e){var a=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(a.length>0){return true}else{return false}});if(i&&i.length){var n=t.getValues();if(n&&n.length){m(n,function(e,t){var i=t.trim();var n=b.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(Ee[t]&&Ee[t][E.LABEL_KEY]===i||Ee[t]&&Ee[t][E.LABEL_KEY_V4]===i){return true}else{return false}}});if(n&&n.length){var o=n[0];if(!re(Ee,o,r)&&!ie(Ee,o,r)){var l="";if(o&&o["DataPoint"]&&o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"]){l=o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"].substring(1);if(l!=""){var u;u=s[l]&&s[l]["ValueFormat"]&&s[l]["ValueFormat"]["NumberOfFractionalDigits"]&&s[l]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];a=u>a?u:a}}}else{a=a<"0"?"0":a}}})}}if(i&&i[0]&&i[0].label&&i[0].label.formatString){var o=i[0].label.formatString}Ut="";if(ct){if(o==="CURR"){Ut="CURR/"+a.toString()+"/"}else{Ut="axisFormatter/"+a.toString()+"/"}}else{Ut="axisFormatter/"+a.toString()+"/"}if(i&&i[0]){i[0].label.formatString=Ut}}});if(P==="vertical_bullet"){x["valueAxis"]={title:{visible:Me?false:true},label:{formatString:Ut}}}var Ft="";var Kt="";if(ct){Ft=lt.toString();Kt="CURR/"+lt.toString()+"/"}else{Ft=st.toString();Kt="axisFormatter/"+st.toString()+"/"}if(P==="donut"||h){x.plotArea.dataLabel.formatString=Kt;if(x.plotArea.dataLabel.type==="percentage"){x.plotArea.dataLabel.formatString="0.0%/"+Ft+"/"}}G(U,D,"dimension");G(F,D,"measure");if(z){var wt=O[0].Dimension.$PropertyPath;var Bt=e.getModel().getMetaModel().getObject("/"+Ae+"/"+wt+"@");if(Bt["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){x.timeAxis.levels=["year","month"]}else if(Bt["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){x.timeAxis.levels=["year","quarter"]}else if(Bt["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){x.timeAxis.levels=["year","week"]}else if(Bt["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){x.timeAxis.levels=["year"]}}e.setVizProperties(x)}function oe(e,t,a){var r="";if(e&&e[a]){if(e[a].annotations&&e[a].annotations["@"+E.LABEL_KEY_V4]){r=le(e[a].annotations["@"+E.LABEL_KEY_V4],t,e)}else if(e[a][E.LABEL_KEY]){r=e[a][E.LABEL_KEY]}else if(a){r=a}}return r}function se(e,t,a,r){if(e&&(e.getVizType()==="bubble"||e.getVizType()==="scatter")){return}var i,n,o,s;var l;var u=E.UNIT_KEY;var f="@"+E.UNIT_KEY_V4_ISOCurrency;var c="@"+E.UNIT_KEY_V4_Unit;var v;var g=[];if(!(i=e.getModel("ovpCardProperties"))){I.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return}var A=e.getModel();var d=i.getProperty("/entitySet");if(!A||!d){return}n=r[i.getProperty("/entityType").$Type];if(!n){I.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return}var h=ue(A,d);o=i.getProperty("/chartAnnotationPath");if(!o||!(s=n["@"+o])){I.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return}if(!(l=s.MeasureAttributes)||!l.length){I.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return}m(l,function(e,t){v=t.Measure.$PropertyPath;if(t.DataPoint&&t.DataPoint.$AnnotationPath){var a=n[t.DataPoint.$AnnotationPath.substring(1)];if(a&&a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){g.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path)}}g.push(v)});var P=t?t:null;var _="";var C=true;var T=[];var N=e.getFeeds();m(N,function(e,t){if(t.getType()==="Measure"){T=T.concat(t.getValues())}});if(P){m(g,function(t,a){var r=oe(h,e,a);if((T?Array.prototype.indexOf.call(T,r):-1)!=-1){if(h&&h[a]){var i;if(h[a].annotations[f]){i=h[a].annotations[f].$Path?h[a].annotations[f].$Path:h[a].annotations[f].$String}else if(h[a].annotations[c]){i=h[a].annotations[c].$Path?h[a].annotations[c].$Path:h[a].annotations[c].$String}else if(h[a][u]){i=h[a][u]}if(!i){C=false;return false}if(i&&h[i]){for(var t=0;t<P.length;t++){var n=P[t];if(C){if(_&&n[i]&&n[i]!=""&&_!=""&&_!=n[i]){C=false;break}}_=n[i];if(!_){C=false;break}}}}}})}var R="";if(C){if(_!=""){R=p.getText("IN_NO_SCALE",[_]);R=" "+R}if(a){a.setText(R);a.data("aria-label",R,true);var D=e.data("aria-label");if(D&&R&&D.indexOf(R)===-1){var O=D+R;e.data("aria-label",O,true)}}}}function le(e,t,a){var r;var i;var n;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){n=e.split(">");r=n[0];i=n[1]}else if(e.indexOf("&gt;")!=-1){n=e.split("&gt;");r=n[0];i=n[1]}try{e=t.getModel(r).getProperty(i)}catch(t){e=a[e][E.LABEL_KEY_V4].String;I.error("Unable to read labels from resource file",t)}}return e}function ue(t,a){var r=e.cacheODataMetadata(t);if(!r){return undefined}return r[a]}function fe(e,t,a){var r="",i="",n="";if(a){r=a.getText()}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=p.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=p.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(a&&r===""){r=p.getText("NO_CHART_TITLE",[i,n]);a.setText(r);a.data("aria-label",r,true)}}function ce(e,t){var a=1;var i;if(t){var n=r.getCurrencyInstance({style:"short",currencyCode:false,shortRefNumber:e});i=n.format(Number(a))}else{var o=r.getFloatInstance({style:"short",shortRefNumber:e});i=o.format(Number(a))}var s=i.slice(-1);return s}function ve(e,t){e.attachSelectData(function(r){var n=g.bCRTLPressed?g.constants.explace:g.constants.inplace;g.bCRTLPressed=false;var o=e.getModel("ovpCardProperties");var u=e.getModel();var f=o.getProperty("/entitySet");var c=ue(u,f);var v=[],p=[];var A={},d={};var h=e.getDataset().getDimensions();var P;var y=o.getProperty("/entityType");var _=t.getMetaModel().getData()["$Annotations"];for(var C=0;C<h.length;C++){v.push(h[C].getName())}var T=e.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(r.getParameter("data")&&r.getParameter("data")[0]&&r.getParameter("data")[0].data){p=Object.keys(r.getParameter("data")[0].data);P=r.getParameter("data")[0].data._context_row_number;var N=e.getDataset().getBinding("data").getContexts()[P];var I=t.getEntityNavigationEntries(N)[0];if(T[P].$isOthers&&T[P].$isOthers===true){var R={},D=[];for(var O=0;O<v.length;O++){for(var b=0;b<p.length;b++){if(v[O]===p[b]){for(var S in c){if(c.hasOwnProperty(S)){var M=c[S][E.LABEL_KEY]||c[S][E.NAME_KEY]||c[S][E.NAME_CAP_KEY];if(M===p[b]){D.push(S)}}}}}}for(var C=0;C<D.length;C++){R[D[C]]=[];for(var O=0;O<T.length-1;O++){if(O!=P){R[D[C]].push(T[O][D[C]])}}}var V={$isOthers:true};var L={getObject:function(){return V},getOtherNavigationDimensions:function(){return R}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(I){t.doNavigation(L,I,n)}}}else{for(var O=0;O<v.length;O++){for(var b=0;b<p.length;b++){if(v[O]===p[b]){for(var S in c){if(_[y.$Type+"/"+S]){var M=typeof _[y.$Type+"/"+S]["@"+E.LABEL_KEY_V4]==="string"&&_[y.$Type+"/"+S]["@"+E.LABEL_KEY_V4]||_[y.$Type+"/"+S][E.LABEL_KEY]||_[y.$Type+"/"+S][E.NAME_KEY]||_[y.$Type+"/"+S][E.NAME_CAP_KEY]||S;if(M.match(/{@i18n>.+}/gi)){var Y=this.getModel("@i18n").getResourceBundle();M=Y.getText(M.substring(M.indexOf(">")+1,M.length-1))}if(M===p[b]){A[S]=T[P][S]}}}}for(var S in T[P]){if(c.hasOwnProperty(S)){d[S]=T[P][S]}}}}if(A){m(Object.keys(A),function(e,t){var a=c[t]&&c[t]["annotations"];if(c[t]["$Type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearquarter"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearweek"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(c[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var r=A[t];if(r.includes(".")){A[t]=r.split(".").reverse().join("")}else if(r.includes("/")){A[t]=r.split("/").reverse().join("")}}}})}if(d){m(Object.keys(d),function(e,t){var a=c[t]&&c[t]["annotations"];if(c[t]["$Type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearquarter"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearweek"||a&&a["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(d[t]):d[t]}else if(c[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var r=d[t];if(r.includes(".")){d[t]=r.split(".").reverse().join("")}else if(r.includes("/")){d[t]=r.split("/").reverse().join("")}}}})}var x=y[o.getProperty("/presentationAnnotationPath")];if(y){var $=a.getRequestFields(x);if($&&$.length>0){m($,function(e,t){if(!A.hasOwnProperty(t)){A[t]=T[P][t]}})}}var L={getObject:function(){return A},getAllData:function(){return d}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(L)}}else{if(I){t.doNavigation(L,I,n)}}}}})}function pe(e){if(e.$EnumMember.endsWith("Bubble")){return true}else{return false}}function ge(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.$PropertyPath){I.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return t}t=true;return t}function me(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Measure||!e[0].Measure.$PropertyPath){I.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return t}t=true;return t}function Ae(e){e=e["$Type"];return e}function de(e){if(e&&e.indexOf("#")!=-1){var t=e.split("#");if(t.length>1){return t[1]}}return""}function he(e,t){var a=t.getModel("ovpCardProperties");var r=Pe(t);var i=+r.itemsLength;var n=+a.getProperty("/dataStep");if(i&&n){var o=e.colSpan-1;if(o>=0){i+=n*o;Ee(t,i)}}}function Pe(e){var t=e.getModel("ovpCardProperties");var a=t.getProperty("/entityType");var r=t.getProperty("/presentationAnnotationPath");var i=a.hasOwnProperty(r)&&a[r];var n=i&&i.MaxItems;if(typeof n==="number"||typeof n==="string"&&!isNaN(n)){var o=parseInt(n,10);return{itemsLength:+o,dataStep:+t.getProperty("/dataStep")}}}function Ee(e,t){var a,r={},i=[];var n=e.getVizType();var o=e.getModel("ovpCardProperties");var s=o.getProperty("/entityType");var l=o.getProperty("/chartAnnotationPath");var u=s[l];var f=e.getParent();var c=f.getBinding("data");r.path=c.getPath();r.parameters={};if(c.mParameters&&c.mParameters.select){r.parameters.select=c.mParameters.select}r.parameters.custom=r.parameters.custom||{};r.parameters.custom._requestFrom="ovp_internal";r.filters=c.aApplicationFilters;r.sorter=c.aSorters;r.length=n==="donut"?t+1:t;r.template=new v;f.bindAggregation("data",r);if(n==="donut"){m(u.MeasureAttributes,function(e,t){i.push(t.Measure.PropertyPath)});a={};a.path=c.getPath();a.parameters={};a.parameters.select=i.join(",");a.filters=c.aApplicationFilters;a.sorter=c.aSorters;a.length=1;a.template=new v;f.bindAggregation("aggregateData",a)}f.updateBindingContext()}function ye(e,t,a){var r=e.getMetaModel().getData().$Annotations;for(var i in t){if(r[a+"/"+i]&&!t[i]["annotations"]){t[i]["annotations"]=r[a+"/"+i]}}}function _e(e){e.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0})}function Ce(e){return e.color!==undefined}function Te(e){return e.dimensionValue}return{constants:E,errorMessages:y,formatItems:D,formatByType:x,returnDateFormat:$,hideDateTimeAxis:U,checkExists:F,validateCardConfiguration:K,checkNoData:w,getConfig:B,hasTimeSemantics:k,getChartType:H,getPrimitiveValue:z,formThePathForCriticalityStateCalculation:X,checkFlag:Z,buildVizAttributes:ne,setChartUoMTitle:se,getMetadata:ue,getSelectedDataPoint:ve,checkBubbleChart:pe,dimensionAttrCheck:ge,measureAttrCheck:me,getEntitySet:Ae,getAnnotationQualifier:de,reprioritizeContent:he,getMaxItems:Pe,getLabelFromAnnotationPath:le,formGroupByList:b}},true);
//# sourceMappingURL=VizAnnotationManager.js.map
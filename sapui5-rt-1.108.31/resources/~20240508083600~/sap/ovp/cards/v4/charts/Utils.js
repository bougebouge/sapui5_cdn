sap.ui.define(["sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/ovp/cards/v4/charts/config"],function(e,t,r,n){"use strict";var i={};var a={CHART_QUALIFIER_KEY:"chartAnnotationPath",SELVAR_QUALIFIER_KEY:"selectionAnnotationPath",PREVAR_QUALIFIER_KEY:"presentationAnnotationPath",ERROR_NO_CHART:'Analytic cards require valid "chartAnnotationPath" '+"configured in manifest.json",LABEL_KEY:"sap:label",TEXT_KEY:"sap:text",TYPE_KEY:"type"};var o={CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",CACHING_ERROR:"no model defined while caching OdataMetaData"};var u=new r("OVP.v4.charts.Utils");function s(e,t){if(!t){return""}var r=e.getSetting("ovpCardProperties");if(!r){return""}var n=r.oData;if(!n){return""}var i=n&&n[t]?n[t]:"";return i===""?"":i.split("#")[1]}i.getAllColumnTexts=function(e){return l("sap:text",e)};i.formDimensionPath=function(e){var t="{"+e+"}";var r=this.getModel("ovpCardProperties").getProperty("/entityType");if(!r){return t}var n=g(r);if(!n||!n[e]){return t}var a=n[e];if(a=="Edm.DateTime"){return"{path:'"+e+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}"}var o=i.getAllColumnTexts(r);if(!o){return t}t="{"+(o[e]||e)+"}";return t};function l(e,t){var r={};var n=t.property;for(var i=0,a=n.length;i<a;i++){if(n[i].hasOwnProperty(e)&&e=="com.sap.vocabularies.Common.v1.Label"){r[n[i].name]=n[i][e].String}else if(n[i].hasOwnProperty(e)){r[n[i].name]=n[i][e]}else{r[n[i].name]=n[i].name}}return r}function f(e){return l("com.sap.vocabularies.Common.v1.Label",e)}function g(e){return l("type",e)}var c={};i.LineChart=function(){function t(t,i,a){var o=r(t,a).split(",");var u=n(t,i).split(",");var s=[];e(o,function(e,t){s.push(t)});var l=[];e(u,function(e,t){l.push(t)});var f=true;var g=t.getSetting("ovpCardProperties").getProperty("/navigation");if(g=="chartNav"){f=false}var f=f?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{   visible:false,   text: '"+s.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, categoryAxis:{  title:{   visible:false,   text: '"+l.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, general: { groupData: false }, interaction:{  noninteractiveMode: "+f+",  selectability: {   legendSelection: false,   axisLabelSelection: false,   mode: 'EXCLUSIVE',   plotLassoSelection: false,   plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }"}t.requiresIContext=true;function r(t,r){var n=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!n){return""}var i=f(n);var a=[];e(r,function(e,t){a.push(i[t.Measure.PropertyPath]||t.Measure.PropertyPath)});return a.join(",")}r.requiresIContext=true;function n(t,r){var n=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!n){return""}var i=f(n);var o=[];var u;var l;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Category"){l=i[t.Dimension.PropertyPath];o.push(l?l:t.Dimension.PropertyPath)}});if(o.length<1){l=i[r[0].Dimension.PropertyPath];o.push(l?l:r[0].Dimension.PropertyPath)}u=s(t,a.CHART_QUALIFIER_KEY);c[u]=o;return o.join(",")}n.requiresIContext=true;function i(t,r){var n=[];var i;var o=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!o){return""}var u=f(o);var l;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Series"){l=u[t.Dimension.PropertyPath];n.push(l?l:t.Dimension.PropertyPath)}});i=s(t,a.CHART_QUALIFIER_KEY);n=n.filter(function(e){if(!c[i]){return true}return e!==c[i][0]});return n.join(",")}i.requiresIContext=true;function o(e,t){return i(e,t)!==""}o.requiresIContext=true;return{getVizProperties:t,getValueAxisFeed:r,getCategoryAxisFeed:n,getColorFeed:i,testColorFeed:o}}();i.BubbleChart=function(){function t(t,r,a){var o=n(t,a).split(",");var u=i(t,a).split(",");var s=[];e(o,function(e,t){s.push(t)});var l=[];e(u,function(e,t){l.push(t)});var f=true;var g=t.getSetting("ovpCardProperties").getProperty("/navigation");if(g=="chartNav"){f=false}var f=f?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{ visible:true, text: '"+s.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, valueAxis2:{  title:{ visible:true, text: '"+l.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, categoryAxis:{  title:{ visible:true  },  label:{ formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, interaction:{  noninteractiveMode: "+f+",  selectability: { legendSelection: false, axisLabelSelection: false, mode: 'EXCLUSIVE', plotLassoSelection: false, plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }"}t.requiresIContext=true;function r(t,r){var n;if(!t||!t.getSetting||!(n=t.getSetting("ovpCardProperties"))){return[""]}var i=n.getProperty("/entityType");if(!i){return[""]}var a=f(i);var o=[null,null,null];var u=["Axis1","Axis2","Axis3"];e(r,function(e,t){if(u.indexOf(t.Role.EnumMember.split("/")[1])>-1){if(o[0]===null){o[0]=a[t.Measure.PropertyPath]||t.Measure.PropertyPath}else if(o[1]===null){o[1]=a[t.Measure.PropertyPath]||t.Measure.PropertyPath}else if(o[2]==null){o[2]=a[t.Measure.PropertyPath]||t.Measure.PropertyPath}}});return o}r.requiresIContext=true;function n(e,t){return r(e,t)[0]}n.requiresIContext=true;function i(e,t){return r(e,t)[1]}i.requiresIContext=true;function a(e,t){return r(e,t)[2]}a.requiresIContext=true;function o(t,r){var n=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!n){return""}var i=f(n);var a=[];var o;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Series"){o=i[t.Dimension.PropertyPath];a.push(o?o:t.Dimension.PropertyPath)}});return a.join(",")}o.requiresIContext=true;function u(t,r){var n=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!n){return""}var i=f(n);var a=[];var o;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Category"){o=i[t.Dimension.PropertyPath];a.push(o?o:t.Dimension.PropertyPath)}});return a.join(",")}u.requiresIContext=true;function s(e,t){return o(e,t)!==""}s.requiresIContext=true;function l(e,t){return u(e,t)!==""}l.requiresIContext=true;return{getVizProperties:t,getMeasurePriorityList:r,getValueAxisFeed:n,getValueAxis2Feed:i,getBubbleWidthFeed:a,getColorFeed:o,getShapeFeed:u,testColorFeed:s,testShapeFeed:l}}();i.validateMeasuresDimensions=function(e,t){var r=null;var n=null;if(!e.getDataset()){u.error("OVP-AC: "+t+" Card Error: No Dataset defined for chart.");return false}r=e.getDataset().getMeasures();n=e.getDataset().getDimensions();switch(t){case"Bubble":if(r.length!==3||n.length<1||!r[0].getName()||!r[1].getName()||!r[2].getName()||!n[0].getName()){u.error("OVP-AC: Bubble Card Error: Enter exactly 3 measures and at least 1 dimension.");return false}break;case"Donut":if(r.length!==1||n.length!==1||!r[0].getName()||!n[0].getName()){u.error("OVP-AC: Donut Card Error: Enter exactly 1 measure and 1 dimension.");return false}break;case"Line":if(r.length<1||n.length<1||!r[0].getName()||!n[0].getName()){u.error("OVP-AC: Line Card Error: Configure at least 1 dimensions and 1 measure.");return false}break}return true};i.getSortAnnotationCollection=function(e,t,r){if(t&&t.SortOrder&&t.SortOrder.Path&&t.SortOrder.Path.indexOf("@")>=0){var n=t.SortOrder.Path.split("@")[1];var i=e.getServiceAnnotations()[r.entityType];return i[n]}return t.SortOrder};i.oFullConfig=null;i.getConfig=function(e){if(!this.oFullConfig){try{this.oFullConfig=t({},n.getChartsConfiguration())}catch(e){u.error(o.CONFIG_LOAD_ERROR+e)}}if(!e){return this.oFullConfig}var r;try{r=e.$EnumMember.split("/")[1]}catch(e){u.error(o.CARD_ERROR+o.INVALID_CHARTTYPE+o.ANNO_REF);return{}}if(!this.oFullConfig[r]){u.error(o.INVALID_CONFIG+r+" "+o.CONFIG_JSON);return{}}var i;if((i=this.oFullConfig[r].reference)&&this.oFullConfig[i]){var a=t({},this.oFullConfig[i]);this.oFullConfig[r]=a}return this.oFullConfig[r]};i.oCachedMetaModel={};i.cacheODataMetadata=function(t){if(!t){u.error(o.CARD_ERROR+o.CACHING_ERROR);return}var r=this.oCachedMetaModel[t.getId()];if(!r){r={};var n=t.getMetaModel();var i=n&&n.getObject("/");var a,s;e(i,function(t,i){if(t!="$kind"){a=n.getObject("/"+i.$Type);s={};e(a,function(e,t){if(t.$kind&&t.$kind=="Property"){s[e]=t}});r[t]=s}});this.oCachedMetaModel[t.getId()]=r}return r};i.checkIfDataExistInEvent=function(e){if(e&&e.getSource()&&e.getSource().getCurrentContexts()){var t=e.getSource().getCurrentContexts().some(function(e){return typeof e==="undefined"});return!t}return false};i.isDataSetEmpty=function(e){if(e&&e.getSource()&&e.getSource().getCurrentContexts()){return e.getSource().getCurrentContexts().length===0}};return i},true);
//# sourceMappingURL=Utils.js.map
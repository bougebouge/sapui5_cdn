sap.ui.define(["sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/core/mvc/ViewType","sap/base/util/merge","sap/ovp/app/OVPUtils","sap/ovp/cards/ovpLogger","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/mvc/XMLView","sap/ui/core/Core"],function(t,e,a,n,i,o,r,s,l,p,d,c){"use strict";return t.extend("sap.ovp.cards.v4.generic.Component",{metadata:{properties:{contentFragment:{type:"string"},controllerName:{type:"string",defaultValue:"sap.ovp.cards.v4.generic.Card"},headerExtensionFragment:{type:"string"},contentPosition:{type:"string",defaultValue:"Middle"},headerFragment:{type:"string",defaultValue:"sap.ovp.cards.v4.generic.Header"},footerFragment:{type:"string"},identificationAnnotationPath:{type:"string",defaultValue:"com.sap.vocabularies.UI.v1.Identification"},selectionAnnotationPath:{type:"string"},filters:{type:"object"},parameters:{type:"object"},addODataSelect:{type:"boolean",defaultValue:false},enableAddToInsight:{type:"boolean",defaultValue:false}},version:"1.108.11",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},setSelectionVariant:function(t,e){if(/^@/.test(t)){t=t.slice(1)}e.selectionAnnotationPath=t},setPresentationVariant:function(t,e,a){if(/^@/.test(t)){t=t.slice(1)}e.presentationAnnotationPath=t;var n=t.split("/");var i=n.length===1?a[t].Visualizations:a[n[0]][n[1]][n[2]].Visualizations;var o;for(o=0;o<i.length;o++){var r=i[o].AnnotationPath;if(r){if(/^@/.test(r)){r=r.slice(1)}if(/.LineItem/.test(r)){e.annotationPath=r;break}}}for(o=0;o<i.length;o++){var r=i[o].AnnotationPath;if(r){if(/^@/.test(r)){r=r.slice(1)}if(/.Chart/.test(r)){e.chartAnnotationPath=r;break}}}},setDataPointAnnotationPath:function(t,e){if(/^@/.test(t)){t=t.slice(1)}e.dataPointAnnotationPath=t},getCustomPreprocessor:function(){},getPreprocessors:function(t){var i=this.getComponentData(),o=i.settings,l=i.model,p,d,c,u;if(o.description&&!o.subTitle){o.subTitle=o.description}p=l&&l.getMetaModel();if(l&&l.getODataVersion){var v="/"+o.entitySet;var d=p.getObject(v);u=p.createBindingContext(v);if(d&&d["$Type"]){c=p.createBindingContext("/"+d["$Type"])}}else{if(o.entitySet){var f=p.getODataEntitySet(o.entitySet);var h=p.getODataEntitySet(o.entitySet,true);d=p.getODataEntityType(f.entityType);u=p.createBindingContext(h);c=p.createBindingContext(d.$path)}}var y=this._getCardPropertyDefaults();var g=this._completeLayoutDefaults(y,o);var m,P;if(i.appComponent&&i.appComponent.getModel("ui")&&i.appComponent.getModel("ui").oData){var C=i.appComponent.getModel("ui").oData;m=C.showDateInRelativeFormat;P=C.disableTableCardFlexibility}else{if(i.showDateInRelativeFormat){m=i.showDateInRelativeFormat}if(i.disableTableCardFlexibility){P=i.disableTableCardFlexibility}}var b={metaModel:p,entityType:d,webkitSupport:n.browser.webkit,layoutDetail:g&&g.cardLayout?g.cardLayout.containerLayout:"fixed",showDateInRelativeFormat:m,disableTableCardFlexibility:P,cardId:i.cardId};if(!!i&&!!i.cardId){var D=i.mainComponent;var V=null;if(!!D){V=D._getCardFromManifest(i.cardId)?D._getCardFromManifest(i.cardId).template:null}else{V=i.template}if(!!V){b.template=V}}y.densityStyle=a._setCardpropertyDensityAttribute();if(i.errorReason){var I=i.errorReason;var A=I.getParameters?I.getParameters():I.mParameters;var S="sap-icon://message-error";if(A&&A.response){y.errorStatusCode=A.response.statusCode;y.errorStatusText=A.response.statusText;y.responseText=A.response.responseText;y.sMessageIcon=A.response.sIcon?A.response.sIcon:S}}if(g){b.cardLayout=g.cardLayout}if(y.state!=="Error"){if(o&&o.kpiAnnotationPath){var T=d[o.kpiAnnotationPath];var M=y.contentFragment;if(T&&(M==="sap.ovp.cards.v4.charts.analytical.analyticalChart"||M==="sap.ovp.cards.v4.charts.smart.analyticalChart")){var x=T.SelectionVariant&&T.SelectionVariant.Path?T.SelectionVariant.Path:o.kpiAnnotationPath+"/SelectionVariant";if(x){this.setSelectionVariant(x,o)}var L=T.Detail&&T.Detail.DefaultPresentationVariant&&T.Detail.DefaultPresentationVariant.Path?T.Detail.DefaultPresentationVariant.Path:o.kpiAnnotationPath+"/Detail/DefaultPresentationVariant";if(L){this.setPresentationVariant(L,o,d)}var R=T.DataPoint&&T.DataPoint.Path?T.DataPoint.Path:o.kpiAnnotationPath+"/DataPoint";if(R){this.setDataPointAnnotationPath(R,o)}}}else if(o&&o.selectionPresentationAnnotationPath){var F=d[o.selectionPresentationAnnotationPath];if(F){var x=F.SelectionVariant&&F.SelectionVariant.Path;if(x){this.setSelectionVariant(x,o)}var L=F.PresentationVariant&&F.PresentationVariant.Path;if(L){this.setPresentationVariant(L,o,d)}}}}if(i.ovpCardsAsApi&&o.ignoreSelectionVariant){o.selectionAnnotationPath="";var B=[];for(var O=0;!!o.filters&&O<o.filters.length;O++){B.push({id:"headerFilterText--"+(O+1),index:O})}o.idForExternalFilters=B}if(!!b.entityType&&!!o.selectionAnnotationPath&&!!b.entityType[o.selectionAnnotationPath]){var w=b.entityType[o.selectionAnnotationPath].SelectOptions;for(var _=0;!!w&&_<w.length;_++){w[_].id="headerFilterText--"+(_+1)}b.entityType[o.selectionAnnotationPath].SelectOptions=w}if(b.template==="sap.ovp.cards.v4.linklist"&&!!o.staticContent){for(var k=0;k<o.staticContent.length;k++){o.staticContent[k].id="linkListItem--"+(k+1)}}else if(b.template==="sap.ovp.cards.v4.charts.analytical"){o.dataStep=o.dataStep?o.dataStep:10}y=s.merge(true,{},b,y,o);var U=new e(y);var E={xml:{bindingContexts:{entityType:c,entitySet:u},models:{device:a.deviceModel,entityType:p,entitySet:p,ovpMeta:p,ovpCardProperties:U,ovplibResourceBundle:t,ovpConstants:a.ovpConstantModel},ovpCardProperties:U,dataModel:l,_ovpCache:{}}};return r({},this.getCustomPreprocessor(),E)},_completeLayoutDefaults:function(t,e){var a={},n=this.getComponentData(),i=null,o=null;if(n.appComponent){i=n.appComponent.getOvpConfig()}if(!i){return null}if(i.containerLayout==="resizable"&&n.cardId&&t.contentFragment!=="sap.ovp.cards.quickview.Quickview"){o=n.appComponent.getDashboardLayoutUtil();var r=n.cardId;var s=o.aCards.filter(function(t){return t.id===r});a.cardLayout=s[0].dashboardLayout;a.cardLayout.containerLayout=i.containerLayout;a.cardLayout.iRowHeightPx=o.ROW_HEIGHT_PX;a.cardLayout.iCardBorderPx=o.CARD_BORDER_PX;a.cardLayout.headerHeight=s[0].dashboardLayout.headerHeight}return a},_getCardPropertyDefaults:function(){var t={};var e=this.getMetadata().getAllProperties();var a;for(var n in e){a=e[n];if(a.defaultValue!==undefined){t[a.name]=a.defaultValue}}return t},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var t=c.getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=t?new i({bundleUrl:t.oUrlInfo.url}):null}return this.ovplibResourceBundle},_getCacheKeys:function(){},createContent:function(){var t=this.getComponentData&&this.getComponentData();var e=t.model;var a;var n;var i=t&&t.mainComponent;var r=i&&i.oModelViewMap;var s=t&&t.modelName;var l=function(){if(e&&s){e.bIncludeInCurrentBatch=false;if(r&&s&&r[s]&&r[s][t.cardId]){delete r[s][t.cardId];if(Object.keys(r[s]).length>0){e.bIncludeInCurrentBatch=true}}}};if(t&&t.mainComponent){a=t.mainComponent._getOvplibResourceBundle()}else{a=this.getOvplibResourceBundle()}n=this.getPreprocessors(a);var p={preprocessors:n,type:o.XML,viewName:"sap.ovp.cards.v4.generic.Card"};var c=this._getCacheKeys();if(c&&c.length&&c.length>0){p.async=true;p.cache={keys:c}}var u=this._getCardPropertyDefaults().state;var v=t.cardId+(u?u:"Original");if(!u){v=v+(t.settings.selectedKey?"_Tab"+t.settings.selectedKey:"")}if(e&&e.bUseBatch&&!p.async){l()}var f=new d(t.containerId==="dialogCard"?undefined:v,p);if(p.async){var h=f.onControllerConnected;f.onControllerConnected=function(){if(e&&e.bUseBatch){l()}return h.apply(f,arguments)}}f.setModel(e);if(t.i18n){f.setModel(t.i18n,"@i18n")}f.setModel(n.xml.ovpCardProperties,"ovpCardProperties");f.setModel(a,"ovplibResourceBundle");return f}})});
//# sourceMappingURL=Component.js.map
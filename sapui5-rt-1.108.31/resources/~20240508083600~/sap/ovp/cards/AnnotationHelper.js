sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/AnnotationHelper","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/analytics/odata4analytics","sap/fe/navigation/SelectionVariant","sap/ovp/app/resources","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/security/encodeURL","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/FiscalFormat","sap/ui/core/library"],function(e,t,r,a,i,n,o,u,l,s,f,c,p,v,g,m,h,P,y,d){"use strict";var C={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var b={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var T={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var D={List_condensed:{phone:5,tablet:5,desktop:5},List_extended:{phone:3,tablet:3,desktop:3},List_condensed_bar:{phone:5,tablet:5,desktop:5},List_extended_bar:{phone:3,tablet:3,desktop:3},Table:{phone:5,tablet:5,desktop:5},Stack_simple:{phone:20,tablet:20,desktop:20},Stack_complex:{phone:5,tablet:5,desktop:5}};var O=new m("OVP.cards.AnnotationHelper");function I(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/showLabelText");if(a==="true"){var i=t.Address[0];if(typeof i.country!=="undefined"){return"{path:'"+i.country.Path+"'}"}else if(typeof i.locality!=="undefined"){return"{path:'"+i.locality.Path+"'}"}else if(typeof i.street!=="undefined"){return"{path:'"+i.street.Path+"'}"}else if(typeof i.code!=="undefined"){return"{path:'"+i.code.Path+"'}"}}else{return null}}I.requiresIContext=true;function F(e,t){if(!t){return""}if(t.Label){return t.Label.String}var r=e.getSetting&&e.getSetting("ovpCardProperties");var a=r&&r.getProperty("/metaModel");var i=r&&r.getProperty("/entityType");if(!a||!i){return""}var n;if(t.Value){n=t.Value.Path}if(t.Target){var o=B(i.$path,t);var u=o&&a.getProperty(o);n=u&&u.Value.Path}if(!n||!n.length>0||n===" "){return""}var l=a.getODataProperty(i,n);if(!l){return""}var s=l["sap:label"]||(l["com.sap.vocabularies.Common.v1.Label"]||"").String||"";return s}F.requiresIContext=true;function S(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}S.requiresContext=true;function V(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function N(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function x(e,t){var r;if(t){r=t.None;if(e&&e.EnumMember){var a=e.EnumMember;if(R(a,"Negative")){r=t.Negative}else if(R(a,"Critical")){r=t.Critical}else if(R(a,"Positive")){r=t.Positive}}}return r}function E(e){if(e=="Error"){e=1}else if(e=="Warning"){e=2}else if(e=="Success"){e=3}else{e=0}return e}function R(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function M(e,t,r,a,i,n,o){var u={};u.EnumMember="None";var l=Number.NEGATIVE_INFINITY;var s=Number.POSITIVE_INFINITY;if(!i&&i!==0&&(r||r===0)){i=r}if(!n&&n!==0&&(a||a===0)){n=a}if(!r&&r!==0){r=l}if(!a&&a!==0){a=s}if(e!==undefined){e=Number(e);if(R(t,"Minimize")||R(t,"Minimizing")){if((n||n===0)&&(a||a===0)){if(e<=parseFloat(n)){u.EnumMember="Positive"}else if(e>parseFloat(a)){u.EnumMember="Negative"}else{u.EnumMember="Critical"}}}else if(R(t,"Maximize")||R(t,"Maximizing")){if((i||i===0)&&(r||r===0)){if(e>=parseFloat(i)){u.EnumMember="Positive"}else if(e<parseFloat(r)){u.EnumMember="Negative"}else{u.EnumMember="Critical"}}}else if(R(t,"Target")){if((n||n===0)&&(a||a===0)&&(i||i===0)&&(r||r===0)){if(e>=parseFloat(i)&&e<=parseFloat(n)){u.EnumMember="Positive"}else if(e<parseFloat(r)||e>parseFloat(a)){u.EnumMember="Negative"}else{u.EnumMember="Critical"}}}}return x(u,o)}function A(e,t,r,a){if(!e||!t){return}e=Number(e);if(!a&&e-t>=0){return"Up"}if(!r&&e-t<=0){return"Down"}if(t&&a&&e-t>=a){return"Up"}if(t&&r&&e-t<=r){return"Down"}}function U(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=V(e,r);if(!a){var i=q(e,t);var n=i.map(function(e){return e.Value.Path});n=n.filter(function(e){return!!e});a=t.filter(function(e){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&n.indexOf(e.Value.Path)===-1){return true}return false});a=H(a);N(e,r,a)}return a}U.requiresIContext=true;function q(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=V(e,a);if(!i){if(r){i=t.filter(w)}else{i=t.filter(_)}i=H(i);var n;for(var o=0;o<i.length;o++){n=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[o]=e.getModel(0).getProperty(B(n,i[o]));n=""}N(e,a,i)}return i}q.requiresIContext=true;function _(e){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true}return false}function w(e){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)){return true}return false}function L(e){if(!e||!e.Criticality||!e.Criticality.Path){return}return"{path:'"+e.Criticality.Path+"'}"}function B(e,t){if(e&&!R(e,"/")){e+="/"}return e+t.Target.AnnotationPath.slice(1)}function k(e){var t,r;if(e["com.sap.vocabularies.UI.v1.Importance"]){t=e["com.sap.vocabularies.UI.v1.Importance"].EnumMember;switch(t){case"com.sap.vocabularies.UI.v1.ImportanceType/High":r=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":r=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":r=3;break}}else{r=4}return r}function H(e){if(e.length<2){return e}var t=parseInt(e.length/2,10);var r=e.slice(0,t);var a=e.slice(t,e.length);return j(H(r),H(a))}function j(e,t){var r=[];while(e.length&&t.length){var a=k(e[0]),i=k(t[0]);if(a<=i){r.push(e.shift())}else{r.push(t.shift())}}while(e.length){r.push(e.shift())}while(t.length){r.push(t.shift())}return r}function Y(e,t,r){var a=U(e,t)[r];if(a){return $(e,a)}return""}function G(e,t,r){var a=U(e,t)[r];return F(e,a)}function X(e,t,r){var a=q(e,t)[r];if(a&&a.Title){return a.Title.String}return""}function z(e,t,r){var a=t.filter(_);a=H(a);if(!a||!a.length||!a.length>0){return""}return F(e,a[0])}function J(e,t,r,a){var i=q(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return K(e,i,o,u,a)}function Q(e,t,r){var a=q(e,t)[r];if(a&&a.Criticality){return true}}function W(e,t,r){var a=q(e,t)[r];var i=a.Criticality.Path;return"{path:'"+i+"'}"}function K(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var u=n.getProperty("/ignoreSapText");o=u==undefined?o:u}var l=a.getODataProperty(r,t.Value.Path);var s=false;if(o==true){if(l&&(l["com.sap.vocabularies.Analytics.v1.Measure"]||l["sap:aggregation-role"]=="measure")){s=true}}if(!s&&l){var f;if(l[b.TEXT]){f=l[b.TEXT].String?l[b.TEXT].String:l[b.TEXT].Path}else if(l["sap:text"]){f=l["sap:text"]}if(f){l=a.getODataProperty(r,f);t={Value:{Path:l.name}}}}return $(e,t,i)}function $(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return ee(e,t,o,u,r,i)}$.requiresIContext=true;function Z(e,t,r,i){if(!r||typeof i!=="string"){return i}var n=r[b.TEXT]||r["sap:text"];if(!n){return i}var o,u;o=r[b.TEXT_ARRANGEMENT];u=o&&o.EnumMember;if(!u){o=n&&n[b.TEXT_ARRANGEMENT];u=o&&o.EnumMember}if(!u){o=t&&t[b.TEXT_ARRANGEMENT];u=o&&o.EnumMember}var l;if(typeof n==="object"){l=a.format(e,n)}else{l=a.format(e,{Path:n})}if(!l||l===" "){return i}if(!u){return i+" ("+l+")"}var s;switch(u){case T.TEXT_FIRST:s=l+" ("+i+")";break;case T.TEXT_LAST:s=i+" ("+l+")";break;case T.TEXT_ONLY:s=l;break;case T.TEXT_SEPARATE:s=i+" ("+l+")";break;default:s=i;break}return s}function ee(e,t,r,i,n,o,u){if(t.Value.Apply){return a.format(e,t.Value)}var l=t.Value.Path?t.Value.Path:t.Value.String;var s=i.getODataProperty(r,l),f="",c,p;var v=e.getSetting("ovpCardProperties");var g=v&&v.getProperty("/contentFragment");if(!o){if(t.Value.Path&&t.Value.Path.split("/").length>1){s=oe(i,r,t.Value.Path)}if(!s){return""}if(s["type"]==="Edm.DateTime"||s["type"]==="Edm.DateTimeOffset"){var m={relative:true,relativeScale:"auto"},h=v&&v.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}c="sap.ovp.cards.AnnotationHelper.formatDate";p={dateFormat:m,bUTC:s["type"]==="Edm.DateTime"?true:false,functionName:c};f=re([t.Value.Path?t.Value.Path:s.name],c,p)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits||s["scale"]){var P=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits?t.ValueFormat.NumberOfFractionalDigits.Int:0,y;var d=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.Decimal;if(s[b.ISO_CURRENCY]){y=s[b.ISO_CURRENCY].Path?s[b.ISO_CURRENCY].Path:s[b.ISO_CURRENCY].String}else if(s[b.UOM]){y=s[b.UOM].Path?s[b.UOM].Path:s[b.UOM].String}else if(s["sap:unit"]){y=s["sap:unit"]}var C=y?i.getODataProperty(r,y):null,T=[t.Value.Path?t.Value.Path:s.name];if(P>2){P=2}p={numberOfFractionalDigits:P,scaleFactor:d};if(s[b.ISO_CURRENCY]){var D=s[b.ISO_CURRENCY];if(D.Path){c="sap.ovp.cards.AnnotationHelper.formatCurrency";T.push(D.Path)}else if(D.String){p.currencyString=D.String;c="sap.ovp.cards.AnnotationHelper.formatCurrency"}}else if(C&&(C[b.ISO_CURRENCY]||C["sap:semantics"]==="currency-code")){c="sap.ovp.cards.AnnotationHelper.formatCurrency";T.push(y)}else{c="sap.ovp.cards.AnnotationHelper.formatNumberCalculation"}p.functionName=c;f=re(T,c,p)}else{if(u){f=a.simplePath(e,t.Value)}else{var O=a.format(e.getModel()?e:e.getInterface(0),t.Value);var I=O.split(",");var F=[];if(I.length>1){for(var S=0;S<I.length;S++){if(I[S].indexOf("path:")>=0||I[S].indexOf("type:")>=0){F.push(I[S])}}if(F.length>0){f=f+F.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=O}}}if(g){f=Z(e,r,s,f)}if(s&&s[b.UOM]){var V=s[b.UOM];if(V.Path){f+=" "+re([V.Path]);f+=" "+te(V.Path,i,r)}else if(V.String){if(V.String!=="%"){f+=" "}f+=V.String}}}if(!n){if(s[b.ISO_CURRENCY]){var D=s[b.ISO_CURRENCY];if(D){if(D.Path){f+=" "+re([D.Path]);f+=" "+te(D.Path,i,r)}else if(D.String){f+=" "+D.String}}}}if(f[0]===" "){f=f.substring(1)}return f}function te(e,t,r){if(e){var a,i,n;if(e.split("/").length>1){a=oe(t,r,e);i=Pe(t,r,e)}else{a=t.getODataProperty(r,e)}if(a){n=a[b.TEXT]&&a[b.TEXT].Path||a["sap:text"]}if(n&&i){n=i+"/"+n}if(n){return" ({"+n+"})"}return""}}function re(e,t,r){var a="",i=e.length;if(i>1||r){a="{parts:[";for(var n=0;n<i;n++){a+="{path: '"+e[n]+"'}"+(n===i-1&&!r?"]":", ")}if(r){var o="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";a+=o+"]"}}else{a="{path: '"+e[0]+"'"}a+=(t?", formatter: '"+t+"'":"")+"}";return a}function ae(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});return a.format(Number(r))}function ie(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ne(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getCurrencyInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function oe(e,t,r){var a=r.split("/");if(a.length>1){for(var i=0;i<a.length-1;i++){var n=e.getODataAssociationEnd(t,a[i]);if(n){t=e.getODataEntityType(n.type)}}return e.getODataProperty(t,a[a.length-1])}}function ue(e,t,r){var a=q(e,t);var i=C.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return ce(e,n,i)}return ve(e,n,i)}function le(e,t,r){var a=q(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function se(e,t,r){if(le(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}se.requiresIContext=true;function fe(e,t,r){var a=q(e,t),i=C.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=ce(e,o,i)}else{n=ve(e,o,i)}}return n}function ce(e,t,r){var i=r.None;var n;var o=t.Criticality;if(o){n="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(o.Path){var u="$"+a.simplePath(e,o);i=s(n,u)}else if(o.EnumMember){var l="'"+o.EnumMember+"'";i=s(n,l)}else{O.warning("Case not supported, returning the default Neutral state")}}else{O.warning("Case not supported, returning the default Neutral state")}return i}function pe(e,t,r){var a=q(e,t);var i="None";if(a.length>r){var n=a[r];if(n&&n.Criticality&&n.Criticality.Path){i=W(e,t,r)}else{i=ve(e,n,C.StateValues);i=E(i)}}return i}function ve(e,t,r){var a=r.None;if(t.Criticality){a=x(t.Criticality,r)}else if(t.CriticalityCalculation&&t.Value&&t.Value&&t.Value.Path){a=ge(e,t,r)}return a}function ge(e,t,r){var a=Re(t.Value);var i=t.CriticalityCalculation.ImprovementDirection.EnumMember;var n=Re(t.CriticalityCalculation.DeviationRangeLowValue);var o=Re(t.CriticalityCalculation.DeviationRangeHighValue);var u=Re(t.CriticalityCalculation.ToleranceRangeLowValue);var l=Re(t.CriticalityCalculation.ToleranceRangeHighValue);var s=he(n);var f=he(o);var c=he(u);var p=he(l);var v="sap.ovp.cards.AnnotationHelper.formatColor";var g={deviationLow:n,deviationHigh:o,toleranceLow:u,toleranceHigh:l,bIsDeviationLowBinding:s,bIsDeviationHighBinding:f,bIsToleranceLowBinding:c,bIsToleranceHighBinding:p,sImprovementDirection:i,oCriticalityConfigValues:r,functionName:v};var m="{value:"+JSON.stringify(g)+", model: 'ovpCardProperties'}";var h="parts: ["+a;h+=s?","+n:"";h+=f?","+o:"";h+=c?","+u:"";h+=p?","+l:"";h+=","+m;h+="]";return"{"+h+", formatter: '"+v+"'}"}function me(){var e=arguments[arguments.length-1];var t=1;return M(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues)}function he(e){return typeof e==="string"&&e.charAt(0)==="{"}function Pe(e,t,r){var a="";var i=r.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(a){a=a+"/"}a=a+i[n]}else{return a}}}return a}function ye(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function de(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/addODataSelect");var i=r.getProperty("/metaModel");var n=i.getODataEntityType(t.entityType);var o=n[r.getProperty("/selectionAnnotationPath")];var u=n[r.getProperty("/presentationAnnotationPath")];var l="/"+t.name;var s=Array.prototype.slice.call(arguments,2);var f=e.getSetting("ovpCardProperties"),c=f.getProperty("/parameters");if(o||!!c){if(o&&o.Parameters&&o.Parameters.length>0||!!c){l=xt(e.getSetting("dataModel"),t,o,c)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var p="{path: '"+l+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var p="{path: '"+l+"', length: "+Me(r)}var v=[];if(a){v=be(e,i,n,s);var g=r.getProperty("/template");if(g!="sap.ovp.cards.charts.analytical"&&g!="sap.ovp.cards.charts.smart.chart"){var m=Oe(u);for(var h=0;h<m.length;h++){if(v.indexOf(m[h])===-1){v.push(m[h])}}}}var P=Ce(i,n,s);var y=ye(r);var d=false;if(y||v.length>0||P.length>0){p=p+", parameters: {"}if(v.length>0||P.length>0){if(v.length>0){p=p+"select: '"+v.join(",")+"'";d=true}if(P.length>0){if(v.length>0){p=p+", "}p=p+"expand: '"+P.join(",")+"'";d=true}if(y){p=p+", "}}if(y){p=p+"custom: {cardId: '"+r.getProperty("/cardId")+"'"+", _requestFrom: 'ovp_internal'}";d=false}else if(!p.includes(", parameters: {")){p=p+", parameters: {custom: {_requestFrom: 'ovp_internal'}}";d=false}else if(d){p=p+", custom: {_requestFrom: 'ovp_internal'}"}if(y||v.length>0||P.length>0){p=p+"}"}var C=De(r,u);if(C.length>0){p=p+", sorter:"+JSON.stringify(C)}var b=Ve(r,o);if(b.length>0){p=p+", filters:"+JSON.stringify(b)}p=p+"}";return p}de.requiresIContext=true;function Ce(e,t,r){var a=[];var i,n,o,u;for(var l=0;l<r.length;l++){if(!r[l]){continue}i=t.$path+"/"+r[l];n=e.createBindingContext(i);o=n.getObject();o=o?o:[];for(var s=0;s<o.length;s++){if(o[s].Value&&o[s].Value.Path){u=Pe(e,t,o[s].Value.Path);if(u&&a.indexOf(u)===-1){a.push(u)}var f=e.getODataProperty(t,o[s].Value.Path);if(f){var c;if(f[b.UOM]){c=f[b.UOM].Path}else if(f[b.ISO_CURRENCY]){c=f[b.ISO_CURRENCY].Path}else if(f[b.TEXT]){c=f[b.TEXT].Path}if(c&&c.split("/").length>1){u=Pe(e,t,c);if(u&&a.indexOf(u)===-1){a.push(u)}}else{var p=e.getODataProperty(t,c);if(p){var v=p[b.TEXT]&&p[b.TEXT].Path;if(v&&v.split("/").length>1){u=Pe(e,t,v);if(u&&a.indexOf(u)===-1){a.push(u)}}}}}}}}return a}function be(e,t,i,n){var o=[];var u,l,s;for(var c=0;c<n.length;c++){if(!n[c]){continue}u=i.$path+"/"+n[c];l=t.createBindingContext(u);var p={};if(e&&e.bDummyContext){g(p,e,l,true)}else{p=e}s=l.getObject();if(!s){s=[]}else if(f(s)){if(s.Data){s=s.Data}else{s=[]}}var v;var m;var h;var P;for(var y=0;y<s.length;y++){m=[];v=s[y];h="";P=v.RecordType;if(P==="com.sap.vocabularies.UI.v1.DataField"){h=ee(p,v,i,t,undefined,undefined,true)}else if(P==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var d=B(i.$path,v);h=K(p,t.getProperty(d),i,t);var C=L(t.getProperty(d));if(C&&C.length>0){h+=C}}else if(P==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&v.Url){var b;if(!v.Url.UrlRef){b=a.format(p,v.Url)}if(b&&b.substring(0,2)==="{="){h=b}}if(h){var T=a.simplePath(p,v.Value);if(h.indexOf("(")<0&&h!==T){h=[].concat(T,h).join(" ")}m=Te(h)}if(m&&m.length>0){var D;for(var O=0;O<m.length;O++){D=m[O];if(!o[D]){o[D]=true;var I=r.getUnitColumn(D,i);if(I&&I!==D){o[I]=true}var F=ir(t,i,D);if(F&&F!==D){o[F]=true}}}}}}return Object.keys(o)}function Te(e){var t,r=0,a=e.length,i="",n;for(t=0;t<a;t++){n=e.charAt(t);if(!n){return}switch(n){case"{":r++;break;case"}":r--;break;default:if(r<=0){continue}break}i+=n}e=i;var o=/\${([a-zA-Z0-9\_|\/]*)/g;var u=/[^[{]*[a-zA-Z0-9\_]/g;var l=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s,f,c=[];if(e.indexOf("{parts:[")!==-1){e=e.replace("{parts:[","");e=e.replace("]","");e=e.replace(e.lastIndexOf("}",""))}if(e.substring(0,2)==="{="){s=o;f=1}else if(e.indexOf("path")!==-1){if(e.indexOf("{value")>0){var p=0;var t=e.indexOf("{value")+5;var v;while(t<a){if(e[t]==="}"&&p===0){v=t;break}if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1}t++}e=e.slice(0,e.indexOf("{value"))+e.slice(v)}if(e.indexOf("constraints:{")!==-1){var p=0;var t=e.indexOf("constraints:{")+12;var v;while(t<a){if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1;if(p===0){v=t;break}}t++}e=e.slice(0,e.indexOf("constraints:{")-1)+e.slice(v+1)}var g=u.exec(e);while(g){if(g[0].indexOf("path")===-1&&g[0].indexOf("@i18n")!==0&&g[0].indexOf("model: 'ovpCardProperties'")<=-1){c.push(g[0])}g=u.exec(e)}s=l;f=1}else{s=u;f=0}var m=s.exec(e);while(m){if(m[f]&&m[f].indexOf("@i18n")!==0){c.push(m[f])}m=s.exec(e)}return c}function De(e,t){var r=[];var a,i;var n=e.getProperty("/sortBy");if(n){var o=e.getProperty("/sortOrder");if(o&&o.toLowerCase()!=="descending"){i=false}else{i=true}a={path:n,descending:i};r.push(a)}var u=t&&t.SortOrder||undefined;var l,n;if(u){for(var s=0;s<u.length;s++){l=u[s];n=l.Property.PropertyPath;i=Ne(l.Descending,true);a={path:n,descending:i};r.push(a)}}return r}function Oe(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function Ie(e){var t=e.getProperty("/entityType");var r=t[e.getProperty("/selectionAnnotationPath")];return{filters:Ve(e,r),parameters:Se(r)}}function Fe(e){if(!e){return}var t=e.getProperty("/entityType");var r=t[e.getProperty("/presentationAnnotationPath")];var a=De(e,r);var i=[];var n,o=a.length;for(n=0;n<o;n++){if(!a[n].path){continue}i.push({Property:a[n].path,Descending:a[n].descending})}if(i.length>0){return{SortOrder:i}}}function Se(e){var t,r=[];if(!e||!e.Parameters){return r}var a=e.Parameters.length;for(var i=0;i<a;i++){t=e.Parameters[i];if(!t.PropertyName||!t.PropertyName.PropertyPath){continue}if(!t.PropertyValue){O.error("Missing value for parameter "+t.PropertyName.PropertyPath);continue}r[r.length]={path:t.PropertyName.PropertyPath,value:Ee(t.PropertyValue)}}return r}function Ve(e,t){var r=[];var a;var n=e.getProperty("/filters");if(n){r=r.concat(n)}if(t&&t.SelectOptions){a=t.SelectOptions}else{a=t}var o,u,l;if(a){for(var s=0;s<a.length;s++){o=a[s];u=o.PropertyName.PropertyPath;for(var f=0;f<o.Ranges.length;f++){l=o.Ranges[f];if(l.Sign.EnumMember){var c={path:u,operator:l.Option.EnumMember.split("/")[1],value1:Ee(l.Low),value2:Ee(l.High),sign:l.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(c.sign==="E"&&c.operator!==i.EQ){O.error("Exclude sign is supported only with EQ operator");continue}if(c.sign==="E"&&c.operator===i.EQ){c.operator=i.NE;c.sign="I"}if(c.operator==="CP"&&c.sign==="I"){var p=i.Contains;var v=c.value1;if(v){var g=v.indexOf("*");var m=v.lastIndexOf("*");if(g>-1){if(g===0&&m!==v.length-1){p=i.EndsWith;v=v.substring(1,v.length)}else if(g!==0&&m===v.length-1){p=i.StartsWith;v=v.substring(0,v.length-1)}else{v=v.substring(1,v.length-1)}}}c.operator=p;c.value1=v}r.push(c)}}}}return r}function Ne(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function xe(e){var t;if(e){if(e.String){t=Number(e.String)}else if(e.Int){t=Number(e.Int)}else if(e.Decimal){t=Number(e.Decimal)}else if(e.Double){t=Number(e.Double)}else if(e.Single){t=Number(e.Single)}}return t}function Ee(e){var t;if(e){if(e.String||e.String===""){t=e.String}else if(e.Boolean||e.Bool){t=Ne(e)}else if(e.DateTime){t=e.DateTime}else if(e.DateTimeOffset){t=e.DateTimeOffset}else{t=xe(e)}}return t}function Re(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return Ee(e)}}else{return""}}function Me(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=D["List_extended_bar"]}else{i=D["List_extended"]}}else if(a=="bar"){i=D["List_condensed_bar"]}else{i=D["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=D["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=D["Stack_complex"]}else{i=D["Stack_simple"]}}if(i){return i[o]}return 5}function Ae(e){var t=e.getObject();var r=q(e,t,true);var a=r.map(function(e){if(e&&e.Value&&e.Value.Path){return e.Value.Path}else if(e&&e.fn&&e.fn.Path){return e.fn.Path}});t.filter(function(e,r){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataField"&&a.indexOf(e.Value.Path)>-1){t.splice(r,1)}})}Ae.requiresIContext=true;function Ue(e,t){if(t.charAt(0)==="/"||t.indexOf("http")===0){return t}var r=e.getModel(0).getProperty("/baseUrl");if(r){return r+"/"+t}return t}Ue.requiresIContext=true;function qe(e,t){var r=q(e,t);return r.length}qe.requiresIContext=true;function _e(e,t){return Le(e,t,0)}_e.requiresIContext=true;function we(e,t){return Le(e,t,1)}we.requiresIContext=true;function Le(e,t,r){var a=q(e,t),i=a[r];if(i&&i.Value&&i.Value.Path){return i.Value.Path}return""}function Be(e,t){return G(e,t,0)}Be.requiresIContext=true;function ke(e,t){return G(e,t,1)}ke.requiresIContext=true;function He(e,t){return G(e,t,2)}He.requiresIContext=true;function je(e,t){return G(e,t,3)}je.requiresIContext=true;function Ye(e,t){return G(e,t,4)}Ye.requiresIContext=true;function Ge(e,t,r){return Y(e,t,r)}Ge.requiresIContext=true;function Xe(e,t,r){return J(e,t,r)}Xe.requiresIContext=true;function ze(e,t,r,a){var i=qe(e,t);if(i>0){return Xe(e,t,r)}else{return Ge(e,t,a)}}ze.requiresIContext=true;function Je(e,t,r){return mt(e,t,r)}Je.requiresIContext=true;function Qe(e,t){return X(e,t,0)}Qe.requiresIContext=true;function We(e,t){return X(e,t,1)}We.requiresIContext=true;function Ke(e,t){return X(e,t,2)}Ke.requiresIContext=true;function $e(e,t){return z(e,t,0)}$e.requiresIContext=true;function Ze(e,t){for(var r=0;r<t.length;r++){var i=t[r];if(i.RecordType==="com.sap.vocabularies.UI.v1.DataField"){if(i.IconUrl&&i.IconUrl.String){return i.IconUrl.String}if(i.IconUrl&&i.IconUrl.Path){return a.simplePath(e,i.IconUrl)}}}}Ze.requiresIContext=true;function et(e,t,r){var a="";var i;if(Array.isArray(t)){i=q(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=vt(o,n)}if(!i||!i.Value){return a}var u=e.getSetting("ovpCardProperties");var l=u&&u.getProperty("/entityType");var s=u&&u.getProperty("/metaModel");var f=s&&s.getODataProperty(l,i.Value.Path);var c=f&&f[b.ISO_CURRENCY];if(c){if(c.Path){a+=" "+re([c.Path]);a+=" "+te(c.Path,s,l)}else if(c.String){a+=" "+c.String}}return a}et.requiresIContext=true;function tt(e,t,r,a){return J(e,t,r,a)}tt.requiresIContext=true;function rt(e,t){return ue(e,t,0)}rt.requiresIContext=true;function at(e,t){return fe(e,t,0)}at.requiresIContext=true;function it(e,t){return ue(e,t,1)}it.requiresIContext=true;function nt(e,t){return ue(e,t,2)}nt.requiresIContext=true;function ot(e,t){return pe(e,t,0)}ot.requiresIContext=true;function ut(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return x(t,C.ColorValues)}function lt(e,t){if(t&&t.Criticality&&t.Criticality.Path){return"{parts: [{path:'"+t.Criticality.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.kpiValueCriticality'}"}else{return ve(e,t,C.ColorValues)}}lt.requiresIContext=true;function st(e,t){return Q(e,t,0)}st.requiresIContext=true;function ft(e,t){var r=q(e,t)[0];if(r&&(r.Criticality||r.CriticalityCalculation)){return true}return false}ft.requiresIContext=true;function ct(e,t){return Q(e,t,1)}ct.requiresIContext=true;function pt(e,t){return Q(e,t,2)}pt.requiresIContext=true;function vt(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=B(a,t);t=e.getModel(0).getProperty(i);return t}function gt(e,t){if(!t){return""}return $(e,t)}gt.requiresIContext=true;function mt(e,t,r,i){var n;var o=i==undefined?r:U(e,r)[i];var u=e.getSetting("ovpCardProperties");var l=u.getProperty("/metaModel");var s=l.getODataEntityType(t.entityType);var f=s.property;if(f){for(var c=0;c<f.length;c++){if(o.Value.Path===f[c].name){n=f[c]["com.sap.vocabularies.Common.v1.SemanticObject"];if(n){return a.format(e,n)}else{return""}}}}}function ht(e,t,r){var a=r===undefined?t.Value.Path:t[r].Value.Path;var i=a.indexOf("/")!=-1?a.split("/")[0]:"";return i}ht.requiresIContext=true;function Pt(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=a.getODataEntityType(t.entityType);if(i["com.sap.vocabularies.Communication.v1.Contact"]){return true}return false}Pt.requiresIContext=true;function yt(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var u=Object.assign({},e);t=vt(u,o);return K(e,t,i,n,r)}yt.requiresIContext=true;function dt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=C.StateValues;t=vt(a,r);if(t&&t.Criticality){i=ce(e,t,n)}else{i=ve(e,t,n)}return i}dt.requiresIContext=true;function Ct(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=vt(a,r);if(t&&t.Criticality){return true}}Ct.requiresIContext=true;function bt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");t=vt(a,r);if(!t){return}var u=o.getODataProperty(n,t.Value.Path);if(t&&u&&u.type=="Edm.String"&&(t.Criticality||t.CriticalityCalculation)){return"Center"}if(u&&(u.type=="Edm.DateTime"||u.type=="Edm.DateTimeOffset")){return"Right"}}bt.requiresIContext=true;function Tt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=vt(a,r);var i="None";if(t&&t.Criticality&&t.Criticality.Path){i="{path:'"+t.Criticality.Path+"'}"}else{i=ve(e,t,C.StateValues);i=E(i)}return i}Tt.requiresIContext=true;function Dt(e,t){var r;for(var a=0;a<t.length;a++){r=t[a];if(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1}}return 0}Dt.requiresIContext=true;function Ot(e,t){var r=q(e,t)[0];if(r&&r.Value&&r.Value.Path){var a=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var i=e.getModel(0);var n=i.getProperty(a);var o=i.getODataProperty(n,r.Value.Path);if(o&&o[b.UOM]){return o[b.UOM].String==="%"}}return false}Ot.requiresIContext=true;function It(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i=a.getODataEntitySet(r.getProperty("/entitySet"));var n=a.getODataEntityType(i.entityType);t=n.$path+"/"+t;return a.createBindingContext(t)}function Ft(e,t){if(e==="Edm.String"){var r=t.PropertyValue.String;return r}return t.PropertyValue.String}function St(e,t){return e.filter(function(e){if(e.name===t){return e}})}function Vt(e,t,r,a){var i="";var n=[];if(a&&a.Parameters){e.parameters.forEach(function(r){a.Parameters.forEach(function(a){var i=a.PropertyName.PropertyPath.split("/");i=i[i.length-1];if(i===r){var o=Ft(e["parameterType"][r],a);o=v(t.formatValue(o,e["parameterType"][r]));n.push(i+"="+o)}})});var o=a.Parameters.map(function(e){return e&&e.PropertyName&&e.PropertyName.PropertyPath});var u=p.getParametersByEntitySet(t,r.name);if(u.entitySetName){var l=p.getPropertyOfEntitySet(t,u.entitySetName);var s=u.parameters.filter(function(e){return!o.includes(e)});for(var f=0;f<s.length;f++){var c=s[f].split("/");var g=c[c.length-1];var m=St(l,g);var h=false;if(m.length>0){var P=m[0];h=P.type==="Edm.String"&&P["sap:parameter"]==="optional"}if(h){n.push(g+"="+"")}}}}else{i="/"+r.name;O.error("SelectionParameters","There are no parameters to resolve");return i}try{i="/"+e.entitySetName+"("+n.join(",")+")/"+e.navPropertyName}catch(e){i="/"+r.name;O.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return i}function Nt(e,t,r,a,i,n){var l=[];var s="";var f=new o.Model(o.Model.ReferenceByModel(e));var v=f.findQueryResultByName(t.name);var g=new o.QueryResultRequest(v);var m=v.getParameterization();if(!m){s="/"+t.name;return n?l:s}if(i){var h=i.getAnalyticalParameters()}if(m){var P;g.setParameterizationRequest(new o.ParameterizationRequest(m));if(r&&r.Parameters){c(r.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){P=this.PropertyNameFrom.PropertyPath.split("/");g.getParameterizationRequest().setParameterValue(P[P.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String)}else{P=this.PropertyName.PropertyPath.split("/");g.getParameterizationRequest().setParameterValue(P[P.length-1],this.PropertyValue.String)}});var y=r.Parameters.map(function(e){return e&&e.PropertyName&&e.PropertyName.PropertyPath});var d=p.getParametersByEntitySet(e,t.name);if(d.entitySetName){var C=p.getPropertyOfEntitySet(e,d.entitySetName);var b=d.parameters.filter(function(e){return!y.includes(e)});for(var T=0;T<b.length;T++){P=b[T].split("/");var D=P[P.length-1];var I=St(C,D);var F=false;if(I.length>0){var S=I[0];F=S.type==="Edm.String"&&S["sap:parameter"]==="optional";l.push(S)}if(F){g.getParameterizationRequest().setParameterValue(D,"")}}}}else if(a&&a.length>0){c(a,function(){g.getParameterizationRequest().setParameterValue(this.path,this.value)})}else if(h&&h.length>0){var V=i&&i.getUiState({allFilters:false});var N=V?JSON.stringify(V.getSelectionVariant()):"{}";var r=new u(N);for(var x in m.getAllParameters()){for(var T=0;T<h.length;T++){if(h[T]&&h[T].name==x){var E=h[T].name;var R=r.getParameter(E);if(!R){var M=r.getSelectOption(E);R=M&&M[0]&&M[0].Low}g.getParameterizationRequest().setParameterValue(x,R)}}}}else{s="/"+t.name;O.error("SelectionParameters","There are no parameters to resolve");return n?l:s}}try{s=g.getURIToQueryResultEntitySet()}catch(e){v=g.getQueryResult();s="/"+v.getEntitySet().getQName();O.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return n?l:s}function xt(e,t,r,a,i){var n="";if(p.checkAnalyticalParameterisedEntitySet(e,t.name)){n=Nt(e,t,r,a,i)}else{var o=p.getParametersByEntitySet(e,t.name);var u=p.getPropertyOfEntitySet(e,t.name);var l={};if(o){o["parameters"].forEach(function(e){u.forEach(function(t){if(t["name"]==e){l[e]=t["type"]}})});o["parameterType"]=l;n=Vt(o,e,t,r)}else{n="/"+t.name}}return n}function Et(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function Rt(e,t){var r=e.filter(function(e){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataField"){return true}return false});var a=H(r);if(a){return a[t]}return}function Mt(e,t,r){if(!r||!r.length||r.length===0){return false}r=Rt(r,0);return mt(e,t,r)}Mt.requiresIContext=true;function At(e,t,r){if(!r||!r.length||r.length===0){return false}r=Rt(r,1);return mt(e,t,r)}At.requiresIContext=true;function Ut(e,t){var r=e.filter(function(e){if(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1){return true}return false});var a=H(r);if(a){return a[t]}return}function qt(e){if(!e||!e.length||e.length===0){return false}var t=Ut(e,0);if(t){return true}return false}function _t(e,t,a,i){var n,o,u;if(a&&a.Value&&a.Value.Path){n=a.Value.Path}else if(a&&a.Description&&a.Description.Value&&a.Description.Value.Path){n=a.Description.Value.Path}if(a&&a.Description&&a.Description.Path){o=a.Description.Path}else if(a&&a.Title&&a.Title.Path){u=a.Title.Path}var l="";var s=i&&i.Parameters;var f="";var c=e.getSetting("ovpCardProperties"),p=c.getProperty("/parameters");s=s||!!p;if(s){var v=e.getSetting("dataModel");var g=xt(v,t,i,p);l+="{path: '"+g+"'"}else{l+="{path: '/"+t.name+"'"}l+=", length: 1";var m=e.getSetting("ovpCardProperties");var h=m.getProperty("/entityType");var P=r.getUnitColumn(n,h);var y=Ve(m,i);if(y.length>0){f+=", filters: "+JSON.stringify(y)}var d=[];d.push(n);if(o){d.push(o)}else if(u){d.push(u)}if(a&&a.Criticality&&a.Criticality.Path){d.push(a.Criticality.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeLowValue&&a.CriticalityCalculation.DeviationRangeLowValue.Path){d.push(a.CriticalityCalculation.DeviationRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeLowValue&&a.CriticalityCalculation.ToleranceRangeLowValue.Path){d.push(a.CriticalityCalculation.ToleranceRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeHighValue&&a.CriticalityCalculation.DeviationRangeHighValue.Path){d.push(a.CriticalityCalculation.DeviationRangeHighValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeHighValue&&a.CriticalityCalculation.ToleranceRangeHighValue.Path){d.push(a.CriticalityCalculation.ToleranceRangeHighValue.Path)}if(P){d.push(P)}if(a&&a.TrendCalculation&&a.TrendCalculation.ReferenceValue&&a.TrendCalculation.ReferenceValue.Path){d.push(a.TrendCalculation.ReferenceValue.Path)}var C=ye(c);var b=C?", custom: {cardId: '"+c.getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}":", custom: {_requestFrom: 'ovp_internal'}";return l+", parameters:{select:'"+d.join(",")+"'"+b+"}"+f+"}"}_t.requiresIContext=true;function wt(e){if(!e||!e.Value||!e.Value.Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");var i=a.getODataProperty(r,e.Value.Path);if(i[b.UOM]){var n=i[b.UOM];if(n.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true}}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits&&e.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits.Int}var o={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var u="sap.ovp.cards.AnnotationHelper.KpiValueFormatter";var l=[e.Value.Path];return re(l,u,o)}function Lt(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function Bt(e,t){if(!t||!t.Value||!t.Value.Path||!t.TrendCalculation){return""}var r=Re(t.Value);var a=Re(t.TrendCalculation.ReferenceValue);var i=Re(t.TrendCalculation.DownDifference);var n=Re(t.TrendCalculation.UpDifference);var o=he(a);var u=he(i);var l=he(n);var s={referenceValue:a,downDifference:i,upDifference:n,bIsRefValBinding:o,bIsDownDiffBinding:u,bIsUpDiffBinding:l};var f="{value:"+JSON.stringify(s)+", model: 'ovpCardProperties'}";var c="parts: ["+r;c+=o?","+a:"";c+=u?","+i:"";c+=l?","+n:"";c+=","+f;c+="]";var p="sap.ovp.cards.AnnotationHelper.formatTrendIcon";return"{"+c+", formatter: '"+p+"'}"}Bt.requiresIContext=true;function kt(){var e=arguments[arguments.length-1];var t=1;return A(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)}function Ht(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits&&e.ValueFormat.NumberOfFractionalDigits.Int){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits.Int}if(e.TrendCalculation.ReferenceValue.Path){return"{parts: [{path:'"+e.Value.Path+"'}, {path:'"+e.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}else{return"{parts: [{path:'"+e.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}}function jt(t,r){var a,i,n,o,u=false;if(isNaN(+t)){return""}if(t==0){o=r}else{o=t}i=this.getModel("ovpCardProperties");if(i.getProperty("/iNumberOfFractionalDigits")){n=+i.getProperty("/iNumberOfFractionalDigits")}if(i.getProperty("/bPercentageAvailableForTarget")){u=true}if(r){a=r}else{if(i.getProperty("/sManifestTargetValue")){a=i.getProperty("/sManifestTargetValue")}}if(!n||n<0){n=0}else if(n>2){n=2}if(a){var l=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(u){return l.format(+a)+" %"}else{return l.format(+a)}}}function Yt(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(!e||!e.Value||!e.Value.Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits&&e.ValueFormat.NumberOfFractionalDigits.Int){t.setProperty("/iNumberOfFractionalDigits",e.ValueFormat.NumberOfFractionalDigits.Int)}if(e.TrendCalculation.ReferenceValue){if(e.TrendCalculation.ReferenceValue.String){t.setProperty("/sManifestTargetValue",e.TrendCalculation.ReferenceValue.String);return"{parts: [{path:'"+e.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}if(e.TrendCalculation.ReferenceValue.Path){var i=a.getODataProperty(r,e.TrendCalculation.ReferenceValue.Path);if(i[b.UOM]){var n=i[b.UOM];if(n.String=="%"){t.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+e.Value.Path+"'},{path:'"+e.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}}}function Gt(t,r){var a,i,n;if(isNaN(+t)){return""}t=+t;n=this.getModel("ovpCardProperties");if(n.getProperty("/iNumberOfFractionalDigits")){a=+n.getProperty("/iNumberOfFractionalDigits")}if(r){i=+r}else{if(n.getProperty("/sManifestTargetValue")){i=+n.getProperty("/sManifestTargetValue")}}if(!a||a<0){a=0}else if(a>2){a=2}if(i){var o=(t-i)/i;var u=e.getPercentInstance({style:"short",minFractionDigits:a,maxFractionDigits:a,showScale:true});return u.format(o)}}function Xt(e){if(e&&e.GroupBy&&!h(e.GroupBy)&&e.GroupBy[0].hasOwnProperty("PropertyPath")){return true}else{return false}}function zt(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function Jt(e,t){return zt(e,t)}function Qt(e,t){var r=zt(e,t);return r?r:l.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function Wt(e){var t="";var r=e&&e.GroupBy;if(!r){return t}var a=this.getModel("ovpCardProperties").getProperty("/metaModel");var i=this.getModel("ovpCardProperties").getProperty("/entityType");var n;if(e.GroupBy.constructor===Array){n=e.GroupBy}else if(!e.GroupBy.Collection){return t}else{n=e.GroupBy.Collection}var o;c(n,function(){o=ar(a,i,this.PropertyPath);if(!o){return}t+=o;t+=", "});if(t[t.length-1]===" "&&t[t.length-2]===","){t=t.substring(0,t.length-2)}return t==""?"":l.getText("By",[t])}function Kt(e,t,r){var a=true;var i=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][i].PropertyName.PropertyPath){a=false}t=[t];var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");var l=Ve(n,t);if(l.length==0){return""}var s;var f;s=l[0].path;f=ir(u,o,s);if(f!==s){return""}var c=u.getODataProperty(o,t[0].PropertyName.PropertyPath)["type"];var p=tr(l,c);if(a===true){return p+", "}return p}Kt.requiresIContext=true;function $t(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var u=n.getODataProperty(o,r[t.index].path)["type"];var l=tr([r[t.index]],u);if(a===true){return l+", "}return l}$t.requiresIContext=true;function Zt(e){return e.id}function er(e){return e.id}function tr(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(rr(e[a],t))}return r.join(", ")}function rr(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=l.getText("kpiHeader_Filter_NotOperator",[i])}return i}function ar(e,t,r){return nr(e,t,r,"com.sap.vocabularies.Common.v1.Label")}function ir(e,t,r){return nr(e,t,r,"sap:text")}function nr(e,t,r,a){var i=e.getODataProperty(t,r);if(!i){O.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}var n=i[a];if(n){if(a==="com.sap.vocabularies.Common.v1.Label"){return n.String}return n}return i.name}function or(e){if(!e||!e.Value||!e.Value.Path){return""}var t={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var r="sap.ovp.cards.AnnotationHelper.KpiValueFormatter";var a=[e.Value.Path];return re(a,r,t)}function ur(e,t){if(t.hasOwnProperty(e)){return true}return false}function lr(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function sr(e){if(e){return undefined}return"_BASIC"}function fr(e,t){if(t==="com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"){var r=e.substring(0,4);var a=e.substring(4);while(a.length<3){a="0"+a}var i=P.oDateFormats[t];var n={UTC:false,style:"medium"};var o=y.getDateInstance(Object.assign({format:i,calendarType:d.CalendarType.Gregorian},n));var u=o.getPattern();if(u==="PPP/YYYY"){return a+"/"+r}else if(u==="PPP.YYYY"){return a+"."+r}else{return a+r}}else{return e}}return{getFormattedFiscalData:fr,getGroupID:sr,getConditionTypeForDateProperties:lr,isDateRangeType:ur,criticalityConstants:C,TextArrangementType:T,getLabelForDataItem:F,colorPaletteForComparisonMicroChart:se,formatField:$,checkFilterPreference:ye,formatItems:de,getCardSelections:Ie,getCardSorters:Fe,getFilters:Ve,getPrimitiveValue:Ee,getAnnotationLabel:Jt,getApplicationName:Qt,removeDuplicateDataField:Ae,formatUrl:Ue,getDataPointsCount:qe,getFirstDataPointValue:_e,getFirstDataFieldName:Be,getSecondDataFieldName:ke,getRequestFields:Oe,getThirdDataFieldName:He,formatDataFieldValueOnIndex:Ge,formatDataPointValueOnIndex:Xe,formatDataPointOrField:ze,formatsemanticObjectOfDataFieldGeneric:Je,getLabelForFirstDataPoint:$e,formatImageUrl:Ze,formatUnit:et,formatObjectNumber:tt,formatFirstDataPointState:rt,formatFirstDataPointColor:at,formatSecondDataPointState:it,formatThirdDataPointState:nt,formatFirstDataPointStateForSmartField:ot,formatKPIHeaderState:lt,isFirstDataPointCriticality:st,isFirstDataPointCriticalityForTableStatus:ft,getSortedDataFields:U,getSortedDataPoints:q,formatDataFieldValueGeneric:gt,formatDataPointValue:yt,formatDataPointStateGeneric:dt,checkCriticalityGeneric:Ct,checkCriticalityGenericForTableStatus:bt,formatDataPointStateForSmartFieldGeneric:Tt,hasActions:Dt,isFirstDataPointPercentageUnit:Ot,resolveEntityTypePath:It,resolveParameterizedEntitySet:xt,getAssociationObject:Et,semanticObjectOfFirstDataField:Mt,semanticObjectOfSecondDataField:At,isFirstContactAnnotation:qt,getAggregateNumber:_t,KpiValueFormatter:Lt,kpiValueCriticality:ut,formThePathForAggregateNumber:wt,formThePathForTrendIcon:Bt,formPathForPercentageChange:Ht,TargetValueFormatter:jt,formPathForTargetValue:Yt,returnPercentageChange:Gt,isPresentationVarientPresent:Xt,listGroupBy:Wt,formTheFilterByString:Kt,formTheFilterByStringNotFromSelVar:$t,formTheIdForFilter:Zt,formTheIdForFilterNotFromSelVar:er,_criticality2state:x,_calculateCriticalityState:M,_calculateTrendDirection:A,_getPropertiesFromBindingString:Te,sortCollectionByImportance:H,checkNavTargetForContactAnno:ht,checkForContactAnnotation:Pt,getKPIHeaderAggregateNumber:or,formatColor:me,formatTrendIcon:kt,formatNumberCalculation:ae,formatCurrency:ne,formatDate:ie,getSapTextPathForUOM:te,resolveAnalyticalParameterizedEntitySet:Nt}},true);
//# sourceMappingURL=AnnotationHelper.js.map
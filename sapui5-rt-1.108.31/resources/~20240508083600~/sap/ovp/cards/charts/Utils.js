sap.ui.define(["sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/ovp/cards/charts/config"],function(e,t,r,a){"use strict";var i={};var n={CHART_QUALIFIER_KEY:"chartAnnotationPath",SELVAR_QUALIFIER_KEY:"selectionAnnotationPath",PREVAR_QUALIFIER_KEY:"presentationAnnotationPath",ERROR_NO_CHART:'Analytic cards require valid "chartAnnotationPath" '+"configured in manifest.json",LABEL_KEY:"sap:label",TEXT_KEY:"sap:text",TYPE_KEY:"type"};var o={CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",CACHING_ERROR:"no model defined while caching OdataMetaData"};var s=new r("OVP.charts.Utils");function u(e,t){if(!t){return""}var r=e.getSetting("ovpCardProperties");if(!r){return""}var a=r.oData;if(!a){return""}var i=a&&a[t]?a[t]:"";return i===""?"":i.split("#")[1]}i.getAllColumnTexts=function(e){return l("sap:text",e)};i.formDimensionPath=function(e){var t="{"+e+"}";var r=this.getModel("ovpCardProperties").getProperty("/entityType");if(!r){return t}var a=f(r);if(!a||!a[e]){return t}var n=a[e];if(n=="Edm.DateTime"){return"{path:'"+e+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}"}var o=i.getAllColumnTexts(r);if(!o){return t}t="{"+(o[e]||e)+"}";return t};function l(e,t){var r={};var a=t.property;for(var i=0,n=a.length;i<n;i++){if(a[i].hasOwnProperty(e)&&e=="com.sap.vocabularies.Common.v1.Label"){r[a[i].name]=a[i][e].String}else if(a[i].hasOwnProperty(e)){r[a[i].name]=a[i][e]}else{r[a[i].name]=a[i].name}}return r}function p(e){return l("com.sap.vocabularies.Common.v1.Label",e)}function f(e){return l("type",e)}var c={};i.LineChart=function(){function t(t,i,n){var o=r(t,n).split(",");var s=a(t,i).split(",");var u=[];e(o,function(e,t){u.push(t)});var l=[];e(s,function(e,t){l.push(t)});var p=true;var f=t.getSetting("ovpCardProperties").getProperty("/navigation");if(f=="chartNav"){p=false}var p=p?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{   visible:false,   text: '"+u.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, categoryAxis:{  title:{   visible:false,   text: '"+l.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, general: { groupData: false }, interaction:{  noninteractiveMode: "+p+",  selectability: {   legendSelection: false,   axisLabelSelection: false,   mode: 'EXCLUSIVE',   plotLassoSelection: false,   plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }"}t.requiresIContext=true;function r(t,r){var a=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!a){return""}var i=p(a);var n=[];e(r,function(e,t){n.push(i[t.Measure.PropertyPath]||t.Measure.PropertyPath)});return n.join(",")}r.requiresIContext=true;function a(t,r){var a=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!a){return""}var i=p(a);var o=[];var s;var l;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Category"){l=i[t.Dimension.PropertyPath];o.push(l?l:t.Dimension.PropertyPath)}});if(o.length<1){l=i[r[0].Dimension.PropertyPath];o.push(l?l:r[0].Dimension.PropertyPath)}s=u(t,n.CHART_QUALIFIER_KEY);c[s]=o;return o.join(",")}a.requiresIContext=true;function i(t,r){var a=[];var i;var o=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!o){return""}var s=p(o);var l;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Series"){l=s[t.Dimension.PropertyPath];a.push(l?l:t.Dimension.PropertyPath)}});i=u(t,n.CHART_QUALIFIER_KEY);a=a.filter(function(e){if(!c[i]){return true}return e!==c[i][0]});return a.join(",")}i.requiresIContext=true;function o(e,t){return i(e,t)!==""}o.requiresIContext=true;return{getVizProperties:t,getValueAxisFeed:r,getCategoryAxisFeed:a,getColorFeed:i,testColorFeed:o}}();i.BubbleChart=function(){function t(t,r,n){var o=a(t,n).split(",");var s=i(t,n).split(",");var u=[];e(o,function(e,t){u.push(t)});var l=[];e(s,function(e,t){l.push(t)});var p=true;var f=t.getSetting("ovpCardProperties").getProperty("/navigation");if(f=="chartNav"){p=false}var p=p?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{ visible:true, text: '"+u.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, valueAxis2:{  title:{ visible:true, text: '"+l.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, categoryAxis:{  title:{ visible:true  },  label:{ formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, interaction:{  noninteractiveMode: "+p+",  selectability: { legendSelection: false, axisLabelSelection: false, mode: 'EXCLUSIVE', plotLassoSelection: false, plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }"}t.requiresIContext=true;function r(t,r){var a;if(!t||!t.getSetting||!(a=t.getSetting("ovpCardProperties"))){return[""]}var i=a.getProperty("/entityType");if(!i){return[""]}var n=p(i);var o=[null,null,null];var s=["Axis1","Axis2","Axis3"];e(r,function(e,t){if(s.indexOf(t.Role.EnumMember.split("/")[1])>-1){if(o[0]===null){o[0]=n[t.Measure.PropertyPath]||t.Measure.PropertyPath}else if(o[1]===null){o[1]=n[t.Measure.PropertyPath]||t.Measure.PropertyPath}else if(o[2]==null){o[2]=n[t.Measure.PropertyPath]||t.Measure.PropertyPath}}});return o}r.requiresIContext=true;function a(e,t){return r(e,t)[0]}a.requiresIContext=true;function i(e,t){return r(e,t)[1]}i.requiresIContext=true;function n(e,t){return r(e,t)[2]}n.requiresIContext=true;function o(t,r){var a=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!a){return""}var i=p(a);var n=[];var o;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Series"){o=i[t.Dimension.PropertyPath];n.push(o?o:t.Dimension.PropertyPath)}});return n.join(",")}o.requiresIContext=true;function s(t,r){var a=t.getSetting("ovpCardProperties").getProperty("/entityType");if(!a){return""}var i=p(a);var n=[];var o;e(r,function(e,t){if(t.Role.EnumMember.split("/")[1]==="Category"){o=i[t.Dimension.PropertyPath];n.push(o?o:t.Dimension.PropertyPath)}});return n.join(",")}s.requiresIContext=true;function u(e,t){return o(e,t)!==""}u.requiresIContext=true;function l(e,t){return s(e,t)!==""}l.requiresIContext=true;return{getVizProperties:t,getMeasurePriorityList:r,getValueAxisFeed:a,getValueAxis2Feed:i,getBubbleWidthFeed:n,getColorFeed:o,getShapeFeed:s,testColorFeed:u,testShapeFeed:l}}();i.validateMeasuresDimensions=function(e,t){var r=null;var a=null;if(!e.getDataset()){s.error("OVP-AC: "+t+" Card Error: No Dataset defined for chart.");return false}r=e.getDataset().getMeasures();a=e.getDataset().getDimensions();switch(t){case"Bubble":if(r.length!==3||a.length<1||!r[0].getName()||!r[1].getName()||!r[2].getName()||!a[0].getName()){s.error("OVP-AC: Bubble Card Error: Enter exactly 3 measures and at least 1 dimension.");return false}break;case"Donut":if(r.length!==1||a.length!==1||!r[0].getName()||!a[0].getName()){s.error("OVP-AC: Donut Card Error: Enter exactly 1 measure and 1 dimension.");return false}break;case"Line":if(r.length<1||a.length<1||!r[0].getName()||!a[0].getName()){s.error("OVP-AC: Line Card Error: Configure at least 1 dimensions and 1 measure.");return false}break}return true};i.getSortAnnotationCollection=function(e,t,r){if(t&&t.SortOrder&&t.SortOrder.Path&&t.SortOrder.Path.indexOf("@")>=0){var a=t.SortOrder.Path.split("@")[1];var i=e.getServiceAnnotations()[r.entityType];return i[a]}return t.SortOrder};i.oFullConfig=null;i.getConfig=function(e){if(!this.oFullConfig){try{this.oFullConfig=a.getChartsConfiguration()}catch(e){s.error(o.CONFIG_LOAD_ERROR+e)}}if(!e){return this.oFullConfig}var r;try{r=e.EnumMember.split("/")[1]}catch(e){s.error(o.CARD_ERROR+o.INVALID_CHARTTYPE+o.ANNO_REF);return{}}if(!this.oFullConfig[r]){s.error(o.INVALID_CONFIG+r+" "+o.CONFIG_JSON);return{}}var i;if((i=this.oFullConfig[r].reference)&&this.oFullConfig[i]){var n=t({},this.oFullConfig[i]);this.oFullConfig[r]=n}return this.oFullConfig[r]};i.oCachedMetaModel={};i.cacheODataMetadata=function(t){if(!t){s.error(o.CARD_ERROR+o.CACHING_ERROR);return}var r=this.oCachedMetaModel[t.getId()];if(!r){r={};var a=t.getMetaModel();var i=a&&a.getODataEntityContainer();var n,u;e(i.entitySet,function(t,i){n=a.getODataEntityType(i.entityType);u={};e(n.property,function(e,t){u[t.name]=t});r[i.name]=u});this.oCachedMetaModel[t.getId()]=r}return r};i.getSemanticProperties=function(t){var r={aTimeAxisProperties:[],oTimeAxisPropertiesAndSemantics:{},propertyType:""};if(t){var a=Object.keys(t);if(a&&a.length){e(a,function(e,a){if(t[a]["type"]==="Edm.String"){if(t[a]["sap:semantics"]==="yearmonth"||t[a]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){r.aTimeAxisProperties.push(a);r.oTimeAxisPropertiesAndSemantics[a]={"sap:semantics":"yearmonth"};r.propertyType="yearmonth"}else if(t[a]["sap:semantics"]==="yearquarter"||t[a]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){r.aTimeAxisProperties.push(a);r.oTimeAxisPropertiesAndSemantics[a]={"sap:semantics":"yearquarter"};r.propertyType="yearquarter"}else if(t[a]["sap:semantics"]==="yearweek"||t[a]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){r.aTimeAxisProperties.push(a);r.oTimeAxisPropertiesAndSemantics[a]={"sap:semantics":"yearweek"};r.propertyType="yearweek"}else if(t[a]["sap:semantics"]==="fiscalyearperiod"||t[a]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){r.aTimeAxisProperties.push(a);r.oTimeAxisPropertiesAndSemantics[a]={"sap:semantics":"fiscalyearperiod"}}}})}}return r};i.isDataSetEmpty=function(e){if(e&&e.getSource()&&e.getSource().getCurrentContexts()){return e.getSource().getCurrentContexts().length===0}};return i},true);
//# sourceMappingURL=Utils.js.map
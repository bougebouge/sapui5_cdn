sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ovp/cards/Integration/Helpers/AnalyticalCard"],function(jQuery,e,t,r,a,i,n,o,s,l,u,f,c,v,p,m,g,A,d,P,h){"use strict";var E={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var C={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var _=["year","yearweek","yearmonth","yearquarter"];var y=[E.COLUMNSTACKED_CHARTTYPE,E.DONUT_CHARTTYPE,E.COLUMN_CHARTTYPE,E.BAR_CHARTTYPE,E.VERTICALBULLET_CHARTTYPE,E.LINE_CHARTTYPE,E.COMBINATION_CHARTTYPE,E.BUBBLE_CHARTTYPE];var T=[E.COLUMNSTACKED_CHARTTYPE];var I;var N=new d("OVP.charts.VizAnnotationManager");function R(a,i,n,o,s,l,u){var f="{";if(!a||!a.getSetting("ovpCardProperties")){N.error(C.ANALYTICAL_CONFIG_ERROR);f+="}";return f}var c=a.getSetting("dataModel");var v;if(u&&u.EnumMember){v=u.EnumMember.split("/");if(v&&v[1]==="Donut"){c.setDefaultCountMode(t.Inline)}if(v&&v[1]!="Donut"&&s===undefined){return null}}var p=[];var m=[];var d=[];var P=[];var h=[];var _=[];var y=[];var T=n&&n.Parameters;var I=o&&o.SortOrder;var R=o&&o.MaxItems,S=null;var O;var M;var L;var V=null;var Y=E.TEXT_KEY;var x=E.TEXT_KEY_V4;var U=E.UNIT_KEY;var F=E.UNIT_KEY_V4_ISOCurrency;var K=E.UNIT_KEY_V4_Unit;var k={};if(R){S=R.Int32?R.Int32:R.Int}if(S){if(S==="0"){N.error("OVP-AC: Analytic card Error: maxItems is configured as "+S);f+="}";return f}if(!/^\d+$/.test(S)){N.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");f+="}";return f}}var H=a.getSetting("ovpCardProperties"),z=H.getProperty("/parameters"),G=H.getProperty("/metaModel");T=T||!!z;if(T){var j=r.resolveParameterizedEntitySet(c,i,n,z);f+="path: '"+j+"'"}else{f+="path: '/"+i.name+"'"}var W=[];V=a.getSetting("ovpCardProperties").getProperty("/entitySet");if(!c||!V){return f}var X=se(c,V);var q=a.getSetting("ovpCardProperties").getProperty("/cardLayout");var Q=1,Z;var J=B();var $;var ee;if(s&&q&&q.colSpan&&q.colSpan>1){Z=q.colSpan-Q;for(var te in J){if((ee=J[te].reference)&&J[ee]){var re=A({},J[ee]);J[te]=re}if(te===v[1]||J[te].time&&J[te].time.type===v[1].toLowerCase()){$=J[te];break}}var ae=w(s,$,c,V);if(ae){$=$.time}else{$=$.default}var ie=a.getSetting("ovpCardProperties").getProperty("/dataStep");if(!ie){if($.resize&&$.resize.hasOwnProperty("dataStep")&&!isNaN($.resize.dataStep)){ie=$.resize.dataStep}}ie=parseInt(ie,10);if(Z>0&&ie&&!isNaN(ie)){S=parseInt(S,10)+ie*Z}}if(n){var H=a.getSetting("ovpCardProperties");W=r.getFilters(H,n)}if(W.length>0){f+=", filters: "+JSON.stringify(W)}if(I){var ne=o.SortOrder;if(!ne.length){ne=e.getSortAnnotationCollection(c,o,i)}if(ne.length<1){N.warning(C.CARD_WARNING+C.SORTORDER_WARNING)}else{var oe="";var le;var ue;var fe;for(var ce=0;ce<ne.length;ce++){le=ne[ce];fe=le.Property.PropertyPath;y.push(fe);if(typeof le.Descending==="undefined"){ue="true"}else{var ve=le.Descending.Bool||le.Descending.Boolean;if(!ve){N.warning(C.CARD_WARNING+C.BOOLEAN_ERROR);ue="true"}else{ue=ve.toLowerCase()==="true"?"true":"false"}}oe=oe+"{path: '"+fe+"',descending: "+ue+"},"}f+=", sorter: ["+oe.substring(0,oe.length-1)+"]"}}var pe=a.getSetting("ovpCardProperties").getProperty("/entityType");g(l,function(e,t){O=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=pe[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){var a=r.ForecastValue.PropertyPath||r.ForecastValue.Path;h.push(a);if(X&&X[a]){var i;if(X[a][F]){i=X[a][F].Path?X[a][F].Path:undefined}else if(X[a][K]){i=X[a][K].Path?X[a][K].Path:undefined}else if(X[a][U]){i=X[a][U]}if(i){if((h?Array.prototype.indexOf.call(h,i):-1)===-1){h.push(i)}}}}if(r.TargetValue&&(r.TargetValue.PropertyPath||r.TargetValue.Path)){var n=r.TargetValue.PropertyPath||r.TargetValue.Path;h.push(n);if(X&&X[n]){var i;if(X[n][F]){i=X[n][F].Path?X[n][F].Path:undefined}else if(X[n][K]){i=X[n][K].Path?X[n][K].Path:undefined}else if(X[n][U]){i=X[n][U]}if(i){if((h?Array.prototype.indexOf.call(h,i):-1)===-1){h.push(i)}}}}}h.push(O);if(X&&X[O]){if(X[O][x]){if(X[O][x].String&&O!=X[O][x].String){h.push(X[O][x].String?X[O][x].String:O)}else if(X[O][x].Path&&O!=X[O][x].Path){h.push(X[O][x].Path?X[O][x].Path:O)}}else if(X[O][Y]&&O!=X[O][Y]){h.push(X[O][Y]?X[O][Y]:O)}}if(X&&X[O]){var i;if(X[O][F]){i=X[O][F].Path?X[O][F].Path:undefined}else if(X[O][K]){i=X[O][K].Path?X[O][K].Path:undefined}else if(X[O][U]){i=X[O][U]}if(i){if((h?Array.prototype.indexOf.call(h,i):-1)===-1){h.push(i)}}}});g(s,function(e,t){O=t.Dimension.PropertyPath;p.push(O);if(X&&X[O]){if(X[O][x]){if(X[O][x].String&&O!=X[O][x].String){p.push(X[O][x].String?X[O][x].String:O)}else if(X[O][x].Path&&O!=X[O][x].Path){L=X[O][x].Path;var r=L.split("/");if(r.length>1){M=D(G,pe,L);if(M!==""){p.push(L);m.push(M);P=b(G,pe,L);if(P.length>0){d=d.concat(P)}}}else{p.push(L?L:O)}}}else if(X[O][Y]&&O!=X[O][Y]){p.push(X[O][Y]?X[O][Y]:O)}}});if(d.length>0){var me=0;while(me<d.length){if(p.indexOf(d[me])!==-1){d.splice(me,1)}else{me++}}}if(h.length>0){g(h,function(e,t){k[t]=true})}if(p.length>0){g(p,function(e,t){k[t]=true})}f+=", parameters: {select:'"+[].concat(p,h).join(",");var ge=G.getODataEntityType(i.entityType);if(ge){var Ae=r.getRequestFields(o);if(Ae&&Ae.length>0){g(Ae,function(e,t){if(!k.hasOwnProperty(t)){k[t]=true;_.push(t)}});if(_.length>0){f+=","+_.join(",")}}}if(y.length>0){var de=[];g(y,function(e,t){if(!k.hasOwnProperty(t)){de.push(t)}});if(de.length>0){f+=","+de.join(",")}}if(m.length>0){f+="'"+","+" expand:'"+m.join(",")}var Pe=r.checkFilterPreference(a.getSetting("ovpCardProperties"));if(Pe){f+="', custom: {cardId: '"+a.getSetting("ovpCardProperties").getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}}"}else{f+="', custom: {_requestFrom: 'ovp_internal'}}"}if(v&&v[1]==="Donut"&&s===undefined){f+=", length: 1"}else if(v&&v[1]==="Donut"&&s&&S){f+=", length: "+(parseInt(S,10)+1)}else if(S){f+=", length: "+S}f+="}";return f}R.requiresIContext=true;function D(e,t,r){var a="";var i=r.split("/");if(i.length>1){for(var n=0;n<i.length-1;n++){var o=e.getODataAssociationEnd(t,i[n]);if(o){t=e.getODataEntityType(o.type);if(a){a=a+"/"}a=a+i[n]}else{return a}}}return a}function b(e,t,r){var a=[];var i=[];var n;var o=r.split("/");if(o.length>1){for(var s=0;s<o.length-1;s++){var l=e.getODataAssociationEnd(t,o[s]);if(l){t=e.getODataEntityType(l.type);if(t){i=t&&t.key&&t.key.propertyRef;for(var u=0;u<i.length;u++){n=o[s]+"/"+i[u].name;a.push(n)}}}}}return a}function S(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){r=true;a=e}}if(r===true){return a}else{N.warning(C.CARD_WARNING+C.INVALID_FORECAST);return undefined}}function O(e,t){var r=false;var a;if(e.DataPoint&&e.DataPoint.AnnotationPath){var i=t[e.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){r=true;a=e}}if(r===true){return a}else{N.warning(C.CARD_WARNING+C.INVALID_TARGET);return undefined}}function M(e,t){var r;g(t,function(t,a){if(a.name===e){if(a["com.sap.vocabularies.Common.v1.Label"]){r=a["com.sap.vocabularies.Common.v1.Label"].String?a["com.sap.vocabularies.Common.v1.Label"].String:a["com.sap.vocabularies.Common.v1.Label"].Path}else if(a["sap:label"]){r=a["sap:label"]}return false}});return r}function L(e,t){var r=true;if(t==="line"||t==="column"||t==="bar"){g(e,function(e,t){if(t.getUid()==="valueAxis"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;N.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}else if(t==="vertical_bullet"){g(e,function(e,t){if(t.getUid()==="actualValues"||t.getUid()==="categoryAxis"){if(t.getValues().length!=1){r=false;N.warning(C.CARD_WARNING+C.INVALID_DIMMEAS);return false}}})}if(r===true){return true}}function V(e,t,r){var a=E.TYPE_KEY;if(!e||!e[t]||!e[t][a]){return r}var i=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var n=e[t][a];if((i?Array.prototype.indexOf.call(i,n):-1)!==-1){return Number(r)}return r}function Y(e){if(e){return e}return""}function x(e,t){var r=e.getModel();var a=e.getVizType();if(a!="line"&&a!="bubble"){return}if(!t){t=a==="line"?"categoryAxis":"valueAxis"}var i=e.getModel("ovpCardProperties").getProperty("/entitySet");if(!r||!i){return}var n=se(r,i);var o=e.getFeeds();for(var s=0;s<o.length;s++){if(o[s].getUid()===t){var l=o[s].getValues();if(!l){return}for(var u=0;u<l.length;u++){if(n[l[u][E.TYPE_KEY]]!="Edm.DateTime"){return}}e.setVizProperties({categoryAxis:{title:{visible:false}}});var f=e&&e.getModel("ovpCardProperties");if(f&&f.getProperty("/bInsightEnabled")){var c=e&&e.getId();h.setVizPropertyMap(c,{categoryAxis:{title:{visible:false}}})}return}}}function U(e,t,r,a,i,n){a=typeof a==="undefined"?false:a;var o=false;var s;if(!e&&a){N.error(i+C.CARD_ERROR+r+C.IS_MANDATORY);return o}if(!e){N.warning(i+C.CARD_WARNING+r+C.IS_MISSING);o=true;return o}s=t[e];if(!s||typeof s!=="object"){var l=a?N.error:N.warning;l(i+C.CARD_ERROR+"in "+r+". ("+e+" "+C.NOT_WELL_FORMED);return o}if(n&&n==="sap.ovp.cards.charts.analytical.analyticalChart"&&r==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){N.error(i+C.CARD_ERROR+C.MISSING_CHARTTYPE+C.CHART_ANNO);return o}o=true;return o}function F(e){var t=false;if(!e){return t}var r;var a;var i;var n;var o;var s;var l;var u="";var f;var c=e.getView();if(c){u="["+c.getId()+"] "}if(!(f=e.getCardPropertiesModel())){N.error(u+C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return t}l=f.getProperty("/entityType");if(!l||P(l)){N.error(u+C.CARD_ERROR+"in "+C.CARD_ANNO);return t}r=f.getProperty("/selectionAnnotationPath");a=f.getProperty("/chartAnnotationPath");n=f.getProperty("/presentationAnnotationPath");o=f.getProperty("/identificationAnnotationPath");s=f.getProperty("/dataPointAnnotationPath");i=f.getProperty("/contentFragment");t=U(r,l,"Selection Variant",false,u);t=U(a,l,"Chart Annotation",true,u,i)&&t;t=U(n,l,"Presentation Variant",false,u)&&t;t=U(o,l,"Identification Annotation",true,u)&&t;t=U(s,l,"Data Point",false,u)&&t;return t}function K(e,t,r){}function B(t){return e.getConfig(t)}function w(e,t,r,a){var i=false;var n;var o;var s;var l;var u;var f;if(!t.time||P(t.time)){return i}if(!e){return i}for(var c=0;c<e.length;c++){if(!e[c].Dimension||!(o=e[c].Dimension.PropertyPath)){return i}n=se(r,a);if(n&&n[o]){s=n[o][E.TYPE_KEY];l=n[o][E.DISPLAY_FORMAT_KEY];u=n[o][E.SEMANTICS_KEY];f=n[o]["com.sap.vocabularies.Common.v1.IsCalendarYear"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||n[o]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(l&&l.toLowerCase()==="date"){i=true}}else{i=true}}if(s==="Edm.String"&&(f||u&&_.indexOf(u)>-1)){i=true}if(i){e.unshift(e.splice(c,1)[0]);break}}return i}function k(e,t,r){var a="";var i=B(t);var n,o;if(!i){return a}a=i.default.type;n=e.getSetting("dataModel");o=e.getSetting("ovpCardProperties").getProperty("/entitySet");if(w(r,i,n,o)){a=i.time.type}return a}k.requiresIContext=true;function H(e,t,r){if(!e.length){return}var a=r==="dimension"?"Dimension":"Measure";var i=[];g(e,function(e,t){if(!t||!t[a]||!t[a].PropertyPath){N.error(C.INVALID_CHART_ANNO);return false}i.push(t[a].PropertyPath)});var n=jQuery.map(t.feeds,function(e){if(e.type===r){if(e.role){return e.role.split("|")}return[]}});n=jQuery.grep(n,function(e,t){return(n?Array.prototype.indexOf.call(n,e):-1)===t}).join(", ");N.error(C.CARD_ERROR+C.INVALID_REDUNDANT+r+"(s) "+i.join(", ")+". "+C.ALLOWED_ROLES+t.type+C.CHART_IS+n)}function z(e,t){var r;if(e){if(e.String){r=e.String}else if(e.Boolean||e.Bool){r=G(e)}else{r=j(e,t)}}return r}function G(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function j(e,t){var r;if(e){if(e.String){r=Number(e.String)}else if(e.Int){r=Number(e.Int)}else if(e.Decimal){r=Number(e.Decimal)}else if(e.Double){r=Number(e.Double)}else if(e.Single){r=Number(e.Single)}}if(t){var i=a.getFloatInstance({style:"short",minFractionDigits:2,maxFractionDigits:2});if(r){r=i.format(Number(r))}}return r}function W(e,t){function a(e){if(e){if(e.Path){return"{path:'"+e.Path+"'}"}else{return z(e)}}else{return""}}var i=e[e.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var n=t.CriticalityCalculation.ImprovementDirection.EnumMember;var o=a(t.CriticalityCalculation.DeviationRangeLowValue);var s=a(t.CriticalityCalculation.DeviationRangeHighValue);var l=a(t.CriticalityCalculation.ToleranceRangeLowValue);var u=a(t.CriticalityCalculation.ToleranceRangeHighValue);return r._calculateCriticalityState(i,n,o,s,l,u,r.criticalityConstants.StateValues)}else{var f=t.Criticality.EnumMember;var c=f?f.split("/"):[];if(c){return c[1]}}}function X(e,t,r){var a,i;g(t,function(t,r){if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].String===e.measureNames){a=r.name;return false}else if(r["com.sap.vocabularies.Common.v1.Label"]&&r["com.sap.vocabularies.Common.v1.Label"].Path===e.measureNames){a=r.name;return false}else if(r["sap:label"]===e.measureNames){a=r.name;return false}});g(r,function(e,t){if(t.Measure.PropertyPath===a){if(!t.DataPoint||!t.DataPoint.AnnotationPath){return false}i=t.DataPoint.AnnotationPath;return false}});return i}function q(e,t){if(e){if(e.Path){return e.Path}else{return z(e,t)}}else{return""}}function Q(e,t){function r(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var a=false;g(e,function(e,i){if(i.DataPoint&&i.DataPoint.AnnotationPath){var n=t[i.DataPoint.AnnotationPath.substring(1)];if(n&&n.CriticalityCalculation&&n.CriticalityCalculation.ImprovementDirection&&n.CriticalityCalculation.ImprovementDirection.EnumMember){var o=n.CriticalityCalculation.ImprovementDirection.EnumMember;var s=q(n.CriticalityCalculation.DeviationRangeLowValue);var l=q(n.CriticalityCalculation.DeviationRangeHighValue);var u=q(n.CriticalityCalculation.ToleranceRangeLowValue);var f=q(n.CriticalityCalculation.ToleranceRangeHighValue);if(r(o,"Minimize")||r(o,"Minimizing")){if(f&&l){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(r(o,"Maximize")||r(o,"Maximizing")){if(u&&s){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}else if(r(o,"Target")){if(u&&s&&f&&l){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_CRITICALITY)}}}else if(n&&n.Criticality){a=true;return false}else{N.warning(C.CARD_WARNING+C.INVALID_IMPROVEMENT_DIR)}}});if(a===true&&e.length>1){N.warning(C.CARD_WARNING+C.INVALID_SEMANTIC_MEASURES)}return a}function Z(e,t,r,a){function i(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}var n=[null,null];var o=true;var s=e.Measure.PropertyPath;if(r[s]){if(r[s][E.LABEL_KEY_V4]){s=oe(r[s][E.LABEL_KEY_V4].String?r[s][E.LABEL_KEY_V4].String:r[s][E.LABEL_KEY_V4].Path,a,r)}else if(r[s][E.LABEL_KEY]){s=r[s][E.LABEL_KEY]}else if(s){s=s}}var l=e.DataPoint.AnnotationPath;var u=t[l.substring(1)];if(!u.CriticalityCalculation||!u.CriticalityCalculation.ImprovementDirection||!u.CriticalityCalculation.ImprovementDirection.EnumMember){return n}var f=u.CriticalityCalculation.ImprovementDirection.EnumMember;var c=q(u.CriticalityCalculation.DeviationRangeLowValue,o);var v=q(u.CriticalityCalculation.DeviationRangeHighValue,o);var m=q(u.CriticalityCalculation.ToleranceRangeLowValue,o);var g=q(u.CriticalityCalculation.ToleranceRangeHighValue,o);if(i(f,"Minimize")||i(f,"Minimizing")){if(g&&v){n[0]=p.getText("MINIMIZING_LESS",[s,g]);n[1]=p.getText("MINIMIZING_MORE",[s,v]);n[2]=p.getText("MINIMIZING_CRITICAL",[g,s,v])}}else if(i(f,"Maximize")||i(f,"Maximizing")){if(m&&c){n[0]=p.getText("MAXIMISING_MORE",[s,m]);n[1]=p.getText("MAXIMISING_LESS",[s,c]);n[2]=p.getText("MAXIMIZING_CRITICAL",[c,s,m])}}else if(i(f,"Target")){if(m&&c&&g&&v){n[0]=p.getText("TARGET_BETWEEN",[m,s,g]);n[1]=p.getText("TARGET_AROUND",[s,c,v]);n[2]=p.getText("TARGET_CRITICAL",[c,s,m,g,v])}}return n}function J(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){n=i.NumberOfFractionalDigits.Int;if(e<Number(n)){e=Number(n)}}}return e}function $(e,t,r){if(t&&t.DataPoint&&t.DataPoint.AnnotationPath){var a=r[t.DataPoint.AnnotationPath.substring(1)];var i,n;if(a&&a.ValueFormat){i=a.ValueFormat}else if(a&&a.NumberFormat){i=a.NumberFormat}if(i){if(i.ScaleFactor&&i.ScaleFactor.Decimal){n=Number(i.ScaleFactor.Decimal)}else if(i.ScaleFactor&&i.ScaleFactor.Int){n=Number(i.ScaleFactor.Int)}if(!isNaN(n)){if(e===undefined){e=Number(n)}else if(e>Number(n)){e=Number(n)}}}}return e}function ee(e,t){if(e&&e[t]&&(e[t]["Org.OData.Measures.V1.ISOCurrency"]||e[t][E.SEMANTICS_KEY]&&e[t][E.SEMANTICS_KEY]===E.CURRENCY_CODE)){return true}return false}function te(e,t,r){if(e[t[r].PropertyPath][E.EDM_TYPE]===E.EDM_INT32){return true}return false}function re(e,t,r){if(e[t[r].PropertyPath][E.EDM_TYPE]===E.EDM_INT64){return true}return false}function ae(e,t,a,i){var n,s,v,m,d;var P,_,R,D,b,V=false;var Y;var x,U,F;var K,k=[],z=[];var G;var j;var q=i&&i.getView();var ae,ne;var fe=q&&q.getModel("ui");var ce=fe&&fe.getProperty("/chartSettings");n=e.getModel("ovpCardProperties");if(l.checkIfAPIIsUsed(i)){V=n&&n.getData()&&n.getData().showDataLabel}d=ce?ce.showDataLabel:V;P=e.getVizType();_=B();for(var ve in _){if((j=_[ve].reference)&&_[j]){var pe=A({},_[j]);_[ve]=pe}if(_[ve].default.type===P||_[ve].time&&_[ve].time.type===P){R=_[ve];break}}if(!R){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.CARD_CONFIG_ERROR+P+" "+C.CARD_CONFIG_JSON);return}if(!n){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var me=e.getModel();var ge=n.getProperty("/entitySet");if(!me||!ge){return}s=n.getProperty("/entityType");if(!s){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var Ae=se(me,ge);v=n.getProperty("/chartAnnotationPath");if(!v||!(m=s[v])){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}if(!(D=m.DimensionAttributes)||!D.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return}var de;if(!(b=m.MeasureAttributes)||!b.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}else{var Pe=b[0].DataPoint?s[b[0].DataPoint.AnnotationPath.substring(1)]:null;var _e=Pe&&Pe.ValueFormat&&Pe.ValueFormat.NumberOfFractionalDigits&&Pe.ValueFormat.NumberOfFractionalDigits.Int;de=_e?_e:0}G=w(D,R,me,ge);if(G){R=R.time}else{R=R.default}var ye=n.getProperty("/ChartProperties")||n.getProperty("/chartProperties");if(n&&n.getProperty("/tabs")&&ye===undefined){ae=q.byId("ovp_card_dropdown");ne=parseInt(ae.getSelectedKey(),10);ye=n.getProperty("/tabs")&&n.getProperty("/tabs")[ne-1]&&(n.getProperty("/tabs")[ne-1]["ChartProperties"]||n.getProperty("/tabs")[ne-1]["chartProperties"])}var Te=false;var Ie=de>0?"tooltipNoScaleFormatter/"+de.toString()+"/":"tooltipNoScaleFormatter/-1/";var Ne=new o({formatString:Ie});Ne.connect(e.getVizUid());Ne.connect(e.getVizUid());e._oOvpVizFrameTooltip=Ne;[R.dimensions,R.measures].forEach(function(e,t){var r=t?b:D;var a=t?"measure(s)":"dimension(s)";if(e.min&&r.length<e.min){N.error(C.CARD_ERROR+"in "+P+" "+C.CARD_LEAST+e.min+" "+a);Te=true}if(e.max&&r.length>e.max){N.error(C.CARD_ERROR+"in "+P+C.CARD_MOST+e.max+" "+a);Te=true}});if(Te){return}var Re=true;if(R.properties&&R.properties.hasOwnProperty("hideLabel")&&!R.properties["hideLabel"]){Re=false}var De=true;var be=false;if(P==="donut"){be=true}e.removeAllAggregation();Y={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:De?false:true,selectability:{legendSelection:be?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:d||be?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(R.properties&&R.properties.semanticColor===true&&Q(b,s)){var Se=p.getText("GOOD");var Oe=p.getText("BAD");var Me=p.getText("CRITICAL");var Le=p.getText("OTHERS");if(b.length===1){var Ve=Z(b[0],s,Ae,e);var Se=Ve[0]||Se,Oe=Ve[1]||Oe,Me=Ve[2]||Me,Le=p.getText("OTHERS")}Y.plotArea.dataPointStyle={rules:[{callback:function(e){var t=X(e,Ae,b);if(!t){return false}var a=s[t.substring(1)];var i=W(e,a);if(i===r.criticalityConstants.StateValues.Positive){return true}else if(i==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Se},{callback:function(e){var t=X(e,Ae,b);if(!t){return false}var a=s[t.substring(1)];var i=W(e,a);if(i===r.criticalityConstants.StateValues.Critical){return true}else if(i==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:Me},{callback:function(e){var t=X(e,Ae,b);if(!t){return false}var a=s[t.substring(1)];var i=W(e,a);if(i===r.criticalityConstants.StateValues.Negative){return true}else if(i==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:Oe},{callback:function(e){var t=X(e,Ae,b);if(!t){return false}var a=s[t.substring(1)];var i=W(e,a);if(i===r.criticalityConstants.StateValues.None){return true}else if(i==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:Le}]}}var Ye=n.getProperty("/bEnableStableColors");var xe=n.getProperty("/colorPalette");var Ue;if(!Ye&&y.indexOf(m.ChartType.EnumMember)>=0&&xe&&Object.keys(xe).length>=2&&Object.keys(xe).length<=4){g(D,function(e,t){if(t&&t.Role&&t.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Ue=t.Dimension&&t.Dimension.PropertyPath;return}});var Fe;if(Ue){if(Ae&&Ae[Ue]){if(Ae[Ue][E.LABEL_KEY_V4]){Fe=oe(Ae[Ue][E.LABEL_KEY_V4].String?Ae[Ue][E.LABEL_KEY_V4].String:Ae[Ue][E.LABEL_KEY_V4].Path,e,Ae)}else if(Ae[Ue][E.LABEL_KEY]){Fe=Ae[Ue][E.LABEL_KEY]}else if(Ue){Fe=Ue}}if(xe instanceof Array){var Ke=xe.map(function(e){return e.color});var Be=xe.map(function(e){return e.legendText});var we=Be[0]!=undefined?Be[0]:p.getText("OTHERS");var ke=Be[1]!=undefined?Be[1]:p.getText("BAD");var He=Be[2]!=undefined?Be[2]:p.getText("CRITICAL");var ze=Be[3]!=undefined?Be[3]:p.getText("GOOD")}Y.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[Fe]==="3"||e[Fe]===3)){if(xe instanceof Array){if(xe.length<4){return false}}else if(xe&&!xe.hasOwnProperty(3)){return false}return true}},properties:{color:xe instanceof Array&&Ke.length?Ke[3]:xe[3]&&xe[3]["color"]},displayName:ze||xe[3]&&xe[3]["legendText"]},{callback:function(e){if(e&&(e[Fe]==="2"||e[Fe]===2)){if(xe instanceof Array){if(xe.length<3){return false}}else if(xe&&!xe.hasOwnProperty(2)){return false}return true}},properties:{color:xe instanceof Array&&Ke.length?Ke[2]:xe[2]&&xe[2]["color"]},displayName:He||xe[2]&&xe[2]["legendText"]},{callback:function(e){if(e&&(e[Fe]==="1"||e[Fe]===1)){return true}},properties:{color:xe instanceof Array&&Ke.length?Ke[1]:xe[1]&&xe[1]["color"]},displayName:ke||xe[1]&&xe[1]["legendText"]},{callback:function(e){if(e&&(e[Fe]==="0"||e[Fe]===0)){return true}},properties:{color:xe instanceof Array&&Ke.length?Ke[0]:xe[0]&&xe[0]["color"]},displayName:we||xe[0]&&xe[0]["legendText"]}]};var Ge;if(n&&n.getProperty("/bInsightEnabled")){Ge=A({},Y.plotArea.dataPointStyle);Ge.rules.forEach(function(e,t,r){delete e["callback"];e.dataContext={};e.dataContext[Fe]=r.length-1-t+""})}}}var je=false;var We=false;if(m.ChartType.EnumMember===E.SCATTER_CHARTTYPE||m.ChartType.EnumMember===E.BUBBLE_CHARTTYPE||m.ChartType.EnumMember===E.LINE_CHARTTYPE){if(m&&m.AxisScaling&&m.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var Xe=m.AxisScaling;if(Xe.AutoScaleBehavior&&Xe.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var qe=Xe.AutoScaleBehavior;if(qe.ZeroAlwaysVisible&&qe.ZeroAlwaysVisible.Bool=="true"){Y.plotArea.adjustScale=false;je=true}else if(qe.DataScope){Y.plotArea.adjustScale=true;je=true}}else if(Xe.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&Xe.ScaleBehavior&&Xe.ScaleBehavior.EnumMember){var Qe=Xe.ScaleBehavior.EnumMember;var Ze=Qe.substring(Qe.lastIndexOf("/")+1,Qe.length);if(Ze=="FixedScale"){We=true}}}else if(m&&m.AxisScaling&&m.AxisScaling.EnumMember){var Je=m.AxisScaling.EnumMember.substring(m.AxisScaling.EnumMember.lastIndexOf("/")+1,m.AxisScaling.EnumMember.length);switch(Je){case"AdjustToDataIncluding0":Y.plotArea.adjustScale=false;je=true;break;case"AdjustToData":Y.plotArea.adjustScale=true;je=true;break;case"MinMaxValues":We=true;break;default:break}}if(We){var $e=[];if(m["MeasureAttributes"][0]&&m["MeasureAttributes"][0].DataPoint&&m["MeasureAttributes"][0].DataPoint.AnnotationPath){var et=m["MeasureAttributes"][0].DataPoint.AnnotationPath;var tt=et.substring(et.lastIndexOf("@")+1,et.length);if(s&&s[tt]){var rt=s[tt];if(rt&&rt.MaximumValue&&rt.MaximumValue.Decimal&&rt.MinimumValue&&rt.MinimumValue.Decimal){$e.push({feed:"valueAxis",max:rt.MaximumValue.Decimal,min:rt.MinimumValue.Decimal});je=true}else{N.error(C.ERROR_MISSING_AXISSCALES)}}}if(m.ChartType.EnumMember!==E.LINE_CHARTTYPE&&m["MeasureAttributes"][1]&&m["MeasureAttributes"][1].DataPoint&&m["MeasureAttributes"][1].DataPoint.AnnotationPath){var et=m["MeasureAttributes"][1].DataPoint.AnnotationPath;var tt=et.substring(et.lastIndexOf("@")+1,et.length);if(s&&s[tt]){var rt=s[tt];if(rt&&rt.MaximumValue&&rt.MaximumValue.Decimal&&rt.MinimumValue&&rt.MinimumValue.Decimal){$e.push({feed:"valueAxis2",max:rt.MaximumValue.Decimal,min:rt.MinimumValue.Decimal});je=true}else{N.error(C.ERROR_MISSING_AXISSCALES)}}}e.setVizScales($e)}}U=D.slice();F=b.slice();var at=0;var it=0;var nt;var ot;var st=false;var lt=false;var ut;var ft=[];var ct=[],vt=[];if((P==="column"||P==="bar"||P==="vertical_bullet")&&R.feeds&&R.feeds.length>0){var pt;for(pt=0;pt<R.feeds.length;pt++){if(R.feeds[pt].uid==="color"){R.feeds.splice(pt,1);break}}for(pt=0;pt<R.feeds.length;pt++){if(R.feeds[pt].uid==="categoryAxis"){delete R.feeds[pt].role;break}}if(n.getProperty("/colorPalette")){for(pt=0;pt<R.feeds.length;pt++){if(R.feeds[pt].uid==="categoryAxis"){R.feeds[pt].role="Category";break}}R.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}g(R.feeds,function(t,r){var a=r.uid;var i=[];if(r.type){var o,l,v;if(r.type==="dimension"){o=D.length;l="Dimension";v="dimensions";x=U;K=k}else{o=b.length;l="Measure";v="measures";x=F;K=z}var p=0,m=o;if(r.min){p=p>r.min?p:r.min}if(r.max){m=m<r.max?m:r.max}if(!r.role){var A=x.length;for(var d=0;d<A&&i.length<m;++d){var _=x[d];x.splice(d,1);--A;--d;i.push(_);if(Ae[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){ut=Ae[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?Ae[_[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[_[l].PropertyPath][E.UNIT_KEY_V4_Unit]){ut=Ae[_[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?Ae[_[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[_[l].PropertyPath][E.UNIT_KEY]){ut=Ae[_[l].PropertyPath][E.UNIT_KEY]}if(ee(Ae,ut)){st=true}else{lt=true}if(!st){at=J(at,_,s);nt=$(nt,_,s)}else{it=J(it,_,s);ot=$(ot,_,s)}}}else{var y=r.role.split("|");g(y,function(e,t){if(i.length===m){return false}var r=x.length;for(var a=0;a<r&&i.length<m;++a){var n=x[a];if(n&&n.Role&&n.Role.EnumMember&&n.Role.EnumMember.split("/")&&n.Role.EnumMember.split("/")[1]){var o=n.Role.EnumMember.split("/")[1];if(o===t){x.splice(a,1);--r;--a;i.push(n);if(Ae[n[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){ut=Ae[n[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?Ae[n[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[n[l].PropertyPath][E.UNIT_KEY_V4_Unit]){ut=Ae[n[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?Ae[n[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[n[l].PropertyPath][E.UNIT_KEY]){ut=Ae[n[l].PropertyPath][E.UNIT_KEY]}if(ee(Ae,ut)){st=true}else{lt=true}if(!st){at=J(at,n,s);nt=$(nt,n,s)}else{it=J(it,n,s);ot=$(ot,n,s)}}}else if((K?Array.prototype.indexOf.call(K,n):-1)===-1){K.push(n)}}});if(i.length<m){g(K,function(e,t){var r;var a;if((r=R[v].defaultRole)&&(y?Array.prototype.indexOf.call(y,r):-1)!==-1&&(a=(x?Array.prototype.indexOf.call(x,t):-1)!==-1)){x.splice(a,1);i.push(t);if(Ae[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency]){ut=Ae[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path?Ae[t[l].PropertyPath][E.UNIT_KEY_V4_ISOCurrency].Path:undefined}else if(Ae[t[l].PropertyPath][E.UNIT_KEY_V4_Unit]){ut=Ae[t[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path?Ae[t[l].PropertyPath][E.UNIT_KEY_V4_Unit].Path:undefined}else if(Ae[t[l].PropertyPath][E.UNIT_KEY]){ut=Ae[t[l].PropertyPath][E.UNIT_KEY]}if(ee(Ae,ut)){st=true}else{lt=true}if(!st){at=J(at,t,s);nt=$(nt,t,s)}else{it=J(it,t,s);ot=$(ot,t,s)}if(i.length===m){return false}}})}if(i.length<p){N.error(C.CARD_ERROR+C.MIN_FEEDS+P+" "+C.FEEDS_OBTAINED+i.length+" "+C.FEEDS_REQUIRED+p+" "+C.FEEDS);return false}}if(i.length){var T=[];var S;if(!(S=e.getDataset())){N.error(C.NO_DATASET);return false}I=s;g(i,function(t,r){if(!r||!r[l]||!r[l].PropertyPath){N.error(C.INVALID_CHART_ANNO);return false}var i=r[l].PropertyPath;var o=i;var s=i;var c=null;if(Ae&&Ae[i]){if(Ae[i][E.LABEL_KEY_V4]){if(Ae[i][E.LABEL_KEY_V4].String){o=oe(Ae[i][E.LABEL_KEY_V4].String,e,Ae)}else if(Ae[i][E.LABEL_KEY_V4].Path){o=Ae[i][E.LABEL_KEY_V4].Path}else{o=i}}else if(Ae[i][E.LABEL_KEY]){o=Ae[i][E.LABEL_KEY]}else if(i){o=i}if(Ae[i][E.TEXT_KEY_V4]){s=Ae[i][E.TEXT_KEY_V4].String?Ae[i][E.TEXT_KEY_V4].String:Ae[i][E.TEXT_KEY_V4].Path}else if(Ae[i][E.TEXT_KEY]){s=Ae[i][E.TEXT_KEY]}else if(i){s=i}c=Ae[i][E.TYPE_KEY]||null}var v,p={};p[i]=s;if((c==="Edm.DateTime"||c==="Edm.DateTimeOffset")&&s===i){v="{path:'"+i+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}"}else{if(Ae[i]&&Ae[i][E.TEXT_KEY_V4]&&Ae[i][E.TEXT_KEY_V4][E.TEXT_ARRANGEMENT_ANNO]){var m,g;m=Ae[i][E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember;if(!g){m=Ae[i][E.TEXT_KEY_V4][E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}if(!g){var A=I;m=A&&A[E.TEXT_ARRANGEMENT_ANNO];g=m&&m.EnumMember}switch(g){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":v="{"+s+"}"+" "+"("+"{"+i+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":v="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":v="{"+s+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":v="{"+i+"}"+" "+"("+"{"+s+"}"+")";break;default:v="{"+i+"}";p[i]=i;break}}else{v="{"+s+"}"}if(n&&n.getProperty("/bInsightEnabled")){h.setDimensionPath(n.getData().cardId,i,v)}}T.push(o);if(l==="Dimension"){if(a==="waterfallType"){var d=new u({name:o,value:"{"+i+"}"})}else{var d=new u({name:o,value:"{"+i+"}",displayValue:v})}var P=Ae[i][E.SEMANTICS_KEY];var _=Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"].Bool||Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]&&Ae[i]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"].Bool;if(G&&(c==="Edm.DateTime"||_||c==="Edm.DateTimeOffset"||P&&P.lastIndexOf("year",0)===0)){d.setDataType("date")}S.addDimension(d);if((vt?Array.prototype.indexOf.call(vt,o):-1)===-1){vt.push(o)}}else{S.addMeasure(new f({name:o,value:"{"+i+"}"}));if((ct?Array.prototype.indexOf.call(ct,o):-1)===-1&&a!="bubbleWidth"){ct.push(o)}}});e.addFeed(new c({uid:a,type:l,values:T}));if(a==="categoryAxis"){Y[a]={title:{visible:Re?false:true,text:T.join(", ")},label:{formatString:st?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{Y[a]={title:{visible:Re?false:true,text:T.join(", ")},label:{formatString:st?"CURR":"axisFormatter"}}}ft.push(Y[a]);if(R.hasOwnProperty("vizProperties")){var O=0;var M=R.vizProperties.length;var L;var V;for(;O<M;O++){if(R.vizProperties[O].hasOwnProperty("value")){V=R.vizProperties[O].value}if(R.vizProperties[O].hasOwnProperty("path")){L=R.vizProperties[O].path.split(".");var B=L.length;var w,H;var j;for(var W=0,j=L[0],w=Y,H=ye;W<B;++W){if(W===B-1){if(H&&H.hasOwnProperty(j)){if(P==="donut"&&(H[j]==="value"||H[j]==="percentage")){V=H[j]}else if(P!="donut"){V=H[j]}}if(je&&j!="adjustScale"||!je&&j==="adjustScale"||!je&&j!="adjustScale"){w[j]=V}break}w[j]=w[j]||{};w=w[j];if(H){H[j]=H[j]||{};H=H[j]}j=L[W+1]}}}}if(r.hasOwnProperty("vizProperties")){var t=0;var X=r.vizProperties.length;var q;var Q;var Z;for(;t<X;t++){if(r.vizProperties[t].hasOwnProperty("method")){Q=r.vizProperties[t].method;switch(Q){case"count":q=T.length;if(r.vizProperties[t].hasOwnProperty("min")&&q<=r.vizProperties[t].min){q=r.vizProperties[t].min}else if(r.vizProperties[t].hasOwnProperty("max")&&q>=r.vizProperties[t].max){q=r.vizProperties[t].max}break;default:break}}else if(r.vizProperties[t].hasOwnProperty("value")){q=r.vizProperties[t].value}if(r.vizProperties[t].hasOwnProperty("path")){Z=r.vizProperties[t].path.split(".");var te=Z.length;for(var d=0,re=Z[0],ae=Y;d<te;++d){if(d===te-1){ae[re]=q;break}ae[re]=ae[re]||{};ae=ae[re];re=Z[d+1]}}}}}}});var mt=e.getFeeds();if(R.properties&&R.properties.semanticPattern===true&&L(mt,P)){g(mt,function(t,r){if(mt[t].getType()==="Measure"&&(mt[t].getUid()==="valueAxis"||mt[t].getUid()==="actualValues")){var a;g(b,function(e,r){var i=M(r.Measure.PropertyPath,Ae);if(i===mt[t].getValues()[0]){a=S(r,s);return false}});if(a){var i=M(a.Measure.PropertyPath,Ae);var n=s[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||s[a.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path;var o=M(n,Ae);var l=p.getText("ACTUAL",[i]);var u=p.getText("FORECAST",[o]);Y.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:i},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:o},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:u}]};e.getDataset().addMeasure(new f({name:o,value:"{"+n+"}"}));var c=mt[t].getValues();c.push(o);mt[t].setValues(c)}return false}})}var gt=false;if(xe&&xe.dimensionSettings&&Object.keys(xe.dimensionSettings).length>0){var At=Object.keys(xe.dimensionSettings);for(var dt=0;dt<At.length;dt++){var Pt=At[dt];var ht=xe.dimensionSettings[Pt];if(Object.keys(ht).length>10){gt=true;break}}}if(Ye&&T.indexOf(m.ChartType.EnumMember)>=0&&!gt){var Et=[];var Ct=true;for(var dt=0;dt<D.length;dt++){var _t=D[dt].Dimension.PropertyPath;Et.push(_t)}for(var dt=0;dt<Et.length;dt++){var Pt=Et[dt];if(At.indexOf(Pt)>-1){var yt=xe.dimensionSettings[Pt];var Tt=Object.keys(yt);var It=[];for(var dt=0;dt<Tt.length;dt++){var Nt=yt[Tt[dt]];It.push(Nt)}Ct=Ct&&It.every(Ee)}}if(Ct){var Rt=[];for(var dt=0;dt<Et.length;dt++){var Pt=Et[dt];if(At.indexOf(Pt)>-1){var yt=xe.dimensionSettings[Pt];var Tt=Object.keys(yt);var It=[];for(var dt=0;dt<Tt.length;dt++){var Nt=yt[Tt[dt]];It.push(Nt)}he(It);for(var Dt=0;Dt<It.length;Dt++){var bt=It[Dt].dimensionValue;var St=It[Dt].color;var Nt={properties:{color:St}};Nt.dataContext={};var Ot=ie(Ae,e,Pt);Nt.dataContext[Ot]=bt;Nt.displayName=bt;Rt.push(Nt)}}}Y.plotArea.dataPointStyle=Y.plotArea.dataPointStyle||{};Y.plotArea.dataPointStyle["rules"]=Rt}else{var Rt=[];for(var dt=0;dt<Et.length;dt++){var Pt=Et[dt];if(At.indexOf(Pt)>-1){var yt=xe.dimensionSettings[Pt];var Tt=Object.keys(yt);var It=[];for(var dt=0;dt<Tt.length;dt++){var Nt=yt[Tt[dt]];It.push(Nt)}he(It);var Mt=It.map(Ce)}}Y.legend.order=function(e,t){var r=Mt.indexOf(e);var a=Mt.indexOf(t);return r>a?1:-1}}}if(R.properties&&R.properties.semanticPattern===true&&L(mt,P)&&e.getVizType()==="vertical_bullet"){g(mt,function(t,r){if(mt[t].getType()==="Measure"&&(mt[t].getUid()==="valueAxis"||mt[t].getUid()==="actualValues")){var a;g(b,function(e,r){var i=M(r.Measure.PropertyPath,Ae);if(i===mt[t].getValues()[0]){a=O(r,s);return false}});if(a){var i=s[a.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||s[a.DataPoint.AnnotationPath.substring(1)].TargetValue.Path;var n=M(i,Ae);e.getDataset().addMeasure(new f({name:n,value:"{"+i+"}"}));e.addFeed(new c({uid:"targetValues",type:"Measure",values:[n]}))}return false}})}if(st&&lt){N.warning(p.getText("Currency_non_currency_measure"))}g(mt,function(e,t){var r=t.getProperty("type");if(r==="Measure"){var a=t.getProperty("values");var i=true;var n=m.MeasureAttributes.filter(function(e){return a.indexOf(Ae[e[r]["PropertyPath"]][E.LABEL_KEY])>=0||a.indexOf(Ae[e[r]["PropertyPath"]][E.LABEL_KEY_V4])>=0});g(n,function(e,t){if(te(Ae,t,r)||re(Ae,t,r)){i=false}else{i=true;return false}});if(!i){Y[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var Lt;if(ot===undefined){ot=""}if(nt===undefined){nt=""}if(st){Lt=ue(ot,st)}else{Lt=ue(nt,st)}if(t){t.setScale(Lt)}le(ct,vt,a);var Vt="";g(mt,function(e,t){var r="-1";var a=t.getProperty("type");if(a==="Measure"){var i=ft.filter(function(e){var r=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(r.length>0){return true}else{return false}});if(i&&i.length){var n=t.getValues();if(n&&n.length){g(n,function(e,t){var i=t.trim();var n=b.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(Ae[t]&&Ae[t][E.LABEL_KEY]===i||Ae[t]&&Ae[t][E.LABEL_KEY_V4]===i){return true}else{return false}}});if(n&&n.length){var o=n[0];if(!te(Ae,o,a)&&!re(Ae,o,a)){var l="";if(o&&o["DataPoint"]&&o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"]){l=o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"].substring(1);if(l!=""){var u;u=s[l]&&s[l]["ValueFormat"]&&s[l]["ValueFormat"]["NumberOfFractionalDigits"]&&s[l]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];r=u>r?u:r}}}else{r=r<"0"?"0":r}}})}}if(i&&i[0]&&i[0].label&&i[0].label.formatString){var o=i[0].label.formatString}Vt="";if(st){if(o==="CURR"){Vt="CURR/"+r.toString()+"/"}else{Vt="axisFormatter/"+r.toString()+"/"}}else{Vt="axisFormatter/"+r.toString()+"/"}if(i&&i[0]){i[0].label.formatString=Vt}}});if(P==="vertical_bullet"){Y["valueAxis"]={title:{visible:Re?false:true},label:{formatString:Vt}}}var Yt="";var xt="";if(st){Yt=it.toString();xt="CURR/"+it.toString()+"/"}else{Yt=at.toString();xt="axisFormatter/"+at.toString()+"/"}if(P==="donut"||d){Y.plotArea.dataLabel.formatString=xt;if(Y.plotArea.dataLabel.type==="percentage"){Y.plotArea.dataLabel.formatString="0.0%/"+Yt+"/"}}H(U,R,"dimension");H(F,R,"measure");if(G){var Ut=D[0].Dimension.PropertyPath;if(Ae[Ut][E.SEMANTICS_KEY]==="yearmonth"||Ae[Ut]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){Y.timeAxis.levels=["year","month"]}else if(Ae[Ut][E.SEMANTICS_KEY]==="yearquarter"||Ae[Ut]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){Y.timeAxis.levels=["year","quarter"]}else if(Ae[Ut][E.SEMANTICS_KEY]==="yearweek"||Ae[Ut]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){Y.timeAxis.levels=["year","week"]}else if(Ae[Ut][E.SEMANTICS_KEY]==="year"||Ae[Ut]["com.sap.vocabularies.Common.v1.IsCalendarYear"]){Y.timeAxis.levels=["year"]}}e.setVizProperties(Y);if(n&&n.getProperty("/bInsightEnabled")){var Ft=e&&e.getId();var Kt=A({},Y);if(Ge!==undefined){Kt.plotArea.dataPointStyle=Ge}h.setVizPropertyMap(Ft,Kt)}}function ie(e,t,r){var a="";if(e&&e[r]){if(e[r][E.LABEL_KEY_V4]){a=oe(e[r][E.LABEL_KEY_V4].String?e[r][E.LABEL_KEY_V4].String:e[r][E.LABEL_KEY_V4].Path,t,e)}else if(e[r][E.LABEL_KEY]){a=e[r][E.LABEL_KEY]}else if(r){a=r}}return a}function ne(e,t,r){if(e&&(e.getVizType()==="bubble"||e.getVizType()==="scatter")){return}var a,i,n,o;var s;var l=E.UNIT_KEY;var u=E.UNIT_KEY_V4_ISOCurrency;var f=E.UNIT_KEY_V4_Unit;var c;var v=[];if(!(a=e.getModel("ovpCardProperties"))){N.error(C.CARD_ERROR+"in "+C.CARD_CONFIG+C.NO_CARD_MODEL);return}var m=e.getModel();var A=a.getProperty("/entitySet");if(!m||!A){return}i=a.getProperty("/entityType");if(!i){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}var d=se(m,A);n=a.getProperty("/chartAnnotationPath");if(!n||!(o=i[n])){N.error(C.CARD_ANNO_ERROR+"in "+C.CARD_ANNO);return}if(!(s=o.MeasureAttributes)||!s.length){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return}g(s,function(e,t){c=t.Measure.PropertyPath;if(t.DataPoint&&t.DataPoint.AnnotationPath){var r=i[t.DataPoint.AnnotationPath.substring(1)];if(r.ForecastValue&&(r.ForecastValue.PropertyPath||r.ForecastValue.Path)){v.push(r.ForecastValue.PropertyPath||r.ForecastValue.Path)}}v.push(c)});var P=t?t.results:null;var h="";var _=true;var y=[];var T=e.getFeeds();g(T,function(e,t){if(t.getType()==="Measure"){y=y.concat(t.getValues())}});if(P){g(v,function(t,r){var a=ie(d,e,r);if((y?Array.prototype.indexOf.call(y,a):-1)!=-1){if(d&&d[r]){var i;if(d[r][u]){i=d[r][u].Path?d[r][u].Path:d[r][u].String}else if(d[r][f]){i=d[r][f].Path?d[r][f].Path:d[r][f].String}else if(d[r][l]){i=d[r][l]}if(!i){_=false;return false}if(i&&d[i]){for(var t=0;t<P.length;t++){var n=P[t];if(_){if(h&&n[i]&&n[i]!=""&&h!=""&&h!=n[i]){_=false;break}}h=n[i];if(!h){_=false;break}}}}}})}var I="";if(_){if(h!=""){I=p.getText("IN_NO_SCALE",[h]);I=" "+I}if(r){r.setText(I);r.data("aria-label",I,true);var R=e.data("aria-label");if(R&&I&&R.indexOf(I)===-1){var D=R+I;e.data("aria-label",D,true)}}}}function oe(e,t,r){var a;var i;var n;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){n=e.split(">");a=n[0];i=n[1]}else if(e.indexOf("&gt;")!=-1){n=e.split("&gt;");a=n[0];i=n[1]}try{e=t.getModel(a).getProperty(i)}catch(t){e=r[e][E.LABEL_KEY_V4].String;N.error("Unable to read labels from resource file",t)}}return e}function se(t,r){var a=e.cacheODataMetadata(t);if(!a){return undefined}return a[r]}function le(e,t,r){var a="",i="",n="";if(r){a=r.getText()}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=p.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=p.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(r&&a===""){a=p.getText("NO_CHART_TITLE",[i,n]);r.setText(a);r.data("aria-label",a,true)}}function ue(e,t){var r=1;var i;if(t){var n=a.getCurrencyInstance({style:"short",currencyCode:false,shortRefNumber:e});i=n.format(Number(r))}else{var o=a.getFloatInstance({style:"short",shortRefNumber:e});i=o.format(Number(r))}var s=i.slice(-1);return s}function fe(e,t){e.attachSelectData(function(a){var n=m.bCRTLPressed?m.constants.explace:m.constants.inplace;m.bCRTLPressed=false;var o=e.getModel("ovpCardProperties");var u=e.getModel();var f=o.getProperty("/entitySet");var c=se(u,f);var v=[],p=[];var A={},d={};var P=e.getDataset().getDimensions();var h;for(var C=0;C<P.length;C++){v.push(P[C].getName())}var _=e.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(a.getParameter("data")&&a.getParameter("data")[0]&&a.getParameter("data")[0].data){p=Object.keys(a.getParameter("data")[0].data);h=a.getParameter("data")[0].data._context_row_number;var y=e.getDataset().getBinding("data").getContexts()[h];var T=t.getEntityNavigationEntries(y)[0];if(_[h].$isOthers&&_[h].$isOthers===true){var I={},N=[];for(var R=0;R<v.length;R++){for(var D=0;D<p.length;D++){if(v[R]===p[D]){for(var b in c){if(c.hasOwnProperty(b)){var S=c[b][E.LABEL_KEY]||c[b][E.NAME_KEY]||c[b][E.NAME_CAP_KEY];if(S===p[D]){N.push(b)}}}}}}for(var C=0;C<N.length;C++){I[N[C]]=[];for(var R=0;R<_.length-1;R++){if(R!=h){I[N[C]].push(_[R][N[C]])}}}var O={$isOthers:true};var M={getObject:function(){return O},getOtherNavigationDimensions:function(){return I}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(M)}}else{if(T){t.doNavigation(M,T,n)}}}else{for(var R=0;R<v.length;R++){for(var D=0;D<p.length;D++){if(v[R]===p[D]){for(var b in c){if(c.hasOwnProperty(b)){var S=c[b][E.LABEL_KEY_V4]&&c[b][E.LABEL_KEY_V4].String||c[b][E.LABEL_KEY]||c[b][E.NAME_KEY]||c[b][E.NAME_CAP_KEY];if(S.match(/{@i18n>.+}/gi)){var L=this.getModel("@i18n").getResourceBundle();S=L.getText(S.substring(S.indexOf(">")+1,S.length-1))}if(S===p[D]){A[b]=_[h][b]}}}}for(var b in _[h]){if(c.hasOwnProperty(b)){d[b]=_[h][b]}}}}if(A){g(Object.keys(A),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=A[t];if(r.includes(".")){A[t]=r.split(".").reverse().join("")}else if(r.includes("/")){A[t]=r.split("/").reverse().join("")}}}})}if(d){g(Object.keys(d),function(e,t){if(c[t]["type"]==="Edm.String"){if(c[t]["sap:semantics"]==="yearmonth"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYMM"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearquarter"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYQ"}).format(d[t]):d[t]}else if(c[t]["sap:semantics"]==="yearweek"||c[t]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){d[t]=d[t].constructor===Date?i.getDateTimeInstance({pattern:"YYYYww"}).format(d[t]):d[t]}else if(c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]&&c[t]["com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"].Bool){var r=d[t];if(r.includes(".")){d[t]=r.split(".").reverse().join("")}else if(r.includes("/")){d[t]=r.split("/").reverse().join("")}}}})}var V=o.getProperty("/entityType"),Y=V[o.getProperty("/presentationAnnotationPath")];if(V){var x=r.getRequestFields(Y);if(x&&x.length>0){g(x,function(e,t){if(!A.hasOwnProperty(t)){A[t]=_[h][t]}})}}var M={getObject:function(){return A},getAllData:function(){return d}};if(l.checkIfAPIIsUsed(t)){if(t.checkAPINavigation()){s.onContentClicked(M)}}else{if(T){t.doNavigation(M,T,n)}}}}})}function ce(e){if(e.EnumMember.endsWith("Bubble")){return true}else{return false}}function ve(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.PropertyPath){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.DIMENSIONS_MANDATORY);return t}t=true;return t}function pe(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Measure||!e[0].Measure.PropertyPath){N.error(C.CHART_ANNO_ERROR+"in "+C.CHART_ANNO+" "+C.MEASURES_MANDATORY);return t}t=true;return t}function me(e){return e.name}function ge(e){if(e&&e.indexOf("#")!=-1){var t=e.split("#");if(t.length>1){return t[1]}}return""}function Ae(e,t){var r=t.getModel("ovpCardProperties");var a=de(t);var i=+a.itemsLength;var n=+r.getProperty("/dataStep");if(i&&n){var o=e.colSpan-1;if(o>=0){i+=n*o;Pe(t,i)}}}function de(e){var t=e.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/presentationAnnotationPath");var i=r.hasOwnProperty(a)&&r[a];var n=i&&i.MaxItems;if(n){var o=n.Int32?n.Int32:n.Int;return{itemsLength:+o,dataStep:+t.getProperty("/dataStep")}}}function Pe(e,t){var r,a={},i=[];var n=e.getVizType();var o=e.getModel("ovpCardProperties");var s=o.getProperty("/entityType");var l=o.getProperty("/chartAnnotationPath");var u=s[l];var f=e.getParent();var c=f.getBinding("data");a.path=c.getPath();a.parameters={};if(c.mParameters&&c.mParameters.select){a.parameters.select=c.mParameters.select}a.parameters.custom=a.parameters.custom||{};a.parameters.custom._requestFrom="ovp_internal";a.filters=c.aApplicationFilters;a.sorter=c.aSorters;a.length=n==="donut"?t+1:t;a.template=new v;f.bindAggregation("data",a);if(n==="donut"){g(u.MeasureAttributes,function(e,t){i.push(t.Measure.PropertyPath)});r={};r.path=c.getPath();r.parameters={};r.parameters.select=i.join(",");r.filters=c.aApplicationFilters;r.sorter=c.aSorters;r.length=1;r.template=new v;f.bindAggregation("aggregateData",r)}f.updateBindingContext()}function he(e){e.sort(function(e,t){if(e.index<t.index){return-1}if(e.index>t.index){return 1}return 0})}function Ee(e){return e.color!==undefined}function Ce(e){return e.dimensionValue}return{constants:E,errorMessages:C,formatItems:R,formatByType:V,returnDateFormat:Y,hideDateTimeAxis:x,checkExists:U,validateCardConfiguration:F,checkNoData:K,getConfig:B,hasTimeSemantics:w,getChartType:k,getPrimitiveValue:z,formThePathForCriticalityStateCalculation:W,checkFlag:Q,buildVizAttributes:ae,setChartUoMTitle:ne,getMetadata:se,getSelectedDataPoint:fe,checkBubbleChart:ce,dimensionAttrCheck:ve,measureAttrCheck:pe,getEntitySet:me,getAnnotationQualifier:ge,reprioritizeContent:Ae,getMaxItems:de,getLabelFromAnnotationPath:oe}},true);
//# sourceMappingURL=VizAnnotationManager.js.map
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object","sap/ui/events/KeyCodes","sap/ui/core/Core"],function(jQuery,e,t,s){"use strict";return e.extend("sap.ovp.ui.UIActions",{constructor:function(e){if(!e||!e.rootSelector||!e.containerSelector||!e.draggableSelector){throw new Error("No configuration object to initialize User Interaction module.")}this.captureStart=null;this.captureMove=null;this.captureEnd=null;this.clickCallback=null;this.clickEvent=null;this.clickHandler=null;this.clone=null;this.cloneClass=null;this.container=null;this.contextMenuEvent=null;this.debug=false;this.dragMoveCallback=null;this.draggable=null;this.placeHolderClass=null;this.draggableSelector=null;this.doubleTapCallback=null;this.doubleTapDelay=null;this.element=null;this.swapTargetElement=null;this.endX=null;this.endY=null;this.isTouch=null;this.lastElement=null;this.lastTapTime=null;this.lockMode=null;this.log=null;this.mode=null;this.mouseDownEvent=null;this.mouseMoveEvent=null;this.mouseUpEvent=null;this.keyUpEvent=null;this.moveTolerance=null;this.moveX=null;this.moveY=null;this.noop=null;this.preventClickFlag=false;this.preventClickTimeoutId=null;this.scrollContainer=null;this.scrollContainerSelector=null;this.scrollEvent=null;this.scrollTimer=null;this.startX=null;this.startY=null;this.switchModeDelay=null;this.tapsNumber=null;this.timer=null;this.scrollHandler=null;this.touchCancelEvent=null;this.dragStartCallback=null;this.dragEndCallback=null;this.endCallback=null;this.touchEndEvent=null;this.touchMoveEvent=null;this.beforeDragCallback=null;this.touchStartEvent=null;this.wrapper=null;this.wrapperRect=null;this.scrollEdge=100;this.isRTLEnabled=null;this.resizeStartCallback=null;this.resizeMoveCallback=null;this.resizeEndCallback=null;this.isResize=null;this.isResizeX=null;this.isResizeY=null;this.resizeHandleDistance=null;this.layoutDetails=null;this.init=function(e){this.startX=-1;this.startY=-1;this.moveX=-1;this.moveY=-1;this.endX=-1;this.endY=-1;this.resizeHandleDistance=16;this.isResize=false;this.isResizeX=false;this.isResizeY=false;this.noop=function(){};this.isTouch=e.isTouch?!!e.isTouch:false;this.container=document.querySelector(e.containerSelector);this.scrollContainerSelector=e.scrollContainerSelector||e.containerSelector;this.switchModeDelay=e.switchModeDelay||1500;this.moveTolerance=e.moveTolerance===0?0:e.moveTolerance||1e3;this.draggableSelector=e.draggableSelector;this.mode="normal";this.debug=e.debug||false;this.root=document.querySelector(e.rootSelector);this.tapsNumber=0;this.lastTapTime=0;this.log=this.debug?this.logToConsole:this.noop;this.lockMode=false;this.placeHolderClass=e.placeHolderClass||"";this.cloneClass=e.cloneClass||"";this.wrapper=e.wrapperSelector?document.querySelector(e.wrapperSelector):this.container.parentNode;this.clickCallback=typeof e.clickCallback==="function"?e.clickCallback:this.noop;this.beforeDragCallback=typeof e.beforeDragCallback==="function"?e.beforeDragCallback:this.noop;this.doubleTapCallback=typeof e.doubleTapCallback==="function"?e.doubleTapCallback:this.noop;this.dragEndCallback=typeof e.dragEndCallback==="function"?e.dragEndCallback:this.noop;this.endCallback=typeof e.endCallback==="function"?e.endCallback:this.noop;this.dragStartCallback=typeof e.dragStartCallback==="function"?e.dragStartCallback:this.noop;this.dragMoveCallback=typeof e.dragMoveCallback==="function"?e.dragMoveCallback:this.noop;this.doubleTapDelay=e.doubleTapDelay||500;this.wrapperRect=this.wrapper.getBoundingClientRect();this.scrollEvent="scroll";this.touchStartEvent="touchstart";this.touchMoveEvent="touchmove";this.touchEndEvent="touchend";this.mouseDownEvent="mousedown";this.mouseMoveEvent="mousemove";this.mouseUpEvent="mouseup";this.keyUpEvent="keyup";this.contextMenuEvent="contextmenu";this.touchCancelEvent="touchcancel";this.clickEvent="click";this.layoutDetails=e.layout?e.layout.dashboardLayoutUtil:null;this.isRTLEnabled=s.getConfiguration().getRTL();this.resizeStartCallback=typeof e.resizeStartCallback==="function"?e.resizeStartCallback:this.noop;this.resizeMoveCallback=typeof e.resizeMoveCallback==="function"?e.resizeMoveCallback:this.noop;this.resizeEndCallback=typeof e.resizeEndCallback==="function"?e.resizeEndCallback:this.noop;if(this.wrapper){jQuery(this.wrapper).css({position:"relative",top:0,left:0,right:0,bottom:0,"-webkit-transform":"translateZ(0)",transform:"translateZ(0)"})}};this.forEach=function(e,t){return Array.prototype.forEach.call(e,t)};this.indexOf=function(e,t){return Array.prototype.indexOf.call(e,t)};this.insertBefore=function(e,t,s){var i,l,n;n=Array.prototype.splice;i=this.indexOf(e,t);l=this.indexOf(e,s);n.call(e,l-(i<l?1:0),0,n.call(e,i,1)[0])};this.logToConsole=function(){window.console.log.apply(console,arguments)};this.getDraggableElement=function(e){var t;this.draggable=jQuery(this.draggableSelector,this.container);while(typeof t==="undefined"&&e!==this.root){if(this.indexOf(this.draggable,e)>=0){t=e}e=e.parentNode}return t};this.captureStart=function(e){var t;if(e.type==="touchstart"&&e.touches.length===1){t=e.touches[0]}else if(e.type==="mousedown"){t=e;if(e.which!==1){return}}if(t){this.element=this.getDraggableElement(t.target);this.startX=t.pageX;this.startY=t.pageY;this.lastMoveX=0;this.lastMoveY=0;if(this.element){var s=jQuery(this.element);var i=s.offset().left;var l=s.offset().top;var n=s.height();var a=s.width();if(this.layoutDetails){var o=this.isRTLEnabled?this.startX-i<this.resizeHandleDistance:i+a-this.startX<this.resizeHandleDistance;var r=l+n-this.startY<this.resizeHandleDistance;if(o||r){if(o&&r){this.isResizeX=false;this.isResizeY=false}else if(!o&&r){this.isResizeX=false;this.isResizeY=true}else if(o&&!r){this.isResizeX=true;this.isResizeY=false}this.isResize=true}}else{var h=i+a-this.startX;var c=l+n-this.startY;if(h<this.resizeHandleDistance&&c<this.resizeHandleDistance){this.isResize=true}}}if(this.lastTapTime&&this.lastElement&&this.element&&this.lastElement===this.element&&Math.abs(Date.now()-this.lastTapTime)<this.doubleTapDelay){this.lastTapTime=0;this.tapsNumber=2}else{this.lastTapTime=Date.now();this.tapsNumber=1;this.lastElement=this.element}this.log("captureStart("+this.startX+", "+this.startY+")")}};this.startHandler=function(e){this.log("startHandler");this.captureStart(e);if(this.element){this.beforeDragCallback(e,this.element);if(this.lockMode===false){if(this.tapsNumber===2){this.mode="double-tap";return}if(e.type==="touchstart"){this.timer=setTimeout(function(){if(this.isResize){this.log("mode switched to resize");this.mode="resize";this.resizeStartCallback(e,this.element)}else{this.log("mode switched to drag");this.mode="drag";this.createClone();this.dragStartCallback(e,this.element)}}.bind(this),this.switchModeDelay)}}}}.bind(this);this.captureMove=function(e){var t;if(e.type==="touchmove"&&e.touches.length===1){t=e.touches[0]}else if(e.type==="mousemove"){t=e}if(t){this.moveX=t.pageX;this.moveY=t.pageY;this.log("captureMove("+this.moveX+", "+this.moveY+")")}};this.moveHandler=function(e){this.log("moveHandler");this.captureMove(e);switch(this.mode){case"normal":if(Math.abs(this.startX-this.moveX)>this.moveTolerance||Math.abs(this.startY-this.moveY)>this.moveTolerance){if(e.type==="touchmove"){this.log("-> normal");clearTimeout(this.timer);delete this.timer}else if(this.element){if(this.isResize){this.log("mode switched to resize");this.mode="resize"}else{this.log("mode switched to drag");this.mode="drag";this.createClone()}}}break;case"drag":e.preventDefault();this.log("-> drag");this.mode="drag-and-scroll";window.addEventListener(this.mouseUpEvent,this.endHandler,true);window.addEventListener(this.keyUpEvent,this.endHandler,true);this.translateClone();this.scrollContainer=document.querySelector(this.scrollContainerSelector);if(e.type==="mousemove"){this.dragStartCallback(e,this.element)}break;case"drag-and-scroll":e.stopPropagation();e.preventDefault();this.log("-> drag-and-scroll");this.translateClone();this.dragMoveCallback({evt:e,clone:this.clone,element:this.element,draggable:this.draggable,moveX:this.moveX,moveY:this.moveY});break;case"resize":e.preventDefault();this.log("-> resize");this.mode="resize-and-scroll";window.addEventListener(this.mouseUpEvent,this.endHandler,true);this.scrollContainer=document.querySelector(this.scrollContainerSelector);if(e.type==="mousemove"){this.resizeStartCallback(e,this.element)}break;case"resize-and-scroll":e.stopPropagation();e.preventDefault();this.log("-> resize-and-scroll");this.resizeMoveCallback({evt:e,element:this.element,draggable:this.draggable,moveX:this.moveX,moveY:this.moveY});break;default:break}}.bind(this);this.captureEnd=function(e){var t;if((e.type==="touchend"||e.type==="touchcancel")&&e.changedTouches.length===1){t=e.changedTouches[0]}else if(e.type==="mouseup"){t=e}if(t){this.endX=t.pageX;this.endY=t.pageY;this.log("captureEnd("+this.endX+", "+this.endY+")")}};this.contextMenuHandler=function(e){if(this.isTouch){e.preventDefault()}}.bind(this);this.clickHandler=function(e){var t=document.getElementsByClassName("viz-controls-chartTooltip");var i=t&&t[0]&&t[0].id;var l=s.byId(i);if(l){var n=l&&l.aDelegates[0]&&l.aDelegates[0].oDelegate;if(n){n.close()}}if(this.preventClickFlag){this.preventClickFlag=false;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();clearTimeout(this.preventClickTimeoutId)}this.clickCallback()}.bind(this);this.preventClick=function(){this.preventClickFlag=true;this.preventClickTimeoutId=setTimeout(function(){this.preventClickFlag=false}.bind(this),100)};this.endHandler=function(e){this.log("endHandler");if(e.type==this.keyUpEvent&&e.which==t.ESCAPE||e.type==this.mouseUpEvent||e.type==this.touchEndEvent){this.captureEnd(e);switch(this.mode){case"normal":this.log("-> normal");break;case"drag":this.log("-> drag");this.dragEndCallback(e,this.element,this.clone);this.preventClick();break;case"drag-and-scroll":this.log("-> drag-and-scroll");window.removeEventListener(this.mouseUpEvent,this.endHandler,true);this.dragEndCallback(e,this.element,this.clone);this.preventClick();e.stopPropagation();e.preventDefault();break;case"double-tap":this.log("-> double-tap");this.doubleTapCallback(e,this.element);break;case"resize":this.log("-> resize");this.isResize=false;this.resizeEndCallback(e,this.element);this.preventClick();break;case"resize-and-scroll":this.log("-> resize-and-scroll");window.removeEventListener(this.mouseUpEvent,this.endHandler,true);this.isResize=false;this.resizeEndCallback(e,this.element);this.preventClick();e.stopPropagation();e.preventDefault();break;default:break}if(this.element){this.endCallback(e,this.element)}clearTimeout(this.timer);delete this.timer;this.lastMoveX=0;this.lastMoveY=0;this.swapTargetElement=null;this.element=null;this.mode="normal"}}.bind(this);this.defaultDragStartHandler=function(e){e.preventDefault()};this.scrollHandler=function(){clearTimeout(this.scrollTimer);this.lockMode=true;this.scrollTimer=setTimeout(function(){this.lockMode=false}.bind(this),500)}.bind(this);this.createClone=function(){var e,t;if(this.clone){this.removeClone()}t=this.element.getBoundingClientRect();this.clone=this.element.cloneNode(true);var s=this.element.querySelectorAll("canvas");if(s.length){var i=this.clone.querySelectorAll("canvas");for(var l=0;l<s.length;l++){i[l].getContext("2d").drawImage(s[l],0,0)}}this.clone.className+=" "+this.cloneClass;if(!this.layoutDetails){this.element.className+=" "+"easyScanLayoutItemWrapper-placeHolder"}else{this.element.className+=" "+"dashboardLayoutItemWrapper-placeHolder"}e=this.clone.style;e.position="absolute";e.display="block";e.top=t.top-this.root.getBoundingClientRect().top+"px";e.left=t.left-this.root.getBoundingClientRect().left+"px";e.width=t.width+"px";e.zIndex="100";e.webkitTransition="-webkit-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.mozTransition="-moz-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.msTransition="-ms-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.transition="transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.webkitTransform="translate3d(0px, 0px, 0px) ";e.mozTransform="translate3d(0px, 0px, 0px) ";e.msTransform="translate3d(0px, 0px, 0px) ";e.transform="translate3d(0px, 0px, 0px) ";this.root.appendChild(this.clone);this.log("createClone")};this.removeClone=function(){if(this.element!==null&&typeof this.element!=="undefined"){this.element.className=this.element.className.split(" "+this.placeHolderClass).join("")}if(this.clone!==null){this.clone.parentElement.removeChild(this.clone);this.clone=null;this.log("removeClone")}};this.translateClone=function(){var e,t;e=this.moveX-this.startX;t=this.moveY-this.startY;if(this.clone&&e&&t){this.clone.style.webkitTransform="translate3d("+e+"px, "+t+"px, 0px)";this.clone.style.mozTransform="translate3d("+e+"px, "+t+"px, 0px)";this.clone.style.msTransform="translate("+e+"px, "+t+"px)";this.clone.style.transform="translate3d("+e+"px, "+t+"px, 0px)";this.log("translateClone ("+e+", "+t+")")}};this.enable=function(){this.log("enable");this.root.addEventListener(this.touchStartEvent,this.startHandler,false);this.root.addEventListener(this.touchMoveEvent,this.moveHandler,true);this.root.addEventListener(this.touchEndEvent,this.endHandler,false);this.root.addEventListener(this.touchCancelEvent,this.endHandler,false);this.root.addEventListener(this.mouseMoveEvent,this.moveHandler,true);this.root.addEventListener(this.mouseDownEvent,this.startHandler,false);this.root.addEventListener(this.mouseUpEvent,this.endHandler,false);this.root.addEventListener(this.contextMenuEvent,this.contextMenuHandler,false);this.root.addEventListener(this.clickEvent,this.clickHandler,true);this.wrapper.addEventListener(this.scrollEvent,this.scrollHandler,false);return this};this.disable=function(){this.log("disable");this.root.removeEventListener(this.touchStartEvent,this.startHandler,false);this.root.removeEventListener(this.touchMoveEvent,this.moveHandler,true);this.root.removeEventListener(this.touchEndEvent,this.endHandler,false);this.root.removeEventListener(this.mouseDownEvent,this.startHandler,false);this.root.removeEventListener(this.mouseMoveEvent,this.moveHandler,true);this.root.removeEventListener(this.mouseUpEvent,this.endHandler,false);this.root.removeEventListener(this.contextMenuEvent,this.contextMenuHandler,false);this.root.removeEventListener(this.clickEvent,this.clickHandler,true);this.root.removeEventListener(this.touchCancelEvent,this.endHandler,false);this.wrapper.removeEventListener(this.scrollEvent,this.scrollHandler,false);return this};this.init(e);this.getMove=function(){return{x:this.moveX,y:this.moveY}}}})});
//# sourceMappingURL=UIActions.js.map
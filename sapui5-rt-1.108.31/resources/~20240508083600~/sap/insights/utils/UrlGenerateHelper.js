/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel"],function(e,a,t,r,i,n,o){function l(t,r,i){var n=t.descriptorContent["sap.card"].configuration.parameters;var l=t.descriptorContent["sap.card"]["data"]["request"];var p=false,v={},m={};if(l&&l.batch){p=true;v=l.batch.header||{};m=l.batch.content||{}}var d=t&&n._headerDataUrl,T=t&&n._contentDataUrl;var g=new a;var h=n._relevantODataFilters.value;var S=n._relevantODataParameters.value;var D=n._semanticDateRangeSetting,y=[];if(D){D=JSON.parse(D.value);y=Object.keys(D)||[]}h.forEach(function(e){var t=new a(n[e].value);var r=t.getSelectOption(e);var i=[];if(r&&r.length){if(y.includes(e)){i=c(r[0],"Filter");if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}g.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}g.massAddSelectOption(e,r)}}});S.forEach(function(e){var a="";if(n[e].value&&typeof n[e].value==="string"){a=n[e].value.toString()}else if(n[e].value.value){a=n[e].value.value.toString()}else if(n[e].value&&n[e].value instanceof Date){a=n[e].value}if(n[e].type==="datetime"&&!y.includes(e)&&!a.includes("datetime")){if(o&&o.prototype.formatValue){a=o.prototype.formatValue(a,"Edm.DateTime");g.addParameter(e,a)}}else if(n[e].type==="datetime"&&y.includes(e)){a=c(a,"Parameter");g.addParameter(e,a[0])}else{g.addParameter(e,a)}});var E=n._entitySet.value;var A=E;if(S.length){var O={};S.forEach(function(e){O[e]=n[e].type});A+=e.getParameterQueryFromSV(g,O);var H=A;if(H&&Array.isArray(H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){A=f(H)}}if(n._urlSuffix.value){A+=n._urlSuffix.value}var _={};h.forEach(function(e){_[e]=n[e].type});var L=e.getFilterQueryFromSV(g,_);var N=L;if(N&&Array.isArray(N.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&N.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){L=f(N)}var Q="",R="",x="",I="",U={header:"",content:""};if(p){Q=s(n,"_header",L,t.descriptorContent["sap.card"].type);R=Q?A+"?"+Q:A;if(d&&d.value){var w=u(y,R);if(w){v.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";d.value=""}else{d.value=R;if(r){r._headerDataUrl=d.value}}}else if(d){if(r&&!i){d.value=R;r._headerDataUrl=d.value}U.header=R}}if(n._contentDataUrl){x=s(n,"_content",L,t.descriptorContent["sap.card"].type);I=x?A+"?"+x:A;if(n._contentDataUrl.value){var F=u(y,I);if(F){if(p){m.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{l.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}T.value=""}else{T.value=I;if(r){r._contentDataUrl=T.value}}}else{if(r&&!i){T.value=I;r._contentDataUrl=T.value}U.content=I;return U}if(i){U.header=R;U.content=I;return U}}}function u(e,a){var t=e.length?e:[];if(t.length&&a){return t.some(function(e){return a&&a.indexOf(e)>-1})}}function s(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function f(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function c(e,a){var r,i=[],o=[];if(a==="Parameter"){r=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;r=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(r)){i=e.High.split(",")}}var l;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(r)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(r)){if(a==="Filter"){l=t.toDates({values:i,operator:r});o.push(l[0].oDate);o.push(l[1].oDate)}else{l=t.toDates({values:i,operator:r});o.push(l[0].oDate)}}if(o.length){o=p(o,true);return o}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return p([e],true)}return[]}function p(e,a){var t;e.forEach(function(n,o){if(n.match){if(n.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&n.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){n=new Date(n)}}n=r.localToUtc(n);n=r.normalizeDate(n,true);if(a){t=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[o]=t.format(n,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var u=n instanceof Date?n:new Date(n);var s=l.format(u);e[o]=String(s).replace(/'/g,"")}});return e}function v(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!a){var o=e.operator;var l=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":u="";if(typeof i==="string"){u=i}var s=t.toDates(e);l=s;var f=p(l,false);if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var v=p(l,false),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:v[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:l[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=l&&l[0];var g=l&&l[1];return{Low:o,High:T.toString()+","+g.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:l,formatSemanticDateTime:c,getDateRangeValue:v}});
//# sourceMappingURL=UrlGenerateHelper.js.map
// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/OverflowToolbarPriority","sap/m/Popover","sap/m/ResponsivePopover","sap/m/Title","sap/m/ToggleButton","sap/ui/core/Core","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/Device","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData"],function(e,t,o,l,s,i,n,p,a,r,h,u,c,v,y,A,d,f,g,M){"use strict";var S=f.AppTitleState;var P=f.AllMyAppsState;var T=l.PlacementType;var b=t.extend("sap.ushell.ui.shell.ShellAppTitle",{metadata:{library:"sap.ushell",properties:{title:{type:"string",group:"Data",defaultValue:null},subTitle:{type:"string",group:"Data",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:"sap-icon://folder"}},associations:{navigationMenu:{type:"sap.ushell.ui.shell.ShellNavigationMenu"},allMyApps:{type:"sap.ui.core.mvc.View"}},events:{textChanged:{deprecated:true}}},renderer:{apiVersion:2,render:function(e,t){var o=t._getControlVisibilityAndState();var l=t.getText();var s=t.getModel();e.openStart("h1");e.class("sapUiPseudoInvisibleText");e.attr("aria-level","1");e.openEnd();e.text(l||"");e.close("h1");e.openStart("div",t);e.class("sapUshellHeadTitle");if(o||y.system.phone){e.class("sapUshellAppTitleClickable")}e.openEnd();e.openStart("div",t.getId()+"-button");e.class("sapUshellAppTitle");if(o||y.system.phone){e.attr("tabindex","0")}if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(o){e.attr("role","button");e.attr("aria-haspopup","dialog");if(s&&b._getCurrentState()===S.AllMyAppsOnly){e.attr("aria-label",g.i18n.getText("ShowAllMyApps_AriaLabel",[l]))}else{e.attr("aria-label",g.i18n.getText("ShellNavigationMenu_AriaLabel",[l]))}}e.openEnd();if(y.media.getCurrentRange(y.media.RANGESETS.SAP_STANDARD).name!=="Phone"){e.openStart("span");e.class("sapUshellAppTitleText");e.openEnd();e.text(l||"");e.close("span")}if(o&&l){e.openStart("span");e.class("sapUshellShellHeadAction");e.openEnd();e.renderControl(t.oIcon);e.close("span")}e.close("div");e.close("div")}}});b.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oIcon=v.createControlByURI(v.getIconURI("slim-arrow-down"));this.oIcon.addStyleClass("sapUshellAppTitleMenuIcon");if(y.system.desktop){this.addEventDelegate({onkeydown:function(e){if(e.altKey&&e.keyCode===40){this.onclick(e)}}.bind(this)})}};b.prototype.getFocusDomRef=function(){return this.getDomRef("button")};b._getCurrentState=function(){return d.last("/core/shellHeader/ShellAppTitleState")};b.prototype.onclick=function(e){e.preventDefault();this.firePress();if(!this._getControlVisibilityAndState()){if(y.system.phone){window.hasher.setHash(d.last("/core/shellHeader/rootIntent"))}return}if(b._getCurrentState()===S.AllMyAppsOnly){A.start("FLP:ShellAppTitle.onClick","Click ShellAppTitle in HOME state, Launching AllMyApps","FLP");this._openCloseAllMyAppsPopover();return}this._openCloseNavMenuPopover()};b.prototype._openCloseAllMyAppsPopover=function(){if(!this.oAllMyAppsPopover){this.oAllMyAppsPopover=this._createAllMyAppsPopover()}if(this.oAllMyAppsPopover){if(this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}else{this.oAllMyAppsPopover.openBy(this)}}};b.prototype._openCloseNavMenuPopover=function(){if(!this.oNavMenuPopover){this.oNavMenuPopover=this._createNavMenuPopover()}this.getModel().setProperty("/ShellAppTitleState",S.ShellNavMenu);if(this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}else{this.oNavMenuPopover.openBy(this)}if(this.oNavMenuPopover.getFooter()){var e=d.last("/core/shell/model/currentState/stateName");this.oNavMenuPopover.getFooter().setVisible(e==="home"||e==="app")}};b.prototype._getControlVisibilityAndState=function(){A.start("FLP:ShellAppTitle.getControlVisibilityAndState","Check AllMyApps and NavShellMenu visibility","FLP");var e=this.getModel();var t=d.last("/core/shell/model/currentState/stateName");var o=this._isNavMenuEnabled();var l=o;if(!e){return false}if(t==="app"||t==="home"){var s=d.last("/core/services/allMyApps/enabled");l=s||o;if(s&&o){e.setProperty("/ShellAppTitleState",S.ShellNavMenu)}else if(!s&&o){e.setProperty("/ShellAppTitleState",S.ShellNavMenuOnly)}else if(s&&!o){e.setProperty("/ShellAppTitleState",S.AllMyAppsOnly)}}else{e.setProperty("/ShellAppTitleState",S.ShellNavMenuOnly)}A.end("FLP:ShellAppTitle.getControlVisibilityAndState");return l};b.prototype._createAllMyAppsPopover=function(){var e=u.byId(this.getAllMyApps());if(!e){return null}var t=new a("sapUshellAllMyAppsPopover",{placement:T.Bottom,title:"",showArrow:true,customHeader:this._getPopoverHeader(),verticalScrolling:false,showHeader:{path:"/ShellAppTitleState",formatter:function(e){return e!==S.ShellNavMenu}},content:[e],contentHeight:"28rem",contentWidth:"56rem"}).addStyleClass("sapContrastPlus");t.setModel(this.getModel());t.attachAfterOpen(function(){e.getController()._afterOpen();var o=t.getCustomHeader();var l=o.getContentLeft()[0];var s=o.getContentLeft()[1];if(s.getVisible()){s.firePress();s.setPressed(true)}l.focus()});t.attachAfterClose(this._afterCloseAllMyAppsPopover.bind(this));return t};b.prototype._afterCloseAllMyAppsPopover=function(){this._bPressedSpace=false;if(this._bOpenNavigationMenu===true){this._bOpenNavigationMenu=false;this.oNavMenuPopover.openBy(this)}else if(!y.system.phone){this.focus()}};b.prototype._createNavMenuPopover=function(){var e=u.byId(this.getNavigationMenu());this.oTitle=new o("navMenuInnerTitle",{design:"Bold",text:"{/application/title}",layoutData:new i({priority:n.High,shrinkable:false})});this.oSecondTitle=new o("navMenuInnerSecondTitle",{text:"{/title}",layoutData:new i({priority:n.Low,shrinkable:false})});this.oIconControl=new c({src:"{/application/icon}",layoutData:new i({priority:n.NeverOverflow,shrinkable:false})});this.oTitleBar=new s("navMenuTitleBar",{content:[this.oIconControl,this.oTitle,this.oSecondTitle]});var t=new p("sapUshellAppTitlePopover",{placement:T.Bottom,showArrow:true,showHeader:false,contentWidth:"20rem",horizontalScrolling:false,content:[this.oTitleBar,e]}).addStyleClass("sapContrastPlus");if(d.last("/core/services/allMyApps/enabled")){t.setFooter(this._getPopoverFooterContent())}t.addStyleClass("sapUshellAppTitleNavigationMenuPopover");t.setModel(this.getModel());d.emit("/core/shell/model/allMyAppsMasterLevel",P.FirstLevel);t.attachBeforeOpen(function(){e._beforeOpen()});t.attachAfterOpen(function(){e.$().on("touchmove.scrollFix",function(e){e.stopPropagation()});e._afterOpen()});t.attachAfterClose(this._afterCloseNavigationMenuPopover.bind(this));return t};b.prototype._afterCloseNavigationMenuPopover=function(){this._bPressedSpace=false;if(this._bOpenAllMyApps){this._bOpenAllMyApps=false;this._openCloseAllMyAppsPopover()}else if(!y.system.phone){this.focus()}};b.prototype._setAllMyAppsTitle=function(e){var t=d.last("/core/shellHeader");if(t.title&&t.ShellAppTitleState==="AllMyAppsOnly"||t.ShellAppTitleState==="AllMyApps"){e=e+" - "+t.title}r.prototype.setText.apply(this,[e])};b.prototype._getPopoverHeader=function(){var t=new r({text:g.i18n.getText("allMyApps_headerTitle"),level:"H1"});t.setText=this._setAllMyAppsTitle.bind(t);var o=new e("sapUshellShellAppPopoverHeader",{contentLeft:[this._createPopoverBackButton(),this._createPopoverToggleButton()],contentMiddle:[t]});return o};b.prototype.onAfterRendering=function(){var e=u.byId("shell-header");if(e){e.refreshLayout()}};b.prototype._createPopoverBackButton=function(){var e=new t("sapUshellAppTitleBackButton",{icon:v.getIconURI("nav-back"),press:[this._popoverBackButtonPressHandler,this],tooltip:g.i18n.getText("backBtn_tooltip"),visible:this.getAllMyAppsController().getBackButtonVisible()});e.addStyleClass("sapUshellCatalogNewGroupBackButton");return e};b.prototype._popoverBackButtonPressHandler=function(){var e=this.getAllMyAppsController();var t=e.getCurrentState();if(t===P.FirstLevel||t===P.FirstLevelSpread){if(b._getCurrentState()!==S.AllMyAppsOnly){this.getModel().setProperty("/ShellAppTitleState",S.ShellNavMenu);this.oAllMyAppsPopover.close();this._bOpenNavigationMenu=true}}else if(t===P.SecondLevel){e.switchToInitialState()}else{e.handleSwitchToMasterAreaOnPhone()}e.updateHeaderButtonsState()};b.prototype._createPopoverToggleButton=function(){var e=this.getAllMyAppsController();var t=new h("sapUshellAllMyAppsToggleListButton",{icon:v.getIconURI("sap-icon://menu2"),press:function(t){e.switchToInitialState();this.setTooltip(t.getParameter("pressed")?g.i18n.getText("ToggleButtonHide"):g.i18n.getText("ToggleButtonShow"))},tooltip:g.i18n.getText("ToggleButtonShow"),visible:e.getToggleListButtonVisible()});y.media.attachHandler(function(){t.setVisible(e.getToggleListButtonVisible())},this,y.media.RANGESETS.SAP_STANDARD);t.addStyleClass("sapUshellAllMyAppsToggleListButton");return t};b.prototype._getPopoverFooterContent=function(){var o=new t("allMyAppsButton",{text:g.i18n.getText("allMyApps_launchingButtonTitle"),press:this._allMyAppsButtonPressHandler.bind(this),visible:{path:"/ShellAppTitleState",formatter:function(e){return e===S.ShellNavMenu}}});var l=new e("shellpopoverFooter",{contentMiddle:[o]});this.addCustomData(o,"role","button");this.addCustomData(o,"aria-label",g.i18n.getText("allMyApps_launchingButtonTitle"));return l};b.prototype._allMyAppsButtonPressHandler=function(){if(u.byId(this.getAllMyApps())){A.start("FLP:ShellNavMenu.footerClick","Click the footer of ShellNavMenu, Launching AllMyApps","FLP");this.getModel().setProperty("/ShellAppTitleState",S.AllMyApps);this.oNavMenuPopover.close();this._bOpenAllMyApps=true}};b.prototype._isNavMenuEnabled=function(){var e=u.byId(this.getNavigationMenu());return e?e.getItems()&&e.getItems().length>0:false};b.prototype.addCustomData=function(e,t,o){e.addCustomData(new M({key:t,value:o,writeToDom:true}))};b.prototype.close=function(){if(this.oNavMenuPopover&&this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}if(this.oAllMyAppsPopover&&this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}};b.prototype.setTooltip=function(e){this.setAggregation("tooltip",e);this.oIcon.setTooltip(e)};b.prototype.getAllMyAppsController=function(){var e=u.byId(this.getAllMyApps());return e.getController()};b.prototype.onkeyup=function(e){if(e.keyCode===32){this.onclick(e)}};b.prototype.onsapenter=b.prototype.onclick;b.prototype.exit=function(){var e=u.byId(this.getNavigationMenu());var t=u.byId(this.getAllMyApps());if(e){e.destroy()}if(t){t.destroy()}if(this.oAllMyAppsPopover){this.oAllMyAppsPopover.destroy()}if(this.oNavMenuPopover){this.oNavMenuPopover.destroy()}if(this.oIcon){this.oIcon.destroy()}};return b},true);
//# sourceMappingURL=ShellAppTitle.js.map
//@ui5-bundle sap/ushell/components/workPageRuntime/Component-preload.js
sap.ui.require.preload({
	"sap/ushell/components/workPageRuntime/Component.js":function(){
//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/UIComponent"],function(t){"use strict";return t.extend("sap.ushell.components.workPageRuntime.Component",{metadata:{manifest:"json",library:"sap.ushell"},getNavigationDisabled:function(){var t=this.getComponentData()||{};return!!t.navigationDisabled},hideRuntime:function(){this.getRootControl().getController().hideRuntime()},onRouteMatched:function(){this.getRootControl().getController().onRouteMatched()}})});
},
	"sap/ushell/components/workPageRuntime/controller/WorkPageRuntime.controller.js":function(){
//Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/mvc/Controller","sap/ushell/components/workPageRuntime/services/WorkPage","sap/ui/model/json/JSONModel","sap/base/util/deepExtend","sap/ushell/EventHub","sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/resources","sap/ushell/Config"],function(e,t,i,o,a,n,s,d,r){"use strict";return t.extend("sap.ushell.components.workPageRuntime.controller.WorkPageRuntime",{onInit:function(){var e=sap.ushell.Container.getRenderer();var t=new URLSearchParams(window.location.search);this.oWorkPageService=new i;this.oOriginalModel=new o;this.oEditModel=new o({editMode:false,loaded:false});this.oWorkPageNavContainer=this.byId("workpageNavContainer");this.oEmptyPage=this.byId("emptyPage");this.oEditModel.setSizeLimit(Infinity);this.getView().setModel(this.oEditModel);return this._getPageId().then(function(i){this._sPageId=i;this._sSiteId=t.get("siteId")||r.last("/core/site/siteId");return this._loadWorkPageAndVisualizations(this._sSiteId,this._sPageId).then(this._handleEditModeButton.bind(this)).then(this._navigate.bind(this)).finally(function(){n.emit("CenterViewPointContentRendered");if(!this.getOwnerComponent().getNavigationDisabled()){this.oContainerRouter=e.getRouter();this.oContainerRouter.getRoute("home").attachMatched(this.onRouteMatched.bind(this,false));this.oContainerRouter.getRoute("openFLPPage").attachMatched(this.onRouteMatched.bind(this,false));this.oContainerRouter.getRoute("openWorkPage").attachMatched(this.onRouteMatched.bind(this,false))}n.on("WorkPageHasChanges").do(this._onWorkPageChanged.bind(this))}.bind(this))}.bind(this)).catch(this._handleErrors.bind(this))},_handleEditModeButton:function(){var e=this.oOriginalModel.getProperty("/editable");var t=sap.ushell.Container.getUser().isAdminUser();if(e&&t){return this._createEditModeButton(this._createEditButtonControlProperties())}this._hideEditModeButton();return Promise.resolve()},_onWorkPageChanged:function(e){this.oEditModel.setProperty("/workPageHasChanges",!!e);sap.ushell.Container.setDirtyFlag(!!e)},_navigate:function(){this.oWorkPageNavContainer.to(this.byId("workPage"))},_createEditButtonControlProperties:function(){var t=d.i18n.getText("WorkpageRuntime.EditMode.Activate");e.debug("cep/editMode: create Edit Button","Workpage runtime");return{id:"EditModeBtn",text:t,icon:"sap-icon://edit",press:[this.pressEditModeButton,this]}},_createEditModeButton:function(e){var t={controlType:"sap.ushell.ui.launchpad.ActionItem",oControlProperties:e,bIsVisible:true,aStates:["home"]};this._showEditModeButton();return sap.ushell.Container.getRenderer("fiori2").addUserAction(t).then(function(e){if(r.last("/core/extension/enableHelp")){e.addStyleClass("help-id-EditModeBtn")}})},_setEditButtonText:function(e){if(e){var t=sap.ui.getCore().byId("EditModeBtn");if(t){var i=d.i18n.getText(e);t.setText(i);t.setTooltip(i)}}},pressEditModeButton:function(){if(this.oEditModel.getProperty("/editMode")){if(this.oEditModel.getProperty("/workPageHasChanges")){this._saveChanges()}else{this._toggleEditMode(false)}}else{this._toggleEditMode(true)}},_toggleEditMode:function(t){n.emit("enableMenuBarNavigation",!t);e.debug("cep/editMode: toggle edit mode"," Work Page runtime");this.oEditModel.setProperty("/editMode",t);this._setEditButtonText(t?"PageRuntime.EditMode.Exit":"WorkpageRuntime.EditMode.Activate");n.emit("WorkPageHasChanges",false)},_cancelChanges:function(){this._toggleEditMode(false);this._setModels()},_saveChanges:function(){var e=this.getView();e.setBusy(true);this._updateWorkPage().then(function(e){sap.ui.require(["sap/m/MessageToast"],function(e){e.show(d.i18n.getText("savedChanges"),{duration:4e3})});this._toggleEditMode(false);this._setModels()}.bind(this)).catch(function(e){var t=e.responseText||e;sap.ui.require(["sap/m/MessageBox"],function(i){i.error(t,{title:e.statusText})})}).finally(function(){e.setBusy(false)})},_closeEditMode:function(e){(e.getParameter("saveChanges")?this._saveChanges:this._cancelChanges).bind(this)()},onWorkPageBuilderCreated:function(e){var t=e.getParameter("component");t.attachEvent("loadCatalog",this._loadCatalog.bind(this));t.attachEvent("closeEditMode",this._closeEditMode.bind(this))},_loadWorkPageAndVisualizations:function(e,t){return this.oWorkPageService.loadWorkPageAndVisualizations(e,t).then(this._setModels.bind(this))},_loadWorkPage:function(t,i){e.debug("cep/editMode: load Work Page: "+i,"Work Page runtime");return this.oWorkPageService.loadWorkPage(t,i).then(function(){var e=this.oWorkPageService.getAllVizIds(this.oWorkPageService.getModel().getData());this.oWorkPageService.loadVisualizations(t,e).then(this._setModels.bind(this))}.bind(this))},_loadCatalog:function(e){return this.oWorkPageService.loadCatalog("",e.getParameters()).then(function(){this.oEditModel.setProperty("/data/Catalog",this.oWorkPageService.getModel().getProperty("/data/Catalog"));this.oEditModel.firePropertyChange({type:"Catalog"})}.bind(this))},_updateWorkPage:function(){var e=a({Id:this._sPageId},this.oEditModel.getProperty("/data/WorkPage"));return this.oWorkPageService.updateWorkPage(this._sPageId,e)},_setModels:function(){var e=this.oWorkPageService.getModel().getData();this.oOriginalModel.setData(a({},e));if(this.oEditModel.getProperty("/editMode")===true){this._toggleEditMode(false)}this.oEditModel.setData(a({editMode:false,loaded:true,workPageHasChanges:false},e));this.getView().setModel(this.oEditModel)},_hideEditModeButton:function(){var t=sap.ui.getCore().byId("EditModeBtn");e.debug("cep/editMode: hide Edit Mode button","Work Page runtime");if(t){t.setVisible(false)}},_showEditModeButton:function(){var t=sap.ui.getCore().byId("EditModeBtn");e.debug("cep/editMode: show Edit Mode button","Work Page runtime");if(t){t.setVisible(true)}},_handleErrors:function(t){this._hideEditModeButton();e.error("An error occurred while loading the page",t);e.debug("cep/editMode: on Route matched: Handle errors","Work Page runtime");this.oWorkPageNavContainer.to(this.byId("errorPage"))},onRouteMatched:function(){e.debug("cep/editMode: on Route matched","Work Page runtime");return this._getPageId().then(function(e){this._sPageId=e;return this._loadWorkPageAndVisualizations(this._sSiteId,this._sPageId).then(this._navigate.bind(this))}.bind(this)).then(this._handleEditModeButton.bind(this)).catch(this._handleErrors.bind(this))},_getPageId:function(){if(r.last("/core/workPages/myHome/pageId")){return Promise.resolve(r.last("/core/workPages/myHome/pageId"))}return s._getPageAndSpaceId().then(function(e){return e.pageId})},hideRuntime:function(){e.debug("cep/editMode: navigate to empty page","Page runtime");this._hideEditModeButton();this.oWorkPageNavContainer.to(this.oEmptyPage)}})});
},
	"sap/ushell/components/workPageRuntime/manifest.json":'{"_version":"1.39.0","sap.app":{"id":"sap.ushell.components.workPageRuntime","applicationVersion":{"version":"1.108.31"},"ach":"CA-FLP-FE-UI","type":"component","title":""},"sap.ui":{"fullWidth":false,"technology":"UI5","deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"componentUsages":{"pageBuilder":{"name":"sap.ushell.components.workPageBuilder","lazy":true}},"componentName":"sap.ushell.components.workPageRuntime","rootView":{"viewName":"sap.ushell.components.workPageRuntime.view.WorkPageRuntime","type":"XML","async":true},"dependencies":{"minUI5Version":"1.99","libs":{"sap.ui.core":{},"sap.m":{}}},"contentDensities":{"compact":true,"cozy":true}}}',
	"sap/ushell/components/workPageRuntime/services/NavigationResolver.js":function(){
// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ushell/Config","sap/base/Log"],function(e,t,n){"use strict";var i=function(){this._sBaseUrl=t.last("/core/workPages/navigationApiUrl");this._sSiteId=e.get("ushell.site.siteId",window["sap-ushell-config"])};i.prototype._fetchCsrfToken=function(){if(this._oFetchCsrfTokenPromise){return this._oFetchCsrfTokenPromise}this._oFetchCsrfTokenPromise=fetch(this._sBaseUrl,{method:"HEAD",headers:{"x-csrf-token":"fetch","Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()}}).then(function(e){return e.headers.get("x-csrf-token")});return this._oFetchCsrfTokenPromise};i.prototype.resolveByInbound=function(e,t){return this._fetchCsrfToken().then(function(n){return fetch(this._sBaseUrl+"/resolve/inbound",{method:"POST",headers:{"Content-Type":"application/json; utf-8",Accept:"application/json","x-csrf-token":n,"Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()},body:JSON.stringify({inboundIdentifier:e,intentParameters:t,queryParameters:{siteId:this._sSiteId},launchType:"standalone"})}).then(function(e){if(e.ok===false){return Promise.reject(e.statusText)}return e.json()}).then(function(e){var t=e.value||e;var n=Array.isArray(t)?t[0].url:t.url;return{additionalInformation:"",url:n,applicationType:"URL",navigationMode:"newWindow"}})}.bind(this)).catch(function(t){n.error("Tile target for inboundId '"+e+"' could not be resolved. The tile will be shown but will not navigate.");n.error(t);return{additionalInformation:"",url:"",applicationType:"URL",navigationMode:"newWindow"}})};return i},true);
},
	"sap/ushell/components/workPageRuntime/services/WorkPage.js":function(){
// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/HttpClient","sap/ushell/utils/RestrictedJSONModel","sap/ushell/components/workPageRuntime/services/NavigationResolver","sap/base/util/ObjectPath","sap/ushell/Config","sap/base/Log"],function(e,t,r,a,o,i){"use strict";var s=function(){this.httpClient=new e;this._oNavigationResolver=new r;this._oCdmServicePromise=sap.ushell.Container.getServiceAsync("CommonDataModel");this._oCSTRServicePromise=sap.ushell.Container.getServiceAsync("ClientSideTargetResolution");this._sBaseUrl=o.last("/core/workPages/contentApiUrl");this._oWorkPagesModel=new t({editable:false,data:{WorkPage:null,Visualizations:null,Catalog:[]}})};s.prototype.getModel=function(){return this._oWorkPagesModel};s.prototype._validateData=function(e){i.debug("cep/editMode: load Page: validate","Work Page service");if(e.errors&&e.errors.length>0){return Promise.reject(e.errors.map(function(e){return e.message}).join(",\n"))}if(!a.get("data.WorkPage",e)){i.debug("cep/editMode: load Page: validate: reject: data is empty","Work Page service");return Promise.reject("Work Page data is empty")}return Promise.resolve(e)};s.prototype.loadWorkPageAndVisualizations=function(e,t){var r="{"+"WorkPage("+'SiteId:"'+e+'",'+'WorkPageId:"'+t+'"'+") {"+"Id,"+"Contents,"+"Editable,"+"UsedVisualizations{"+"nodes{"+"Id,"+"Type,"+"Descriptor,"+"DescriptorResources{"+"BaseUrl,"+"DescriptorPath"+"}"+"}"+"}"+"}"+"}";return this._doRequest(r).then(this._validateData).then(function(e){var t=a.get("data.WorkPage.Contents",e);var r=a.get("data.WorkPage.UsedVisualizations.nodes",e)||[];var o=a.get("data.WorkPage.Editable",e)===true;return this._transformVizData(r).then(function(e){var r=e.reduce(function(e,t){e[t.Id]=t;return e},{});this._oWorkPagesModel._setProperty("/data/WorkPage",t);this._oWorkPagesModel._setProperty("/data/Visualizations",r);this._oWorkPagesModel._setProperty("/editable",o)}.bind(this))}.bind(this))};s.prototype._resolveAndReplaceIBNTargets=function(e){var t,r,o,i;var s=e.reduce(function(e,s){t=a.get(["Descriptor","sap.flp","target","type"],s);if(t==="IBN"){i=this._replaceTarget(s);r=a.get(["Descriptor","sap.flp","target","inboundId"],s);o=a.get(["Descriptor","sap.flp","target","parameters"],s);if(r){e.push(i(r,o))}}else{e.push(Promise.resolve(s))}return e}.bind(this),[]);return Promise.all(s)};s.prototype._replaceTarget=function(e){return function(t,r){return this._oNavigationResolver.resolveByInbound(t,r).then(function(t){a.set(["Descriptor","sap.flp","target"],{type:"URL",url:t.url},e);return e})}.bind(this)};s.prototype.loadWorkPage=function(e,t){var r="{"+"WorkPage("+'SiteId:"'+e+'",'+'WorkPageId:"'+t+'"'+") {"+"Id,"+"Contents,"+"Editable"+"}"+"}";return this._doRequest(r).then(this._validateData).then(function(e){var t=a.get("data.WorkPage.Contents",e);var r=a.get("data.WorkPage.Editable",e)===true;this._oWorkPagesModel._setProperty("/data/WorkPage",t);this._oWorkPagesModel._setProperty("/editable",r)}.bind(this))};s.prototype.updateWorkPage=function(e,t){function r(e){for(var t in e){if(e[t]!==null&&typeof e[t]==="object"){if(e.DescriptorSchemaVersion){return e.DescriptorSchemaVersion}return r(e[t])}}return""}var o=r(t);function i(e,t){if(e&&e.DescriptorSchemaId){delete e.DescriptorSchemaId}for(var r in e){if(e[r]!==null&&typeof e[r]==="object"){i(e[r],!isNaN(r))}}if(e&&t){e.Descriptor=e.Descriptor||{};e.DescriptorSchemaVersion=e.DescriptorSchemaVersion||o}}function s(e){if(e.Rows){e.Rows.forEach(function(e){if(e.Columns){e.Columns.forEach(function(e){if(!e.Cells){e.Cells=[]}})}})}}i(t,true);s(t);var n="mutation updateWorkPage($WorkPageId: String!, $Contents: JSON) {"+"updateWorkPage(WorkPageId: $WorkPageId, Contents: $Contents ) {"+"Id,"+"Contents,"+"Editable,"+"UsedVisualizations{"+"nodes{"+"Id,"+"Type,"+"Descriptor,"+"DescriptorResources{"+"BaseUrl,"+"DescriptorPath"+"}"+"}"+"}"+"}"+"}";var u={query:n,variables:{WorkPageId:e,Contents:t}};var p=this.httpClient.post(this._sBaseUrl,{data:u,headers:{"Content-Type":"application/json",Accept:"application/json","Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()}}).then(function(e){if(e.status!==200){return Promise.reject({statusText:"HTTP request failed with status: "+e.status,responseText:e.statusText})}var t={};try{t=JSON.parse(e.responseText||"{}")}catch(t){return Promise.reject({statusText:undefined,responseText:e.responseText})}var r;var a;if(t.errors){try{var o=t.errors[0].split("[");r=o[0];var i=JSON.parse("["+o[1]);a=JSON.stringify(i,null,"  ")}catch(e){r=null;a=t.errors}return Promise.reject({statusText:r,responseText:a})}return t}).then(function(e){var t=a.get("data.updateWorkPage.Contents",e);var r=a.get("data.updateWorkPage.UsedVisualizations.nodes",e)||[];var o=a.get("data.updateWorkPage.Editable",e)===true;return this._transformVizData(r).then(function(e){var r=e.reduce(function(e,t){e[t.Id]=t;return e},{});this._oWorkPagesModel._setProperty("/data/Visualizations",r);this._oWorkPagesModel._setProperty("/data/WorkPage",t);this._oWorkPagesModel._setProperty("/editable",o)}.bind(this))}.bind(this));return p};s.prototype.loadVisualizations=function(e,t){var r=t.map(function(e){return'"'+e+'"'}).join(",");var o="{"+"Visualizations("+'SiteId:"'+e+'",'+"QueryInput:{filter:{Id:{in:["+r+"]}}}"+") {"+"nodes {"+"Id,"+"Type,"+"Descriptor,"+"DescriptorResources{"+"BaseUrl,"+"DescriptorPath"+"}"+"}"+"}"+"}";return this._doRequest(o).then(function(e){var t=a.get("data.Visualizations.nodes",e)||[];return this._transformVizData(t).then(function(e){var t=e.reduce(function(e,t){e[t.Id]=t;return e},{});this._oWorkPagesModel._setProperty("/data/Visualizations",t)}.bind(this))}.bind(this))};s.prototype.loadCatalog=function(e,t){var r=t.map(function(e){return'"'+e+'"'}).join(",");var o="{"+"Visualizations("+'SiteId:"'+e+'",'+"QueryInput:{filter:{Type:{in:["+r+"]}}}"+") {"+"nodes{"+"Id,"+"Type,"+"Descriptor,"+"DescriptorResources{"+"BaseUrl,"+"DescriptorPath"+"}"+"}"+"}"+"}";return this._doRequest(o).then(function(e){var t=a.get("data.Visualizations.nodes",e)||[];return this._transformVizData(t).then(function(e){this._oWorkPagesModel._setProperty("/data/Catalog",e)}.bind(this))}.bind(this))};s.prototype.getAllVizIds=function(e){var t=a.get("data.Rows",e),r=[],o=0,i,s,n,u,p,l,c;if(!t||t.length===0){return[]}for(;o<t.length;o++){u=t[o].Columns;if(!u||u.length===0){continue}for(i=0;i<u.length;i++){p=u[i].Cells;if(!p||p.length===0){continue}for(s=0;s<p.length;s++){l=p[s].Widgets;if(!l||l.length===0){continue}for(n=0;n<l.length;n++){c=a.get("Visualization.Id",l[n]);if(!c){continue}r.push(c)}}}}return r};s.prototype._doRequest=function(e){return this.httpClient.get(this._sBaseUrl+"?query="+e,{headers:{"Content-Type":"application/json",Accept:"application/json","Accept-Language":sap.ui.getCore().getConfiguration().getLanguageTag()}}).then(function(e){if(e.status!==200){return Promise.reject("HTTP request failed with status: "+e.status+" - "+e.statusText)}return JSON.parse(e.responseText||"{}")})};s.prototype._addSiteDataToVisualizations=function(e){return this._oCdmServicePromise.then(function(t){var r,o,i;return Promise.all([t.getApplications(),t.getVizTypes()]).then(function(t){var s=t[0];var n=t[1];return e.map(function(e){i=n[e.Type];r=a.get(["Descriptor","sap.flp","target","appId"],e);o=s[r];if(o){a.set("BusinessApp",o,e)}if(i){a.set("VizType",i,e)}return e})})})};s.prototype._replaceIndicatorDatasource=function(e){return Promise.all([this._oCSTRServicePromise,this._oCdmServicePromise]).then(function(t){var r=t[0];var o=t[1];return o.getApplications().then(function(t){return Promise.all(e.map(function(e){var o=a.get(["Descriptor","sap.flp","target","appId"],e);var s=t[o];var n=a.get(["Descriptor","sap.flp","indicatorDataSource"],e);var u;if(s){u=a.get(["sap.app","contentProviderId"],s);if(u&&n&&n.path){return r.getSystemContext(u).then(function(t){if(t){var r=n.dataSource;var o=a.get(["Descriptor","sap.app","dataSources",r],e);var i;if(o){i=t.getFullyQualifiedXhrUrl(o.uri);a.set(["Descriptor","sap.app","dataSources",r,"uri"],i,e)}else{i=t.getFullyQualifiedXhrUrl(n.path);a.set(["Descriptor","sap.flp","indicatorDataSource","path"],i,e)}}return e}).catch(function(t){i.error(t);return e})}}return Promise.resolve(e)}))})})};s.prototype._transformVizData=function(e){return this._addSiteDataToVisualizations(e).then(this._replaceIndicatorDatasource.bind(this))};return s},true);
},
	"sap/ushell/components/workPageRuntime/view/WorkPageRuntime.view.xml":'<mvc:View\n    xmlns="sap.m"\n    xmlns:core="sap.ui.core"\n    xmlns:mvc="sap.ui.core.mvc"\n    controllerName="sap.ushell.components.workPageRuntime.controller.WorkPageRuntime"\n    height="100%"><NavContainer id="workpageNavContainer"><Page\n            id="workPage"\n            busy="{= !${/loaded}}"\n            enableScrolling="false"\n            showHeader="false"><core:ComponentContainer\n                height="100%"\n                usage="pageBuilder"\n                manifest="true"\n                propagateModel="true"\n                async="true"\n                settings=\'\\{"modelRootPath": "/data"\\}\'\n                componentCreated="onWorkPageBuilderCreated"\n            /></Page><MessagePage\n            id="errorPage"\n            showHeader="false"\n            description="" /><Page\n            id="emptyPage"\n            showHeader="false" /></NavContainer></mvc:View>\n'
});
//# sourceMappingURL=Component-preload.js.map

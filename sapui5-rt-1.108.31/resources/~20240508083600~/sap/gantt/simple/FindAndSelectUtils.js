sap.ui.define(["./GanttUtils","sap/gantt/misc/Format","sap/gantt/misc/Utility","sap/gantt/simple/AggregationUtils","sap/ui/core/Core"],function(e,t,s,a,i){"use strict";var n=i.getLibraryResourceBundle("sap.gantt");var l={scrollToShape:function(i,n){var l=this;function h(e,t,s,a){if(!e||e.isA("sap.gantt.simple.Relationship")){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&((e.getShapeId()===s.shapeID[0]||a===s.shapeID[0])&&e.getTime())){l._oFoundShape=e}else if(e instanceof sap.gantt.simple.BaseGroup){if(t.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(a,i){i.forEach(function(a){if(!l._oFoundShape){h(a,t,s,e.getShapeId())}})})}else{e._eachChildOfGroup(e,function(a){if(!l._oFoundShape){h(a,t,s,e.getShapeId())}})}}}var o=document.getElementById(n.getId());var r=o?o.querySelector("[data-sap-gantt-row-id="+"'"+i.rowID+"'"+"]"):document.querySelector("[data-sap-gantt-row-id="+"'"+i.rowID+"'"+"]");if(r){var g=null,c=[];this._oFoundShape=null;var d=sap.ui.getCore().byId(r.parentElement.id);if(d){var u=a.getAllNonLazyAggregations(d);var f=Object.keys(u).filter(function(e){return e.indexOf("calendars")===-1&&e!=="relationships"}).map(function(e){return d.getAggregation(e)||[]});f.forEach(function(e){if(e&&e.length>0&&!this._oFoundShape){var t=0;while(t<e.length&&!this._oFoundShape){h(e[t],n,i);t++}}}.bind(this))}var S=this._oFoundShape&&this._oFoundShape.getTime()||i.startTime;n.jumpToPosition(t.abapTimestampToDate(S));e.getShapeByShapeId(n.getId(),i.shapeID).forEach(function(e){if(!g){g=s.parseUid(e.getShapeUid());if(this.rowIndex!==parseInt(g.rowIndex,10)){this.rowIndex=parseInt(g.rowIndex,10);n.getTable().setFirstVisibleRow(this.rowIndex)}}if(e.getHighlightable()){this.isShapeHighlightable=true;c.push({ShapeId:e.getShapeId(),Highlighted:true})}else{this.isShapeHighlightable=false;c.push({ShapeId:e.getShapeId(),Selected:true})}}.bind(this));if(this.isShapeHighlightable){n.oHighlight.clearAllHighlightedShapeIds();n.oHighlight.updateHighlightedShapes(c)}else{n.oSelection.clearAllSelectedShapeIds();n.oSelection.updateSelectedShapes(c)}}else{var p=n.getTable(),I=p.isA("sap.ui.table.TreeTable")?p.getBinding().getNodes(0,n._iNodesLength,0):p.getBinding().getContexts(0,n._iNodesLength,0),_=function(){var e=o?o.querySelector("[data-sap-gantt-row-id='"+i.rowID+"']"):document.querySelector("[data-sap-gantt-row-id='"+i.rowID+"']");if(e){clearInterval(this.setTime);this.setTime=null;this.scrollToShape(i,n)}};for(var m=0;m<I.length;m++){var v=n._getRowIdPath();var x=(I[m].context||I[m]).getObject()[v];if(x===i.rowID){this.rowIndex=m;p.setFirstVisibleRow(m);this.setTime=setInterval(_.bind(this),100);break}}}},navigateToSearchResult:function(e,t){if(t.isA("sap.gantt.simple.GanttSearchSidePanel")){t._oSearchSidePanel.getItems()[3].getContent()[0].setSelectedItem("listItem"+this._selectedIndex);t._oSearchSidePanel.getItems()[3].getContent()[0].getSelectedItem().getDomRef().children[0].focus()}this.updateShapeSelectionANDHighlight(e,this.previousGanttID);var s=this._ganttSearchResults[this._selectedIndex],a=null;if(s){if(this.previousGanttID!==s.ganttID){this.previousGanttID=s.ganttID;a=e[this.previousGanttID]}else{a=e[this.previousGanttID]}if(t.isA("sap.gantt.simple.GanttSearchSidePanel")){t.setContainerHeight(t._oSearchSidePanel.getItems()[3].getContent()[0].getSelectedItem())}this.scrollToShape(s,a);if(!t.isA("sap.gantt.simple.GanttSearchSidePanel")){this.toggleNavigationState(t._searchFlexBox.getItems()[1],t._searchFlexBox.getItems()[3])}else{this.toggleNavigationState(t._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],t._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1],true)}}},updateShapeSelectionANDHighlight:function(e,t){if(e.length>0){var s=e[t]?e[t]:e[0];if(this.isShapeHighlightable){var a=s.getHighlight();a.clearAllHighlightedShapeIds();a.updateShape(null,{highlighted:false,ctrl:false})}else{var i=s.getSelection();i.clearAllSelectedShapeIds();i.updateShape(null,{selected:false,ctrl:false})}}},triggerSearchEvent:function(e,t,s,a,i){var h=t[0].getParent();var o=function(){var n=[],o,r;t.forEach(function(t,s){t._bTimeContinuousShapes=false;t._hasTimeContinuousShapes(t.getTable().getRowSettingsTemplate());if(!t._bTimeContinuousShapes){var a=t.getFindBy(),i=t._getRowIdPath();n=t.findAll(e,a);n.forEach(function(e){e.ganttID=s;this.aSearchData.push(e)}.bind(this));var l=t.getTable().getBinding().getNodes&&t.getTable().getBinding().getNodes(0,t._iNodesLength,0)||t.getTable().getBinding().getContexts&&t.getTable().getBinding().getContexts(0,t._iNodesLength,0),h=[],g=Object.keys(t._oExpandModel.mExpanded),c=false,d=false,u=function(e,s){if(s.includes(e)){c=true;if(t._oExpandModel.mExpanded[s].length<=1){d=true}}};o=t.getTable().isA("sap.ui.table.TreeTable")?false:true;for(var f=0;f<l.length;f++){for(var S=0;S<n.length;S++){r=o||l[f].nodeState;if(r&&(l[f].context||l[f]).getObject()[i]===n[S].rowID){var p="PATH:"+n[S].rowID+"|SCHEME:"+t.getPrimaryShapeScheme().getKey();c=false;g.forEach(u.bind(null,p));if(c){if(n[S].isExpandable){if(n[S].hasOwnProperty("isParent")){if(n[S].isParent||d){h.push(n[S])}}else{h.push(n[S])}}}else if(n[S].hasOwnProperty("isParent")){h.push(n[S])}}}}this._ganttSearchResults=this._ganttSearchResults.concat(h)}}.bind(this));h.setProperty("customSearchResults",this._ganttSearchResults,true);h.fireCustomGanttSearchResult({searchResults:this._ganttSearchResults});this._ganttSearchResults=h.getCustomSearchResults();if(s){if(i.list){i.list.destroyItems()}i.getParent().fireGanttSearchSidePanelList({searchResults:this._ganttSearchResults});i._updateContent()}h.setBusy(false);this._searchResultsCount=this._ganttSearchResults.length;for(var g=0;g<this._ganttSearchResults.length;g++){if(document.querySelector("[data-sap-gantt-shape-id='"+this._ganttSearchResults[g].shapeID[0]+"']")){this._selectedIndex=g;break}}if(this._selectedIndex<0){this._selectedIndex=0}if(s){i._oSearchSidePanel.getItems()[3].getContent()[0].setSelectedItem("listItem"+this._selectedIndex);if(i._oSearchSidePanel.getItems()[3].getContent()[0].getSelectedItem()){i._oSearchSidePanel.getItems()[3].getContent()[0].getSelectedItem().getDomRef().children[0].focus()}}if(!h._bPreventShapeScroll){this.updateShapeSelectionANDHighlight(t,this.previousGanttID)}var c=this._ganttSearchResults[this._selectedIndex],d=null;if(c){a._searchFlexBox.getItems()[2].setText("("+(this._selectedIndex+1)+"/"+this._searchResultsCount+")");if(this.previousGanttID!==c.ganttID){this.previousGanttID=c.ganttID;d=t[this.previousGanttID]}else{d=t[this.previousGanttID]}if(!h._bPreventShapeScroll){l.scrollToShape(c,d)}this._toggleNavigationStateUtil(s,a,i)}else{if(s){i.setEmptyListInfo(false)}this._toggleNavigationStateUtil(s,a,i)}h._bPreventShapeScroll=false}.bind(this);this._ganttSearchResults=[];this._selectedIndex=0;this._searchResultsCount=0;a._searchFlexBox.getItems()[0].setValue(e);a._searchFlexBox.getItems()[2].setText(n.getText("GNT_EMPTY_RESULT_INFO_TOOLBAR"));if(e){this.aSearchData=[];h.setBusyIndicatorDelay(0);h.setBusy(true);setTimeout(function(){o()},h.getBusyIndicatorDelay())}else{if(!h._bPreventShapeScroll){this.updateShapeSelectionANDHighlight(t,this.previousGanttID)}if(s){i._updateContent();i.setEmptyListInfo(true)}this._toggleNavigationStateUtil(s,a,i);h._bPreventShapeScroll=false}if(!s){setTimeout(function(){var e=a._searchFlexBox.getItems()[3];var t=a._searchFlexBox.getItems()[1];if(e.getEnabled()){e.focus()}else{t.focus()}},0)}},_toggleNavigationStateUtil:function(e,t,s){if(!e){this.toggleNavigationState(t._searchFlexBox.getItems()[1],t._searchFlexBox.getItems()[3])}else{this.toggleNavigationState(s._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],s._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1],true)}},toggleNavigationState:function(e,t,s,a){if(this._selectedIndex===0&&this._searchResultsCount>1){e.setEnabled(false);t.setEnabled(true);if(!s){t.focus()}}else if(this._selectedIndex===this._searchResultsCount-1&&this._selectedIndex>0){t.setEnabled(false);e.setEnabled(true);if(!s){e.focus()}}else if(this._selectedIndex===0&&this._searchResultsCount===0||this._selectedIndex===this._searchResultsCount-1){e.setEnabled(false);t.setEnabled(false)}else{e.setEnabled(true);t.setEnabled(true);if(a){t.focus()}}e.rerender();t.rerender()},updateToolbarItems:function(e,t,s){var a=e.getAllToolbarItems(),i=false,n=-1;a.forEach(function(e,s){if(e.isA("sap.m.ToolbarSpacer")){n=s}if(e.getId().includes("findAndSelectSearchButton")){e.setVisible(!t)}if(e.getId().includes("findAndSelectFlexBox")){i=true;e.setVisible(t)}});if(!i){if(n>-1){e.insertContent(e._searchFlexBox,n+1)}else{e.insertContent(e._searchFlexBox,1)}}setTimeout(function(){var a=e._searchFlexBox.getItems()[0];if(s&&this._searchResultsCount>1){this.toggleNavigationState(e._searchFlexBox.getItems()[1],e._searchFlexBox.getItems()[3],false,true)}else if(a.getDomRef()){var i=a.getValue().length;var n=a.getDomRef().getElementsByTagName("input")[0];a.focus();var l=s?i:0;n.setSelectionRange(l,i)}else if(!t){var h=e._oSearchButton.getDomRef();if(h){h.focus()}}}.bind(this),0)}};return l});
//# sourceMappingURL=FindAndSelectUtils.js.map
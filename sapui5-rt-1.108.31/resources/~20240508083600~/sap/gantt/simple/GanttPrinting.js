/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/ProgressIndicator","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas"],function(t,e,i,n,a,o,r,s,h,l,g,p,_,d,u,c,C,P,f,m,v,y,T,x,b,w,G,M,S,R,D,I,N,E,B,A,H,O,F,L,k,z,W,V){"use strict";var U=d.FlexDirection,j=t.simple.GanttChartWithTableDisplayType;V=window.html2canvas;W=window.jsPDF;var K=i.extend("sap.gantt.simple.GanttPrinting",{metadata:{library:"sap.gantt",associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});K._oPaperSizes={A5:{width:Y(148),height:Y(210)},A4:{width:Y(210),height:Y(297)},A3:{width:Y(297),height:Y(420)},A2:{width:Y(420),height:Y(594)},A1:{width:Y(594),height:Y(841)},A0:{width:Y(841),height:Y(1189)},Letter:{width:Q(8.5),height:Q(11)},Legal:{width:Q(8.5),height:Q(14)},Tabloid:{width:Q(11),height:Q(17)},Custom:{width:undefined,height:undefined}};var J="9px Arial, Helvetica, sans-serif";var $="12px Arial, Helvetica, sans-serif";var X="16384";K.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.gantt");var t={multiplePage:true,qualityWarning:false,showOrientationMessage:false,orientationMessage:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),portrait:true,paperSize:"A4",paperWidth:K._oPaperSizes.A4.width,paperHeight:K._oPaperSizes.A4.height,unit:"mm",repeatSelectionPanel:false,scale:100,duration:"all",startDate:new Date,endDate:new Date,showPageNumber:false,showHeaderText:false,headerText:"",showFooterText:false,footerText:"",exportAll:true,exportRange:"",exportAsJPEG:true,compressionQuality:75,previewPageNumber:1,lastPageNumber:undefined,marginType:"default",marginLocked:false,marginTop:Y(5),marginRight:Y(5),marginBottom:Y(5),marginLeft:Y(5),cropMarks:false,cropMarksWeight:.25,cropMarksOffset:Y(3)};this._oModel=new L(t);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=Y(8);this._ganttChartContainer=new D};K.prototype.export=function(){this._savePdf()};K.prototype.renderGanttClone=function(t){if(n.getConfiguration().getRTL()&&!t){return Promise.resolve()}return new Promise(function(t){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",t,this);this._ganttChartClone.invalidate()}.bind(this))};K.prototype.mergeCanvases=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=t[0].width,a=[],o=t.reduce(function(t,e,i,n){a.push({cnv:e,y:t});t+=n[i].height;return t},0);e.width=n;e.height=o;a.forEach(function(t){i.beginPath();i.drawImage(t.cnv,0,t.y,n,t.cnv.height)});if(e.width>X||e.height>X){this._oClonedGanttDiv.style.height=e.height+"px";this._oClonedGanttDiv.style.width=e.width+"px";return undefined}return e};K.prototype.generateCanvasAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var a=this;var o=[];var r=0;var s=25/Math.ceil(i);function h(){if(a._bMultipleBatches){r+=s;a._oProgressIndicator.setPercentValue(r)}}function l(t){if(a._bCancel){return Promise.reject()}a._oClonedGanttDiv.style.height=X+"px";var o=t*a.iThreshold;var r=a._getOriginalGanttChart().getTable()._getTotalRowCount();a.iThreshold=Math.min(a.iThreshold,r-o);a.bLast=e+1>=i?true:false;a._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);a._ganttChartClone.getTable().setVisibleRowCount(a.iThreshold);a.bFirst=t===0?true:false;a._ganttChartClone.getTable().setFirstVisibleRow(o);if(n.getConfiguration().getRTL()){a._ganttChartClone._bRenderGanttClone=true}return a._ganttChartClone.getInnerGantt().resolveWhenReady(a._originalHasRenderedShapes)}function g(t){h();return l(t).then(function(){h();a._bExpandCollapse=true;return a._expandAndCollapse()}).then(function(){a._ganttChartClone._bExpandRows=true;h();return a._expandRowSettings()}).then(function(){a._ganttChartClone._bExpandRows=false;a._setCloneDivHeight();document.getElementById(a._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=a._iContentHeight;document.getElementById(a._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=a._iContentHeight;if(!a.bLast){h()}return a._createGanttCanvas()}).then(function(t){return o.push(t)}).then(function(){if(t===0){a._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){g(e)}else if(!a._bCancel){a._oGanttCanvas=a.mergeCanvases(o);a._updateDialogPreview();a._oDialog.getContent()[0].setBusy(false);a._oFlexBoxPreview.setBusy(false);a._oButtonExport.setEnabled(true);if(a._bMultipleBatches){a._oProgressIndicator.setPercentValue(100);setTimeout(function(){a._closeProgressIndicator(true)},500)}}else{return Promise.reject()}}).catch(function(){})}return g(t)};K.prototype.open=function(t){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}var e=this;if(t){t(this._ganttChartClone.getTable())}this._createAndOpenDialog();this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt().then(function(){if(e._bMultipleBatches){e._openProgressDialog()}return e.generateCanvasAsync(0)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded){e._updateDialogPreviewCanvas();e._oDialog.getContent()[0].setBusy(false)}})}else{if(n.getConfiguration().getRTL()){e._ganttChartClone._bRenderGanttClone=true}return this._drawClonedGantt().then(function(){e._bExpandCollapse=true;return e._expandAndCollapse()}).then(function(){e._ganttChartClone._bExpandRows=true;return e._expandRowSettings()}).then(function(){e._ganttChartClone._bExpandRows=false;e._setCloneDivHeightNonOptimised();document.getElementById(e._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=e._iContentHeight;document.getElementById(e._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=e._iContentHeight;return e._createGanttCanvas()}).then(function(t){e._oGanttCanvas=t;e._updateDialogPreview();e._oDialog.getContent()[0].setBusy(false);e._oButtonExport.setEnabled(true)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded){e._updateDialogPreviewCanvas();e._oDialog.getContent()[0].setBusy(false)}})}};K.prototype.close=function(){var t=this._getOriginalGanttChart();if(this._initialDisplayType===j.Table){t.setSelectionPanelSize(this._initialSelectionPanelSize);t.setDisplayType(this._initialDisplayType);if(t.getParent()&&t.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.getParent().getToolbar()){t.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(j.Table)}}this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);z.deregister(this._sResizeHandlerId);this._oDialog.close();this._oDialog.destroy()};K.prototype._closeProgressIndicator=function(t){this._oProgressDialog.close();this._oProgressDialog.destroy();this._bCancel=true;if(!this._bUpdateGanttCanvas&&!t){this.close()}};K.prototype.setGanttChart=function(t){this.setAssociation("ganttChart",t);this._initialDisplayType=t.getDisplayType();this._initialSelectionPanelSize=t._iLastTableAreaSize?t._iLastTableAreaSize:t.getSelectionPanelSize();var e=this._initialDisplayType===j.Table?true:false;if(e){t.setSelectionPanelSize("100%");t.setDisplayType(j.Both)}this._ganttChartClone=t.clone();this._ganttChartClone._enableOptimisation=t.getPrintingBatchSize()>0?true:false;this._bUpdateGanttCanvas=false;this._bCancel=false;this._ganttChartClone.setEnableChartOverflowToolbar(false);this.canvasScale=2;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var i=e?1:Math.max(t.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(t.getPrintingBatchSize()/i),t.getTable()._getTotalRowCount());this._bMultipleBatches=t.getTable()._getTotalRowCount()>this.iThreshold;this.bFirst=true;this._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._ganttChartClone.getTable().setVisibleRowCount(this.iThreshold);this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}this._addBackOriginalGanttRowBinding(this._ganttChartClone,t);this._originalHasRenderedShapes=t.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var n=t._oSplitter._calculatedSizes[0];if(this._initialDisplayType===j.Chart){this._ganttChartClone.setSelectionPanelSize("1px")}else{this._ganttChartClone.setSelectionPanelSize(n.toString()+"px")}var a=t.getAxisTimeStrategy();if(!a.isA("sap.gantt.axistime.FullScreenStrategy")&&!e){t.isPrint=true;t._getScrollExtension()._updateVisibleHorizonForce();var o=this._ganttChartClone.getAxisTimeStrategy();o.setTotalHorizon(a.getTotalHorizon());o.setVisibleHorizon(a.getTotalHorizon())}var r=a.getVisibleHorizon();var s=this._getHorizonDates(r);var h=this._horizonWidthInSec(s);this._fPixelsBySec=t.getVisibleWidth()/h;this._ganttChartClone.isPrint=true;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone)}return this};K.prototype._expandAndCollapse=function(){var t=this;return this._expandAndCollapseRow().then(function(){if(t._bExpandCollapse){return t._expandAndCollapse()}else{return Promise.resolve()}})};K.prototype._expandAndCollapseRow=function(){if(this._bCancel){this._bExpandCollapse=false;return Promise.reject()}var t=this._getOriginalGanttChart().getTable();if(!t.isA("sap.ui.table.TreeTable")){this._bExpandCollapse=false;return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}var e=t.getBinding("rows"),i=this._ganttChartClone.getTable().getBinding("rows");for(var n=0;n<e.getLength();n++){if(i.findNode(n)!==undefined&&e.isExpanded(n)&&!i.isExpanded(n)){i.expand(n);return this.renderGanttClone(true)}else if(i.findNode(n)!==undefined&&!e.isExpanded(n)&&i.isExpanded(n)){i.collapse(n);return this.renderGanttClone(true)}}this._bExpandCollapse=false;return Promise.resolve()};K.prototype._expandRowSettings=function(){if(this._bCancel){return Promise.reject()}var t=this._ganttChartClone.getShapeSchemes().find(function(t){return!t.getPrimary()});if(t){this._ganttChartClone.expand(t.getKey(),this._getOriginalGanttChart()._aExpandedIndices)}return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)};K.prototype._onResize=function(){var t=this._oHTMLDialogPreview.getDomRef();t.style.overflow="hidden";this._resizePrintingPreviewPage();t.style.overflow="visible"};function Y(t){return t*3.78}function q(t){return t/3.78}function Q(t){return t/.01042}function Z(t){return t*.01042}K.prototype._convertUnitToPx=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return Y(t);case"cm":return Y(t)*10;case"in":return Q(t);default:return undefined}};K.prototype._convertPxToUnit=function(t){var e=this._oModel.getProperty("/unit");if(!e){return undefined}switch(e){case"mm":return q(t);case"cm":return q(t)/10;case"in":return Z(t);default:return undefined}};K.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs()};K.prototype._updatePaperSizeInputs=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(t,e)};K.prototype._setPaperSizeInputs=function(t,e){if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(this._convertPxToUnit(t))}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(this._convertPxToUnit(e))}};K.prototype._setPaperSizesToModel=function(t,e){this._oModel.setProperty("/paperWidth",t);this._oModel.setProperty("/paperHeight",e)};K.prototype._updatePaperSizeValues=function(){var t=this._oModel.getProperty("/paperSize"),e=this._oModel.getProperty("/portrait"),i,n;if(!t||t==="Custom"){return}var a=K._oPaperSizes[t];if(e){i=a.width;n=a.height}else{i=a.height;n=a.width}this._setPaperSizeInputs(i,n);this._setPaperSizesToModel(i,n);if(t==="Letter"||t==="Legal"||t==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in")}else{this._oComboBoxUnit.setSelectedKey("mm")}this._onChangeUnitComboBox();this._updateDialogPreview()};K.prototype._updatePaperOrientation=function(t){var e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight");if(i>e){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0)}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1)}};K.prototype._onChangePaperSizeInput=function(t){var e=t.getSource();var i=this._convertUnitToPx(a.getFloatInstance().parse(e.getValue()));if(e===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",i)}else{this._oModel.setProperty("/paperHeight",i)}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();this._updateDialogPreview()};K.prototype._onChangeCompressionSlider=function(t){var e=t.getSource();var i=e.getValue();this._setCompressionComboBoxItem(i)};K.prototype._setCompressionComboBoxItem=function(t){if(t===100){this._oComboBoxCompression.setSelectedKey("maximum")}else if(t>=75){this._oComboBoxCompression.setSelectedKey("high")}else if(t>=50){this._oComboBoxCompression.setSelectedKey("medium")}else{this._oComboBoxCompression.setSelectedKey("low")}};K.prototype._onChangeCompressionComboBox=function(t){var e=t.getSource().getSelectedKey();var i={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",i[e])};K.prototype._onChangeOrientation=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(e,t);this._setPaperSizesToModel(e,t);this._updateDialogPreview()};K.prototype._onChangeExportTypes=function(){this._updateDialogPreview()};K.prototype._setMarginInputs=function(t,e,i,n){this._oInputMarginTop.setValue(this._convertPxToUnit(t));this._oInputMarginRight.setValue(this._convertPxToUnit(e));this._oInputMarginBottom.setValue(this._convertPxToUnit(i));this._oInputMarginLeft.setValue(this._convertPxToUnit(n))};K.prototype._setMarginsToModel=function(t,e,i,n){if(t!==undefined){this._oModel.setProperty("/marginTop",t)}if(e!==undefined){this._oModel.setProperty("/marginRight",e)}if(i!==undefined){this._oModel.setProperty("/marginBottom",i)}if(n!==undefined){this._oModel.setProperty("/marginLeft",n)}};K.prototype._onChangeMarginComboBox=function(t){var e=t.getSource().getSelectedKey();var i=Y(5);if(e==="none"){i=0}this._setMarginsToModel(i,i,i,i);this._setMarginInputs(i,i,i,i);this._updateDialogPreview()};K.prototype._updateModelFromMarginInputs=function(){var t,e,i,n;if(this._oInputMarginTop.getValueState()!=="Error"){t=this._convertUnitToPx(this._oInputMarginTop.getValue())}if(this._oInputMarginRight.getValueState()!=="Error"){e=this._convertUnitToPx(this._oInputMarginRight.getValue())}if(this._oInputMarginBottom.getValueState()!=="Error"){i=this._convertUnitToPx(this._oInputMarginBottom.getValue())}if(this._oInputMarginLeft.getValueState()!=="Error"){n=this._convertUnitToPx(this._oInputMarginLeft.getValue())}this._setMarginsToModel(t,e,i,n)};K.prototype._updateMarginInputs=function(){var t=this._oModel.getProperty("/marginTop");var e=this._oModel.getProperty("/marginRight");var i=this._oModel.getProperty("/marginBottom");var n=this._oModel.getProperty("/marginLeft");this._setMarginInputs(t,e,i,n)};K.prototype._updateCropMarksOffsetInput=function(){var t=this._oModel.getProperty("/cropMarksOffset");this._oInputCropMarksOffset.setValue(this._convertPxToUnit(t))};K.prototype._onChangeMarginInput=function(t){var e=t.getSource();if(e.getValueState()==="Error"){return}if(this._oModel.getProperty("/marginLocked")){var i=this._convertUnitToPx(e.getValue());this._setMarginInputs(i,i,i,i);this._setMarginsToModel(i,i,i,i)}else{this._updateModelFromMarginInputs()}this._updateDialogPreview()};K.prototype._onChangeCropMarksInput=function(t){var e=t.getSource();var i=this._convertUnitToPx(e.getValue());this._oInputCropMarksOffset.setValue(this._convertPxToUnit(i));this._oModel.setProperty("/cropMarksOffset",i)};K.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate())};K.prototype._getFirstDayOfNextWeek=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var i=(e+7-t.getDay())%7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+(i===0?7:i))};K.prototype._nextWeekRange=function(){var t=new Date;var e=this._getFirstDayOfNextWeek(t);this._oModel.setProperty("/startDate",this._validateDate(e));this._oModel.setProperty("/endDate",this._validateDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+7)))};K.prototype._getFirstDayOfNextMonth=function(t){return new Date(t.getFullYear(),t.getMonth()+1,1)};K.prototype._nextMonthRange=function(){var t=new Date;this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(t)));this._oModel.setProperty("/endDate",this._validateDate(new Date(t.getFullYear(),t.getMonth()+2,1)))};K.prototype._validateDate=function(t){var e=this._oDatePickerTo.getMaxDate(),i=this._oDatePickerFrom.getMinDate();if(t.getTime()>e.getTime()){return e}if(t.getTime()<i.getTime()){return i}return t};K.prototype._onChangeDurationComboBox=function(){var t=this._oModel.getProperty("/duration");switch(t){case"all":{this._allRange()}break;case"week":{this._nextWeekRange()}break;case"month":{this._nextMonthRange()}break;case"custom":default:return}this._updateGanttCanvas()};K.prototype._onChangeDurationDatePicker=function(){this._oComboBoxDuration.setSelectedKey("custom");this._updateGanttCanvas()};K.prototype._setEnabledPreviousButtons=function(t){this._oButtonFirst.setEnabled(t);this._oButtonPrevious.setEnabled(t)};K.prototype._setEnabledNextButtons=function(t){this._oButtonNext.setEnabled(t);this._oButtonLast.setEnabled(t)};K.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return}var t=this._oModel.getProperty("/previewPageNumber"),e=this._oModel.getProperty("/lastPageNumber");if(!e){e=Number.MAX_SAFE_INTEGER}if(t<=1){this._setEnabledPreviousButtons(false)}if(t>=e){this._setEnabledNextButtons(false)}if(t>1){this._setEnabledPreviousButtons(true)}if(t<e){this._setEnabledNextButtons(true)}};K.prototype._getHeaderHeight=function(){var t=this._oModel.getProperty("/showHeaderText");if(t){return this._iHeaderAndFooterHeight}return 0};K.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false}var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(!e||!t){return false}var i=this._oModel.getProperty("/footerText"),a=this._oModel.getProperty("/paperWidth"),o;var r=n.getConfiguration().getRTL();if(r){o=this._oModel.getProperty("/marginRight")}else{o=this._oModel.getProperty("/marginLeft")}var s=7;var h=this._oGanttCanvas.getContext("2d");h.font=J;var l=h.measureText(i).width;if(a/2>o+Y(4)+l+Y(10)+s){return false}else{return true}};K.prototype._getFooterHeight=function(){var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(e&&t){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight}if(e||t){return this._iHeaderAndFooterHeight}return 0};K.prototype._isShrinkableToOnePageByWidth=function(){var t=this._getPaperContentWidth()/this._getPaperContentHeight(),e=this._oGanttCanvas.width/this._oGanttCanvas.height;return t<=e};K.prototype._getPaperContentWidth=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/marginLeft"),i=this._oModel.getProperty("/marginRight");return t-e-i};K.prototype._getPaperContentHeight=function(){var t=this._oModel.getProperty("/paperHeight"),e=this._oModel.getProperty("/marginTop"),i=this._oModel.getProperty("/marginBottom");return t-e-this._getHeaderHeight()-i-this._getFooterHeight()};K.prototype._getScale=function(){return 100/this._oModel.getProperty("/scale")*2};K.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth()};K.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight()};K.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth())};K.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight())};K.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return}var t=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",t);var e=this._oModel.getProperty("/previewPageNumber");if(e>t){this._oModel.setProperty("/previewPageNumber",t)}};K.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};K.prototype._onPressButtonPrevious=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};K.prototype._onPressButtonNext=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};K.prototype._onPressButtonLast=function(){var t=this._oModel.getProperty("/lastPageNumber");if(!t){return}this._oModel.setProperty("/previewPageNumber",t);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};K.prototype._getOriginalGanttChart=function(){return sap.ui.getCore().byId(this.getAssociation("ganttChart"))};K.prototype._setGanttCloneDivWidth=function(t){var e=this._getOriginalGanttChart(),i=this._getHorizonDates(t),n=this._horizonWidthInSec(i),a=Math.ceil(this._fPixelsBySec*n);var o=e.getDisplayType()===j.Both?e.getTable().getDomRef().offsetWidth:0;this._oClonedGanttDiv.style.width=(o+a+10).toString()+"px"};K.prototype._setGanttCloneDivHeight=function(){var t=this._getOriginalGanttChart().getTable();var e=t._getTotalRowCount(),i=t._aRowHeights;var n=i.reduce(function(t,e){return t+e});var a=Math.ceil(n/i.length*e);this._iGanttHeight=a+102;this._oClonedGanttDiv.style.height=this._iGanttHeight.toString()+"px"};K.prototype._setCloneDivHeight=function(){var t=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var e=this._ganttChartClone.getTable().getVisibleRowCount();var i=0;var n=this.bLast?3:0;var a=this._ganttChartClone.getTable().getRows()[0].getIndex();var o=this._ganttChartClone.getTable().getFirstVisibleRow();var r=Math.abs(a-o);var s=this._ganttChartClone.getTable()._aRowHeights;for(var h=r;h<e+r;h++){i=i+s[h]}this._iContentHeight=i+"px";this._oClonedGanttDiv.style.height=(i+t+n).toString()+"px"};K.prototype._setCloneDivHeightNonOptimised=function(){var t=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var e=this._ganttChartClone.getTable()._getTotalRowCount();var i=1;var n=this._ganttChartClone.getTable()._aRowHeights;for(var a=0;a<e;a++){var o=n[a]?n[a]:0;i=i+o}this._iContentHeight=i.toString()+"px";this._oClonedGanttDiv.style.height=(i+t).toString()+"px"};K.prototype._createImgElementsFromSvgImages=function(){var t=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!t.length){return}var e=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!e){return}e.style.position="relative";var i=t.find("image");for(var n=0;n<i.length;n++){var a=i[n];var o=document.createElement("img");o.src=a.getAttribute("href");o.style.position="absolute";o.style.top=a.getAttribute("y")+"px";o.style.left=a.getAttribute("x")+"px";o.style.width=a.getAttribute("width")+"px";o.style.height=a.getAttribute("height")+"px";e.appendChild(o)}};K.prototype._createGanttCanvas=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return V(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false})};K.prototype._updateGanttCanvas=function(){if(this._initialDisplayType===j.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var n=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));n.setStartTime(t.getProperty("/startDate"));n.setEndTime(t.getProperty("/endDate"));this._bUpdateGanttCanvas=true;this._bCancel=false;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false)}this._setGanttCloneDivWidth(n);this._setGanttCloneDivHeight();if(this._oClonedGanttDiv.offsetWidth*this.canvasScale>X||this._oClonedGanttDiv.offsetHeight*this.canvasScale>X){this._oClonedGanttDiv.style.height=this._oClonedGanttDiv.offsetHeight*this.canvasScale+"px";this._oClonedGanttDiv.style.width=this._oClonedGanttDiv.offsetWidth*this.canvasScale+"px";this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined}e.setTotalHorizon(n);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var a=this._getOriginalGanttChart();var o=Math.max(a.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(a.getPrintingBatchSize()/o),a.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generateCanvasAsync(0)}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;return this.renderGanttClone().then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(t){this._oGanttCanvas=t;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false)}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}.bind(this))}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}};K.prototype._drawClonedGantt=function(){if(this._oClonedGanttDiv){return Promise.reject()}this._oClonedGanttDiv=document.createElement("div");this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";document.body.appendChild(this._oClonedGanttDiv);this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();e.getVisibleHorizon().setStartTime(t.getProperty("/startDate"));e.getVisibleHorizon().setEndTime(t.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if(this._oClonedGanttDiv.offsetWidth*this.canvasScale>X||this._oClonedGanttDiv.offsetHeight*this.canvasScale>X){this._oClonedGanttDiv.style.height=this._oClonedGanttDiv.offsetHeight*this.canvasScale+"px";this._oClonedGanttDiv.style.width=this._oClonedGanttDiv.offsetWidth*this.canvasScale+"px";return Promise.reject({bMaxCanvasSizeExceeded:true})}if(this._ganttChartClone._enableOptimisation){return Promise.resolve()}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}};K.prototype._addBackOriginalGanttRowBinding=function(t,e){if(t.getTable().getBindingInfo("rows").binding==null){t.oPropagatedProperties=e._getPropertiesToPropagate();t.propagateProperties(true)}if(this._ganttChartClone._enableOptimisation){t.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);t.getTable().setVisibleRowCount(this.iThreshold);t.getTable().setThreshold(this.iThreshold)}var i=e.getTable().getBinding("rows"),n=t.getTable().getBinding("rows");if(i){if(i.sCustomParams){n.sCustomParams=i.sCustomParams}if(i.aFilters&&i.aFilters.length>0){n.filter(i.aFilters)}if(i.aApplicationFilters&&i.aApplicationFilters.length>0){n.filter(i.aApplicationFilters,sap.ui.model.FilterType.Application)}if(i.aSorters&&i.aSorters.length>0){n.sort(i.aSorters)}}};K.prototype._resizePrintingPreviewPage=function(){var t=this._oHTMLDialogPreview.getDomRef(),e=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],i=t.offsetHeight,n=this._oModel.getProperty("/paperHeight"),a=this._oModel.getProperty("/paperWidth"),o=this._oModel.getProperty("/portrait"),r,s;if(o){r=i/n;s=a*r}else{r=i/a;s=i;i=n*r}e.style.width=s.toString()+"px";e.style.height=i.toString()+"px"};K.prototype._updateSinglePageMessages=function(t,e){if(e>t){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"))}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"))}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true)}else{this._oModel.setProperty("/qualityWarning",false)}if(e>=t&&this._oModel.getProperty("/portrait")||e<=t&&!this._oModel.getProperty("/portrait")){this._oModel.setProperty("/showOrientationMessage",false)}else{this._oModel.setProperty("/showOrientationMessage",true)}};K.prototype._getCanvasOfPageN=function(t,e){var i=this._oModel.getProperty("/lastPageNumber");if(t>i){return null}var a=document.createElement("canvas");var o=a.getContext("2d");o.imageSmoothingEnabled=false;var r=this._getCroppingWidth(),s=this._getCroppingHeight();var h=this._getPagesInARow();var l=this._oModel.getProperty("/paperWidth"),g=this._oModel.getProperty("/paperHeight");var p=this._oModel.getProperty("/marginTop"),_=this._oModel.getProperty("/marginRight"),d=this._oModel.getProperty("/marginBottom"),u=this._oModel.getProperty("/marginLeft");var c=(t-1)%h,C=Math.floor((t-1)/h);a.width=l;a.height=g;if(!e){a.style.height="100%";a.style.width="auto"}o.fillStyle="white";o.fillRect(0,0,a.width,a.height);o.fillStyle=k.get("sapUiBaseText");o.textBaseline="middle";o.font=J;var P;var f=n.getConfiguration().getRTL();if(f){o.textAlign="right";P=l-_-Y(4)}else{o.textAlign="left";P=u+Y(4)}var m=this._oModel.getProperty("/showHeaderText");if(m){var v=this._oModel.getProperty("/headerText");o.fillText(v,P,p+this._iHeaderAndFooterHeight/2)}if(this._oModel.getProperty("/showFooterText")){o.fillText(this._oModel.getProperty("/footerText"),P,g-d-this._iHeaderAndFooterHeight/2-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0))}var y=this._oModel.getProperty("/showPageNumber"),T=this._oModel.getProperty("/multiplePage"),x;if(T&&y){o.font=$;o.textAlign="center";o.fillText(t.toString(),l/2,g-d-this._iHeaderAndFooterHeight/2)}if(T){var b=c*r,w=C*s,G=0,M=0;var S=false;if(b+r>this._oGanttCanvas.width){S=true;r=this._oGanttCanvas.width-b;M=r/this._getScale()}var R=false;if(w+s>this._oGanttCanvas.height){R=true;s=this._oGanttCanvas.height-w;G=s/this._getScale()}x=(S?M:this._getPaperContentWidth())/r;if(x<.5&&e){var D=document.createElement("canvas");D.width=r;D.height=s;var I=D.getContext("2d");I.drawImage(this._oGanttCanvas,b,w,r,s,0,0,r,s);this._downScaleCanvas(D,o,x,0,0,D.width,D.height,u,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,b,w,r,s,u,p+this._getHeaderHeight(),S?M:this._getPaperContentWidth(),R?G:this._getPaperContentHeight())}}else{var N=this._getPaperContentWidth(),E=this._getPaperContentHeight();var B=this._isShrinkableToOnePageByWidth();var A;if(B){A=N/this._oGanttCanvas.width;E=this._oGanttCanvas.height*A}else{A=E/this._oGanttCanvas.height;N=this._oGanttCanvas.width*A}this._updateSinglePageMessages(N,E);x=N/this._oGanttCanvas.width;if(x<1&&e){this._downScaleCanvas(this._oGanttCanvas,o,x,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,u,p+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,u,p+this._getHeaderHeight(),N,E)}}return a};K.prototype._downScaleCanvas=function(t,e,i,n,a,o,r,s,h){var l=document.createElement("canvas");l.width=o;l.height=r;var g=l.getContext("2d");g.drawImage(t,n,a,o,r,0,0,o,r);var p=i*i;var _=Math.floor(o*i);var d=Math.floor(r*i);var u=0,c=0,C=0;var P=0,f=0,m=0,v=0;var y=0,T=0;var x=0,b=0,w=0;var G=0,M=0,S=0;var R=false,D=false;var I=l.getContext("2d").getImageData(0,0,o,r).data;var N=new Float32Array(3*_*d);var E=0,B=0,A=0;for(c=0;c<r;c++){f=c*i;T=0|f;m=3*T*_;D=T!==(0|f+i);if(D){w=T+1-f;S=f+i-T-1}for(u=0;u<o;u++,C+=4){P=u*i;y=0|P;v=m+y*3;R=y!==(0|P+i);if(R){b=y+1-P;M=P+i-y-1}E=I[C];B=I[C+1];A=I[C+2];if(!R&&!D){N[v]+=E*p;N[v+1]+=B*p;N[v+2]+=A*p}else if(!R&&D){x=w*i;N[v]+=E*x;N[v+1]+=B*x;N[v+2]+=A*x;G=S*i;N[v+3*_]+=E*G;N[v+3*_+1]+=B*G;N[v+3*_+2]+=A*G}else if(R&&!D){x=b*i;N[v]+=E*x;N[v+1]+=B*x;N[v+2]+=A*x;G=M*i;N[v+3]+=E*G;N[v+4]+=B*G;N[v+5]+=A*G}else{x=b*w;N[v]+=E*x;N[v+1]+=B*x;N[v+2]+=A*x;G=M*w;N[v+3]+=E*G;N[v+4]+=B*G;N[v+5]+=A*G;G=b*S;N[v+3*_]+=E*G;N[v+3*_+1]+=B*G;N[v+3*_+2]+=A*G;G=M*S;N[v+3*_+3]+=E*G;N[v+3*_+4]+=B*G;N[v+3*_+5]+=A*G}}}var H=document.createElement("canvas");H.width=_;H.height=d;var O=H.getContext("2d");var F=O.getImageData(0,0,_,d);var L=F.data;var k=0;for(C=0,v=0;k<_*d;C+=3,v+=4,k++){L[v]=0|N[C];L[v+1]=0|N[C+1];L[v+2]=0|N[C+2];L[v+3]=255}e.putImageData(F,s,h);return};function tt(t){while(t.firstChild){t.removeChild(t.firstChild)}}K.prototype._createPreviewErrorMessageStrip=function(t){return new w({text:this._oRb.getText(t?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"})};K.prototype._updateDialogPreviewCanvas=function(){var t=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var e=t[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);var i=this._oModel.getProperty("/multiplePage");if(i){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false)}var n=this._getCanvasOfPageN(i?this._oModel.getProperty("/previewPageNumber"):1,false);tt(e);this._resizePrintingPreviewPage();e.appendChild(n)}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>X||this._oClonedGanttDiv.offsetHeight>X)){this._oButtonExport.setEnabled(false);this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){tt(e);if(!this._oPreviewErrorMessageStrip){this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>X)}var a=document.createElement("div");a.id=this.getId()+"-previewErrorMessageStrip";a.style.width="80%";e.appendChild(a);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip")}}else{throw new Error("Gantt chart canvas does not exist.")}t.addClass("sapGanttPrintingPreviewPageDivBorder")};K.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};K.prototype._setStylesToDom=function(t){function e(t){var e=getComputedStyle(t);var i,n,a,o;var r=["height","width","min-height","min-width"];var s="";for(i=0,n=e.length;i<n;i++){a=e[i];if(!(t instanceof SVGElement&&r.indexOf(a)>=0)){o=e.getPropertyValue(a);s+=a+":"+o+";"}}t.style=s}function i(t){e(t);i(t);function i(t){if(t&&t.hasChildNodes()){var n=t.firstChild;while(n){if(n.nodeType===1&&n.nodeName!="SCRIPT"){e(n);i(n)}n=n.nextSibling}}}}i(t)};K.prototype._setStyleToGanttChartSvg=function(t){var e=t.$().find("svg.sapGanttChartSvg")[0];var i=t.$().find("svg.sapGanttChartHeaderSvg")[0];if(e){this._setStylesToDom(e)}if(i){this._setStylesToDom(i)}};K.prototype._getHorizonDates=function(t){var e=t.getStartTime();var i=t.getEndTime();return{startTime:new Date(R.abapTimestampToDate(e)),endTime:new Date(R.abapTimestampToDate(i))}};K.prototype._horizonWidthInSec=function(t){if(t&&t.startTime&&t.endTime){return t.endTime.getTime()-t.startTime.getTime()}return 0};K.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1]}var t=this._oModel.getProperty("/lastPageNumber"),e=this._oModel.getProperty("/exportAll"),i=[];if(e){for(var n=1;n<=t;n++){i.push(n)}return i}else{var o=this._oModel.getProperty("/exportRange");o=o.replace(/\s/g,"");var r=a.getIntegerInstance();var s=o.split(",");s.forEach(function(t){if(t.indexOf("-")!==-1){var e=t.split("-");var n=r.parse(e[0]);var a=r.parse(e[1]);for(var o=n;o<=a;o++){i.push(o)}}else{i.push(r.parse(t))}});return i}};K.prototype._validateFields=function(){var t=true;t&=this._validateExportRangeInput();t&=this._oInputMarginTop.getValueState()!=="Error";t&=this._oInputMarginRight.getValueState()!=="Error";t&=this._oInputMarginBottom.getValueState()!=="Error";t&=this._oInputMarginLeft.getValueState()!=="Error";return t};K.prototype._savePdf=function(){if(!this._validateFields()){return}var t=this._oModel.getProperty("/portrait")?"p":"l",e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight"),n=this._oModel.getProperty("/exportAsJPEG"),a=this._oModel.getProperty("/compressionQuality")/100,o=this._oModel.getProperty("/paperSize");var r=new W({orientation:t,unit:"px",format:o==="Custom"?[e*.75,i*.75]:o.toLowerCase()});var s=this._pageToBeExported();for(var h=0;h<s.length;h++){var l=this._getCanvasOfPageN(s[h],true);if(!l){continue}if(h!==0){r.addPage()}if(n){r.addImage(l.toDataURL("image/jpeg",a),"JPEG",0,0)}else{r.addImage(l.toDataURL("image/png"),"PNG",0,0)}}var g=new Date;r.save("GanttChartExport-"+g.toISOString()+".pdf")};K.prototype._createPaperComboBox=function(){this._oComboBoxPaperSizes=new C({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this),items:[new E({key:"A5",text:"A5"}),new E({key:"A4",text:"A4"}),new E({key:"A3",text:"A3"}),new E({key:"A2",text:"A2"}),new E({key:"A1",text:"A1"}),new E({key:"A0",text:"A0"}),new E({key:"Letter",text:"Letter"}),new E({key:"Legal",text:"Legal"}),new E({key:"Tabloid",text:"Tabloid"}),new E({key:"Custom",text:"Custom"})]});return this._oComboBoxPaperSizes};K.prototype._createPaperSizeFields=function(){this._oInputPaperWidth=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._oInputPaperHeight=new p({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._updatePaperSizeInputs();return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oInputPaperWidth,new r({text:"×"}),this._oInputPaperHeight,this._oComboBoxUnit=new C({width:"50%",selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),items:[new E({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new E({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new E({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]})]})};K.prototype._createDurationComboBox=function(){var t=this._getOriginalGanttChart().getAxisTimeStrategy(),e=t.getTotalHorizon(),i=new Date(R.abapTimestampToDate(e.getEndTime())),n=new Date;this._oComboBoxDuration=new C({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this),items:[new E({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new E({key:"week",enabled:this._getFirstDayOfNextWeek(n).getTime()<i.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new E({key:"month",enabled:this._getFirstDayOfNextMonth(n).getTime()<i.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new E({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration};K.prototype._createDatePicker=function(){var t=this._getOriginalGanttChart().getAxisTimeStrategy();var e=t.getTotalHorizon();var i=new Date(R.abapTimestampToDate(e.getStartTime()));var n=new Date(R.abapTimestampToDate(e.getEndTime()));this._oModel.setProperty("/startDate",i);this._oModel.setProperty("/endDate",n);this._oDatePickerFrom=new x({width:"47%",minDate:i,maxDate:"{setting>/endDate}",dateValue:"{setting>/startDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});this._oDatePickerTo=new x({width:"47%",minDate:"{setting>/startDate}",maxDate:n,dateValue:"{setting>/endDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oDatePickerFrom,new r({text:"~"}),this._oDatePickerTo]})};K.prototype._createScale=function(){return new v({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true})};K.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")){return true}var t=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(t)){this._oInputRange.setValueState("None");return true}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false};K.prototype._createPageRange=function(){var t=function(t){var e=t.getSource().getSelectedIndex();if(e===0){this._oButtonExport.setEnabled(true);this._oInputRange.setValueState("None")}};return new _({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new f({layoutData:new u({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:t.bind(this),buttons:[new P({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}"}),new P({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" "})]}),this._oInputRange=new p({layoutData:new u({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingPageRangeInput")]})};K.prototype._createLabelWithSwitch=function(t,e){return new _({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new o({text:t}),new G({state:e,change:this._updateDialogPreview.bind(this)}).addStyleClass("sapGanttPrintingSwitchPadding")]})};K.prototype._createCheckBoxWithInput=function(t,e,i){return new _({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new m({selected:e,text:t,select:this._updateDialogPreview.bind(this)}),new p({width:"65%",value:i,enabled:e,change:this._updateDialogPreview.bind(this)})]})};K.prototype._createPanel=function(t,e){return new M({expandable:true,expanded:false,headerText:t,content:[new _({renderType:"Bare",direction:U.Column,items:[e]})]})};K.prototype._createCompressionSlider=function(){return new v({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:"sap.ui.model.type.Integer"},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true})};K.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new C({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new E({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new E({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new E({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new E({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var t=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(t);return this._oComboBoxCompression};K.prototype._updateInputsStep=function(t){var e=.1;if(t==="mm"){e=1}return e};K.prototype._createMargin=function(){function t(t){return Math.round(this._convertPxToUnit(t/3))}return[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN")+":"}),new C({change:this._onChangeMarginComboBox.bind(this),selectedKey:"{setting>/marginType}",items:[new E({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new E({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new E({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new _({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(t){return t==="custom"}},items:[new _({direction:U.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")}),this._oInputMarginTop=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginTop")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:t.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")}),this._oInputMarginLeft=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginLeft")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:t.bind(this)},description:"{setting>/unit}"})]}),new _({direction:U.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")}),this._oInputMarginBottom=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginBottom")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:t.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")}),this._oInputMarginRight=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginRight")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:t.bind(this)},description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin"),new g({icon:{path:"setting>/marginLocked",formatter:function(t){if(t){return"sap-icon://chain-link"}return"sap-icon://broken-link"}},press:function(){var t=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!t)}.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")]};K.prototype._createCropMarks=function(){return[new G({state:"{setting>/cropMarks}"}),new _({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new _({direction:U.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Weight:"}),new T({min:0,step:.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new _({direction:U.Column,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Offset:"}),this._oInputCropMarksOffset=new T({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")]};K.prototype._createCompression=function(){var t=this._oModel.getProperty("/exportAsJPEG");return[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),new f({columns:2,selectedIndex:t?0:1,buttons:[new P({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}"}),new P({id:"png",text:"PNG"})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}"}),this._createCompressionComboBox(),this._createCompressionSlider().addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:"sap.ui.model.type.Boolean",formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingBottomMargin")]};K.prototype._createOptionsForm=function(){return new _({renderType:"Bare",direction:U.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),this._radioGroupPage=new f({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new P({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}"}),new P({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new f({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this),buttons:[new P({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new P({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new w({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(),this._createPaperSizeFields().addStyleClass("sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(),this._createDatePicker().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}"}),this._createScale().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}"}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin()),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]})};K.prototype._createDialogContent=function(){var t=new _({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new _({renderType:"Bare",layoutData:new u({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:U.Column,items:[new _({renderType:"Bare",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new B({content:'<div class="sapGanttPrintingPreviewContentDiv"><div class="sapGanttPrintingPreviewPageDiv"></div></div>'}),new _({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new g({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new g({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent"}),new r({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(t,e){return e?this._oRb.getText("GNT_PRNTG_OF",[t,e]):t.toString()}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new g({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new g({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent"})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new c({horizontal:false,vertical:true,layoutData:new u({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons();return t};K.prototype._createAndOpenDialog=function(){this._oDialog=new h({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent()],buttons:[this._oButtonExport=new g({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:d.ButtonType.Emphasized,press:this.export.bind(this)}),this._oButtonClose=new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close()}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(t){this.close();t.preventDefault();t.stopPropagation()}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=z.register(this._oDialog,this._onResize.bind(this))};K.prototype._openProgressDialog=function(){this._oProgressIndicator=new l({state:"Information",percentValue:0});this._oProgressText=new r({text:this._oRb.getText("GNT_PRNTG_PDF_PREVIEW"),textAlign:"Center"}).addStyleClass("sapGanttPrintingProgressText");this._oProgressIndicatorBox=new _(this.getId()+"-progressFlexBox",{direction:"Column",alignItems:"Center",items:[this._oProgressText,this._oProgressIndicator],renderType:"Bare"}).addStyleClass("sapGanttPrintingProgressBox");this._oProgressDialog=new h(this.getId()+"-progressDialog",{contentWidth:"25%",showHeader:false,content:[this._oProgressIndicatorBox],buttons:[new g({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this._closeProgressIndicator()}.bind(this)})]});this._oProgressDialog.open()};return K});
//# sourceMappingURL=GanttPrinting.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/base/assert","sap/base/Log","sap/ui/core/Control","sap/ui/model/ChangeReason","sap/base/util/values","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/ResizeHandler","./FullScreenUtil","./InnerGanttChart","./GanttHeader","./GanttSyncedControl","../control/AssociateContainer","../axistime/ProportionZoomStrategy","./SelectionModel","./ExpandModel","./ShapeScheme","./GanttExtension","./GanttScrollExtension","./GanttZoomExtension","./GanttPointerExtension","./GanttDragDropExtension","./GanttPopoverExtension","./GanttConnectExtension","./GanttResizeExtension","./GanttLassoExtension","./GanttUtils","./RenderUtils","../misc/Format","../misc/Utility","../config/TimeHorizon","sap/ui/export/Spreadsheet","sap/m/OverflowToolbar","sap/ui/core/Core","sap/base/util/uid","sap/m/Dialog","sap/m/Input","sap/m/Label","sap/m/VBox","sap/m/Button","sap/ui/model/json/JSONModel","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/base/util/deepEqual","sap/ui/core/CustomData","sap/gantt/simple/GanttAdaptationData","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","./HighlightModel","sap/gantt/simple/AggregationUtils","./FindAndSelectUtils"],function(e,jQuery,t,i,a,n,s,o,r,l,h,p,g,d,u,c,f,S,m,y,b,T,_,v,E,x,w,C,D,R,A,P,I,V,H,z,L,O,M,G,B,U,N,F,W,k,j,J,Z,X,q,K,Y){"use strict";var Q=e.simple.GanttChartWithTableDisplayType,$=e.simple.VisibleHorizonUpdateType,ee=e.simple.VisibleHorizonUpdateSubType,te=e.simple.exportTableCustomDataType;var ie=Object.freeze({totalHorizonUpdated:$.TotalHorizonUpdated,mouseWheelZoom:$.MouseWheelZoom,syncVisibleHorizon:$.SyncVisibleHorizon,initialRender:$.InitialRender,horizontalScroll:$.HorizontalScroll,zoomLevelChanged:$.ZoomLevelChanged,timePeriodZooming:$.TimePeriodZooming});var ae=z.getLibraryResourceBundle("sap.gantt");var ne=10;var se=60;function oe(e,t){return e+t}function re(e,t){return Math.abs(e-t)<ne}var le=a.extend("sap.gantt.simple.GanttChartWithTable",{metadata:{library:"sap.gantt",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},shapeSelectionMode:{type:"sap.gantt.SelectionMode",defaultValue:e.SelectionMode.MultiWithKeyboard},shapeOverRelationship:{type:"boolean",defaultValue:true},shapeSelectionSettings:{type:"object",defaultValue:null},shapeHighlightSettings:{type:"object",defaultValue:null},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},nowLineInUTC:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},adhocLineLayer:{type:"string",defaultValue:e.AdhocLineLayer.Top},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},enableChartDeltaAreaHighlight:{type:"boolean",defaultValue:true},deltaLineLayer:{type:"string",defaultValue:e.DeltaLineLayer.Bottom},datePattern:{type:"string",defaultValue:e.config.DEFAULT_DATE_PATTERN},timePattern:{type:"string",defaultValue:e.config.DEFAULT_TIME_PATTERN},enableExpandedRowBorders:{type:"boolean",defaultValue:true},enableExpandedRowBackground:{type:"boolean",defaultValue:true},expandedRowHeight:{type:"int"},dragOrientation:{type:"sap.gantt.DragOrientation",defaultValue:e.DragOrientation.Free},ghostAlignment:{type:"string",defaultValue:e.dragdrop.GhostAlignment.None},showShapeTimeOnDrag:{type:"boolean",defaultValue:false},selectionPanelSize:{type:"sap.ui.core.CSSSize",defaultValue:"30%"},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:Q.Both},disableShapeDoubleClickEvent:{type:"boolean",defaultValue:false},showExportTableToExcel:{type:"boolean",defaultValue:false},enableSelectAndDrag:{type:"boolean",defaultValue:true},deltaAreaHighlightColor:{type:"string",defaultValue:"@sapUiListSelectionBackgroundColor"},enableLassoInvert:{type:"boolean",defaultValue:false},showParentRowOnExpand:{type:"boolean",defaultValue:true},printingBatchSize:{type:"int",defaultValue:100},showGanttHeader:{type:"boolean",defaultValue:true},_enableRTA:{type:"boolean",defaultValue:false},snapMode:{type:"sap.gantt.dragdrop.SnapMode",defaultValue:e.dragdrop.SnapMode.None},snapTimeInterval:{type:"object",defaultValue:{}},enableChartOverflowToolbar:{type:"boolean",defaultValue:false},enableChartSelectionState:{type:"boolean",defaultValue:true},enableChartHoverState:{type:"boolean",defaultValue:true},selectOnlyGraphicalShape:{type:"boolean",defaultValue:false},showTextOnGhost:{type:"boolean",defaultValue:true},relationshipShapeSize:{type:"sap.gantt.simple.relationshipShapeSize",defaultValue:e.simple.relationshipShapeSize.Medium},useParentShapeOnExpand:{type:"boolean",defaultValue:false},findBy:{type:"string[]",defaultValue:[]},findByOperator:{type:"string",defaultValue:e.simple.findByOperator.OR},isConnectorDetailsVisible:{type:"boolean",defaultValue:false},rowHighlightFill:{type:"sap.gantt.ValueSVGPaintServer"},rowHighlightAndHoverFill:{type:"sap.gantt.ValueSVGPaintServer"}},aggregations:{table:{type:"sap.ui.table.Table",multiple:false},adhocLines:{type:"sap.gantt.AdhocLine",multiple:true,singularName:"adhocLine",bindable:"bindable",visibility:"public"},simpleAdhocLines:{type:"sap.gantt.simple.AdhocLine",multiple:true,singularName:"simpleAdhocLine",bindable:"bindable",visibility:"public"},deltaLines:{type:"sap.gantt.simple.DeltaLine",multiple:true,singularName:"deltaLine",bindable:"bindable",visibility:"public"},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"svgDef"},shapeSchemes:{type:"sap.gantt.simple.ShapeScheme",multiple:true,singularName:"shapeScheme"},calendarDef:{type:"sap.gantt.def.cal.CalendarDefs",multiple:false,bindable:"bindable"},axisTimeStrategy:{type:"sap.gantt.axistime.AxisTimeStrategyBase",multiple:false,bindable:"bindable"},locale:{type:"sap.gantt.config.Locale",multiple:false},_splitter:{type:"sap.ui.layout.Splitter",multiple:false,visibility:"hidden"},_header:{type:"sap.gantt.simple.GanttHeader",multiple:false,defaultValue:null,visibility:"hidden"},_innerGantt:{type:"sap.gantt.simple.InnerGanttChart",multiple:false,visibility:"hidden"},ganttAdaptationData:{type:"sap.gantt.simple.GanttAdaptationData",multiple:true},overflowToolbarItems:{type:"sap.ui.core.Control",multiple:true}},events:{shapeSelectionChange:{parameters:{shapeUids:{type:"string[]"}}},shapeHighlightChange:{parameters:{shapeUids:{type:"string[]"}}},shapeResize:{parameters:{shapeUid:{type:"string"},shape:{type:"sap.gantt.simple.BaseShape"},rowObject:{type:"object"},oldTime:{type:"string[]"},newTime:{type:"string[]"}}},shapeMouseEnter:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"}}},shapeMouseLeave:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},shapePress:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}},allowPreventDefault:true},shapeDoubleClick:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},shapeContextMenu:{parameters:{pageX:{type:"int"},pageY:{type:"int"},popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},dragStart:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},cursorDateTime:{type:"object"}}},shapeDrop:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},targetGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},targetRow:{type:"sap.ui.table.Row"},cursorDateTime:{type:"object"},newDateTime:{type:"object"},targetShape:{type:"sap.gantt.simple.BaseShape"}}},shapeConnect:{parameters:{fromShapeUid:{type:"string"},toShapeUid:{type:"string"},type:{type:"sap.gantt.simple.RelationshipType"}}},visibleHorizonUpdate:{parameters:{type:{type:"sap.gantt.simple.VisibleHorizonUpdateType"},subType:{type:"sap.gantt.simple.VisibleHorizonUpdateSubType"},lastVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},lastRenderedVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentRenderedVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"}}},shapeConnectorList:{parameters:{pageX:{type:"int"},pageY:{type:"int"},connectorList:{type:"object"}}},renderingComplete:{}},designtime:"sap/gantt/designtime/simple/GanttChartWithTable.designtime"}});le.prototype.init=function(){this.iGanttRenderedWidth=-1;this._bExtensionsInitialized=false;this._bSupressShapeChangeEvent=false;this._bRowActionInitialRender=false;this._oExpandModel=new S;this._aExpandedIndices=[];this._oSplitter=new o({id:this.getId()+"-ganttChartSplitter"});this.setAggregation("_splitter",this._oSplitter);this._oSyncedControl=new d;var e=new p;this.setAggregation("_innerGantt",e);this.setAggregation("_header",new g);e.attachEvent("ganttReady",function(e){var t=e.getParameter("supressEvent");if(!t){this.fireRenderingComplete()}}.bind(this));this._sPreviousDisplayType=this.getDisplayType();this.searchTxt=[];this.searchProperty=[];this._createInnerGanttRenderPromise()};le.prototype.getInnerGantt=function(){return this.getAggregation("_innerGantt")};le.prototype.onSplitterResize=function(e){var t=e.getParameter("oldSizes"),i=e.getParameter("newSizes"),a=t.length>0&&i.length>0&&(t[0]!==i[0]||t[1]!==i[1]),n=this.getDisplayType(),s=i[0],o=false;if(this._sPreviousDisplayType!==n){o=true;this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}if(a){if(n===Q.Both){this._onResize(a)}var r=function(e){return this.getSelectionPanelSize().startsWith("0")||e[0]!==0}.bind(this);if(re(t.reduce(oe),i.reduce(oe))&&t[0]!==i[0]&&r(t)){this.setProperty("selectionPanelSize",this._oSplitter._getContentAreas()[0].getLayoutData().getSize(),true);this.fireEvent("_selectionPanelResize",{newWidth:s,displayType:n})}if(o){this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}this._draw()}};le.prototype.setLayoutData=function(e){this.setAggregation("layoutData",e,true);this.fireEvent("_layoutDataChange");return this};le.prototype.setDisplayType=function(e){this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===Q.Both&&e!==Q.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize()}this._isDisplayTypeChanged=true;this.setProperty("displayType",e,false);if(e===Q.Table){this._iLastVisibleWidth=this.getVisibleWidth();this.setProperty("selectionPanelSize","auto",true)}else{delete this._bPreventInitialRender}this._setupDisplayType();return this};le.prototype.setShapeSelectionSettings=function(e){this.setProperty("shapeSelectionSettings",e,true);if(this._getResizeExtension){this._getResizeExtension().updatemSelectionSettings()}};le.prototype.setShapeHighlightSettings=function(e){this.setProperty("shapeHighlightSettings",e,true);if(this._getResizeExtension){this._getResizeExtension().updatemHighlightSettings()}};le.prototype.setSelectionPanelSize=function(e){this.setProperty("selectionPanelSize",e,false);delete this._iLastTableAreaSize;this._setSplitterLayoutData(e,"auto");return this};le.prototype.applySettings=function(e,t){e=e||{};this._applyMissingSettings(e);a.prototype.applySettings.call(this,e,t);this._initSelectionModel(this.getProperty("shapeSelectionMode"));this._initHighlightModel("Single")};le.prototype._applyMissingSettings=function(t){if(!t.axisTimeStrategy){t.axisTimeStrategy=new c}if(!t.locale){t.locale=e.config.DEFAULT_LOCALE_CET.clone()}if(!t.shapeSchemes){t.shapeSchemes=[new m({key:"default",primary:true})]}else{var a=t.shapeSchemes.some(function(e){return e.getPrimary()});if(!a){i.warning("you need set a ShapeSheme with primary:true")}}};le.prototype.getPrimaryShapeScheme=function(){return this.getShapeSchemes().filter(function(e){return e.getPrimary()})[0]};le.prototype.getSyncedControl=function(){return this._oSyncedControl};le.prototype.getTableRowHeights=function(){return this.getSyncedControl().getRowHeights()};le.prototype.setTable=function(e){this.setAggregation("table",e);e.addCustomData(new J({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{designtime:"sap/gantt/designtime/simple/Table.designtime"}}}));e._bVariableRowHeightEnabled=true;var t=this._oSplitter.removeContentArea(0);this._oSplitter.insertContentArea(new u({content:e,enableRootDiv:true,layoutData:e.getLayoutData()?e.getLayoutData().clone():new r({size:this.getSelectionPanelSize()})}),0);var i=e.getRowActionTemplate();if(i&&i.isA("sap.gantt.simple.GanttRowAction")&&i.getControlTemplate()){e.setRowHeight(80)}if(t==null){this._oSyncedControl.syncWith(e);this._oSplitter.addContentArea(this._oSyncedControl)}else if(t&&t.getContent()!==e.getId()){this._oSyncedControl.syncWith(e)}e.detachEvent("_rowsUpdated",this._onTableRowsUpdated,this);e.attachEvent("_rowsUpdated",this._onTableRowsUpdated,this);e.attachEvent("columnMove",this._onTableColumnMove,this);e.attachEvent("filter",this._onTableFilter,this);e.attachEvent("sort",this._onTableSorter,this);e.attachEvent("columnVisibility",this._onColumnVisible,this);e.attachEvent("settingsChange",this._onTableSettingsChanged,this)};le.prototype.setGanttAdaptationData=function(e,t){this.addAggregation("ganttAdaptationData",new Z(e,t),true)};le.prototype.setEnableVariableRowHeight=function(e){if(this.getTable()){this.getTable()._bVariableRowHeightEnabled=e}else{i.warning("you need to set table aggregation first")}};le.prototype.setLargeDataScrolling=function(e){if(this.getTable()){this.getTable()._setLargeDataScrolling(e)}else{i.warning("you need to set table aggregation first")}};le.prototype.getRenderedTimeRange=function(){return this.getAxisTime().getTimeRangeSlice(0,this.iGanttRenderedWidth)};le.prototype._initSelectionModel=function(e){if(this.oSelection){this.oSelection.detachSelectionChanged(this._onSelectionChanged,this)}this.oSelection=new f(e);this.oSelection.attachSelectionChanged(this._onSelectionChanged,this);return this};le.prototype.setShapeSelectionMode=function(e){this.setProperty("shapeSelectionMode",e);if(this.oSelection){this.oSelection.setSelectionMode(e)}return this};le.prototype._initHighlightModel=function(e){if(this.oHighlight){this.oHighlight.detachHighlightChanged(this._onHighlightChanged,this)}this.oHighlight=new q(e);this.oHighlight.attachHighlightChanged(this._onHighlightChanged,this);return this};le.prototype.getSelectedShapeUid=function(){return this.oSelection.allUid()};le.prototype.getSelectedShapeId=function(){return this.oSelection.getSelectedShapeIDS()};le.prototype.getHighlightedShapeUid=function(){return this.oHighlight.allUid()};le.prototype.setSelectedShapeUid=function(e){return this.selectShapes(e,true)};le.prototype.selectShapes=function(e,t){if(!this.oSelection){return this}if((!e||e.length===0)&&t){this._bSupressShapeChangeEvent=false;this.oSelection.clear(true);return this}var i=this._bSupressShapeChangeEvent;this._bSupressShapeChangeEvent=true;if(t){this.oSelection.clear(false);this.getSelection().clearAllSelectedShapeIds()}else{var a=D.getShapeIdFromShapeUid(e);if(a&&a.length>0){a.forEach(function(e){this.getSelection().clearDeselectionModelById(e)}.bind(this))}}this._bSupressShapeChangeEvent=i;this._updateShapes(e,true);return this};le.prototype._getRowIdPath=function(){return this.getTable().getRowSettingsTemplate().mBindingInfos.rowId.parts[0].path};le.prototype._getShapeIdPath=function(){var e;if(this.getSelectedShapeUid()&&this.getSelectedShapeUid().length>0){var t=D.getShapesWithUid(this.sId,this.getSelectedShapeUid());t.forEach(function(t){if(!e&&t){e=t.getBindingPath("shapeId")}})}else{var i=this.getTable().getRows();i.forEach(function(t){if(!e){var i=t.getAggregation("_settings");if(i){var a=K.getAllNonLazyAggregations(i);var n=Object.keys(a).filter(function(e){return e.indexOf("shapes")===0}).map(function(e){return i.getAggregation(e)||[]});n.forEach(function(t){if(t&&t.length>0&&!e){e=t[0].getBinding("shapeId")&&t[0].getBinding("shapeId").getPath()}})}}})}return e};le.prototype.findAndSelect=function(e,t,i,a){var n=this.findAll(e,t);if(a){if(i){this.searchTxt=[];this.searchProperty=[]}if(this.searchTxt.indexOf(e)===-1){this.searchTxt.push(e)}if(Array.isArray(t)){this.searchProperty.concat(t)}else if(this.searchProperty.indexOf(t)===-1){this.searchProperty.push(t)}}var s=[];this._bDeselectShapes=false;n.forEach(function(e){if(e.rowID||e.shapeID.length>0){if(a){s.push({rowId:e.rowID,Selected:true})}else{e.shapeID.forEach(function(e){s.push({ShapeId:e,Selected:true})})}e.selected=true}});if(i){this.getSelection().clearAllSelectedShapeIds();this.getSelection().updateShape(null,{selected:false,ctrl:false})}if(s.length>0){this.oSelection.updateSelectedShapes(s,i)}};le.prototype.findAndDeselect=function(e,t,i){var a=[];if(e===""){this.getSelection().clearAllSelectedShapeIds();this.getSelection().updateShape(null,{selected:false,ctrl:false});return}var n=this.findAll(e,t);if(i){this.deSelectTxt=e;this.deSelectProperty=t;if(this.searchTxt.indexOf(e)!==-1){this.searchTxt.splice(this.searchTxt.indexOf(e),1)}if(this.searchProperty.indexOf(t)!==-1){this.searchProperty.splice(this.searchTxt.indexOf(e),1)}}n.forEach(function(e){if(e.rowID||e.shapeID.length>0){if(i){a.push({rowId:e.rowID,Selected:false})}else{e.shapeID.forEach(function(e){a.push({ShapeId:e,Selected:false})})}e.selected=false}});if(a.length>0){this.oSelection.updateSelectedShapes(a,false)}};le.prototype.findAll=function(t,i){var a=[],n=this.getTable().getBinding().getModel().oData,s=this.getFindByOperator(),o={},r=this.getTable().getBinding().sPath.split("/")[1],l=this.getTable().getBinding().mParameters?this.getTable().getBinding().mParameters.arrayNames:null,h=[],p=[],g,d=this.getTable().getRowSettingsTemplate().mBindingInfos.rowId.parts[0].path,u=this._getShapeIdPath(),c={},f=false;this.pathList={};this.pathList[r]={};this._iNodesLength=0;this._getAllBindingPaths(this.pathList[r],this.getTable().getRowSettingsTemplate());if(!this._aAllShapesFormatters){this._aAllShapesFormatters=[];var S=this.getTable().getRowSettingsTemplate();this._getAllFormatters(S);this._aAllShapesFormatters.forEach(function(e,t){this._aAllShapesFormatters.forEach(function(i,a){if(t!==a){var n=JSON.stringify(e.parts);var s=JSON.stringify(i.parts);if(e.formatter.name===i.formatter.name&&n===s){this._aAllShapesFormatters.splice(a,1)}}}.bind(this))}.bind(this))}Object.keys(n).filter(function(e){if(e.startsWith(r)){return true}}).forEach(function(e){var t=Object.assign({},n[e]);this._iNodesLength++;if(l&&l.length>0){l.forEach(function(e){if(t[e]){y.call(this,t[e],e)}}.bind(this))}else if(Array.isArray(t)){t.forEach(function(e){this._iNodesLength++;e.ganttShapeRelated=[];h.push(e)}.bind(this))}else{t.ganttShapeRelated=[];h.push(t)}}.bind(this));if(l&&l.length>0){var m=this.pathList[r];Object.keys(m).forEach(function(e){p.forEach(function(t){if(t[e]&&t[e].length>0){var i=t[d];b(t[e],i,m[e]);h=h.concat(t[e])}})});d=g}else{v(h,this.pathList)}P.call(this,h);Object.keys(o).forEach(function(e){if(e.toLowerCase().includes(t.toString().toLowerCase())){o[e].forEach(function(e){if(e.findAndSelectData.rowID&&e.findAndSelectData.shapeID.length>0){var t=JSON.parse(JSON.stringify(e.findAndSelectData));t.isExpandable=e.isExpandable;t.isParent=e.showParentRowOnExpand;a.push(t);f=true}})}});if(a.length===0){A(this)}if(f){a=a.filter(function(e){var t;if(c.hasOwnProperty(e.shapeID[0])){t=c[e.shapeID[0]];t.sMatchedValue=t.sMatchedValue+", "+e.sMatchedValue;return false}c[e.shapeID[0]]=e;return true})}return a;function y(e,t){e.forEach(function(e){this._iNodesLength++;if(e.hasOwnProperty(t)){y.call(this,e[t],t)}p.push(e)}.bind(this))}function b(e,t,i){e.forEach(function(e){g="row_"+u;e[g]=t;e["shapeIDPath"]=e[i["shapeIDPath"]];if(i.expandable){e.isExpandable=i.expandable}if(i.showParentRowOnExpand!==undefined&&typeof i.showParentRowOnExpand==="boolean"){e.showParentRowOnExpand=i.showParentRowOnExpand}})}function T(e,i){return e[i]!==undefined&&e[i]!==null&&e[i].toString().toLowerCase().indexOf(t.toString().toLowerCase())!==-1}function _(e,t,i){var a=JSON.parse(JSON.stringify(n[i]));t.shapeIDPath.forEach(function(e){if(a[e]){a.shapeIDPath=a[e]}});if(t.expandable){a.isExpandable=t.expandable}if(t.showParentRowOnExpand!==undefined&&typeof t.showParentRowOnExpand==="boolean"){a.showParentRowOnExpand=t.showParentRowOnExpand}if(!e.ganttShapeRelated){e.ganttShapeRelated=[]}e.ganttShapeRelated.push(a)}function v(e,t){e.forEach(function(e){var i=JSON.parse(JSON.stringify(t)),a=Object.keys(i);if(!a.includes("expandable")&&!a.includes("showParentRowOnExpand")){e.showParentRowOnExpand=false}while(i&&a.length>0){var n=true,s=["shapeIDPath","showParentRowOnExpand","expandable"];for(var o=0;o<a.length;o++){if(!s.includes(a[o])){n=false;if(e[i[a[o]].shapeIDPath]){e.shapeIDPath=e[i[a[o]].shapeIDPath]}if(e[a[o]]&&e[a[o]].__list){e[a[o]].__list.forEach(_.bind(null,e,i[a[o]]))}i=JSON.parse(JSON.stringify(i[a[o]]));a=Object.keys(i);if(i&&Object.keys(i).length>0&&e.ganttShapeRelated&&e.ganttShapeRelated.length>0){v(e.ganttShapeRelated,i)}}}if(n){i={};a=Object.keys(i)}}})}function E(t,a){var n=false;a.sMatchedValue="";a.oMatchedValue={};if(s===e.simple.findByOperator.AND){n=true;i.forEach(function(e){if(!n){return}if(!T(t,e)){n=false}else{a.sMatchedValue=a.sMatchedValue.concat(t[e]+" ");a.oMatchedValue[e]=t[e]}})}else if(s===e.simple.findByOperator.OR){i.forEach(function(e){if(T(t,e)){n=true;a.sMatchedValue=a.sMatchedValue.concat(t[e]+" ");a.oMatchedValue[e]=t[e]}})}if(n){return t}}function x(e,t){var a=false;t.sMatchedValue="";t.oMatchedValue={};if(T(e,i)){a=true;t.sMatchedValue=t.sMatchedValue.concat(e[i]+" ");t.oMatchedValue[i]=e[i]}if(a){return e}}function w(e,t,i){e.forEach(function(e){C(e,t,i)});return t}function C(e,t,i){if(e[d]){t.rowID=e[d]}Object.keys(e).forEach(function(n){if(n==="ganttShapeRelated"){t=w(e[n],t,i)}else if(T(e,n)){if((e[u]||e.shapeIDPath)&&!t.shapeID.includes(e[u]||e.shapeIDPath)){t.shapeID.push(e[u]||e.shapeIDPath);t.startTime=e[i._startTimePath];t.sMatchedValue=t.sMatchedValue.concat(e[n]+" ");t.oMatchedValue[n]=e[n];var s=JSON.parse(JSON.stringify(t));if(e.isExpandable){s.isExpandable=e.isExpandable}if(e.showParentRowOnExpand!==undefined&&typeof e.showParentRowOnExpand==="boolean"){s.isParent=e.showParentRowOnExpand}s.shapeID=[e[u]||e.shapeIDPath];s.sMatchedValue=e[n];s.data=e;a.push(s)}}});return t}function D(e,t,i){if(e[d]){t.rowID=e[d]}var n=E(e,t);if(n&&(n[u]||n.shapeIDPath)&&!t.shapeID.includes(n[u]||n.shapeIDPath)){t.shapeID.push(n[u]||n.shapeIDPath);t.startTime=n[i._startTimePath];var s=JSON.parse(JSON.stringify(t));if(n.isExpandable){s.isExpandable=n.isExpandable}if(n.showParentRowOnExpand!==undefined&&typeof n.showParentRowOnExpand==="boolean"){s.isParent=n.showParentRowOnExpand}s.shapeID=[n[u]||n.shapeIDPath];s.data=n;a.push(s)}if(e.ganttShapeRelated&&e.ganttShapeRelated.length>0){e.ganttShapeRelated.forEach(function(e){t=D(e,t,i)})}return t}function R(e,t,i){if(e[d]){t.rowID=e[d]}var n=x(e,t);if(n&&(n[u]||n.shapeIDPath)&&!t.shapeID.includes(n[u]||n.shapeIDPath)){t.shapeID.push(n[u]||n.shapeIDPath);t.startTime=n[i._startTimePath];if(n.isExpandable){t.isExpandable=n.isExpandable}if(n.showParentRowOnExpand!==undefined&&typeof n.showParentRowOnExpand==="boolean"){t.isParent=n.showParentRowOnExpand}t.data=n;a.push(t)}if(e.ganttShapeRelated&&e.ganttShapeRelated.length>0){e.ganttShapeRelated.forEach(function(e){t=R(e,t,i)})}return t}function A(e){h.forEach(function(t){var a={rowID:"",shapeID:[],sMatchedValue:"",startTime:null,isExpandable:false,oMatchedValue:{}};if(Array.isArray(i)&&i.length>0){a=D(t,a,e)}else if(typeof i==="string"&&i!==""){a=R(t,a,e)}else{a=C(t,a,e)}})}function P(e){e.forEach(function(e){var t=JSON.parse(JSON.stringify(e)),a={rowID:"",shapeID:[],sMatchedValue:"",startTime:null,isExpandable:false,data:e};if(t[d]){a.rowID=t[d]}if(t[this._startTimePath]){a.startTime=t[this._startTimePath]}if(t.shapeIDPath){a.shapeID.push(t.shapeIDPath)}this._aAllShapesFormatters.forEach(function(e){var n=true,s=[];e.parts.forEach(function(e){var a=e.path.split("/")[0];if(i&&i.length>0&&i.indexOf(a)===-1){n=false}else if(e.model!=="i18n"&&!t[a]){n=false}else if(e.model==="i18n"){s.push(this.getModel("i18n").getResourceBundle().getText(a))}else{var o=new Date(t[a]);if(o.toString()!=="Invalid Date"){t[a]=o;s.push(t[a])}else{s.push(t[a])}}}.bind(this));if(n){var r=e.formatter.apply(null,s);if(r!==undefined){if(!o[r.toString()]){o[r.toString()]=[]}a.sMatchedValue=a.sMatchedValue.concat(r.toString()+" ");t.findAndSelectData=a;o[r.toString()].push(t)}}}.bind(this));if(t.ganttShapeRelated&&t.ganttShapeRelated.length>0){P.call(this,t.ganttShapeRelated,a)}}.bind(this))}};le.prototype._getAllBindingPaths=function(e,t,i){var a=t.mBindingInfos,n=t.mAggregations;if(a){for(var s in a){if(s.toLowerCase().indexOf("calendars")===-1&&s.toLowerCase()!=="relationships"){var o=a[s];if(s==="shapeId"){if(e.shapeIDPath){if(!e.shapeIDPath.includes(o.parts[0].path)){e.shapeIDPath.push(o.parts[0].path)}}else{e.shapeIDPath=[o.parts[0].path]}}if(o.path){var r=o.template.mBindingInfos.shapeId&&o.template.mBindingInfos.shapeId.parts[0].path;if(!e[o.path]){e[o.path]={shapeIDPath:[]}}if(r&&!e[o.path].shapeIDPath.includes(r)){e[o.path].shapeIDPath.push(r)}if(o.template&&o.template.getExpandable()){e[o.path].expandable=o.template&&o.template.getExpandable()}if(i){e[o.path].expandable=i}else{e[o.path].showParentRowOnExpand=this.getShowParentRowOnExpand()}this._getAllBindingPaths(e[o.path],o.template,o.template.getExpandable())}}}}if(n){var l=function(t){if(!t.isA||t.isA("sap.gantt.simple.BaseShape")&&!t.isA("sap.gantt.simple.UtilizationChart")){this._getAllBindingPaths(e,t)}};for(var h in n){var p=n[h];if(Array.isArray(p)){p.forEach(l.bind(this))}else if(p.isA&&p.isA("sap.gantt.simple.BaseShape")&&!p.isA("sap.gantt.simple.UtilizationChart")){this._getAllBindingPaths(e,p)}}}if(!n&&!a){return false}return true};le.prototype._hasTimeContinuousShapes=function(e){var t=e.mBindingInfos,i=e.mAggregations;if(t){for(var a in t){if(a.toLowerCase().indexOf("calendars")===-1&&a.toLowerCase()!=="relationships"){var n=t[a],s=n.template;if(s){if(s.isA&&s.isA("sap.gantt.simple.BaseShape")&&s.isA("sap.gantt.simple.UtilizationChart")){this._bTimeContinuousShapes=true;return}if(!this._bTimeContinuousShapes){this._hasTimeContinuousShapes(s)}}}}}if(i){var o=function(e){if(e.isA&&e.isA("sap.gantt.simple.BaseShape")&&e.isA("sap.gantt.simple.UtilizationChart")){this._bTimeContinuousShapes=true;return}if(!this._bTimeContinuousShapes){this._hasTimeContinuousShapes(e)}};for(var r in i){var l=i[r];if(Array.isArray(l)){l.forEach(o.bind(this))}else if(l.isA&&l.isA("sap.gantt.simple.BaseShape")&&l.isA("sap.gantt.simple.UtilizationChart")){this._bTimeContinuousShapes=true;return}else if(!this._bTimeContinuousShapes&&l.isA&&l.isA("sap.gantt.simple.BaseShape")&&!l.isA("sap.gantt.simple.UtilizationChart")){this._hasTimeContinuousShapes(l)}}}};le.prototype._getAllFormatters=function(e){var t=e.mBindingInfos,i=e.mAggregations;if(t){for(var a in t){if(a.toLowerCase().indexOf("calendars")===-1&&a.toLowerCase()!=="relationships"){var n=t[a];if(a==="time"){this._startTimePath=n.parts[0].path}if(n.template){this._getAllFormatters(n.template)}else{var s=this._getAllFormatters(n);if(!s&&n.formatter){this._aAllShapesFormatters.push({formatter:n.formatter,parts:n.parts})}}}}}if(i){for(var o in i){var r=i[o];if(Array.isArray(r)){r.forEach(function(e){this._getAllFormatters(e)}.bind(this))}else if(r.isA&&r.isA("sap.gantt.simple.BaseShape")){this._getAllFormatters(r)}}}if(!i&&!t){return false}return true};le.prototype.deselectShapes=function(e){if(!this.oSelection||!e||e.length===0){return this}this._updateShapes(e,false);return this};le.prototype._updateShapes=function(e,t){var i={};var a=D.getShapesWithUid(this.getId(),e);for(var n=0;n<e.length;n++){i[e[n]]={selected:t,ctrl:false};if(a[n]){i.draggable=a[n].getDraggable();i.time=a[n].getTime();i.endTime=a[n].getEndTime()}}this.oSelection.updateShapes(i)};le.prototype._onSelectionChanged=function(e){var t=e.getParameter("shapeUid"),i=e.getParameter("deselectedUid"),a=e.getParameter("silent"),n=e.getParameter("deSelectAll");this._updateShapeSelections(t,i,n);if((!a||this._bDeselectShapes)&&!this._bSupressShapeChangeEvent){this.fireShapeSelectionChange({shapeUids:t})}};le.prototype._onHighlightChanged=function(e){var t=e.getParameter("shapeUid"),i=e.getParameter("deEmphasizedUid"),a=e.getParameter("silent"),n=e.getParameter("deEmphasizeAll");this.updateShapeHighlights(t,i,n);if((!a||this._bDeselectShapes)&&!this._bSupressShapeChangeEvent){this.fireShapeHighlightChange({shapeUids:t})}};le.prototype.setTimeForGroupShape=function(e){var t,i;function a(e){if(!t&&!i){t=e.getTime();i=e.getEndTime()}else{if(e.getTime()>=t){t=t}else{t=e.getTime()}if(e.getEndTime()>=i){i=e.getEndTime()}else{i=i}}}if(e instanceof sap.gantt.simple.BaseConditionalShape){var n=e._getActiveShapeElement();if(n instanceof sap.gantt.simple.BaseGroup){n.getShapes().forEach(function(e){a(e)});e.setTime(t);e.setEndTime(i)}else if(n){t=n.getTime();i=n.getEndTime();e.setTime(t);e.setEndTime(i)}}else if(e instanceof sap.gantt.simple.BaseGroup&&!(e.getTime()&&e.getEndTime())){e.getShapes().forEach(function(e){a(e)});e.setTime(t);e.setEndTime(i)}return e};le.prototype.handleShapePress=function(t){var i=t.shape,a=i.getShapeUid(),n=t.ctrlOrMeta,s=this._getDragDropExtension();var o=!i.getSelected();if(s.shapeSelectedOnMouseDown&&!s.initiallySelected&&!this.getEnableSelectAndDrag()){o=s.shapeSelectedOnMouseDown}this.setTimeForGroupShape(i);var r=this.getShapeSelectionMode();if(r!==e.SelectionMode.Multiple&&r!==e.SelectionMode.MultipleWithLasso&&!n){this.oSelection.clearAllSelectedShapeIds();this.searchTxt=[];this.searchProperty=[]}else{var l=D.getShapeIdFromShapeUid([a]);if(l&&l.length>0){l.forEach(function(e){this.getSelection().clearDeselectionModelById(e)}.bind(this))}}this.oSelection.updateShape(a,{selected:o,ctrl:n,draggable:i.getDraggable(),time:i.getTime(),endTime:i.getEndTime()});s.shapeSelectedOnMouseDown=false};le.prototype.handleShapeMouseEnter=function(e){if(!this.getEnableSelectAndDrag()){var t=e.shape,i=this._getResizeExtension();if(!t.getSelected()){i.addResizerOnMouseOver(t)}var a=this._getDragDropExtension();if(t.getDraggable()){a.updateCursorStyle("move")}}};le.prototype.handleShapeMouseLeave=function(e){if(!this.getEnableSelectAndDrag()){var t=this._getDragDropExtension();t.updateCursorStyle("default")}};le.prototype._updateShapeSelections=function(t,i,a){var n=this.getShapeSelectionMode();if(n===e.SelectionMode.None){return}if(this.oSelection.getSelectedShapeIDS().length>0||this.oSelection.getSelectedRowIDS().length>0||this.oSelection.getDeSelectedShapeIDS().length>0||this.oSelection.getDeSelectedRowIDS().length>0){R.updateShapeSelectionByShapeID(this,a)}R.updateShapeSelections(this,this.getSelection().allUid(),i)};le.prototype.updateShapeHighlights=function(e,t){if(this.oHighlight.getHighlightedShapeID().length>0||this.oHighlight.getDeEmphasizedShapeID().length>0){R.updateShapeHighlightByShapeID(this,t)}R.updateShapeHighlights(this,this.getHighlight().allUid(),e)};le.prototype._updateVsbContainers=function(){if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&this.getParent().getGanttCharts().length>1){var e=this.getParent().getGanttCharts();var t=false;var i,a,n;for(i=0;i<e.length;i++){a=e[i];n=a.getTable()._getScrollExtension().getVerticalScrollbar();if(n&&!n.parentElement.classList.contains("sapUiTableHidden")){t=true;break}}if(t){for(i=0;i<e.length;i++){a=e[i];n=a.getTable()._getScrollExtension().getVerticalScrollbar();if(n){var s=n.parentElement.classList,o=n.classList;if(s.contains("sapUiTableHidden")){s.add("sapGanttTableVerticalScrollBarContainer");o.add("sapGanttTableVerticalScrollBar")}else{s.remove("sapGanttTableVerticalScrollBarContainer");o.remove("sapGanttTableVerticalScrollBar")}}}}else{for(i=0;i<e.length;i++){a=e[i];n=a.getTable()._getScrollExtension().getVerticalScrollbar();var s=n.parentElement.classList,o=n.classList;if(n){s.remove("sapGanttTableVerticalScrollBarContainer");o.remove("sapGanttTableVerticalScrollBar")}}}}};le.prototype.getSelection=function(){return this.oSelection};le.prototype.getHighlight=function(){return this.oHighlight};le.prototype.getExpandedBackgroundData=function(){if(this._oExpandModel.hasExpandedRows()){var e=this.getTable().getRows();var t=e.length;var i=this.getTable().getFirstVisibleRow();var a=[];for(var n=0;n<t;n++){if(e[n].getIndex()>=i){var s=e[n].getAggregation("_settings");a.push(s.getRowUid())}}return this._oExpandModel.collectExpandedBgData(a,this.getExpandedRowHeight(),this.getShowParentRowOnExpand()&&!this.getUseParentShapeOnExpand())}};le.prototype.setAxisTimeStrategy=function(e){e.attachEvent("_redrawRequest",this._onRedrawRequest,this);delete this._bPreventInitialRender;return this.setAggregation("axisTimeStrategy",e,false)};le.prototype._addChangesToControlPersonalizationWriteAPI=function(e,t){var i=this.getParent();var a=i.isA("sap.gantt.simple.GanttChartContainer");var n=a&&i.getEnableVariantManagement()||this.getProperty("_enableRTA");if(!e.bPreventDefault&&n){X.add({changes:t})}};le.prototype._onTableFilter=function(e){var t=[{selectorElement:e.mParameters.column,changeSpecificData:{changeType:"TableColumnFilterValue",content:{propertyName:"filterValue",newValue:e.mParameters.value,oldValue:""}}}];this._addChangesToControlPersonalizationWriteAPI(e,t)};le.prototype._onTableSorter=function(e){var t=e.getParameter("column");var i=t.getParent();var a=[];i.getColumns().forEach(function(e){if(e!==t){a.push(e.getId())}});var n=[{selectorElement:t,changeSpecificData:{changeType:"TableColumnSortOrder",content:{propertyName:"sortOrder",newValue:e.getParameter("sortOrder"),oldValue:t.getSortOrder(),affectedControls:a}}}];this._addChangesToControlPersonalizationWriteAPI(e,n)};le.prototype._onColumnVisible=function(e){var t=e.mParameters.newVisible;var i=[{selectorElement:e.mParameters.column,changeSpecificData:{changeType:"TableColumnVisibility",content:{propertyName:"visible",newValue:t,oldValue:!t}}}];this._addChangesToControlPersonalizationWriteAPI(e,i)};le.prototype._onTableColumnMove=function(e){var t=e.getSource().getAggregation("columns").map(function(e){return e.getId()});var i=e.getParameter("column").getIndex();var a=e.getParameter("newPos");var n=Array.from(new Set(t));var s=D.arrayMove(n,i,a);var o=[];s.forEach(function(t,i){var a=e.getSource().getAggregation("columns").find(function(e){return e.getId()===t});o.push(a.getId())});var r=[];r.push({selectorElement:this.getTable(),changeSpecificData:{changeType:"GanttTableColumnOrder",content:{aggregationName:"columns",newValue:o,oldValue:t}}});this._addChangesToControlPersonalizationWriteAPI(e,r)};le.prototype._onTableSettingsChanged=function(e){this._bRowActionInitialRender=false};le.prototype._onTableRowsUpdated=function(e){if(!this.getVisible()){return}var t=e.getParameter("reason"),i=this.getInnerGantt(),a=e.getSource();this._invalidateRowActionTemplate(a,t);var o=s(n).slice();var r=o.concat(["Render","FirstVisibleRowChange","Resize"]);if(r.indexOf(t)!==-1){this.getSyncedControl().setAllowContentScroll(false);this._oInnerGanttRenderPromiseResolve()}else if(t==="VerticalScroll"){var l=this._getDragDropExtension();if(l._bEnableRowHighlight&&l.isDragging()){l.getShapeDndRowHighlightIndex(this);this.toggleDnDRowHighlight(true)}}else{i.getRenderer().renderImmediately(this)}};le.prototype.syncVisibleHorizon=function(e,t,i,a){var n=this.getAxisTimeStrategy();var s=n.getTotalHorizon();var o;var r=this.getVisibleWidth();if(t!==undefined){if(r===undefined){return}if(i){var l=n.getVisibleHorizon();var h=A.abapTimestampToDate(l.getStartTime());o=P.calculateHorizonByWidth(e,t,r,h)}else{o=P.calculateHorizonByWidth(e,t,r)}}else{o=e}if(s.getEndTime()<o.getEndTime()){var p=A.abapTimestampToDate(o.getEndTime()).getTime()-A.abapTimestampToDate(o.getStartTime()).getTime();var g=A.abapTimestampToDate(s.getEndTime());var d=new Date;d.setTime(g.getTime()-p);o=new I({startTime:d,endTime:g})}this._updateVisibleHorizon(o,a||"syncVisibleHorizon",r)};le.prototype._updateVisibleHorizon=function(e,t,i){var a=this.getAxisTimeStrategy();a.updateGanttVisibleWidth(i);if(t==="initialRender"){if(!a.isA("sap.gantt.axistime.StepwiseZoomStrategy")){a.calZoomBase()}a.createAxisTime(a.getLocale())}if(e&&(e.getStartTime()||e.getEndTime())){a.setVisibleHorizonWithReason(e,t)}};le.prototype.syncMouseWheelZoom=function(e){this._getZoomExtension().performMouseWheelZooming(e.originEvent,true)};le.prototype.syncTimePeriodZoomOperation=function(e,t,i){this._getZoomExtension().syncTimePeriodZoomOperation(e,t,i)};le.prototype._onRedrawRequest=function(e){var t=e.getParameter("valueBeforeChange");var i=e.getParameter("reasonCode");var a=e.getParameter("subReasonCode");if(t&&i!=="totalHorizonUpdated"&&i!=="initialRender"&&i!=="syncVisibleHorizon"){this._syncContainerGanttCharts(i,e.getParameter("originEvent"))}if(this._sPreviousDisplayType!==this.getDisplayType()){this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}var n,s,o,r;if(i!=="initialRender"){s=this.getRenderedTimeRange();n=new I({startTime:s[0],endTime:s[1]})}this.redraw(i);this._setupDisplayType();r=this.getRenderedTimeRange();o=new I({startTime:r[0],endTime:r[1]});this.fireVisibleHorizonUpdate({type:ie[i],subType:a?ee[a]:ee.NotApplicable,lastVisibleHorizon:t,currentVisibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),lastRenderedVisibleHorizon:n?n:o,currentRenderedVisibleHorizon:o})};le.prototype.redraw=function(e){this._draw(e)};le.prototype._draw=function(e){if(this.getDisplayType()===Q.Table&&!this.isPrint){var t=K.getAllNonLazyAggregations(this.getParent());if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.toolbar){this.getParent().getToolbar().updateZoomLevel(this.getAxisTimeStrategy().getZoomLevel())}}else{var i=this._iLastVisibleWidth?this._iLastVisibleWidth:this.getVisibleWidth();if(!i){return}var a=this.getAxisTimeStrategy().syncContext(i);if(this.getAxisTimeStrategy().initialSettings!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=0&&e=="initialRender"&&!this.getAxisTimeStrategy().isA("sap.gantt.axistime.FullScreenStrategy")&&!this.isPrint&&this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&!this.getParent().isZoomLevelUpdated){var n=this.getAxisTimeStrategy();var s=n.initialSettings.zoomLevel;n.setProperty("zoomLevel",s,true);a.zoomLevel=s;var o=n.calVisibleHorizonByRate(n._aZoomRate[s]);n.updateInitialVisibleHorizon(o,s);this.getParent().isZoomLevelUpdated=true}this.fireEvent("_zoomInfoUpdated",a);this._iLastVisibleWidth=null;var r=this._getScrollExtension();if(a.axisTimeChanged){r.clearOffsetWidth()}r.needRerenderGantt(function(){this.getInnerGantt().getRenderer().renderImmediately(this)}.bind(this),e)}};le.prototype._syncContainerGanttCharts=function(e,t){var i=this.getParent();if(i&&i.isA("sap.gantt.simple.GanttChartContainer")&&i.getGanttCharts().length>1){this.fireEvent("_initialRenderGanttChartsSync",{reasonCode:e,visibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:this.getVisibleWidth(),originEvent:t})}};le.prototype.onBeforeRendering=function(e){this._updateRowHeightInExpandModel(this.getTable());y.detachEvents(this);this._oSplitter.detachResize(this.onSplitterResize,this);if(this._sResizeHandlerId){l.deregister(this._sResizeHandlerId)}if(this.getDisplayType()!==Q.Table){if(this._bPreventInitialRender){delete this._bPreventInitialRender}this.getInnerGantt().invalidate()}var t=this.getTable();if(this.getShowExportTableToExcel()&&!this._enableOptimisation&&this.getShowGanttHeader()){if(this.oExportTableToExcelButton==null){this.oExportTableToExcelButton=new W(this.getId()+"-exportTableToExcelButton",{icon:"sap-icon://excel-attachment",tooltip:ae.getText("EXPORT_BUTTON_TEXT"),type:sap.m.ButtonType.Transparent,buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._exportTableToExcel()},this],menu:[new F({items:[new k({text:ae.getText("QUICK_EXPORT"),press:[function(){this._exportTableToExcel()},this]}),new k({text:ae.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._createExportDialogBox()},this]})]})]})}D.addToolbarToTable(this,t,true)}else if(!this.getShowExportTableToExcel()&&(t.getExtension().length>0&&!(t.getExtension()[0].getContent().indexOf(this.oExportTableToExcelButton)===-1))){if(t.getExtension()[0].getContent().length==1){t.removeExtension(t.getExtension()[0])}else if(t.getExtension()[0].getContent().length>1){t.getExtension()[0].removeContent(this.oExportTableToExcelButton)}}this._invalidateRowActionTemplate(t)};le.prototype._invalidateRowActionTemplate=function(e,t){var i=e.getRowActionTemplate();if(i&&i.isA("sap.gantt.simple.GanttRowAction")&&i.getControlTemplate()){if(!this._bRowActionInitialRender&&t==="Render"){this._bRowActionInitialRender=true;i.invalidate()}else if(t==="Unbind"){this._bRowActionInitialRender=false}else if(t!=="Render"&&t!=="Unbind"){i.invalidate()}}};le.prototype.fullScreenMode=function(){if(this._bFullScreen){return true}else{return false}};le.prototype.toggleFullScreen=function(e,t){var i;var a=this.getParent();if(!a.isA("sap.gantt.simple.GanttChartContainer")){return null}if(!a._oFullScreenUtil){a._oFullScreenUtil=h}if(this._bFullScreen){this._bFullScreen=false;a._bHideToolbar=false;a._bHideVariant=false;a.setHeight(this._fContainerHeight);for(var n in this._mGanttCharts){a.insertGanttChart(this._mGanttCharts[n],n)}i=a.getGanttCharts();var s=a.getEnableTimeScrollSync();var o=this.getAxisTimeStrategy().getVisibleHorizon();var r=this.getAxisTimeStrategy().getZoomLevel();i.forEach(function(e,t){if(s){e.getAxisTimeStrategy().getVisibleHorizon().setStartTime(o.getStartTime());e.getAxisTimeStrategy().getVisibleHorizon().setEndTime(o.getEndTime());e.getAxisTimeStrategy().setProperty("zoomLevel",r,true)}else if(e.getId()!==this.getId()){e.getAxisTimeStrategy().getVisibleHorizon().setStartTime(this._aVisibleHorizons[t].startTime);e.getAxisTimeStrategy().getVisibleHorizon().setEndTime(this._aVisibleHorizons[t].endTime)}a._oSplitter.getContentAreas()[t].getLayoutData().setSize(this._aSplitterLayoutSizes[t])}.bind(this));this._bRenderFullScreenGantt=true;a._oFullScreenUtil.toggleFullScreen(a,false,t,this.toggleFullScreen)}else{this._bFullScreen=true;i=a.getGanttCharts();this._aSplitterLayoutSizes=[];this._mGanttCharts={};this._aVisibleHorizons=[];i.forEach(function(e,t){this._aSplitterLayoutSizes.push(a._oSplitter.getContentAreas()[t].getLayoutData().getSize());this._aVisibleHorizons.push({startTime:e.getAxisTimeStrategy().getVisibleHorizon().getStartTime(),endTime:e.getAxisTimeStrategy().getVisibleHorizon().getEndTime()});if(e.getId()!==this.getId()){this._mGanttCharts[t]=e}}.bind(this));i.forEach(function(e){if(e.getId()!==this.getId()){a.removeGanttChart(e)}}.bind(this));a._bHideToolbar=!e;a._bHideVariant=true;this._fContainerHeight=a.getHeight();a.setHeight(window.innerHeight+"px");this._bRenderFullScreenGantt=true;a._oFullScreenUtil.toggleFullScreen(a,true,t,this.toggleFullScreen)}a.updateSearch()};le.prototype.onAfterRendering=function(e){this._attachExtensions();y.attachEvents(this);this._oSplitter.attachResize(this.onSplitterResize,this);this._sResizeHandlerId=l.register(this,this._onResize.bind(this));if((this.mProperties.hasOwnProperty("height")||this.getParent()&&this.getParent().mProperties.hasOwnProperty("height"))&&!this._enableOptimisation){this.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);this.getTable().setMinAutoRowCount(1)}};le.prototype._onResize=function(e){if(this.getDisplayType()!==Q.Both){return}var t=this.getAggregation("_splitter");this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===Q.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize()}if(t.getContentAreas()[0]&&t.getContentAreas()[0].getLayoutData()){var i=t.getContentAreas()[0],a=i.getLayoutData(),n=this.getDomRef().offsetWidth,s;if(n>0&&n<se*2){s=n/2;s=s+"px"}else{var o=i.getDomRef().offsetWidth;if(o>se){return}if(this.getSelectionPanelSize()!=null&&o==0&&e!=true){s=this.getSelectionPanelSize()}else{s=Math.max(Math.min(o,n-se),Math.max(.3*n,se));s=s+"px"}}a.setSize(s)}};le.prototype._setupDisplayType=function(){var e=this.getDisplayType();this._isDisplayTypeChanged=true;if(e===Q.Table){var t=this.getSyncedControl().$().find(".sapGanttBackgroundVScrollContentArea").width();if(t!==null){this._setSplitterLayoutData("auto",t+"px")}}else if(e===Q.Chart){this._setSplitterLayoutData("0px","auto")}else if(e!==this._sPreviousDisplayType){this._setSplitterLayoutData(this._iLastTableAreaSize?this._iLastTableAreaSize:this.getSelectionPanelSize(),"auto")}};le.prototype._setSplitterLayoutData=function(e,t){var i=this._oSplitter.getContentAreas();if(i.length>1){var a=i[0].getLayoutData(),n=i[1].getLayoutData(),s=this.getDisplayType()===Q.Both;a.setSize(e).setResizable(s);n.setSize(t).setResizable(s)}};le.prototype._updateRowHeightInExpandModel=function(e){var t=Math.ceil(e.getRowHeight());if(t===0){t=Math.ceil(e._getDefaultRowHeight())}this._oExpandModel.setBaseRowHeight(t)};le.prototype.jumpToPosition=function(e){if(Object.prototype.toString.call(e)==="[object Date]"||typeof e==="string"){this._updateVisibleHorizon(new I({startTime:e}),"jumpToPosition",this.getVisibleWidth())}else if(Array.isArray(e)){this._updateVisibleHorizon(new I({startTime:e[0],endTime:e[1]}),"jumpToPosition",this.getVisibleWidth())}else if(e===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition",this.getVisibleWidth())}};le.prototype.exit=function(){if(this._sResizeHandlerId){l.deregister(this._sResizeHandlerId)}this._detachExtensions();delete this._bPreventInitialRender};le.prototype._attachExtensions=function(){if(this._bExtensionsInitialized){return}y.enrich(this,b);y.enrich(this,T);y.enrich(this,_);y.enrich(this,v);y.enrich(this,E);y.enrich(this,x);y.enrich(this,w);y.enrich(this,C);this._bExtensionsInitialized=true};le.prototype._detachExtensions=function(){y.cleanup(this)};le.prototype.getAxisTime=function(){var e=this.getAxisTimeStrategy().getAxisTime();if(!e){this.getAxisTimeStrategy().createAxisTime(this.getLocale());e=this.getAxisTimeStrategy().getAxisTime()}return e};le.prototype.getContentWidth=function(){var e=this.getAxisTime(),t=e.getViewRange();return Math.abs(Math.ceil(t[1])-Math.ceil(t[0]))-1};le.prototype.getVisibleWidth=function(){return this._getScrollExtension?this._getScrollExtension().getVisibleWidth():undefined};le.prototype.expand=function(e,t){this.toggleShapeScheme(true,e,t);this._aExpandedIndices=this._aExpandedIndices.concat(t);this._aExpandedIndices=Array.from(new Set(this._aExpandedIndices))};le.prototype.collapse=function(e,t){this.toggleShapeScheme(false,e,t);var i=[];i=i.concat(t);this._aExpandedIndices=this._aExpandedIndices.filter(function(e){return i.indexOf(e)==-1})};le.prototype.toggleShapeScheme=function(e,i,a){var n=[];if(typeof a==="number"){n=[a]}else if(Array.isArray(a)){n=a}if(n.length===0||!i){return}var s=this.getShapeSchemes().filter(function(e){return e.getKey()===i});if(s==null||s.length===0||s.length>1){t(false,"shape scheme must not be null or not found in shapeSchemes");return}var o=this.getPrimaryShapeScheme();this._bExpandToggled=this._oExpandModel.isTableRowHeightNeedChange(e,this.getTable(),n,o,s[0]);if(this._bExpandToggled){this._createInnerGanttRenderPromise();this.getTable().invalidate()}};le.prototype.isShapeVisible=function(e){if(e&&e.isVisible()){return true}if(!e.getVisible()){return false}var t=this.getRenderedTimeRange(),i=t[0],a=t[1];var n=e.getTime(),s=e.getEndTime();if(this.getLocale()&&(n&&s)){n=A._convertUTCToLocalTime(n,this.getLocale());s=A._convertUTCToLocalTime(s,this.getLocale())}var o=function(e){return e>=i&&e<=a};if(e.getSelected()||!n||!s){return true}else if(n&&s){return o(n)||o(s)||n<=i&&s>=a}else if(n&&!s){return o(n)}else if(!n&&s){return o(s)}};le.prototype.isCalendarTimeIntervalVisible=function(e){var t=this.getRenderedTimeRange(),i=t[0],a=t[1];if(this.getLocale()&&(n&&s)){n=A._convertUTCToLocalTime(n,this.getLocale());s=A._convertUTCToLocalTime(s,this.getLocale())}else{var n=A.abapTimestampToDate(e.getStartTime()),s=A.abapTimestampToDate(e.getEndTime())}var o=function(e){return e>=i&&e<=a};if(n&&s){return o(n)||o(s)||n<=i&&s>=a}};le.prototype.doBirdEye=function(e){var t=this._getZoomExtension();t.doBirdEye(e)};le.prototype._exportTableToExcel=function(e){var t,i,a,n,s,o;s=this.getTable();if(s){o=s.getBinding(s._sAggregation)}if(o.getModel().isA("sap.ui.model.json.JSONModel")){n=true}t=this._createColumnConfig();var r=o.getModel();i={workbook:{columns:t},fileName:e&&e.fileName?e.fileName:"GanttTableExport.xlsx",worker:false};if(n){i.dataSource=this._createJSONDataSource(s)}else{i.dataSource={type:"odata",dataUrl:o.getDownloadUrl?o.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:r.getHeaders?r.getHeaders():null,count:o.getLength?o.getLength():null}}if(s.getColumns()[0].data("exportTableColumnConfig")&&s.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel){i.workbook.hierarchyLevel=s.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel}a=new V(i);a.build().finally(function(){a.destroy()})};le.prototype._createExportDialogBox=function(){this._getExportSettingsViaDialog().then(function(e){this._exportTableToExcel(e)}.bind(this))};le.prototype._getExportSettingsViaDialog=function(e){return new Promise(function(t,a){var n;var s=new N;var o={fileName:"GanttTableExport",fileType:[{key:"xlsx"}],selectedFileType:"xlsx"};s.setData(o);var r=L();n=new O({id:r,title:ae.getText("EXPORT_SETTINGS_TITLE"),content:[new B({renderType:"Bare",width:"100%",items:[new G({text:ae.getText("FILE_NAME"),labelFor:r+"-fileName"}),new M({id:r+"-fileName",value:"{/fileName}",liveChange:function(e){var t=e.getSource();var i=e.getParameter("value");var a=/[\\/:|?"*<>]/;var n=z.byId(r+"-export");var s=a.test(i);if(s){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(ae.getText("FILENAME_ERROR"))}else if(i.length>100){t.setValueState(sap.ui.core.ValueState.Warning);t.setValueStateText(ae.getText("FILENAME_WARNING"))}else{t.setValueState(sap.ui.core.ValueState.None);t.setValueStateText(null)}n.setEnabled(!s)}}).addStyleClass("sapUiTinyMarginBottom")]}).addStyleClass("sapUiExportSettingsLabel")],endButton:new U({id:r+"-cancel",text:ae.getText("CANCEL_BUTTON"),press:function(){n.close()}}),beginButton:new U({id:r+"-export",text:ae.getText("QUICK_EXPORT"),type:sap.m.ButtonType.Emphasized,press:function(){if(n){n._bSuccess=true;n.close();t(s.getData())}}}),afterClose:function(){if(!n._bSuccess){i.warning("sap.gantt.simple.GanttChartWithTable ","Cancel Click on Export to Excel PopOver",this);a(null)}n.destroy();n=null}});n.addStyleClass("sapUiContentPadding sapUiExportSettings");n.setModel(s);n.open();if(e){e(n)}})};le.prototype._createColumnConfig=function(){var e,t,i,a,n,s,o,r,l,h=[],p,g,d;this._oTable=this.getTable();e=this._oTable.getColumns();i=e.length;for(t=0;t<i;t++){o=null;p=null;g=null;d=null;l=null;a=e[t];if(a.getVisible()){n=a.data("exportTableColumnConfig");if(!o&&n){o=n["leadingProperty"]}if(Array.isArray(o)){o=o[0]}if(o){s=this._getColumnLabel(a);r=a.getWidth().toLowerCase()||n.width||"";r=this._getColumnWidthNumber(r);if(n.unitProperty){l=n.isCurrency?sap.ui.export.EdmType.Currency:sap.ui.export.EdmType.Number}else if(n.isDigitSequence){l=sap.ui.export.EdmType.Number}if(!l){switch(n.dataType){case te.Numeric:l=sap.ui.export.EdmType.Number;break;case te.DateTime:l=sap.ui.export.EdmType.DateTime;d=n.displayFormat;break;case te.StringDate:case te.Date:l=sap.ui.export.EdmType.Date;d=n.displayFormat;break;case te.Boolean:l=sap.ui.export.EdmType.Boolean;p="false";g="true";break;case te.String:l=sap.ui.export.EdmType.String;break;case te.Time:l=sap.ui.export.EdmType.Time;break;default:l=sap.ui.export.EdmType.String;break}}h.push({columnId:a.getId(),property:o,type:l,format:d?d:undefined,label:s?s:o,width:r,textAlign:a.getHAlign(),trueValue:l===sap.ui.export.EdmType.Boolean&&g?g:undefined,falseValue:l===sap.ui.export.EdmType.Boolean&&p?p:undefined,unitProperty:l===sap.ui.export.EdmType.Currency||l===sap.ui.export.EdmType.Number?n.unitProperty:undefined,displayUnit:l===sap.ui.export.EdmType.Currency,unit:n.unit?n.unit:undefined,precision:n.precision?n.precision:undefined,scale:n.scale?n.scale:undefined,wrap:n.wrap?n.wrap:false})}}}return h};le.prototype._getColumnLabel=function(e){var t;if(!e){return null}if(e.getLabel){t=e.getLabel()}if(e.getHeader){t=e.getHeader()}return t&&t.getText?t.getText():null};le.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e))}if(e.indexOf("px")>0){return Math.round(parseInt(e,10)/16)}return""};le.prototype._createJSONDataSource=function(e){var t,i,a,n=[];t=e.getBinding(e._sAggregation).mParameters.arrayNames[0];i=e.getBinding().sPath;a=e.getModel().getProperty(i);n=this._generateJSONRowData(a[t],t,n);return n};le.prototype._generateJSONRowData=function(e,t,i){if(!e){return[]}if(!i){i=[]}for(var a=0;a<e.length;a++){i.push(e[a]);if(e[a][t]){this._generateJSONRowData(e[a][t],t,i)}}return i};le.prototype.setRowsHeight=function(e){this.oRowsCustomHeight=e;this.getTable().invalidate()};le.prototype.getShapeUids=function(e){var t=[],i=[];var a=this.getTable().getRows();for(var n=0;n<a.length;n++){var s=a[n].getAggregation("_settings");t=t.concat(this._getAllMatchedShapeInRow(s,[],e))}t.forEach(function(e){if(e.getShapeUid()){i.push(e.getShapeUid())}});i=Array.from(new Set(i));return i};le.prototype._getAllMatchedShapeInRow=function(e,t,i){var a=e.getMetadata(),n=a.getAllAggregations(),s=false;Object.keys(n).forEach(function(a){if(a==="calendars"){return}var n=e.getAggregation(a);if(n){n=jQuery.isArray(n)?n:[n];if(n.length>0){n.forEach(function(e){if(e instanceof sap.gantt.simple.BaseConditionalShape){e=e._getActiveShapeElement();if(e instanceof sap.gantt.simple.BaseGroup){s=this._checkBaseGroup(e,"shapes",i);if(s&&e.getShapeUid()){t=t.concat(e)}}else if(this._isShapeMatched(e,i)&&e.getShapeUid()){t=t.concat(e)}}else if(e instanceof sap.gantt.simple.MultiActivityGroup){var a=this._oExpandModel.isRowExpanded(e.getParent().getRowUid());s=this._checkBaseGroup(e,"task",i);if(s&&e.getShapeUid()){if(!(a&&!(this.getShowParentRowOnExpand()&&!this.getUseParentShapeOnExpand()))){t=t.concat(e)}}if(a){t=t.concat(this._getAllMatchedShapeInRow(e,[],i))}}else if(e instanceof sap.gantt.simple.BaseGroup){s=this._checkBaseGroup(e,"shapes",i);if(s&&e.getShapeUid()){t=t.concat(e)}}else if(this._isShapeMatched(e,i)&&e.getShapeUid()){t=t.concat(e)}}.bind(this))}}}.bind(this));return t};le.prototype._checkBaseGroup=function(e,t,i){var a=false;if(this._isShapeMatched(e,i)&&e.getShapeUid()){a=true;return a}var n=e.getAggregation(t);n=jQuery.isArray(n)?n:[n];n.forEach(function(e){if(e instanceof sap.gantt.simple.BaseGroup){a=this._checkBaseGroup(e,"shapes",i)}else if(this._isShapeMatched(e,i)){a=true;return a}}.bind(this));return a};le.prototype._isShapeMatched=function(e,t){if(t&&e instanceof sap.gantt.simple.BaseShape){var i=true;for(var a in t){var n=e.getMetadata(),s=n.getAllProperties();if(s&&s.hasOwnProperty(a)&&i){var o=e.getProperty(a);if(o instanceof Date){o=o.getTime();if(t[a]instanceof Date){t[a]=t[a].getTime()}}else if(typeof o==="string"){o=o.toLowerCase();t[a]=t[a].toLowerCase()}if(typeof o==="object"){i=j(o,t[a])}else if(o!==t[a]){i=false}}else{i=false}}return i}else{return false}};le.prototype.getChartOverflowToolbar=function(){var e;if(this.getEnableChartOverflowToolbar()){e=sap.ui.getCore().byId(this.getId()+"-ganttHeaderOverflowToolbar")}return e};le.prototype.rebindTableRows=function(e){this._createInnerGanttRenderPromise();var t=this.getTable();t.bindRows(e)};le.prototype.setRowSettingsTempWithInvalid=function(e){this._createInnerGanttRenderPromise();this.getTable().invalidate();var t=this.getTable();t.setRowSettingsTemplate(e)};le.prototype._createInnerGanttRenderPromise=function(e){if(!this._oInnerGanttRenderPromise||this._oInnerGanttRenderPromise&&this._bInnerGanttRenderPromiseResolved){this._bInnerGanttRenderPromiseResolved=false;this._oInnerGanttRenderPromise=new Promise(function(e){this._oInnerGanttRenderPromiseResolve=e}.bind(this))}};le.prototype.toggleDnDRowHighlight=function(e){var t=this._getDragDropExtension();var i=document.getElementById(this.getId()+"-svg"),a=i.querySelectorAll("rect.sapGanttBackgroundSVGRow");t.oLastDraggedShapeData._highlightedRowIndex.forEach(function(t){a[t].classList.toggle("sapGanttBackgroundSVGRowHighlighted",e);if(this.getRowHighlightFill()){a[t].style.setProperty("--sapGanttBackgroundSVGRowHighlighted-fill",this.getRowHighlightFill())}if(this.getRowHighlightAndHoverFill()){a[t].style.setProperty("--sapGanttBackgroundSVGRowHighlighted-sapGanttBackgroundSVGRowHovered-fill",this.getRowHighlightAndHoverFill())}}.bind(this))};le.prototype.fireDragStart=function(e){var t=this._getDragDropExtension();if(t._bEnableRowHighlight){this.toggleDnDRowHighlight(true)}this.fireEvent("dragStart",e)};le.prototype.triggerShapeDrop=function(e){var t=this._getDragDropExtension();if(t._bEnableRowHighlight){this.toggleDnDRowHighlight(false)}if(e.dragged){this.fireEvent("shapeDrop",e)}};return le},true);
//# sourceMappingURL=GanttChartWithTable.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/base/util/ObjectPath","./AxisTimeStrategyBase","../misc/Format"],function(t,e,i,n){"use strict";var o=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");var a=t.config.TimeUnit;sap.gantt.axistime.StepwiseTimeLineOptions={FiveMinutes:{text:o.getText("SWZS_FIVE_MINUTES"),innerInterval:{unit:a.minute,span:5,range:32},largeInterval:{unit:a.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:a.minute,span:5,pattern:"mm "}},FifteenMinutes:{text:o.getText("SWZS_FIFTEEN_MINUTES"),innerInterval:{unit:a.minute,span:15,range:48},largeInterval:{unit:a.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:a.minute,span:15,pattern:"mm "}},Hour:{text:o.getText("SWZS_HOUR"),innerInterval:{unit:a.hour,span:1,range:48},largeInterval:{unit:a.day,span:1,pattern:t.config.DEFAULT_DATE_PATTERN},smallInterval:{unit:a.hour,span:1,pattern:t.config.DEFAULT_TIME_PATTERN}},SixHours:{text:o.getText("SWZS_SIX_HOURS"),innerInterval:{unit:a.hour,span:6,range:64},largeInterval:{unit:a.day,span:1,pattern:t.config.DEFAULT_DATE_PATTERN},smallInterval:{unit:a.hour,span:6,pattern:t.config.DEFAULT_TIME_PATTERN}},DayDate:{text:o.getText("SWZS_DATE_1"),innerInterval:{unit:a.day,span:1,range:64},largeInterval:{unit:a.week,span:1,pattern:o.getText("SWZS_DATE_PATTERN",["LLL yyyy, '","' ww  "])},smallInterval:{unit:a.day,span:1,pattern:sap.ui.getCore().getConfiguration().getRTL()?"dd EEE ":"EEE dd "}},Date:{text:o.getText("SWZS_DATE_2"),innerInterval:{unit:a.day,span:1,range:32},largeInterval:{unit:a.week,span:1,pattern:o.getText("SWZS_DATE_PATTERN",["LLL yyyy, '","' ww  "])},smallInterval:{unit:a.day,span:1,pattern:"dd "}},CWWeek:{text:o.getText("SWZS_WEEK_1"),innerInterval:{unit:a.week,span:1,range:56},largeInterval:{unit:a.month,span:1,pattern:"LLL yyyy "},smallInterval:{unit:a.week,span:1,pattern:"'"+o.getText("SWZS_CW")+"' ww  "}},WeekOfYear:{text:o.getText("SWZS_WEEK_2"),innerInterval:{unit:a.week,span:1,range:32},largeInterval:{unit:a.month,span:1,pattern:"LLL yyyy "},smallInterval:{unit:a.week,span:1,pattern:"ww "}},Month:{text:o.getText("SWZS_MONTH"),innerInterval:{unit:a.day,span:30,range:48},largeInterval:{unit:a.month,span:3,pattern:"yyyy QQQ "},smallInterval:{unit:a.month,span:1,pattern:"LLL "}},Quarter:{text:o.getText("SWZS_QUARTER"),innerInterval:{unit:a.day,span:90,range:48},largeInterval:{unit:a.year,span:1,pattern:"yyyy "},smallInterval:{unit:a.month,span:3,pattern:"QQQ "}},Year:{text:o.getText("SWZS_YEAR"),innerInterval:{unit:a.day,span:360,range:48},largeInterval:{unit:a.year,span:5,pattern:"yyyy "},smallInterval:{unit:a.year,span:1,pattern:"yyyy "}}};var r=sap.gantt.axistime.StepwiseTimeLineOptions;var s=i.extend("sap.gantt.axistime.StepwiseZoomStrategy",{metadata:{library:"sap.gantt"}});s.prototype.init=function(){this._oTotalHorizonBeforeExtension=null;this._sZoomControlType=sap.gantt.config.ZoomControlType.Select;this._aTimeLineOptions=null;this._calculatedTotalHorizon=null;this.bAxisTimeChanged=false;this.iLastZoomLevel=-1;var t=r.DayDate;this.setProperty("timeLineOption",t,true);this.setProperty("timeLineOptions",r,true);this.setProperty("mouseWheelZoomType",sap.gantt.MouseWheelZoomType.Stepwise,true);this.setProperty("finestTimeLineOption",null,true);this.setProperty("coarsestTimeLineOption",null,true);this._aZoomRate=new Array(11)};s.prototype.applySettings=function(){i.prototype.applySettings.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();this.setInitialProperties();this.initialSettings=arguments[0];return this};s.prototype.setInitialProperties=function(){this.setProperty("zoomLevels",this._getCountOfTimeLineOptions(),true);if(this._getIndexOfTimeLineOption(this.getTimeLineOption())===-1){this.setTimeLineOption(this._aTimeLineOptions[Math.floor((this._getCountOfTimeLineOptions()-1)/2)])}};s.prototype.createAxisTime=function(t){i.prototype.createAxisTime.apply(this,arguments);this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()));this._Locale=t;return this};s.prototype.setVisibleHorizon=function(t){this.setVisibleHorizonWithReason(t,"visibleHorizonUpdated");return this};s.prototype.setVisibleHorizonWithReason=function(t,e,n){var o=this.getVisibleHorizon();if(o){o=o.clone()}i.prototype._setVisibleHorizon.apply(this,arguments);this.fireRedrawRequest(false,e,o,n);return this};s.prototype.setTotalHorizon=function(t){var e=this.getTotalHorizon();if(e){this.oLastTotalHorizonStartTime=e.getStartTime();this.oLastTotalHorizonEndTime=e.getEndTime()}i.prototype._setTotalHorizon.apply(this,arguments);this._setCalculatedTotalHorizon(t);if(this.getAxisTime()){this.fireRedrawRequest(true,"totalHorizonUpdated")}return this};s.prototype._setCalculatedTotalHorizon=function(t){if(t){if(this._calculatedTotalHorizon){this._calculatedTotalHorizon.setStartTime(t.getStartTime(),true);this._calculatedTotalHorizon.setEndTime(t.getEndTime(),true)}else{this._calculatedTotalHorizon=new sap.gantt.config.TimeHorizon({startTime:t.getStartTime(),endTime:t.getEndTime()})}this._updateTimeRangeAndViewRange(t)}return this};s.prototype._updateTimeRangeAndViewRange=function(t){var i=this.getAxisTime();if(i&&t){i.setTimeRange([n.getTimeStampFormatter().parse(t.getStartTime()),n.getTimeStampFormatter().parse(t.getEndTime())]);var o=n.getTimeStampFormatter().parse(t.getStartTime());var a=n.getTimeStampFormatter().parse(t.getEndTime());var r=a.valueOf()-o.valueOf();var s=this.getTimeLineOption();var p=e.get(s.innerInterval.unit).offset(o,s.innerInterval.span).valueOf()-o.valueOf();i.setViewRange([0,Math.ceil(r*s.innerInterval.range/p/this._aZoomRate[this.getZoomLevel()])])}return this};s.prototype._getCalculatedTotalHorizon=function(){if(!this._calculatedTotalHorizon||!this._calculatedTotalHorizon.getStartTime()||!this._calculatedTotalHorizon.getEndTime()){this._setCalculatedTotalHorizon(this.getAggregation("totalHorizon"))}return this._calculatedTotalHorizon};s.prototype.getTotalHorizon=function(){return this._getCalculatedTotalHorizon()};s.prototype.setZoomLevels=function(t){return this};s.prototype.setZoomLevel=function(t){if(t>=0){this.iLastZoomLevel=this.getZoomLevel();this.setProperty("zoomLevel",t,true);this.setProperty("timeLineOption",this._getTimeLineOptionByIndex(t),true);if(this._aZoomRate[t]&&this.getGanttVisibleWidth()){var e=this._updateVisibleHorizon(this.getGanttVisibleWidth());this.setVisibleHorizon(e)}}return this};s.prototype.setTimeLineOption=function(t){this.setProperty("timeLineOption",t,true);this.setZoomLevel(this._getIndexOfTimeLineOption(t))};s.prototype.setCoarsestTimeLineOption=function(t){return this};s.prototype.setFinestTimeLineOption=function(t){return this};s.prototype.setTimeLineOptions=function(t){i.prototype.setTimeLineOptions.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();return this};s.prototype._updateVisibleHorizon=function(t){if(!t){var e=this._getWidthOfTotalHorizon();this._extendTotalHorizon(e)}else{this._extendTotalHorizon(t)}var o=this.getAxisTime();if(o){o.setZoomRate(this._aZoomRate[this.getZoomLevel()]);var a=this.getVisibleHorizon();var r=this.calMiddleDate(n.getTimeStampFormatter().parse(a.getStartTime()),n.getTimeStampFormatter().parse(a.getEndTime()));var s=this.calVisibleHorizonByRate(this._aZoomRate[this.getZoomLevel()],r);i.prototype._setVisibleHorizon.call(this,s);return s}};s.prototype.updateInitialVisibleHorizon=function(t,e){this.setProperty("timeLineOption",this._getTimeLineOptionByIndex(e),true);var o=this.calMiddleDate(n.getTimeStampFormatter().parse(t.getStartTime()),n.getTimeStampFormatter().parse(t.getEndTime()));var a=this.calVisibleHorizonByRate(this._aZoomRate[this.getZoomLevel()],o);i.prototype._setVisibleHorizon.call(this,a)};s.prototype.updateGanttVisibleWidth=function(t){return this};s.prototype.isTimePeriodZoomEnabled=function(){return false};s.prototype.syncContext=function(t){var e=this.getTotalHorizon();var o={zoomLevel:undefined,axisTimeChanged:false};if(this.bBirdEyeTriggered){this.bBirdEyeTriggered=false;var a=this.getAxisTime();if(a){var r=this.getVisibleHorizon();var s=this.calZoomScaleByDate(n.abapTimestampToDate(r.getStartTime()),n.getTimeStampFormatter().parse(r.getEndTime()),t);var p=this._oZoom.base.scale/s;var l=0;while(p>=this._aZoomRate[l]){l++}if(l!==0){l=l-1}i.prototype.updateGanttVisibleWidth.apply(this,arguments);if(this.iLastZoomLevel!==l){a.setZoomRate(this._aZoomRate[l]);this.setProperty("zoomLevel",l,true);this.setProperty("timeLineOption",this._getTimeLineOptionByIndex(l),true);this._updateVisibleHorizon(this.getGanttVisibleWidth());this.iLastZoomLevel=this.getZoomLevel();o.axisTimeChanged=true}}}else if(t!==this.getGanttVisibleWidth()){this._updateVisibleHorizon(t);o.axisTimeChanged=true;i.prototype.updateGanttVisibleWidth.apply(this,arguments)}else if(this.iLastZoomLevel===this.getZoomLevel()&&(!this.oLastTotalHorizonStartTime||this.oLastTotalHorizonStartTime===e.getStartTime()&&this.oLastTotalHorizonEndTime===e.getEndTime())){o.axisTimeChanged=false}else{o.axisTimeChanged=true;this.iLastZoomLevel=this.getZoomLevel();this.oLastTotalHorizonStartTime=e.getStartTime();this.oLastTotalHorizonEndTime=e.getEndTime()}o.zoomLevel=this.getZoomLevel();return o};s.prototype._updateZoomRateArray=function(){if(this._oZoom){var t=this.getTimeLineOptions();this._aZoomRate=[];if(t){var e;if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){e=this._getCountOfTimeLineOptions();for(var i in t){e--;this._aZoomRate[e]=this._oZoom.base.scale/this.calZoomScale(t[i].innerInterval.unit,t[i].innerInterval.span,t[i].innerInterval.range)}}else{e=0;for(var n in t){this._aZoomRate[e]=this._oZoom.base.scale/this.calZoomScale(t[n].innerInterval.unit,t[n].innerInterval.span,t[n].innerInterval.range);e++}}}else{this._aZoomRate[0]=1}}};s.prototype._updateTimeLineOptions=function(){var t=this.getTimeLineOptions();this._aTimeLineOptions=[];if(t){for(var e in t){this._aTimeLineOptions.push(t[e])}if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){this._aTimeLineOptions=this._aTimeLineOptions.reverse()}}};s.prototype.updateStopInfo=function(t){this.setZoomLevel(t.index);return this};s.prototype._getIndexOfTimeLineOption=function(t,e){var i=e;if(!i){i=this.getTimeLineOptions()}if(!this._aTimeLineOptions){this._updateTimeLineOptions()}for(var n=0,o=this._aTimeLineOptions.length;n<o;n++){if(this._aTimeLineOptions[n]==t){return n}}return-1};s.prototype._getTimeLineOptionByIndex=function(t){if(!this._aTimeLineOptions){this._updateTimeLineOptions()}if(t<this._aTimeLineOptions.length){return this._aTimeLineOptions[t]}else{return null}};s.prototype._getWidthOfTotalHorizon=function(){var t=this._getCalculatedTotalHorizon();var e=n.getTimeStampFormatter().parse(t.getStartTime());var i=n.getTimeStampFormatter().parse(t.getEndTime());var o=this.getAxisTime();var a=o.timeToView(e);var r=o.timeToView(i);return Math.abs(r-a)};s.prototype._extendTotalHorizon=function(t){var e=this._getCalculatedTotalHorizon();var i=0;if(this._oZoom&&this._oZoom.base&&this._oZoom.base.scale!==undefined){var o=n.abapTimestampToDate(e.getStartTime());var a=n.abapTimestampToDate(e.getEndTime());var r=a.getTime()-o.getTime();var s=this._aZoomRate[this.getZoomLevel()];var p=this._oZoom.base.scale/s;var l=t*p;i=l-r;e=this._calTotalHorizon(i,l);this._setCalculatedTotalHorizon(e)}};s.prototype._calTotalHorizon=function(t,e){var i=this._getCalculatedTotalHorizon();if(t!==0){var o=n.abapTimestampToDate(this.getAggregation("totalHorizon").getStartTime()).getTime();var a=n.abapTimestampToDate(this.getAggregation("totalHorizon").getEndTime()).getTime();var r=(o+a)/2;var s,p;if(t>0){s=r-e/2;p=r+e/2}else{s=n.abapTimestampToDate(i.getStartTime()).getTime()-t/2;p=n.abapTimestampToDate(i.getEndTime()).getTime()+t/2;if(s>o){s=o}if(p<a){p=a}}var l=new Date;l.setTime(s);var m=new Date;m.setTime(p);return new sap.gantt.config.TimeHorizon({startTime:l,endTime:m})}return i};s.prototype._updateZoomControlType=function(t){if(t){i.prototype._updateZoomControlType.apply(this,arguments);this._sZoomControlType=t;this._updateZoomRateArray();this._updateTimeLineOptions();if(this.initialSettings.zoomLevel!=null&&this.initialSettings.zoomLevel!=0){this.setZoomLevel(this.initialSettings.zoomLevel)}else{this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()))}}};s.prototype._getCountOfTimeLineOptions=function(){return Object.keys(this.getTimeLineOptions()).length};return s},true);
//# sourceMappingURL=StepwiseZoomStrategy.js.map
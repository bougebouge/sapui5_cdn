/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/utils/utils","sap/apf/core/messageObject","sap/apf/utils/hashtable","sap/base/Log","sap/apf/core/messageDefinition"],function(e,r,s,t,i){"use strict";function n(n){var a={initial:0,startup:1,running:2,shutdown:3};var o=this;var f;var g=[];var u=0;var d;var c;var v;var l=false;var p=false;var h=false;var m=false;var y=false;var w="";var M={code:e.message.code.errorUnknown,severity:e.message.severity.error,rawText:"Unknown Error occurred"};var C=a.initial;var E=[];this.setLifeTimePhaseStartup=function(e){C=a.startup};this.setLifeTimePhaseRunning=function(){C=a.running};this.setLifeTimePhaseShutdown=function(){C=a.shutdown};this.fatalErrorOccurredAtStartup=function(){var r;if(C!==a.startup){return false}for(r=0;r<E.length;r++){if(E[r].getSeverity()===e.message.severity.fatal){return true}}return false};this.createMessageObject=function(r){var t=new s(r);if(n){if(t.getCode()===undefined){t.setCode(e.message.code.errorUnknown)}S.bind(this)(t);I(t,1)}else if(r.enrichInfoInMessageObject===true){S.bind(this)(t)}return t};this.activateOnErrorHandling=function(e){l=e;if(l===true){jQuery(window).on("error",D)}else{jQuery(window).off("error")}};this.setTextResourceHandler=function(e){f=e};this.loadConfig=function(e,r){if(d===undefined||r){d=new t(o)}for(var s=0;s<e.length;s++){j(e[s])}};this.setMessageCallback=function(e){if(e!==undefined&&typeof e==="function"){c=e}else{c=undefined}};this.setCallbackForTriggeringFatal=function(e){if(e!==undefined&&typeof e==="function"){v=e}else{v=undefined}};this.putMessage=function(r){var s;var t=0;var i;if(r.getCode()===undefined){r.setCode(e.message.code.errorUnknown)}S.bind(this)(r);if(r.getSeverity()===e.message.severity.fatal){i=o.createMessageObject({code:e.message.code.errorExitTriggered});S.bind(this)(i);i.setSeverity(e.message.severity.fatal);if(i.getMessage()===""){i.setMessage("The app has stopped working due to a technical error.")}}s=r.getPrevious();while(s!==undefined&&s.type&&s.type==="messageObject"&&t<10){if(s.getCode()===undefined){s.setCode(e.message.code.errorUnknown)}S.bind(this)(s);s=s.getPrevious();t++}if(i!==undefined){i.setPrevious(r);r=i}if(!n){I(r,10)}E.push(r);if(p){return}if(r.getSeverity()===e.message.severity.technError){return}if(c!==undefined){if(C===a.shutdown||C===a.startup&&r.getSeverity()!==e.message.severity.fatal){return}p=true;c(r);p=false}if(v!==undefined&&h===false){h=true;v(r);h=false}if(r.getSeverity()===e.message.severity.fatal&&C!==a.shutdown){if(sap.ui.Device.browser.firefox){y=true}throw new Error(w)}};this.check=function(r,s,t){var i=t||e.message.code.errorCheck;if(!r){var n=this.createMessageObject({code:i,aParameters:[s]});o.putMessage(n)}};this.getConfigurationByCode=function(e){if(d===undefined){return undefined}return d.getItem(e)};this.getLogMessages=function(){return jQuery.extend(true,[],g)};this.reset=function(){d=undefined;c=undefined;g=[];E=[]};this.isOwnException=function(e){return e&&e.message&&e.message.search(w)>-1};function b(e){if(sap.ui.Device.browser.firefox){return y}return e.originalEvent&&e.originalEvent.message&&e.originalEvent.message.search(w)>-1}function x(r){return r.originalEvent&&r.originalEvent.message&&r.originalEvent.message.search(w)===-1&&r.originalEvent.message.search(e.message.code.suppressFurtherException)>-1}function k(){var s=r.createPseudoGuid(32);return e.message.code.suppressFurtherException+s}function P(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorUnknown||s==e.message.code.errorInMessageDefinition}function T(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorInMessageDefinition}function S(r){function s(e,r){var s=0;while(e.indexOf("{"+s+"}")>-1){if(typeof r[s]==="string"){e=e.replace("{"+s+"}",r[s])}else{e=e.replace("{"+s+"}","undefined")}s++}return e}var t=r.getCode();var i=o.getConfigurationByCode(t);if(i===undefined){i=jQuery.extend(true,{},M);if(P(t)){if(r.hasRawText()){i.rawText=r.getRawText()}i.rawText+=" "+r.getParameters();if(T(t)){i.severity=e.message.severity.fatal}}else{i.rawText="Message "+t+"  "+r.getParameters()+" (Message Code has no Configuration)"}if(!P(t)){r.setCode(i.code)}}if(i.severity!==undefined){r.setSeverity(i.severity)}else{r.setSeverity(e.message.severity.technError)}if(i.rawText){r.setMessage(i.rawText)}else{var n=r.getParameters();if(r.getSeverity()===e.message.severity.technError){var a=o.getConfigurationByCode(i.code).text;if(!a){a=o.getConfigurationByCode(i.code).description}r.setMessage(s(a,n))}else{try{if(f&&i.key){r.setMessage(f.getMessageText(i.key,r.getParameters()))}else if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}catch(e){if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}}}}function I(r,s){var t="APF message ";var n="";var a=s-1;if(s===0){return}var o=r.getPrevious();if(o!==undefined){I(o,a);n=" - (see previous message for more information)"}u++;var f=t+"("+u+"): "+r.getCode()+" - "+r.getMessage()+n;if(m){alert("Fatal Error during Log Writing "+f);return}m=true;if(r.getSeverity()===e.message.severity.fatal){if(g.length<2){g.unshift(f)}}switch(r.getSeverity()){case e.message.severity.warning:i.warning(f);break;case e.message.severity.error:i.error(f);break;case e.message.severity.fatal:i.error(f);break;case e.message.severity.technError:i.error(f);break;default:i.info(f)}m=false}function O(r){o.check(r!==undefined&&r.hasOwnProperty("code")!==false,"MessageHandler setItem: oItem is undefined or property 'code' is missing",e.message.code.errorInMessageDefinition);var s=d.setItem(r.code,r);o.check(s===undefined,"MessageHandler setItem: Configuration includes duplicated codes",e.message.code.errorInMessageDefinition)}function j(e){if(e.type===undefined){e.type="message"}O(e)}function D(e){var r;var t="";var i="";var n="";var a="";var o=true;if(sap.ui.Device.browser.firefox){o=false}if(o&&e&&e.originalEvent){t=e.originalEvent.message;n=e.originalEvent.filename;i=e.originalEvent.lineno}if(b(e)){e.stopImmediatePropagation();e.preventDefault()}else if(x(e)){return}else if(p){a="";if(o){a=t+" (source: "+n+":"+i+")"}r=new s({code:"5070",aParameters:[a]});S.bind(this)(r);I(r,1)}else{a="";if(o){a=t+" (source: "+n+":"+i+")"}r=new s({code:"5070",aParameters:[a]});S.bind(this)(r);I(r,1)}}function F(){w=k()}F()}sap.apf=sap.apf||{};sap.apf.core=sap.apf.core||{};sap.apf.core.MessageHandler=n;return n});
//# sourceMappingURL=messageHandler.js.map
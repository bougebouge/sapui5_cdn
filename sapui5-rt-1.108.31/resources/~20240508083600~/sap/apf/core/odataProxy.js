/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/datajs","sap/apf/utils/utils","sap/apf/core/constants","sap/ui/thirdparty/jquery"],function(e,t,a,jQuery){"use strict";sap.apf.core.OdataProxy=function(e,t){var a=t.instances.coreApi;var s=t.instances.messageHandler;var n=e.serviceRoot;function r(e,t){return a.getEntityTypeMetadata(e,t)}function o(e){var t,a,s;if(!e){return""}a=e.length;if(a===1){return"('"+e[0].value+"')"}s="(";for(t=0;t<a;t++){if(t>0){s=s+","}s=s+e[t].name+"='"+e[t].value+"'"}return s+")"}function i(e){var t;if(e.messageObject&&e.messageObject.getCode){t=e.messageObject}else if(e.response&&e.response.statusCode&&e.response.statusCode>=400){t=s.createMessageObject({code:"11005",aParameters:[e.response.statusCode.toString(),e.response.statusText]})}else{t=s.createMessageObject({code:"5201"})}s.putMessage(t);return t}function c(e,t){var a=i(e);t(undefined,undefined,a)}function u(e,t,a,n){var o;var i;if(e&&e.results){o=e.results}else if(e){o=e}else{i=s.createMessageObject({code:"5201"})}r(t,a).done(function(e){n(o,e,i)})}function f(e){var t=JSON.parse(e.SerializedAnalyticalConfiguration);delete e.SerializedAnalyticalConfiguration;t.configHeader=e;e.SerializedAnalyticalConfiguration=JSON.stringify(t);return e}this.readEntity=function(e,t,s,r,i){var f=sap.apf.core.constants.entitySets[e];a.getXsrfToken(n).done(function(e){var i=n+"/"+f;i=i+o(s);if(r&&r.length>0){i=i+"?$select="+r.join()}var d={requestUri:i,async:true,method:"GET",headers:{"x-csrf-token":e}};a.odataRequest(d,function(e){u(e,n,f,t)},function(e){c(e,t)})})};function d(e,t,a){var s="'";if(a&&a.dataType){return sap.apf.utils.formatValue(t,a.dataType.type)}if(typeof t==="number"){return t}return s+sap.apf.utils.escapeOdata(t)+s}function p(e){var t=jQuery.Deferred();a.getXsrfToken(n).done(function(a){var s=[];var i,c=e.length;var u;var f=0;for(i=0;i<c;i++){u=sap.apf.core.constants.entitySets[e[f].entitySetName];r(n,u).done(function(n){var r,i,u;var p=false;r=sap.apf.core.constants.entitySets[e[f].entitySetName];r=r+o(e[f].inputParameters);if(e[f].selectList&&e[f].selectList.length>0){r=r+"?$select="+e[f].selectList.join();p=true}if(e[f].filter){if(p){r=r+"&"}else{r=r+"?"}r=r+"$filter="+e[f].filter.toUrlParam({formatValue:function(e,t){return d(e,t,n)}})}i=e[f].method||"GET";u={requestUri:r,method:i,headers:{"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage(),"x-csrf-token":a}};if(i!=="GET"){u.data=e[f].data}s.push(u);f++;if(f===c){t.resolve(s)}})}});return t}function g(e,t,a,s){var i=jQuery.Deferred();var c="";var u=e+o(t);if(a&&a.length>0){c="$select="+a.join()}r(n,e).done(function(t){if(s){if(c){c=c+"&"}c=c+"$filter="+s.toUrlParam({formatValue:function(e,a){return d(e,a,t)}})}if(e===sap.apf.core.constants.entitySets.application){if(c){c=c+"&"}c=c+"$orderby=ApplicationName"}if(c){u=u+"?"+c}i.resolve(u)});return i}function h(e,t){var a="unknown error";var n="unknown error";var r="";if(e.message!==undefined){a=e.message}var o="unknown";if(e.response&&e.response.statusCode){o=e.response.statusCode;n=e.response.statusText||"";r=e.response.requestUri}if(e.messageObject&&e.messageObject.type==="messageObject"){t([],e.messageObject)}else{t([],s.createMessageObject({code:"5001",aParameters:[o,a,n,r]}))}}this.doChangeOperationsInBatch=function(e,t){a.getXsrfToken(n).done(function(r){p(e).done(function(e){var o={requestUri:n+"/"+"$batch",method:"POST",headers:{"x-csrf-token":r},data:{__batchRequests:[{__changeRequests:e}]}};var i=function(e,a){var n;var r;var o,i,c;var u="";var f,d;if(e&&e.__batchResponses){for(f=0;f<e.__batchResponses.length;f++){if(e.__batchResponses[f].message){o=e.__batchResponses[f].message;i="";u=a.requestUri;n=s.createMessageObject({code:"5001",aParameters:[i,o,"",u]});break}for(d=0;d<e.__batchResponses[f].__changeResponses.length;d++){r=e.__batchResponses[f].__changeResponses[d];if(r.message){o=r.message;c=r.data;i=r.statusCode;u=a.requestUri;n=s.createMessageObject({code:"5001",aParameters:[i,o,c,u]});break}}}t(n)}};var c=function(e){h(e,t)};a.odataRequest(o,i,c,OData.batchHandler)})})};this.readCollectionsInBatch=function(e,t){a.getXsrfToken(n).done(function(r){p(e).done(function(e){var o={requestUri:n+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":r},data:{__batchRequests:e}};var i=function(e){var a=[];var n,r,o,i,c;var u;if(e&&e.__batchResponses){for(u=0;u<e.__batchResponses.length;u++){if(e.__batchResponses[u].data&&e.__batchResponses[u].data.results){a.push(e.__batchResponses[u].data.results)}else if(e.__batchResponses[u].message){r=e.__batchResponses[u].message;o=e.__batchResponses[u].response.body;i=e.__batchResponses[u].response.statusCode;c=a.requestUri;n=s.createMessageObject({code:"5001",aParameters:[i,r,o,c]});break}else{c=a.requestUri;n=s.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",c]});break}}t(a,n)}};var c=function(e){h(e,t)};a.odataRequest(o,i,c,OData.batchHandler)})})};this.readCollection=function(e,t,a,s,n){l(e,t,a,s,n)};function l(e,t,o,i,u){var f=sap.apf.core.constants.entitySets[e];var d=function(e,a){var o;var i;var c="";if(e&&e.__batchResponses){if(e.__batchResponses[0].data&&e.__batchResponses[0].data.results){o=e.__batchResponses[0].data.results}else if(e.__batchResponses[0].message){var u=e.__batchResponses[0].message;var d=e.__batchResponses[0].response.body;var p=e.__batchResponses[0].response.statusCode;c=a.requestUri;i=s.createMessageObject({code:"5001",aParameters:[p,u,d,c]})}else{c=a.requestUri;i=s.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",c]})}r(n,f).done(function(e){t(o,e,i)})}};a.getXsrfToken(n).done(function(e){g(f,o,i,u).done(function(s){var r={requestUri:n+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":e},data:{__batchRequests:[{requestUri:s,method:"GET",headers:{"x-csrf-token":e,"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage()}}]}};a.odataRequest(r,d,function(e){c(e,t)},OData.batchHandler)})})}this.create=function(e,t,o){if(e==="configuration"){t=f(t)}var c=sap.apf.core.constants.entitySets[e];a.getXsrfToken(n).done(function(e){var u=n+"/"+c;var f={requestUri:u,async:true,method:"POST",headers:{"x-csrf-token":e},data:t};function d(e,t){var a;var i;if(e&&t.statusCode===201){a=e}else{i=s.createMessageObject({code:"5201"})}r(n,c).done(function(e){o(a,e,i)})}function p(e){var t=i(e);o(undefined,undefined,t)}a.odataRequest(f,d,p)})};this.update=function(e,t,c,u){if(e==="configuration"){t=f(t)}var d=sap.apf.core.constants.entitySets[e];a.getXsrfToken(n).done(function(e){var f=n+"/"+d+o(u);var p={requestUri:f,method:"PUT",headers:{"x-csrf-token":e},data:t};function g(e,t){var a;if(t.statusCode!==204){a=s.createMessageObject({code:"5201"})}r(n,d).done(function(e){c(e,a)})}function h(e){var t=i(e);c(undefined,t)}a.odataRequest(p,g,h)})};this.remove=function(e,t,c,u){var f=sap.apf.core.constants.entitySets[e];a.getXsrfToken(n).done(function(e){var p=n+"/"+f+o(t);r(n,f).done(function(t){if(u){p=p+"$filter="+u.toUrlParam({formatValue:function(e,a){return d(e,a,t)}})}var s={requestUri:p,method:"DELETE",headers:{"x-csrf-token":e}};a.odataRequest(s,g,h)});function g(e,t){if(t.statusCode===204){r(n,f).done(function(e){c(e,undefined)})}else{var a=s.createMessageObject({code:"5201"});c(undefined,a)}}function h(e){var t=i(e);c(undefined,t)}})}}});
//# sourceMappingURL=odataProxy.js.map
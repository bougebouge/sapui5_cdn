/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/ui/representations/utils/displayOptionHandler","sap/ui/thirdparty/jquery"],function(t,jQuery){"use strict";sap.apf.ui.representations.utils.ChartDataSetHelper=function(t,e){this.oFormatter=t;this.aDataResponseWithDisplayValue=[];this.oDisplayOptionHandler=new sap.apf.ui.representations.utils.DisplayOptionHandler;this.oTimeAxisDateConverter=e;this.oChartDataSet={}};sap.apf.ui.representations.utils.ChartDataSetHelper.getFieldNameForOriginalContentOfProperty=function(t){return"original_"+t};function e(t,e){var a=t.map(function(t){return t.fieldName});return a.indexOf(e)===-1?true:false}function a(t){var e=t.dimensions.concat(t.measures),a;e.forEach(function(t){for(a in t){if(a!=="name"&&a!=="value"&&a!=="dataType"&&a!=="displayValue"&&a!=="identity"){delete t[a]}}})}function i(t,e,a,i){var r=jQuery.extend(true,[],i);var n,s={};t.oTimeAxisDateConverter.createPropertyInfo(e.dimensions);var o=e.dimensions.concat(e.requiredFilters);o.forEach(function(i,o){var p=e.requiredFilterOptions?e.requiredFilterOptions.labelDisplayOption:undefined;var l=i.labelDisplayOption?i.labelDisplayOption:p;var u=i.fieldName?i.fieldName:i;if(l===undefined||l===sap.apf.core.constants.representationMetadata.labelDisplayOptions.TEXT){return r}r.forEach(function(e,o){e[u]=e[u]===null||e[u]===undefined?e[u]:e[u].toString();if(l===sap.apf.core.constants.representationMetadata.labelDisplayOptions.KEY){n="formatted_"+u;if(!r[o][n]){r[o][n]=t.oFormatter.getFormattedValue(u,r[o][u])}}if(l===sap.apf.core.constants.representationMetadata.labelDisplayOptions.KEY_AND_TEXT){var p=a.getPropertyMetadata(u).text;n=u+"_"+p;var d={text:r[o][p],key:r[o][u]};r[o][n]=t.oFormatter.getFormattedValueForTextProperty(u,d)}if(t.oTimeAxisDateConverter.bIsConversionToDateRequired(i.fieldName,a)){var f=e[u];var h=sap.apf.ui.representations.utils.ChartDataSetHelper.getFieldNameForOriginalContentOfProperty(u);if(e[h]){s[f]=e[h]}else{var D=sap.apf.utils.convertFiscalYearMonthDayToDateString(f)+"";s[D]=f;e[u]=D;e[h]=f}}})});t.oTimeAxisDateConverter.setConvertedDateLookUp(s);return r}sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.constructor=sap.apf.ui.representations.utils.ChartDataSetHelper;sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.createFlattenDataSet=function(t,r,n,s){var o=this;this.aDataResponseWithDisplayValue=i(this,t,r,n);t.dimensions.forEach(function(t,e){t.name=o.oDisplayOptionHandler.getDisplayNameForDimension(t,r,s);t.value="{"+t.fieldName+"}";t.identity=t.fieldName;t.displayValue="{"+o.oDisplayOptionHandler.getColumnNameBasedOnDisplayOption(t.fieldName,t.labelDisplayOption,r)+"}"});t.measures.forEach(function(t){t.name=o.oDisplayOptionHandler.getDisplayNameForMeasure(t,r,n,s);t.value="{"+t.fieldName+"}";t.identity=t.fieldName});var p={dimensions:t.dimensions,measures:t.measures};var l=t.requiredFilters[0];this.oChartDataSet=jQuery.extend(true,{},p);this.oChartDataSet.context=[];a(this.oChartDataSet);if(l&&e(t.dimensions,l)){this.oChartDataSet.context.push(l);this.oChartDataSet.dimensions.push({name:l,value:"{"+l+"}",identity:l})}this.oChartDataSet.data={path:"/data"}};sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.addUnusedDimensionsToChartContext=function(t,e){if(e.length===0){return}var a=[];this.oChartDataSet.dimensions.forEach(function(e){var i=e.identity;a.push(i);var r=t.getPropertyMetadata(i).text;if(r){a.push(r)}});this.oChartDataSet.measures.forEach(function(t){a.push(t.identity)});var i=Object.keys(e[0]);i.forEach(function(e){if(a.indexOf(e)>=0||e==="__metadata"){return}var i=t.getPropertyMetadata(e);if(i&&i["aggregation-role"]==="measure"){return}this.addPropertyToContext(e,i)}.bind(this))};sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.addPropertyToContext=function(t,e){var a=e&&e.label?e.label:t;this.oChartDataSet.context.push(t);this.oChartDataSet.dimensions.push({name:a,value:"{"+t+"}",identity:t})};sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.getFlattenDataSet=function(){return new sap.viz.ui5.data.FlattenedDataset(this.oChartDataSet)};sap.apf.ui.representations.utils.ChartDataSetHelper.prototype.getModel=function(){var t=new sap.ui.model.json.JSONModel({data:this.aDataResponseWithDisplayValue});return t}});
//# sourceMappingURL=chartDataSetHelper.js.map
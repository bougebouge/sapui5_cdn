/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/m/FacetFilterList","sap/m/FacetFilterItem","sap/apf/ui/utils/facetFilterListConverter","sap/apf/ui/utils/facetFilterValueFormatter","sap/ui/thirdparty/jquery"],function(e,t,i,s,jQuery){"use strict";sap.apf.ui.utils.FacetFilterListHandler=function(e,t,i){"use strict";var s=[];var a;var r=new sap.apf.ui.utils.FacetFilterListConverter;function l(t){if(t===null||t.length===0){var s=e.createMessageObject({code:"6010",aParameters:[e.getTextNotHtmlEncoded(i.getLabel())]});e.putMessage(s);a.setActive(false)}}function n(i,l,n,o){var c=new sap.apf.ui.utils.FacetFilterValueFormatter(t,e);var u=c.getFormattedFFData(i,l,n);var d=r.getFFListDataFromFilterValues(u,l,s);var F=a.getModel();F.setSizeLimit(500);F.setData(d);var f=F.getData();if(o){f.forEach(function(e){if(e.selected==false){if(!sap.ui.Device.browser.msie){if(Object.values(a.getSelectedKeys()).indexOf(e.text)>-1){a.removeSelectedKey(e.key)}}else{if(Object.keys(a.getSelectedKeys()).indexOf(e.text)>-1){a.removeSelectedKey(e.key)}}}})}F.updateBindings()}this.createFacetFilterList=function(){var t=this;a=new sap.m.FacetFilterList({title:e.getTextNotHtmlEncoded(i.getLabel()),multiSelect:i.isMultiSelection(),key:i.getPropertyName(),growing:false,growingScrollToLoad:true,listClose:this.onListClose.bind(this),listOpen:this.onListOpen.bind(this)});a.bindItems("/",new sap.m.FacetFilterItem({key:"{key}",text:"{text}",selected:"{selected}"}));var r=new sap.ui.model.json.JSONModel([]);r.setDefaultBindingMode(sap.ui.model.BindingMode.OneWay);a.setModel(r);if(!i.hasValueHelpRequest()){this.getFacetFilterListData().done(l)}this.getSelectedFFValues().then(function(e){o(e)});return a;function o(e){e.oFilterRestrictionPropagationPromiseForSelectedValues.done(function(e,t){o({aSelectedFilterValues:e,oFilterRestrictionPropagationPromiseForSelectedValues:t})});if(e.aSelectedFilterValues.length>0||s.length>0){s=e.aSelectedFilterValues;t.getFacetFilterListData().done(function(e,t,i){n(e,t,i,true)})}}};this.getFacetFilterListData=function(){var e;var t=jQuery.Deferred();var s=i.getValues();s.then(function(s){e=i.getAliasNameIfExistsElsePropertyName()||i.getPropertyName();i.getMetadata().then(function(i){t.resolve(s,e,i)})});return t.promise()};this.getSelectedFFValues=function(){var e=jQuery.Deferred();var t=i.getSelectedValues();t.then(function(t,i){e.resolve({aSelectedFilterValues:t,oFilterRestrictionPropagationPromiseForSelectedValues:i})});return e.promise()};this.setSelectedFFValues=function(e){i.setSelectedValues(e)};this.onListClose=function(){var e=[],i,r,l,n;i=a.getSelectedItems();e=i.map(function(e){return e.getKey()});r=JSON.stringify(e.sort());l=JSON.stringify(s.sort());n=r!==l;if(n){s=e;this.setSelectedFFValues(e);t.selectionChanged(true)}};this.onListOpen=function(){a.setBusy(true);this.getFacetFilterListData().done(function(e,t,i){n(e,t,i,false);a.setBusy(false)})}}});
//# sourceMappingURL=facetFilterListHandler.js.map
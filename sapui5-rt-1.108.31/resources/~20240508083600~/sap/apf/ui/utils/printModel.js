/* (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/* (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/formatter","sap/viz/ui5/types/legend/Common"],function(t,e){"use strict";sap.apf.ui.utils.PrintModel=function(t){this.oUiApi=t.uiApi;this.oCoreApi=t.oCoreApi;this.oFilterIdHandler=t.oFilterIdHandler};sap.apf.ui.utils.PrintModel.prototype.constructor=sap.apf.ui.utils.PrintModel;function r(t,e,r,i,a,o){var n=new sap.apf.ui.utils.formatter({getEventCallback:t.oUiApi.getEventCallback.bind(t.oUiApi),getTextNotHtmlEncoded:t.oCoreApi.getTextNotHtmlEncoded,getExits:t.oUiApi.getCustomFormatExit()},e);var l=n.getFormattedValue(r,a);var s=n.getFormattedValue(r,o);var p=t.oCoreApi.getTextNotHtmlEncoded(i,[l,s]);return p}function i(t){var e=t.oUiApi.getSmartFilterForPrint();var i=[];if(e!==undefined&&e!==null){var a=e.getFilterData();var o=e.getAnalyticalParameters();if(o&&o.length>0){o.forEach(function(e){var o=a[e.fieldName];var n=e.fieldNameOData;t.oCoreApi.getMetadataFacade().getProperty(n).done(function(e){i.push({sFilterName:n,sFilterValue:r(t,e,n,"EQ",o)})})})}var n=e.getFilters();if(n.length>0){var l=sap.apf.core.utils.Filter.transformUI5FilterToInternal(t.oCoreApi.getMessageHandler(),n[0]);for(var s in a){var p="";var u=l.getFilterTermsForProperty(s);if(u.length>0){t.oCoreApi.getMetadataFacade().getProperty(s).done(function(e){for(var a=0;a<u.length;a++){p+=r(t,e,s,u[a]["operator"],u[a]["value"],u[a]["highValue"]);if(a!==u.length-1){p+=", "}}i.push({sFilterName:s,sFilterValue:p})})}}}}return i}function a(t){var e,r="",i;var a,n,l=[],s=[],p=[];a=t.oUiApi.getFacetFilterForPrint();if(a){n=a.getLists();for(e=0;e<n.length;e++){r=n[e].getTitle();p=n[e].getSelectedItems();if(p.length>0){s=o(p);if(r!==undefined&&r!==null){i="";for(var u=0;u<s.length;u++){if(u!==s.length-1){i+=s[u]+", "}else{i+=s[u]}}l.push({sFilterName:r,sFilterValue:i})}}else{l.push({sFilterName:r,sFilterValue:t.oCoreApi.getTextNotHtmlEncoded("noSelectionInFilter")})}}}return l}function o(t){var e=[];t.forEach(function(t){e.push(t.getText())});return e}function n(t){var e=t.oFilterIdHandler.getAllInternalIds();var r,i=[],a;if(e.length>0){for(a=0;a<e.length;a++){r=t.oFilterIdHandler.get(e[a]).getExpressions();i.push(r[0])}}return i}function l(t,e){var r=[],i,a,o="",n,l,s;var p=[];for(i=0;i<e.length;i++){for(a=0;a<e[i].length;a++){t.oCoreApi.getMetadataFacade().getProperty(e[i][a].name).done(function(e){s=e;o="";p=[];o=e.label;l=new sap.apf.ui.utils.formatter({getEventCallback:t.oUiApi.getEventCallback.bind(t.oUiApi),getTextNotHtmlEncoded:t.oCoreApi.getTextNotHtmlEncoded,getExits:t.oUiApi.getCustomFormatExit()},e)});p.push(l.getFormattedValue(s.name,e[i][a].value));if(o!==undefined&&o!==null){n="";for(var a=0;a<p.length;a++){if(a!==p.length-1){n+=p[a]+", "}else{n+=p[a]}}r.push({sFilterName:o,sFilterValue:n})}}}return r}function s(t){var e=t.oUiApi.getEventCallback(sap.apf.core.constants.eventTypes.printTriggered);var r=l(t,n(t));if(e!==undefined){var i={getTextNotHtmlEncoded:t.oCoreApi.getTextNotHtmlEncoded};r=e.apply(i,n(t))}return r}function p(t){var e,r,o;var n=a(t);r=i(t);e=s(t);o=e.concat(r,n);return o}sap.apf.ui.utils.PrintModel.prototype.getFiltersToPrint=function(){var t=this;var e=p(t);return e};sap.apf.ui.utils.PrintModel.prototype.getHeaderForFirstPage=function(){return this.oUiApi.getLayoutView().getController().oSavedPathName.getText()};sap.apf.ui.utils.PrintModel.prototype.getApplicationName=function(){var t;var e=this.applicationConfig.appName;if(!e){t=this.oCoreApi.createMessageObject({code:"6003",aParameters:["sAppName"]});this.oCoreApi.putMessage(t)}return e};sap.apf.ui.utils.PrintModel.prototype.setApplicationConfig=function(t){this.applicationConfig=t};sap.apf.ui.utils.PrintModel.prototype.getRepresentationForPrint=function(t){var e;var r;var i;var a;var o=this.oCoreApi.getTextNotHtmlEncoded(t.title);var n=t.getSelectedRepresentation();var l=n.bIsAlternateView?n.toggleInstance:n;if(l&&l.titleControl&&l.titleControl.oParent){i=l.titleControl.oParent.getItems();if(i&&i.length>1){for(r=0;r<i.length;r++){if(i[r].getMetadata()._sClassName==="sap.m.HBox"){a=i[r];a.setVisible(false)}}}}e=l.getPrintContent(o);return e.oRepresentation}});
//# sourceMappingURL=printModel.js.map
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/helper","sap/apf/utils/trace"],function(e,t){"use strict";function i(e){var t=e.getMessage();while(e.getPrevious()){e=e.getPrevious();t=t+"\n"+e.getMessage()}return t}sap.ui.core.mvc.Controller.extend("sap.apf.ui.reuse.controller.stepGallery",{getGalleryElementsData:function(){var t=this;var i=[];var a=this.oCoreApi.getCategories();var s=this.oCoreApi.getTextNotHtmlEncoded("label");var o=this.oCoreApi.getTextNotHtmlEncoded("steps");var r=this.oCoreApi.getTextNotHtmlEncoded("category");var l;if(a.length===0){l=this.oCoreApi.createMessageObject({code:"6001",aParameters:["Categories"]});this.oCoreApi.putMessage(l)}var p;for(p=0;p<a.length;p++){var n={};var c=a[p];var g;if(!c.label){l=this.oCoreApi.createMessageObject({code:"6002",aParameters:[s,r+": "+g]});this.oCoreApi.putMessage(l)}else{g=this.oCoreApi.getTextNotHtmlEncoded(c.label);n.title=this.oCoreApi.getTextNotHtmlEncoded(c.label)}n.id=c.id;n.stepTemplates=[];c.stepTemplates.forEach(function(i){var a={};if(!i.title){l=t.oCoreApi.createMessageObject({code:"6003",aParameters:["Title"]});t.oCoreApi.putMessage(l)}else{a.title=t.oCoreApi.getTextNotHtmlEncoded(i.title)}a.id=i.id;a.representationtypes=i.getRepresentationInfo();a.representationtypes.forEach(function(i){i.title=t.oCoreApi.getTextNotHtmlEncoded(i.label);if(i.parameter&&i.parameter.orderby){new e(t.oCoreApi).getRepresentationSortInfo(i).done(function(e){var t=[];for(var a=0;a<e.length;a++){e[a].done(function(e){t.push(e)})}i.sortDescription=t})}});a.defaultRepresentationType=a.representationtypes[0];n.stepTemplates.push(a)});i.push(n)}var d=this.oCoreApi.getStepTemplates();if(d.length===0){l=this.oCoreApi.createMessageObject({code:"6002",aParameters:[o,r]});this.oCoreApi.putMessage(l)}var h={GalleryElements:i};return h},onInit:function(){if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact")}this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;var e=this.getGalleryElementsData().GalleryElements;var t=new sap.ui.model.json.JSONModel({GalleryElements:e});this.getView().setModel(t)},getStepDetails:function(e,t){var i=this.getGalleryElementsData().GalleryElements;var a=i[e].stepTemplates[t];return a},openHierarchicalSelectDialog:function(){if(this.oHierchicalSelectDialog){this.oHierchicalSelectDialog.destroy()}this.oHierchicalSelectDialog=new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.stepGallery",this);this.oHierchicalSelectDialog.setModel(this.getView().getModel());if(sap.ui.Device.system.desktop){this.oHierchicalSelectDialog.addStyleClass("sapUiSizeCompact")}this.oHierchicalSelectDialog.open()},onStepPress:function(e,a){t.logCall("stepGallery.onStepPress -- adds an active step, id=",e," ************************************** ");var s=this;var o=s.oUiApi.getAnalysisPath().getController();this.oCoreApi.checkAddStep(e).done(function(r,l){t.log("onStepPress->continuation",", bCanStepBeAdded",r," oRepresentationType=",a);if(r){s.oHierchicalSelectDialog.close();s.oCoreApi.createStep(e,o.callBackForUpdatePathAndSetLastStepAsActive.bind(o),a);o.refresh(-1)}else{var p=i(l);var n={oController:s,sMessageText:p};var c=new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.addStepCheckDialog",n);c.open();s.oUiApi.getLayoutView().setBusy(false)}});var r=this.oCoreApi.getSteps();var l=r.length>0?r[r.length-1].getSelectedRepresentation():{};t.logReturn("onStepPress",", step id=",e,", repr.apfId="+(l?l.apfId:"--"),", selectedRepr=",l?l:"error: no step existing")}})});
//# sourceMappingURL=stepGallery.controller.js.map
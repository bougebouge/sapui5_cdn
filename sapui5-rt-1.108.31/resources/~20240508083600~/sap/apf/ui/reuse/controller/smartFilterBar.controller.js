/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/CountMode"],function(e,t,a,i){"use strict";return e.extend("sap.apf.ui.reuse.controller.smartFilterBar",{onInit:function(){var e=this;var r=e.getView().getViewData().oSmartFilterBarConfiguration.service;var n=e.getView().getViewData().oCoreApi.getAnnotationsForService(r);var o={annotationURI:n,json:true};if(n&&n.length>0){o.loadAnnotationsJoined=true}var s=e.getView().getViewData().oCoreApi.getStartParameterFacade().getSapSystem();if(s){r=t.setOrigin(r,{force:true,alias:s})}var g=new a(r,o);g.getMetaModel().loaded().then(function(){e.getView().getViewData().oCoreApi.getMetadata(r).done(function(t){if(t.getAllEntitySetsExceptParameterEntitySets().indexOf(e.getView().getViewData().oSmartFilterBarConfiguration.entitySet)<0){e.getView().getViewData().oCoreApi.putMessage(e.getView().getViewData().oCoreApi.createMessageObject({code:"5053",aParameters:[e.getView().getViewData().oSmartFilterBarConfiguration.entitySet,r]}))}g.setDefaultCountMode(i.None);e.byId("idAPFSmartFilterBar").setModel(g)})});g.attachMetadataFailed(function(){e.getView().getViewData().oCoreApi.putMessage(e.getView().getViewData().oCoreApi.createMessageObject({code:"5052",aParameters:[r]}))})},afterInitialization:function(){this.handleSplitterSize();this.setFilterData();this.validateFilters();this.registerSFBInstanceWithCore()},registerSFBInstanceWithCore:function(){var e=this;e.getView().getViewData().oCoreApi.registerSmartFilterBarInstance(e.byId("idAPFSmartFilterBar"))},handlePressOfGoButton:function(){var e=this;var t=this.byId("idAPFSmartFilterBar");if(!t._apfOpenPath&&e.getView().getViewData().oCoreApi.getActiveStep()){e.getView().getViewData().oUiApi.selectionChanged(true)}delete t._apfOpenPath},setFilterData:function(){var e=this;var t=this.byId("idAPFSmartFilterBar");var a=e.getView().getViewData().oCoreApi.getStartParameterFacade().getAnalyticalConfigurationId();var i=e.getView().getViewData().oCoreApi.getStartParameterFacade().getXappStateId();var r=t.getUiState();var n=t.mProperties;t.setUiState(r,n);if(a!==undefined||i!==null&&i!==undefined){var o=e.getView().getViewData().oCoreApi;var s=o.getComponent();if(sap.ushell.Container!==undefined){var g=sap.ushell.Container.getService("CrossApplicationNavigation");var d=g.getStartupAppState(s);d.done(function(e){var t=e.getData();if(t){t=JSON.parse(JSON.stringify(t));var a=t.selectionVariant;var i=new sap.ui.comp.state.UIState({selectionVariant:a});var r=this.byId("idAPFSmartFilterBar");r.setUiState(i,{replace:true,strictMode:false})}}.bind(this))}var l=t.getVariantManagement().getDefaultVariantKey();t.setCurrentVariantId(l)}},validateFilters:function(){var e=this.byId("idAPFSmartFilterBar");var t=e.validateMandatoryFields();this.getView().getViewData().oUiApi.getAddAnalysisStepButton().setEnabled(t);this.getView().getViewData().oUiApi.getAddAnalysisStepButton().rerender()},handleSplitterSize:function(){var e=this;var t=this.byId("idAPFSmartFilterBar");var a=t.mAggregations.content[0];var i=a.mAggregations.content[2];i.attachPress(function(){var t=this.getParent().getParent();if(t.getFilterBarExpanded()){e.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("127px")}else{e.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("65px")}})}})});
//# sourceMappingURL=smartFilterBar.controller.js.map
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/m/MessageBox","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/Log"],function(e,jQuery,t,a){"use strict";var o;function s(e){var t=e.getMessage();while(e.getPrevious()){e=e.getPrevious();t=t+"\n"+e.getMessage()}return t}function i(e,t){var a=e.getView().getViewData().oCoreApi;var o=a.getGenericExit("closeFatalErrorDialog");if(o){o(a,e,t)}else{window.history.go(-1)}}function n(e,t){sap.m.MessageBox.information(t.getMessage(),{styleClass:sap.ui.Device.system.desktop?"sapUiSizeCompact":""})}function r(e,t){sap.m.MessageToast.show(t.getMessage(),{width:"20em"})}function l(e){var t=o.oCoreApi.getLogMessages();var a=false;for(var s=0;s<t.length;s++){if(t[s].search(5021)!==-1){a=true;break}}return a}function g(e,a){var i=new sap.m.Dialog(e.createId("idShowDetailsDialog"),{contentWidth:jQuery(window).height()*.6+"px",contentHeight:jQuery(window).height()*.6+"px",title:o.oCoreApi.getTextNotHtmlEncoded("error"),type:sap.m.DialogType.Message,state:sap.ui.core.ValueState.Error,content:new sap.ui.core.HTML({content:["<div><p> "+t(s(a))+"</p></div>"].join(""),sanitizeContent:true}),beginButton:new sap.m.Button({text:o.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){i.close()}}),afterClose:function(){i.destroy()}});i.setInitialFocus(i);i.open()}function p(e,t){var a=l(e);var s=new sap.m.Dialog(e.createId("idFatalDialog"),{title:o.oCoreApi.getTextNotHtmlEncoded("error"),type:sap.m.DialogType.Message,state:sap.ui.core.ValueState.Error,content:[new sap.m.Text({text:a?o.oCoreApi.getTextNotHtmlEncoded("application-reload"):o.oCoreApi.getTextNotHtmlEncoded("fatalErrorMessage")}),new sap.m.VBox({alignItems:sap.m.FlexAlignItems.End,items:[new sap.m.Link({text:o.oCoreApi.getTextNotHtmlEncoded("showDetails"),press:function(){g(e,t)}})]})],beginButton:new sap.m.Button({text:o.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){i(e,s)}}),afterClose:function(){s.destroy()}});s.setInitialFocus(s);s.open()}function c(e,t){var a=o.oCoreApi;var s=o.uiApi;var i=new sap.m.Dialog(e.createId("idShowValidStateDialog"),{title:a.getTextNotHtmlEncoded("error"),type:sap.m.DialogType.Message,state:sap.ui.core.ValueState.Error,content:[new sap.m.Text({text:a.getTextNotHtmlEncoded("lastValidStateMessage")}),new sap.m.VBox({alignItems:sap.m.FlexAlignItems.End,items:[new sap.m.Link({text:a.getTextNotHtmlEncoded("showDetails"),press:function(){g(e,t)}})]})],beginButton:new sap.m.Button({text:a.getTextNotHtmlEncoded("gobackToValidState"),press:function(){var e=a.restoreApfState();e.then(function(){s.getAnalysisPath().getController().bLastValidState=true;s.getAnalysisPath().getCarouselView().getController().removeAllThumbnails();a.updatePath(s.getAnalysisPath().getController().callBackForUpdatePath.bind(s.getAnalysisPath().getController()));s.getLayoutView().getController().setPathTitle();i.close();s.getAnalysisPath().getCarouselView().rerender();s.getLayoutView().setBusy(false)},function(){i.close()})}}),endButton:new sap.m.Button({text:a.getTextNotHtmlEncoded("startNewAnalysis"),press:function(){s.getAnalysisPath().getToolbar().getController().resetAnalysisPath();i.close()}}),afterClose:function(){i.destroy()}});i.setInitialFocus(i);i.open()}function u(e,t){var a=o.oCoreApi.isApfStateAvailable();if(a){c(e,t)}else{p(e,t)}}sap.ui.controller("sap.apf.ui.reuse.controller.messageHandler",{onInit:function(){var e=this;if(sap.ui.Device.system.desktop){e.getView().addStyleClass("sapUiSizeCompact")}o=e.getView().getViewData()},showMessage:function(e){var t=this;var s=e.getSeverity();var i=sap.apf.core.constants.message.severity;switch(s){case i.fatal:o.uiApi.getLayoutView().setBusy(false);u(t,e);break;case i.error:o.uiApi.getLayoutView().setBusy(false);break;case i.information:n(t,e);break;case i.success:r(t,e);break;default:a.error("Error type not defined");break}if(s===i.warning||s===i.error){sap.m.MessageToast.show(e.getMessage(),{width:"40%",offset:"0 -50",animationDuration:2e3})}}})});
//# sourceMappingURL=messageHandler.controller.js.map
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2019 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/constants","sap/apf/core/constants","sap/apf/ui/reuse/view/analysisPath.view","sap/apf/ui/reuse/view/carousel.view","sap/apf/utils/trace","sap/ui/dom/includeStylesheet"],function(e,t,a,i,n,r){"use strict";function s(e,t,a){var i=e.getLayoutView();var n=i.byId("subHeader");var r=i.byId("idSplitterLayoutData");n.addContent(t);if(!(t instanceof sap.ui.comp.smartfilterbar.SmartFilterBar)){r.setSize("65px")}t.addEventDelegate({onAfterRendering:function(){n.setBusy(false);if(t instanceof sap.ui.comp.smartfilterbar.SmartFilterBar){n.setHeight("");n.addStyleClass(a)}}})}function o(e){e.getLayoutView().byId("subHeader").setBusy(false)}function l(a){a.uiApi=this;var i=a.oCoreApi;var l=a.oStartFilterHandler;var u;var c;var f;var p;var d;var g;var v;var y;var h;var w,C;var S=i.getUriGenerator().getApfLocation();this.oEventCallbacks={};var m;r(S+"resources/css/apfUi.css","apfCss");r(S+"resources/css/apfPrint.css","printCss");jQuery("#printCss").attr("media","print");this.getAddAnalysisStepButton=function(){return this.getAnalysisPath().getCarouselView().getAddStepButton()};this.getAnalysisPath=function(){if(u===undefined){u=sap.ui.view({viewName:"sap.apf.ui.reuse.view.analysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:a,async:true})}return u};this.getNotificationBar=function(){if(c===undefined){c=sap.ui.view({viewName:"sap.apf.ui.reuse.view.messageHandler",type:sap.ui.core.mvc.ViewType.JS,viewData:a,async:true})}return c};this.getStepContainer=function(){if(f===undefined){f=sap.ui.view({viewName:"sap.apf.ui.reuse.view.stepContainer",type:sap.ui.core.mvc.ViewType.JS,viewData:a,async:true})}return f};this.getToolbar=function(){if(p===undefined){p=sap.ui.view({viewName:"sap.apf.ui.reuse.view.toolbar",type:sap.ui.core.mvc.ViewType.JS,viewData:a,async:true})}return p};this.createCarouselSingleton=function(){if(a&&a.functions&&a.functions.createCarouselSingleton){d=a.functions.createCarouselSingleton()}if(d===undefined){d=sap.ui.view({viewName:"sap.apf.ui.reuse.view.carousel",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:a},async:true})}return d};this.getStepGallery=function(){if(g===undefined){g=sap.ui.view({type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.apf.ui.reuse.view.stepGallery",viewData:a,async:true})}return g};this.getPathGallery=function(){if(v===undefined){v=sap.ui.view({viewName:"sap.apf.ui.reuse.view.pathGallery",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:a},async:true})}return v};this.getDeleteAnalysisPath=function(){if(y===undefined){y=sap.ui.view({viewName:"sap.apf.ui.reuse.view.deleteAnalysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:a},async:true})}return y};this.getLayoutView=function(){if(h===undefined){h=sap.ui.view({viewName:"sap.apf.ui.reuse.view.layout",type:sap.ui.core.mvc.ViewType.XML,viewData:a,async:true})}return h};this.selectionChanged=function(e){n.logCall("ui/Instance.selectionChanged",", bRefreshAllSteps: ",e,"--------");var t;var a=this;function r(){if(h){h.getController().enableDisableOpenIn()}}t=i.getSteps().indexOf(i.getActiveStep());var s=0;t=i.getSteps().indexOf(i.getActiveStep());if(!e){s=t+1}n.logCall("...",", nActiveStepIndex: ",t,", indexOfRefresh",s);a.getAnalysisPath().getController().refresh(s);a.getAnalysisPath().getController().getView().getCarouselView().getController().setBusyFromIndex(s);i.updatePath(a.getAnalysisPath().getController().callBackForUpdatePath.bind(a.getAnalysisPath().getController()),function(){r()});n.logReturn("ui/Instance.selectionChanged")};var F=false;this.createApplicationLayout=function(e){var t=this;return new Promise(function(a){if(!F){var i=t.getStepGallery().loaded();var n=t.getToolbar().loaded();var r=t.getPathGallery().loaded();var s=t.getDeleteAnalysisPath().loaded();var o=t.getStepContainer().loaded();var l=Promise.all([i]).then(function(){return t.createCarouselSingleton().loaded()});var u=Promise.all([n,l,r,s]).then(function(){return t.getAnalysisPath().loaded()});var c=Promise.all([o,u]).then(function(){return t.getLayoutView().loaded()});c.then(function(){e.addPage(h);F=true;m=e;a(e)})}else{a(m)}})};this.addDetailFooterContent=function(e){this.getLayoutView().getController().addDetailFooterContentLeft(e)};this.addMasterFooterContentRight=function(e){this.getLayoutView().getController().addMasterFooterContentRight(e)};this.setEventCallback=function(e,t){this.oEventCallbacks[e]=t};this.getEventCallback=function(e){return this.oEventCallbacks[e]};this.getCustomFormatExit=function(){return a.exits};this.setCustomFormatExit=function(e){var t=this.getCustomFormatExit();t.customFormat=e};this.drawSmartFilterBar=function(e){var t=this;function a(e){i.getSmartFilterbarDefaultFilterValues().done(function(a){C=sap.ui.view({viewName:"sap.apf.ui.reuse.view.smartFilterBar",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:i,oUiApi:t,oSmartFilterBarConfiguration:e,controlConfiguration:a,parent:t.getLayoutView()},async:true});C.loaded().then(function(e){s(t,e.byId("idAPFSmartFilterBar"),"smartFilterBarContainer")})})}if(e){if(e.entitySet){a(e)}else{i.getMetadata(e.service).done(function(t){e.entitySet=t.getEntitySetByEntityType(e.entityType);delete e.entityType;a(e)})}}else{o(t)}};this.drawFacetFilter=function(e){if(e.length>0){var t=this;w=sap.ui.view({viewName:"sap.apf.ui.reuse.view.facetFilter",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:i,oUiApi:this,aConfiguredFilters:e,oStartFilterHandler:l},async:true});w.loaded().then(function(e){s(t,e.byId("idAPFFacetFilter"))})}else{o(this)}};this.contextChanged=function(e){var a=this.getEventCallback(t.eventTypes.contextChanged);if(typeof a==="function"){a()}};this.getFacetFilterForPrint=function(){if(w){return w.byId("idAPFFacetFilter")}};this.getSmartFilterForPrint=function(){if(C){return C.byId("idAPFSmartFilterBar")}};this.handleStartup=function(e){var t=this;var a=jQuery.Deferred();i.getSmartFilterBarConfigurationAsPromise().done(function(n){if(n){t.drawSmartFilterBar(n)}e.done(function(e){var r=l.getStartFilters();r.done(function(r){t.contextChanged();if(!n){t.drawFacetFilter(r)}if(e.navigationMode==="backward"){t.getAnalysisPath().getController().isBackNavigation=true;i.updatePath(t.getAnalysisPath().getController().callBackForUpdatePath.bind(t.getAnalysisPath().getController()));t.getLayoutView().getController().setPathTitle()}if(e.navigationMode==="forward"){if(i.getStartParameterFacade().getSteps()){var s=i.getStartParameterFacade().getSteps()[0].stepId;var o=i.getStartParameterFacade().getSteps()[0].representationId;var l=t.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(t.getAnalysisPath().getController());i.createFirstStep(s,o,l)}if(sap.ui.core.BusyIndicator){sap.ui.core.BusyIndicator.hide()}}t.getNotificationBar().loaded().then(function(e){t.getLayoutView().byId("applicationPage").addContent(e);var n=e.getController().showMessage;i.setCallbackForMessageHandling(n.bind(e.getController()));a.resolve()})})})});return a.promise()};this.destroy=function(){w=undefined;C=undefined;if(u){var e=this.getAnalysisPath().getToolbar().getController();A(e.saveDialog);A(e.newOpenDialog);A(e.newDialog);A(e.confirmDialog);A(e.errorMsgDialog);A(e.noPathAddedDialog);if(e.deleteAnalysisPath!==undefined){A(e.deleteAnalysisPath.getController().oDialog)}if(e.pathGallery!==undefined){A(e.pathGallery.getController().oDialog)}var t=this.getAnalysisPath().getCarouselView().getStepGallery().getController();A(t.oHierchicalSelectDialog)}if(f){var a=this.getStepContainer().getController();A(a.selectionDisplayDialog);P(this)}};function A(e){if(e!==undefined){if(e instanceof sap.m.ViewSettingsDialog){e.destroy()}else if(e.isOpen()){e.close()}}}function P(t){var a=false;var i=false;var n;if(t.getStepContainer().getViewData().oCoreApi.getActiveStep()!==undefined){a=true}if(a){n=t.getStepContainer().getViewData().oCoreApi.getActiveStep().getSelectedRepresentation();if(n!==undefined){i=true}}if(i){if(n.type!==e.representationTypes.TABLE_REPRESENTATION){if(n.toggleInstance!==undefined){A(n.toggleInstance.viewSettingsDialog)}}else{A(n.viewSettingsDialog)}}}}sap.apf.ui.Instance=l;return l},true);
//# sourceMappingURL=instance.js.map
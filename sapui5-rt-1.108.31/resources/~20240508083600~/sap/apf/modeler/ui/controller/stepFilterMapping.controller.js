/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/controller/requestOptions","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/textPoolHelper","sap/ui/thirdparty/jquery"],function(e,t,i,jQuery){"use strict";var r=sap.apf.modeler.ui.utils.nullObjectChecker;var a=sap.apf.modeler.ui.utils.textManipulator;var n=sap.apf.modeler.ui.utils.TranslationFormatMap.STEPFILTERPROPERTY_LABEL;function l(e){var t=e.getView().getViewData().oTextReader;var i=e.oParentObject.getFilterMappingTargetPropertyLabelKey()?t("label"):t("label")+" ("+t("default")+")";e.byId("idOptionalSelectedPropertyLabel").setText(i);e.byId("idOptionalSelectedPropertyLabel").setTooltip(i)}function o(e){var t=e.getSource();var i=e.getEntity();var a;var n=e.oParentObject.getFilterMappingTargetPropertyLabelKey();if(t===undefined||i===undefined){return}if(r.checkIsNotUndefined(n)){a=e.getView().getViewData().oConfigurationHandler.getTextPool().get(n).TextElementDescription;e.byId("idOptionalSelectedPropertyLabelText").setValue(a);return}e.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(t,i).done(function(t){var i=e.oParentObject.getFilterMappingTargetProperties()[0];if(i){a=e.oStepPropertyMetadataHandler.getDefaultLabel(t,i)}e.byId("idOptionalSelectedPropertyLabelText").setValue(a)})}function s(e){e.byId("idOptionalRequestFieldLabel").addStyleClass("filterPropertyLable");e.byId("idOptionalRequestField").addStyleClass("filterProperty");e.byId("idOptionalLabelDisplayOptionType").addStyleClass("filterProperty")}var p=sap.apf.modeler.ui.controller.requestOptions.extend("sap.apf.modeler.ui.controller.stepFilterMapping",{setLabelDisplayOptionTypeAsPromise:function(e){var t=jQuery.Deferred();var i=this;var r=i.getSource();var n=i.getEntity();var s=[];var p=i.getView().getViewData().oTextReader;var d=new sap.apf.modeler.ui.utils.DisplayOptionsValueBuilder(p,e);var u=d.getLabelDisplayOptions();var y=sap.apf.core.constants.representationMetadata.labelDisplayOptions;var c=a.removePrefixText(i.byId("idOptionalRequestField").getSelectedKey(),p(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));l(i);o(i);i.byId("idOptionalLabelDisplayOptionType").setEnabled(true);if(!c){i.byId("idOptionalLabelDisplayOptionType").setModel(u);i.byId("idOptionalLabelDisplayOptionType").setEnabled(false);return t.promise()}var f=i.oParentObject.getFilterMappingTargetPropertyLabelDisplayOption();i.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(r,n).done(function(e){if((f===y.KEY_AND_TEXT||f===y.TEXT)&&!e.getPropertyMetadata(c).text){u=d.getValidatedLabelDisplayOptions();s=a.addPrefixText([f],p);f=s[0]}i.byId("idOptionalLabelDisplayOptionType").setModel(u);i.byId("idOptionalLabelDisplayOptionType").setSelectedKey(f);t.resolve()});return t.promise()},enableDisableLabelDisplayOptionTypeAsPromise:function(){var e=this;var t=e.getSource();var i=e.getEntity();var r=jQuery.Deferred();var n=e.getView().getViewData().oTextReader;var l=e.byId("idOptionalLabelDisplayOptionType");var o=a.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),n(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));e.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(t,i).done(function(e){var t=e.getPropertyMetadata(o).text;l.getItems().forEach(function(e){e.setEnabled(true);if(e.getKey()!=="key"&&!t){e.setEnabled(false)}});r.resolve()});return r.promise()},changeLabelDisplayOption:function(e){var t=this;t.oParentObject.setFilterMappingTargetPropertyLabelDisplayOption(e)},changeOptionalSelectedPropertyLabelText:function(e){var t=this;if(e.trim().length===0){t.oParentObject.setFilterMappingTargetPropertyLabelKey(undefined);l(t);o(t);return}t.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(e,n).done(function(e){t.oParentObject.setFilterMappingTargetPropertyLabelKey(e);l(t);o(t)})},onBeforeRendering:function(){var e=this;e.byId("idSelectPropertiesLabel").setVisible(false);e.byId("idSelectProperties").setVisible(false);e.byId("idOptionalRequestFieldLabel").setVisible(true);e.byId("idOptionalRequestField").setVisible(true);e.byId("idOptionalLabelDisplayOptionType").setVisible(true);e.byId("idOptionalRequestField").setForceSelection(false);e.byId("idOptionalSelectedPropertyLabel").setVisible(true);e.byId("idOptionalSelectedPropertyLabelText").setVisible(true)},onAfterRendering:function(){s(this)},getIdOfPropertiesControl:function(){return"idOptionalRequestField"},getIdOfPropertyLabel:function(){return"idOptionalRequestFieldLabel"},setSelectedKeysForProperties:function(e){var t=this;if(e.length!==0){t.byId("idOptionalRequestField").setSelectedKey(e[0])}else{t.byId("idOptionalRequestField").clearSelection()}},getSelectedKeysForProperties:function(){var e=this,t,i;var n=e.getView().getViewData().oTextReader;t=a.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),n(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));i=r.checkIsNotNullOrUndefinedOrBlank(t)?[t]:[];return i},setDisplayText:function(){var e=this;var t=e.getView().getViewData().oTextReader;e.byId("idSourceLabel").setText(t("source"));e.byId("idEntityLabel").setText(t("entity"));e.byId("idOptionalRequestFieldLabel").setText(t("targetProperty"))},resetEntityAndProperties:function(){var e=this;e.clearEntity();e.byId("idEntity").setModel(null);e.byId("idEntity").setSelectedKey(undefined);e.clearSelectProperties();e.byId("idOptionalRequestField").setModel(null);e.byId("idOptionalRequestField").setSelectedKey(undefined)},resetFilterMappingFields:function(){var e=this;e.clearSource();e.byId("idSource").setValue("");e.resetEntityAndProperties();e.addOrRemoveMandatoryFieldsAndRequiredFlag(false)},updateFilterMappingFields:function(){var e=this,t,i,n,l,o;var s=e.getView().getViewData().oTextReader;t=e.byId("idSource").getValue().trim();e.oConfigurationEditor.setIsUnsaved();if(r.checkIsNotNullOrUndefinedOrBlank(t)){e.getAllEntitiesAsPromise(t).done(function(t){if(!r.checkIsNotNullOrUndefinedOrBlank(t)){e.resetEntityAndProperties();return}e.setDetailData();i=a.removePrefixText(e.byId("idEntity").getSelectedKey(),s(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));n=r.checkIsNotNullOrUndefinedOrBlank(i)?i:undefined;e.updateEntity(n);l=a.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),s(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));o=r.checkIsNotNullOrUndefinedOrBlank(l)?[l]:[];e.updateSelectProperties(o)})}},getSource:function(){var e=this;return e.oParentObject.getFilterMappingService()},getAllEntitiesAsPromise:function(e){var t=this;return t.oConfigurationEditor.getAllEntitySetsOfServiceWithGivenPropertiesAsPromise(e,t.oParentObject.getFilterProperties())},getEntity:function(){var e=this;return e.oParentObject.getFilterMappingEntitySet()},getAllEntitySetPropertiesAsPromise:function(e,t){var i=this;return i.oConfigurationEditor.getAllPropertiesOfEntitySetAsPromise(e,t)},clearSource:function(){var e=this;e.oParentObject.setFilterMappingService(undefined);e.clearEntity()},clearEntity:function(){var e=this;e.oParentObject.setFilterMappingEntitySet(undefined);e.clearSelectProperties()},clearSelectProperties:function(){var e=this;var t=e.oParentObject.getFilterMappingTargetProperties();t.forEach(function(t){e.oParentObject.removeFilterMappingTargetProperty(t)});e.byId("idOptionalSelectedPropertyLabelText").setValue("")},removeSelectProperties:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeFilterMappingTargetProperty(e)})},updateSource:function(e){var t=this;t.oParentObject.setFilterMappingService(e)},updateEntity:function(e){var t=this;t.oParentObject.setFilterMappingEntitySet(e)},updateSelectProperties:function(e){var t=this;t.removeSelectProperties(t.oParentObject.getFilterMappingTargetProperties());e.forEach(function(e){t.oParentObject.addFilterMappingTargetProperty(e)})},updateOptionalRequestFieldProperty:function(e){var t=this;t.updateSelectProperties(e)},getSelectProperties:function(){var e=this;return e.oParentObject.getFilterMappingTargetProperties()},getValidationState:function(){var e=this;return e.viewValidator.getValidationState()}});return p},true);
//# sourceMappingURL=stepFilterMapping.controller.js.map
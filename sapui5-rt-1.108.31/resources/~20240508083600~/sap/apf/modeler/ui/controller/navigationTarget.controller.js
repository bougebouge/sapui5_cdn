sap.ui.define(["sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/viewValidator","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/m/MessageBox","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/ui/thirdparty/jquery"],function(e,t,i,a,n,o,jQuery){"use strict";var r,s,d,l,g,c,u,p;var f;var t=sap.apf.modeler.ui.utils.nullObjectChecker;var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var v=sap.apf.modeler.ui.utils.TranslationFormatMap.NAVTARGET_TITLE;function m(e){e.byId("idNavigationTargetHeaderLabel").setText(s("basicData"));e.byId("idSemanticObjectLabel").setText(s("semanticObject"));e.byId("idActionLabel").setText(s("action"));e.byId("idDescriptionLabel").setText(s("navigationTargetTitle"));e.byId("idNavigationParametersHeaderLabel").setText(s("navigationParametersHeader"));e.byId("idNavigationTargetTypeHeaderLabel").setText(s("navigationTargetType"));e.byId("idNavigationTargetTypeLabel").setText(s("assignmentType"));e.byId("idAssignedStepsLabel").setText(s("assignedSteps"));e.byId("idContextMapping").setText(s("contextMapping"))}function b(e){var i;if(r&&r.arguments&&r.arguments.navTargetId){c=g.getNavigationTarget(r.arguments.navTargetId)}if(!t.checkIsNotUndefined(c)){i=g.createNavigationTarget();c=g.getNavigationTarget(i);D(e)}}function T(e){var t=c.getTitleKey()?s("navigationTargetTitle"):s("navigationTargetTitle")+" ("+s("default")+")";e.byId("idDescriptionLabel").setText(t);e.byId("idDescriptionLabel").setTooltip(t);e.byId("idUseDynamicParametersCheckBoxLabel").setText(s("useDynamicParametersLabel"))}function I(e){var t,i;var a={oTextReader:s,oConfigurationHandler:l,oConfigurationEditor:g,oParentObject:c,getCalatogServiceUri:e.getView().getViewData().getCalatogServiceUri,oCoreApi:e.getView().getViewData().oCoreApi};t=new sap.ui.controller("sap.apf.modeler.ui.controller.navTargetContextMapping");i=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:sap.ui.core.mvc.ViewType.XML,id:e.createId("idContextMappingView"),viewData:a,controller:t});e.getView().attachEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,i.getController().updateSubViewInstancesOnReset.bind(i.getController()));i.addStyleClass("formTopPadding");e.byId("idContextMappingVBox").insertItem(i);f=0;var n=c.getAllNavigationParameters();if(n.length>0){n.forEach(function(t){y(e,t)})}else{y(e)}}function y(e,t){var i=new sap.ui.controller("sap.apf.modeler.ui.controller.navigationTargetParameter");var a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.navigationTargetParameter",type:sap.ui.core.mvc.ViewType.XML,id:e.createId("idNavigationTargetParameter"+f),viewData:{oTextReader:s,oParentController:e,oNavigationTarget:c,parameter:t,oConfigurationEditor:g},controller:i});e.byId("idNavigationParameterBox").addItem(a);f++;S(e)}function S(e){e.byId("idNavigationParameterBox").getItems().forEach(function(e){e.getController().checkVisibilityOfPlusMinus()})}function h(e){var i=jQuery.Deferred();p.getAllAvailableSemanticObjects(function(a,n){if(n===undefined){var r=o.prepareModel(a,a.length);e.byId("idSemanticObjectField").setModel(r);if(t.checkIsNotNullOrUndefinedOrBlank(c.getSemanticObject())){e.byId("idSemanticObjectField").setValue(c.getSemanticObject())}i.resolve()}else{M(e,n,"11504")}});return i.promise()}function N(e){var t,i;i=jQuery.Deferred();t=o.prepareModel([],0);e.byId("idActionField").setModel(t);A(undefined,e);V(e).then(function(e){i.resolve(e)});e.byId("idActionField").setValue(c.getAction());return i.promise()}function V(e){var i,a,n,r;r=new jQuery.Deferred;a=c.getSemanticObject();if(t.checkIsNotUndefined(a)){n=p.getSemanticActions(a);n.then(function(t){i=o.prepareModel(t.semanticActions,t.semanticActions.length);e.byId("idActionField").setModel(i);r.resolve(t)},function(t){M(e,t,"11505")})}return r.promise()}function A(e,i){var a,n,o;var r=c.getTitleKey();if(t.checkIsNotUndefined(r)){n=i.getView().getViewData().oConfigurationHandler.getTextPool().get(r).TextElementDescription;i.byId("idDescription").setValue(n)}else{var s=e?e:i.byId("idActionField").getModel().getData().Objects;if(s&&t.checkIsNotNullOrBlank(c.getAction())){for(o=0;o<s.length;o++){if(s[o].id===c.getAction()){a=s[o].text;break}}}n=a?a:c.getSemanticObject();i.byId("idDescription").setValue(n)}}function x(e){var t=new sap.apf.modeler.ui.utils.StaticValuesBuilder(s,o);var i=t.getNavTargetTypeData();e.byId("idNavigationTargetTypeField").setModel(i);var a=c.isStepSpecific()?s("stepSpecific"):s("globalNavTargets");e.byId("idNavigationTargetTypeField").setSelectedKey(a)}function C(e){var t=c.isStepSpecific()?s("stepSpecific"):s("globalNavTargets");if(t===s("stepSpecific")){P(e,true);var i=[];var a=g.getSteps();var n,r;for(n=0;n<a.length;n++){r={};r.stepKey=a[n].getId();r.stepName=d.get(a[n].getTitleId()).TextElementDescription;i.push(r)}var l=o.prepareModel(i,i.length);e.byId("idAssignedStepsCombo").setModel(l);var u=g.getStepsAssignedToNavigationTarget(c.getId());e.byId("idAssignedStepsCombo").setSelectedKeys(u)}}function D(e){var t={id:c.getId(),icon:c.isGlobal()?"sap-icon://overview-chart":"sap-icon://pushpin-off"};if(e.byId("idDescription").getValue()){t.name=e.byId("idDescription").getValue()}p.updateSelectedNode(t)}function w(e){var t=s("navigationTarget")+": "+e.byId("idDescription").getValue();p.updateTitleAndBreadCrumb(t)}function O(e){var t={key:c.getId(),value:e.byId("idDescription").getValue()};p.setNavigationTargetName(t)}function P(e,t){e.byId("idAssignedStepsLabel").setVisible(t);e.byId("idAssignedStepsCombo").setVisible(t)}function M(e,t,i){var a=p.createMessageObject({code:i});a.setPrevious(t);p.putMessage(a)}function E(){var e=g.getStepsAssignedToNavigationTarget(c.getId());var t,i;for(t=0;t<e.length;t++){i=g.getStep(e[t]);i.removeNavigationTarget(c.getId())}}sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){var e=this;p=e.getView().getViewData();l=p.oConfigurationHandler;g=p.oConfigurationEditor;d=l.getTextPool();s=p.getText;r=p.oParams;if(!g){l.loadConfiguration(r.arguments.configId,function(e){g=e})}m(e);u=new sap.apf.modeler.ui.utils.ViewValidator(e.getView());u.addFields(["idSemanticObjectField","idActionField"]);b(e);I(e);e.setDetailData()},onAfterRendering:function(){var e=this;if(e.getView().byId("idSemanticObjectField").getValue().length===0){e.getView().byId("idSemanticObjectField").focus()}},setDetailData:function(){var e=this;h(e).then(function(){N(e).then(function(t){A(t.semanticActions,e)})});T(e);x(e);C(e);var t=c.getUseDynamicParameters();if(t){this.getView().byId("idUseDynamicParametersCheckBox").setSelected(true)}else{this.getView().byId("idUseDynamicParametersCheckBox").setSelected(false)}},updateSubViewInstancesOnReset:function(e){var t=this;g=e;c=g.getNavigationTarget(c.getId());t.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.UPDATESUBVIEWINSTANCESONRESET,{oConfigurationEditor:g,oParentObject:c})},handleChangeSemanticObjectValue:function(e){var i,a=this;i=e.getParameter("value").trim();c.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){c.setSemanticObject(i);V(a).then(function(e){if(e.semanticActions.length>0){c.setAction(a.byId("idActionField").getModel().getData().Objects[0].id);a.byId("idActionField").setSelectedKey(e.semanticActions[0].id)}else{a.byId("idActionField").setValue("")}A(e.semanticActions,a);T(a);D(a);w(a);O(a)})}g.setIsUnsaved()},handleChangeofAction:function(e){var i,a=this;i=e.getParameter("value");c.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){c.setAction(i)}A(undefined,a);T(a);D(a);w(a);O(a);g.setIsUnsaved()},handleChangeForTitleText:function(){var e=this,t;var i=e.byId("idDescription").getValue();if(i.trim().length===0){t=undefined;c.setTitleKey(t);A(undefined,e);T(e);D(e);w(e);O(e);g.setIsUnsaved()}else{e.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(i,v).done(function(t){c.setTitleKey(t);T(e);e.byId("idDescription").setValue(i);D(e);w(e);O(e);g.setIsUnsaved()})}},handleSuggestions:function(e){var t=new sap.apf.modeler.ui.utils.SuggestionTextHandler(d);t.manageSuggestionTexts(e,v)},handleChangeOfNavigationTargetType:function(){var e=this;g.setIsUnsaved();var t=e.byId("idNavigationTargetTypeField").getSelectedKey();if(t===s("stepSpecific")){c.setStepSpecific();C(e)}else{c.setGlobal();P(e,false);e.byId("idAssignedStepsCombo").setSelectedKeys([]);E()}D(e,e.byId("idDescription").getValue())},handleChangeForAssignedSteps:function(){var e=this;g.setIsUnsaved();var t=e.byId("idAssignedStepsCombo").getSelectedKeys();var i=g.getStepsAssignedToNavigationTarget(c.getId());i.forEach(function(e){if(t.indexOf(e)===-1){var i=g.getStep(e);i.removeNavigationTarget(c.getId())}});t.forEach(function(e){if(i.indexOf(e)===-1){var t=g.getStep(e);t.addNavigationTarget(c.getId())}})},getValidationState:function(){var e=this;var t=true;e.byId("idNavigationParameterBox").getItems().forEach(function(e){if(!e.getController().validate()){t=false}});return u.getValidationState()&&e.byId("idContextMappingView").getController().getValidationState()&&t},getNavigationParameters:function(){return this.byId("idNavigationParameterBox").getItems()},addNavigationParameter:function(){y(this)},removeNavigationParameter:function(e){this.byId("idNavigationParameterBox").removeItem(e);S(this)},handleChangeForUseDynamicParameters:function(){var e=this.byId("idUseDynamicParametersCheckBox").getSelected();c.setUseDynamicParameters(e)},onExit:function(){var e=this;e.byId("idContextMappingView").destroy()},displayHelpAboutDynamicParameters:function(){var e=s("explanationOfDynamicParameters");var t=s("titleDynamicParameters");sap.m.MessageBox.show(e,{icon:sap.m.MessageBox.Icon.INFORMATION,title:t,actions:[sap.m.MessageBox.Action.CLOSE]})}})});
//# sourceMappingURL=navigationTarget.controller.js.map
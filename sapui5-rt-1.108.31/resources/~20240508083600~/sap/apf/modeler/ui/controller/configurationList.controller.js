/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/navigationHandler","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/APFTree","sap/ui/core/util/File","sap/ui/util/openWindow","sap/apf/cloudFoundry/uiHandler","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/ui/core/syncStyleClass"],function(e,t,i,a,o,n,s,jQuery,r,d){"use strict";sap.ui.controller("sap.apf.modeler.ui.controller.configurationList",{onInit:function(){var e=this.getOwnerComponent();if(e!==undefined){this.oCoreApi=e.oCoreApi;this._setDisplayText();this._setPublishVisible()}this._instantiateToolbarView();this._instantiateAPFTree();this._instantiateTitleAndBreadCrumbView();this._addConfigStyleClass();this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.bProgramaticSelection=false;if(this.oTreeInstance!==undefined){this.oTreeInstance.expandToLevel(1);this.oTreeInstance.collapseAll()}this.modelUpdateDeferred={};sap.apf.modeler.ui.utils.APFRouter.patternMatch(this)},_instantiateToolbarView:function(){var e=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.toolbar",type:"XML",viewData:{oConfigListInstance:this}});this.toolbarController=e.getController();this.byId("idConfigMasterData").insertItem(e,0)},_instantiateAPFTree:function(){this.oTreeInstance=this.byId("idConfigTree");this.oTreeInstance.setTranslationFunction(this.oCoreApi.getText);var e;if(this.oCoreApi.getRepresentationTypes()[0].metadata){e=this.oCoreApi.getRepresentationTypes()[0].id}this.oTreeInstance.setDefaultRepresentationType(e)},_instantiateTitleAndBreadCrumbView:function(){this.oTitleBreadCrumbView=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.titleBreadCrumb",type:"XML",viewData:{getText:this.oCoreApi.getText}});this.oTitleBreadCrumbController=this.oTitleBreadCrumbView.getController();this.byId("idConfigDetail").insertItem(this.oTitleBreadCrumbView,0);this.oBreadCrumb=this.oTitleBreadCrumbView.byId("IdBreadCrumb")},setConfigListMasterTitle:function(e){this.byId("idConfigTitleMaster").setText(this.oCoreApi.getText("configurationObjectTitle")+" : "+e)},onAfterRendering:function(){var e=this;this.oTreeInstance.onAfterRendering=function(){e._setHeightForScrollBar()}},_setHeightForScrollBar:function(){var e=this;var t=jQuery(window).height();t=t-165;e.byId("idMasterScroll").setHeight(t+"px");i.onResize(function(){t=jQuery(e.byId("configPage").getDomRef()).height();e.byId("idMasterScroll").setHeight(t+"px")})},_setDisplayText:function(){this.byId("configPage").setTitle(this.oCoreApi.getText("configModelerTitle"));this.byId("idSavebutton").setText(this.oCoreApi.getText("save"));this.byId("idCancelbutton").setText(this.oCoreApi.getText("cancel"));this.byId("idExportbutton").setText(this.oCoreApi.getText("export"));this.byId("idExecuteButton").setText(this.oCoreApi.getText("execute"));this.byId("idPublishbutton").setText(this.oCoreApi.getText("share"));this.byId("idAriaPropertyForBreadCrumb").setText(this.oCoreApi.getText("breadCrumbText"))},_setPublishVisible:function(){var e=this.oCoreApi.isUsingCloudFoundryProxy();this.byId("idPublishbutton").setVisible(e)},_addConfigStyleClass:function(){this.getView().addStyleClass("sapUiSizeCompact");this.byId("idConfigTree").addStyleClass("configTree");this.byId("idConfigTitleMaster").addStyleClass("configTitle");this.byId("idConfigMasterData").addStyleClass("configMasterData");this.byId("idConfigDetailData").addStyleClass("configDetailData")},_setSubViewContainerHeight:function(e){var t=this;var a=e.getContent()[0].getItems()[0];var o=jQuery(window).height();var n=jQuery(this.byId("idConfigTitleMaster").getDomRef()).outerHeight()+jQuery(this.byId("idConfigTitleMaster").getDomRef()).offset().top+25;var s=jQuery(this.byId("idConfigMasterData").getItems()[0].getDomRef()).height();var r=jQuery(this.byId("configPage").getDomRef()).find("header").height();var d=jQuery(this.byId("configPage").getDomRef()).find("footer").height();var l,g;if(s>0){l=n+s+r+d}else{l=265}var f=o-l-40+"px";a.setHeight(f);var c=jQuery(this.byId("idConfigDetailData").getDomRef()).width();if(c>0){g=jQuery(this.byId("idConfigMasterData").getDomRef()).offset().left}else{c=1015;g=15}var u=c-g;var p=u+"px";a.setWidth(p);i.onResize(function(){o=jQuery(t.byId("configPage").getDomRef()).height();f=o-l+"px";a.setHeight(f);c=jQuery(t.byId("idConfigDetailData").getDomRef()).width();u=c-g;p=u+"px";a.setWidth(p)})},_setSubView:function(e){this.oSubView=e},_getSubView:function(){return this.oSubView},updateSubView:function(e){var t=this;var i=this._getSubView();var a=this.byId("idConfigDetailData");var o=this.getSPathFromURL(e);this.configurationHandler.memorizeConfiguration(e.arguments.configId);if(i){i.destroy()}if(e.arguments.configId.indexOf("newConfig")===0){this.modelUpdateDeferred[this.byId("idConfigTree").getModel().getData().aConfigDetails.length-1]=new jQuery.Deferred}var n=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+o.objectType,type:"XML",viewData:{oParams:e,oCoreApi:t.oCoreApi,updateConfigTree:t.updateConfigTree.bind(t),updateSelectedNode:t.updateSelectedNode.bind(t),updateTitleAndBreadCrumb:t.updateTitleAndBreadCrumb.bind(t),updateTree:t.updateTree.bind(t),oConfigurationHandler:t.configurationHandler,oApplicationHandler:t.applicationHandler,oConfigurationEditor:t.configEditor,getText:t.oCoreApi.getText,getEntityTypeMetadataAsPromise:t.oCoreApi.getEntityTypeMetadataAsPromise,getRepresentationTypes:t.oCoreApi.getRepresentationTypes,oFooter:t.byId("idFooterBarMain"),createMessageObject:t.oCoreApi.createMessageObject,putMessage:t.oCoreApi.putMessage,getAllAvailableSemanticObjects:t.oCoreApi.getAllAvailableSemanticObjects,getSemanticActions:t.oCoreApi.getSemanticActions,getNavigationTargetName:t._getNavigationTargetName.bind(t),setNavigationTargetName:t._setNavigationTargetName.bind(t),getCalatogServiceUri:t.oCoreApi.getCatalogServiceUri,oTitleBreadCrumbController:t.oTitleBreadCrumbController}});if(e.name!=="applicationList"){a.removeAllContent();n.placeAt(a);this._setSubViewContainerHeight(n);this._setSubView(n)}},clearTitleAndBreadCrumb:function(){this.oTitleBreadCrumbView.byId("IdFormTitle").setText("");this.oTitleBreadCrumbView.byId("IdBreadCrumb").destroyContent()},_createLinkForBreadCrumb:function(e,t,i){var a=this;var o=new sap.m.Link({text:e,id:a.createId("linkId"+t),press:function(){a._navigateToNode(i)}});o.addAriaDescribedBy(a.byId("idAriaPropertyForBreadCrumb"));return o},_createTextForBreadCrumb:function(e,t){var i=this;var a=new sap.m.Label({id:i.createId("textId"+t)});a.addStyleClass("dialogText");a.setText(e);return a},_createIconForBreadCrumb:function(){var e=new sap.ui.core.Icon({src:"sap-icon://open-command-field"});e.addStyleClass("breadCrumbIcon");return e},_navigateToNode:function(e){var t=this.oTreeInstance.getItemNodeByContext(e);this.oTreeInstance.setSelectedItem(t);this._onTreeNodeSelection()},_getAllPossibleNodes:function(e){var t=[];if(e.configId){t.push({id:e.configId,name:e.configurationName,oParams:{arguments:{configId:e.configId}}})}if(e.facetFilterId){t.push({id:e.facetFilterId,name:e.facetFilterName,oParams:{arguments:{configId:e.configId,facetFilterId:e.facetFilterId}}})}if(e.smartFilterId){t.push({id:e.smartFilterId,name:e.smartFilterName,oParams:{arguments:{configId:e.configId,smartFilterId:e.smartFilterId}}})}if(e.categoryId){t.push({id:e.categoryId,name:e.categoryName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId}}})}if(e.stepId){t.push({id:e.stepId,name:e.stepName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId,stepId:e.stepId}}})}if(e.representationId){t.push({id:e.representationId,name:e.representationName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId,stepId:e.stepId,representationId:e.representationId}}})}if(e.navTargetId){t.push({id:e.navTargetId,name:e.navTargetName,oParams:{arguments:{configId:e.configId,navTargetId:e.navTargetId}}})}return t},_breadCrumbCreation:function(e,t){for(var i=0;i<e.length;i++){var a=this.getSPathFromURL(e[i].oParams).sPath;var o;if(i===1){o=this._createTextForBreadCrumb(t,i);this.oBreadCrumb.addContent(o);var n=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(n)}if(i!==e.length-1){var s=this._createLinkForBreadCrumb(e[i].name,i,a);this.oBreadCrumb.addContent(s);var r=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(r)}if(i===e.length-1){o=this._createTextForBreadCrumb(e[i].name,++i);this.oBreadCrumb.addContent(o)}}},updateTitleAndBreadCrumb:function(e){var t;var i;var a=this.oTreeInstance.getSelectedItems();if(a&&a.length>0){i=a[0]}var o=i?this.oTreeInstance.getAPFTreeNodeContext(i):undefined;var n=o?o.nodeObjectType:undefined;var s=o?this.oTreeInstance.getParentNodeContext(o):undefined;if(e){t=e}else{if(n){var r=i.getTitle();t=this.oCoreApi.getText(n)+": "+r;if(n===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR){t=r}}}if(s){if(this.oBreadCrumb){this.oBreadCrumb.destroyContent()}var d=this._getAllPossibleNodes(s);var l;switch(n){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:this._breadCrumbCreation(d);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR:case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:l=this.oCoreApi.getText("facetFilter");this._breadCrumbCreation(d,l);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:l=this.oCoreApi.getText("navigationTarget");this._breadCrumbCreation(d,l);break;default:break}}if(n!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){this.oTitleBreadCrumbController.setTitleForDetailPage(t)}},setSelectionOnTree:function(e){if(e.objectType==="smartFilterBar"){this.toolbarController.disableCopyDeleteButton()}else{this.toolbarController.enableCopyDeleteButton()}this._enableDisableExportAndExecuteButton(true);this.oTreeInstance.setSelectionOnTree(e.sPath)},removeSelectionOnTree:function(){this.oTreeInstance.removeSelectionOnTree(this.selectedNode)},updateConfigTree:function(e){var t,i,a,o,n,s,r,d,l;var g=this;e.forEach(function(e){var f;t=g.getSPathFromURL(e.oldContext).sPath;a=t.split("/");o=a[2];n=a[6];r=a[8];d=jQuery.extend(true,{},g.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[r]);l=d.id;d.isSelected=false;i=g.getSPathFromURL(e.newContext).sPath;s=i.split("/")[6];if(e.removeStep===undefined){if(g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps){g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps.forEach(function(e){if(e.id===l){f=true}});if(f===undefined){g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps.push(d)}}else{g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps=[];g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps.push(d)}}else if(e.removeStep===true){if(g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps){g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps.forEach(function(e,t){if(e.id===l){var i=g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps;i.splice(t,1);g.oModel.getData().aConfigDetails[o].configData[1].categories[s].steps=i}});if(e.changeCategory===true){var c=g.getSPathFromURL(e.categoryChangeContext).sPath;var u=c.split("/");o=u[2];var p=u[6];var T=u[8];g.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[T].isSelected=true;g.oModel.getData().aConfigDetails[o].configData[1].categories[p].expanded=true}}}});this.oModel.updateBindings();var f=e.length;if(e[f-1].changeCategory){sap.ui.core.UIComponent.getRouterFor(this).navTo(e[f-1].oldContext.name,e[f-1].categoryChangeContext.arguments,true)}this.configEditor.setIsUnsaved()},updateSelectedNode:function(e,t){if(e){if(this.oTreeInstance.getSelectedItems()){this.selectedNode=this.oTreeInstance.getSelectedItem()}if(this.selectedNode){if(e.name&&this.selectedNode._getBindingContext()&&this.selectedNode._getBindingContext().getObject()){this.selectedNode.getBindingContext().getObject().name=e.name;this.selectedNode.getBindingContext().getObject().isSelected=true;if(this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION||this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){this.selectedNode.getBindingContext().getObject().icon=e.icon}this.oModel.updateBindings()}if(e.id&&this.selectedNode.getBindingContext().getObject().id){this.selectedNode.getBindingContext().getObject().id=e.id;if(e.icon){this.selectedNode.getBindingContext().getObject().icon=e.icon}this.oModel.updateBindings()}else if(e.id&&this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration){this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration=e.id;this.selectedNode.getBindingContext().getObject().expanded=true}}if(this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION&&t){sap.ui.core.UIComponent.getRouterFor(this).navTo(this.selectedNode.getBindingContext().getObject().type,t,true);this.updateTree()}}},createConfigList:function(){var e=this;this.configList=this.configurationHandler.getList();this.configList.forEach(function(t,i){var a={};a.AnalyticalConfiguration=t.AnalyticalConfiguration;a.name=t.AnalyticalConfigurationName;a.Application=t.Application;a.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;a.bIsLoaded=false;a.bToggleState=false;a.isSelected=false;a.expanded=false;a.selectable=true;a.hasExpander=true;e.oModel.getData().aConfigDetails.push(a);e.modelUpdateDeferred[i]=new jQuery.Deferred});this.oModel.updateBindings()},showNoConfigSelectedText:function(){this.byId("idConfigDetailData").removeAllContent();this.clearTitleAndBreadCrumb();var e=(new sap.m.Label).addStyleClass("noConfigSelected");e.setText(this.oCoreApi.getText("noConfigSelected"));e.placeAt(this.byId("idConfigDetailData"));this.toolbarController.disableCopyDeleteButton();this._enableDisableExportAndExecuteButton(false);this.byId("idConfigDetail").setBusy(false)},updateConfigListView:function(){this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode===null||this.selectedNode===undefined||this.selectedNode.length==0){if(this.configList.length>1){this.showNoConfigSelectedText()}else{this.oModel.getData().aConfigDetails[0].isSelected=true;this.oModel.getData().aConfigDetails[0].expanded=true;this.configId=this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration;this.oModel.updateBindings();var e={appId:this.appId,configId:this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration};this.selectedNode=this.oTreeInstance.getItems()[0];this.oTreeInstance.expand(0);this.toolbarController.enableCopyDeleteButton();this._enableDisableExportAndExecuteButton(true);sap.ui.core.UIComponent.getRouterFor(this).navTo(this.oModel.getData().aConfigDetails[0].type,e,true)}}},_getNodeData:function(e,t){var i=this.oModel.getData().aConfigDetails;var a={};var o=function(e){var t={};var a=e||this.configId;for(var o=0;o<i.length;o++){if(i[o].AnalyticalConfiguration===a){t.index=o;t.data=i[o];t.id=i[o].AnalyticalConfiguration;break}}return t};var n=function(t){var a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var n={};for(var s=0;s<i[a].configData.length;s++){if(i[a].configData[s].filters instanceof Array){n.indexConfigData=s;for(var r=0;r<i[a].configData[s].filters.length;r++){if(i[a].configData[s].filters[r].id===t){n.index=r;n.data=i[a].configData[s].filters[r];n.id=i[a].configData[s].filters[r].id;n.filterNodeExpansion=i[a].configData[s].expanded}}}}return n};var s=function(t){var a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var n={};for(var s=0;s<i[a].configData.length;s++){if(i[a].configData[s].categories instanceof Array){n.indexConfigData=s;for(var r=0;r<i[a].configData[s].categories.length;r++){if(i[a].configData[s].categories[r].id===t){n.index=r;n.data=i[a].configData[s].categories[r];n.id=i[a].configData[s].categories[r].id;n.categoryExpansion=i[a].configData[s].expanded}}}}return n};var r=function(t){var a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var n=s.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var r=s.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var d={};for(var l=0;l<i[a].configData[n].categories[r].steps.length;l++){if(i[a].configData[n].categories[r].steps[l].id===t){d.index=l;d.data=i[a].configData[n].categories[r].steps[l];d.id=i[a].configData[n].categories[r].steps[l].id}}return d};var d=function(t){var a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var n=s.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var d=s.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var l=r.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]).index;var g={};if(i[a].configData[n].categories[d].steps[l]){for(var f=0;f<i[a].configData[n].categories[d].steps[l].representations.length;f++){if(i[a].configData[n].categories[d].steps[l].representations[f].id===t){g.index=f;g.data=i[a].configData[n].categories[d].steps[l].representations[f];g.id=i[a].configData[n].categories[d].steps[l].representations[f].id}}}return g};var l=function(t){var a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var n={};for(var s=0;s<i[a].configData.length;s++){if(i[a].configData[s].navTargets instanceof Array){n.indexConfigData=s;for(var r=0;r<i[a].configData[s].navTargets.length;r++){if(i[a].configData[s].navTargets[r].id===t){n.index=r;n.data=i[a].configData[s].navTargets[r];n.id=i[a].configData[s].navTargets[r].id;n.nTExpansion=i[a].configData[s].expanded}}}}return n};switch(t){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:a=o.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:a=n.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR:a=n.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:a=s.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:a=r.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:a=d.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:a=l.call(this,e[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]);break;default:break}return a},_retainNodeState:function(e,t){var i=this._getNodeData(e,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;if(!this.oModel.getData().aConfigDetails[i].bIsLoaded){return{}}var a=this._getNodeData(e,t);if(!a.data){return{}}return{expanded:a.data.expanded,isSelected:a.data.isSelected}},updateTree:function(){var e=this;var t=[],i=[],a=[],o={},n=[],s=[],r=[],d=[],l,g;this.oTextPool=this.configurationHandler.getTextPool();var f={};f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=this.configId;var c=e._getNodeData(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;var u=this.configId;var p=false;var T=false;var C=false;var h=Object.keys(this.configEditor.getFilterOption())[0];t=this.configEditor.getCategories();function D(){if(e.oModel.getData().aConfigDetails[c].bIsLoaded){g=e._getNodeData(f,h)}l=e._retainNodeState(f,h)}function I(t,i){var o=e.oCoreApi.getText("smartFilterBar");if(h===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){o=e.oTextPool.get(i.getLabelKey())?e.oTextPool.get(i.getLabelKey()).TextElementDescription:i.getLabelKey()}f[h]=i.getId();D();a.push({id:i.getId(),name:o,type:h,isSelected:l.isSelected||false,expanded:l.expanded||false,selectable:true,icon:t})}if(h===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR){o=this.configEditor.getSmartFilterBar();I("sap-icon://filter",o)}else if(h===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){i=this.configEditor.getFacetFilters();i.forEach(function(e){var t=e.isVisible()?"sap-icon://filter":"sap-icon://hide";I(t,e)})}if(g&&g.filterNodeExpansion){p=true}n=this.configEditor.getNavigationTargets();var v=this.oCoreApi.getRepresentationTypes();var b={};v.forEach(function(e){var t=e.id;b[t]=e.picture});t.forEach(function(t){f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=t.getId();var i=t;var a=i.getId();d=[];e.configEditor.getCategoryStepAssignments(a).forEach(function(t){var i=e.configEditor.getStep(t);f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=a;f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=i.getId();var o=e._retainNodeState(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP);var n=i.getRepresentations();var s=n.map(function(t){f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=t.getId();var i=e._retainNodeState(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION);return{id:t.getId(),name:e.oCoreApi.getText(t.getRepresentationType()),type:"representation",isSelected:i.isSelected||false,expanded:i.expanded||false,selectable:true,icon:b[t.getRepresentationType()]}});d.push({id:i.getId(),name:e.oTextPool.get(i.getTitleId())?e.oTextPool.get(i.getTitleId()).TextElementDescription:i.getTitleId(),type:"step",representations:s,isSelected:o.isSelected||false,expanded:o.expanded||false,selectable:true,icon:i.getType()==="hierarchicalStep"?"sap-icon://drill-down":"sap-icon://step"})});var o=e._retainNodeState(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(e.oModel.getData().aConfigDetails[c].bIsLoaded){var n=e._getNodeData(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(n.categoryExpansion){C=true}}s.push({id:t.getId(),name:e.oTextPool.get(t.labelKey)?e.oTextPool.get(t.labelKey).TextElementDescription:t.labelKey,type:"category",steps:d,isSelected:o.isSelected||false,expanded:o.expanded||false,selectable:true,icon:"sap-icon://open-folder"})});r.push({filters:a,name:e.oCoreApi.getText("facetFilters"),expanded:p,selectable:false});r.push({categories:s,name:e.oCoreApi.getText("categories"),expanded:C,selectable:false});var N=[];var S=function(t,i){f[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=i.getId();var a=e._retainNodeState(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(e.oModel.getData().aConfigDetails[c].bIsLoaded){var o=e._getNodeData(f,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(o.nTExpansion){T=true}}var n,s;for(n=0;n<t.length;n++){if(t[n].id===i.getAction()){s=t[n].text;break}}if(i.getTitleKey()){s=e.configurationHandler.getTextPool().get(i.getTitleKey()).TextElementDescription}N.push({id:i.getId(),name:s||i.getSemanticObject(),type:"navigationTarget",isSelected:a.isSelected||false,expanded:a.expanded||false,selectable:true,icon:i.isStepSpecific()?"sap-icon://pushpin-off":"sap-icon://overview-chart"})};var m=function(){var e=n.map(function(e){return e.getId()});var t=[];for(var i=0;i<e.length;i++){for(var a=0;a<N.length;a++){if(e[i]===N[a].id){t[i]=N[a];break}}}N=t};var y=function(){var t={};t.configData=r;e.oModel.getData().aConfigDetails[c].bIsLoaded=true;var i=e.oModel.getData().aConfigDetails[c];jQuery.extend(i,t);e.oModel.getData().aConfigDetails[c]=i;e.oModel.getData().aConfigDetails[c].name=e.configurationHandler.getConfiguration(u).AnalyticalConfigurationName;for(var a=0;a<e.oModel.getData().aConfigDetails.length;a++){if(e.modelUpdateDeferred[a]&&e.modelUpdateDeferred[a].state()==="pending"&&n.length===0){e.modelUpdateDeferred[a].resolve(e.oModel.getData())}}if(i.configData[2].navTargets.length>0){e._setNavigationTargetName({configIndexInTree:c});e.modelUpdateDeferred[c].resolve(e.oModel.getData())}e.oModel.updateBindings()};n.forEach(function(t){var i=e.oCoreApi.getSemanticActions(t.getSemanticObject());i.then(function(i){S(i.semanticActions,t);if(N.length===n.length){m();if(r[2]){r.splice(2,2);r.push({navTargets:N,name:e.oCoreApi.getText("navigationTargets"),expanded:T,selectable:false});y();var a=sap.apf.modeler.ui.utils.APFRouter.params;if(a.name==="navigationTarget"){sap.apf.modeler.ui.utils.APFRouter.setCurrentSelectionState(a,e)}}}})});r.push({navTargets:N,name:e.oCoreApi.getText("navigationTargets"),expanded:T,selectable:false});y()},_checkIfKeyExists:function(e,t){var i;if(this.navTargetTextsTable[t]){this.navTargetTextsTable[t].texts.forEach(function(t,a){if(t.key===e){i=a}})}return i},_getNavigationTargetName:function(e){var t=this;var i;var a=new jQuery.Deferred;var o=t.getSPathForConfig(t.configId).split("/")[2];if(this.modelUpdateDeferred[o]===undefined){this.modelUpdateDeferred[o]=new jQuery.Deferred;this.modelUpdateDeferred[o].resolve(this.oModel.getData())}jQuery.when(this.modelUpdateDeferred[o]).done(function(n){var s=t._checkIfKeyExists(e,o);if(s!==undefined){i=t.navTargetTextsTable[o].texts[s].value;a.resolve(i)}});return a.promise()},_setNavigationTargetName:function(e){var t=e.configIndexInTree!==undefined?e.configIndexInTree:this.getSPathForConfig(this.configId).split("/")[2];if(r(this.navTargetTextsTable)){this.navTargetTextsTable={}}if(!this.navTargetTextsTable[t]){this.navTargetTextsTable[t]={texts:[]}}if(e.key&&e.value){var i=this._checkIfKeyExists(e.key,t);if(i===undefined){var a={};a.key=e.key;a.value=e.value;this.navTargetTextsTable[t].texts.push(a)}else{this.navTargetTextsTable[t].texts[i].value=e.value}}else{var o=this.oModel.getData().aConfigDetails[t].configData[2].navTargets;for(var n=0;n<o.length;n++){var s={};s.key=o[n].id;s.value=o[n].name;this.navTargetTextsTable[e.configIndexInTree].texts.push(s)}}},_handleToggleTreeNode:function(e){var t=this;var i=e.getSource().getSelectedItems();if(i&&i.length>0){var a=i[0]._getBindingContext().sPath;var o=i[0]._getBindingContext().getObject().type;if(o===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){var n=a.split("/")[2];if(t.oModel.getData().aConfigDetails[n].bIsLoaded===true){this.oModel.updateBindings()}else{this.configurationHandler.loadConfiguration(this.oModel.getData().aConfigDetails[n].AnalyticalConfiguration,function(e,i){if(i===undefined){t.configEditor=e;t.configId=t.oModel.getData().aConfigDetails[n].AnalyticalConfiguration;t.updateTree()}})}}}},getSPathForConfig:function(e){var t;this.oModel.getData().aConfigDetails.forEach(function(i,a){if(i.AnalyticalConfiguration===e){t="/aConfigDetails/"+a}});return t},getSPathFromURL:function(e){var t={sPath:undefined,objectType:undefined};var i=this;this.oModel.getData().aConfigDetails.forEach(function(a,o){if(a.AnalyticalConfiguration===e.arguments.configId){t.sPath="/aConfigDetails/"+o;t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;i.oModel.getData().aConfigDetails[o].expanded=true;if(e.arguments.categoryId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories.forEach(function(a,n){if(a.id===e.arguments.categoryId){t.sPath=t.sPath.concat("/configData/1/categories/"+n);t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY;i.oModel.getData().aConfigDetails[o].configData[1].expanded=true;if(e.arguments.stepId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps.forEach(function(a,s){if(a.id===e.arguments.stepId){t.sPath=t.sPath.concat("/steps/"+s);t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;i.oModel.getData().aConfigDetails[o].configData[1].categories[n].expanded=true;if(e.arguments.representationId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[s].representations.forEach(function(a,r){if(a.id===e.arguments.representationId){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[s].expanded=true;t.sPath=t.sPath.concat("/representations/"+r);t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION}})}}})}}})}if(e.arguments.facetFilterId!==undefined){i.oModel.getData().aConfigDetails[o].configData[0].filters.forEach(function(a,n){if(a.id===e.arguments.facetFilterId){t.sPath=t.sPath.concat("/configData/0/filters/"+n);t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER;i.oModel.getData().aConfigDetails[o].configData[0].expanded=true}})}if(e.arguments.smartFilterId!==undefined){t.sPath=t.sPath.concat("/configData/0/filters/0");t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR;i.oModel.getData().aConfigDetails[o].configData[0].expanded=true}if(e.arguments.navTargetId!==undefined){i.oModel.getData().aConfigDetails[o].configData[2].navTargets.forEach(function(a,n){if(a.id===e.arguments.navTargetId){t.sPath=t.sPath.concat("/configData/2/navTargets/"+n);t.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET;i.oModel.getData().aConfigDetails[o].configData[2].expanded=true}})}}});return t},_navHandleExpandDelete:function(e,t,i){var a=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var o=this.oModel.getData().aConfigDetails;var n=i||this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);var s=function(e){var t;for(var i=0;i<o.length;i++){if(o[i].AnalyticalConfiguration===e){t=i;break}}return t};var r=function(e){var i=s.call(this,t.configId);var a,n;for(var r=0;r<o[i].configData.length;r++){if(o[i].configData[r].filters instanceof Array){a=r;for(var d=0;d<o[i].configData[r].filters.length;d++){if(o[i].configData[r].filters[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexFilter:n}};var d=function(e){var i=s.call(this,t.configId);var a,n;for(var r=0;r<o[i].configData.length;r++){if(o[i].configData[r].navTargets instanceof Array){a=r;for(var d=0;d<o[i].configData[r].navTargets.length;d++){if(o[i].configData[r].navTargets[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexNavTarget:n}};var l=function(e){var i=s.call(this,t.configId);var a,n;for(var r=0;r<o[i].configData.length;r++){if(o[i].configData[r].categories instanceof Array){a=r;for(var d=0;d<o[i].configData[r].categories.length;d++){if(o[i].configData[r].categories[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexCategory:n}};var g=function(e){var i=s.call(this,t.configId);var a=l.call(this,t.categoryId).indexConfig;var n=l.call(this,t.categoryId).indexCategory;var r;for(var d=0;d<o[i].configData[a].categories[n].steps.length;d++){if(o[i].configData[a].categories[n].steps[d].id===e){r=d;break}else{r=d}}return r};if(t.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0&&n){this.configurationHandler.removeConfiguration(t.configId,function(e){var i=a.oModel.getData().aConfigDetails;var o=s.call(a,t.configId);a._deleteConfigNavTargetTexts(o,i.length);i.splice(o,1);a.oModel.getData().aConfigDetails=i})}else{var f,c,u,p,T,C;switch(e.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:f=s.call(this,t.configId);this.oModel.getData().aConfigDetails[f].isSelected=true;this.oModel.getData().aConfigDetails[f].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:f=s.call(this,t.configId);c=r.call(this,t.facetFilterId).indexConfig;u=r.call(this,t.facetFilterId).indexFilter;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].filters[u].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:f=s.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;p=l.call(this,t.categoryId).indexCategory;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:f=s.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;p=l.call(this,t.categoryId).indexCategory;T=g.call(this,t.stepId);this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[p].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:f=s.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;p=l.call(this,t.categoryId).indexCategory;T=g.call(this,t.stepId);this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[p].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[p].steps[T].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:f=s.call(this,t.configId);c=d.call(this,t.navTargetId).indexConfig;C=d.call(this,t.navTargetId).indexNavTarget;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].navTargets[C].expanded=true;break;default:break}}this.oModel.updateBindings()},_isNewSubView:function(e){var t=false;if(e.arguments.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){t=true}else{if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){t=this.configurationHandler.getConfiguration(e.arguments.configId)!==undefined?false:true}else if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY){t=this.configEditor.getCategory(e.arguments.categoryId)!==undefined?false:true}else if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){t=this.configEditor.getFacetFilter(e.arguments.facetFilterId)!==undefined?false:true}else if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){t=this.configEditor.getStep(e.arguments.stepId)!==undefined?false:true}else if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION){t=this.configEditor.getStep(e.arguments.stepId).getRepresentation(e.arguments.representationId)!==undefined?false:true}else if(e.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){t=this.configEditor.getNavigationTarget(e.arguments.navTargetId)!==undefined?false:true}}return t},_getCurrentConfigurationNode:function(){var e=this.oTreeInstance.getItems();var t=this.configId;for(var i=0;i<e.length;i++){if(t===e[i]._getBindingContext().getObject().AnalyticalConfiguration){return e[i]}}return undefined},_navMandatoryResetState:function(e,t){var i=e;e.selectedNode=e.oTreeInstance.getSelectedItem();i.bIsSaved=i.configEditor?i.configEditor.isSaved():undefined;var a=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;e.configurationHandler.memorizeConfiguration(a.getView().getViewData().oParams.arguments.configId);var o=this._isNewSubView(a.getView().getViewData().oParams);if(!o){i.updateTree();var n=i.selectedNode._getBindingContext().getObject();if(n){n.isSelected=true;var s=a.getView().getViewData().oParams.name;var r=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes;if(s!==r.REPRESENTATION){a.updateSubViewInstancesOnReset(i.configEditor)}else{a.oConfigurationEditor=i.configEditor}a.setDetailData.call(a);i.updateTitleAndBreadCrumb()}else{i.oTreeInstance.setSelectedItem(i._getCurrentConfigurationNode())}if(typeof t==="function"){t()}}else{i.handleConfirmDeletion()}return{bIsSaved:i.bIsSaved,isNewView:o}},_navSaveState:function(e){e()},_navConfigResetState:function(e,t){var i=e;var a=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;var o=this._isNewSubView(a.getView().getViewData().oParams);if(!o){i.configurationHandler.loadConfiguration(i.configId,function(e,a){if(a===undefined){var o=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;i.configEditor=e;i.updateTree();var n=i.selectedNode._getBindingContext().getObject();if(n){n.isSelected=true;var s=o.getView().getViewData().oParams.name;var r=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes;if(s!==r.REPRESENTATION){o.updateSubViewInstancesOnReset(i.configEditor)}else{o.oConfigurationEditor=i.configEditor}o.setDetailData.call(o);i.updateTitleAndBreadCrumb()}else{i.oTreeInstance.setSelectedItem(i._getCurrentConfigurationNode())}if(typeof t==="function"){t()}}})}else{i.handleConfirmDeletion()}},_onTreeNodeSelection:function(e){this.selectedNode=this.oTreeInstance.getSelectedItem();var i=this;var a,o,n;if(!this.bProgramaticSelection){this.oPreviousSelectedNode=this.oTreeInstance.previousSelectedItem;this.bIsDifferntConfig=this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);this._enableDisableExportAndExecuteButton(true);var s;if(this.byId("idConfigDetailData").getContent().length>=1){s=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var r=this.selectedNode?this.selectedNode.getId():null;var d=this.oPreviousSelectedNode?this.oPreviousSelectedNode.getId():null;var l=function(){if(i.oPreviousSelectedNode){var e=i.selectedNode.getBindingContext().getObject();e.isSelected=false;i.oModel.updateBindings()}};if(r!==d||this.bNavDeletionMode){var g=t.getInstance();var f;if(s!==undefined){f=typeof s.getValidationState==="function"?s.getValidationState.call(s):true}else{f=true}var c=this.configEditor?jQuery.extend(true,{},this.configEditor):undefined;this.bIsSaved=c?c.isSaved():undefined;var u;var p=false;var T=this.configurationHandler.getList();if(!f&&T.length>0){g.throwMandatoryPopup(this,{yes:function(){var e=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;var t=i._isNewSubView(e.getView().getViewData().oParams);if(!t){var a=function(e){i.configEditor=i.configurationHandler.restoreMemorizedConfiguration(i.oParentNodeDetails.configId);if(i.bIsSaved===false&&i.configEditor){i.configEditor.setIsUnsaved()}if(typeof e==="function"){e()}i.updateTree();var t=i.selectedNode.getBindingContext().getObject();i.navigateToDifferntView(i.oParentNodeDetails,i.oSelectedNodeDetails);t.isSelected=true;i.oModel.updateBindings()};if(i.bIsSaved===false&&i.bIsDifferntConfig){u(false,function(){a.call(i)})}else{a.call(i)}}else{if(i.bIsSaved===false&&i.bIsDifferntConfig){u(false,function(){var e=i.selectedNode.getBindingContext().sPath;var t=i.oPreviousSelectedNode;i.handleConfirmDeletion(t,e)})}else{var o=i.selectedNode.getBindingContext().sPath;var n=i.oPreviousSelectedNode;i.handleConfirmDeletion(n,o)}}i._navHandleExpandDelete.call(i,i.oSelectedNodeDetails,i.oParentNodeDetails)},no:function(){l()}});p=true}u=function(e){if(s){i.configurationHandler.memorizeConfiguration(s.getView().getViewData().oParams.arguments.configId)}g.throwLossOfDataPopup(i,{yes:function(t){if(typeof e==="function"){e(function(){t(function(){var e;if(i.oPreviousSelectedNode){var t=i.oPreviousSelectedNode._getBindingContext().sPath;var a=t.split("/");e=a[2]}i.oModel.getData().aConfigDetails[e].AnalyticalConfiguration=i.configId})})}else{if(i.oPreviousSelectedNode){a=i.oTreeInstance.getAPFTreeNodeContext(i.oPreviousSelectedNode);o=i.oTreeInstance.getParentNodeContext(a);n=i.configurationHandler.restoreMemorizedConfiguration(o.configId);if(n){i.configEditor=n}}t(function(){var e;if(i.oPreviousSelectedNode){var t=i.oPreviousSelectedNode._getBindingContext().sPath;var a=t.split("/");e=a[2]}i.oModel.getData().aConfigDetails[e].AnalyticalConfiguration=i.configId;var o=i.selectedNode._getBindingContext().getObject();i.navigateToDifferntView(i.oParentNodeDetails,i.oSelectedNodeDetails);o.isSelected=true;i.oModel.updateBindings()})}},no:function(){i.configurationHandler.loadConfiguration(i.configId,function(e,t){if(t===undefined){i.configEditor=e;if(i.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){i._navHandleExpandDelete.call(i,{},{configId:i.configId},i.oParentNodeDetails)}else{i.updateTree()}i.navigateToDifferntView(i.oParentNodeDetails,i.oSelectedNodeDetails);i._navHandleExpandDelete.call(i,i.oSelectedNodeDetails,i.oParentNodeDetails)}})},cancel:function(){l()}})};if(i.bIsSaved===false&&i.bIsDifferntConfig&&f){u();p=true}if(!p){if(this.oPreviousSelectedNode&&this.oPreviousSelectedNode.getId()!==this.selectedNode.getId()){var C=this.oPreviousSelectedNode.getBindingContext().getObject();if(C){this.oPreviousSelectedNode.getBindingContext().getObject().isSelected=false}}else{this.selectedNode.getBindingContext().getObject().isSelected=true}this.navigateToDifferntView(this.oParentNodeDetails,this.oSelectedNodeDetails,this.bIsSaved,this.bIsDifferntConfig)}this.oTreeInstance.previousSelectedItem=this.oTreeInstance.getSelectedItem()}}this.bProgramaticSelection=false;this.bNavDeletionMode=false},navigateToDifferntView:function(e,t,i,a){if(!r(e)&&(i===undefined||i)||!a){sap.ui.core.UIComponent.getRouterFor(this).navTo(t.nodeObjectType,e,true)}},_deleteConfigNavTargetTexts:function(e,t){var i=this;var a;for(var o=e;o<t-1;o++){this.modelUpdateDeferred[o]=this.modelUpdateDeferred[o+1]}delete this.modelUpdateDeferred[t-1];if(this.navTargetTextsTable){if(this.navTargetTextsTable[e]){delete this.navTargetTextsTable[e]}if(e!==t-1){Object.keys(this.navTargetTextsTable).forEach(function(t){t=parseInt(t,10);if(t>e){i.navTargetTextsTable[t-1]=i.navTargetTextsTable[t];a=t}});if(a!==undefined){delete this.navTargetTextsTable[a]}}}},handleConfirmDeletion:function(e,t){var i=e===undefined||typeof e.preventDefault==="function"?this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()):this.oTreeInstance.getAPFTreeNodeContext(e);var a=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var o,n,s,r,d,l,g,f,c,u;d=i.nodeContext;r=d.split("/");l=r[2];switch(i.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:this.configEditor.removeFacetFilter(i.nodeAPFId);g=r[6];var p=this.oModel.getData().aConfigDetails[l].configData[0].filters;p.splice(g,1);this.oModel.getData().aConfigDetails[l].configData[0].filters=p;s=r.slice(0,3);n=s.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:this.configEditor.removeCategory(i.nodeAPFId);f=r[6];var T=this.oModel.getData().aConfigDetails[l].configData[1].categories;T.splice(f,1);this.oModel.getData().aConfigDetails[l].configData[1].categories=T;s=r.slice(0,3);n=s.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:this.configEditor.removeNavigationTarget(i.nodeAPFId);c=r[6];var C=this.oModel.getData().aConfigDetails[l].configData[2].navTargets;C.splice(c,1);this.oModel.getData().aConfigDetails[l].configData[2].navTargets=C;s=r.slice(0,3);n=s.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var h=this.configEditor.getCategoriesForStep(i.nodeAPFId);var D=i.nodeContext.split("/");l=D[2];h.forEach(function(e){a.configEditor.removeCategoryStepAssignment(e,i.nodeAPFId);a.oModel.getData().aConfigDetails[l].configData[1].categories.forEach(function(t,o){if(t.id===e){a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps.forEach(function(e,t){if(e.id===i.nodeAPFId){var n=a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps;n.splice(t,1);a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps=n}})}})});s=r.slice(0,7);n=s.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:f=r[6];u=r[8];var I=this.oModel.getData().aConfigDetails[l].configData[1].categories[f].steps[u].id;var v=this.configEditor.getStep(I);var b=this.configEditor.getCategoriesForStep(I);v.removeRepresentation(i.nodeAPFId);b.forEach(function(e){a.oModel.getData().aConfigDetails[l].configData[1].categories.forEach(function(t,o){if(t.id===e){a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps.forEach(function(e,t){if(e.id===I){a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps[t].representations.forEach(function(e,n){if(e.id===i.nodeAPFId){var s=a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps[t].representations;s.splice(n,1);a.oModel.getData().aConfigDetails[l].configData[1].categories[o].steps[t].representations=s}})}})}})});s=r.slice(0,9);n=s.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var N=false;if(i.nodeAPFId.indexOf("newConfig")===0){N=true}if(!N){this.configurationHandler.removeConfiguration(i.nodeAPFId,function(e){var i;var o=a.oModel.getData().aConfigDetails;a._deleteConfigNavTargetTexts(parseInt(l,10),o.length);var n=a.configurationHandler.getList().length>0?true:false;o.splice(l,1);a.oModel.getData().aConfigDetails=o;a.oModel.updateBindings();if(t){var s=a.oTreeInstance.getParentNodeContext(a.oTreeInstance.getAPFTreeNodeContext(a.selectedNode));sap.ui.core.UIComponent.getRouterFor(a).navTo(a.selectedNode._getBindingContext().getObject().type,s,true)}else{a.clearTitleAndBreadCrumb();a.byId("idConfigDetailData").removeAllContent();if(n){i=(new sap.m.Label).addStyleClass("noConfigSelected");i.setText(a.oCoreApi.getText("noConfigSelected"));i.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}else{i=(new sap.m.Label).addStyleClass("addNewConfig");i.setText(a.oCoreApi.getText("addNewConfig"));i.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}}})}else{var S;var m=a.oModel.getData().aConfigDetails;m.splice(l,1);a.oModel.getData().aConfigDetails=m;a.oModel.updateBindings();if(t){var y=a.oTreeInstance.getParentNodeContext(a.oTreeInstance.getAPFTreeNodeContext(a.selectedNode));sap.ui.core.UIComponent.getRouterFor(a).navTo(a.selectedNode._getBindingContext().getObject().type,y,true)}else{a.clearTitleAndBreadCrumb();a.byId("idConfigDetailData").removeAllContent();var x=this.configurationHandler.getList().length>0?true:false;if(x){S=(new sap.m.Label).addStyleClass("noConfigSelected");S.setText(a.oCoreApi.getText("noConfigSelected"));S.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}else{S=(new sap.m.Label).addStyleClass("addNewConfig");S.setText(a.oCoreApi.getText("addNewConfig"));S.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}}}break;default:break}if(t){this.bNavDeletionMode=true}if(i.nodeObjectType!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){this.configEditor.setIsUnsaved();this.clearTitleAndBreadCrumb();this.byId("idConfigDetailData").removeAllContent();n=t||n;o=this.oTreeInstance.getModel().getContext(n);this.oModel.updateBindings();this.selectedNode=this.oTreeInstance.getItemNodeByContextWithoutExpand(o.sPath);this.bProgramaticSelection=false;this.oTreeInstance.setSelectedItem(this.selectedNode);if(t){this.selectedNode.getBindingContext().getObject().isSelected=true;this.oModel.updateBindings()}}var A=this.toolbarController.confirmationDialog===undefined?false:this.toolbarController.confirmationDialog.isOpen;if(A&&!t){this.toolbarController.confirmationDialog.close()}},handleNavBack:function(){var e;var i=this;if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}this.selectedNode=this.oTreeInstance.getSelectedItem();this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);var a=t.getInstance();var o;if(e!==undefined){o=typeof e.getValidationState==="function"?e.getValidationState.call(e):true}else{o=true}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var n=i.configurationHandler.getList().length>0?true:false;var s=function(e){if(this.selectedNode){this.selectedNode=null}this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.configEditor=undefined;this.navTargetTextsTable={};window.history.go(-1)};if(n){var r=i.bIsSaved===undefined?true:i.bIsSaved;if(!o){a.throwMandatoryPopup(i,{yes:function(){i.configEditor=i.configurationHandler.restoreMemorizedConfiguration(e.getView().getViewData().oParams.arguments.configId);if(i.bIsSaved===false&&i.configEditor){i.configEditor.setIsUnsaved()}var t=i._navMandatoryResetState(i);var o=i.configurationHandler.getList();if(t.bIsSaved===false&&o.length>0){a.throwLossOfDataPopup(i,{yes:function(e){e();s.call(i)},no:function(){if(i.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){i._navHandleExpandDelete.call(i,{},{configId:i.configId},i.oParentNodeDetails)}s.call(i)}})}else{s.call(i)}}});return}else if(!r&&o){a.throwLossOfDataPopup(i,{yes:function(e){e();s.call(i)},no:function(){i.configurationHandler.resetConfiguration(i.configId);if(i.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){i._navHandleExpandDelete.call(i,{},{configId:i.configId},i.oParentNodeDetails)}s.call(i)}});return}}s.call(i)},handleSavePress:function(){var e,i;var a=this;this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode){var o=this.selectedNode[0].getBindingContext().sPath;var n=o.split("/");i=n[2]}if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var s=function(){var t=this;var a;t.configEditor.save(function(o,n,s){if(s===undefined){t.configurationHandler.memorizeConfiguration(e.getView().getViewData().oParams.arguments.configId);t.oModel.getData().aConfigDetails[i].AnalyticalConfiguration=o;t.oModel.updateBindings();t.oSelectedNodeDetails=t.oTreeInstance.getAPFTreeNodeContext(t.selectedNode[0]);t.oParentNodeDetails=t.oTreeInstance.getParentNodeContext(t.oSelectedNodeDetails);t.navigateToDifferntView(t.oParentNodeDetails,t.oSelectedNodeDetails,true,false);a=t.oCoreApi.createMessageObject({code:"11513"});t.oCoreApi.putMessage(a)}else{a=t.oCoreApi.createMessageObject({code:"11514"});t.oCoreApi.putMessage(a)}})};var r=t.getInstance();var d;if(e!==undefined){d=typeof e.getValidationState==="function"?e.getValidationState.call(e):true}else{d=true}var l=this.configEditor?jQuery.extend(true,{},this.configEditor):undefined;this.bIsSaved=l?l.isSaved():undefined;var g=false;if(!d){r.throwMandatoryPopup(a,{yes:function(){a.configEditor=a.configurationHandler.restoreMemorizedConfiguration(e.getView().getViewData().oParams.arguments.configId);if(a.bIsSaved===false&&a.configEditor){a.configEditor.setIsUnsaved()}a._navMandatoryResetState(a);s.call(a)}});g=true}if(!g){s.call(this);this.toolbarController.closeDialog()}},_handleExportButtonPress:function(){var e;if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var t=function(){if(!this.exportConfigurationDialog){this.exportConfigurationDialog=sap.ui.xmlfragment("idExportConfigurationFragment","sap.apf.modeler.ui.fragment.exportConfiguration",this);this.getView().addDependent(this.exportConfigurationDialog);this._setExportConfigDialogText();this._addStyleClassForExportDialog();this.configurationHandler.memorizeConfiguration(e.getView().getViewData().oParams.arguments.configId)}d("sapUiSizeCompact",this.getView(),this.exportConfigurationDialog);this.exportConfigurationDialog.open()};this._performExportOrExecute(t.bind(this))},handlePublishPress:function(){if(this.oCoreApi.isUsingCloudFoundryProxy()){s.showShareDialog(this.oCoreApi,this)}},_enableDisableExportAndExecuteButton:function(e){this.byId("idExportbutton").setEnabled(e);this.byId("idExecuteButton").setEnabled(e);this.byId("idPublishbutton").setEnabled(e)},_setExportConfigDialogText:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idExportConfigDialog").setTitle(this.oCoreApi.getText("exportConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadConfig").setText(this.oCoreApi.getText("downloadConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadTextProperty").setText(this.oCoreApi.getText("downloadTextProperty"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idCloseButton").setText(this.oCoreApi.getText("close"))},_addStyleClassForExportDialog:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadConfig").addStyleClass("configLink");sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadTextProperty").addStyleClass("textPropertyLink")},_handleCloseOfExportDialog:function(){if(this.exportConfigurationDialog.isOpen()){this.exportConfigurationDialog.close()}},_handleOpenConfigLinkPress:function(){this.configurationHandler.exportConfiguration(this.configId,function(e,t){o.save(e,t,"json","application/json","utf-8")})},_handleOpenTextsLinkPress:function(){var e=this.configurationHandler.getConfiguration(this.configId).AnalyticalConfigurationName;var t=this.configurationHandler.exportTexts(this.configId);o.save(t,e,"properties","text/plain","utf-8")},_performExportOrExecute:function(e){var i,a,o,n,s,r,d,l;var g=false;var f=true;var c=this;c.selectedNode=c.oTreeInstance.getSelectedItem();c.oSelectedNodeDetails=c.oTreeInstance.getAPFTreeNodeContext(c.selectedNode);c.oParentNodeDetails=c.oTreeInstance.getParentNodeContext(c.oSelectedNodeDetails);var u=t.getInstance();if(this.byId("idConfigDetailData").getContent().length>=1){i=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}if(i!==undefined){f=typeof i.getValidationState==="function"?i.getValidationState.call(i):true}var p=this.configEditor?jQuery.extend(true,{},this.configEditor):undefined;this.bIsSaved=p?p.isSaved():undefined;var T=function(e){c.byId("idConfigDetailData").removeAllContent();if(e){d=(new sap.m.Label).addStyleClass("noConfigSelected");d.setText(c.oCoreApi.getText("noConfigSelected"))}else{d=(new sap.m.Label).addStyleClass("addNewConfig");d.setText(c.oCoreApi.getText("addNewConfig"))}d.placeAt(c.byId("idConfigDetailData"));c.toolbarController.disableCopyDeleteButton();c._enableDisableExportAndExecuteButton(false)};if(!f){u.throwMandatoryPopup(c,{yes:function(){c.configEditor=c.configurationHandler.restoreMemorizedConfiguration(i.getView().getViewData().oParams.arguments.configId);if(c.bIsSaved===false&&c.configEditor){c.configEditor.setIsUnsaved()}o=c._navMandatoryResetState(c);n=c.configurationHandler.getList().length>0?true:false;if(n){if(o.bIsSaved===false){a()}else{if(c.oParentNodeDetails.configId.indexOf("newConfig")!==0){e()}}}else{T(n)}}});g=true}a=function(){u.throwLossOfDataPopup(c,{yes:function(t){c._navSaveState(function(){t(function(t){if(c.selectedNode){s=c.selectedNode._getBindingContext().sPath;l=s.split("/");r=l[2]}c.oModel.getData().aConfigDetails[r].AnalyticalConfiguration=c.configId;c.oModel.updateBindings();e()})})},no:function(){if(c.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){c._navHandleExpandDelete.call(c,{},{configId:c.configId},c.oParentNodeDetails);c.clearTitleAndBreadCrumb();c.byId("idConfigDetailData").removeAllContent();n=c.configurationHandler.getList().length>0?true:false;T(n)}else{c._navConfigResetState(c,function(){c._navHandleExpandDelete.call(c,c.oSelectedNodeDetails,c.oParentNodeDetails);e()})}}})};if(c.bIsSaved===false&&f){a();g=true}if(!g){e()}},handleExecuteButtonPress:function(){var e=this.oTreeInstance.getSelectedItem();var t=function(){var t=this.oTreeInstance.getAPFTreeNodeContext(e);var i=this.oTreeInstance.getParentNodeContext(t);this.oCoreApi.navigateToGenericRuntime(i.appId,i.configId,n);this.configurationHandler.memorizeConfiguration(i.configId)};this._performExportOrExecute(t.bind(this))},getStepConfigDataBysPath:function(e){var t=e.split("/");var i=t[2],a=t[4],o=t[6],n=t[8];var s=this.oModel.getData().aConfigDetails[i].configData[a].categories[o].steps[n];return s}})});
//# sourceMappingURL=configurationList.controller.js.map
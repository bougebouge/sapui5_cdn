/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.configurationObjects");(function(){"use strict";sap.apf.modeler.core.ConfigurationObjects=function(e){var t=this;var i,r,a,n;var s=e.instances.metadataFactory;if(e.constructors&&e.constructors.Hashtable){i=e.constructors.Hashtable}if(e.instances.textPool){r=e.instances.textPool}if(e.instances.persistenceProxy){a=e.instances.persistenceProxy}if(e.instances.messageHandler){n=e.instances.messageHandler}function o(e,t){var i=[];if(t){i.push(t)}n.putMessage(n.createMessageObject({code:e,aParameters:i}))}function l(e){var t=e&&e.type&&e.type==="label"&&e.kind&&e.kind==="text"&&e.key&&typeof e.key==="string";if(!t){o(11030,e.key)}return t}this.serializeLabelKey=function(e){return{type:"label",kind:"text",key:r.getPersistentKey(e)}};this.serializeAndAddThumbnail=function(e,t){var i=e.getLeftLowerCornerTextKey();var r=e.getLeftUpperCornerTextKey();var a=e.getRightUpperCornerTextKey();var n=e.getRightLowerCornerTextKey();var s={type:"thumbnail"};if(r){s.leftUpper=this.serializeLabelKey(r)}if(i){s.leftLower=this.serializeLabelKey(i)}if(a){s.rightUpper=this.serializeLabelKey(a)}if(n){s.rightLower=this.serializeLabelKey(n)}if(s.leftLower||s.leftUpper||s.rightLower||s.rightUpper){t.thumbnail=s}};this.serializeCategory=function(e,i){var a=r.get(e.labelKey);var n=[];if(i){i.forEach(function(e){n.push({type:"step",id:e})})}var s=a&&a.TextElementDescription||"";return{type:"category",description:s,id:e.getId(),label:t.serializeLabelKey(e.labelKey),steps:n}};this.validateCategory=function(e){var t=e&&e.type&&e.type==="category"&&e.id&&e.steps&&l(e.label);if(t){e.steps.forEach(function(e){if(!e.type||e.type!=="step"||!e.id){t=false}})}if(!t){o(11031,e.id)}return t};this.validateRequest=function(e){var t=e&&e.id&&e.type==="request"&&e.service&&typeof e.service==="string"&&(e.entityType&&typeof e.entityType==="string"||e.entitySet&&typeof e.entitySet==="string")&&e.selectProperties&&e.selectProperties&&e.selectProperties instanceof Array&&e.selectProperties.length>=0;if(!t){o(11032,e.id)}return t};this.validateBinding=function(e){var t=e&&e.id&&e.type==="binding"&&e.requiredFilters&&e.requiredFilters instanceof Array&&e.requiredFilters.length>=0&&e.representations&&e.representations instanceof Array;if(!t){o(11033,e.id)}return t};this.validateFacetFilter=function(e){var t=e&&e.id&&e.property&&e.type==="facetFilter";if(!t){o(11034,e.id)}return t};this.validateNavigationTarget=function(e){var t=e&&e.id&&e.semanticObject&&e.action&&e.type==="navigationTarget"&&e.hasOwnProperty("isStepSpecific");if(!t){o(11040,e.id)}return t};this.validateStep=function(e){var t=e&&e.id&&e.type==="step"&&l(e.title)&&l(e.longTitle)&&e.hasOwnProperty("navigationTargets");if(!t){o(11035,e.id)}return t};this.validateConfiguration=function(e){var t=e&&e.applicationTitle&&e.applicationTitle.key&&typeof e.applicationTitle.key==="string"&&e.steps&&e.steps instanceof Array&&e.steps.length>=0&&e.requests&&e.requests instanceof Array&&e.requests.length>=0&&e.bindings&&e.bindings instanceof Array&&e.bindings.length>=0&&e.representationTypes&&e.representationTypes instanceof Array&&e.representationTypes.length>=0&&e.categories&&e.categories instanceof Array&&e.categories.length>=0;if(!t){o(11036)}return t};function p(e){var i=[];var r,a;var n,s;var o;var l;var p;var c;var f=e.getRepresentations();f.forEach(function(e){r=[];a=e.getDimensions();a.forEach(function(t){var i={fieldName:t};if(e.getDimensionKind(t)){i.kind=e.getDimensionKind(t)}if(e.getDimensionTextLabelKey(t)){i.fieldDesc={type:"label",kind:"text",key:e.getDimensionTextLabelKey(t)}}if(e.getLabelDisplayOption(t)){i.labelDisplayOption=e.getLabelDisplayOption(t)}r.push(i)});n=[];s=e.getMeasures();s.forEach(function(t){var i={fieldName:t};if(e.getMeasureKind(t)){i.kind=e.getMeasureKind(t)}if(e.getMeasureTextLabelKey(t)){i.fieldDesc={type:"label",kind:"text",key:e.getMeasureTextLabelKey(t)}}if(e.getMeasureDisplayOption(t)){i.measureDisplayOption=e.getMeasureDisplayOption(t)}n.push(i)});o=[];e.getProperties().forEach(function(t){var i={fieldName:t};if(e.getPropertyKind(t)){i.kind=e.getPropertyKind(t)}if(e.getPropertyTextLabelKey(t)){i.fieldDesc={type:"label",kind:"text",key:e.getPropertyTextLabelKey(t)}}o.push(i)});var f=[{}];if(e.getHierarchyProperty()){f[0].fieldName=e.getHierarchyProperty();f[0].kind="hierarchicalColumn";if(e.getHierarchyPropertyTextLabelKey()){f[0].fieldDesc={type:"label",kind:"text",key:e.getHierarchyPropertyTextLabelKey()}}f[0].labelDisplayOption=e.getHierarchyPropertyLabelDisplayOption()}l=[];e.getOrderbySpecifications().forEach(function(e){l.push({property:e.property,ascending:e.ascending})});p={id:e.getId(),representationTypeId:e.getRepresentationType(),parameter:{dimensions:r,measures:n,properties:o,hierarchicalProperty:f,alternateRepresentationTypeId:e.getAlternateRepresentationType()}};if(e.getWidthProperties()){p.parameter.width=e.getWidthProperties()}if(l.length>0){p.parameter.orderby=l}c=e.getTopN();if(c&&c>0){p.parameter.top=c}t.serializeAndAddThumbnail(e,p);i.push(p)});return i}this.serializeBinding=function(e,t){var i="binding-for-"+e.getId();var a=r.get(e.getTitleId());var n=a&&a.TextElementDescription||"";if(e.getFilterPropertyLabelKey()||e.getFilterPropertyLabelDisplayOption()){var s={labelDisplayOption:e.getFilterPropertyLabelDisplayOption()};if(e.getFilterPropertyLabelKey()){s.fieldDesc=this.serializeLabelKey(e.getFilterPropertyLabelKey())}}t.bindings.push({type:"binding",id:i,stepDescription:n,requiredFilters:e.getFilterProperties(),requiredFilterOptions:s,representations:p(e)});return i};this.serializeRequest=function(e,t){var i;var r="request-for-"+e.getId();i={type:"request",id:r,service:e.getService(),entitySet:e.getEntitySet(),selectProperties:e.getSelectProperties()};t.requests.push(i);return r};this.serializeFilterMappingRequest=function(e,t){var i="request-for-FilterMapping"+e.getId();var r={type:"request",id:i,service:e.getFilterMappingService(),entitySet:e.getFilterMappingEntitySet(),selectProperties:e.getFilterMappingTargetProperties()};t.requests.push(r);return i};this.serializeStep=function(e,i){var a=t.serializeRequest(e,i);var n=t.serializeBinding(e,i);var s=r.get(e.getTitleId());var o=s&&s.TextElementDescription||"";var l=e.getLongTitleId();var p;var c={type:e.getType(),description:o,request:a,binding:n,id:e.getId(),title:t.serializeLabelKey(e.getTitleId()),navigationTargets:[]};if(e.getHierarchyProperty&&e.getHierarchyProperty()){c.hierarchyProperty=e.getHierarchyProperty()}if(e.getFilterMappingService()){c.filterMapping={requestForMappedFilter:t.serializeFilterMappingRequest(e,i),target:e.getFilterMappingTargetProperties(),targetPropertyLabelKey:e.getFilterMappingTargetPropertyLabelKey(),targetPropertyDisplayOption:e.getFilterMappingTargetPropertyLabelDisplayOption(),keepSource:e.getFilterMappingKeepSource()?"true":"false"}}p=e.getTopN();if(p){c.topNSettings=p}if(l!==""&&l!==undefined){c.longTitle=t.serializeLabelKey(e.getLongTitleId())}this.serializeAndAddThumbnail(e,c);e.getNavigationTargets().forEach(function(e){c.navigationTargets.push({type:"navigationTarget",id:e})});return c};this.serializeFacetFilter=function(e,i){var a,n,s;if(e.getServiceOfFilterResolution()){a=p("FilterResolution",e,i)}if(e.getUseSameRequestForValueHelpAndFilterResolution()){n=a}else if(e.getServiceOfValueHelp()){n=p("ValueHelp",e,i)}var o=r.get(e.getLabelKey());var l=o&&o.TextElementDescription||"";if(e.getValueList().length>0){s=e.getValueList()}return{type:"facetFilter",description:l,id:e.getId(),alias:e.getAlias(),property:e.getProperty(),multiSelection:e.isMultiSelection()+"",preselectionFunction:e.getPreselectionFunction(),preselectionDefaults:c(),valueList:s,label:t.serializeLabelKey(e.getLabelKey()),invisible:!e.isVisible(),filterResolutionRequest:a,valueHelpRequest:n,hasAutomaticSelection:e.getAutomaticSelection()+"",useSameRequestForValueHelpAndFilterResolution:e.getUseSameRequestForValueHelpAndFilterResolution()+""};function p(e,t,i){var r;var a;var n;var s;switch(e){case"ValueHelp":a=t.getServiceOfValueHelp();n=t.getEntitySetOfValueHelp();s=t.getSelectPropertiesOfValueHelp();break;case"FilterResolution":a=t.getServiceOfFilterResolution();n=t.getEntitySetOfFilterResolution();s=t.getSelectPropertiesOfFilterResolution();break;default:a="";n="";s="";break}var o=e+"-request-for-"+t.getId();r={type:"request",id:o,service:a,entitySet:n,selectProperties:s};i.requests.push(r);return o}function c(){if(e.getNoneSelection()===true){return null}return e.getPreselectionDefaults()}};this.serializeNavigationTarget=function(e,i){var r={type:"navigationTarget",id:e.getId(),semanticObject:e.getSemanticObject(),action:e.getAction(),isStepSpecific:e.isStepSpecific(),useDynamicParameters:e.getUseDynamicParameters(),parameters:e.getAllNavigationParameters()};if(e.getFilterMappingService()){r.filterMapping={requestForMappedFilter:t.serializeFilterMappingRequest(e,i),target:e.getFilterMappingTargetProperties()}}if(e.getTitleKey()){r.title={key:e.getTitleKey(),type:"label",kind:"text"}}return r};this.serializeSmartFilterBar=function(e){if(e){if(!e.isEntityTypeConverted()){return{id:e.getId(),type:"smartFilterBar",service:e.getService(),entityType:e.getEntitySet()}}return{id:e.getId(),type:"smartFilterBar",service:e.getService(),entitySet:e.getEntitySet()}}};this.serializeConfiguration=function(e){var i={analyticalConfigurationName:e.getConfigurationName(),applicationTitle:t.serializeLabelKey(e.getApplicationTitle()),steps:[],requests:[],bindings:[],representationTypes:[],categories:[],navigationTargets:[]};var r={requests:i.requests,bindings:i.bindings};e.getCategories().forEach(function(r){var a=e.getCategoryStepAssignments(r.getId());i.categories.push(t.serializeCategory(r,a))});e.getSteps().forEach(function(e){var a=t.serializeStep(e,r);i.steps.push(a)});e.getFacetFilters().forEach(function(e){var a=t.serializeFacetFilter(e,r);if(i.facetFilters===undefined){i.facetFilters=[]}i.facetFilters.push(a)});if(e.getFilterOption().facetFilter===true&&i.facetFilters===undefined){i.facetFilters=[]}e.getNavigationTargets().forEach(function(e){var a=t.serializeNavigationTarget(e,r);i.navigationTargets.push(a)});var a=this.serializeSmartFilterBar(e.getSmartFilterBar());if(a!==undefined){i.smartFilterBar=a}return i};function c(e,t){var i=e.thumbnail;if(!i){return}if(i.leftLower){t.setLeftLowerCornerTextKey(i.leftLower.key)}if(i.leftUpper){t.setLeftUpperCornerTextKey(i.leftUpper.key)}if(i.rightLower){t.setRightLowerCornerTextKey(i.rightLower.key)}if(i.rightUpper){t.setRightUpperCornerTextKey(i.rightUpper.key)}}function f(e,t,i){var r=[];var a;var n;if(e.type==="hierarchicalStep"){a=i.createHierarchicalStepWithId(e.id);n=i.getStep(a);n.setHierarchyProperty(e.hierarchyProperty)}else{a=i.createStepWithId(e.id);n=i.getStep(a)}var s=t.getItem(e.request);if(s.entityType){s.entitySet=s.entityType;delete s.entityType}if(s.service){r.push(i.registerServiceAsPromise(s.service))}n.setService(s.service);n.setEntitySet(s.entitySet);n.setTitleId(e.title.key);if(e.longTitle&&e.longTitle.key){n.setLongTitleId(e.longTitle.key)}if(e.navigationTargets){e.navigationTargets.forEach(function(e){n.addNavigationTarget(e.id)})}c(e,n);s.selectProperties.forEach(function(e){n.addSelectProperty(e)});var o=t.getItem(e.binding);o.requiredFilters.forEach(function(e){n.addFilterProperty(e)});if(o.requiredFilterOptions){n.setFilterPropertyLabelDisplayOption(o.requiredFilterOptions.labelDisplayOption);if(o.requiredFilterOptions.fieldDesc){n.setFilterPropertyLabelKey(o.requiredFilterOptions.fieldDesc.key)}}o.representations.forEach(function(e){var t;var i=n.getRepresentation(n.createRepresentation({id:e&&e.id}).getId());i.setRepresentationType(e.representationTypeId);i.setAlternateRepresentationType(e.parameter.alternateRepresentationTypeId);if(e.parameter.hierarchicalProperty&&e.parameter.hierarchicalProperty[0]&&e.parameter.hierarchicalProperty[0].fieldDesc){i.setHierarchyPropertyTextLabelKey(e.parameter.hierarchicalProperty[0].fieldDesc.key)}if(e.parameter.hierarchicalProperty&&e.parameter.hierarchicalProperty[0]){i.setHierarchyPropertyLabelDisplayOption(e.parameter.hierarchicalProperty[0].labelDisplayOption)}e.parameter.dimensions.forEach(function(e){i.addDimension(e.fieldName);if(e.fieldDesc){i.setDimensionTextLabelKey(e.fieldName,e.fieldDesc.key)}if(e.kind){i.setDimensionKind(e.fieldName,e.kind)}if(e.labelDisplayOption){i.setLabelDisplayOption(e.fieldName,e.labelDisplayOption)}});e.parameter.measures.forEach(function(e){i.addMeasure(e.fieldName);if(e.fieldDesc){i.setMeasureTextLabelKey(e.fieldName,e.fieldDesc.key)}if(e.kind){i.setMeasureKind(e.fieldName,e.kind)}if(e.measureDisplayOption){i.setMeasureDisplayOption(e.fieldName,e.measureDisplayOption)}});if(e.parameter.properties){e.parameter.properties.forEach(function(e){i.addProperty(e.fieldName);if(e.fieldDesc){i.setPropertyTextLabelKey(e.fieldName,e.fieldDesc.key)}if(e.kind){i.setPropertyKind(e.fieldName,e.kind)}})}if(e.parameter.width){for(t in e.parameter.width){if(e.parameter.width.hasOwnProperty(t)){i.setWidthProperty(t,e.parameter.width[t])}}}if(e.parameter.orderby&&!e.parameter.topN){e.parameter.orderby.forEach(function(e){i.addOrderbySpec(e.property,e.ascending)})}c(e,i)});if(e.filterMapping){r.push(g(e.filterMapping,n,t,i))}if(e.topNSettings){n.setTopN(e.topNSettings.top,e.topNSettings.orderby)}return Promise.all(r)}function y(e,t,i){var r=[];var a=i.createFacetFilterWithId(e.id);var n=i.getFacetFilter(a);n.setLabelKey(e.label.key);n.setAlias(e.alias);n.setProperty(e.property);if(e.preselectionFunction&&e.preselectionFunction!==""){n.setPreselectionFunction(e.preselectionFunction)}else if(e.preselectionDefaults===null){n.setNoneSelection(true)}else{n.setPreselectionDefaults(e.preselectionDefaults)}if(e.valueList){n.setValueList(e.valueList)}if(e.useSameRequestForValueHelpAndFilterResolution&&e.useSameRequestForValueHelpAndFilterResolution==="true"){n.setUseSameRequestForValueHelpAndFilterResolution(true)}else{n.setUseSameRequestForValueHelpAndFilterResolution(false)}if(e.multiSelection==="true"){n.setMultiSelection(true)}if(e.invisible===true){n.setInvisible()}if(e.hasAutomaticSelection==="true"){n.setAutomaticSelection(true)}else{n.setAutomaticSelection(false)}if(e.valueHelpRequest){var s=t.getItem(e.valueHelpRequest);if(s.entityType){s.entitySet=s.entityType;delete s.entityType}if(s.service){r.push(i.registerServiceAsPromise(s.service));n.setServiceOfValueHelp(s.service)}if(s.entitySet){n.setEntitySetOfValueHelp(s.entitySet)}s.selectProperties.forEach(function(e){n.addSelectPropertyOfValueHelp(e)})}if(e.filterResolutionRequest){var o=t.getItem(e.filterResolutionRequest);if(o.entityType){o.entitySet=o.entityType;delete o.entityType}if(o.service){r.push(i.registerServiceAsPromise(o.service));n.setServiceOfFilterResolution(o.service)}if(o.entitySet){n.setEntitySetOfFilterResolution(o.entitySet)}o.selectProperties.forEach(function(e){n.addSelectPropertyOfFilterResolution(e)})}return Promise.all(r)}function u(e,t,i){return new Promise(function(r,a){var n=i.createNavigationTargetWithId(e.id);var s=i.getNavigationTarget(n);s.setSemanticObject(e.semanticObject);s.setAction(e.action);if(e.parameters){e.parameters.forEach(function(e){s.addNavigationParameter(e.key,e.value)})}if(e.isStepSpecific===true){s.setStepSpecific()}else{s.setGlobal()}if(e.useDynamicParameters===true){s.setUseDynamicParameters(true)}if(e.filterMapping){g(e.filterMapping,s,t,i).then(function(){r()})}else{r()}if(e.title&&e.title.key){s.setTitleKey(e.title.key)}})}function g(e,t,i,r){return new Promise(function(a,n){var s=i.getItem(e.requestForMappedFilter);if(s.entityType){s.entitySet=s.entityType;delete s.entityType}if(s.service){r.registerServiceAsPromise(s.service).done(function(){a()})}else{a()}t.setFilterMappingService(s.service);t.setFilterMappingEntitySet(s.entitySet);e.target.forEach(function(e){t.addFilterMappingTargetProperty(e)});if(e.targetPropertyLabelKey){t.setFilterMappingTargetPropertyLabelKey(e.targetPropertyLabelKey)}if(e.targetPropertyDisplayOption){t.setFilterMappingTargetPropertyLabelDisplayOption(e.targetPropertyDisplayOption)}if(e.hasOwnProperty("keepSource")){if(e.keepSource==="true"){t.setFilterMappingKeepSource(true)}else{t.setFilterMappingKeepSource(false)}}})}function d(e,t){var i=[];i.unshift(new Promise(function(r){var a=e.getItem("SmartFilterBar-1");if(a){t.setFilterOption({smartFilterBar:true});var n=t.getSmartFilterBar();n.setService(a.service);if(a.service){i.push(t.registerServiceAsPromise(a.service))}if(a.entitySet){n.setEntitySet(a.entitySet);r(true)}else if(a.entityType){s.getMetadata(a.service).done(function(e){if(e){var t=e.getEntitySetByEntityType(a.entityType);if(t){n.setEntitySet(t)}else{n.setEntitySet(a.entityType,true);o("11524",[a.entityType])}}r(true)}).fail(function(){n.setEntitySet(a.entityType,true);o("11524",[a.entityType]);r(true)})}else{r(true)}}else{r(false)}}));return Promise.all(i)}this.mapToDesignTimeAsPromise=function(e,t){var i;var r=false;var a=[];t.setApplicationTitle(e.getItem("applicationTitle").key);e.getSteps().forEach(function(i){a.push(f(i,e,t))});e.getCategories().forEach(function(e){t.createCategoryWithId({labelKey:e.label.key},e.id);e.steps.forEach(function(i){t.addCategoryStepAssignment(e.id,i.id)})});i=e.getFacetFilters();if(i.emptyArray===true){r=true;t.setFilterOption({facetFilter:true})}else{i.forEach(function(i){r=true;t.setFilterOption({facetFilter:true});a.push(y(i,e,t))})}e.getNavigationTargets().forEach(function(i){a.push(u(i,e,t))});a.push(new Promise(function(i){d(e,t).then(function(e){var a=e[0];if(!r&&!a){t.setFilterOption({none:true})}i()})}));return Promise.all(a)};this.loadAllConfigurations=function(e,t){var i=new sap.apf.core.utils.Filter(n,"Application","eq",e);a.readCollection("configuration",function(e,i,r){t(e,i,r)},undefined,["AnalyticalConfiguration","SerializedAnalyticalConfiguration"],i)};this.getTextKeysFromAllConfigurations=function(e,t){this.loadAllConfigurations(e,function(e,r,a){var s=new i(n);if(a){t(undefined,a);return}e.forEach(function(e){var t=JSON.parse(e.SerializedAnalyticalConfiguration);var i=sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(t);i.forEach(function(e){s.setItem(e,e)})});t(s,undefined)})}};sap.apf.modeler.core.ConfigurationObjects.deepDataCopy=function e(t){var i;if(!t){i=t}else if(t.copy&&typeof t.copy==="function"){i=t.copy()}else if(t&&typeof t==="object"){if(t instanceof Array){i=[];t.forEach(function(t){i.push(e(t))})}else{i={};for(var r in t){if(!t.hasOwnProperty(r)){continue}i[r]=e(t[r])}}}else{i=t}return i};sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration=function e(t){var i=[];if(!t){return undefined}if(t.type==="label"&&t.kind==="text"&&t.key){return[t.key]}for(var r in t){if(typeof t[r]!=="object"||!t.hasOwnProperty(r)){continue}Array.prototype.push.apply(i,e(t[r]))}return i}})();
//# sourceMappingURL=configurationObjects.js.map
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/datajs","sap/apf/utils/hashtable","sap/apf/core/constants","sap/apf/core/messageHandler","sap/apf/core/sessionHandler","sap/apf/core/representationTypes","sap/apf/core/entityTypeMetadata","sap/apf/core/configurationFactory","sap/apf/core/utils/uriGenerator","sap/apf/core/metadata","sap/apf/core/metadataFacade","sap/apf/core/metadataProperty","sap/apf/core/messageDefinition","sap/apf/core/metadataFactory","sap/apf/core/odataProxy","sap/apf/cloudFoundry/modelerProxy","sap/apf/cloudFoundry/ajaxHandler","sap/apf/utils/proxyTextHandlerForLocalTexts","sap/apf/core/ajax","sap/apf/core/odataRequest","sap/apf/modeler/core/messageDefinition","sap/apf/modeler/core/textHandler","sap/apf/modeler/core/textPool","sap/apf/modeler/core/applicationHandler","sap/apf/modeler/core/configurationHandler","sap/apf/modeler/core/configurationEditor","sap/apf/modeler/core/step","sap/apf/modeler/core/hierarchicalStep","sap/apf/modeler/core/smartFilterBar","sap/apf/modeler/core/facetFilter","sap/apf/modeler/core/navigationTarget","sap/apf/modeler/core/elementContainer","sap/apf/modeler/core/representation","sap/apf/modeler/core/configurationObjects","sap/apf/utils/parseTextPropertyFile","sap/apf/modeler/core/lazyLoader","sap/apf/modeler/core/registryWrapper","sap/apf/utils/startParameter","sap/apf/core/utils/fileExists","sap/apf/core/utils/annotationHandler","sap/ui/thirdparty/jquery"],function(e,t,a,n,r,o,i,s,c,u,f,p,l,d,g,m,y,v,h,C,x,A,H,F,T,S,M,b,P,j,O,E,L,R,w,N,U,D,I,G,jQuery){"use strict";sap.apf.modeler.core.Instance=function(e,t){var a=this;var n,r,o,i,s,c,u,f,p,l,d,g,m,y,v,h,C,x,A,H,F,T,S,M,b,P,j,O,E,L,R,w,N,U,D,I,G,q,V,k,B,z;var W=[];var K;var J;n=t&&t.constructors&&t.constructors.ApplicationHandler||sap.apf.modeler.core.ApplicationHandler;o=t&&t.constructors&&t.constructors.ConfigurationHandler||sap.apf.modeler.core.ConfigurationHandler;i=t&&t.constructors&&t.constructors.ConfigurationEditor||sap.apf.modeler.core.ConfigurationEditor;s=t&&t.constructors&&t.constructors.ConfigurationObjects||sap.apf.modeler.core.ConfigurationObjects;c=t&&t.constructors&&t.constructors.ConfigurationFactory||sap.apf.core.ConfigurationFactory;m=t&&t.constructors&&t.constructors.ElementContainer||sap.apf.modeler.core.ElementContainer;u=t&&t.constructors&&t.constructors.Step||sap.apf.modeler.core.Step;f=t&&t.constructors&&t.constructors.HierarchicalStep||sap.apf.modeler.core.HierarchicalStep;p=t&&t.constructors&&t.constructors.SmartFilterBar||sap.apf.modeler.core.SmartFilterBar;l=t&&t.constructors&&t.constructors.FacetFilter||sap.apf.modeler.core.FacetFilter;d=t&&t.constructors&&t.constructors.NavigationTarget||sap.apf.modeler.core.NavigationTarget;g=t&&t.constructors&&t.constructors.Representation||sap.apf.modeler.core.Representation;v=t&&t.constructors&&t.constructors.Hashtable||sap.apf.utils.Hashtable;h=t&&t.constructors&&t.constructors.RegistryProbe||sap.apf.modeler.core.RegistryWrapper;T=t&&t.constructors&&t.constructors.LazyLoader||sap.apf.modeler.core.LazyLoader;C=t&&t.constructors&&t.constructors.Metadata||sap.apf.core.Metadata;x=t&&t.constructors&&t.constructors.EntityTypeMetadata||sap.apf.core.EntityTypeMetadata;A=t&&t.constructors&&t.constructors.MetadataFacade||sap.apf.core.MetadataFacade;H=t&&t.constructors&&t.constructors.MetadataProperty||sap.apf.core.MetadataProperty;F=t&&t.constructors&&t.constructors.MetadataFactory||sap.apf.core.MetadataFactory;S=t&&t.constructors&&t.constructors.StartParameter||sap.apf.utils.StartParameter;M=t&&t.constructors&&t.constructors.AnnotationHandler||sap.apf.core.utils.AnnotationHandler;y=t&&t.constructors&&t.constructors.FileExists||sap.apf.core.utils.FileExists;b=t&&t.constructors&&t.constructors.ProxyTextHandlerForLocalTexts||sap.apf.utils.ProxyTextHandlerForLocalTexts;r=t&&t.constructors&&t.constructors.AjaxHandler||sap.apf.cloudFoundry.AjaxHandler;J=t&&t.instances&&t.instances.datajs||OData;if(t&&t.constructors&&t.constructors.TextHandler){P=new t.constructors.TextHandler}else{P=new sap.apf.modeler.core.TextHandler}if(t&&t.constructors&&t.constructors.MessageHandler){j=new t.constructors.MessageHandler(true)}else{j=new sap.apf.core.MessageHandler(true)}j.activateOnErrorHandling(true);j.loadConfig(sap.apf.core.messageDefinition);j.loadConfig(sap.apf.modeler.core.messageDefinition);j.setTextResourceHandler(P);if(t&&t.instances&&t.instances.component){z={};z.baseManifest=Object.getPrototypeOf(t.instances.component).getMetadata().getManifest();z.manifest=jQuery.extend({},true,t.instances.component.getMetadata().getManifest())}E=new S(t&&t.instances&&t.instances.component,z);this.getStartParameterFacade=function(){return E};this.ajax=function(e){var a=jQuery.extend(true,{},e);a.functions=a.functions||{};a.functions.getSapSystem=E.getSapSystem;if(t&&t.functions&&t.functions.ajax){a.functions.ajax=t.functions.ajax}a.instances={messageHandler:j};return sap.apf.core.ajax(a)};var X=new b({instances:{messageHandler:j}});w={manifests:z,instances:{messageHandler:j,coreApi:this,proxyTextHandlerForLocalTexts:X}};var $=t&&t.functions&&t.functions.isUsingCloudFoundryProxy&&t.functions.isUsingCloudFoundryProxy();if($){U={instances:{messageHandler:j},functions:{coreAjax:this.ajax}};w.instances.ajaxHandler=new r(U)}if(t&&t.constructors&&t.constructors.PersistenceProxy){L=new t.constructors.PersistenceProxy(e,w)}else{if($){L=new sap.apf.cloudFoundry.modelerProxy.ModelerProxy(e,w)}else if(z&&z.manifest["sap.apf"]&&z.manifest["sap.apf"].activateLrep){L=new sap.apf.core.LayeredRepositoryProxy(e,w)}else{L=new sap.apf.core.OdataProxy(e,w)}}if(t&&t.constructors&&t.constructors.SessionHandler){O=new t.constructors.SessionHandler(w)}else{O=new sap.apf.core.SessionHandler(w)}var Q={functions:{getSapSystem:E.getSapSystem,getComponentNameFromManifest:sap.apf.utils.getComponentNameFromManifest,getODataPath:sap.apf.core.utils.uriGenerator.getODataPath,getBaseURLOfComponent:sap.apf.core.utils.uriGenerator.getBaseURLOfComponent,addRelativeToAbsoluteURL:sap.apf.core.utils.uriGenerator.addRelativeToAbsoluteURL},instances:{fileExists:new y({functions:{ajax:this.ajax,getSapSystem:E.getSapSystem}})}};var Y=new M(Q);N={constructors:{EntityTypeMetadata:x,Hashtable:v,Metadata:C,MetadataFacade:A,MetadataProperty:H},functions:{getServiceDocuments:function(){return[e.serviceRoot]},getSapSystem:E.getSapSystem},instances:{messageHandler:j,coreApi:a,annotationHandler:Y},deactivateFatalError:true};R=new F(N);D={constructors:{Hashtable:v},instances:{messageHandler:j}};this.getCatalogServiceUri=t&&t.functions&&t.functions.getCatalogServiceUri;I=t&&t.functions&&t.functions.odataRequestWrapper||sap.apf.core.odataRequestWrapper;this.odataRequest=function(e,t,a,n){var r={instances:{datajs:J},functions:{getSapSystem:E.getSapSystem}};I(r,e,t,a,n)};this.checkForTimeout=function(e){var t=sap.apf.core.utils.checkForTimeout(e);if(t){j.putMessage(t)}return t};this.getEntityTypeMetadataAsPromise=function(e,t){return R.getEntityTypeMetadata(e,t)};this.getEntityTypeMetadata=this.getEntityTypeMetadataAsPromise;this.getXsrfToken=function(e){return O.getXsrfToken(e)};this.getUriGenerator=function(){return sap.apf.core.utils.uriGenerator};this.getText=function(e,t){return P.getText(e,t)};this.putMessage=function(e){return j.putMessage(e)};this.check=function(e,t,a){return j.check(e,t,a)};this.createMessageObject=function(e){return j.createMessageObject(e)};this.setCallbackForMessageHandling=function(e){j.setMessageCallback(e)};this.isUsingCloudFoundryProxy=function(){return $||false};this.isVendorContentAvailable=function(){if(E.isLrepActive()||$&&this.getGenericExit("hasVendorContent")&&this.getGenericExit("hasVendorContent")()){return true}return false};this.importConfigurationFromVendorLayer=function(e,t,a,n){if($){this.getApplicationHandler(function(r,o){if(o){n(undefined,undefined,o);return}L.importVendorContent(e,t,a,n,r.registerApplicationCreatedOnServer)})}else{Z(e,t,a,n)}};function Z(e,t,n,r){var o;L.readAllConfigurationsFromVendorLayer().then(function(n){var r=e+"."+t;var s;for(s=0;s<n.length;s++){if(n[s].value===r){o=n[s].applicationText;break}}a.getApplicationHandler(i)});function i(t,a){if(a){r(undefined,undefined,a);return}var n=false;var i=t.getApplication(e);if(!i){n=true}var c={ApplicationName:o};t.setAndSave(c,s,e,n)}function s(e,a,n){if(n){r(t,undefined,n);return}c()}function c(){var t=new sap.apf.core.utils.Filter(j,"Language","eq",sap.apf.core.constants.developmentLanguage);var a=new sap.apf.core.utils.Filter(j,"Application","eq",e);a.addAnd(t);L.readCollection("texts",u,undefined,undefined,a,{layer:"VENDOR"})}function u(a,n,o){if(o){r(t,undefined,o);return}_(a,e,f)}function f(a){if(a){r(t,undefined,a);return}L.readEntity("configuration",p,[{value:t}],undefined,e,{layer:"VENDOR"})}function p(e,t,a){if(a){r(undefined,t,a);return}var o=JSON.parse(e.SerializedAnalyticalConfiguration);ee(o,n,r)}}function _(e,t,n){a.getApplicationHandler(o);function r(a,r,o){var i;var s;if(o){n(o)}else{i={instances:{messageHandler:j,persistenceProxy:L},constructors:{Hashtable:v},isUsingCloudFoundryProxy:$};s=new sap.apf.modeler.core.TextPool(i,t,a);s.addTextsAndSave(e,n,t)}}function o(a,o){if(o){n(o);return}var i;var s=a.getApplication(t);if(!s){i=j.createMessageObject({code:11021});n(i);return}if(V&&V.getId()===t){V.getInstance().getTextPool().addTextsAndSave(e,n,t)}else{var c=new sap.apf.core.utils.Filter(j,"Application","eq",t);var u=new sap.apf.core.utils.Filter(j,"Language","eq",sap.apf.core.constants.developmentLanguage);u.addAnd(c);L.readCollection("texts",r,undefined,undefined,u)}}}this.importTexts=function(e,t){var a;var n;var r;var o=sap.apf.utils.parseTextPropertyFile(e,{instances:{messageHandler:j}});if(o.Messages.length>0){a=j.createMessageObject({code:11020});n=o.Messages.length;for(r=0;r<n-1;r++){o.Messages[r+1].setPrevious(o.Messages[r])}a.setPrevious(o.Messages[n-1]);t(a)}else{_(o.TextElements,o.Application,t)}};function ee(e,t,n){var r=e.configHeader;a.getApplicationHandler(o);function o(e,t){if(t){n(undefined,undefined,t);return}var o=false;var c=e.getList();c.forEach(function(e){if(e.Application===r.Application){o=true}});if(o){a.getConfigurationHandler(r.Application,s)}else{var u={ApplicationName:r.ApplicationName,SemanticObject:r.SemanticObject};e.setAndSave(u,i,r.Application,true)}}function i(e,t,o){if(o){n(undefined,undefined,o);return}a.getConfigurationHandler(r.Application,s)}function s(a,o){if(o){n(undefined,undefined,o);return}var i=jQuery.extend({},e,true);delete i.configHeader;var s=false;var u=a.getList();u.forEach(function(e){if(e.AnalyticalConfiguration===r.AnalyticalConfiguration){s=true}});if(s){t(p,l,r.AnalyticalConfigurationName)}else{a.setConfiguration({AnalyticalConfigurationName:r.AnalyticalConfigurationName},r.AnalyticalConfiguration);var f={id:r.AnalyticalConfiguration,creationDate:r.CreationUTCDateTime,lastChangeDate:r.LastChangeUTCDateTime,content:i};a.loadConfiguration(f,c)}function p(){a.setConfiguration({AnalyticalConfigurationName:r.AnalyticalConfigurationName},r.AnalyticalConfiguration);var e={updateExisting:true,id:r.AnalyticalConfiguration,creationDate:r.CreationUTCDateTime,lastChangeDate:r.LastChangeUTCDateTime,content:i};a.loadConfiguration(e,c)}function l(e){if(e&&e!==""){r.AnalyticalConfigurationName=e}var t=a.setConfiguration({AnalyticalConfigurationName:r.AnalyticalConfigurationName});var n={id:t,content:i};a.loadConfiguration(n,c)}}function c(e,t){if(t){n(undefined,undefined,t);return}e.save(n)}}this.importConfiguration=function(e,t,a){var n=JSON.parse(e);if(!r(n,a)){return}ee(n,t,a);function r(t,a){var n=[],r=true,o;if(!sap.apf.utils.isValidGuid(t.configHeader.Application)){n.push(j.createMessageObject({code:11037,aParameters:[t.configHeader.Application]}));r=false}if(!sap.apf.utils.isValidGuid(t.configHeader.AnalyticalConfiguration)){n.push(j.createMessageObject({code:11038,aParameters:[t.configHeader.AnalyticalConfiguration]}));r=false}o=sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(t);o.forEach(function(e){var t=new v(j);if(!t.hasItem(e)){t.setItem(e,e);if(!sap.apf.utils.isValidGuid(e)){n.push(j.createMessageObject({code:11039,aParameters:[e]}));r=false}}});if(r){return r}n.forEach(function(e,t,a){if(t){e.setPrevious(a[t-1])}});a(e,undefined,n[n.length-1]);return r}};this.getApplicationHandler=function(e){if(!q){var a=t&&t.functions&&t.functions.loadApplicationHandler||r;q=new T(D,a)}q.asyncGetInstance("ApplicationHandlerId",e);function r(e,t){new n({instances:{messageHandler:j,persistenceProxy:L},constructors:{Hashtable:v},functions:{resetConfigurationHandler:r}},a);function a(a,n){t(e,a,n)}function r(e){if(V&&V.getId()===e){V.getInstance().removeAllConfigurations();V.reset()}}}};this.getConfigurationHandler=function(e,n){if(!V){G=t&&t.functions&&t.functions.loadConfigurationHandler||r;V=new T(D,G)}V.asyncGetInstance(e,n);function r(e,t,n){var r=new sap.apf.core.utils.Filter(j,"Application","eq",e);var y=new sap.apf.core.utils.Filter(j,"Language","eq",sap.apf.core.constants.developmentLanguage);y.addAnd(r);var C=[];var A=["AnalyticalConfiguration","AnalyticalConfigurationName","Application","CreatedByUser","CreationUTCDateTime","LastChangeUTCDateTime","LastChangedByUser"];C.push({entitySetName:"configuration",filter:r,selectList:A});C.push({entitySetName:"texts",filter:y});L.readCollectionsInBatch(C,H);function H(r,y){var C,A;var H;var F;var S=n;if(y){t(e,undefined,y)}else{H=r[0];F=r[1];A={instances:{messageHandler:j,persistenceProxy:L},constructors:{Hashtable:v},isUsingCloudFoundryProxy:$};C=new sap.apf.modeler.core.TextPool(A,e,F);if(!S){S=new o({instances:{messageHandler:j,persistenceProxy:L,coreApi:a,metadataFactory:R},constructors:{ConfigurationEditor:i,ConfigurationFactory:c,ConfigurationObjects:s,ElementContainer:m,EntityTypeMetadata:x,SmartFilterBar:p,FacetFilter:l,NavigationTarget:d,Hashtable:v,Representation:g,RegistryProbe:h,Step:u,HierarchicalStep:f,LazyLoader:T},functions:{getApplication:q.getInstance().getApplication}})}S.setApplicationIdAndContext(e,H,C);t(e,S,y)}}}};this.getUnusedTextKeys=function(e,t){var a={instances:{messageHandler:j,persistenceProxy:L},constructors:{Hashtable:v}};var n=new s(a);var r=null,o=null,i=null;n.getTextKeysFromAllConfigurations(e,function(e,t){if(o){return}r=e;o=t;if(t||i){c()}});this.getConfigurationHandler(e,function(e,t){if(o){return}i=e;o=t;if(t||r){c()}});function c(){var e=[];if(o){t(undefined,o);return}i.getTextPool().getTextKeys().forEach(function(t){if(!r.hasItem(t)){e.push(t)}});t(e,undefined)}};this.resetConfigurationHandler=function(){if(V){V.reset()}};this.getRepresentationTypes=function(){var e=sap.apf.core.representationTypes();var t=[];jQuery.extend(true,t,e);return t};this.getAllAvailableSemanticObjects=function(e){if(B){e(B,K);return}if(K){e([],K);return}W.push(e);if(W.length===1){var t={requestUri:"/sap/opu/odata/UI2/INTEROP/SemanticObjects?$format=json&$select=id,text",method:"GET",isSemanticObjectRequest:true};a.odataRequest(t,n,r)}function n(e,t){B=e.results;W.forEach(function(t){t(e.results,undefined)})}function r(e){var t;if(e&&e.messageObject){t=e.messageObject}else{j.createMessageObject({code:"11041"});B=[]}K=t;W.forEach(function(e){e([],t)})}};this.getSemanticActions=function(e){var n;var r=jQuery.Deferred();if(!k){k=new v(j)}n=k.getItem(e);if(n){r.resolve(n);return r.promise()}a.getAllAvailableSemanticObjects(o);return r.promise();function o(a,n){if(n){r.reject(n);return}var o=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var i={id:e,text:""};var s;for(s=0;s<a.length;s++){if(a[s].id===e){i=a[s];break}}if(!o){j.createMessageObject({code:"5038"});var c={semanticObject:i,semanticActions:[]};k.setItem(e,c);r.resolve(c)}else{o.getLinks({semanticObject:i.id,ignoreFormFactor:true,ui5Component:t.instances.component}).done(function(t){var a=[];t.forEach(function(e){var t=e.intent.split("-");var n=t[1].split("?");n=n[0].split("~");a.push({id:n[0],text:e.text})});var n={semanticObject:i,semanticActions:a};k.setItem(e,n);r.resolve(n)}).fail(function(){r.reject(j.createMessageObject({code:"11042"}))})}}};this.navigateToGenericRuntime=function(e,n,r){var o;if(t&&t.exits&&t.exits.getRuntimeUrl&&jQuery.isFunction(t.exits.getRuntimeUrl)){o=t.exits.getRuntimeUrl(e,n)}else{var i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var s={};if(a.getStartParameterFacade().isLrepActive()){s["sap-apf-configuration-id"]=e+"."+n}else{s["sap-apf-configuration-id"]=n}var c=i.hrefForExternal({target:t.functions.getNavigationTargetForGenericRuntime(),params:s});var u=jQuery(location).attr("href");var f=u.split("#")[0];o=f+c}r(o)};this.readAllConfigurationsFromVendorLayer=function(){return L.readAllConfigurationsFromVendorLayer()};this.showSemanticObject=function(){if(E.isLrepActive()||$){return false}return true};this.getGenericExit=function(e){if(t&&t.exits&&t.exits[e]&&typeof t.exits[e]==="function"){return t.exits[e]}return undefined};this.getComponent=function(){return t&&t.instances&&t.instances.component};if(t&&t.probe&&typeof t.probe==="function"){t.probe({constructors:{ApplicationHandler:n,ConfigurationHandler:o,ConfigurationEditor:i,ConfigurationObjects:s,ConfigurationFactory:c,MetadataFactory:F,Metadata:C,EntityTypeMetadata:x,MetadataFacade:A,MetadataProperty:H,Step:u,HierarchicalStep:f,SmartFilterBar:p,FacetFilter:l,NavigationTarget:d,Representation:g,ElementContainer:m,Hashtable:v,LazyLoader:T,AnnotationHandler:M,ProxyTextHandlerForLocalTexts:b,RegistryProbe:h},textHandler:P,messageHandler:j,sessionHandler:O,persistenceProxy:L,metadataFactory:R,injectForFollowUp:w,injectMetadataFactory:N,fnOdataRequestWrapper:I,proxyTextHandlerForLocalTexts:X,ajax:this.ajax,odataRequestWrapper:I,annotationHandler:Y})}}});
//# sourceMappingURL=instance.js.map
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/instance","sap/apf/core/instance","sap/apf/core/messageHandler","sap/apf/core/messageDefinition","sap/apf/core/constants","sap/apf/core/utils/filterSimplify","sap/ui/thirdparty/datajs","sap/apf/utils/utils","sap/apf/utils/filter","sap/apf/utils/externalContext","sap/apf/utils/startFilterHandler","sap/apf/utils/startFilter","sap/apf/utils/filterIdHandler","sap/apf/utils/serializationMediator","sap/apf/utils/navigationHandler","sap/apf/utils/startParameter","sap/apf/messageCallbackForStartup","sap/apf/ui/representations/RepresentationInterfaceProxy","sap/base/Log","sap/ui/thirdparty/jquery"],function(t,e,r,n,a,i,s,o,c,u,f,p,l,d,g,h,m,v,C,jQuery){"use strict";function F(s,c,v){var F;var P;var A;var S;var y;var H;var x;var R;var b;var T;var M;var k;var E;var w=true;var q=jQuery.Deferred();var I=new jQuery.Deferred;var j;var L;this.type="api";this.constants={};this.constants.eventTypes=a.eventTypes;this.destroy=function(){F.activateOnErrorHandling(false);F.setMessageCallback(undefined);F.setLifeTimePhaseShutdown();if(k&&k.destroy){k.destroy()}if(P){P.destroy()}k=undefined;P=undefined;F=undefined;A=undefined;S=undefined};this.activateOnErrorHandling=function(t){return P.activateOnErrorHandling(t)};this.getStartParameterFacade=function(){return P.getStartParameterFacade()};this.getLogMessages=function(){return P.getLogMessages()};this.createStep=function(t,e,r){return P.createStep(t,e,r)};this.getActiveStep=function(){return P.getActiveStep()};this.getCategories=function(){return P.getCategories()};this.getSteps=function(){return P.getSteps()};this.getStepTemplates=function(){return P.getStepTemplates()};this.getFacetFilterConfigurations=function(){return P.getFacetFilterConfigurations()};this.getApplicationConfigProperties=function(){return P.getApplicationConfigProperties()};this.moveStepToPosition=function(t,e,r){return P.moveStepToPosition(t,e,r)};this.removeStep=function(t,e){return P.removeStep(t,e)};this.resetPath=function(){return P.resetPath()};this.setActiveStep=function(t){return P.setActiveStep(t)};this.stepIsActive=function(t){return P.stepIsActive(t)};this.updatePath=function(t){return P.updatePath(t)};this.getApfLocation=function(){return P.getUriGenerator().getApfLocation()};this.readPaths=function(t){return P.readPaths(t)};this.savePath=function(t,e,r){P.savePath(t,e,r)};this.openPath=function(t,e,r){return P.openPath(t,e,r)};this.deletePath=function(t,e){return P.deletePath(t,e)};this.addFacetFilter=function(t){k.getLayoutView().getController().addFacetFilter(t)};this.getEventCallback=function(t){return k.getEventCallback(t)};this.putMessage=function(t){return P.putMessage(t)};this.createMessageObject=function(t){return P.createMessageObject(t)};this.getTextHtmlEncoded=function(t,e){return P.getTextHtmlEncoded(t,e)};this.getTextNotHtmlEncoded=function(t,e){return P.getTextNotHtmlEncoded(t,e)};if(!v){this.loadApplicationConfig=function(t){P.loadApplicationConfig(t)}}else{this.loadApplicationConfig=function(t){}}this.createFilter=function(){return P.createFilter()};this.addPathFilter=function(t){return x.add(t)};this.updatePathFilter=function(t,e){x.update(t,e)};this.getPathFilter=function(t){return x.get(t)};this.createReadRequest=function(t){return P.createReadRequest(t)};this.createReadRequestByRequiredFilter=function(t){return P.createReadRequestByRequiredFilter(t)};this.selectionChanged=function(t){k.selectionChanged(t)};this.createApplicationLayout=function(){if(!j){j=(new sap.m.App).addStyleClass("sapApf")}return j};this.startApf=function(){var t;var e=this;var r=this.createApplicationLayout();I.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(s,[this])}q.resolve();k.createApplicationLayout(r).then(function(){t=S.checkMode();var r=k.handleStartup(t);r.done(function(){if(e.fnAfterApfStartupCallback&&typeof e.fnAfterApfStartupCallback==="function"){e.fnAfterApfStartupCallback.apply(s,[e])}F.setLifeTimePhaseRunning()})})}catch(t){w=false}}.bind(this));return r};this.addMasterFooterContent=function(t){return k.addMasterFooterContentRight(t)};this.setEventCallback=function(t,e){switch(t){case a.eventTypes.contextChanged:k.setEventCallback(t,e);return true;case a.eventTypes.printTriggered:k.setEventCallback(t,e);return true;case a.eventTypes.format:this.customFormat(e);return true;default:return false}};this.customFormat=function(t){k.setCustomFormatExit(t)};this.setCallbackBeforeApfStartup=function(t){this.fnBeforeApfStartupCallback=t};this.setCallbackAfterApfStartup=function(t){this.fnAfterApfStartupCallback=t};this.getPropertyValuesOfExternalContext=function(t){var e=jQuery.Deferred();H.getCombinedContext().then(function(r){var n=r.getFilterTermsForProperty(t);var a=[];n.forEach(function(t){var e={Low:t.getValue(),Option:t.getOp(),High:t.getHighValue()};a.push(e)});e.resolve(a)});return e.promise()};this.startupSucceeded=function(){return w};if(s&&s.getInjections instanceof Function){if(!c){c={}}jQuery.extend(c,c,s.getInjections())}A=new(c&&c.constructors&&c.constructors.StartParameter||h)(s,v);F=new(c&&c.constructors&&c.constructors.MessageHandler||r);F.activateOnErrorHandling(true);F.setLifeTimePhaseStartup();F.loadConfig(n,true);E=c&&c.functions&&c.functions.messageCallbackForStartup||m;F.setMessageCallback(E);if(c&&c.functions&&c.functions.isUsingCloudFoundryProxy){L=c.functions.isUsingCloudFoundryProxy}else{L=function(){return false}}try{P=new(c&&c.constructors&&c.constructors.CoreInstance||e.constructor)({functions:{isUsingCloudFoundryProxy:L,getCumulativeFilter:function(){return y.getCumulativeFilter()},getCombinedContext:function(){return H.getCombinedContext()},ajax:c&&c.functions&&c.functions.ajax,serializeApfState:function(t,e){return M.serialize(t,e)},deserializeApfState:function(t){return M.deserialize(t)},odataRequest:c&&c.functions&&c.functions.odataRequest,getComponentName:function(){if(v&&v.manifest&&v.manifest["sap.app"]){return v.manifest["sap.app"].id}return s.getMetadata().getComponentName()}},instances:{messageHandler:F,startParameter:A,datajs:c&&c.instances&&c.instances.datajs||OData,component:s},constructors:{Request:c&&c.constructors&&c.constructors.Request,Metadata:c&&c.constructors&&c.constructors.Metadata,MetadataFactory:c&&c.constructors&&c.constructors.MetadataFactory,ResourcePathHandler:c&&c.constructors&&c.constructors.ResourcePathHandler,TextResourceHandler:c&&c.constructors&&c.constructors.TextResourceHandler,SessionHandler:c&&c.constructors&&c.constructors.SessionHandler,Persistence:c&&c.constructors&&c.constructors.Persistence},manifests:v,exits:c&&c.exits,coreProbe:c&&c.coreProbe,corePromise:I});b={instances:{startParameter:A,component:s,messageHandler:F},functions:{getConfigurationProperties:P.getApplicationConfigProperties,ajax:P.ajax}};H=new(c&&c.constructors&&c.constructors.ExternalContext||u)(b);R={functions:{getFacetFilterConfigurations:this.getFacetFilterConfigurations,getReducedCombinedContext:P.getReducedCombinedContext,createRequest:P.getFunctionCreateRequest()},instances:{messageHandler:F,onBeforeApfStartupPromise:q.promise()},constructors:{StartFilter:p}};y=new(c&&c.constructors&&c.constructors.StartFilterHandler||f)(R);T={functions:{setRestrictionByProperty:y.setRestrictionByProperty,getRestrictionByProperty:y.getRestrictionByProperty},instances:{messageHandler:F}};x=new(c&&c.constructors&&c.constructors.FilterIdHandler||l)(T);M=new(c&&c.constructors&&c.constructors.SerializationMediator||d)({instances:{coreApi:P,filterIdHandler:x,startFilterHandler:y,messageHandler:F}});var B={constructors:{FilterReduction:i.FilterReduction},functions:{getCumulativeFilterUpToActiveStep:P.getCumulativeFilterUpToActiveStep,getNavigationTargets:P.getNavigationTargets,getActiveStep:P.getActiveStep,createRequest:P.getFunctionCreateRequest(),getXappStateId:P.getStartParameterFacade().getXappStateId,isFilterReductionActive:P.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:P.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:F,component:s,serializationMediator:M}};S=new(c&&c.constructors&&c.constructors.NavigationHandler||g)(B);k=new(c&&c.constructors&&c.constructors.UiInstance||t)({oCoreApi:P,oFilterIdHandler:x,oSerializationMediator:M,oNavigationHandler:S,oComponent:s,oStartParameter:A,oStartFilterHandler:y,functions:c&&c.functions||{},exits:c&&c.exits||{}})}catch(t){w=false;this.startApf=function(){return new sap.m.Text({text:""})};this.loadApplicationConfig=function(){return""};C.error("Caught exception during creation of APF API")}if(P){P.createRepresentation=function(t,e){var r=t.replaceAll(".","/");sap.ui.require([r],function(t){return t});var n=new sap.apf.ui.representations.RepresentationInterfaceProxy(P,k);var a=o.extractFunctionFromModulePathString(t);return new a(n,e)}}if(c&&c.probe&&typeof c.probe==="function"){c.probe({apfApi:this,coreApi:P,component:s,uiApi:k,messageHandler:F,serializationMediator:M,navigationHandler:S,startParameter:A,injectedFunctionsNavigationHandler:B&&B.functions,startFilterHandler:y,externalContext:H,filterIdHandler:x,corePromise:I})}}sap.apf.Api=F;return F},true);
//# sourceMappingURL=api.js.map
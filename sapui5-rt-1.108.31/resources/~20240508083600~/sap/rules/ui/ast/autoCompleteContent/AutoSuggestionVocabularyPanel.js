sap.ui.define(["sap/ui/thirdparty/jquery","../../library","sap/ui/core/Control","sap/m/List","sap/ui/model/json/JSONModel","sap/m/ListMode","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/rules/ui/parser/infrastructure/util/utilsBase","./AutoSuggestionVocabularyPanelRenderer"],function(jQuery,e,t,a,i,s,l,n,r,o){"use strict";var u=t.extend("sap.rules.ui.ast.autoCompleteContent.AutoSuggestionVocabularyPanel",{metadata:{library:"sap.rules.ui",properties:{reference:{type:"object",defaultValue:null},dialogOpenedCallbackReference:{type:"object",defaultValue:null},data:{type:"object",defaultValue:null},context:{type:"string",defaultValue:""}},aggregations:{PanelLayout:{type:"sap.m.Panel",multiple:false}},events:{}},init:function(){this.oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.rules.ui.i18n");this.infraUtils=new sap.rules.ui.parser.infrastructure.util.utilsBase.utilsBaseLib;this.needCreateLayout=true;this.AttributeSegmentSelected=true;this.dataObjectName=""},onBeforeRendering:function(){this._reference=this.getReference();this._dialogOpenedCallbackReference=this.getDialogOpenedCallbackReference();if(this.needCreateLayout){var e=this._createLayout();this.setAggregation("PanelLayout",e,true);this.needCreateLayout=false}},initializeVariables:function(){},_createAggregateFunctionSection:function(){var e=new sap.m.Panel({expandable:false,expanded:true,width:"auto",content:[new sap.m.Link({wrapping:true,text:this.oBundle.getText("aggregateFunctionPanelTitle"),press:function(e){var t=new sap.ui.layout.HorizontalLayout({content:[new sap.m.Label({text:this.oBundle.getText("function")+": "}),new sap.m.Select({width:"200px",height:"60px"}),new sap.m.Label({text:" "+this.oBundle.getText("oflabel")+" "}),new sap.m.TextArea({value:"",showExceededText:true,width:"150%",height:"65px"})]});var a=new sap.ui.layout.HorizontalLayout({content:[new sap.m.Label({text:this.oBundle.getText("where_label")+":"}),new sap.m.TextArea({value:"",showExceededText:true,width:"300px"})]});var i=new sap.ui.layout.HorizontalLayout({content:[new sap.m.Label({text:this.oBundle.getText("group_by")+": "}),new sap.m.TextArea({value:"",showExceededText:true,width:"300px"})]});var s=new sap.ui.layout.HorizontalLayout({content:[new sap.m.Label({text:this.oBundle.getText("function_label")+":"}),new sap.m.TextArea({value:"",enabled:false,width:"300px"})]});var l=new sap.ui.layout.VerticalLayout({content:[t,a,i,s]});var n=this;var r=new sap.m.Dialog({title:this.oBundle.getText("configure_aggr_title"),contentWidth:"800px",contentHeight:"500px",showHeader:true,content:[l],afterClose:function(){n._dialogOpenedCallbackReference(false)},buttons:[new sap.m.Button({text:this.oBundle.getText("applyChangesBtn"),tooltip:this.oBundle.getText("applyChangesBtn"),press:function(e){r.close()}}),new sap.m.Button({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(e){r.close()}})]});r.open()}})]});var t=new sap.m.CustomListItem({content:e});return t},_createLayout:function(){var e=this;this.VocabularyTerms=this.getData();var t=new sap.ui.model.json.JSONModel;var a=[];for(var i=0;i<5&&i<this.VocabularyTerms.length;i++){a.push(this.VocabularyTerms[i])}t.setData(a);this.vocabularylist=new sap.m.List({growingScrollToLoad:true,enableBusyIndicator:true});this.vocabularylist.bindItems({path:"/",sorter:new sap.ui.model.Sorter("label"),rememberSelections:false,mode:s.SingleSelectMaster,template:new sap.m.DisplayListItem({label:"{label}",type:"Active",press:function(t){e._setModal(false);e._reference(t)}})});this.vocabularylist.setModel(t);var l=this.getMoreVocabulariesLink();var n=new sap.m.Panel({headerText:this.oBundle.getText("vocabularyPanelTitle"),expandable:true,expanded:true,content:this.vocabularylist,width:"auto"});if(this.VocabularyTerms.length>=5){n.addContent(l)}return n},_setModal:function(e){var t=sap.ui.getCore().byId("popover");if(t){t.setModal(e)}},getMoreVocabulariesLink:function(){var e=this;var t=new sap.m.Link({text:this.oBundle.getText("more_link"),tooltip:this.oBundle.getText("more_link_tooltip"),enabled:true,press:function(t){e._setModal(true);e._dialogOpenedCallbackReference(true);var a=e.isDoAndAttrsPresent(e.VocabularyTerms);if(a||e.VocabularyTerms[0].isParentEntity){e.getDataObjectsDialog()}else{e.getAttributesDialog(e.dataObjectName)}}});return t},isDoAndAttrsPresent:function(e){if(e){var t=false;var a=false;for(var i=0;i<e.length;i++){if(e[i].isParentEntity&&e[i].type!=="AO"&&e[i].type!=="R"){t=true}else{a=true}}return t&&a}return false},getDataObjectsDialog:function(){var e=this;var t=this.oBundle.getText("searchTextVocabulary");var a=this.getSearchField(t);this.detailedVocabularyList=this.initializeVocabularyList(this.VocabularyTerms);this.bindFilteredTermsToList(this.detailedVocabularyList,"DataObjects","",false);var i=new sap.ui.layout.VerticalLayout({content:[a,e.detailedVocabularyList]}).addStyleClass("sapAstVocabularyPanel");this.dataObjectsDialog=new sap.m.Dialog({title:this.oBundle.getText("selectVocabularyTitle"),contentWidth:"500px",contentHeight:"500px",showHeader:true,content:[i],afterClose:function(){e._dialogOpenedCallbackReference(false)},buttons:[new sap.m.Button({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(t){e._setModal(false);e.dataObjectsDialog.close()}})]});e.dataObjectsDialog.open()},getAttributesDialog:function(e){var t=this;var a=this.getAttributesSegmentedButtons();var i=this.oBundle.getText("searchTextAttr");if(this.AttributeSegmentSelected){i=this.oBundle.getText("searchTextAttr")}if(this.AssociationSegmentSelected){i=this.oBundle.getText("searchTextAssoc")}var s=this.getSearchField(i);this.detailedVocabularyList=this.initializeVocabularyList(this.VocabularyTerms);this.bindFilteredAttributesAndAssociationsToList(this.detailedVocabularyList,"Attributes","E",false);var l=new sap.ui.layout.VerticalLayout({content:[a,s,t.detailedVocabularyList]}).addStyleClass("sapAstVocabularyPanel");t.attributesDialog=new sap.m.Dialog({title:this.oBundle.getText("selectAttrAssocTitle"),contentWidth:"500px",contentHeight:"500px",showHeader:true,content:[l],afterClose:function(){t._dialogOpenedCallbackReference(false)},buttons:[new sap.m.Button({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(e){t._setModal(false);t.attributesDialog.close()}})]});t.attributesDialog.open()},getAttributesSegmentedButtons:function(){var e=this;var t=new sap.m.SegmentedButton({items:[new sap.m.SegmentedButtonItem({text:this.oBundle.getText("attributes"),width:"230px",press:function(){e._setModal(false);e.AttributeSegmentSelected=true;e.AssociationSegmentSelected=false;e.searchField.setValue("");e.searchField.setPlaceholder(e.oBundle.getText("searchTextAttr"));e.bindFilteredAttributesAndAssociationsToList(e.detailedVocabularyList,"Attributes","E",false)}}),new sap.m.SegmentedButtonItem({text:this.oBundle.getText("associations"),width:"230px",press:function(){e._setModal(false);e.AttributeSegmentSelected=false;e.AssociationSegmentSelected=true;e.searchField.setValue("");e.searchField.setPlaceholder(e.oBundle.getText("searchTextAssoc"));e.bindFilteredAttributesAndAssociationsToList(e.detailedVocabularyList,"Association","AO",false)}})]});return t},bindFilteredTermsToList:function(e,t,a,i){var n=new sap.ui.model.json.JSONModel(this.VocabularyTerms);for(var r in n.oData){if(n.oData[r].type==="T"){n.oData[r].displayType="Table"}else if(n.oData[r].type==="S"){n.oData[r].displayType="Structure"}else if(n.oData[r].type==="E"){if(n.oData[r].isParentEntity){n.oData[r].displayType="Element"}else{var o="Attribute";n.oData[r].displayType=n.oData[r].bussinessDataType?o+" ("+n.oData[r].bussinessDataType+")":o}}else if(n.oData[r].type==="AO"){n.oData[r].displayType="Association"}else if(n.oData[r].ResultDataObjectId&&!n.oData[r].type){n.oData[r].displayType="Rule"}else{n.oData[r].displayType=n.oData[r].type}}var u=this;var d="/";if(!e){e=new sap.m.List({})}e.setModel(n);e.bindItems({path:d,sorter:new sap.ui.model.Sorter("type"),template:new sap.m.DisplayListItem({label:"{label}",value:"{displayType}",type:"Active",customData:[new l({Type:"sap.ui.core.CustomData",key:"id",value:"{id}"})],press:function(e){u._setModal(false);if(u.dataObjectsDialog.isOpen()){u.dataObjectsDialog.close()}else{u.attributesDialog.close()}u._reference(e)}}),rememberSelections:false,mode:s.SingleSelectMaster});if(i){var c=[];var p="label";c.push(new sap.ui.model.Filter(p,sap.ui.model.FilterOperator.Contains,a));e.getBinding("items").filter(c);e.getModel().refresh(true)}},bindFilteredAttributesAndAssociationsToList:function(e,t,a,i){var l=new sap.ui.model.json.JSONModel(this.VocabularyTerms);var n=this;var r="/";if(!e){e=new sap.m.List({})}if(l&&l.oData){for(var o in l.oData){if(l.oData[o].type==="E"){var u="Attribute";l.oData[o].displayType=l.oData[o].bussinessDataType?u+" ("+l.oData[o].bussinessDataType+")":u}else if(l.oData[o].type==="R"){var u="Reference";l.oData[o].displayType=u}}}e.setModel(l);e.bindItems({path:r,sorter:new sap.ui.model.Sorter("label"),template:new sap.m.DisplayListItem({label:"{label}",value:"{displayType}",type:"Active",press:function(e){n._setModal(false);n.attributesDialog.close();n._reference(e)}}),rememberSelections:false,mode:s.SingleSelectMaster});if(i){if(t==="AO"){e.getBinding("items").filter(new sap.ui.model.Filter({filters:[this.getSearchFiltersAttributesAssociation(a,t)],and:true}))}else{e.getBinding("items").filter(new sap.ui.model.Filter({filters:[this.getSearchFiltersReference(a),this.getSearchFiltersAttributesAssociation(a,t)],and:false}))}}else{var d=[];var c="type";if(a==="E"){d.push(new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,a));d.push(new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,"R"))}else{d.push(new sap.ui.model.Filter(c,sap.ui.model.FilterOperator.Contains,a))}e.getBinding("items").filter(new sap.ui.model.Filter({filters:d,and:false}));e.getModel().refresh(true)}},getSearchFiltersReference:function(e){return new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("type",sap.ui.model.FilterOperator.Contains,"R"),new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,e)],and:true})},getSearchFiltersAttributesAssociation:function(e,t){return new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("type",sap.ui.model.FilterOperator.Contains,t),new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,e)],and:true})},getDataObjectFilter:function(){if(this.AttributeSegmentSelected){return new sap.ui.model.Filter("DataObjectId",sap.ui.model.FilterOperator.Contains,this.dataObjectId)}if(this.AssociationSegmentSelected){return new sap.ui.model.Filter("SourceDataObjectId",sap.ui.model.FilterOperator.Contains,this.dataObjectId)}},getSearchFilters:function(e){return new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,e),new sap.ui.model.Filter("label",sap.ui.model.FilterOperator.Contains,e)],and:false})},getSearchField:function(e){var t=this;this.searchField=new sap.m.SearchField({showSearchButton:false,width:"462px",placeholder:e,liveChange:function(e){if(t.dataObjectsDialog){t.searchTheValueInDataObjects(e.getParameter("newValue"),a)}else{var a="Attributes";if(t.AttributeSegmentSelected){a="Attributes"}if(t.AssociationSegmentSelected){a="Association"}t.searchValueInAttributesAndAssociation(e.getParameter("newValue"),a)}}});return this.searchField},searchTheValueInDataObjects:function(e,t){this.bindFilteredTermsToList(this.detailedVocabularyList,t,e,true)},searchValueInAttributesAndAssociation:function(e,t){if(this.AttributeSegmentSelected){t="E"}if(this.AssociationSegmentSelected){t="AO"}this.bindFilteredAttributesAndAssociationsToList(this.detailedVocabularyList,t,e,true)},initializeVocabularyList:function(e){var t=new sap.ui.model.json.JSONModel(e);var a="/";var i=new sap.m.List({headerText:this.oBundle.getText("vocabulary")});i.setModel(t);i.bindItems({path:a,sorter:new sap.ui.model.Sorter("label"),template:new sap.m.DisplayListItem({label:"{label}",value:"{type}",type:"Active",customData:[new l({Type:"sap.ui.core.CustomData",key:"id",value:"{id}"})]})});return i},renderer:o});return u},true);
//# sourceMappingURL=AutoSuggestionVocabularyPanel.js.map
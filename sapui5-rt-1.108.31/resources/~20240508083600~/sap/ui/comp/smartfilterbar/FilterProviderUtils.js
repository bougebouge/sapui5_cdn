/*!
 * SAPUI5
 * (c) Copyright 2009-2022 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FilterUtil","sap/ui/comp/library"],function(e,i,t,a,l,n,o){"use strict";var s=o.smartfilterbar.FilterType,r=o.valuehelpdialog.ValueHelpRangeOperation;var f=e.extend("sap.ui.comp.smartfilterbar.FilterProviderUtils");f.FIELD_NAME_REGEX=/\./g;f.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";f.BASIC_FILTER_AREA_ID="_BASIC";f.FILTER_MODEL_NAME="fi1t3rM0d31";f.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";f.ASSOCIATE_VALUE_LISTS="AssociateValueLists";f.INTL_TIMEZONE=Intl.DateTimeFormat().resolvedOptions().timeZone;f.UI_TIMEZONE=sap.ui.getCore().getConfiguration().getTimezone();f._getStringEmptyFilter=function(e,a,l){var n=l?t.NE:t.EQ,o=a&&a.type==="Edm.Guid"?"00000000-0000-0000-0000-000000000000":"";if(a&&a.nullable==="false"){return new i(e,n,o)}else{return new i({and:!!l,filters:[new i(e,n,o),new i(e,n,null)]})}};f._getFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fields){e.fields.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null})}return t!==null});return t};f._getTimezone=function(e,i){var t=e&&e.find(function(e){return e.key===i});if(t){return t.value}return null};f.adaptTime=function(e,i){var t;if(!(e instanceof Date)||!i){return e}if(i.filterRestriction===s.single&&i.control&&i.control.isA("sap.m.DynamicDateRange")){return a.normalizeDate(e,true)}if(i.displayFormat==="Date"){return a.normalizeDate(e,true)}t=parseInt(i.precision);return a.adaptPrecision(e,t)};f.generateFilters=function(e,o,s){var u=[],c=null,p=null,m=null,T=null,d=f.FIELD_NAME_REGEX,E=null,g,I,h=null,w=0,D=0,_,O,C,F,v,U,S,y,L,N,A,M=[],V,z,R;if(s){_=s.dateSettings;O=s.useContainsAsDefault;C=s.stringFields;F=s.timeFields;S=s.dateTimeOffsetValueFields;M=s.viewMetadataData||[];y=s.dateTimeOffsetWithTimeZone}if(e){if(o){D=e.length;while(D--){U=false;L=false;T=e[D];N=this._getTimezone(y,T);A=f._getFieldMetadata(M,T);if(A&&A.isCustomFilterField){continue}if(T&&T!==f.BASIC_SEARCH_FIELD_ID){h=null;v=false;if(O&&C){if(C.indexOf(T)>-1){v=true}}else if(F&&F.indexOf(T)>-1){U=true}else if(S&&S.indexOf(T)>-1){L=true}E=o[T];T=T.replace(d,"/");if(E&&E.hasOwnProperty("low")){if(E.low&&E.high){g=E.low;I=E.high;if(!L&&_&&_.UTC&&g instanceof Date&&I instanceof Date){g=a.localToUtc(g);I=a.localToUtc(I)}g=f.adaptTime(g,A);I=f.adaptTime(I,A);u.push(new i(T,t.BT,g,I))}else if(E.low){if(E.low instanceof Date){g=E.low;if(!L&&_&&_.UTC){g=a.localToUtc(g)}g=f.adaptTime(g,A);u.push(new i(T,t.EQ,g))}else if(typeof E.low==="string"){if(L&&A){h=l.parseDateTimeOffsetInterval(E.low);h[0]=A.ui5Type.parseValue(h[0],"string");if(h.length===2){h[1]=A.ui5Type.parseValue(h[1],"string")}}else{h=l.parseFilterNumericIntervalData(E.low)}if(h&&h.length===2){E[0]=f.adaptTime(E[0],A);E[1]=f.adaptTime(E[1],A);u.push(new i(T,t.BT,h[0],h[1]))}else if(h&&h.length===1){E[0]=f.adaptTime(E[0],A);u.push(new i(T,t.EQ,h[0]))}else{u.push(new i(T,v?t.Contains:t.EQ,E.low))}}}}else if(E&&E.hasOwnProperty("items")){c=[];m=[];p=null;if(E&&E.hasOwnProperty("ranges")){h=E.ranges;w=h.length;while(w--){V=h[w];g=V.value1;I=V.value2;if(U){if(g instanceof Date){g=l.getEdmTimeFromDate(g)}if(I instanceof Date){I=l.getEdmTimeFromDate(I)}}else if(A&&A.isCalendarDate){if(g instanceof Date){g=A.ui5Type.parseValue(g)}if(I instanceof Date){I=A.ui5Type.parseValue(I)}}else if(!L&&_&&_.UTC){if(g instanceof Date){g=a.localToUtc(g)}if(I instanceof Date){I=a.localToUtc(I)}}else if(L&&N){if(g){if(f.UI_TIMEZONE!==f.INTL_TIMEZONE){g=a.localToTimezone(g,N)}else{g=a.toTimezone(g,N)}g=a.localToUtc(g)}if(I){if(f.UI_TIMEZONE!==f.INTL_TIMEZONE){I=a.localToTimezone(I,N)}else{I=a.toTimezone(I,N)}I=a.localToUtc(I)}}else if(L&&!N){if(g){if(_&&_.UTC){g=a.uiTimezoneToUtc(g);g=a.localToUtc(g)}else{g=a.toTimezone(g,f.INTL_TIMEZONE)}}if(I){if(_&&_.UTC){I=a.uiTimezoneToUtc(I);I=a.localToUtc(I)}else{I=a.toTimezone(I,f.INTL_TIMEZONE)}}}g=f.adaptTime(g,A);I=f.adaptTime(I,A);z=V.exclude?m:c;if(V.operation===r.Empty){if(A&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(A.type)>-1){z.push(new i(T,V.exclude?t.NE:t.EQ,null))}else{z.push(f._getStringEmptyFilter(T,A,V.exclude))}}else{if(V.operation!==t.BT&&V.operation!==t.NB){I=undefined}R=V.exclude?n.getTransformedExcludeOperation(V.operation):V.operation;z.push(new i(T,R,g,I))}}if(m.length){p=new i(m,true)}}h=E.items;w=h.length;while(w--){c.push(new i(T,t.EQ,h[w].key))}if(E.value||E.value===0||E.value===false){if(typeof E.value==="string"){E.value=E.value.trim()}c.push(new i(T,v?t.Contains:t.EQ,E.value))}if(c.length){if(p){u.push(new i([new i(c,false),p],true))}else{u.push(new i(c,false))}}else if(p){u.push(p)}}else if(A&&A.control&&A.control.isA("sap.m.ComboBox")&&this.isValueSignificant(A)){if(E===null&&A.control.getSelectedKey()===""){E=""}if(A.control.getSelectedItem()){E=f.adaptTime(E,A);u.push(new i(T,v?t.Contains:t.EQ,E))}}else if(E||E===0||E===false){if(typeof E==="string"){E=E.trim()}if(E&&E instanceof Date){if(U){E=l.getEdmTimeFromDate(E)}else if(!L&&_&&_.UTC){E=a.localToUtc(E)}}if(E||E===0||E===false){E=f.adaptTime(E,A);u.push(new i(T,v?t.Contains:t.EQ,E))}}}}}}return u.length>1?[new i(u,true)]:u};f.isValueSignificant=function(e){var i=e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].Parameters,t;if(i){t=i.find(function(e){return e.hasOwnProperty("InitialValueIsSignificant")})}if(t&&t["InitialValueIsSignificant"]){return t["InitialValueIsSignificant"].Bool.toLocaleLowerCase()==="true"}return false};return f});
//# sourceMappingURL=FilterProviderUtils.js.map
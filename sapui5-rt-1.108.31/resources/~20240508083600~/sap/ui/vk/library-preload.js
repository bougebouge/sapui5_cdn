//@ui5-bundle sap/ui/vk/library-preload.js
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationInterpolationType", [],function(){"use strict";var e={Discrete:"Discrete",Cubic:"Cubic",Linear:"Linear"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationMath", ["sap/base/Log","./glMatrix","./AnimationTrackType","./AnimationTrackValueType"],function(a,t,e,r){"use strict";var i="sap.ui.vk.AnimationMath";var n={};n.clamp11=function(a){return Math.max(-1,Math.min(1,a))};n.neutralAngleAxisToGlMatrixQuat=function(a){return t.quat.setAxisAngle(t.quat.create(),t.vec3.fromValues(a[0],a[1],a[2]),a[3])};n.neutralEulerToGlMatrixQuat=function(a){var e=1,r=1,i=1,n=1;switch(a[3]){case 6:r=-1;n=-1;break;case 18:r=-1;i=-1;break;case 33:e=-1;n=-1;break;case 36:e=-1;i=-1;break;case 24:i=-1;n=-1;break;case 9:e=-1;r=-1;break;default:}var l=a[0];var u=a[1];var s=a[2];var o=Math.cos(l/2);var v=Math.sin(l/2);var c=Math.cos(u/2);var h=Math.sin(u/2);var M=Math.cos(s/2);var f=Math.sin(s/2);var m=v*c*M+e*o*h*f;var b=o*h*M+r*v*c*f;var p=o*c*f+i*v*h*M;var k=o*c*M+n*v*h*f;return t.quat.fromValues(m,b,p,k)};n.threeQuatToNeutralEuler=function(a,e){var r=t.mat4.fromQuat(t.mat4.create(),t.quat.fromValues(a.x,a.y,a.z,a.w));var i=r[0],l=r[4],u=r[8];var s=r[1],o=r[5],v=r[9];var c=r[2],h=r[6],M=r[10];var f=0,m=0,b=0;var p=.9999999;switch(e){case 6:m=Math.asin(n.clamp11(u));if(Math.abs(u)<p){f=Math.atan2(-v,M);b=Math.atan2(-l,i)}else{f=Math.atan2(h,o)}break;case 18:f=Math.asin(-n.clamp11(v));if(Math.abs(v)<p){m=Math.atan2(u,M);b=Math.atan2(s,o)}else{m=Math.atan2(-c,i)}break;case 33:f=Math.asin(n.clamp11(h));if(Math.abs(h)<p){m=Math.atan2(-c,M);b=Math.atan2(-l,o)}else{b=Math.atan2(s,i)}break;case 36:m=Math.asin(-n.clamp11(c));if(Math.abs(c)<p){f=Math.atan2(h,M);b=Math.atan2(s,i)}else{b=Math.atan2(-l,o)}break;case 24:b=Math.asin(n.clamp11(s));if(Math.abs(s)<p){f=Math.atan2(-v,o);m=Math.atan2(-c,i)}else{m=Math.atan2(u,M)}break;case 9:b=Math.asin(-n.clamp11(l));if(Math.abs(l)<p){f=Math.atan2(h,o);m=Math.atan2(u,i)}else{f=Math.atan2(-v,M)}break;default:}var k=[f,m,b,e];return k};n.neutralQuatToGlMatrixQuat=function(a){return t.quat.fromValues(a[0],a[1],a[2],a[3])};n.glMatrixQuatToNeutral=function(a){return[a[0],a[1],a[2],a[3]]};n.getModulatedAngularValue=function(a){return a-a%(2*Math.PI)};n.equalMatrices=function(a,t,e){for(var r=0;r<a.elements.length;r++){if(Math.abs(a.elements[r]-t.elements[r])>e){return false}}return true};n.interpolate=function(){var l=t.quat;var u=t.vec3;var s=l.create();var o=l.create();var v=u.create();return function(c,h,M,f,m,b,p){var k=h.value;var g=M.value;var T={};var A;var d;var x;var y=1e-4;switch(c){case r.Quaternion:A=n.neutralQuatToGlMatrixQuat(k);d=n.neutralQuatToGlMatrixQuat(g);x=t.quat.slerp(t.quat.create(),A,d,f);if(p!=null){x=t.quat.multiply(t.quat.create(),x,t.quat.invert(t.quat.create(),n.neutralQuatToGlMatrixQuat(p)))}T.value=n.glMatrixQuatToNeutral(x);break;case r.Euler:var Q=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f),k[3]];if(p!=null){Q[0]-=p[0];Q[1]-=p[1];Q[2]-=p[2]}T[r.Euler]=Q;x=n.neutralEulerToGlMatrixQuat(Q);T.value=n.glMatrixQuatToNeutral(x);break;case r.AngleAxis:var q;var z;var L;var S;var w;var G;var V;l.identity(s);if(p===true){for(z=m.getKeysCount()-1;z>=0;z--){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),-q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=(f-1)*g[3]}else{for(z=0,L=m.getKeysCount();z<L;z++){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=f*g[3]}T[r.AngleAxis]=[S,w,G,V];l.setAxisAngle(o,u.set(v,S,w,G),V);l.multiply(s,o,s);T.value=n.glMatrixQuatToNeutral(s);break;case r.Vector3:T.value=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f)];if(p!=null){switch(b){case e.Translate:T.value[0]-=p[0];T.value[1]-=p[1];T.value[2]-=p[2];break;case e.Scale:if(Math.abs(p[0])<y||Math.abs(p[1])<y||Math.abs(p[2])<y){a.error("The scale factor for reverse relative animation is too small","["+p[0]+", "+p[1]+", "+p[2]+"]",i)}else{T.value[0]/=p[0];T.value[1]/=p[1];T.value[2]/=p[2]}break;default:break}}break;default:T.value=n.interpolateScalarLinear(k,g,f);if(p!=null){switch(b){case e.Opacity:if(Math.abs(p)<y){a.warning("The opacity factor for reverse relative animation is too small","["+p+"]",i)}else{T.value/=p}break;default:break}}break}return T}}();n.interpolateScalarLinear=function(a,t,e){return a+e*(t-a)};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationPlayback", ["sap/ui/base/EventProvider","./AnimationSequence","./AnimationTrackType","sap/ui/vk/uuidv4"],function(e,t,i,s){"use strict";var n=e.extend("sap.ui.vk.AnimationPlayback",{constructor:function(e,t){if(typeof e==="object"){t=e;e=undefined}if(e==null){e=s()}this._sequence=t&&t.sequence?t.sequence:undefined;this._jsonData={};this._jsonData.id=e;this._jsonData.startTime=t&&t.startTime?t.startTime:0;this._jsonData.sequence=this._sequence?this._sequence.getJSONData():undefined;this._jsonData.timeScale=t&&t.timeScale?t.timeScale:1;this._jsonData.preDelay=t&&t.preDelay?t.preDelay:0;this._jsonData.postDelay=t&&t.postDelay?t.postDelay:0;this._jsonData.repeats=t&&t.repeats?t.repeats:1;this._jsonData.reversed=t&&t.reversed?t.reversed:false;this._jsonData.infinite=t&&t.infinite?t.infinite:false}});n.prototype.setJSONModel=function(e){this._model=e;if(this._sequence){this._sequence.setJSONModel(e)}return this};n.prototype.getId=function(){return this._jsonData.id};n.prototype.getStartTime=function(){return this._jsonData.startTime};n.prototype.setStartTime=function(e){this._jsonData.startTime=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getSequence=function(){return this._sequence};n.prototype.setSequence=function(e){this._sequence=e;this._jsonData.sequence=e.getJSONData();if(this._model){this._model.updateBindings()}return this};n.prototype.getTimeScale=function(){return this._jsonData.timeScale};n.prototype.setTimeScale=function(e){this._jsonData.timeScale=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getPreDelay=function(){return this._jsonData.preDelay};n.prototype.setPreDelay=function(e){this._jsonData.preDelay=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getPostDelay=function(){return this._jsonData.postDelay};n.prototype.setPostDelay=function(e){this._jsonData.postDelay=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getRepeats=function(){return this._jsonData.repeats};n.prototype.setRepeats=function(e){this._jsonData.repeats=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getReversed=function(){return this._jsonData.reversed};n.prototype.setReversed=function(e){this._jsonData.reversed=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getInfinite=function(){return this._jsonData.infinite};n.prototype.setInfinite=function(e){this._jsonData.infinite=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getDuration=function(){var e=this._sequence?this._sequence.getDuration():0;return this._jsonData.preDelay+this._jsonData.postDelay+e*this._jsonData.repeats*this._jsonData.timeScale};n.prototype.getJSONData=function(){return this._jsonData};n.prototype.getNodeBoundaryProperty=function(e,t,i){var s;var n;if(i){n=this._nodeEndPropertiesMap}else{n=this._nodeStartPropertiesMap}if(n){var r=n.get(e);if(r){s=r[t]}}return s};n.prototype._hasCompleteNodesBoundaryProperties=function(){if(!this._nodeEndPropertiesMap||!this._nodeEndPropertiesMap.size||!this._nodeStartPropertiesMap||!this._nodeStartPropertiesMap.size){return false}return true};n.prototype._clearNodesBoundaryProperties=function(){if(this._nodeEndPropertiesMap){this._nodeEndPropertiesMap.clear()}if(this._nodeStartPropertiesMap){this._nodeStartPropertiesMap.clear()}};n.prototype._setCurrentNodesPropertiesAsBoundary=function(e,t,i){if(!i&&(this._nodeEndPropertiesMap&&this._nodeEndPropertiesMap.size&&t||this._nodeStartPropertiesMap&&this._nodeStartPropertiesMap.size&&!t)){return}var s;if(t){if(!this._nodeEndPropertiesMap){this._nodeEndPropertiesMap=new Map}else{this._nodeEndPropertiesMap.clear()}s=this._nodeEndPropertiesMap}else{if(!this._nodeStartPropertiesMap){this._nodeStartPropertiesMap=new Map}else{this._nodeStartPropertiesMap.clear()}s=this._nodeStartPropertiesMap}var n=this.getSequence();if(n){n._getCurrentNodesProperties(e,s)}};n.prototype._getNodeEndPropertiesMap=function(){return this._nodeEndPropertiesMap};n.prototype._getNodeStartPropertiesMap=function(){return this._nodeStartPropertiesMap};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationPlayer", ["sap/ui/core/Element","./Core","./AnimationMath","./AnimationTrackType","./AnimationTrackValueType","./glMatrix","sap/ui/core/Core"],function(e,t,a,i,r,n,o){"use strict";var s=e.extend("sap.ui.vk.AnimationPlayer",{metadata:{library:"sap.ui.vk",associations:{viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{viewActivated:{type:"sap.ui.vk.View"},beforeTimeChanged:{time:{type:"float"},nextTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},nextPlayback:{type:"sap.ui.vk.AnimationPlayback"}},timeChanged:{time:{type:"float"},previousTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},previousPlayback:{type:"sap.ui.vk.AnimationPlayback"}},stateChanged:{playing:{type:"boolean"},stopped:{type:"boolean"},endOfAnimation:{type:"boolean"}}}},constructor:function(a,i){e.apply(this,arguments);t.observeLifetime(this)}});s.prototype._getViewStateManager=function(){var e=this.getViewStateManager();return e?o.byId(e):undefined};s.prototype.init=function(){this._step=this._step.bind(this);this._playbackCollection=null;this._currentPlayback=null;this._time=0;this._nodeChanges=new Map;t.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);t.getEventBus().subscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);t.getEventBus().subscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);t.getEventBus().subscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);t.getEventBus().subscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this)};s.prototype.exit=function(){this._playbackCollection=null;this._currentPlayback=null;t.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);t.getEventBus().unsubscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this)};s.prototype._onViewApplied=function(e,t,a){if(a.source==null||a.source.getId()!==this.getViewStateManager()){return}var i=a.view;var r=a.ignoreAnimationPosition;this.activateView(i,r)};s.prototype._onSequenceChanged=function(e,t,a){if(this._currentPlayback){var i=this._getViewStateManager();var r=this._currentPlayback.getSequence();if(i&&r){if(r.getId()===a.sequenceId){i.setJoints(r.getJoint(),this._currentPlayback)}}}this._clearPlaybackBoundaryProperties();this._setPlaybackBoundaryProperties()};s.prototype._resetNodesAnimation=function(e,t){if(!Array.isArray(e)){e=[e]}var a=this._getViewStateManager();e.forEach(function(e){if(t){a.resetNodeProperty(e,t)}else{a.resetNodeProperty(e);a.resetNodeProperty(e,i.Opacity)}})};s.prototype._onPlaybacksChanged=function(e,t,a){if(a.operation==="playbackRemoved"&&this._currentPlayback&&this._currentPlayback===a.playback&&this._currentPlayback.getSequence()){var i=this._currentPlayback.getSequence().getNodeAnimation();var r=i.map(function(e){return e.nodeRef});this._resetNodesAnimation(r)}this._clearPlaybackBoundaryProperties()};s.prototype._onTrackChanged=function(e,t,a){if(a.emptyTrack&&this._currentPlayback){var r=this._getViewStateManager();var n=this._currentPlayback.getSequence();if(r&&n){var o=n.getNodeAnimation();o.forEach(function(e){for(var t in i){var n=i[t];var o=e[n];if(o&&o.getId()===a.trackId){r.resetNodeProperty(e.nodeRef,n);return}}})}this._setPlaybackBoundaryProperties()}};s.prototype._onNodeAnimationRemoved=function(e,t,a){if(this._currentPlayback){var i=this._getViewStateManager();var r=this._currentPlayback.getSequence();if(i&&r){if(r.getId()===a.sequenceId){i.setJoints(r.getJoint(),this._currentPlayback);this._resetNodesAnimation(a.nodeRefs,a.property)}}}this._clearPlaybackBoundaryProperties()};s.prototype.getAnimatedProperty=function(e,t){var a={};var r=this._getViewStateManager();if(!r){return null}if(t!==i.Opacity){var n=r.getTransformationWorld(e);if(t===i.Rotate){a.world=n.quaternion}else if(t===i.Translate){a.world=n.translation}else{a.world=n.scale}}var o=this._nodeChanges.get(e);if(!o||o[t]===undefined){a.offsetToPrevious=null;a.offsetToRest=null;if(t===i.Opacity){a.absolute=r.getOpacity(e);a.totalOpacity=r.getTotalOpacity(e)}else{var s=r.getTransformation(e);if(t===i.Rotate){a.absolute=s.quaternion}else if(t===i.Translate){a.absolute=s.translation}else{a.absolute=s.scale}}return a}if(t===i.Opacity){var l=o[t];a.offsetToRest=l;a.offsetToPrevious=o.offsetToPrevious[t];a.opacity=o.absolute.opacity;a.totalOpacity=o["totalOpacity"];return a}var u=o[t];a.offset=u;if(t===i.Rotate){a.absolute=o.absolute.quaternion}else if(t===i.Translate){a.absolute=o.absolute.translate}else{a.absolute=o.absolute.scale}a.offsetToPrevious=o.offsetToPrevious[t];a.offsetToRest=o[t];return a};s.prototype.setTime=function(e,t,a){this._setPlaybackBoundaryProperties();this._setTime(e,t,a);return this};s.prototype._setTime=function(e,t,a){var r=this._time;var n=this._currentPlayback;if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){this._currentPlayback=undefined;this._time=0}else{if(t!=null){e=this._getAbsoluteTime(e,t)}var o=this._getViewStateManager();var s=this._currentPlayback;var l;if(e<0||e>this.getTotalDuration()){l=undefined}else if(t!=null){l=this._playbackCollection.getPlayback(t)}else{l=this._findPlaybackByAbsoluteTime(e)}var u=false;if(l&&l.getReversed()){if(this._currentPlayback&&l.getJSONData().startTime>this._currentPlayback.getJSONData().startTime){u=true}}else if(l&&this._currentPlayback&&l.getJSONData().startTime<this._currentPlayback.getJSONData().startTime){u=true}if(!a&&(e!==this._time||l!==this._currentPlayback)){this.fireBeforeTimeChanged({time:this._time,nextTime:e,currentPlayback:this._currentPlayback,nextPlayback:l})}this._time=e;this._currentPlayback=l;if(o&&this._currentPlayback&&s!==this._currentPlayback){var c=this._currentPlayback.getSequence();if(c){o.setJoints(c.getJoint(),this._currentPlayback)}}else if(!this._currentPlayback||!this._currentPlayback.getSequence()){o.setJoints(undefined)}if(o){var f={nodeRefs:[],positions:[]};var y={nodeRefs:[],opacities:[]};this._collectNodeChanges();this._nodeChanges.forEach(function(e,t){var a={rtranslate:e.rtranslate,rscale:e.rscale,rrotate:e.rrotate,Euler:e.Euler,ropacity:e.offsetToPrevious&&e.offsetToPrevious.ropacity?e.offsetToPrevious.ropacity:e.ropacity};o.setInterpolatedRelativeValues(t,a);var r=o.getRestTransformation(t);var n=o._addToTransformation(r,e.rtranslate,e.rrotate,e.rscale,e.originalRotationType,e.Euler);if(n){f.nodeRefs.push(t);f.positions.push(n);e.absolute={};e.absolute.translate=n.translation;e.absolute.scale=n.scale;e.absolute.quaternion=n.quaternion}if(u&&e[i.Opacity]===undefined){e[i.Opacity]=1;t.userData.opacity=undefined}if(e[i.Opacity]!==undefined){var s=o.getRestOpacity(t);if(s===0){s=1}var l=e[i.Opacity]*s;t.userData.animatedOpacity=true;e.absolute={};e.absolute.opacity=l;y.nodeRefs.push(t);y.opacities.push(l)}},this);o.setTransformation(f.nodeRefs,f.positions);o.setOpacity(y.nodeRefs,y.opacities);o._propagateOpacityToJointChildren(y.nodeRefs,y.opacities);o._setJointNodeMatrix();this._nodeChanges.forEach(function(e,t){if(e[i.Opacity]!==undefined){e.totalOpacity=o.getTotalOpacity(t)}},this)}}if(!a&&(this._time!==r||this._currentPlayback!==n)){this.fireTimeChanged({time:this._time,previousTime:r,currentPlayback:this._currentPlayback,previousPlayback:n})}};s.prototype.getTime=function(){return this._time};s.prototype.getCurrentPlayback=function(){return this._currentPlayback};s.prototype.getCurrentPlaybackTime=function(){var e=this._time;var t=this._playbackCollection.getPlaybacks();if(!Array.isArray(t)||!this.getCurrentPlayback()){return-1}var a=0;while(t[a]!=this.getCurrentPlayback()){e-=t[a].getDuration();a++}return e};s.prototype.getStartTime=function(e){if(!this._playbackCollection){return undefined}if(typeof e==="number"){e=this._playbackCollection.getPlayback(e)}return e?e.getStartTime():undefined};s.prototype.getTotalDuration=function(){if(!this._playbackCollection){return 0}var e=0;this._playbackCollection.getPlaybacks().forEach(function(t){e+=t.getDuration()});return e};s.prototype._step=function(e){if(!this._lastFrameTimestamp){this._lastFrameTimestamp=e}var t=e-this._lastFrameTimestamp;this._lastFrameTimestamp=e;var a=this.getTime()+t/1e3;var i=a>=0&&a<=this.getTotalDuration();if(a>this.getTotalDuration()){a=this.getTotalDuration()}this.setTime(a);if(i){this._frameId=window.requestAnimationFrame(this._step)}else{this.stop()}};s.prototype._interpolate=function(e,t,i,n,o){if(!t.before&&!t.after){return undefined}if(!t.before){t.before=t.after}if(!t.after){if(e===r.AngleAxis){t.after={value:[0,0,1,0],time:t.before.time}}else{t.after=t.before}}var s;if(t.before.time===t.after.time){s=1}else{s=(t.time-t.before.time)/(t.after.time-t.before.time)}return a.interpolate(e,t.before,t.after,s,i,n,o)};s.getBoundaryKey=function(e,t){var i=e.getKeysCount();if(!i){return null}var n;if(t){n=e.getKey(0)}else{n=e.getKey(i-1)}var o=e.getKeysType();var s,l={};if(o===r.Euler){l[o]=n.value;s=a.neutralEulerToGlMatrixQuat(n.value);l.value=a.glMatrixQuatToNeutral(s);l.time=n.time}else if(o===r.Quaternion){s=a.neutralQuatToGlMatrixQuat(n.value);l.value=a.glMatrixQuatToNeutral(s);l.time=n.time}else if(o!==r.AngleAxis){l.value=n.value;l.time=n.time}else{var u;var c=1;if(t){u=n;if(i>1){u=e.getKey(1);c=0}}else{u=n;if(i>1){n=e.getKey(i-2)}}l=a.interpolate(o,n,u,c,e);l.time=t?n.time:u.time}return l};s.prototype._getKeyFramesBracket=function(e,t){var a=t.getKeysCount();if(a===0){return null}var i={time:e,before:undefined,after:undefined};for(var r=0;r<a;r++){var n=t.getKey(r);if(n.time===e){i.before=i.after=n;break}else if(n.time>e){i.before=r===0?undefined:t.getKey(r-1);i.after=n;break}}if(!i.before&&!i.after&&a>0){i.before=t.getKey(a-1)}if(a>1&&(!i.after&&t.isCycleForward()||!i.before&&t.isCycleBackward())){var o=t.getKey(0).time;var s=t.getKey(a-1).time-o;var l=Math.floor((e-o)/s);var u=e-s*l;return this._getKeyFramesBracket(u,t)}return i};s.prototype._collectNodeChangesFromPlaybackBoundaryKeys=function(e,t,a){var r=t.getSequence();if(!r){return}var n=r.getNodeAnimation();if(!n){return}var o=this._getViewStateManager();var s=this;var l=function(t,a,r){if(!t||!a||r===undefined||r===null){return}var n=e.get(t);if(n&&n.hasOwnProperty(a)){return}if(!n){n={};e.set(t,n)}if(!n.offsetToPrevious){n.offsetToPrevious={}}if(a===i.Opacity){n[a]=r;if(!n.offsetToPrevious[a]){var l=o.getOpacity(t);var u=o.getRestOpacity(t);if(u===0){u=1}if(u>0&&(l!==undefined||l!==null)){var c=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(c){l/=c}n.offsetToPrevious[a]=l/u}else{n.offsetToPrevious[a]=1}}}else{n[a]=r.slice();var f=o.getRelativeTransformation(t);if(a===i.Scale){if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=f.scale.slice();var y=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(y){n.offsetToPrevious[a][0]/=y[0];n.offsetToPrevious[a][1]/=y[1];n.offsetToPrevious[a][2]/=y[2]}}}if(a===i.Translate){if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=f.translation.slice();var h=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(h){n.offsetToPrevious[a][0]-=h[0];n.offsetToPrevious[a][1]-=h[1];n.offsetToPrevious[a][2]-=h[2]}}}if(a===i.Rotate){n.offsetToPrevious[a]=[0,0,1,0]}else if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=[0,0,0]}}};var u;if(a){u=t._getNodeEndPropertiesMap()}else{u=t._getNodeStartPropertiesMap()}if(!u){return}var c=this._currentPlayback&&this._currentPlayback.getSequence();if(c){u.forEach(function(e,t){for(var a in e){if(c._isNodePropertyDefined(t,a)){continue}l(t,a,e[a])}},this)}};s.prototype._collectSequenceNodeChanges=function(e,t,o){var s=o.getSequence();var l=s&&s.getNodeAnimation();if(!l){return}var u=this._getViewStateManager();var c=function(e,s,l,c){if(!e||!s||!l||l.value===undefined||l.value===null){return}var f=t.get(e);if(!f){f={};t.set(e,f)}if(!f.animationProperties){f.animationProperties={}}f.animationProperties[s]=true;if(c){f.originalRotationType=c}if(!f.offsetToPrevious){f.offsetToPrevious={}}var y;if(s===i.Opacity){f[s]=l.value;f.offsetToPrevious[s]=l.value;y=u._getEndPropertyInPreviousPlayback(e,s,o,true);if(y){f[s]*=y}}else{f[s]=l.value.slice();f.offsetToPrevious[s]=l.value.slice();y=u._getEndPropertyInPreviousPlayback(e,s,o);if(y){if(s===i.Translate){f[s][0]+=y[0];f[s][1]+=y[1];f[s][2]+=y[2]}else if(s===i.Scale){f[s][0]*=y[0];f[s][1]*=y[1];f[s][2]*=y[2]}}}if(c===r.Euler||c===r.AngleAxis){f[c]=l[c].slice();f.offsetToPrevious[s]=l[c].slice();if(y){var h=a.neutralQuatToGlMatrixQuat(y);var p=a.neutralQuatToGlMatrixQuat(f[s]);var g=n.quat.multiply(n.quat.create(),p,h);f[s]=a.glMatrixQuatToNeutral(g)}}};var f=o.getReversed();var y=s.getDuration();l.forEach(function(t){var a;for(var n in i){var o=i[n];var s=t[o];if(s&&s.getKeysCount()>0){a=this._getKeyFramesBracket(e,s);if(!a){return}var l=s.getKeysType();var u=null;if(f){if(l===r.AngleAxis){u=this._interpolate(l,a,s,o,true)}else{var h=this._getKeyFramesBracket(y,s);var p=this._interpolate(l,h,s,o);u=this._interpolate(l,a,s,o,p.value)}}else{u=this._interpolate(l,a,s,o)}if(o===i.Rotate){c(t.nodeRef,o,u,l)}else{c(t.nodeRef,o,u)}}}},this)};s.prototype._collectPlaybackNodeChanges=function(e,t,a){var i=a.getSequence();if(!i){return}var r=e-a.getStartTime();if(r<0){return}var n=i.getDuration()*a.getTimeScale()*a.getRepeats();var o=(r-a.getPreDelay())/a.getTimeScale();var s=1e-4;if(o>0&&o%i.getDuration()===0){o=i.getDuration()}else if(o>i.getDuration()+s){o=o%i.getDuration()}else if(o>i.getDuration()){o=i.getDuration()}o=a.getReversed()?i.getDuration()-o:o;if(r<a.getPreDelay()){this._collectSequenceNodeChanges(0,t,a)}else if(r>a.getPreDelay()+n){this._collectSequenceNodeChanges(i.getDuration()*a.getRepeats(),t,a)}else{this._collectSequenceNodeChanges(o,t,a)}};s.prototype._collectNodeChanges=function(){this._nodeChanges.clear();if(!this._currentPlayback){return}var e=this._playbackCollection.getPlaybacks();var t=this.getTime();var a;var i=0;for(a=0;a<e.length;a++){if(this._currentPlayback&&this._currentPlayback!==e[a]){continue}this._collectPlaybackNodeChanges(t,this._nodeChanges,e[a]);i=a}if(!this._currentPlayback.getReversed()){for(a=i-1;a>=0;a--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],true)}for(a=i+1;a<e.length;a++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],false)}}else{for(a=i+1;a<e.length;a++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],false)}for(a=i-1;a>=0;a--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],true)}}};s.prototype._clearPlaybackBoundaryProperties=function(){if(!this._playbackCollection){return}var e=this._playbackCollection.getPlaybacks();for(var t=0;e&&t<e.length;t++){var a=e[t];if(!a){continue}a._clearNodesBoundaryProperties()}};s.prototype._setPlaybackBoundaryProperties=function(e){if(!this._playbackCollection){return}var t=this._time;var a=this._currentPlayback;var i=false;var r=this._playbackCollection.getPlaybacks();var n;var o=0;var s,l;if(e){this._clearPlaybackBoundaryProperties()}for(n=0;n<r.length;n++){s=r[n];if(!s){continue}var u=this._getViewStateManager();l=s.getSequence();if(u&&l){if(!e&&s._hasCompleteNodesBoundaryProperties()){continue}o=s.getPreDelay();this._setTime(o,n,true);s._setCurrentNodesPropertiesAsBoundary(u,false,e);o+=l.getDuration()*s.getTimeScale()*s.getRepeats();this._setTime(o,n,true);s._setCurrentNodesPropertiesAsBoundary(u,true,e);i=true}}if(i){if(!a){this._time=t;this._setTime(this._time,null,true);this._currentPlayback=a}else{var c=-1;var f=0;for(n=0;n<r.length;n++){s=r[n];if(s===a){c=n;break}var y=0;l=s.getSequence();if(l){y=l.getDuration()*s.getTimeScale()*s.getRepeats()}f+=s.getPreDelay()+y+s.getPostDelay()}if(c!==-1){var h=t-f;this._setTime(h,c,true)}}}};s.prototype.play=function(){this._lastFrameTimestamp=undefined;this._frameId=window.requestAnimationFrame(this._step);t.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:true,stopped:false,endOfAnimation:false});this.fireStateChanged({playing:true,stopped:false});return this};s.prototype.stop=function(){if(this._frameId){window.cancelAnimationFrame(this._frameId);this._frameId=undefined}this._lastFrameTimestamp=undefined;this.fireStateChanged({playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});t.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});return this};s.prototype.activateView=function(e,t){this.stop();var a=this._getViewStateManager();var i=e.getPlaybacks();if(i&&i.length>0){for(var r=0;r<i.length;r++){var n=i[r];var o=n.getSequence();if(o){a._convertTracksToRelative(o,n.getReversed())}}}if(!t){this._playbackCollection=e}else{this._playbackCollection=undefined}this._currentPlayback=undefined;this.setTime(0);if(t){this._playbackCollection=e}this.fireViewActivated({view:e});return this};s.prototype._getAbsoluteTime=function(e,t){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return-1}var a=this._playbackCollection.getPlaybacks();if(t<0||t>=a.length){return-1}var i=this._playbackCollection.getPlayback(t);if(!i||i.getDuration()<e||e<0){return-1}var r=e;var n=0;while(n<t){var o=a[n].getDuration();r+=o;n++}return r};s.prototype._findPlaybackByAbsoluteTime=function(e){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return undefined}var t=this._playbackCollection.getPlaybacks();var a=-1;var i=-1;t.forEach(function(e,t){if(e.getStartTime()>i){a=t;i=e.getStartTime()}});var r=0;while(r<t.length){var n=t[r].getDuration();var o=t[r].getStartTime();if(r!==a&&e>=o&&e<o+n||r===a&&e>=o&&e<=o+n){return t[r]}r++}return undefined};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationRotateType", [],function(){"use strict";var e={AngleAxis:"AngleAxis",Euler:"Euler",Quaternion:"Quaternion"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationSequence", ["sap/ui/base/Object","./AnimationTrackType","./findIndexInArray","./AnimationPlayer","./AnimationTrack","./Core"],function(t,e,n,i,a,o){"use strict";var s=t.extend("sap.ui.vk.AnimationSequence",{constructor:function(t,e){this._jsonData={};this._jsonData.id=t;this._jsonData.name=e&&e.name?e.name:"";this._jsonData.duration=e&&e.duration?e.duration:1;this._jsonData.joints=[];this._jsonData.nodes=[];this._trackMap=new Map}});s.prototype.setJSONModel=function(t){this._model=t;return this};s.prototype.getId=function(){return this._jsonData.id};s.prototype.getName=function(){return this._jsonData.name};s.prototype.setName=function(t){this._jsonData.name=t;if(this._model){this._model.updateBindings()}return this};s.prototype.getDuration=function(){return this._jsonData.duration};s.prototype.setDuration=function(t,e){this._jsonData.duration=t;if(this._model){this._model.updateBindings()}if(!e){this._fireSequenceChanged()}return this};s.prototype._findJointIndex=function(t,e){var i=this._jsonData.joints.filter(function(t){return t.node&&t.parent});return n(i,function(n){return(t?n.parent==t:true)&&(e?n.node==e:true)})};s.prototype.setJoint=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(function(t){var e=this._findJointIndex(t.parent,t.node);if(e<0){if(!t.parentSid&&t.parent&&t.parent.userData&&t.parent.userData.treeNode){t.parentSid=t.parent.userData.treeNode.sid}if(!t.nodeSid&&t.node&&t.node.userData&&t.node.userData.treeNode){t.nodeSid=t.node.userData.treeNode.sid}t.type="RELATIVE";this._jsonData.joints.push(t)}},this);if(this._model){this._model.updateBindings()}if(!e){this._fireSequenceChanged()}return this};s.prototype.getJoint=function(t){var e;if(!t||!t.parent&&!t.node){e=this._jsonData.joints}else if(t&&t.node){e=this._jsonData.joints.filter(function(e){return e.node==t.node&&(t.parent?e.parent==t.parent:true)})}else if(t&&t.parent&&!t.node){e=this._jsonData.joints.filter(function(e){return e.parent==t.parent})}return e};s.prototype.removeJoint=function(t){var e=[];if(!t){this._jsonData.joints.forEach(function(t){e.push(t.node)});this._jsonData.joints.splice(0)}else if(t&&(t.node||t.parent)){var n;do{n=this._findJointIndex(t.parent,t.node);if(n>=0){e.push(this._jsonData.joints[n].node);this._jsonData.joints.splice(n,1)}}while(n>=0)}if(this._model){this._model.updateBindings()}if(e.length){o.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:e,sequenceId:this._jsonData.id})}return this};s.prototype._findNodeIndex=function(t){return n(this._jsonData.nodes,function(e){return e?e.nodeRef==t:true})};s.prototype.getNodeAnimation=function(t,n){var i=function(t,n){var i=this._findNodeIndex(t);var a,o;if(i!==-1){a=this._jsonData.nodes[i]}if(a){if(n){if(a[n]){o=this._trackMap.get(a[n])}}else{o={nodeRef:t};for(var s in e){var r=e[s];if(a[r]){o[r]=this._trackMap.get(a[r])}}}}return o}.bind(this);var a;if(t&&!Array.isArray(t)){return i(t,n)}else if(!t){a=[];this._jsonData.nodes.forEach(function(t){a.push(i(t.nodeRef,n))},this)}else{a=[];t.forEach(function(t){a.push(i(t,n))},this)}return a};s.prototype.setNodeAnimation=function(t,e,n,i){var a=this._findNodeIndex(t);var o;if(a!==-1){o=this._jsonData.nodes[a]}if(!o){o={};o.nodeRef=t;if(t.userData&&t.userData.treeNode){o.sid=t.userData.treeNode.sid}this._jsonData.nodes.push(o)}o[e]=n.getJSONData();this._trackMap.set(n.getJSONData(),n);n.setJSONModel(this._model);if(this._model){this._model.updateBindings()}if(!i){this._fireSequenceChanged()}return this};s.prototype.removeNodeAnimation=function(t,e,n){var i=this._findNodeIndex(t);if(i===-1){return this}var a=this._jsonData.nodes[i];var s;if(!e){for(var r in a){s=this._trackMap.get(a[r]);if(s){s.setJSONModel(null);this._trackMap.delete(a[r])}}this._jsonData.nodes.splice(i,1)}else{s=this._trackMap.get(a[e]);if(s){s.setJSONModel(null);this._trackMap.delete(a[e]);delete a[e]}}if(this._model){this._model.updateBindings()}if(!n){o.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:[t],property:e,sequenceId:this._jsonData.id})}return this};s.prototype.resetDuration=function(t){var e=0;this._jsonData.nodes.forEach(function(t){var n;for(var i in t){if(i==="sid"){continue}var a=this._trackMap.get(t[i]);if(a){if(a.getKeysCount()){var o=a.getKey(a.getKeysCount()-1);n=o.time}if(n&&n>e){e=n}}}},this);if(e>0){this._jsonData.duration=e;if(this._model){this._model.updateBindings()}}if(!t){this._fireSequenceChanged()}return this};s.prototype.getNodesBoundaryValues=function(t){var e=new Map;var n=function(t,n,i){var a=e.get(t);if(!a){a={};e.set(t,a)}a[n]=i};this._jsonData.nodes.forEach(function(e){for(var a in e){if(a==="sid"){continue}var o=this._trackMap.get(e[a]);if(o&&o.getKeysCount()){var s=i.getBoundaryKey(o,t);n(e.nodeRef,a,s.value)}}}.bind(this));return e};s.prototype._fireSequenceChanged=function(){o.getEventBus().publish("sap.ui.vk","sequenceChanged",{sequenceId:this._jsonData.id})};s.prototype._isNodePropertyDefined=function(t,e){var n=this.getNodeAnimation(t,e);if(n&&n.getKeysCount()){return true}var i={node:t};var a=this.getJoint(i);if(a&&a.length){return true}return false};s.prototype._getCurrentNodesProperties=function(t,n){this._jsonData.nodes.forEach(function(i){var a={};var o=t.getRelativeTransformation(i.nodeRef);for(var s in i){if(s===e.Rotate){a[e.Rotate]=o.quaternion.slice()}else if(s===e.Translate){a[e.Translate]=o.translation.slice()}else if(s===e.Scale){a[e.Scale]=o.scale.slice()}else if(s===e.Opacity){var r=t.getOpacity(i.nodeRef);var d=t.getRestOpacity(i.nodeRef);if(r!==null&&r!==undefined){if(!d){d=1}a[e.Opacity]=r/d}}}n.set(i.nodeRef,a)});this._jsonData.joints.forEach(function(i){if(!i.node||!i.parent){return}var a={};var o=t.getRelativeTransformation(i.node);a[e.Rotate]=o.quaternion.slice();a[e.Translate]=o.translation.slice();a[e.Scale]=o.scale.slice();var s=t.getOpacity(i.node);var r=t.getRestOpacity(i.node);if(s!==null&&s!==undefined){if(!r){r=1}a[e.Opacity]=s/r}n.set(i.node,a)})};s.prototype.getJSONData=function(){return this._jsonData};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTimeSlider", ["sap/m/Slider","./AnimationTimeSliderRenderer"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.AnimationTimeSlider",{metadata:{library:"sap.ui.vk"}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}};i.prototype.handleAnimationStarted=function(t){this.setProgress(true);this.setValue(0);this.setStep(.1)};i.prototype.handleAnimationUpdated=function(t){var e=t.getParameter("value");this.setValue(e)};i.prototype.handleAnimationFinished=function(t){this.setValue(100)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTimeSliderRenderer", ["sap/m/SliderRenderer"],function(e){"use strict";return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrack", ["sap/ui/base/Object","./AnimationTrackValueType","./findIndexInArray","./Core"],function(t,e,i,s){"use strict";var n=t.extend("sap.ui.vk.AnimationTrack",{constructor:function(t,i){this._jsonData={};this._jsonData.id=t;this._jsonData.type=i&&i.trackValueType?i.trackValueType:e.Scalar;this._jsonData.keys=[];this._jsonData.cycleForward=!!(i&&i.cycleForward);this._jsonData.cycleBackward=!!(i&&i.cycleBackward);this._jsonData.infinite=!!(i&&i.infinite);this._jsonData._isAbsoluteValue=i&&i.isAbsoluteValue?i.isAbsoluteValue:false}});n.prototype.setJSONModel=function(t){this._model=t;return this};n.prototype.getIsAbsoluteValue=function(){return this._jsonData._isAbsoluteValue};n.prototype.setIsAbsoluteValue=function(t){this._jsonData._isAbsoluteValue=t};n.prototype.getId=function(){return this._jsonData.id};n.prototype.getKeysType=function(){return this._jsonData.type};n.prototype.setKeysType=function(t){if(this.getKeysCount()>0){return false}this._jsonData.type=t;return true};n.prototype.isCycleForward=function(){return this._jsonData.cycleForward};n.prototype.setCycleForward=function(t){this._jsonData.cycleForward=t;if(this._model){this._model.updateBindings()}return this};n.prototype.isCycleBackward=function(){return this._jsonData.cycleBackward};n.prototype.setCycleBackward=function(t){this._jsonData.cycleBackward=t;if(this._model){this._model.updateBindings()}return this};n.prototype.isInfinite=function(){return this._jsonData.infinite};n.prototype.setInfinite=function(t){this._jsonData.infinite=t;if(this._model){this._model.updateBindings()}return this};n.prototype.getKeysCount=function(){return this._jsonData.keys.length};n.prototype.getKey=function(t){if(t<0||t>=this._jsonData.keys.length){return undefined}return this._jsonData.keys[t]};n.prototype.updateKey=function(t,e,i){if(t>=0||t<this._jsonData.keys.length){this._jsonData.keys[t].value=e;if(this._model){this._model.updateBindings()}}if(!i){this._fireTrackChanged()}return this};n.prototype.removeKey=function(t,e){var i=false;if(t>=0||t<this._jsonData.keys.length){this._jsonData.keys.splice(t,1);if(this._jsonData.keys.length===0){i=true}if(this._model){this._model.updateBindings()}}if(!e){this._fireTrackChanged(i)}return this};n.prototype.findKeyIndex=function(t){var e=-1;if(this._jsonData.keys.length===1){e=0}else if(this._jsonData.keys.length>1){for(var i=1;i<this._jsonData.keys.length;i++){var s=this.getKey(i-1);var n=this.getKey(i);if(t>=s.time&&t<=n.time){e=t-s.time<n.time-t?i-1:i;break}}}return e};n.prototype.insertKey=function(t,e,s){var n=i(this._jsonData.keys,function(e){return e.time===t});if(n<0){this._jsonData.keys.push({time:t,value:e});this._jsonData.keys.sort(function(t,e){return t.time-e.time})}else{this.updateKey(n,e,true);if(this._model){this._model.updateBindings()}}if(!s){this._fireTrackChanged()}return this};n.prototype._fireTrackChanged=function(t){s.getEventBus().publish("sap.ui.vk","trackChanged",{trackId:this._jsonData.id,emptyTrack:t})};n.prototype.getJSONData=function(){return this._jsonData};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackType", [],function(){"use strict";var r={Rotate:"rrotate",Translate:"rtranslate",Scale:"rscale",Opacity:"ropacity",Color:"color"};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackValueType", [],function(){"use strict";var e={Scalar:"Scalar",Vector3:"Vector3",AngleAxis:"AngleAxis",Quaternion:"Quaternion",Euler:"Euler"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackValueTypeSize", ["./AnimationTrackValueType"],function(e){"use strict";var r={};r.get=function(r){switch(r){case e.Vector3:return 3;case e.AngleAxis:return 4;case e.Quaternion:return 4;case e.Euler:return 4;default:return 1}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Annotation", ["sap/ui/core/Control","./Core","./AnnotationStyle","./NodeUtils","sap/m/FormattedText","sap/ui/richtexteditor/RichTextEditor","sap/ui/richtexteditor/library","./AnnotationRenderer","sap/ui/core/Core"],function(t,e,i,n,o,h,a,d,l){"use strict";var s=t.extend("sap.ui.vk.Annotation",{metadata:{library:"sap.ui.vk",properties:{annotationId:"string",name:"string",nodeRef:"any",text:{type:"string",defaultValue:""},style:{type:"sap.ui.vk.AnnotationStyle",defaultValue:i.Default},display:{type:"boolean",defaultValue:false},animate:{type:"boolean",defaultValue:true},animationDelay:{type:"float",defaultValue:-1},selected:{type:"boolean",defaultValue:false},editable:{type:"boolean",defaultValue:false},xCoordinate:{type:"float",defaultValue:0},yCoordinate:{type:"float",defaultValue:0},xOffset:{type:"float",defaultValue:0},yOffset:{type:"float",defaultValue:0},height:{type:"float"},width:{type:"float"}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},aggregations:{textEditor:{type:"sap.ui.core.Control",multiple:false}}},constructor:function(e,i){t.apply(this,arguments);if(this._viewport==null){this._topLimit=-.5;this._leftLimit=-.5}}});s.prototype.setViewport=function(t){this.setAssociation("viewport",t);this._viewport=l.byId(this.getViewport());if(this._viewport.getSafeArea().getDomRef()){var e=this._viewport.getSafeArea().getDomRef().getBoundingClientRect();var i=this._viewport.getDomRef().getBoundingClientRect();var n=i.left-e.left;var o=i.top-e.top;var h=this._viewport.normalizeRectangle(0,0,n,o);this._topLimit=-.5+h.height;this._leftLimit=-.5+h.width}};s.prototype._firePositionChanged=function(t){e.getEventBus().publish("sap.ui.vk","annotationPositionChanged",{annotation:t,x:t.getXCoordinate(),y:t.getYCoordinate()})};s.prototype._fireSizeChanged=function(t,i,n){e.getEventBus().publish("sap.ui.vk","annotationSizeChanged",{annotation:t,width:i,height:n})};s.prototype.getTargetNodes=function(){this._targetNodes=this._targetNodes||[];return this._targetNodes};s.prototype.getAttachmentNode=function(){return this._attachmentNode};s.prototype.setAttachmentNode=function(t){this._attachmentNode=t;if(t){this.rerender()}};s.prototype.getDisplay=function(){if(this.getNodeRef()){var t=l.byId(this._viewport.getViewStateManager());return t.getVisibilityState(this.getNodeRef())}return this.getProperty("display")};s.prototype.setDisplay=function(t){var e=l.byId(this._viewport.getViewStateManager());var i=this.getNodeRef();if(i&&e.getVisibilityState(i)!==t){e.setVisibilityState(i,t)}if(this.getProperty("display")===t){return this}this.setProperty("display",t,true);var n=this.getDomRef();if(n){if(t){this._reverse=false;this.rerender()}else{this._reverse=true;this.rerender()}}return this};s.prototype.getSelected=function(){if(this.getNodeRef()){var t=l.byId(this._viewport.getViewStateManager());return t.getSelectionState(this.getNodeRef())}return this.getProperty("selected")};s.prototype.setSelected=function(t){this.setProperty("selected",t,!this.getEditable());if(t){this._setMaxZ()}var e=l.byId(this._viewport.getViewStateManager());var i=this.getNodeRef();if(e.getSelectionState(i)!==t){e.setSelectionState(i,t)}var n=this;var o=function(t){var e=n._textDiv.getDomRef();if(e==null){return}t.stopPropagation();e.scrollTo(e.scrollLeft+t.deltaX,e.scrollTop+t.deltaY)};if(t){this._localScroll=o;document.addEventListener("wheel",o,true)}else{if(this._localScroll){document.removeEventListener("wheel",this._localScroll,true)}this._localScroll=undefined}this._moving=false;return this};s.prototype.setAnnotationId=function(t){this.setProperty("annotationId",t,true);if(this._viewport&&this.sourceData){this._viewport.getScene().setAnnotationPersistentId(this.sourceData.annotation,t)}};s.prototype._getNodeRefScreenCenter=function(t,e){var i=n.centerOfNodes([e]);return t.projectToScreen(i[0],i[1],i[2],t.getCamera())};s.prototype._getSortIndex=function(t){this.zIndex=this.zIndex||"auto";var e=this.getTargetNodes()[0];if(e){var i=n.centerOfNodes([e]);var o=t.projectToScreen(i[0],i[1],i[2],t.getCamera());this.zIndex=Math.floor(1e4*(1-o.depth))}return this.zIndex};s.prototype._getOpacity=function(){if(this._viewport){var t=this.zIndex;var e=[];this._viewport.getAnnotations().forEach(function(t){if(t.getDisplay()===true){e.push(t)}});if(e.length>1){var i=Array.from(e,function(t){return t.zIndex});var n=Math.max.apply(null,i);var o=Math.min.apply(null,i);return.7+(t-o)*.3/(n-o)}}return 1};s.prototype._updateBlocked=function(){var t=this.getTargetNodes()[0];if(this.getDisplay()&&t){var e=this._viewport;var i=this._getNodeRefScreenCenter(e,t);var n=e.hitTest(i.x,i.y);var o=this.getDomRef();if(t.visible==false){o.style.visibility="hidden"}else{o.style.visibility="visible"}if(n&&o){var h=[];t._vkTraverseMeshNodes(function(t){h.push(t)});if(h.indexOf(n.object)>=0){o.style.visibility="visible"}else{var a=l.byId(e.getViewStateManager());var d=a.getTransformationWorld(n.object).translation;var s=e.projectToScreen(d[0],d[1],d[2],e.getCamera());if(s.depth<i.depth){o.style.visibility="hidden"}}}}return this.getDisplay()};s.prototype.setName=function(t){this.setProperty("name",t);if(this.getNodeRef()){this.getNodeRef().name=t}};s.prototype.getName=function(){if(this.getNodeRef()){return this.getNodeRef().name}return this.getProperty("name")};s.prototype.setText=function(t){this.setProperty("text",t,true);if(this.sourceData){this.sourceData.annotation.text={html:t}}if(this.getTextEditor()){this._textDiv.value=t;return this}if(this._textDiv==null){this._textDiv=new o({width:this._textWidth?this._textWidth+"px":"auto",height:this._textHeight?this._textHeight+"px":"auto"});this._textDiv.addStyleClass("sapUiVizKitAnnotationText")}if(this.getStyle()===i.Random&&this.getAnimate()){this._setRandomText(t)}else if(this.getStyle()===i.Expand&&this.getAnimate()){this._setExpandText(t)}else{this._textDiv.setHtmlText(t)}this._textDiv.rerender();this.update();return this};s.prototype._setRandomText=function(t){if(this.getTextEditor()){return this}var e="";for(var i=0;i<t.length;i++){if(t[i]==="<"){e+="<";while(t[i]!==">"){i++;e+=t[i]}}if(t[i]!==">"){e+="<span class=vitAnnotation>";e+=t[i];e+="</span>"}}this._textDiv.setHtmlText(e);return this};s.prototype._setExpandText=function(t){if(this.getTextEditor()){return this}var e="";var i=t.length;for(var n=0;n<i;n++){if(t[n]==="<"){e+="<";while(t[n]!==">"){n++;e+=t[n]}}if(t[n]!==">"){e+="<span class=vitAnnotation>";e+=t[n];e+="</span>"}}this._textDiv.setHtmlText(e);return this};s.prototype.setStyle=function(t){this.setProperty("style",t);if(this.sourceData){this.sourceData.annotation.style=t}this.setText(this.getText())};s.prototype.setAnimate=function(t){this.setProperty("animate",t);if(this.sourceData){this.sourceData.annotation.animate=t}this.setText(this.getText())};s.prototype._setMaxZ=function(){var t=this.getDomRef();if(t){var e=Math.max.apply(null,this._viewport.getAnnotations().map(function(t){return t.zIndex||1}));if(!this.zIndex||this.zIndex<e){this.zIndex=e+1}t.style.zIndex=this.zIndex}};s.prototype.onclick=function(t){if(this.getTextEditor()==null&&!this._moving){if(this._firstClick){e.getEventBus().publish("sap.ui.vk","annotationDoubleClicked",{annotation:this});this._firstClick=false}else{this._firstClick=true;setTimeout(function(){if(this._firstClick){this._firstClick=false;this._viewport.tapObject(this.getNodeRef())}}.bind(this),250)}}t.stopPropagation()};s.prototype.openEditor=function(){if(!this.getEditable()){return null}var t=new h({editorType:a.EditorType.TinyMCE4,width:this._textDiv.getWidth(),height:this._textDiv.getHeight(),value:this.getText()});if(this._textDiv){this._textDiv.destroy()}t.addStyleClass("sapUiVizKitRichTextEditor");this._textDiv=t;this.setTextEditor(t);return t};s.prototype.closeEditor=function(){if(this.getTextEditor()==null){return}var t=this._textDiv.getValue();this.destroyTextEditor();this._textDiv=null;this.setText(t)};s.prototype.onAfterRendering=function(){var t=this.getDomRef();if(t){this._initialOffsetWidth=t.offsetWidth;this._initialOffsetHeight=t.offsetHeight;if(!this.getDisplay()){t.style.visibility="hidden"}if(this.getAnimate()&&this.getAnimationDelay()>0){t.style.animationDelay=this.getAnimationDelay()+"s"}if(this._textDiv){var e=this._textDiv.getDomRef();if(e){var n=this.getAnimationDelay();if(n===-1){n=0}var o="";var h=e.getElementsByTagName("span");var a;var d=[];for(var l=0;l<h.length;l++){if(h[l].className==="vitAnnotation"){d.push(h[l].style)}}if(this.getStyle()===i.Random){o=this.getAnimate()?"annotationRandomTextSpan":"annotationStatic";for(var s=0;s<d.length;s++){a=d[s];var c=n+Math.random()+"s";a.animationName=o;a.animationDuration="4s";a.animationTimingFunction="linear";a.animationDelay=c;a.animationIterationCount="1";a.animationDirection="alternate";a.animationFillMode="both"}}else if(this.getStyle()===i.Expand){o=this.getAnimate()?"annotationExpandTextSpan":"annotationStatic";for(var r=0;r<d.length;r++){a=d[r];a.animationName=o;a.animationDuration=.1/d.length*(r+1)+"s";a.animationTimingFunction="linear";a.animationDelay=n+.5+"s"}}}}this.setXCoordinate(this.getXCoordinate());this.setYCoordinate(this.getYCoordinate());this.setWidth(this.getWidth());this.setHeight(this.getHeight());this.update()}this.setEditableState(this.getEditable()&&this.getSelected());if(this.zIndex){t.style.zIndex=this.zIndex}};s.prototype.setEditable=function(t){if(this.getEditable()==t){return}this.setProperty("editable",t);if(this.sourceData){this.sourceData.annotation.editable=t}this._previousState=this._previousState||{};var e=this.getDomRef();if(e&&t){var i=e.getBoundingClientRect();this._previousState.x=i.x;this._previousState.y=i.y}};s.prototype.setHeight=function(t){if(t<0){return}this.setProperty("height",t,true);if(this.getNodeRef()){this.getNodeRef().scale.setY(t)}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var e=this._textDiv.getDomRef();var i=this._viewport.deNormalizeRectangle(0,0,0,t);var n=i.height;if(this._textDiv.getNativeApi){if(this._resized){e.style.height="calc("+i.height+"px)"}else{e.style.height="calc("+i.height+"px + 0.6rem)"}}else{e.style.height="calc("+i.height+"px - 1rem)"}var o=e.getBoundingClientRect();var h=this._viewport.getDomRef().getBoundingClientRect();if(e.clientHeight<e.scrollHeight){e.style.height="calc("+e.scrollHeight+"px - 1rem)";n=e.scrollHeight}if(n+o.y>h.y+h.height){e.style.height=Math.round(h.y+h.height-o.y).toString()+"px"}this._textDiv.setHeight(e.style.height)}};s.prototype.setWidth=function(t){if(t<0){return}this.setProperty("width",t,true);if(this.getNodeRef()){this.getNodeRef().scale.setX(t)}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var e=this._viewport.deNormalizeRectangle(0,0,t,0);var i=this._textDiv.getDomRef();var n=e.width;if(this._textDiv.getNativeApi){if(this._resized){i.style.width="calc("+e.width+"px)"}else{i.style.width="calc("+e.width+"px + 0.6rem)"}}else{i.style.width="calc("+e.width+"px - 1rem)"}if(i.clientWidth<i.scrollWidth){i.style.maxWidth=i.style.width}else{i.style.maxWidth=i.style.width}var o=i.getBoundingClientRect();var h=this._viewport.getDomRef().getBoundingClientRect();if(n+o.x+26>h.x+h.width){i.style.width=Math.round(h.x+h.width-o.x-26).toString()+"px"}this._textDiv.setWidth(i.style.width)}};s.prototype.setXCoordinate=function(t){if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){if(t<this._leftLimit){t=this._leftLimit}var e=this._viewport.normalizeRectangle(0,0,96,0);if(t>-this._leftLimit-e.width){t=-this._leftLimit-e.width}if(t<this._leftLimit){t=this._leftLimit}var i=this._viewport.deNormalizeRectangle(t,0,0,0);this.getDomRef().style.left=i.x+"px"}this.setProperty("xCoordinate",t,true);if(this.getNodeRef()){this.getNodeRef().position.setX(t)}};s.prototype.setYCoordinate=function(t){if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var e=this._textDiv.getDomRef();var i=this._viewport.normalizeRectangle(0,0,0,e.clientHeight);if(e.scrollHeight>e.clientHeight||i.height>1){e.style.setProperty("--overflow","auto")}if(t<this._topLimit){t=this._topLimit}if(t>-this._topLimit-i.height){t=-this._topLimit-i.height}if(t<this._topLimit){t=this._topLimit}var n=this._viewport.deNormalizeRectangle(0,t,0,0);this.getDomRef().style.top=n.y+"px"}this.setProperty("yCoordinate",t,true);if(this.getNodeRef()){this.getNodeRef().position.setY(t)}};s.prototype._resizeEnd=function(){this._handleViewportStop();var t=this._textDiv.getDomRef();var e=this._viewport.normalizeRectangle(0,0,t.clientWidth,t.clientHeight);this._resized=true;this.setWidth(e.width);this.setHeight(e.height);this._fireSizeChanged(this,e.width,e.height)};s.prototype.setEditableState=function(t){if(!t){this.ontouchstart=null;return}var e=new Map;var i=[];var n=this._viewport;var o=function(){i=n.getAnnotations().filter(function(t){return t.getEditable()&&t.getSelected()});i.forEach(function(t){var i=window.getComputedStyle(t._textDiv.getDomRef());var n=parseInt(i.width.slice(0,-2),10);var o=parseInt(i.height.slice(0,-2),10);var h=parseInt(i.maxWidth.slice(0,-2),10);e.set(t.getAnnotationId(),{width:n,height:o,maxWidth:h})})};var h=this;var a=this.getDomRef();var d=a.childNodes;var l={strategies:{sapUiVizKitAnnotationElement0:p,sapUiVizKitAnnotationElement1:m,sapUiVizKitAnnotationElement2:g,sapUiVizKitAnnotationElement3:v,sapUiVizKitAnnotationElement4:A,sapUiVizKitAnnotationElement5:y,sapUiVizKitAnnotationElement6:u,sapUiVizKitAnnotationElement7:I},resize:s};this.ontouchstart=function(t){var e=t||event;e.stopPropagation();o();var n=l.strategies[e.targetTouches[0].target.className];if(n){l.resize(e,n)}else{h._previousState.offsetTop=h._offsetTop;h._previousState.offsetLeft=h._offsetTop;i.forEach(function(t){t._initialX=e.clientX?e.clientX:e.targetTouches[0].clientX;t._initialY=e.clientY?e.clientY:e.targetTouches[0].clientY});var a=function(t){e=t||event;h._viewport._viewportGestureHandler._gesture=false;e.stopPropagation();i.forEach(function(t){t._moving=true;var i=e.clientX?e.clientX:e.targetTouches[0].clientX;var n=e.clientY?e.clientY:e.targetTouches[0].clientY;t._currentX=i-t._initialX;t._currentY=n-t._initialY;c(t._currentX,t._currentY,t.getDomRef());t.update()})};var d=function(t){e=t||event;e.stopPropagation();i.forEach(function(t){t._handleViewportStop()});document.removeEventListener("mousemove",a);document.removeEventListener("mouseup",d);document.removeEventListener("touchmove",a);document.removeEventListener("touchend",d)};document.addEventListener("mousemove",a);document.addEventListener("mouseup",d);document.addEventListener("touchmove",a);document.addEventListener("touchend",d);h.update()}};function s(t,n){var o=t.clientX?t.clientX:t.targetTouches[0].clientX;var a=t.clientY?t.clientY:t.targetTouches[0].clientY;var l=o-d[0].offsetLeft;var s=a-d[0].offsetTop;var c=jQuery(t.currentTarget).control()[0]._viewport.$();var r=jQuery("iframe[id$='-textarea_ifr']");if(r.length){var p=jQuery("<div></div>");p.attr("id","rte_ifr_cov");p.css({position:"absolute"});p.css({opacity:0});p.css({top:c.offset().top,left:c.offset().left});p.height(c.height());p.width(c.width());jQuery("body").append(p[0])}document.onmousemove=function(t){h._viewport._viewportGestureHandler._gesture=false;var e=t||event;var o=e.clientX?e.clientX:e.targetTouches[0].clientX;var a=e.clientY?e.clientY:e.targetTouches[0].clientY;var d=o-l;var c=a-s;i.forEach(function(t){t._moving=true;n(t,d,c);t.update()})};document.onmouseup=function(){var t=jQuery("#rte_ifr_cov");if(t){t.remove()}i.forEach(function(t){var i=e.get(t.getAnnotationId());i.width=t._textWidth;i.height=t._textHeight;i.maxWidth=t._textMaxWidth;t._resizeEnd()});document.onmousemove=null;document.onmouseup=null;document.ontouchmove=null;document.ontouchend=null};document.ontouchmove=document.onmousemove;document.ontouchend=document.onmouseup}var r=function(t,e,i,n){var o=t._textDiv.getDomRef();if(e){t._textWidth=e;o.style.width=t._textWidth+"px";t._textDiv.setProperty("width",o.style.width,true)}if(i){t._textMaxWidth=i;o.style.maxWidth=t._textMaxWidth+"px"}if(n){t._textHeight=n;o.style.height=t._textHeight+"px";t._textDiv.setProperty("height",o.style.height,true)}};function p(t,i,n){r(t,e.get(t.getAnnotationId()).width-i,e.get(t.getAnnotationId()).maxWidth-i,e.get(t.getAnnotationId()).height-n);t._currentX=i;t._currentY=n;c(i,n,t.getDomRef())}function m(t,i,n){r(t,null,null,e.get(t.getAnnotationId()).height-n);t._currentX=0;t._currentY=n;c(0,n,t.getDomRef())}function g(t,i,n){r(t,e.get(t.getAnnotationId()).width+i,e.get(t.getAnnotationId()).maxWidth+i,e.get(t.getAnnotationId()).height-n);t._currentX=0;t._currentY=n;c(0,n,t.getDomRef())}function v(t,i,n){r(t,e.get(t.getAnnotationId()).width+i,e.get(t.getAnnotationId()).maxWidth+i,null)}function A(t,i,n){r(t,e.get(t.getAnnotationId()).width+i,e.get(t.getAnnotationId()).maxWidth+i,e.get(t.getAnnotationId()).height+n)}function y(t,i,n){r(t,null,null,e.get(t.getAnnotationId()).height+n)}function u(t,i,n){r(t,e.get(t.getAnnotationId()).width-i,e.get(t.getAnnotationId()).maxWidth-i,e.get(t.getAnnotationId()).height+n);t._currentX=i;t._currentY=0;c(i,0,t.getDomRef())}function I(t,i,n){r(t,e.get(t.getAnnotationId()).width-i,e.get(t.getAnnotationId()).maxWidth-i,null);t._currentX=i;t._currentY=0;c(i,0,t.getDomRef())}};s.prototype.update=function(){var t=this.getDomRef();if(!t){return}var e=this._updateBlocked();if(this.getProperty("display")!=e){this.setDisplay(e)}if(!this.getText()){t.style.display=this.getDisplay()?"block":"none"}var n=this.getSelected();if(this.getProperty("selected")!=n){this.setSelected(n)}var o=t.childNodes[8];var h=t.childNodes[9];if(this.getWidth()&&!this._moving){this.setWidth(this.getWidth())}if(this.getHeight()&&!this._moving){this.setHeight(this.getHeight())}this._resized=false;if(!this.getAnimate()){t.style.setProperty("--animation-name","annotationStatic")}var a=this.getTargetNodes()[0];var d=a?this._getNodeRefScreenCenter(this._viewport,a):{x:0,y:0,depth:0};var l=this._viewport.getDomRef().getBoundingClientRect();if(this.getAttachmentNode()){var s=this._getNodeRefScreenCenter(this._viewport,this.getAttachmentNode());if(s.depth>1){s.x=l.width+1e3}var c=this._viewport.normalizeRectangle(s.x,s.y,0,0);this.setXCoordinate(c.x+this.getXOffset());this.setYCoordinate(c.y+this.getYOffset())}var p=this._viewport.deNormalizeRectangle(this.getXCoordinate(),this.getYCoordinate(),0,0);if(this.getEditable()&&this.getSelected()){if(this._previousState.x===undefined){var m=t.getBoundingClientRect();this._previousState.x=m.x;this._previousState.y=m.y}t.style.left=this._previousState.x-l.x+"px";t.style.top=this._previousState.y-l.y+"px"}else{switch(this.getStyle()){case i.Default:t.childNodes[0].style.visibility="hidden";t.childNodes[1].style.visibility="hidden";t.childNodes[2].style.visibility="hidden";t.childNodes[3].style.visibility="hidden";t.childNodes[4].style.visibility="hidden";break;case i.Explode:t.childNodes[0].style.visibility="hidden";t.childNodes[1].style.visibility="hidden";t.childNodes[2].style.visibility="hidden";break;case i.Square:t.childNodes[0].style.visibility="hidden";t.childNodes[1].style.visibility="hidden";t.childNodes[2].style.visibility="hidden";break;case i.Random:t.childNodes[0].style.visibility="hidden";break;default:break}}if(a){var g=d.x-p.x;var v=d.y-p.y;if(this._moving){g-=this._currentX;v-=this._currentY}o.style.left=g+"px";o.style.top=v+"px";var A=new Map([[i.Default,{isElbow:true,toHeight:.5}],[i.Explode,{isElbow:true,toHeight:.5}],[i.Square,{isElbow:false,toHeight:.95}],[i.Random,{isElbow:false,toHeight:.5}],[i.Expand,{isElbow:true,toHeight:.5}]]).get(this.getStyle());r(o,t,t.childNodes[10],{isElbow:A.isElbow,toHeight:A.toHeight})}else{o.style.visibility="hidden";h.style.visibility="hidden"}var y=this.getNodeRef();this.setXCoordinate(y?y.position.x:this.getProperty("xCoordinate"));this.setYCoordinate(y?y.position.y:this.getProperty("yCoordinate"))};s.prototype._handleViewportStop=function(){setTimeout(function(){this._moving=false;this.update()}.bind(this),300);var t=this.getDomRef();var e=window.getComputedStyle(t);var i=t.style.transform;t.style.transform="";this._currentX=0;this._currentY=0;var n=parseFloat(i.substring(i.indexOf("(")+1,i.indexOf(",")));var o=parseFloat(i.substring(i.indexOf(",")+1,i.indexOf(")")));if(n||o){t.style.left=parseFloat(e.left)+n+"px";t.style.top=parseFloat(e.top)+o+"px";this._offsetTop=t.offsetTop;this._offsetLeft=t.offsetLeft;var h=this._viewport.normalizeRectangle(this._offsetLeft,this._offsetTop,0,0);this.setXCoordinate(h.x);this.setYCoordinate(h.y);this._firePositionChanged(this)}};function c(t,e,i){i.style.transform="translate("+t+"px, "+e+"px)"}function r(t,e,i,n){n=n||{};var o=t.getBoundingClientRect();var h=e.getBoundingClientRect();var a=o.x-h.x+o.width/2;var d=o.y-h.y+o.height/2;var l=a<0?0:h.width;var s=h.height*(n.toHeight||.5);if(a<0&&!e.classList.contains("leaderlineLeft")){e.classList.remove("leaderlineRight");e.classList.add("leaderlineLeft")}if(a>=0&&!e.classList.contains("leaderlineRight")){e.classList.remove("leaderlineLeft");e.classList.add("leaderlineRight")}var c=Math.min(a,l);var r=Math.min(d,s);i.style.left=c+"px";i.style.top=r+"px";i.style.width=Math.abs(l-a)+"px";i.style.height=Math.abs(s-d)+"px";var p=l>a?0:a-l;var m=s>d?0:d-s;var g=l-a;var v=s-d;var A="M"+p+" "+m+"v"+v+"h"+g;if(a>0&&a<h.width){A="M"+p+" "+m+"h"+g+"v"+v+"h-2"}if(!n.isElbow){A="M"+p+" "+m+"l"+g+" "+v}var y=i.childNodes[0];if(A!==y.getAttribute("d")){y.setAttribute("d",A);y.style.setProperty("--stroke-dasharray",y.getTotalLength());y.style.setProperty("--stroke-dashoffset",y.getTotalLength())}}s.prototype.setLeaderLine=function(t,e,i){var n=e.getBoundingClientRect();var o=t.offsetTop+t.offsetHeight/2;var h=n.height/2;var a=t.offsetLeft+t.offsetWidth/2;var d=0;if(a>d){d=n.width}var l=Math.abs(h-o);var s=Math.abs(d-a);var c=Math.sqrt(l*l+s*s);var r=180/Math.PI*Math.acos(l/c);var p,m;if(h>o){p=(h-o)/2+o}else{p=(o-h)/2+h}if(d>a){m=(d-a)/2+a}else{m=(a-d)/2+d}if(o<h&&a<d||h<o&&d<a||o>h&&a>d||h>o&&d>a){r*=-1}p-=c/2;i.style.transform="rotate("+r+"deg)";i.style.top=p+"px";i.style.left=m+"px";i.style.height=c+"px"};s.prototype.getTransform=function(){var t=this.getNodeRef();t.updateMatrix();return sap.ui.vk.TransformationMatrix.convertTo4x3(t.matrix.elements)};s.prototype.setTransform=function(t){var e=this.getNodeRef();e.position.set(t[9],t[10],t[11]);e.scale.set(t[0],t[4],t[8]);e.updateMatrix();this.setXCoordinate(e.position.x);this.setYCoordinate(e.position.y);this.setWidth(e.scale.x);this.setHeight(e.scale.y);this.update();return this};s.prototype.updateNodeId=function(t){var e=this.getNodeRef();e.userData.nodeId=t;this.sourceData.annotation.nodeId=t;this._viewport.getScene().setNodePersistentId(e,t);return this};s.prototype.setInitialOffset=function(){var t=this.getTargetNodes().values().next().value;var e={x:0,y:0,width:.1,height:.08};if(t&&this.getXCoordinate()===0&&this.getYCoordinate()===0){var i=this._getNodeRefScreenCenter(this._viewport,t);var n=this._viewport.getDomRef().getBoundingClientRect();var o=i.x>=n.width/2?i.x-150:i.x+50;var h=i.y>=n.height/2?h=i.y+20:i.y-120;e=this._viewport.normalizeRectangle(o,h,0,0)}if(e.x<-.5){e.x=-.5}else if(e.x>.5){e.x=.4}if(e.y<-.5){e.y=-.5}else if(e.y>.5){e.y=.35}this.setTransform([.1,0,0,0,.08,0,0,0,1,e.x,e.y,0]);return this};s.prototype.fitToText=function(t,e){if(this._textDiv==null||this._textDiv.getDomRef()==null){return this}var i=document.createElement("div");i.style.setProperty("whiteSpace","nowrap","important");i.style.setProperty("visibility","hidden","important");i.style.setProperty("position","absolute");if(t!=null){i.style.maxWidth=t+"px"}if(e!=null){i.style.maxHeight=e+"px"}i.innerHTML=this._textDiv.getDomRef().innerHTML;document.body.appendChild(i);i.style.setProperty("width","calc("+i.clientWidth+"px + 1rem)");i.style.setProperty("height","calc("+i.clientHeight+"px + 1rem)");var n=this._viewport.normalizeRectangle(0,0,i.clientWidth,i.clientHeight);document.body.removeChild(i);this.setWidth(n.width);this.setHeight(n.height);return this};s.getStyles=function(){var t=[{style:i.Default,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmZhNTI3NDEtOGZkZi00NTM0LWE0N2UtMWRmZWMyOTc3NTliIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDRkNjFiNzktZDUxMC01MDQwLThjNjYtYjk4ZWIyZWMxOWI0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmYTUyNzQxLThmZGYtNDUzNC1hNDdlLTFkZmVjMjk3NzU5YiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZojRogAABeNJREFUeJztnD1MHEcUx/9vdD6wZURcGFzFBZGSCndxZUp3HE3iYCkHrJlxFXd2FUtRJFK5tKsc6IRoiNMdVRASkqloEU2kKAqWIhmQJZ9BOmxgXorsntbLzd7u7e7tHuxPGrG3HzPz5r35ePMBMTOEEKy1JhhwPy/Y9y4LIfpNH7gjE96HSqmG6UMAADODiPrd4cGDB8r9m5nhBLJlMGbHztKRc+3IcKS1Nn4ghIDznJjZN8tnPjbFaIKIKLAOAFuGNkJfNmaprQ7sPLG7zKWUjycmJoa9eiAitv8Se5P1orU+cmQpODdML3tLTPiVkB3Zpx+0i9H1IQFo2lJbOQLQ0rzMJhASk+0WWt71UCqVBq9fv/6IiAbn5+efhEk4tiJya95t3rEVkUnZjt35mlIUQrcXYQlURIeHh3x8fNxRTtxK7rio/PqVQI12EEztR2xWZCK9BKanp8eUUg0p5ar7vpTyZZgEfHVgdxGvT05OHgshbgohysxcn5+fv+t916SDtm0RM+8IIW4JIcYBjBLR69gkCMP5taLmYAcwdxrt8B26ZKKxSzwBpzFMJAG7fP/2K2c/2urAHs0ygI6a8mYCMY2N4sB3+O4lcSNKmswJELYtyZwAYYkkgNvjmp2dfTo5OXnTuQYAy7LKlmWVlVJ/RsummVg0oJRqENHY1atXK1LKZwsLC3NKqcbbt29r1Wp1iZl3ImfU1NY2XX6Paxo2TE1NfW165nVx/YJ7GuKTKQnbJT5zP2vNqHHcYxi6X+xKnARhu/zmmDpJBzZJMqeBsMQqQJRhZTtMFpJrAPi/4o2MjPD79+8xMjKSrA/jTTuuiJgZxWIRSftgXrwdGYDut0jeuhMmfbcAABB5BiEGGmEEyCtx2jQF6HRWJW3OjwZ6lZ4XINBqkxfv6mOlUjE6QpZljVer1ZVO0gmEx20L5UZKKeeIqP/+/ftfOtczMzN3HfdSSjn38OHDHedZwNDSdTSFWExoYGBg03HkFxcXX/X3928qpd7s7+8/Z+adhYWFuTjSaUVkAaanp8cA1KWUq8y8AQBa6ycA6rVarR41/nZEFmBxcfEVgM8PDw8VEd0BACHEU631kmVZ40BTyGSIUgfcYWZm5m4nUy5R68An099xLAfFQD6Y6ynOjwCdriGlTW/m2oV3LBRpxbVTomg/8ZXcpOl5E8oFSJtcgLTpeQE68om9eNvxbvYjcWngm7W1NV5bW2MA92KKMxCxdGRCiA9a66J9/VFr3Rc50oDEYkIAvl9fX39pm9JUTHEG4owG7Ln6lh5Rr86fBsVnTOa75z8KfhZ0xj3uVZchIsZzB3FwIUs0S7RUwHlvasKQdFnkNSBlcgWkTK6AlIlrHN2WUqk0eO3atVum51rrd0tLS1vdyk9WSK0GFIvFPy5dulSOIy4p5ar3rFWv0NIR01pT0stkSqmG1voXZ+nYsqzxQqHgHFDbAjDKzBt7e3vfXrly5bOBgYFNADuVSuW28y4zvwAAIioDADNvtTp/FgX3geQ443XoWhPkR6lUGrQLf0tr7eymWBFC/Dg0NPS7Xag3pJQv7d0Z9aOjo9tOkyWlvAUAcRe+mxA7YT9orQMbbyYUUKvV6kopMHPdvZlidnb2ndZ6BwDK5fIoEY0x8wYR3enr63sEQHUrj0FrQNgty5lQAADs7u7eGB4eXnXtP6oz80q1Wn0hpXxGRD+cnJzcc/YbKaU2lVJvDg4Obp+eni4VCoVflVKNg4ODr5aXlyMfc+kWqfUBvULYPiBsf5H7ASmTKyBlcgWkTOj/SHTRSLos8pJOmVwBKWPyA1o6E716ujUoSZ77NHFGAee9kP1IQ/a8CUqZXAEpk5m5IC9CiH8B7AMwLuJklH/CvJzZPd5JzsFnibwJSplcASmTGQU4Lr8Q4p4QYhvARyHEthCiq9uVu06Ys5VJBiICEW2vr6+zm42NDSai7bTzl1TITA1wOD099f193sjMKMj5L/NCiO8A/ATgCwB/AfhZa/1burlLjv8A3MQpISu2+rQAAAAASUVORK5CYII="},{style:i.Explode,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjQyKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTkxNWVjMTctNGM5Mi00YzljLWE0MTUtMjA0NDFhMmQwNTFhIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDNjNTE2ZDgtOTgxOC1hYzQwLWJiM2EtNmNiYjI5Nzg3NTcwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE5MTVlYzE3LTRjOTItNGM5Yy1hNDE1LTIwNDQxYTJkMDUxYSIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo0MisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjYzNzdjM2ExLTQ0OGQtNDVmOC05YmRjLTdlZmZmZjMxM2Y5OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+jDd+1gAABfdJREFUeJztnDtsFEccxr//6DAHwnJQZEwVykQKgi5UuKTzuQmOKQ578QwSUuigSSidijJIJ+VsnSw3iHTnKi5x5ZQWUZTSVDxkhZORzihmJoV3zHrvZp+zt3vH/qSR73b3Zuabb2bnsbMmpRQYY0pKSTDgPV9xj51hjFVNP/BGxvwnhRBd0w8BAEopEFHVG+7cuSO835VS0IFcDcbsuFk60J+1hgMppfEHjH3KOXNjCMy2e74B4ChL/WL0R+Km0iAiiuwBAFSklBQi+syJCLxfQj0Aen3gnD+YnZ2dsuZDFNEnvvct1qAf9VQ+f4x+tAYFX/EloG/10lXJqDkqpupY6XvUR61Wm5icnLxPRBMrKysP4yR8bEKY1WF4q4IX5kYebnUIRrO9tTZtIKIGEcEbbCegw6eEIjaEpEX4p7cdJK6uQf1KpJtFFAJrUZbkl8DCwsK0EKLLOd/0HuecP4uTQKAHbhfx8vDw8AFj7BJjrK6U6qysrNzwX2vyIPRepJTaZYxdZYzNALhCRC+tKYjD6NYiXUQAwscwJkx3UilltHtR0kSklCPgQWg78EpP4lGkTh+A8icWEfJ2+jbGRjYIHL77ydzjrDkWYGPwaIO49XR0HEiCd8a1tLT0aH5+/pL+DACO49Qdx6kLIf5Jl00zVhwQQnSJaPrcuXNNzvnj1dXVZSFEd29vr91qtdaVUrs20umLb1xcTRpu3779nemcf4obFGKP5b19pY1xS1pM4x4To9OIbUwwbRC3N7Y23LIJY6wB4F7YdQMZziVEZ74RdmFRBWhChRRdgMYoxEobcBueNyJKOj/yxBdEA8A9a3Mm2wLi4J8PABj8yNR/C4+TvlcAAOTeEwPoxhEwLI3YyOgIGFSjCyNu+xsdB4aVoRcQdeHpBP6nj81m07ie5DjOTKvV2kiSTiTSTCk558tEVL1169bX+vPi4uINPb3knC/fvXt3V5/LYkpppQqNj49v64n82tra82q1ui2EePX27dtflVK7q6uryzbS6UdqAQsLC9MAOpzzTaXUFgBIKR8C6LTb7U7a+MNILWBtbe05gK/ev38viOg6ADDGHkkp1x3HmQGORWaDrWWVxcXFG0mWXMpllawyMihKAXnjXdjKMx/HxF1gK0auU+CfUgIY/NzA574CEDon0Hks3NKiK+ZLAHtB12kBRa1CezgSEUpRBQARRRRZABBBRNEFACEihkEAECBiWAQABhFWBDDGToQM6RFhK7XvcdQBKQBzluI0cUKEreX1DwDG3K+RetK0HK/gWdo4epOIlBt+sLkpNdaMzC1NYwkWZf00KwLab+D29zQELcz1TI+LMmUYMLGm6HH5LEu0SPS0AN3UPtPa3oN7282sUytLOWdKA3KmNCBnEj2eTEKtVps4f/78VdN5KeW79fX1nUHlpyjk1gLGxsb+OHXqVN1GXJzzTf+7VsOCcSqc9WMyIURXSvmLfnTsOM5MpVLRL6jtALiilNp68+bNzbNnz34xPj6+DWC32Wxe09cqpZ4AABHVAUAptdPv/bM0xH1UF5eB3YKCqNVqE27h70gp9W6KDcbYzxcuXPjdLdSLnPNn7u6MzsHBwTV9y+KcXwUA24U/CAphQLvd7gghoJTqeDdTLC0tvZNS7gJAvV6/QkTTSqktIrp++vTp+wBEbpm2RCEMAIDXr19fnJqa2vTsP+oopTZardYTzvljIvrx8PBwTu83EkJsCyFe7e/vX/v48eN6pVL5TQjR3d/f/+bp06fZveZimdz6gGEh6z6gnAfkTGlAzpQG5ExPJxz0QOZzRL9Nk9UDmbIF5ExpQM6Y5gF9x6ZF+S8HWRG0O5IxFrrlLSreZ+s9LUBKSaZgI/EiE6CbcFT4DUTctheV8hYUj3uwbERpQDKsGVEakI7URpQG2CGxEaUBdoltRGlANkQ2ojAGePZXzzHGXjDGPrh/5waw7zorQo0ozHs+bgG/APBtn9N/Abic1+Zgi+Y3APwkpfxXHyjME7EiY9H4nv9LVbR2fRnAPIC/Afzn/p13j48k/wOvLDJRx+b4hQAAAABJRU5ErkJggg=="},{style:i.Square,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjA4KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTk0ZjlmZWYtYzE5MS00Nzc3LWFhZjgtZDEyYTdkNjhmZWJiIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmUxMTFiMDktOWRjOC03YjQ4LTllYzQtMTBmNDYxNjllZTY5IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjU5NGY5ZmVmLWMxOTEtNDc3Ny1hYWY4LWQxMmE3ZDY4ZmViYiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNTowOCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmJlMjcwOTQwLWZlNjctNGQyMS04ZTI5LWE5MzIzMzM1YjliZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+RxTC0wAABwBJREFUeJztnE9o21gawH9ytFM3MyyZeFm8zcwgSreTpWCI5JRODrn42lz2kEsuvSxiCN0umNI5DGt6KF0IJYSllFIC7TXTQg+FOYVAB0LpHwVy8i5tcWAp2s4mdUvauDOO3h5kaVw3tiVLjuWpfvCILT2/933v0/vzve8pkhACP8heMyYSCYBUwkfhKWBTBhBt5KrdllyRJElqWbQQAsuybNEab1YqFQAuX76854+lWnUtRbIsi0Qi8YtIfppW8pP55U1JeLJDzQZYlpD82MH5cUK0Q1XVYecHnuwASE3tsLy8TD6fb/FTSWorkqZpKSEEQgjPdnAz+LKDXzzbzSuOfal1HcsSkgyQzWY/Bw4GLH/34MGD2zs7O/8FNt2rQghPhmjH7u7uO8ZyUssntVQqUSqV3rnWrNs2o2UFiqKgKAq6rnPnzh0AJiYmfFXQ9SaSAVRV/SKbzQY2MvCy8WLX+sHLm5KANjYIg9A6Wl0nqyFJlmV1X4OuVyBpmjYIfBa0HOBHwzC26i9aloUMfPbgwYN/BayA8fHxSeCHxutepxwvVJ1pqZ7eGblUKrG0tNS9ChRFIZVKMTc3h67rXL9+PdwK6snlcpw4cYJ8Po+u6/5q0DTtaOChVAihadpXjSOpaDfhhIHv5WC7sva6+J/x8fEvAxYuAT/ueaNb80E3ceYaCHE6CJP3p5ZGpN+9WBKbEFELtFAgRW3N2HS1H1FStb+bjTeirkBTwV2EEGia9rkkSSIKqfwdovwdQtO0TyRJoll6Z9lLza/Za7rebyzL4vjx4xPAAcuyttvlj/oj1JaOhtFGf01RlBBE6YyOFHAEXl5eJpfLoes6R44cYXBwkJmZGa5du8bU1BSPHz9mZWWFw4cPMzs7G6bcLqE8QplMhrNnzzI2NsbQ0BCmaTI/P8/Jkye7KjzgjkJHw3CQw6DmZH+1l6O9V+r7Ttz3CjideAe8LKL2B1VV3wJvveSN5GLOD32nwMubEtRt9EbjmQlA3ysQOY/Mgzd25cWScDebItcH2ihwBfga+s8jgzrh6+kXBfYUHvpDgabCQ/QVaCk8RFuBtsKDvYkvA78FPsUeVns9LO2sra39XQjxl1aZnFFIBpKAYhjGo30Qri0vlgS5f2hfGIbhKb8MfAR8XK1WwwpGBGJgYABV9R79TWDv/FaBpnsw+5kcVFXFsqymqV6BviZWoNf4Xo1WKhVM03S/J5NJ0ul0qEL5oWMLXLx40VM+v6cs/OJbgWQy6e7MKYpCuVxG13V0XadSqbgniZyTHE+fPg1V4EYCOzTz8/NMT08DsLi4yKVLl9B1nfPnz5NOp9nY2AgsZCtC8chyuRwAIyMjmKZJJpPh7t27rmLdJPAotLCwgK7r5PN5RkdHKRQKzM7OsrGxQblcZn19nXK5HIKoeyNpmpYCjt6/f381ChtbiUQCVVW/BP798OHD9vm7L1J3iRXoNX2vgOOBhXnqY1+RgZ+A17IcqU26Ha8ZZaAClFRVPUJEfGJaReYbiNzWol/6XoF+oDGmUU/fj6L9TmwADyQSiUCpFfEQ5IGAPsYV4FsaDvq5ZQcpOaYlV7DP+31Ni1VFbIDw8dTwDrEBwsNXwzvEBghORw3vEBugcwI1vIMkhCCbzUrAQC39BtslduJ+HzICsLBjnz8Du4Zh/JO6VY1fGldBzg7KR8DH2HH6YeBA3b1qJxX9CpABlr95dNe58Ke//uGPqqr+zTAMT+coPVeC/dLAp8DvDcNYffXqlZCiEKuPANXvP3E/Hzp0SGC3VegGGKh9lgEGBwelKAQ4ooD1511kWUZV1Uns9hlQVRUvARcv1Ley4MMdbrxQpQtbxfFj3mNiA/SY2AA9Zl8CeaVSqeVxokwm0/GrZcVikXv37nHq1KkOpest+2IARVG4evWq+13Xdaanp91DOQDlcplHj+yTtpqmMTQ0BNjGe/LkCceOHXMPsq2trbG1tcXw8DC3b98GfnkJst+IRCi7UCiwvb3NhQsXSCaTFItFzp075xrp2bNnFAoFpqamWFlZIZ1Oc/r0aZLJJKurqwB92fgQAQOUSiVM0ySdTrO4uOhez2Qy7OzYpwucf/V048aNdxr/10DPJ2FFUchkMpimydjYGDMzM4yOjrK+vs7IyAgAc3Nz3Lp1i4WFBSYnJzlz5gzFYtEt4/nz5++9UN4vOJtxKeydvZRhGKvVarUn77CapkmlUvH9Nn6lUqFcLnflsLNlWY4nPIG9AbcJbIblCfd8CKqn0wbs9UnzIPR8CPrQiQ3QY2ID9Jh6A0hEbE6IGDJdiBA6Db6Lvd1aBXjz5k0ckKkh7JNrziuZVey2Cg1nGXqAOCTZSL3+b4Et4BXwGngb9jL0J2zLvgb+RxyUd3gvKE83ekBM7/g/nE5w7+aEM3oAAAAASUVORK5CYII="},{style:i.Random,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM0OjU0KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OWZkYTc5MGItNmU4NC00ZWY1LWE0ZjEtODRlYWIwYjA1YmM4IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+COBQAABfZJREFUeJztnD1sE0kYht9vZCBBRL7oBLnqKO+q0B0VKeniNFwEhUmWzCAhHR1UR5mrKO8kS2dHUZQGOVSmupRQpU13ZahOoMixguQU0XxXsBPWm/2b9dq7TvaRRnK865l5552Znb8NMTOEEKy1JoTgvV5xv5sWQkyF/cAbmfBfVEr1w34IAGBmENGUNzx58kR5/2ZmmECuhtDsuFk6MZ+NhhOtdegPhPiWc+HGEJlt93oDwNcsJcFNpUFElNgDwNUQI3p6IALvH7EeAAARsbfMpZQvlpaW5kJ9ICL2J+vH60MS0YM5SlKs54yzwdSlWB0JCKxe1jkKI6w6VgCg22bMLoeWK2q1WvXmzZvPiajaarVeBt3Te0sMgKoPBss8syLyVgUvmRWRv/qc4a21wwYiahARvCHrBEz4llDS/iVNMXXbzF6TEdVEYyIObd6JOu0kjLwWhZFfAisrKwtKqb6Uctf7vZSybZNApAfuI+Lj6enpCyHEbSFEnZl7rVbrvv/ebpv71Qd8zuiK/ws/zHwghLgjhFgEME9EH4PuC4o8VoENF7cWmSICED+GCSOsJ9VaZ9cXBSWitb4AHozH5CwIehYMJJDR2CgLIofvfkZuwagpnADbvqRwAmwZSoB3xrW2tvbq4cOHt81nAHAcp+44Tl0p9W/SOHtv6SwkIRMHlFJ9Ilq4ceNGU0r5emNjY10p1T88POxsbm5uM/NBFukE4hkTD0xNbcPjx49/Cbvmn+JGBeuxfNG60bBxTxiXuxGPgtBJagiZTv2yQgjRAPAs7r6xDOdSYjLfiLuxqAIMsUKKLsAQKqSobSDyuhlKAwV1QGsdGbz4H2QmglTrRGnxpm2bvlcAAAy9gpABfRsBhaxCNlwcAWlXVfLm4jgwqUy8gNgV3iD8u4/NZjN0IuQ4zuLm5ua7NOkkgplxtAMc7eDcrnNckFKuE9HUo0ePfjKfV1dX75vppZRy/enTpwfmWsLARzvJt5BMFWI3pGJmZmbPTOS3trbeT01N7Sml/vv8+fOfzHywsbGxnjSubtsuG0YAucGalZWVBQA9KeUuM38AAK31SwC9TqfTs40vauM0CAEA1QcM/05pUra2tt4D+PHLly+KiO4BgBDildZ623GcReBMZGKs8uLbbky9rLK6uno/zZJLUBtItazillw5mBs3pYC8ORNgu6BUFCYz1x78U0oA458b+NxnJHiomjwWblnFFfM9gMOo+4yAolahQ3wVEUtRBQAJRRRZAJBARNEFADEiJkEAECFiUgQAISImSQAQIKKoz4FQ3ClnsZfXbSicAJu9ASCgCrlr9YFjkUldP01KRPWNPP4+DFELc+emx5M6ZRgSq5MPtlzKEi0SgQZc9K7GhlGXRdkCcqY0IGdKA3Im1fZkGmq1WnV2dvZO2HWt9dH29vb+uPJTFHJrAVevXv3nypUr9SziklLu+t+1mhQGJmLuK50AgNllGunpY6VUX2v9h9k6dhxnsVKpmBfU9gHMM/OHT58+/Xr9+vXvZmZm9gAcNJvNu+ZeZv4LAIioDgDMvB/0/tkwdNvsPYxAgOXmaQxj64KiqNVqVbfw97XW5jTFOyHE77du3dpxC/UHKWXbPZ3ROzk5uWu6LCnlHQDIuvDHgd8Aml0m7raZMMZTf51Op6eUAjP3vIcp1tbWjrTWBwBQr9fniWiBmT8Q0b1r1649B6DGkD1vmWQfedBakNaaRr1T7++CarVadW5ubhfAvHtLj5nftVotJaV8TUS/nZ6eLpvzRkqpPQC3j4+P705PTy9UKpW/AeD4+PjnN2/eZPaai9b6JO5/cAxDbgZMCqM2oJwH5ExpQM6UBuRMoAGXdN0/kFGXRVnSOVMakDNhM+HAufa43yUbN/5313zXYo+8JcW7yXOuBWitKSxkkXiRidBN+Fr4DSQ8tpeUsguy4xkyNqI0IB2ZGVEaMBxDG1EakA2pjSgNyBZrI0oDRkNiIwp3vLiIZLAc0QDwqtvmc/OI0oAEDGuA/0z6QNxDxXxJiDtybnsk3UtpQM78D6oZB7/ZFWiVAAAAAElFTkSuQmCC"},{style:i.Expand,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAAGSM0KYAAAACXBIWXMAAAsTAAALEwEAmpwYAAALC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0MzUyLCAyMDIwLzAxLzMwLTE1OjUwOjM4ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTAzLTI2VDE0OjM1OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MmZhNTI3NDEtOGZkZi00NTM0LWE0N2UtMWRmZWMyOTc3NTliIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDRkNjFiNzktZDUxMC01MDQwLThjNjYtYjk4ZWIyZWMxOWI0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmYTUyNzQxLThmZGYtNDUzNC1hNDdlLTFkZmVjMjk3NzU5YiIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcyOWFhOWVjLTE0ZmItNDdiZS1hNTNhLTAyYzgyOWEyMjlhOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplZTU1MTBmOC02YjZkLTQ0MmEtOTA5My0zNDg2Y2U0MDRkNTQiLz4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJURVhUIiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJURVhUIi8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9IlRleHQiIHBob3Rvc2hvcDpMYXllclRleHQ9IlRleHQiLz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJUZXh0IiBwaG90b3Nob3A6TGF5ZXJUZXh0PSJUZXh0Ii8+IDxyZGY6bGkgcGhvdG9zaG9wOkxheWVyTmFtZT0iVGV4dCIgcGhvdG9zaG9wOkxheWVyVGV4dD0iVGV4dCIvPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOlRleHRMYXllcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+ZojRogAABeNJREFUeJztnD1MHEcUx/9vdD6wZURcGFzFBZGSCndxZUp3HE3iYCkHrJlxFXd2FUtRJFK5tKsc6IRoiNMdVRASkqloEU2kKAqWIhmQJZ9BOmxgXorsntbLzd7u7e7tHuxPGrG3HzPz5r35ePMBMTOEEKy1JhhwPy/Y9y4LIfpNH7gjE96HSqmG6UMAADODiPrd4cGDB8r9m5nhBLJlMGbHztKRc+3IcKS1Nn4ghIDznJjZN8tnPjbFaIKIKLAOAFuGNkJfNmaprQ7sPLG7zKWUjycmJoa9eiAitv8Se5P1orU+cmQpODdML3tLTPiVkB3Zpx+0i9H1IQFo2lJbOQLQ0rzMJhASk+0WWt71UCqVBq9fv/6IiAbn5+efhEk4tiJya95t3rEVkUnZjt35mlIUQrcXYQlURIeHh3x8fNxRTtxK7rio/PqVQI12EEztR2xWZCK9BKanp8eUUg0p5ar7vpTyZZgEfHVgdxGvT05OHgshbgohysxcn5+fv+t916SDtm0RM+8IIW4JIcYBjBLR69gkCMP5taLmYAcwdxrt8B26ZKKxSzwBpzFMJAG7fP/2K2c/2urAHs0ygI6a8mYCMY2N4sB3+O4lcSNKmswJELYtyZwAYYkkgNvjmp2dfTo5OXnTuQYAy7LKlmWVlVJ/RsummVg0oJRqENHY1atXK1LKZwsLC3NKqcbbt29r1Wp1iZl3ImfU1NY2XX6Paxo2TE1NfW165nVx/YJ7GuKTKQnbJT5zP2vNqHHcYxi6X+xKnARhu/zmmDpJBzZJMqeBsMQqQJRhZTtMFpJrAPi/4o2MjPD79+8xMjKSrA/jTTuuiJgZxWIRSftgXrwdGYDut0jeuhMmfbcAABB5BiEGGmEEyCtx2jQF6HRWJW3OjwZ6lZ4XINBqkxfv6mOlUjE6QpZljVer1ZVO0gmEx20L5UZKKeeIqP/+/ftfOtczMzN3HfdSSjn38OHDHedZwNDSdTSFWExoYGBg03HkFxcXX/X3928qpd7s7+8/Z+adhYWFuTjSaUVkAaanp8cA1KWUq8y8AQBa6ycA6rVarR41/nZEFmBxcfEVgM8PDw8VEd0BACHEU631kmVZ40BTyGSIUgfcYWZm5m4nUy5R68An099xLAfFQD6Y6ynOjwCdriGlTW/m2oV3LBRpxbVTomg/8ZXcpOl5E8oFSJtcgLTpeQE68om9eNvxbvYjcWngm7W1NV5bW2MA92KKMxCxdGRCiA9a66J9/VFr3Rc50oDEYkIAvl9fX39pm9JUTHEG4owG7Ln6lh5Rr86fBsVnTOa75z8KfhZ0xj3uVZchIsZzB3FwIUs0S7RUwHlvasKQdFnkNSBlcgWkTK6AlIlrHN2WUqk0eO3atVum51rrd0tLS1vdyk9WSK0GFIvFPy5dulSOIy4p5ar3rFWv0NIR01pT0stkSqmG1voXZ+nYsqzxQqHgHFDbAjDKzBt7e3vfXrly5bOBgYFNADuVSuW28y4zvwAAIioDADNvtTp/FgX3geQ443XoWhPkR6lUGrQLf0tr7eymWBFC/Dg0NPS7Xag3pJQv7d0Z9aOjo9tOkyWlvAUAcRe+mxA7YT9orQMbbyYUUKvV6kopMHPdvZlidnb2ndZ6BwDK5fIoEY0x8wYR3enr63sEQHUrj0FrQNgty5lQAADs7u7eGB4eXnXtP6oz80q1Wn0hpXxGRD+cnJzcc/YbKaU2lVJvDg4Obp+eni4VCoVflVKNg4ODr5aXlyMfc+kWqfUBvULYPiBsf5H7ASmTKyBlcgWkTOj/SHTRSLos8pJOmVwBKWPyA1o6E716ujUoSZ77NHFGAee9kP1IQ/a8CUqZXAEpk5m5IC9CiH8B7AMwLuJklH/CvJzZPd5JzsFnibwJSplcASmTGQU4Lr8Q4p4QYhvARyHEthCiq9uVu06Ys5VJBiICEW2vr6+zm42NDSai7bTzl1TITA1wOD099f193sjMKMj5L/NCiO8A/ATgCwB/AfhZa/1burlLjv8A3MQpISu2+rQAAAAASUVORK5CYII="}];return t};s.createAnnotation=function(t,e){var i=new s({viewport:e,annotationId:t.annotation.id,nodeRef:t.node,style:t.annotation.style,animate:t.annotation.animate===undefined?true:t.annotation.animate,editable:!!t.annotation.editable,name:t.node.name,text:t.annotation.text?t.annotation.text.html:"",xCoordinate:t.node.position.x,yCoordinate:t.node.position.y,width:t.node.scale.x,height:t.node.scale.y});i._attachmentNode=t.attachment;if(t.targetNodes){t.targetNodes.forEach(function(t){i.getTargetNodes().push(t)})}i.sourceData=t;return i};s.prototype._getBackgroundColor=function(){var t="rgba(221, 221, 221, 0.5)";var e=this.sourceData.annotation;if(e.label&&e.label.colour){var i=e.label.colour;t="rgba("+i[0]*255+", "+i[1]*255+", "+i[2]*255+", "+i[3]+")"}return t};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnnotationRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,e){t.openStart("div",e);var n=e.getEditable()&&e.getSelected()?"Editing":e.getStyle();t.class("sapUiVizKitAnnotation"+n);if(e._reverse===true){t.class("sapUiVizKitAnnotationReverse")}t.openEnd();for(var i=0;i<8;i++){t.openStart("div");t.class("sapUiVizKitAnnotationElement"+i);t.openEnd();t.close("div")}t.openStart("div");t.class("sapUiVizKitAnnotationNode"+n);t.openEnd();t.close("div");t.openStart("div");t.class("sapUiVizKitAnnotationLeader"+n);t.openEnd();t.close("div");t.openStart("svg");t.attr("xmlns","http://www.w3.org/2000/svg");t.class("sapUiVizKitAnnotationSVG"+n);t.openEnd();t.openStart("path");t.openEnd();t.close("path");t.close("svg");if(e._textDiv){t.renderControl(e._textDiv)}t.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnnotationStyle", [],function(){"use strict";var e={Default:"Default",Explode:"Explode",Square:"Square",Random:"Random",Expand:"Expand"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BaseNodeProxy", ["sap/ui/base/Object"],function(a){"use strict";var e=a.extend("sap.ui.vk.BaseNodeProxy",{metadata:{library:"sap.ui.vk",abstract:true}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardBorderLineStyle", [],function(){"use strict";var D={None:"None",Solid:"Solid",Dash:"Dash",Dot:"Dot",DashDot:"DashDot",DashDotDot:"DashDotDot"};return D},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardCoordinateSpace", [],function(){"use strict";var e={Viewport:"Viewport",Screen:"Screen",World:"World"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardHorizontalAlignment", [],function(){"use strict";var e={Left:"left",Center:"center",Right:"right"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardStyle", [],function(){"use strict";var e={RectangularShape:"RectangularShape",CircularShape:"CircularShape",None:"None",TextGlow:"TextGlow"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardTextEncoding", [],function(){"use strict";var t={PlainText:"PlainText",HtmlText:"HtmlText"};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Camera", ["sap/ui/base/ManagedObject"],function(e){"use strict";var t=e.extend("sap.ui.vk.Camera",{metadata:{library:"sap.ui.vk",properties:{position:{type:"float[]",defaultValue:[0,0,0]},targetDirection:{type:"float[]",defaultValue:[1,0,0]},upDirection:{type:"float[]",defaultValue:[0,1,0]},nearClipPlane:{type:"float",defaultValue:.1},farClipPlane:{type:"float",defaultValue:1}}}});t.prototype.getCameraRef=function(){return null};t.prototype.getIsModified=function(){return!!this._isModified};t.prototype.setIsModified=function(e){this._isModified=e};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/CameraFOVBindingType", [],function(){"use strict";var i={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/CameraProjectionType", [],function(){"use strict";var e={Perspective:"perspective",Orthographic:"orthographic"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerBase", ["./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ScrollEnablement","sap/ui/Device","sap/m/library","./ContainerBaseRenderer","./MapContainerButtonType","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(t,e,n,o,i,s,a,r,l,u,c,h,p){"use strict";var d=e.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{showFullScreen:{type:"boolean",group:"Misc",defaultValue:true},showSettings:{type:"boolean",group:"Misc",defaultValue:true},showSelection:{type:"boolean",group:"Misc",defaultValue:true},fullScreen:{type:"boolean",group:"Misc",defaultValue:false},title:{type:"string",group:"Misc",defaultValue:""},autoAdjustHeight:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{contentChange:{parameters:{selectedItemId:"string"}},settingsPressed:{}}}});d.prototype.switchContent=function(t){this.setSelectedContent(t);this.rerender()};d.prototype.updateContainer=function(){this._contentChanged=true;this.rerender()};d.prototype.setSelectedContent=function(t){this._oSelectedContent=t};d.prototype.getSelectedContent=function(){return this._oSelectedContent};d.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;this._customButtons=[];var t=new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High});var e=sap.m.ButtonType.Transparent;this._oFullScreenButton=new sap.m.OverflowToolbarButton({layoutData:t,type:e,icon:"sap-icon://full-screen",text:c().getText("CONTAINERBASE_FULLSCREEN"),tooltip:c().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen()}.bind(this)});this._oSettingsButton=new sap.m.OverflowToolbarButton({layoutData:t.clone(),type:e,icon:"sap-icon://action-settings",text:c().getText("CONTAINERBASE_SETTINGS"),tooltip:c().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed()}.bind(this)});this._oSelectionButtonSingle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-single",tooltip:c().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-rectangle",tooltip:c().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-lasso",tooltip:c().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new sap.m.SegmentedButton({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new o({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new sap.m.SegmentedButton({layoutData:t.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new sap.m.Label;this._oToolbar=new sap.m.OverflowToolbar({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(a.system.desktop){this.sResizeListenerId=i.register(this,jQuery.proxy(this._performHeightChanges,this))}else{a.orientation.attachHandler(this._performHeightChanges,this);a.resize.attachHandler(this._performHeightChanges,this)}var s=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],r="map-container",l="map-container";s.forEach(function(t){n.addIcon(t.name,r,l,t.unicode)})};d.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined}if(a.system.desktop&&this.sResizeListenerId){i.deregister(this.sResizeListenerId);this.sResizeListenerId=null}else{a.orientation.detachHandler(this._performHeightChanges,this);a.resize.detachHandler(this._performHeightChanges,this)}};d.prototype.setFullScreen=function(t){if(this._firstTime){return}if(this.getFullScreen()==t){return}var e=this.getProperty("fullScreen");if(e!==t){this._toggleFullScreen()}};d.prototype.onAfterRendering=function(){var t=this;if(this.sResizeListenerId===null&&a.system.desktop){this.sResizeListenerId=i.register(this,jQuery.proxy(this._performHeightChanges,this))}if(this.getAutoAdjustHeight()||this.getFullScreen()){setTimeout(function(){t._performHeightChanges()},500)}this._firstTime=false;if(this.getSelectedContent()!==null){var e=this.getSelectedContent().getContent();if(e instanceof sap.ui.vbm.GeoMap||e instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){e.setLassoSelection(true)}else if(this._selectionState==="RECT"){e.setRectangularSelection(true)}else if(this._selectionState==="SINGLE"){e.setRectangularSelection(false);e.setLassoSelection(false)}}}}};d.prototype.onBeforeRendering=function(){var t=this;if(t._contentChanged){t._contentChange()}t._oToolbar.getContent().forEach(function(e){var n=e.getId();var o=e["getPressed"]?e.getPressed():null;for(var i in t._customButtons){if(t._customButtons[i].button&&t._customButtons[i].button.getId()==n){t._customButtons[i].toggled=o}}});t._oToolbar.removeAllContent();t._addToolbarContent()};d.prototype.setTitle=function(t){this._oContTitle.setText(t);this.setProperty("title",t,true)};d.prototype.addContent=function(t){this.addAggregation("content",t);this._contentChanged=true};d.prototype.insertContent=function(t,e){this.insertAggregation("content",t,e);this._contentChanged=true};d.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true};d.prototype._toggleFullScreen=function(){var t=this.getProperty("fullScreen");var e;var n;var o;if(t){this._closeFullScreen();this.setProperty("fullScreen",false,true);o=this.getSelectedContent().getContent();e=o.getId();o.setWidth("100%");n=this._contentHeight[e];if(n){o.setHeight(n)}this.invalidate()}else{var i=this.getAggregation("content");this._contentHeight={};if(i){for(var s=0;s<i.length;s++){o=i[s].getContent();e=o.getId();if(jQuery.isFunction(o.getHeight)){n=o.getHeight()}else{n=0}this._contentHeight[e]=n}}this._openFullScreen(true);this.setProperty("fullScreen",true,true)}var a=t?"sap-icon://full-screen":"sap-icon://exit-full-screen";this._oFullScreenButton.setIcon(a);this._oFullScreenButton.focus()};d.prototype._openFullScreen=function(t){if(t!==null&&t===true){this._oScrollEnablement=new s(this,this.getId()+"-wrapper",{horizontal:true,vertical:true})}this.$content=this.$();if(this.$content){this.$tempNode=jQuery("<div></div>");this.$content.before(this.$tempNode);this._$overlay=jQuery("<div id='"+h()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay)}else{p.warning("Overlay: content does not exist or contains more than one child")}this._oPopup.open(200,undefined,undefined,jQuery("body"))};d.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove()};d.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var t=this.$();if(t.find(".sapUiVkContainerBaseToolbarArea").children()[0]&&t.find(".sapUiVkContainerBaseContentArea").children()[0]){var e=this.getSelectedContent().getContent();if(e.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender()}}}};d.prototype._switchContent=function(t){var e=this._findContentById(t);this.setSelectedContent(e);this.fireContentChange({selectedItemId:t});this.rerender()};d.prototype._contentChange=function(){var t=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(t.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null)}if(t){for(var e=0;e<t.length;e++){var n=t[e].getContent();if(n.setWidth){n.setWidth("100%")}var o=new sap.m.SegmentedButtonItem({icon:t[e].getIcon(),tooltip:t[e].getTitle(),key:n.getId()});this._aContentIcons.push(o);this._oContentSegmentedButton.addItem(o);if(e===0){this.setSelectedContent(t[e])}}}this._contentChanged=false};d.prototype._onContentButtonSelect=function(t){var e=t.getParameter("key");this._switchContent(e)};d.prototype._findContentById=function(t){var e=null;var n=this.getAggregation("content");if(n){for(var o=0;!e&&o<n.length;o++){if(n[o].getContent().getId()===t){e=n[o]}}}return e};d.prototype._addToolbarContent=function(){this._oToolbar.addContent(new sap.m.ToolbarSpacer);if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton)}if(this.getSelectedContent()!==null){var t=this.getSelectedContent().getContent();if(t instanceof sap.ui.vbm.GeoMap||t instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu)}}}this._customButtons.forEach(function(t){if(t.visible){var e={type:sap.m.ButtonType.Transparent,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High})};if("active"in t){e.enabled=t.active}if("icon"in t){e.icon=t.icon}if("activeIcon"in t){e.activeIcon=t.activeIcon}if("text"in t){e.text=t.text}if("tooltip"in t){e.tooltip=t.tooltip}if("press"in t){e.press=t.press}if("toggled"in t){e.pressed=t.toggled}if("overflow"in t){e.overflow=t.overflow}switch(t.type){case u.Click:t.button=e.overflow?new sap.m.OverflowToolbarButton(e):new sap.m.Button(e);break;default:t.button=e.overflow?new sap.m.OverflowToolbarToggleButton(e):new sap.m.ToggleButton(e);break}this._oToolbar.addContent(t.button)}},this);if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton)}if(!a.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton)}};d.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null)}this._bSegmentedButtonSaveSelectState=false};d.prototype._destroyButtons=function(t){t.forEach(function(t){t.destroy()})};d.prototype._handleSelection=function(t){var e=this.getSelectedContent().getContent();if(e instanceof sap.ui.vbm.GeoMap||e instanceof sap.ui.vbm.AnalyticMap){if(t==="LASSO"){e.setLassoSelection(true);this._selectionState=t}else if(t==="RECT"){e.setRectangularSelection(true);this._selectionState=t}else if(t==="SINGLE"){e.setRectangularSelection(false);e.setLassoSelection(false);this._selectionState=t}}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerBaseRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,r){var t=r.getTooltip_AsString();var a=r.getTitle();var o=r.getAriaLabelledBy();var i=r.getAriaDescribedBy();e.openStart("div",r);e.attr("role",sap.ui.core.AccessibleRole.Group);if(a){e.attr("aria-label",a)}else if(t){e.attr("aria-label",t)}if(o&&o.length>0){e.attr("aria-labelledby",o.join(" "))}if(i&&i.length>0){e.attr("aria-describedby",i.join(" "))}e.class("sapUiVkContainerBase");e.openEnd();e.openStart("div");e.attr("id",r.getId()+"-wrapper");e.attr("role",sap.ui.core.AccessibleRole.Presentation);e.class("sapUiVkContainerBaseWrapper");e.openEnd();this.writeContentArea(e,r);this.writeToolbarArea(e,r);e.close("div");e.close("div")};e.writeContentArea=function(e,r){var t=r.getSelectedContent();e.openStart("div");e.class("sapUiVkContainerBaseContentArea");e.attr("role",sap.ui.core.AccessibleRole.Img);e.openEnd();if(t!==null){e.renderControl(t)}else if(r.getContent().length>0){t=r.getContent()[0];e.renderControl(t)}e.close("div")};e.writeToolbarArea=function(e,r){e.openStart("div");e.class("sapUiVkContainerBaseToolbarArea");e.attr("role",sap.ui.core.AccessibleRole.Group);e.openEnd();e.renderControl(r._oToolbar);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerContent", ["./library","sap/ui/core/Control","./ContainerContentRenderer"],function(t,e,n){"use strict";var i=e.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{icon:{type:"string",group:"Misc",defaultValue:null},title:{type:"string",group:"Misc",defaultValue:null}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false}}}});i.prototype.setContent=function(t){if(t instanceof sap.ui.vbm.GeoMap){t.setNavcontrolVisible(false);t.setWidth("100%");t.setHeight("100%")}this.setAggregation("content",t);return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerContentRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.renderControl(n.getContent())};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentConnector", ["sap/base/util/ObjectPath","sap/ui/base/Object","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./Messages","./getResourceBundle","./ContentResource","./Core","sap/base/Log"],function(e,t,n,a,s,r,o,i,u){"use strict";var c=a.prototype;var l=a.extend("sap.ui.vk.ContentConnector",{metadata:{library:"sap.ui.vk",aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManagerBase"},defaultViewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false,visibility:"hidden"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}},constructor:function(e,t){this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._decryptionHandler=null;this._authorizationHandler=null;this._retryCount=1;c.constructor.apply(this,arguments);i.observeLifetime(this)}});l.prototype.isTreeBinding=function(e){return e==="contentResources"};l.prototype.init=function(){if(c.init){c.init.call(this)}this._selfObserver=new n(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]})};l.prototype.destroy=function(){l._cleanAssociatedLoaders();this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){clearTimeout(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null}this._delayContentResourcesUpdate=false;this._setContent(null,null);c.destroy.call(this)};l.prototype._observeChanges=function(e){if(e.name==="contentResources"){this._scheduleContentResourcesUpdate()}else if(e.name==="viewStateManagers"){if(e.mutation==="insert"){e.child.setContentConnector(this)}else if(e.mutation==="remove"){e.child.setContentConnector(null)}}};l.prototype.invalidate=function(e){if(e instanceof o){this._scheduleContentResourcesUpdate();return}c.invalidate.apply(this,arguments)};l.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=setTimeout(function(){this._scheduleContentResourcesUpdateTimerId=null;var e=this.getContentResources();if(e.length>0){this._collectContentResourceSourceTypeInformation(e).then(function(t){if(t.dimensions.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(s.VIT17.cause)}});u.error(r().getText(s.VIT17.summary),s.VIT17.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(t.contentManagerClassNames.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(s.VIT35.cause)}});u.error(r().getText(s.VIT35.summary),s.VIT35.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(t.contentManagerClassNames.length===0){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(s.VIT36.cause)}});u.error(r().getText(s.VIT36.summary),s.VIT36.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(t.contentManagerClassNames.length===1){var n=this;this._getContentManagerByClassName(t.contentManagerClassNames[0]).then(function(t){if(n._contentManager&&t!==n._contentManager){n.fireContentChangesStarted();n._setContent(null,null);n.fireContentChangesFinished({content:null})}t.loadContent(n._content,e)})}}.bind(this))}else{setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null})}.bind(this),0)}}.bind(this),0)}return this};l.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted()};l.prototype._handleContentChangesFinished=function(e){var t=e.getParameter("content");this._setContent(t,e.getSource());this.fireContentChangesFinished({content:t,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate()}};l.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};l.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};l.prototype._getContentManagerByClassName=function(e){var t;var n=this.getAggregation("contentManagers",[]);for(var a=0,s=n.length;a<s;++a){t=n[a];if(t.getMetadata().getName()===e){return Promise.resolve(t)}}var r=this;return new Promise(function(t,n){sap.ui.require([e.replace(/\./g,"/")],function(e){var n=new e;r.addAggregation("contentManagers",n);n.attachContentChangesStarted(r._handleContentChangesStarted,r);n.attachContentChangesFinished(r._handleContentChangesFinished,r);n.attachContentChangesProgress(r._handleContentChangesProgress,r);n.attachContentLoadingFinished(r._handleContentLoadingFinished,r);r._assignDecryptionHandler([n]);r._assignAuthorizationHandler([n]);r._assignRetryCount([n]);t(n)})})};l.prototype.getContent=function(){return this._content};l.prototype.getContentManager=function(){return this._contentManager};l.prototype.getDefaultViewStateManager=function(){return this.getAggregation("defaultViewStateManager")};l.prototype._assignDecryptionHandler=function(e){for(var t=0;t<e.length;t++){e[t].setDecryptionHandler(this._decryptionHandler)}};l.prototype._assignAuthorizationHandler=function(e){for(var t=0;t<e.length;t++){e[t].setAuthorizationHandler(this._authorizationHandler)}};l.prototype._assignRetryCount=function(e){for(var t=0;t<e.length;t++){e[t].setRetryCount(this._retryCount)}};l.prototype.setDecryptionHandler=function(e){this._decryptionHandler=e;this._assignDecryptionHandler(this.getAggregation("contentManagers",[]));return this};l.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;this._assignAuthorizationHandler(this.getAggregation("contentManagers",[]));return this};l.prototype.setRetryCount=function(e){this._retryCount=Math.max(e,0);this._assignRetryCount(this.getAggregation("contentManagers",[]));return this};l.prototype._setContent=function(t,n){var a=this._content;var s=this._contentManager;if(a!==t){this._content=t;this._contentManager=n;this.destroyAggregation("defaultViewStateManager");if(n){var r=n.getMetadata().getName();var o;if(r==="sap.ui.vk.threejs.ContentManager"){o="sap.ui.vk.threejs.ViewStateManager"}else if(r==="sap.ui.vk.dvl.ContentManager"){o="sap.ui.vk.dvl.ViewStateManager"}else if(r==="sap.ui.vk.svg.ContentManager"){o="sap.ui.vk.svg.ViewStateManager"}if(o){var i=e.get(o);var u=new i(this.getId()+"-defaultviewstatemanager",{contentConnector:this});this.setAggregation("defaultViewStateManager",u)}}this.fireContentReplaced({oldContent:a,newContent:t});if(a){var c=false;this.fireContentDestroying({content:a,preventGarbageCollection:function(e){c=e}});s.destroyContent(a);if(!c){s.collectGarbage()}}}return this};var g=[{pattern:/(^threejs[:.])|(^(threejs|stream|vds4)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"},{pattern:/^(png|jpg|jpeg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"},{pattern:/^(stream2d|vds4-2d)$/,dimension:2,contentManagerClassName:"sap.ui.vk.svg.ContentManager"}];var h=function(e){return new Promise(function(t,n){var a=g.slice();var s=function(r){if(r>=a.length){n();return}var o=a[r];(function(){var t=e.getSourceType();if(t){t=t.toLowerCase()}if(typeof o==="function"){return o(e)}else if(typeof o.pattern==="string"){var n=o.pattern.toLowerCase();if(n===t){return Promise.resolve(o)}}else if(o.pattern instanceof RegExp){if(o.pattern.test(t)){return Promise.resolve(o)}}return Promise.reject()})().then(function(e){t({dimension:e.dimension,contentManagerClassName:e.contentManagerClassName,settings:e.settings})},function(){s(r+1)})};s(0)})};l.addContentManagerResolver=function(e){if(typeof e==="function"){g.unshift(e)}else{g.unshift({pattern:e.pattern,dimension:e.dimension,contentManagerClassName:e.contentManagerClassName,settings:e.settings})}return this};l.removeAllContentManagerResolvers=function(){g=[];return this};l.removeContentManagerResolver=function(e){var t=typeof e==="function",n=typeof e==="string",a=e instanceof RegExp,s=typeof e==="object"&&!a;for(var r=0,o=g.length;r<o;++r){if(t&&g[r]===e){g.splice(r,1);return true}else if(typeof g[r]==="object"){if(s){if(e.pattern&&g[r].pattern===e.pattern){g.splice(r,1);return true}}else if(a){if(g[r].pattern.source===e.source){g.splice(r,1);return true}}else if(n){if(g[r].pattern instanceof RegExp){if(g[r].pattern.source===e){g.splice(r,1);return true}}else if(g[r].pattern===e){g.splice(r,1);return true}}}}return false};l._cleanAssociatedLoaders=function(){for(var e=0,t=g.length;e<t;++e){var n=g[e];if(n.settings&&n.settings.loader&&n.settings.loader.exit){n.settings.loader.exit()}}};l.prototype._collectContentResourceSourceTypeInformation=function(e){var t=false;var n=false;var a={};var s={};var r=[];e.forEach(function e(t){r.push(t);t.getContentResources().forEach(e)});return Promise.all(r.map(function(e){return h(e).then(function(e){a[e.dimension]=true;s[e.contentManagerClassName]=true;return e},function(){if(e.getSourceType()){n=true}else{t=true}return false})})).then(function(e){for(var o=0,i=r.length;o<i;++o){if(e[o]){r[o]._contentManagerResolver=e[o]}}return{noSourceTypes:t,unknownSourceTypes:n,dimensions:Object.getOwnPropertyNames(a).sort(),contentManagerClassNames:Object.getOwnPropertyNames(s)}})};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentManager", ["sap/ui/base/ManagedObject"],function(t){"use strict";var e=t.extend("sap.ui.vk.ContentManager",{metadata:{abstract:true,library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}}}}});var n=e.getMetadata().getParent().getClass().prototype;e.prototype.init=function(){if(n.init){n.init.call(this)}this._decryptionHandler=null;this._authorizationHandler=null;this._retryCount=1};e.prototype.destroyContent=function(t){return this};e.prototype.collectGarbage=function(){return this};e.prototype.createOrthographicCamera=function(){return null};e.prototype.createPerspectiveCamera=function(){return null};e.prototype.destroyCamera=function(t){return this};e.prototype.setDecryptionHandler=function(t){this._decryptionHandler=t;return this};e.prototype.setAuthorizationHandler=function(t){this._authorizationHandler=t;return this};e.prototype.setRetryCount=function(t){this._retryCount=Math.max(t,0);return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResource", ["sap/ui/base/ManagedObject","./ContentResourceSourceTypeToCategoryMap"],function(e,t){"use strict";var o=e.extend("sap.ui.vk.ContentResource",{metadata:{library:"sap.ui.vk",properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string",password:"string",useSecureConnection:{type:"boolean",defaultValue:true},veid:"string",includeHidden:{type:"boolean",defaultValue:true},includeAnimation:{type:"boolean",defaultValue:true},pushPMI:{type:"boolean",defaultValue:false},metadataFilter:"string",activateView:"string",enableLogger:{type:"boolean",defaultValue:false},pushViewGroups:{type:"boolean",defaultValue:true},includeBackground:{type:"boolean",defaultValue:true},includeParametric:{type:"boolean",defaultValue:true},includeUsageId:{type:"sap.ui.vk.IncludeUsageIdType",defaultValue:false},dependencyLoader:"any"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},constructor:function(t,o,r){e.apply(this,arguments)}});o.prototype.isTreeBinding=function(e){return e==="contentResources"};o.prototype.destroy=function(){e.prototype.destroy.call(this)};o.prototype.setLocalMatrix=function(e){var t=this.getNodeProxy();if(t){t.setLocalMatrix(e)}this.setProperty("localMatrix",e,true);return this};o.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{}};o.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null};o.collectCategories=function(e){var o=[];var r={};function n(e){var a=(e.getSourceType()||"").toLowerCase();if(a){var u=t[a]||"unknown";if(!r.hasOwnProperty(u)){r[u]=true;o.push(u)}}e.getContentResources().forEach(n)}e.forEach(n);return o};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResourceSourceCategory", [],function(){"use strict";var e={"3D":"3D","2D":"2D"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResourceSourceTypeToCategoryMap", ["./ContentResourceSourceCategory"],function(e){"use strict";var D={vds:e["3D"],vdsl:e["3D"],cgm:e["3D"],png:e["2D"],jpg:e["2D"],jpeg:e["2D"],gif:e["2D"],bmp:e["2D"],tiff:e["2D"],tif:e["2D"],svg:e["2D"]};return D},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Core", ["sap/base/strings/capitalize","sap/base/util/each","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","sap/ui/core/EventBus","./library"],function(t,e,i,s,o,n,r){"use strict";var a=i.extend("sap.ui.vk.Core",{metadata:{library:"sap.ui.vk",aggregations:{eventBus:{type:"sap.ui.core.EventBus",multiple:false,visibility:"hidden"}}},constructor:function(){if(r.getCore){return r.getCore()}i.call(this);var t=this;r.getCore=function(){return t};this.setAggregation("eventBus",new n)}});a.prototype.getEventBus=function(){return this.getAggregation("eventBus")};function c(e,i){if(i.multiple){return(e==="insert"?"onAdd":"onRemove")+t(i.singularName)}else{return(e==="insert"?"onSet":"onUnset")+t(i.name)}}function u(i,s,o){var n=o.getId();i.forEach(function(i){e(i.getMetadata().getAllAssociations(),function(e,r){if(o.isA(r.type)){var a=i["get"+t(e)]();if(a===n||Array.isArray(a)&&a.indexOf(n)>=0){var u=i[c(s,r)];if(typeof u==="function"){u.call(i,o)}}}})})}a.prototype.observeLifetime=function(t){if(!this._lifetimeObserver){this._lifetimeObserver=new s(function(t){if(t.type==="destroy"&&this._objectsWithAssociations){u(this._objectsWithAssociations.slice(),"remove",t.object)}}.bind(this))}this._lifetimeObserver.observe(t,{destroy:true});if(this._objectsWithAssociations){u(this._objectsWithAssociations.slice(),"insert",t)}return this};a.prototype.observeAssociations=function(i){if(!i.getId()){throw new Error("To observe an object it must have an ID.")}if(!this._objectsWithAssociations){var n=this;this._objectsWithAssociations=[];this._associationObserver=new s(function(i){var s=n._objectsWithAssociations.indexOf(i.object);if(s<0){return}if(i.type==="destroy"){e(i.object.getMetadata().getAllAssociations(),function(e,s){var o;var n=t(s.name);if(s.multiple){o=i.object["removeAll"+n];if(typeof o==="function"){o.call(i.object)}}else{o=i.object["set"+n];if(typeof o==="function"){o.call(i.object,null)}}});n._objectsWithAssociations.splice(s,1)}else if(i.type==="association"){var r=i.object.getMetadata().getAllAssociations()[i.name];var a=i.object[c(i.mutation,r)];if(typeof a==="function"){if(Array.isArray(i.ids)){i.ids.map(function(t){return o.byId(t)}).filter(function(t){return t!=null}).forEach(a.bind(i.object))}else{var u=o.byId(i.ids);if(u){a.call(i.object,u)}}}}})}if(this._objectsWithAssociations.indexOf(i)<0){this._objectsWithAssociations.push(i);this._associationObserver.observe(i,{associations:true,destroy:true});e(i.getMetadata().getAllAssociations(),function(e,s){var n=i[c("insert",s)];if(typeof n==="function"){var r=i["get"+t(e)]();if(Array.isArray(r)){r.map(function(t){return o.byId(t)}).filter(function(t){return t!=null}).forEach(n.bind(i))}else{var a=o.byId(r);if(a){n.call(i,a)}}}})}return this};return new a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DetailViewShape", [],function(){"use strict";var i={Box:"Box",Circle:"Circle",CircleLine:"CircleLine",CirclePointer:"CirclePointer",CircleArrow:"CircleArrow",CircleBubbles:"CircleBubbles",BoxLine:"BoxLine",BoxNoOutline:"BoxNoOutline",SolidPointer:"SolidPointer",SolidArrow:"SolidArrow"};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DetailViewType", [],function(){"use strict";var e={DetailView:"DetailView",Cutaway:"Cutaway"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DownloadManager", ["sap/ui/base/EventProvider","./Messages","./getResourceBundle","sap/base/Log"],function(e,t,s,r){"use strict";var i=e.extend("sap.ui.vk.DownloadManager",{metadata:{library:"sap.ui.vk",events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},constructor:function(t,s,r,i){e.apply(this);this._maxParallelTasks=s||5;this._sourcesToProcess=t.slice();this._sourcesBeingProcessed=[];this._authorizationHandler=r;this._retryCount=i!==undefined?Math.max(i,0):1}});i.prototype.start=function(){while(this._pickAndDispatchTask()){}return this};i.prototype.queue=function(e){this._sourcesToProcess.push(e);this._pickAndDispatchTask();return this};i.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var e=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(e);var t=this;if(this._authorizationHandler){this._authorizationHandler(e).then(function(s){var r=null;if(s!=null){r=s.token_type+" "+s.access_token}var i=s?s.tenant_uuid:null;t._runTask(e,r,i)}).catch(function(s){t.fireItemFailed({source:e,status:0,statusText:s});t._taskFinished(e);if(t._queueIsEmpty()){t.fireAllItemsCompleted()}})}else{this._runTask(e)}return true}return false};i.prototype._taskFinished=function(e){var t=this._sourcesBeingProcessed.indexOf(e);if(t>=0){this._sourcesBeingProcessed.splice(t,1)}return this};i.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0};i.prototype._runTask=function(e,i,o){var a=this;if(typeof e==="string"){var n=this._retryCount;(function t(){var s=new XMLHttpRequest;s.onerror=function(i){if(s.status===0){if(n-- >0){r.info("Could not retrieve '"+e+"' due to network error.","Retrying ("+(a._retryCount-n)+" of "+a._retryCount+" attempts)...","sap.ui.vk.DownloadManager");t();return}}a._taskFinished(e);a._pickAndDispatchTask();a.fireItemFailed({source:e,status:s.status,statusText:s.statusText});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};s.onload=function(i){switch(s.status){case 408:case 425:case 429:case 500:case 502:case 503:case 504:if(n-- >0){r.info("Could not retrieve '"+e+"' as request failed with HTTP status "+s.status+": "+s.statusText,"Retrying ("+(a._retryCount-n)+" of "+a._retryCount+" attempts)...","sap.ui.vk.DownloadManager");t();return}break;default:break}a._taskFinished(e);a._pickAndDispatchTask();if(s.status===200||s.status===0){a.fireItemSucceeded({source:e,response:s.response})}else{a.fireItemFailed({source:e,status:s.status,statusText:s.statusText})}if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};s.onprogress=function(t){a.fireItemProgress({source:e,loaded:t.loaded,total:t.total})};s.open("GET",e,true);s.responseType="arraybuffer";if(i){s.setRequestHeader("Authorization",i)}if(o){s.setRequestHeader("X-TenantUuid",o)}s.send(null)})()}else if(e instanceof File){var u=new FileReader;u.onload=function(t){a._taskFinished(e);a._pickAndDispatchTask();a.fireItemSucceeded({source:e,response:u.result});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};u.onerror=function(t){a._taskFinished(e);a._pickAndDispatchTask();a.fireItemFailed({source:e,status:u.error.name,statusText:u.error.message});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};u.onprogress=function(t){a.fireItemProgress({source:e.name,loaded:t.loaded,total:t.total})};u.readAsArrayBuffer(e)}else{r.error(s().getText(t.VIT5.summary),t.VIT5.code,"sap.ui.vk.DownloadManager")}return this};i.prototype.attachItemSucceeded=function(e,t,s){return this.attachEvent("itemSucceeded",e,t,s)};i.prototype.detachItemSucceeded=function(e,t){return this.detachEvent("itemSucceeded",e,t)};i.prototype.fireItemSucceeded=function(e,t,s){return this.fireEvent("itemSucceeded",e,t,s)};i.prototype.attachItemFailed=function(e,t,s){return this.attachEvent("itemFailed",e,t,s)};i.prototype.detachItemFailed=function(e,t){return this.detachEvent("itemFailed",e,t)};i.prototype.fireItemFailed=function(e,t,s){return this.fireEvent("itemFailed",e,t,s)};i.prototype.attachAllItemsCompleted=function(e,t,s){return this.attachEvent("allItemsCompleted",e,t,s)};i.prototype.detachAllItemsCompleted=function(e,t){return this.detachEvent("allItemsCompleted",e,t)};i.prototype.fireAllItemsCompleted=function(e,t,s){return this.fireEvent("allItemsCompleted",e,t,s)};i.prototype.attachItemProgress=function(e,t,s){return this.attachEvent("itemProgress",e,t,s)};i.prototype.detachItemProgress=function(e,t){return this.detachEvent("itemProgress",e,t)};i.prototype.fireItemProgress=function(e,t,s){return this.fireEvent("itemProgress",e,t,s)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbar", ["./library","./DrawerToolbarRenderer","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/Device","sap/m/VBox","sap/m/FlexAlignContent","sap/m/FlexAlignItems","sap/m/FlexItemData","sap/m/FlexRendertype","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ButtonType","sap/m/ToolbarDesign","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./ZoomTo","./getResourceBundle","./ToggleMenuButton","./ToggleMenuItem","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","./tools/HighlightMeasurementTool","./tools/CalibrateDistanceMeasurementTool","./tools/DeleteMeasurementTool","./tools/DistanceMeasurementTool","./tools/AngleMeasurementTool","./tools/AreaMeasurementTool"],function(e,t,n,s,i,a,o,r,l,u,c,m,_,h,d,g,T,p,f,v,w,I,E,M,b,S,y,x,R,V,C,D,O,A,B,P){"use strict";var F=n.extend("sap.ui.vk.DrawerToolbar",{metadata:{library:"sap.ui.vk",properties:{expanded:{type:"boolean",defaultValue:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}}},associations:{viewport:{type:"sap.ui.vk.ViewportBase",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(e,t){n.apply(this,arguments)}});var N=[{name:"show",unicode:"e900"},{name:"hide",unicode:"e901"},{name:"turntable",unicode:"e902"},{name:"orbit",unicode:"e903"},{name:"pan",unicode:"e904"},{name:"zoom",unicode:"e905"},{name:"fit-to-view",unicode:"e906"},{name:"rectangular-selection",unicode:"e907"},{name:"predefined-views",unicode:"e93c"},{name:"cross-section",unicode:"e913"},{name:"cross-section-x",unicode:"e914"},{name:"cross-section-y",unicode:"e916"},{name:"cross-section-z",unicode:"e915"},{name:"reverse-direction",unicode:"e917"},{name:"distance-measurement",unicode:"e92b"},{name:"angle-measurement",unicode:"e926"},{name:"area-measurement",unicode:"e963"},{name:"settings",unicode:"e909"},{name:"calibrate-distance",unicode:"e968"}];var H="vk-icons";var L="vk-icons";N.forEach(function(e){s.addIcon(e.name,H,L,e.unicode)});var k="sap-icon://vk-icons/";F.prototype.init=function(){if(n.prototype.init){n.prototype.init.apply(this)}this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._itemsVisibility=new Map;this._itemsVisibilityObserver=new R(this._itemVisibilityChanged.bind(this));this._toolbar=new c({width:"auto",design:d.Solid,layoutData:new l({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(e){e.setMarked()};this._toolbarObserver=new R(this._toolbarContentChanged.bind(this));this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]});this._container=new a({renderType:u.Bare,alignContent:o.Center,alignItems:r.Center,items:[this._toolbar,new m({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(e){this._toggleExpanded()}.bind(this),layoutData:new l({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});this._rectSelectTool=new f;this._distanceMeasurementTool=new A({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._distanceMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._angleMeasurementTool=new B({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._angleMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._areaMeasurementTool=new P({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._areaMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._deleteMeasurementTool=new O({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._deleteMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"));if(this._getViewport().getMeasurementSurface().getMeasurements().length===0){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._calibrateDistanceMeasurementTool=new D({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._calibrateDistanceMeasurementItem.getId()){var t=e.getParameter("enabled");this._measurementsToggleButton.setPressed(t);if(!t){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._highlightMeasurementTool=new C;var e=[this._distanceMeasurementTool,this._angleMeasurementTool,this._areaMeasurementTool,this._deleteMeasurementTool,this._calibrateDistanceMeasurementTool];function t(t){var n=e.find(function(e){return e.getActive()});this._highlightMeasurementTool.setActive(n==null,this._getViewport())}e.forEach(function(e){e.attachEnabled(t,this)},this)};F.prototype.exit=function(){this._distanceMeasurementTool.destroy();this._distanceMeasurementTool=null;this._angleMeasurementTool.destroy();this._angleMeasurementTool=null;this._highlightMeasurementTool.destroy();this._highlightMeasurementTool=null;this._areaMeasurementTool.destroy();this._areaMeasurementTool=null;this._deleteMeasurementTool.destroy();this._deleteMeasurementTool=null;this._calibrateDistanceMeasurementTool.destroy();this._calibrateDistanceMeasurementTool=null;this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._toolbarObserver.disconnect();this._toolbarObserver=null;this._toolbar.destroy();this._toolbar=null};F.prototype._toolbarContentChanged=function(){var e=this._toolbar.getContent();for(var t=0;t<e.length;t++){if(e[t].getMetadata().getName()=="sap.m.ToolbarSeparator"){if(e[t-1]==undefined||e[t+1]==undefined||e[t-1].getMetadata().getName()=="sap.m.ToolbarSeparator"){this._toolbar.removeContent(t)}}}};F.prototype._itemVisibilityChanged=function(e){if(!this._ignoreVisiblityChange){this._itemsVisibility.set(e.object,e.current)}};function U(e){return e?e.getMetadata().getName()==="sap.ui.vk.threejs.Viewport":false}function z(e){return e?e.getMetadata().getName()==="sap.ui.vk.svg.Viewport":false}function G(e){return e?e.getMetadata().getName()==="sap.ui.vk.NativeViewport":false}F.prototype._getViewport=function(){var e=V.byId(this.getViewport());e=e instanceof y&&e.getImplementation()||e;return e&&(U(e)||z(e)||G(e))?e:null};F.prototype._getViewStateManager=function(){var e=V.byId(this.getViewport());var t=e.getViewStateManager();if(t){return V.byId(t)}return null};var W=[null,(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),0),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2)];F.prototype.createButtons=function(){var e=this;var t=M();var n=new b({type:h.Transparent,tooltip:t.getText("CROSS_SECTION_TOOLTIP"),items:[new S({icon:k+"cross-section-x",text:t.getText("CROSS_SECTION_X"),key:0}),new S({icon:k+"cross-section-y",text:t.getText("CROSS_SECTION_Y"),key:1}),new S({icon:k+"cross-section-z",text:t.getText("CROSS_SECTION_Z"),key:2}),new S({icon:k+"reverse-direction",text:t.getText("CROSS_SECTION_REVERSE"),startsSection:true,toggleable:false,press:function(t){var n=e._getViewport();if(n&&e._crossSectionTool&&e._crossSectionTool.getActive()){e._crossSectionTool.setFlip(!e._crossSectionTool.getFlip())}}})],itemToggled:function(t){var n=e._getViewport();if(n&&e._crossSectionTool){var s=t.getParameter("newItem");e._crossSectionTool.setActive(s!=null,n);if(s){var i=parseInt(s.getKey(),10);if(i>=0&&i<3){e._crossSectionTool.setAxis(i)}}}}});n.vitId=x.CrossSection;var s=new T({icon:k+"turntable",type:h.Transparent,tooltip:t.getText("TURNTABLE_TOOLTIP"),press:function(t){var n=e._getViewport();if(n){e._activateGesture(n,0)}}});s.vitId=x.Turntable;var i=new T({icon:k+"orbit",type:h.Transparent,tooltip:t.getText("ORBIT_TOOLTIP"),pressed:false,press:function(t){var n=e._getViewport();if(n){e._activateGesture(n,1)}}});i.vitId=x.Orbit;var a=new T({icon:k+"pan",type:h.Transparent,tooltip:t.getText("PAN_TOOLTIP"),press:function(t){var n=e._getViewport();if(n){e._activateGesture(n,2)}}});a.vitId=x.Pan;var o=new T({icon:k+"zoom",type:h.Transparent,tooltip:t.getText("ZOOM_TOOLTIP"),press:function(){var t=e._getViewport();if(t){e._activateGesture(t,3)}}});o.vitId=x.Zoom;this._activeGesture=-1;this._gestureButtons=[s,i,a,o];var r=new _({icon:k+"show",type:h.Transparent,tooltip:t.getText("SHOW_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection(function(e){n.push(e)});t.setVisibilityState(n,true,false)}}});r.vitId=x.Show;var l=new _({icon:k+"hide",type:h.Transparent,tooltip:t.getText("HIDE_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection(function(e){n.push(e)});t.setVisibilityState(n,false,false)}}});l.vitId=x.Hide;var u=new _({icon:k+"fit-to-view",type:h.Transparent,tooltip:t.getText("FIT_TO_VIEW"),press:function(){var t=V.byId(e.getViewport());t=t instanceof y&&t.getImplementation()||t;if(t){t.zoomTo(E.All,null,.5,0)}}});u.vitId=x.FitToView;this._rectSelectionButton=new T({icon:k+"rectangular-selection",type:h.Transparent,tooltip:t.getText("RECTANGULAR_SELECTION_TOOLTIP")});this._rectSelectionButton.vitId=x.RectangularSelection;var c=new p({icon:k+"predefined-views",activeIcon:k+"predefined-views",type:h.Transparent,tooltip:t.getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new w({items:[new I({text:t.getText("PREDEFINED_VIEW_INITIAL")}),new I({text:t.getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new I({text:t.getText("PREDEFINED_VIEW_BACK")}),new I({text:t.getText("PREDEFINED_VIEW_LEFT")}),new I({text:t.getText("PREDEFINED_VIEW_RIGHT")}),new I({text:t.getText("PREDEFINED_VIEW_TOP")}),new I({text:t.getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(t){var n=e._getViewport();if(n){var s=t.getParameters("item").item;var i=this.indexOfItem(s);n._viewportGestureHandler.setView(W[i],1e3)}})});c.vitId=x.PredefinedViews;var m=new T({icon:"sap-icon://full-screen",type:h.Transparent,tooltip:t.getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(t){var n=e._getViewport();var s=function(e){return!!(e.fullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)};if(this.getPressed()){if(!s(document)){if(!e._fullScreenHandler){e._fullScreenHandler=function(t){var i=s(document);if(!i){document.removeEventListener("fullscreenchange",e._fullScreenHandler);document.removeEventListener("mozfullscreenchange",e._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",e._fullScreenHandler);document.removeEventListener("MSFullscreenChange",e._fullScreenHandler);this.setPressed(false);n.removeStyleClass("sapVizKitViewerFullScreen")}}.bind(this)}var i=document.getElementsByTagName("body")[0];if(i.requestFullscreen){document.addEventListener("fullscreenchange",e._fullScreenHandler);i.requestFullscreen()}else if(i.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",e._fullScreenHandler);i.webkitRequestFullscreen()}else if(i.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",e._fullScreenHandler);i.mozRequestFullScreen()}else if(i.msRequestFullscreen){document.addEventListener("MSFullscreenChange",e._fullScreenHandler);i.msRequestFullscreen()}}n.addStyleClass("sapVizKitViewerFullScreen")}else{if(s(document)){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}n.removeStyleClass("sapVizKitViewerFullScreen")}}});m.vitId=x.FullScreen;this._distanceMeasurementItem=new S({icon:k+"distance-measurement",text:t.getText("MEASUREMENTS_DISTANCE_MENUITEM")});this._angleMeasurementItem=new S({icon:k+"angle-measurement",text:t.getText("MEASUREMENTS_ANGLE_MENUITEM")});this._areaMeasurementItem=new S({icon:k+"area-measurement",text:t.getText("MEASUREMENTS_AREA_MENUITEM")});this._deleteMeasurementItem=new S({icon:"sap-icon://delete",text:t.getText("MEASUREMENTS_DELETE_MENUITEM")});this._calibrateDistanceMeasurementItem=new S({icon:k+"calibrate-distance",text:t.getText("MEASUREMENTS_CALIBRATE_DISTANCE_MENUITEM")});this._measurementSettingsItem=new S({startsSection:true,icon:k+"settings",text:t.getText("MEASUREMENTS_SETTINGS_MENUITEM"),toggleable:false});this._measurementsToggleButton=new b({type:h.Transparent,tooltip:t.getText("MEASUREMENTS_TOOLTIP"),items:[this._distanceMeasurementItem,this._angleMeasurementItem,this._areaMeasurementItem,this._deleteMeasurementItem,this._calibrateDistanceMeasurementItem,this._measurementSettingsItem],itemToggled:function(t){var n=e._getViewport();var s=t.getParameter("oldItem");var i=t.getParameter("newItem");if(s===e._distanceMeasurementItem){e._distanceMeasurementTool.setActive(false,n)}else if(s===e._angleMeasurementItem){e._angleMeasurementTool.setActive(false,n)}else if(s===e._areaMeasurementItem){e._areaMeasurementTool.setActive(false,n)}else if(s===e._deleteMeasurementItem){e._deleteMeasurementTool.setActive(false,n)}else if(s===e._calibrateDistanceMeasurementItem){e._calibrateDistanceMeasurementTool.setActive(false,n)}var a=n.getTools();var o;if(i===e._distanceMeasurementItem){o=e._distanceMeasurementTool}else if(i===e._angleMeasurementItem){o=e._angleMeasurementTool}else if(i===e._areaMeasurementItem){o=e._areaMeasurementTool}else if(i===e._deleteMeasurementItem){o=e._deleteMeasurementTool}else if(i===e._calibrateDistanceMeasurementItem){o=e._calibrateDistanceMeasurementTool}if(o!=null){if(a.indexOf(o.getId())<0){n.addTool(o)}o.setActive(true,n)}},itemSelected:function(t){var n=e._getViewport();var s=t.getParameter("item");if(s===e._measurementSettingsItem){e._distanceMeasurementTool.setActive(false,n);e._angleMeasurementTool.setActive(false,n);e._areaMeasurementTool.setActive(false,n);e._deleteMeasurementTool.setActive(false,n);e._calibrateDistanceMeasurementTool.setActive(false,n);e._distanceMeasurementTool.showSettingsDialog(n)}},beforeMenuOpen:function(){var t=e._getViewport();var n=t.getMeasurementSurface();var s=n.getMeasurements().length>0;e._deleteMeasurementItem.setEnabled(s);var i=n.getMeasurements().some(function(e){return e.isDistance});e._calibrateDistanceMeasurementItem.setEnabled(i)}});this._measurementsToggleButton.vitId=x.Measurements;var d=new g;d.vitId=x.MeasurementsSeparator;var f=new g;var v=new g;var R=new g;var C=new g;this._itemsShowHideSelect=[r,l,R,this._rectSelectionButton,C];this._items3D=[this._gestureButtons[0],this._gestureButtons[1],n,f,c,v];this._itemPan=this._gestureButtons[2];var D=[r,l,R,this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new g,this._measurementsToggleButton,d,u,new g,this._rectSelectionButton,C,n,f,c,v,m];D.forEach(function(e){this._itemsVisibility.set(e,true);this._itemsVisibilityObserver.observe(e,{properties:["visible"]})}.bind(this));return D};var q=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var K=function(e,t){this.viewport=e;this._toolbar=t;this._mode=1;this._gesture=false;this._x=0;this._y=0};function Q(e,t){q.forEach(function(n,s){if(e.hasStyleClass(n)&&s!==t){e.removeStyleClass(n)}else if(s===t){e.addStyleClass(n)}})}function Z(e){var t=e.viewport;var n=e._mode;var s=t.hasStyleClass(q[n])?n:-1;e._isScrolling=true;if(s!==3){Q(t,3);setTimeout(function(){e._isScrolling=false;Q(t,s)},500)}}K.prototype.beginGesture=function(e){this._gesture=true;if(this._mode<3){this._x=e.points[0].x;this._y=e.points[0].y}else{this._x=e.x;this._y=e.y}if(e.scroll){Z(this)}if(this._toolbar._rectSelectionButton.getPressed()||e.event&&(i.os.macintosh?e.event.metaKey:e.event.ctrlKey)){var t=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-t.left,y1:this._y-t.top,x2:this._x-t.left,y2:this._y-t.top}}};K.prototype.endGesture=function(){this._gesture=false;if(this._selectionRect&&(this._selectionRect.x1!==this._selectionRect.x2||this._selectionRect.y1!==this._selectionRect.y2)){this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera());this._selectionRect=null;this.viewport.setSelectionRect(null)}else if(!this._isScrolling){Q(this.viewport,-1)}};K.prototype.move=function(e){if(this._gesture){if(e.n==1){var t=e.points[0];if(this._selectionRect){var n=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=t.x-n.left;this._selectionRect.y2=t.y-n.top;this.viewport.setSelectionRect(this._selectionRect)}else{Q(this.viewport,this._mode);var s=t.x-this._x;var i=t.y-this._y;switch(this._mode){case 0:this.viewport.rotate(s,i,true);break;case 1:this.viewport.rotate(s,i,false);break;case 2:this.viewport.pan(s,i);break;case 3:this.viewport.zoom(1+i*.005);break;default:break}this._x=t.x;this._y=t.y}e.handled=true}else if(e.n==2&&!this._isScrolling){Q(this.viewport,2)}}};K.prototype.hover=function(){};K.prototype.getViewport=function(){return this.viewport};F.prototype._activateGesture=function(e,t){this._activeGesture=t;this._gestureButtons.forEach(function(e,n){e.setPressed(n===t)});if(!this._cameraHandler||this._cameraHandler.getViewport()!=e){this._cameraHandler=new K(e,this);e._loco.addHandler(this._cameraHandler,0)}this._cameraHandler._mode=t};F.prototype._getToolbar=function(){return this._toolbar};F.prototype._toggleExpanded=function(){var e=!this.getExpanded();this.setExpanded(e);this.fireExpanded({expand:e})};F.prototype.setExpanded=function(e){this.setProperty("expanded",e,true);var t=this.getDomRef();if(t){if(!e){t.classList.add("drawerToolbarCollapsed");t.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed")}else{t.classList.add("drawerToolbarExpanded");t.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed")}}return this};F.prototype.onBeforeRendering=function(){var e=this._getViewport();this._container.setVisible(!!e);if(e){var t=U(e)&&!e._redlineHandler&&!e._isPlanarActivated();var n=U(e)&&e._isPanoramicActivated();var s=G(e);this._ignoreVisiblityChange=true;this._itemsShowHideSelect.forEach(function(e){e.setVisible(!s&&this._itemsVisibility.get(e))}.bind(this));this._items3D.forEach(function(e){e.setVisible(t&&this._itemsVisibility.get(e))}.bind(this));this._itemPan.setVisible(!n&&this._itemsVisibility.get(this._itemPan));this._ignoreVisiblityChange=false;if(t){this._crossSectionTool=this._crossSectionTool||new v;e.addTool(this._crossSectionTool)}this._activateGesture(e,Math.max(this._activeGesture,t?0:2))}};return F});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbarButton", [],function(){"use strict";var e={CrossSection:"VIT-Cross-Section",Turntable:"VIT-Turntable",Orbit:"VIT-Orbit",Pan:"VIT-Pan",Zoom:"VIT-Zoom",Show:"VIT-Show",Hide:"VIT-Hide",FitToView:"VIT-Fit-To-View",RectangularSelection:"VIT-Rectangular-Selection",PredefinedViews:"VIT-Predefined-Views",FullScreen:"VIT-Fullscreen",Measurements:"VIT-Measurements",MeasurementsSeparator:"VIT-Measurements-Separator"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbarRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("div",r);e.class("drawerToolbar");if(!r.getExpanded()){e.class("drawerToolbarCollapsed")}else{e.class("drawerToolbarExpanded")}e.openEnd();e.renderControl(r._container);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DvlException", ["sap/ui/base/Exception"],function(e){"use strict";var t=function(e,t){this.name="DvlException";this.code=e;this.message=t};t.prototype=Object.create(e.prototype);return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/EmbeddedViewer", ["./Viewer","./ContentResource"],function(e,t){"use strict";sap.ui.getCore().attachInit(function(){var c=new URLSearchParams(location.search);new e({toolbarTitle:c.get("title"),showSceneTree:false,contentResources:[new t({sourceType:c.get("sourceType"),source:c.get("source"),veid:c.get("veid")})]}).placeAt("content")})});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControl", ["./library","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./FlexibleControlRenderer"],function(e,t,a,r){"use strict";var o=t.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});a.call(o.prototype);return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControlLayoutData", ["sap/ui/core/LayoutData"],function(e){"use strict";var i=e.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControlRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,e){var i=t;i.openStart("div",e);i.class("sapUiFlexControl");if(e.getWidth()&&e.getWidth()!=""){i.style("width",e.getWidth())}if(e.getHeight()&&e.getHeight()!=""){i.style("height",e.getHeight())}i.openEnd();var g=e.getContent();var a=e.getLayout();var n="sapUiFlexCellStacked";if(a=="Vertical"){n="sapUiFlexCellVertical"}for(var r=0;r<g.length;r++){var o=g[r];i.openStart("div");i.attr("id",e.getId()+"Content_"+r);i.class(n);var l=o.getLayoutData();if(l&&a!="Stacked"){if(l.getSize()&&l.getSize()!=""){i.style("height",l.getSize())}if(l.getMinSize()&&l.getMinSize()!=""){i.style("min-height",l.getMinSize())}if(l.getMarginTop()&&l.getMarginTop()!=""){i.style("margin-top",l.getMarginTop())}if(l.getMarginBottom()&&l.getMarginBottom()!=""){i.style("margin-bottom",l.getMarginBottom())}}i.openEnd();i.renderControl(o);i.close("div")}i.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Highlight", ["sap/ui/base/Object"],function(t){"use strict";var s=t.extend("sap.ui.vk.Highlight",{constructor:function(t,s){this._id=t;this._name=s&&s.name?s.name:"";this._duration=s&&s.duration?s.duration:0;this._cycles=s&&s.cycles?s.cycles:0;this._colours=s&&s.colours?s.colours:[];this._opacities=s&&s.opacities?s.opacities:[];this._fadeOut=s&&s.fadeOut?s.fadeOut:false;this._reset()}});s.prototype.getId=function(){return this._id};s.prototype.getName=function(){return this._name};s.prototype.setName=function(t){this._name=t;return this};s.prototype.getDuration=function(){return this._duration};s.prototype.setDuration=function(t){this._duration=t;this._reset();return this};s.prototype.getCycles=function(){return this._cycles};s.prototype.setCycles=function(t){this._cycles=t;this._reset();return this};s.prototype.getOpacities=function(){return this._opacities};s.prototype.setOpacities=function(t){this._opacities=t;this._reset();return this};s.prototype.getColours=function(){return this._colours};s.prototype.setColours=function(t){this._colours=t;this._reset();return this};s.prototype._reset=function(){var t,s,i;var e=false;if(this._opacities&&this._opacities.length){for(var o=0;o<this._opacities.length;o++){if(this._opacities[o]<.999){e=true;break}}}if(e){if(Math.abs(this._duration-0)<1e-9||this._opacities.length===1){this._adjustedOpacities=[this._opacities[0]];this._opacityTimes=[0]}else if(this._cycles>0){i=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(t=0;t<this._cycles;t++){for(s=0;s<this._opacities.length;s++){this._adjustedOpacities.push(this._opacities[s]);this._opacityTimes.push(i*(t*this._opacities.length+s))}}}else{i=this._duration/this._opacities.length;this._adjustedOpacities=[];this._opacityTimes=[];for(s=0;s<this._opacities.length;s++){this._adjustedOpacities.push(this._opacities[s]);this._opacityTimes.push(i*s)}this._adjustedOpacities.push(this._opacities[0]);this._opacityTimes.push(i*this._opacities.length)}}else{this._adjustedOpacities=[];this._opacityTimes=[]}var h=true;if(this._colours&&this._colours.length){for(var r=0;r<this._colours.length;r++){if(this._colours[r][3]<0){h=false;break}}}else{h=false}if(h){if(this._cycles===0&&this._duration>0){if(this._colours.length===1){this._colours.push([0,0,0,0])}}if(Math.abs(this._duration-0)<1e-9||this._colours.length===1){this._adjustedColours=[this._colours[0]];this._colourTimes=[0]}else if(this._cycles>0){i=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(t=0;t<this._cycles;t++){for(s=0;s<this._colours.length;s++){this._adjustedColours.push(this._colours[s]);this._colourTimes.push(i*(t*this._colours.length+s))}}}else{i=this._duration/this._colours.length;this._adjustedColours=[];this._colourTimes=[];for(s=0;s<this._colours.length;s++){this._adjustedColours.push(this._colours[s]);this._colourTimes.push(i*s)}this._adjustedColours.push(this._colours[0]);this._colourTimes.push(i*this._colours.length)}}else{this._adjustedColours=[];this._colourTimes=[]}};s.prototype.getOpacity=function(t){if(!this._adjustedOpacities||!this._adjustedOpacities.length){return undefined}var s={};if(this._adjustedOpacities.length===1){s.opacity=this._adjustedOpacities[0];s.isCompleted=true;return s}var i=this._opacityTimes[this._opacityTimes.length-1];var e=t;if(this._cycles===0){while(e>i){e-=i}}if(e>=i){if(this._cycles>0){s.isCompleted=true;s.opacity=undefined}else{s.isCompleted=false;s.opacity=this._adjustedOpacities[this._adjustedOpacities.length-1]}return s}var o=this._opacityTimes[1]-this._opacityTimes[0];var h=e/o;var r=Math.floor(h);var u=h-r;s.opacity=this._adjustedOpacities[r]*(1-u)+this._adjustedOpacities[r+1]*u;s.isCompleted=false;return s};s.prototype.getColour=function(t){if(!this._adjustedColours||!this._adjustedColours.length){return undefined}var s={};if(this._adjustedColours.length===1){s.colour=this._adjustedColours[0];s.isCompleted=true;return s}var i=this._colourTimes[this._colourTimes.length-1];var e=t;if(this._cycles===0){while(e>i){e-=i}}if(e>=i){if(this._cycles>0){s.isCompleted=true;s.colour=undefined}else{s.isCompleted=false;s.colour=this._adjustedColours[this._adjustedColours.length-1]}return s}var o=this._colourTimes[1]-this._colourTimes[0];var h=e/o;var r=Math.floor(h);var u=h-r;var a=this._adjustedColours[r][0]*(1-u)+this._adjustedColours[r+1][0]*u;var c=this._adjustedColours[r][1]*(1-u)+this._adjustedColours[r+1][1]*u;var l=this._adjustedColours[r][2]*(1-u)+this._adjustedColours[r+1][2]*u;var _=this._adjustedColours[r][3]*(1-u)+this._adjustedColours[r+1][3]*u;s.colour=[a,c,l,_];s.isCompleted=false;return s};s.prototype.getLastOpacity=function(){var t;if(this._opacities&&this._opacities.length>0){t=this._opacities[this._opacities.length-1]}return t};s.prototype.isFadeOut=function(){return this._fadeOut};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/HighlightDisplayState", [],function(){"use strict";var n=function(){};n.playing="playing";n.pausing="pausing";n.stopped="stopped";return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ImageContentManager", ["./Messages","./ContentManager","./getResourceBundle"],function(e,t,n){"use strict";var i=t.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});var s=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(s.init){s.init.call(this)}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this)};i.prototype.exit=function(){if(s.exit){s.exit.call(this)}};i.prototype.loadContent=function(e,t){if(t.length!==1){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_ONLY_LOAD_SINGLE_IMAGE")}})}.bind(this),0)}else if(t[0].getContentResources().length>0){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_CANNOT_LOAD_IMAGE_HIERARCHY")}})}.bind(this),0)}else{var i=t[0],s=i.getSource(),o=i.getSourceType(),r=null;if(i._contentManagerResolver&&i._contentManagerResolver.settings&&i._contentManagerResolver.settings.loader){r=i._contentManagerResolver.settings.loader}if(s instanceof File){var a=new FileReader;a.onload=function(t){this._loadImageFromUrl(e,a.result,o,r)}.bind(this);a.readAsDataURL(s)}else{var d=new sap.m.Image({src:s});s=d.getSrc();d.destroy();this._loadImageFromUrl(e,s,o,r)}}};i.prototype._addEventListeners=function(e){e.addEventListener("load",this._handleLoadSucceededProxy);e.addEventListener("error",this._handleLoadFailedProxy)};i.prototype._removeEventListeners=function(e){e.removeEventListener("error",this._handleLoadFailedProxy);e.removeEventListener("load",this._handleLoadSucceededProxy)};i.prototype._addSvgQuirks=function(e){e.style.setProperty("visibility","collapse");e.style.setProperty("width","0");e.style.setProperty("height","0");e.style.setProperty("position","absolute");document.body.appendChild(e);return this};i.prototype._removeSvgQuirks=function(e){e.parentElement.removeChild(e);e.style.removeProperty("visibility");e.style.removeProperty("width");e.style.removeProperty("height");e.style.removeProperty("position");return this};i.prototype._loadImageFromUrl=function(e,t,i,s){this.fireContentChangesStarted();switch(i.toLowerCase()){case"svg":var o=document.createElement("object");this._addEventListeners(o);o.type="image/svg+xml";o.data=t;o.className="SVGImage";this._addSvgQuirks(o);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var r=document.createElement("img");this._addEventListeners(r);if(s){var a=this;s(t).then(function(e){r.src=e},function(e){a.fireContentChangesFinished({content:null,failureReason:{errorMessage:e}})})}else{r.src=t}break;default:setTimeout(function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_UNSUPPORTED_IMAGE_TYPE"),sourcesFailedToDownload:[{source:t}]}})}.bind(this),0);break}};i.prototype._handleLoadSucceeded=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:t})};i.prototype._handleLoadFailed=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_IMAGE_LOAD_FAILED"),sourcesFailedToDownload:[{source:t instanceof HTMLImageElement?t.src:t.data}]}})};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/IncludeUsageIdType", ["sap/ui/base/DataType"],function(e){"use strict";var r=e.createType("sap.ui.vk.IncludeUsageIdType",{isValid:function(e){if(typeof e==="boolean"){return true}if(typeof e==="string"){return e.trim().length>0}if(Array.isArray(e)){return e.every(function(e){return typeof e==="string"&&e.trim().length>0})}return false}},e.getType("any"));r.to$expandQueryParameter=function(e){function r(e){e=e.replaceAll("'","''");return e.indexOf(".")!==-1||e.indexOf(",")!==-1?"'"+e+"'":e}if(Array.isArray(e)){return e.map(function(e){return"usageId."+r(e)})}else if(typeof e==="string"){return["usageId."+r(e)]}else if(e){return["usageId"]}else{return[]}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/JointUtils", ["./glMatrix"],function(e){"use strict";var n=e.mat4;var t=e.glMatrix.ARRAY_TYPE;var a={recalculateJoints:function(e,a,r){var i;if(r.length===16){i=r}else{i=new t(16);n.fromRotationTranslationScale(i,r.quaternion||[0,0,0,1],r.translation||[0,0,0],r.scale||[1,1,1])}var l=new t(16);n.invert(l,i);var o=new t(16);var s=[];e.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===a){n.multiply(o,l,e.node.matrixWorld.elements)}else if(e.node===a){n.invert(o,e.parent.matrixWorld.elements);n.multiply(o,o,i)}else{return}n.getTranslation(e.translation,o);n.getScaling(e.scale,o);n.scale(o,o,[1/e.scale[0],1/e.scale[1],1/e.scale[2]]);n.getRotation(e.quaternion,o);s.push(e)});return s}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LayerProxy", ["sap/ui/base/Object"],function(a){"use strict";var e=a.extend("sap.ui.vk.LayerProxy",{metadata:{library:"sap.ui.vk",abstract:true}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LeaderLineMarkStyle", [],function(){"use strict";var r={None:"None",Point:"Point",Arrow:"Arrow"};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LegendItem", ["sap/m/StandardListItem","./LegendItemRenderer"],function(e,a){"use strict";var t=e.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LegendItemRenderer", ["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(e,a){"use strict";var i=a.extend(e);i.apiVersion=2;i.renderLIContent=function(a,i){var r=i.getColor();var s=i.getSemanticSpotType();var n=null;if(r){a.openStart("span");a.class("sapUiVkLegendItemSquare");a.style("background-color",r);a.openEnd();a.close("span")}if(s){switch(s){case sap.ui.vbm.SemanticType.Error:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Grey.png");break;default:break}if(n){i.addStyleClass("sapUiVkLegendItemSpotType");i.setIcon(n)}}e.renderLIContent(a,i)};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanel", ["./library","sap/ui/core/Control","sap/m/library","./ListPanelRenderer"],function(e,t,o,i){"use strict";var s=t.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{headerText:{type:"string",group:"Misc"},headerIcon:{type:"sap.ui.core.URI",group:"Misc"},expanded:{type:"boolean",group:"Misc",defaultValue:true},expandAnimation:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{items:{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},panel:{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});s.prototype.getSelectedItem=function(){return this._oList.getSelectedItem()};s.prototype.setSelectedItem=function(e,t,o){this._oList.setSelectedItem(e,t,o)};s.prototype.getSelectedItems=function(){return this._oList.getSelectedItems()};s.prototype.init=function(){this._oList=new sap.m.ListBase({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new sap.m.Panel({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new sap.m.Toolbar({active:false}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true};s.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText)};s.prototype.getItems=function(){return this._oList.getItems()};s.prototype.addItem=function(e){return this._oList.addItem(e)};s.prototype.insertItem=function(e,t){return this._oList.insertItem(e,t)};s.prototype.removeItem=function(e){return this._oList.removeItem(e)};s.prototype.removeAllItems=function(){return this._oList.removeAllItems()};s.prototype.setHeaderText=function(e){if(!this._oHeaderText){this._oHeaderText=new sap.m.Title}this._oHeaderText.setText(e);this._bHeaderToolbarChanged=true;if(this._oHeaderIcon){this._oHeaderIcon.setTooltip(e);this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText)}return this.setProperty("headerText",e)};s.prototype.getExpanded=function(){return this._oPanel.getExpanded()};s.prototype.setExpanded=function(e){return this._oPanel.setExpanded(e)};s.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation()};s.prototype.setExpandAnimation=function(e){return this._oPanel.setExpandAnimation(e)};s.prototype.setHeaderIcon=function(e){if(!this._oHeaderIcon){this._oHeaderIcon=new sap.m.Button({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent,tooltip:this.getHeaderText()})}this._oHeaderIcon.setIcon(e);this._bHeaderToolbarChanged=true;if(this._oHeaderText){this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText)}return this.setProperty("headerIcon",e)};s.prototype.setSelectionMode=function(e){this._oList.setMode(e);return this.setProperty("selectionMode",e)};s.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var e=this._oPanel.getHeaderToolbar();e.removeAllContent();if(this._oHeaderIcon){e.addContent(this._oHeaderIcon)}if(this._oHeaderText){e.addContent(this._oHeaderText)}this._bHeaderToolbarChanged=false}};s.prototype._destroyControl=function(e){if(e){e.destroy();e=undefined}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,n){var r=n._oPanel;r.addStyleClass("sapUiVkListPanel");e.openStart("div",n);e.attr("role",sap.ui.core.AccessibleRole.Presentation);e.openEnd();e.renderControl(r);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelStack", ["./library","sap/ui/core/Control","sap/ui/layout/library","./ListPanelStackRenderer"],function(t,e,o,n){"use strict";var a=e.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},expanded:{type:"boolean",group:"Misc",defaultValue:true},expandAnimation:{type:"boolean",group:"Misc",defaultValue:true},collapsible:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{content:{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},layout:{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});a.prototype.init=function(){this._oLayout=new sap.ui.layout.VerticalLayout;this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true};a.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined}};a.prototype.getContent=function(){return this._oLayout.getContent()};a.prototype.addContent=function(t){t.attachExpand(this._onContentExpand.bind(this));t.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(t)};a.prototype.removeContent=function(t){return this._oLayout.removeContent(t)};a.prototype.insertContent=function(t,e){return this._oLayout.insertContent(t,e)};a.prototype.removeAllContent=function(){return this._oLayout.removeAllContent()};a.prototype.getWidth=function(){return this._oLayout.getWidth()};a.prototype.setWidth=function(t){this.setProperty("width",t,true);return this._oLayout.setWidth(t)};a.prototype.setExpanded=function(t){if(t!=this.getExpanded()){if(t){this._expand()}else{this._collapse()}}return this};a.prototype.setExpandAnimation=function(t){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(t){this._oLayout.addStyleClass("sapUiVkLPSTrans")}return this.setProperty("expandAnimation",t,true)};a.prototype.onBeforeRendering=function(){if(this._bFirstTime){var t=false;var e=this.getContent();for(var o=0;o<e.length;++o){if(e[o].getExpanded()){t=true}}this.setExpanded(t);this._bFirstTime=false}};a.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth()}};a.prototype._onContentExpand=function(t){var e=false;var o=this._oLayout.getContent();for(var n=0;n<o.length;++n){if(o[n].getExpanded()){e=true}}this.setExpanded(e)};a.prototype._onContentHeaderIconPress=function(t){var e=t.oSource.getExpanded()?false:true;t.oSource.setExpanded(e);var o=false;var n=this._oLayout.getContent();for(var a=0;a<n.length;++a){if(n[a].getExpanded()){o=true;break}}this.setExpanded(o)};a.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true)};a.prototype._collapse=function(){if(!this.getCollapsible()){return}var t=this.getContent();for(var e=0;e<t.length;++e){t[e].setExpanded(false)}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true)};a.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem")}else{this._oLayout.setWidth("2.5rem")}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelStackRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,t){t._oLayout.addStyleClass("sapUiVkListPanelStack");e.renderControl(t._oLayout)};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Loco", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=250;var i=t.extend("sap.ui.vk.Loco",{metadata:{library:"sap.ui.vk",publicMethods:["addHandler","removeHandler"]},constructor:function(e){if(i._instance&&this.viewport===e){return i._instance}t.apply(this);this._handlers=[];this._gesture=false;this._n=0;this._touchStart=0;this._touchOrigin={x:0,y:0};this._touchMoved=false;this._clickTimer=0;this._clickFunc=null;if(e){this.attachViewportEventHandlers(e)}i._instance=this}});i.prototype.destroy=function(){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handlers.splice()};function n(t){var e=[];var i={points:e,buttons:t.buttons||0,handled:false,passEvent:false,event:t,timeStamp:t.timeStamp,scroll:t.wheelDelta};if(t.touches&&t.touches.length>0){for(var n=0;n<t.touches.length;n++){var s=t.touches[n];e.push({x:s.pageX,y:s.pageY})}}else if(t.pageX!==undefined){e.push({x:t.pageX,y:t.pageY})}else{e.push({x:t.originalEvent.pageX,y:t.originalEvent.pageY})}if(t.buttons&2&&e.length===1){e.push(e[0])}i.n=e.length;if(i.n===2){var h=e[0].x-e[1].x,r=e[0].y-e[1].y;i.x=(e[0].x+e[1].x)*.5;i.y=(e[0].y+e[1].y)*.5;i.d=Math.sqrt(h*h+r*r)}else{i.x=e[0].x;i.y=e[0].y;i.d=0}return i}i.prototype.attachViewportEventHandlers=function(t){this.viewport=t;t.ontouchstart=function(t){if(!t.isMarked()){var e=n(t);if(this._gesture){this._endGesture(e);e.handled=false}this._beginGesture(e)}}.bind(this);t.ontouchend=function(t){var e=n(t);this._endGesture(e);if(t.touches.length>0){e.handled=false;this._beginGesture(e)}}.bind(this);if(sap.ui.Device.support.touch){t.attachBrowserEvent("touchmove",function(t){this._move(n(t))}.bind(this))}t.attachBrowserEvent("mousemove",function(t){this._move(n(t))}.bind(this));t.ontap=function(t){if(!t.isMarked()&&!this._touchMoved){var i=n(t);if(this._clickTimer>0){this._click(i,true)}else{this._clickFunc=this._click.bind(this,i,false);this._clickTimer=setTimeout(this._clickFunc,e)}}}.bind(this);t.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",function(t){if(!t.isMarked()){var e=t.originalEvent;var i={x:e.pageX,y:e.pageY,d:0,buttons:t.buttons,scroll:e.detail?e.detail*-40:e.wheelDelta,n:2,points:[{x:e.pageX,y:e.pageY},{x:e.pageX,y:e.pageY}],handled:false};this._beginGesture(i);i.points[0].y-=i.scroll*.2;i.points[1].y+=i.scroll*.2;i.d=Math.abs(i.scroll)*.4;i.handled=false;this._move(i);i.handled=false;this._endGesture(i);if(i.handled){t.setMarked();if(!i.passEvent){t.preventDefault()}}}},this);t.oncontextmenu=function(t){var e=n(t);this._contextMenu(e)}.bind(this);t.attachBrowserEvent("keyup",function(t){this._keyEventHandler(t)},this)};i.prototype.addHandler=function(t,e){if(!this.viewport){this.attachViewportEventHandlers(t.getViewport())}t.priority=e|0;if(this._handlers.indexOf(t)===-1){this._handlers.push(t)}this._handlers.sort(function(t,e){return t.priority-e.priority})};i.prototype.removeHandler=function(t){var e=this._handlers.indexOf(t);if(e>=0){this._handlers.splice(e,1)}};i.prototype._handleInput=function(t,e){for(var i=this._handlers.length-1;i>=0&&!e.handled;i--){if(this._handlers[i][t]){this._handlers[i][t](e)}}if(e.handled&&e.event){if(!e.passEvent){e.event.preventDefault()}}};i.prototype._beginGesture=function(t){this._handleInput("beginGesture",t);this._touchStart=t.timeStamp;this._touchMoved=false;this._gesture=true;this._touchOrigin.x=t.x;this._touchOrigin.y=t.y;this._n=t.n};i.prototype._move=function(t){if(this._clickFunc!=null){this._clickFunc()}if(this._gesture&&this._n===t.n){if(!this._touchMoved){this._touchMoved=t.timeStamp-this._touchStart>200&&(Math.abs(this._touchOrigin.x-t.x)>3||Math.abs(this._touchOrigin.y-t.y)>3)}this._handleInput("move",t)}else{this._handleInput("hover",t)}};i.prototype._endGesture=function(t){if(!this._gesture){return}this._handleInput("endGesture",t);this._gesture=false};i.prototype._click=function(t,e){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handleInput(e?"doubleClick":"click",t)};i.prototype._contextMenu=function(t){this._handleInput("contextMenu",t)};i.prototype._keyEventHandler=function(t){this._handleInput("keyEventHandler",t)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainer", ["./ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","./MapContainerRenderer","./MapContainerButtonType","./getResourceBundle"],function(t,e,o,n,i,a,s){"use strict";var r=t.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{showNavbar:{type:"boolean",group:"Misc",defaultValue:true},showHome:{type:"boolean",group:"Misc",defaultValue:true},showMapLayer:{type:"boolean",group:"Misc",defaultValue:true},showRectangularZoom:{type:"boolean",group:"Misc",defaultValue:true},showZoom:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{listPanelStack:{type:"sap.ui.vk.ListPanelStack",multiple:false},scrollCont:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});r.prototype.init=function(){t.prototype.init.apply(this,arguments);var e=new sap.ui.model.json.JSONModel;e.setData({rectZoom:false});this.setModel(e,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:s().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(e,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:s().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(n.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:s().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack()}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack()}.bind(this)})}this.addStyleClass("sapUiVkMapContainer")};r.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined}t.prototype.exit.apply(this,arguments)};r.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0]};r.prototype.setListPanelStack=function(t){if(n.system.phone){t.setCollapsible(false);t.setWidth("100%")}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(t)};r.prototype.onBeforeRendering=function(){t.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();this._shouldRenderMapLayerSwitch=false;var e=this.getSelectedContent();if(e!==null){var o=e.getContent();this._isInstanceGeoAnalytic=o instanceof sap.ui.vbm.GeoMap||o instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton)}if(!n.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton)}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton)}this._shouldRenderListPanel=true}else{this._shouldRenderListPanel=false}this._isSupportingMapLayerSwitch=o instanceof sap.ui.vbm.GeoMap&&!(o instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&o.getMapConfiguration()!==null&&this.getShowMapLayer()){var i=o.getMapConfiguration();var a=[].concat(i.MapLayerStacks);if(a.length>1){this._currentText=(new sap.m.Text).addStyleClass("mapLayerSelectedText");this.addDependent(this._currentText);this._box=(new sap.m.HBox).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({press:function(t){if(this._popover.isOpen()){this._popover.close()}else{this._popover.openBy(this._selectionMap)}}.bind(this)}).addStyleClass("mapLayerPopoverItem");this.addDependent(this._selectionMap);this._shouldRenderMapLayerSwitch=true}}}};r.prototype.onAfterRendering=function(){if(n.system.phone){var e=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(e)}t.prototype.onAfterRendering.apply(this,arguments);if(this._shouldRenderMapLayerSwitch){var o=this.getSelectedContent().getContent();var i=o.getMapConfiguration();var a=[].concat(i.MapLayerStacks);var s=o.mVBIContext.GetMainScene();a.forEach(function(t){var e=o.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(t.name);var n=new sap.m.Image({alt:t.name,press:function(i){this._popover.close();this._currentText.setText(t.name);this._selectionMap.setAlt(t.name);o.setRefMapLayerStack(t.name);if(n.getSrc()){this._selectionMap.setSrc(n.getSrc())}else{s.GetPreviewImage(e,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}}.bind(this)}).addStyleClass("layerType");s.GetPreviewImage(e,function(t){n.setSrc(t.src)});var i=new sap.m.Text({text:t.name}).addStyleClass("mapLayerPopoverItemText");var a=new sap.ui.layout.VerticalLayout;a.addContent(n);a.addContent(i);this._box.addItem(a)},this);this._currentText.setText(o.getRefMapLayerStack());this._selectionMap.setAlt(o.getRefMapLayerStack());s.GetPreviewImage(s.m_MapLayerStack,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}};r.prototype.setToolbarItem=function(t){if(!t||!t.id){return null}var e;for(var o=0;o<this._customButtons.length;++o){if(t.id===this._customButtons[o].id){e=this._customButtons[o];e.index=o;this._customButtons.splice(o,1);break}}if(!e){e={id:t.id,visible:true,active:true,index:this._customButtons.length,type:a.Click}}if("index"in t){e.index=t.index}if("visible"in t){e.visible=t.visible}if("overflow"in t){e.overflow=t.overflow}if("active"in t){e.active=t.active}if("text"in t){e.text=t.text}if("tooltip"in t){e.tooltip=t.tooltip}if("icon"in t){e.icon=t.icon}if("activeIcon"in t){e.activeIcon=t.activeIcon}if("press"in t){e.press=t.press}if("toggled"in t){e.toggled=t.toggled;if(e.button){e.button.setPressed(t.toggled)}}if("type"in t){e.type=t.type}if(e.index>this._customButtons.length){e.index=this._customButtons.length}else if(e.index<0){e.index=0}this._customButtons.splice(e.index,0,e);this.invalidate();return e};r.prototype.setSelectedContent=function(e){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom")}}t.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom")}};r.prototype._addToolbarContent=function(){if(n.system.phone){this._oToolbar.addContent(this._oMenuOpenButton)}t.prototype._addToolbarContent.apply(this,arguments)};r.prototype._onNavbarZoomIn=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()+1)}};r.prototype._onNavbarZoomOut=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()-1)}};r.prototype._onNavbarHome=function(t){var e=this.getSelectedContent().getContent();if(e.goToStartPosition){e.goToStartPosition()}};r.prototype._showListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut")};r.prototype._hideListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut")};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainerButtonType", [],function(){"use strict";var e={Click:"Click",Toggle:"Toggle"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainerRenderer", ["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(e,r,o){"use strict";var a=r.extend(e);a.apiVersion=2;a.writeToolbarArea=function(r,a){r.openStart("div");r.class("sapUiVkMapContainerOverlay");r.attr("role",sap.ui.core.AccessibleRole.Presentation);r.openEnd();if(a.getShowNavbar()){r.openStart("div");r.class("sapUiVkMapContainerNavbarArea");r.attr("role",sap.ui.core.AccessibleRole.Presentation);r.openEnd();if(a.getShowMapLayer()&&a._shouldRenderMapLayerSwitch){r.renderControl(a._currentText);r.renderControl(a._selectionMap)}r.openStart("div");r.class("sapUiVkMapContainerNavbarContainer");r.attr("role",sap.ui.core.AccessibleRole.Navigation);r.openEnd();r.renderControl(a._oNavbar);r.close("div");r.close("div")}if(!o.system.phone&&a._shouldRenderListPanel){a._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(a._oScrollCont)}e.writeToolbarArea(r,a);r.close("div");if(o.system.phone){r.openStart("div");r.attr("id",a.getId()+"-LPW");r.class("sapUiVkMapContainerLPW");r.openEnd();r.renderControl(a._oMenuCloseButton);a._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(a._oScrollCont);r.close("div")}};return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Material", ["sap/ui/base/ManagedObject"],function(e){"use strict";var u=e.extend("sap.ui.vk.Material",{metadata:{library:"sap.ui.vk",properties:{id:{type:"string"},name:{type:"string"},ambientColour:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},diffuseColour:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},specularColour:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},emissiveColour:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},opacity:{type:"float",defaultValue:1},glossiness:{type:"float",defaultValue:0},lineColour:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},lineWidth:{type:"float",defaultValue:0},textureDiffuse:{type:"sap.ui.vk.Texture",defaultValue:null},textureBump:{type:"sap.ui.vk.Texture",defaultValue:null},textureOpacity:{type:"sap.ui.vk.Texture",defaultValue:null},textureReflection:{type:"sap.ui.vk.Texture",defaultValue:null},textureEmissive:{type:"sap.ui.vk.Texture",defaultValue:null},textureAmbientOcclusion:{type:"sap.ui.vk.Texture",defaultValue:null}}}});u.prototype.getMaterialRef=function(){return null};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Messages", [],function(){"use strict";var E={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT18:{summary:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_SUMMARY",cause:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_CAUSE",resolution:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_ONEINSTANCEOFVIEWPORTSUPPORTED_RESOLUTION",code:"VIT18"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"},VIT37:{summary:"VIEWER_MSG_FAILEDTOLOADCONTENT_SUMMARY",cause:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_CAUSE",resolution:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_RESOLUTION",code:"VIT37"}};return E},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NativeViewport", ["./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Core","./Loco","./ViewportBase","./ViewportHandler","./Messages","./NativeViewportRenderer","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(t,e,i,s,r,n,o,h,a,l,d,u){"use strict";var _=n.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},events:{resize:{parameters:{oldSize:"object",size:"object"}},move:{parameters:{pan:"object",zoom:"float"}}}},constructor:function(t,i){e.apply(this,arguments);this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=d();this._resizeListenerId=null;this._viewportHandler=new o(this);this._loco=new r(this);this._loco.addHandler(this._viewportHandler,-1);this._reset();this._svgid=this.getId()+"-svg";s.observeAssociations(this)}});_.prototype.init=function(){this.setBackgroundColorTop("transparent");this.setBackgroundColorBottom("transparent")};_.prototype.destroy=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}e.prototype.destroy.call(this)};_.prototype.onBeforeRendering=function(){if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}};_.prototype.onAfterRendering=function(){if(this._canvas){var t=this.getDomRef();if(t.childNodes.length>0){t.insertBefore(this._canvas,t.childNodes[0])}else{t.appendChild(this._canvas)}this._resizeListenerId=i.register(this,this._handleResize.bind(this));this._handleResize({size:{width:t.clientWidth,height:t.clientHeight}})}};_.prototype.setShouldRenderFrame=function(){this.invalidate()};_.prototype._handleResize=function(t){this.fireResize({oldSize:t.oldSize,size:t.size});if(this._s===0||this._svgError){this.zoomTo()}else{this._update()}};_.prototype._reset=function(){this._img=null;this._svg=null;this._svgError=null;this._imageW=0;this._imageH=0;this._bestFitScale=0;this._s=0;this._x=0;this._y=0;this._gx=0;this._gy=0;this._canvas.style.visibility="hidden";while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild)}};_.prototype._update=function(){var t=this._svgError||this._img||this._svg;if(t){var e=this._x-(this._imageW-this._canvas.clientWidth)/2;var i=this._y-(this._imageH-this._canvas.clientHeight)/2;var s="matrix("+this._s+",0,0,"+this._s+","+e+","+i+")";t.style.transform=s;t.style.webkitTransform=s;t.style.msTransform=s;t.style.MozTransform=s;t.style.OTransform=s}};_.prototype.zoomTo=function(){if(this._isRedlineActivated&&!this._redlineHandler){u.info("zoomTo() method is disabled when Redlining is activated");return this}if(this._svgError){this._imageW=550;this._imageH=512}else if(this._svg){this._svg.width=1024;this._imageW=this._svg.clientWidth;this._imageH=this._svg.clientHeight}else if(this._img){this._imageW=this._img.width;this._imageH=this._img.height}else{return this}if(!this._imageW||!this._imageH||!this._canvas.clientWidth||!this._canvas.clientHeight){return this}var t=Math.min(this._canvas.clientWidth/this._imageW,this._canvas.clientHeight/this._imageH);if(this._redlineHandler){this._redlineHandler.pan(-this._x,-this._y);this._redlineHandler.zoom(t/this._s,this._canvas.clientWidth*.5,this._canvas.clientHeight*.5)}this._bestFitScale=t;this._s=t;this._x=0;this._y=0;this._update();this._canvas.style.visibility="visible";return this};_.prototype.loadUrl=function(t,e,i,s,r){if(/^(svg)$/.test(r.toLowerCase())){this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",t);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._svg.setAttribute("width",1024);this._canvas.appendChild(this._svg);var n=document.createElement("div");n.style.position="absolute";n.style.top=0;n.style.left=0;n.style.height="100%";n.style.width="100%";this._canvas.appendChild(n);this._svg.onload=function(){this._svg.onload=null;setTimeout(function(){this.zoomTo();if(e){e()}}.bind(this),0)}.bind(this);this._svg.onerror=function(){u.error(l().getText(h.VIT1.summary),h.VIT1.code,"sap.ui.vk.NativeViewport");this._reset();if(i){i()}}.bind(this);this._svg.src=t;return this}else if(/^(jpg|jpeg|png|gif|bmp|tif|tiff)$/.test(r.toLowerCase())){this._reset();this._img=new Image;this._img.draggable=false;this._img.onload=function(){setTimeout(function(){this.zoomTo();this._canvas.appendChild(this._img);if(e){e()}}.bind(this),0)}.bind(this);this._img.onerror=function(){u.error(l().getText(h.VIT2.summary),h.VIT2.code,"sap.ui.vk.NativeViewport");if(i){i()}};this._img.src=t;return this}else{u.error(l().getText(h.VIT3.summary),h.VIT3.code,"sap.ui.vk.NativeViewport");if(i){i()}}};_.prototype.loadFailed=function(t){this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";var e="http://www.w3.org/2000/svg";this._svgErrorElement=document.createElementNS(e,"svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var i=document.createElementNS(e,"rect");i.setAttribute("fill","#FFFFFF");i.setAttribute("x","-244");i.setAttribute("y","-244");i.setAttribute("width","512");i.setAttribute("height","512");i.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(i);var s=document.createElementNS(e,"path");s.setAttribute("fill","#474747");s.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");s.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(s);var r=document.createElementNS(e,"rect");r.setAttribute("fill","#474747");r.setAttribute("x","-2.167");r.setAttribute("y","-120.847");r.setAttribute("width","30");r.setAttribute("height","119.447");r.setAttribute("fill","#474747");r.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(r);var n=document.createElementNS(e,"rect");n.setAttribute("fill","#474747");n.setAttribute("x","-2.167");n.setAttribute("y","13.6");n.setAttribute("width","30");n.setAttribute("height","30");n.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(n);var o=document.createElementNS(e,"path");o.setAttribute("fill","#474747");o.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(o);var h=document.createElementNS(e,"rect");h.setAttribute("fill","#474747");h.setAttribute("x","-4.167");h.setAttribute("y","-123.259");h.setAttribute("width","30");h.setAttribute("height","119.447");h.setAttribute("fill","#474747");this._svgErrorElement.appendChild(h);var a=document.createElementNS(e,"rect");a.setAttribute("fill","#474747");a.setAttribute("x","-4.167");a.setAttribute("y","11.188");a.setAttribute("width","30");a.setAttribute("height","30");a.setAttribute("fill","#474747");this._svgErrorElement.appendChild(a);var d=document.createElementNS(e,"text");d.setAttribute("id","textError");d.setAttribute("left","auto");d.setAttribute("right","auto");d.setAttribute("y","150");d.setAttribute("x","10");d.setAttribute("display","block");d.setAttribute("text-anchor","middle");d.setAttribute("fill","#474747");d.style.fontFamily="Arial";d.setAttribute("font-size","32");d.textContent=t?t:l().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(d);this._svgError.appendChild(this._svgErrorElement);this.zoomTo();this._canvas.appendChild(this._svgError);return this};_.prototype.beginGesture=function(t,e){this._gx=(t-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(e-this._canvas.clientHeight/2-this._y)/this._s;return this};_.prototype.endGesture=function(){this._gx=0;this._gy=0;return this};_.prototype.pan=function(t,e){if(this._svgError){return this}if(this._redlineHandler){this._redlineHandler.pan(t,e)}this._x+=t;this._y+=e;this._update();this.fireMove({pan:{x:t,y:e},zoom:1});return this};_.prototype.rotate=function(t,e){return this.pan(t,e)};_.prototype._getZoomInLimit=function(){return 500};_.prototype._getZoomOutLimit=function(){return this.getLimitZoomOut()?this._bestFitScale*.25:1e-4};_.prototype._getZoomFactor=function(){return this._s};_.prototype.zoom=function(t){if(this._svgError){return this}var e=this._gx*this._s;var i=this._gy*this._s;var s=this._s;this._s=Math.min(Math.max(this._s*t,this._getZoomOutLimit()),this._getZoomInLimit());t=this._s/s;if(this._redlineHandler){this._redlineHandler.zoom(t)}var r=this._gx*this._s;var n=this._gy*this._s;var o=e-r;var h=i-n;this._x+=o;this._y+=h;this._update();this.fireMove({pan:{x:o,y:h},zoom:t});return this};_.prototype.tap=function(t,e,i){if(i){this.zoomTo()}return this};_.prototype.queueCommand=function(t){t();return this};_.prototype.getViewInfo=function(){var t={};t.camera=[this._s,0,0,this._s,this._x,this._y];return t};_.prototype.setViewInfo=function(t){if(this._svgError){return this}var e=t.camera;this._s=e[0];this._x=e[4];this._y=e[5];this._update();return this};_.prototype.getOutputSize=function(){var t=this.getDomRef().getBoundingClientRect();return{left:t.width/2,top:t.height/2,sideLength:1024}};_.prototype.onSetContentConnector=function(t){t.attachContentReplaced(this._onContentReplaced,this);this._setImage(t.getContent())};_.prototype.onUnsetContentConnector=function(t){this._setImage(null);t.detachContentReplaced(this._onContentReplaced,this)};_.prototype._onContentReplaced=function(t){this._setImage(t.getParameter("newContent"))};_.prototype._setImage=function(t){this._reset();if(t instanceof HTMLObjectElement){this._svg=t;t.setAttribute("id",this._svgid);t.onload=function(){t.onload=null;setTimeout(function(){this.zoomTo()}.bind(this),0)}.bind(this);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){setTimeout(function(){this.zoomTo()}.bind(this),0)}this._canvas.appendChild(t);var e=document.createElement("div");e.style.position="absolute";e.style.top=0;e.style.left=0;e.style.height="100%";e.style.width="100%";this._canvas.appendChild(e)}else if(t instanceof HTMLImageElement){this._img=t;t.draggable=false;setTimeout(function(){this.zoomTo();this._canvas.appendChild(t)}.bind(this),0)}return this};var c=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(t){_.prototype["onsap"+t.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(t.dx,t.dy);this.endGesture();e.preventDefault();e.stopPropagation()}});[{key:"left",dx:-c,dy:0},{key:"right",dx:+c,dy:0},{key:"up",dx:0,dy:-c},{key:"down",dx:0,dy:+c}].forEach(function(t){_.prototype["onsap"+t.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(t.dx,t.dy);this.endGesture();e.preventDefault();e.stopPropagation()}}});[{key:"minus",d:.98},{key:"plus",d:1.02}].forEach(function(t){_.prototype["onsap"+t.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(t.d);this.endGesture();e.preventDefault();e.stopPropagation()}});_.prototype._activateRedline=function(){this._isRedlineActivated=true};_.prototype._deactivateRedline=function(){this._isRedlineActivated=false};return _});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NativeViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("div",r);e.class("sapVizKitNativeViewport");e.attr("tabindex",0);e.style("background-image","linear-gradient("+r.getBackgroundColorTop()+","+r.getBackgroundColorBottom()+")");e.openEnd();r.renderTools(e);r.renderContent(e);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeContentType", [],function(){"use strict";var e={Regular:"Regular",Reference:"Reference",Annotation:"Annotation",Background:"Background",Symbol:"Symbol",Hotspot:"Hotspot"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeHierarchy", ["sap/ui/base/ManagedObject","./Messages","./getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(e,r,t,n,a){"use strict";var i=e.extend("sap.ui.vk.NodeHierarchy",{metadata:{library:"sap.ui.vk",abstract:true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});i.prototype.findNodesById=function(e){if(e.fields.some(function(e){return!e.caseSensitive})){e=jQuery.extend(true,{},e);e.fields.forEach(function(e){if(!e.caseSensitive){e.value=e.value.toLowerCase()}})}var n=function(e,n,i,s){var o;e=e||"equals";s=s||"";var d=n?i:i.toLowerCase();switch(e){case"equals":o=d===s;break;case"contains":o=d.indexOf(s)!==-1;break;case"startsWith":o=d.indexOf(s)===0;break;default:o=false;a.error(t().getText(r.VIT8.summary),r.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy")}return o};var i=function(e,r){return!e.some(function(e){return r.name===e.name?n(r.predicate,r.caseSensitive,e.value,r.value):false})};var s=function(e,r){return e.source===r.source&&e.type===r.type&&!e.fields.some(i.bind(undefined,r.fields))};var o=this.findNodesByName();var d=o.filter(function(r){var t=this.createNodeProxy(r);var n=t.getVeIds();this.destroyNodeProxy(t);return n.some(s.bind(undefined,e))}.bind(this));return d};i.prototype.findNodesByMetadata=function(e){var i=function(e,r,t,n,a,i){if(e&&e.hasOwnProperty(r)){var s=e[r];if(s.hasOwnProperty(t)){var o=s[t];if(!i){o=o.toLowerCase()}return n.some(a.bind(undefined,o))}}return false};var s=function(e,r){return e&&e.hasOwnProperty(r)};var o=function(e,r,t,n,a,i,s){var o=this._baseNodeProxyPool.borrowObject();var d=e.filter(function(e){o.init(this,e);var d=o.getNodeMetadata();var u=r(d,t,n,a,i,s);o.reset();return u}.bind(this));this._baseNodeProxyPool.returnObject(o);return d};var d=this.findNodesByName(),u=[];if(e===undefined||e===null||jQuery.isEmptyObject(e)){u=d}else if(e.category!==null&&e.category!==undefined&&e.category!==""){var c,f,y,l,p=!!(e&&e.caseSensitive);if(e.key===undefined||e.key===null){c=s}else{f=e.value;y=e.predicate||"equals";if(f===undefined||f===null){f="";y="contains"}if(!Array.isArray(f)){f=[f]}if(!p){f=f.map(function(e){return e.toLowerCase()})}switch(y){case"equals":l=function(e,r){return e===r};break;case"contains":l=function(e,r){return e.indexOf(r)!==-1};break;case"startsWith":l=function(e,r){return e.indexOf(r)===0};break;default:a.error(t().getText(r.VIT9.summary),r.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy")}c=i}u=o.bind(this)(d,c,e.category,e.key,f,l,p)}else{a.error(t().getText(r.VIT10.summary),r.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy")}return n(u)};i.prototype._appendAncestors=function(e,r){r=r?new Set(r):null;var t=new Set(e);e.forEach(function(e){var n=this.getAncestors(e);n.forEach(function(e){if(r===null||!r.has(e)){t.add(e)}})},this);return Array.from(t)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeProxy", ["sap/ui/base/ManagedObject"],function(t){"use strict";var e=t.extend("sap.ui.vk.NodeProxy",{metadata:{library:"sap.ui.vk",properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},material:{type:"sap.ui.vk.Material"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}}});e.prototype.setClosed=function(t){return this};e.prototype.setHasChildren=function(t){return this};e.prototype.setName=function(t){return this};e.prototype.setNodeId=function(t){return this};e.prototype.setNodeMetadata=function(t){return this};e.prototype.setVeIds=function(t){return this};e.prototype.assignMaterial=function(t){return this};e.prototype.getLocalTranslate=function(){return[0,0,0]};e.prototype.getLocalScale=function(){return[1,1,1]};e.prototype.getLocalRotationInQuaternion=function(){return[1,0,0,1]};e.prototype.getLocalRotationInAngleAxis=function(){return[1,0,0,0]};e.prototype.getLocalRotationInEuler=function(){return[0,0,0,0]};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeUtils", ["./glMatrix"],function(r){"use strict";var a={centerOfNodes:function(a,e){function u(a,e){var u=a.min.x;var m=a.min.y;var N=a.min.z;var t=a.max.x;var I=a.max.y;var v=a.max.z;var n=[];n.push(r.vec3.fromValues(u,m,N));n.push(r.vec3.fromValues(u,m,v));n.push(r.vec3.fromValues(u,I,N));n.push(r.vec3.fromValues(u,I,v));n.push(r.vec3.fromValues(t,m,N));n.push(r.vec3.fromValues(t,m,v));n.push(r.vec3.fromValues(t,I,N));n.push(r.vec3.fromValues(t,I,v));var f=Number.MAX_SAFE_INTEGER;var E=Number.MAX_SAFE_INTEGER;var i=Number.MAX_SAFE_INTEGER;var s=-Number.MAX_SAFE_INTEGER;var o=-Number.MAX_SAFE_INTEGER;var c=-Number.MAX_SAFE_INTEGER;var x=r.vec3.create();n.forEach(function(a){r.vec3.transformMat4(x,a,e);if(x[0]<f){f=x[0]}if(x[1]<E){E=x[1]}if(x[2]<i){i=x[2]}if(x[0]>s){s=x[0]}if(x[1]>o){o=x[1]}if(x[2]>c){c=x[2]}});return[f,E,i,s,o,c]}var m={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};var N={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};var t=false;a.forEach(function(r){r.traverse(function(r){var a=r.userData.boundingBox;if(!a&&r.geometry){a=r.geometry.boundingBox}if(a){var e=u(a,r.matrixWorld.elements);N.x=Math.min(N.x,e[0]);N.y=Math.min(N.y,e[1]);N.z=Math.min(N.z,e[2]);m.x=Math.max(m.x,e[3]);m.y=Math.max(m.y,e[4]);m.z=Math.max(m.z,e[5]);t=true}})});if(!t){return[0,0,0]}return[Math.abs(m.x-N.x)/2+N.x,Math.abs(m.y-N.y)/2+N.y,Math.abs(m.z-N.z)/2+N.z]}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Notifications", ["sap/base/Log","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer","./getResourceBundle"],function(e,t,s,i,o,a,r){"use strict";var g=s.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});g.prototype.init=function(){if(s.prototype.init){s.prototype.init.call(this)}var t;var i=new o({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:r().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(i.getPressed()){t.openBy(i)}else{t.close()}}});i.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",i);t=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:r().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:r().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){t.getParent().clearAllMessages()}}),afterClose:i.setPressed.bind(i,false)});t.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",t);e.addLogListener(this)};g.prototype.exit=function(){e.removeLogListener(this);if(s.prototype.exit){s.prototype.exit.call(this)}};g.prototype.onLogEntry=function(t){if(t.component.startsWith("sap.ui.vk")&&(t.level===e.Level.WARNING||t.level===e.Level.ERROR||t.level===e.Level.FATAL)){var s=t.details,o,a,g;if(i[t.details]){s=r().getText(i[t.details].summary);o=r().getText(i[t.details].cause);a=r().getText(i[t.details].resolution);g=r().getText("ERROR_DESCRIPTION_CODE")}var l=r().getText("ERROR_DESCRIPTION_COMPONENT");var n=r().getText("ERROR_DESCRIPTION_DATE");var p=r().getText("ERROR_DESCRIPTION_TIME");var v=r().getText("ERROR_DESCRIPTION_LEVEL");var d=r().getText("ERROR_DESCRIPTION_MESSAGE");var R=r().getText("ERROR_DESCRIPTION_CAUSE");var T=r().getText("ERROR_DESCRIPTION_RESOLUTION");var E="<div><b>"+l+":</b><br>"+t.component+"</div><br>"+"<div><b>"+n+":</b><br>"+t.date+"</div><br>"+(g?"<div><b>"+g+":</b><br>"+t.details+"</div><br>":"")+"<div><b>"+p+":</b><br>"+t.time.slice(0,t.time.indexOf("."))+"</div><br>"+"<div><b>"+v+":</b><br>"+t.level+"</div><br>"+"<div><b>"+d+":</b><br>"+s+"</div><br>"+(o?"<div><b>"+R+":</b><br>"+o+"</div><br>":"")+(a?"<div><b>"+T+":</b><br>"+a+"</div>":"");var m=new sap.m.MessageItem({markupDescription:true,title:t.message,description:E});var b=this.getAggregation("_messagePopover");b.addItem(m);this.getAggregation("_messagePopoverToggleButton").setText(b.getItems().length);this.fireMessageAdded()}};g.prototype.clearAllMessages=function(){var e=this.getAggregation("_messagePopover");e.removeAllItems();e.close();this.getAggregation("_messagePopoverToggleButton").setText(e.getItems().length);this.fireAllMessagesCleared();return this};return g});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NotificationsRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.class("sapVizKitNotifications");e.openEnd();e.renderControl(n.getAggregation("_messagePopoverToggleButton"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ObjectType", [],function(){"use strict";var t={PMI:0,Hotspot:1};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OrthographicCamera", ["./Camera"],function(a){"use strict";var r=a.extend("sap.ui.vk.OrthographicCamera",{metadata:{library:"sap.ui.vk",properties:{zoomFactor:{type:"float"}}}});return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OutputSettings", ["sap/ui/core/Element","./getResourceBundle"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.OutputSettings",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float"},height:{type:"float"},dpi:{type:"float"}}}});return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Overlay", ["./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/VBI","sap/ui/unified/Menu","./Messages","./OverlayRenderer","./getResourceBundle","./OverlayArea","sap/base/Log"],function(e,t,i,n,a,o,r,s,h,l){"use strict";var f=t.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",multiple:false}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});f.prototype.getPositionInteractive=function(e,t){if(!this.mIACreateCB&&t&&typeof t==="function"){this.mIACreateCB=t;var i="POS";if(e){i+="ARRAY"}var n={SAPVB:{Automation:{Call:{handler:"OBJECTCREATIONHANDLER",name:"CreateObject",object:"MainScene",scene:"MainScene",instance:"",Param:{name:"data","#":"{"+i+"}"}}}}};this._load(n);return true}else{return false}};f.prototype.openContextMenu=function(e){this._openContextMenu("Overlay",this,e)};f.prototype.setPanAndZoom=function(e,t,i){if(e===0&&t===0&&i===1){return}var n=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=e;this.totalCenterOffset.dy+=t;if(i===1){n.MoveMap(e,t)}else{var a=n.m_Canvas[0];var o=a.m_nExactLOD+Math.log(i)*Math.LOG2E;n.ZoomToGeoPosition(VBI.MathLib.DegToRad([.5,.5]),o);n.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy)}};f.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var e=this.mVBIContext.GetMainScene();if(e){e.ZoomToGeoPosition(VBI.MathLib.DegToRad([.5,.5]),this.initialZoom)}return this};f.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10};f.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear()}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID=""}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget=""}};f.prototype.resize=function(e){var t=this.oControl!=undefined?this.oControl:this;var i=t.mVBIContext;if(i){var n=i.GetMainScene();if(n){if(t.getZoomOnResize()&&e&&e.oldSize.width>0){var a=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;n.ZoomToGeoPosition(n.GetCenterPos(),n.GetCurrentZoomlevel()+a,false,true,true)}n.resizeCanvas(e,true,true)}}};f.prototype.setTarget=function(e){if(!e){return}this.setAssociation("target",e);this.reset();if(e instanceof sap.m.Image){e.addDelegate({onAfterRendering:function(t){this.oTargetDomRef=e.getDomRef();this.oTargetDomRef.addEventListener("load",jQuery.proxy(this._adaptSizeOfTarget,this))}.bind(this)})}else{e.addDelegate({onAfterRendering:function(t){this.oTargetDomRef=e.getDomRef();this._adaptSizeOfTarget()}.bind(this)})}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget=""}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(e,this._adaptSizeOfTarget.bind(this))};f.prototype._adaptSizeOfTarget=function(){var e=this.oTargetDomRef;var t=this.getDomRef();if(e){try{var i=jQuery(e);var n={top:i.offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight()};jQuery(t).width(n.width).height(n.height).css("position","absolute");jQuery(t).css("top","0px").css("left","0px").css("visibility","")}catch(e){l.error(e)}}else{jQuery(t).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden")}};f.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent)}this._adaptSizeOfTarget();if(this.aLoadQueue){var e;for(e=0;e<this.aLoadQueue.length;++e){this._load(this.aLoadQueue[e])}this.aLoadQueue=null}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize)}var t=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(t)}};f.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId())};f.prototype.invalidate=function(e){this.bSceneDirty=true;if(e instanceof h){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive}sap.ui.core.Control.prototype.invalidate.apply(this,arguments)};f.prototype._load=function(e){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[]}this.aLoadQueue.push(e);return}this._loadHtml(e)};f.prototype._loadHtml=function(e){var t=this.getId();var i=null;if(typeof e=="string"){i=JSON.parse(e.indexOf("{")?e.substr(e.indexOf("{")):e)}else if(typeof e=="object"){i=e}if(!i){return}if(!i["SAPVB"]){var n;if(this.mVBIContext&&(n=new VBI.Adaptor(this.mVBIContext).CreateLoadData(i))){this.loadHtml(n);return}else{return}}var a=false;var o=false;var r=false;if(jQuery.type(i)=="object"){if(i.SAPVB){if(i.SAPVB.Config){this.mVBIContext.GetConfig().load(i.SAPVB.Config,this.mVBIContext)}if(i.SAPVB.Resources){this.mVBIContext.GetResources().load(i.SAPVB.Resources,this.mVBIContext)}if(i.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider}this.mVBIContext["m_DataTypeProvider"].load(i.SAPVB.DataTypes,this.mVBIContext)}if(i.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider}this.mVBIContext["m_DataProvider"].load(i.SAPVB.Data,this.mVBIContext);a=true}if(i.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows}this.mVBIContext["m_Windows"].load(i.SAPVB.Windows,this.mVBIContext);r=true}if(i.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions}this.mVBIContext["m_Actions"].load(i.SAPVB.Actions,this.mVBIContext)}if(i.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations}this.mVBIContext["m_Automations"].load(i.SAPVB.Automation,this.mVBIContext)}if(i.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus}this.mVBIContext["m_Menus"].load(i.SAPVB.Menus,this.mVBIContext)}if(i.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager}this.mVBIContext["m_SceneManager"].load(i.SAPVB.Scenes,this.mVBIContext);o=true}}if(a){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange()}}if(o||r){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(t)}}if(o||a){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync()}}}};f.prototype._openContextMenu=function(e,t,i){if(i&&i.vbi_data&&i.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus}for(var n=0;n<this.mAddMenuItems.length;++n){i.addItem(this.mAddMenuItems[n])}this.mVBIContext.m_Menus.m_menus.push(i);this._loadHtml({SAPVB:{version:"2.0",Automation:{Call:{earliest:"0",handler:"CONTEXTMENUHANDLER",instance:t.sId,name:"SHOW",object:e,refID:"CTM",Param:[{name:"x","#":t.mClickPos[0]},{name:"y","#":t.mClickPos[1]},{name:"scene","#":"MainScene"}]}}}})}this.mAddMenuItems=[]};f.prototype._update=function(){var e={SAPVB:{}};if(this.bSceneDirty){this._updateScene(e)}this._updateWindows(e);if(e.SAPVB.Actions){Array.prototype.push.apply(e.SAPVB.Actions.Set.Action,this._getActionArray())}return this._minimizeApp(e)};f.prototype._minimizeApp=function(e){var t,i;var n;i=null;if(!this.bWindowsDirty){n=(t=e)&&(t=t.SAPVB)&&(t=t.Windows)&&(i=JSON.stringify(t))&&i==this.mCurWindows&&delete e.SAPVB.Windows;if(!n){this.mCurWindows=i?i:this.mCurWindows}}else{this.bWindowsDirty=false}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Scenes)&&(i=JSON.stringify(t))&&i==this.mCurScenes&&delete e.SAPVB.Scenes;if(!n){this.mCurScenes=i?i:this.mCurScenes}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Actions)&&(i=JSON.stringify(t))&&i==this.mCurActions&&delete e.SAPVB.Actions;if(!n){this.mCurActions=i?i:this.mCurActions}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(i=JSON.stringify(t))&&i==this.mCurDataTypes&&delete e.SAPVB.DataTypes;if(!n){this.mCurDataTypes=i?i:this.mCurDataTypes}if(!this.bForceDataUpdate){i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Data)&&(i=JSON.stringify(t))&&i==this.mCurData&&delete e.SAPVB.Data;if(!n){this.mCurData=i?i:this.mCurData}}else{this.bForceDataUpdate=false}return e};f.prototype._updateWindows=function(e){e.SAPVB.Windows={Set:[{name:"Main",Window:{id:"Main",caption:"MainWindow",type:"geo",refParent:"",refScene:"MainScene",modal:"true"}}]}};f.prototype._updateScene=function(e){var t=[];var i=[];var n=[];var a=[];this._updateVOData(t,i,n,a);var o=JSON.stringify(t);var r=true;if(!this.saVO){(((e.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=t}else if(this.bRefMapLayerStackDirty||!(this.saVO===o)){e.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),t)}else{r=false}this.saVO=o;if(this.bDataDeltaUpdate){e.SAPVB.Data=[];for(var s=0;s<i.length;++s){e.SAPVB.Data.push({Set:{name:i[s].name,type:"N",N:i[s]}})}}else{((e.SAPVB.Data={}).Set={}).N=i}if(r){((e.SAPVB.DataTypes={}).Set={}).N=n}((e.SAPVB.Actions={}).Set={}).Action=a;this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false};f.prototype._isEventRegistered=function(e,t){var i=this.getAggregation(e);if(!i){return false}for(var n=0;n<i.length;++n){var a=i[n];if(a.hasListeners(t)){return true}}return false};f.prototype._getTemplateBindingInfo=function(e){var t=this.getBindingInfo(e);if(t&&t.template){return t.template.mBindingInfos}};f.prototype._getBindInfo=function(e){var t={};var i=this._getTemplateBindingInfo(e);t.C=i?i.hasOwnProperty("color"):true;t.CB=i?i.hasOwnProperty("colorBorder"):true;t.DCH=i?i.hasOwnProperty("deltaColorHot"):true;t.CS=i?i.hasOwnProperty("colorSelect"):true;t.CNS=i?i.hasOwnProperty("colorNonSelect"):true;t.TT=i?i.hasOwnProperty("tooltip"):true;t.M=i?i.hasOwnProperty("changeable"):true;t.hasTemplate=i?true:false;return t};f.prototype._updateVOData=function(e,t,i,n){var a,o;this.AreaBindInfo=a=this.AreaBindInfo?this.AreaBindInfo:this._getBindInfo("areas");o=a.hasTemplate?this.getBindingInfo("areas").template:null;var r={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};r["posarray.bind"]=r.id+".P";if(a.C){r["color.bind"]=r.id+".C"}else{r.color=o.getColor()}if(a.CB){r["colorBorder.bind"]=r.id+".C"}else{r.colorBorder=o.getColorBorder()}if(a.DCH){r["hotDeltaColor.bind"]=r.id+".DCH"}else{r.hotDeltaColor=o.getDeltaColorHot()}if(a.CS){r["colorSelect.bind"]=r.id+".C"}else{r.colorSelect=o.getColorSelect()}if(a.CNS){r["colorNonSelect.bind"]=r.id+".C"}else{r.colorNonSelect=o.getColorNonSelect()}if(!a.M){r["VB:c"]=o.getChangeable()}e.push(r);var s={name:r.id,key:"K"};s.A=[{name:"K",alias:"K",type:"string"},{name:"VB:s",alias:"VB:s",type:"boolean"},{name:"P",alias:"P",type:"vectorarray",changeable:"true"}];if(a.C){s.A.push({name:"C",alias:"C",type:"color"})}if(a.CB){s.A.push({name:"CB",alias:"CB",type:"string"})}if(a.DCH){s.A.push({name:"DCH",alias:"DCH",type:"string"})}if(a.CS){s.A.push({name:"CS",alias:"CS",type:"string"})}if(a.CNS){s.A.push({name:"CNS",alias:"CNS",type:"string"})}if(a.TT){s.A.push({name:"TT",alias:"TT",type:"string"})}i.push(s);var h=r.id;if(this._isEventRegistered("areas","click")){n.push({id:h+"1",name:"click",refScene:"MainScene",refVO:h,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this._isEventRegistered("areas","contextMenu")){n.push({id:h+"2",name:"contextMenu",refScene:"MainScene",refVO:h,refEvent:"ContextMenu"})}if(this._isEventRegistered("areas","edgeClick")){n.push({id:h+"7",name:"edgeClick",refScene:"MainScene",refVO:h,refEvent:"EdgeClick"})}n.push({id:h+"4",name:"handleMoved",refScene:"MainScene",refVO:h,refEvent:"HandleMoved"});n.push({id:h+"5",name:"handleContextMenu",refScene:"MainScene",refVO:h,refEvent:"HandleContextMenu"});n.push({id:h+"8",name:"edgeContextMenu",refScene:"MainScene",refVO:h,refEvent:"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){n.push({id:h+"6",name:"handleClick",refScene:"MainScene",refVO:h,refEvent:"HandleClick"})}var l={name:r.id,E:[]};var f=this.getAreas();for(var d=0;d<f.length;++d){l.E.push(f[d].getDataElement())}t.push(l)};f.prototype._getSceneVOdelta=function(e,t){var i=[];var n=[];var a={};for(var o=0,r=e.length;o<r;++o){a[e[o].id]=e[o]}for(var s=0;s<t.length;++s){if(a[t[s].id]){if(JSON.stringify(t[s])!=JSON.stringify(a[t[s].id])){n.push({id:t[s].id,type:"VO"});i.push(t[s])}}else{i.push(t[s])}delete a[t[s].id]}for(var h in a){n.push({id:h,type:"VO"})}var l={Merge:{name:"MainScene",type:"SceneGeo",SceneGeo:{id:"MainScene"}}};if(n.length){l.Merge.SceneGeo.Remove=n}if(i.length){l.Merge.SceneGeo.VO=i}return l};f.prototype._getActionArray=function(){var e=[];if(this.mEventRegistry["click"]){e.push({id:"Overlay1",name:"click",refScene:"MainScene",refVO:"Map",refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]){e.push({id:"Overlay2",name:"contextMenu",refScene:"MainScene",refVO:"Map",refEvent:"ContextMenu",AddActionProperty:[{name:"pos"}]})}e.push({id:"Overlay3",name:"GetPosComplete",refScene:"MainScene",refVO:"General",refEvent:"CreateComplete"});return e};f.prototype._handleChangedData=function(e){try{this.bHandleDataChangeActive=true;if(e&&e.length){for(var t=0,i;t<e.length;++t){i=e[t];if(i.E&&i.E.length){for(var n=0,a,o;n<i.E.length;++n){a=i.E[n];o=this._findInstance(a.K);if(o){o.handleChangedData(a)}}}}}this.bHandleDataChangeActive=false}catch(e){this.bHandleDataChangeActive=false;throw e}};f.prototype._findInstance=function(e){var t=e.indexOf(".")!==-1?e.split(".")[1]:e;var i=this.getAreas();for(var n=0;n<i.length;++n){var a=i[n];if(a.getId()===t){return a}}return null};f.prototype._handleAggregationEvent=function(e){var t;if(t=this._findInstance(e.Action.instance)){try{t.handleEvent(e)}catch(e){l.error(s().getText(o.VIT11.summary),o.VIT11.code,"sap.ui.vk.Overlay")}}};f.prototype.isRendered=function(){return this.getDomRef()?true:false};f.prototype.fireSubmit=function(e){var t=JSON.parse(e.data);if(t.Data&&t.Data.Merge){this._handleChangedData(t.Data.Merge.N)}if(t.Action.object==="OverlayArea"){this._handleAggregationEvent(t)}else{var i=t.Action.name,n;if(i==="click"||i==="contextMenu"){n=[t.Action.Params.Param[0]["#"],t.Action.Params.Param[1]["#"]]}switch(i){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(t.Action.Params.Param[0]["#"]);this.mIACreateCB=null}catch(e){this.mIACreateCB=null;throw e}}break;case"click":this.fireClick({clientX:n[0],clientY:n[1],pos:t.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var o=new a;o["vbi_data"]={};o["vbi_data"].menuRef="CTM";o["vbi_data"].VBIName="DynContextMenu";this.mClickPos=n;this.fireContextMenu({pos:t.Action.AddActionProperties.AddActionProperty[0]["#"],menu:o});break;default:break}}};f.prototype.fireRender=function(e){};f.prototype.fireMove=function(e){};f.prototype.fireZoom=function(e){};f.prototype.fireOpenWindow=function(e){};f.prototype.fireCloseWindow=function(e){};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OverlayArea", ["sap/ui/core/Element","sap/ui/unified/Menu","sap/ui/unified/MenuItem","./getResourceBundle"],function(e,t,i,n){"use strict";var a=e.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});a.prototype.openContextMenu=function(e){this.getParent().openContextMenu("OverlayArea",this,e)};a.prototype.getDataElement=function(){var e={};var t=this.getParent().AreaBindInfo;e.K=this.getId();if(t.C){e.C=this.getColor()}if(t.CB){e.CB=this.getColorBorder()}if(t.DCH){e.DCH=this.getDeltaColorHot()}if(t.CS){e.CS=this.getColorSelect()}if(t.CNS){e.CNS=this.getColorNonSelect()}if(t.TT){e.TT=this.getTooltip()}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(t.M){e["VB:c"]=this.getChangeable()}return e};a.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P)}};a.prototype.handleEvent=function(e){var a=e.Action.name;var o="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var r=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(r.mVBIContext.m_Menus){r.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var s=new t;s["vbi_data"]={};s["vbi_data"].menuRef="CTM";s["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var l=e.Action.Params.Param[2]["#"];r.mAddMenuItems.push(new i({text:n().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",l)}))}else if(a==="handleContextMenu"){var u=e.Action.Params.Param[2]["#"];r.mAddMenuItems.push(new i({text:n().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",u)}))}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:s})}else{this[o]({index:e.Action.Params.Param[2]["#"],menu:s})}}else{r._openContextMenu(e.Action.object,this,s)}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]})}else if(a.indexOf("Click")>-1){this[o]({index:e.Action.Params.Param[2]["#"]})}else{this[o]()}};a.prototype.getKey=function(){var e=this.getProperty("key");if(!e){e=this.getId()}return e};a.prototype._handleCtxFunction=function(e,t){var i=this.getPosition().split(";");var n=t*3;if(e==="REMOVE"){i.splice(n,3)}else if(e==="SPLIT"){var a=[i[n],i[n+1]];var o=n+3<i.length?[i[n+3],i[n+4]]:[i[0],i[1]];var r=[parseFloat(a[0])+(o[0]-a[0])/2,parseFloat(a[1])+(o[1]-a[1])/2];i.splice(n+3,0,r[0].toString(),r[1].toString(),"0")}this.setPosition(i.toString().replace(/,/g,";"))};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OverlayRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,i){e.openStart("div",i);e.class("sapUiVkOverlay");e.openEnd();e.close("div");var n;if(n=i._update()){i._load(n)}};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/PerspectiveCamera", ["./Camera"],function(e){"use strict";var a=e.extend("sap.ui.vk.PerspectiveCamera",{metadata:{library:"sap.ui.vk",properties:{fov:{type:"float"}}}});return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ProgressIndicator", ["sap/m/ProgressIndicator","./ProgressIndicatorRenderer","sap/base/Log"],function(e,t,a){"use strict";var r=e.extend("sap.ui.vk.ProgressIndicator");r.prototype.setPercentValue=function(e){var t=function e(t){return typeof t==="number"&&!isNaN(t)&&t>=0&&t<=100};var r=this,s,n,i=this.$(),u,l=false;if(!t(e)){e=0;a.warning(this+": percentValue ("+e+") is not correct! Setting the default percentValue:0.")}if(this.getPercentValue()!==e){n=this.getPercentValue()-e;this.setProperty("percentValue",e,true);if(!i.length){return this}["sapMPIValueMax","sapMPIValueMin","sapMPIValueNormal","sapMPIValueGreaterHalf"].forEach(function(e){i.removeClass(e)});i.addClass(this._getCSSClassByPercentValue(e));i.addClass("sapMPIAnimate").attr("aria-valuenow",e).attr("aria-valuetext",this._getAriaValueText({fPercent:e}));u=l?Math.abs(n)*20:0;s=this.$("bar");s.animate({"flex-basis":e+"%"},u,"linear",function(){r._setText.apply(r);r.$().removeClass("sapMPIAnimate")})}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ProgressIndicatorRenderer", ["sap/m/ProgressIndicatorRenderer"],function(e){"use strict";return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Redline", [],function(){"use strict";var e={ElementType:{Line:"line",Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand",Text:"text",Comment:"comment"},svgNamespace:"http://www.w3.org/2000/svg"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineCollaboration", ["sap/ui/core/Element","./Core","sap/ui/vk/tools/RedlineTool","./RedlineConversation","sap/ui/vk/uuidv4","sap/ui/vk/RedlineUpgradeManager","sap/ui/core/Core"],function(e,t,i,o,n,r,a){"use strict";var s=e.extend("sap.ui.vk.RedlineCollaboration",{metadata:{library:"sap.ui.vk",aggregations:{conversations:{singularName:"conversation",type:"sap.ui.vk.RedlineConversation",multiple:true}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false},activeConversation:{type:"sap.ui.vk.RedlineConversation",multiple:false},activeComment:{type:"sap.ui.vk.RedlineComment",multiple:false}},events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}},elementHovered:{parameters:{elementId:"string"}},conversationActivating:{parameters:{conversation:"sap.ui.vk.RedlineConversation"}},conversationActivated:{parameters:{conversation:"sap.ui.vk.RedlineConversation",viewportLocked:"boolean"}}}},constructor:function(t,i){e.apply(this,arguments);if(typeof t==="object"){i=t;t=undefined}this._elementId=i&&i.elementId?i.elementId:n()}});s.prototype.init=function(){this._header=new Map};s.prototype.exit=function(){if(this._tool){this._tool.setActive(false);this._tool.destroy();this._tool=null}var e=a.byId(this.getViewport());if(e){var t=e.getMeasurementSurface();t.detachMeasurementsAdded(this._onmMeasurementsAdded,this);t.detachMeasurementsRemoving(this._onMeasurementsRemoving,this);t.detachScaleChanged(this._onMeasurementsScaleChanged,this)}};s.prototype.getElementId=function(){return this._elementId};s.prototype.setViewport=function(e){this.setAssociation("viewport",e);if(!this._tool){this._tool=new i;this._tool.attachElementCreated(this._onElementCreated,this);this._tool.attachElementClicked(this._onElementClicked,this);this._tool.attachElementHovered(this._onElementHovered,this)}else{this._tool.setActive(false,e)}e.addTool(this._tool);var t=e.getMeasurementSurface();t.attachMeasurementsAdded(this._onMeasurementsAdded,this);t.attachMeasurementsRemoving(this._onMeasurementsRemoving,this);t.attachScaleChanged(this._onMeasurementsScaleChanged,this);return this};s.prototype._onMeasurementsAdded=function(e){var t=e.getParameter("measurements");if(this.getActiveConversation()){var i=a.byId(this.getActiveConversation());var o;if(this.getActiveComment()){o=a.byId(this.getActiveComment())}t.forEach(function(e){var t=e.toJSON();i.addMeasurement(t);if(o){o.addMeasurement(t.id)}},this)}};s.prototype._onMeasurementsRemoving=function(e){var t=e.getParameter("measurements");if(this.getActiveConversation()){var i=a.byId(this.getActiveConversation());t.forEach(function(e){var t=e.getId();i.removeMeasurement(t);var o=i.getComments();o.forEach(function(e){e.removeMeasurement(t)})})}};s.prototype._onMeasurementsScaleChanged=function(e){var t=e.getParameter("newScale");if(this.getActiveConversation()){var i=a.byId(this.getActiveConversation());i.setMeasurementScale(t)}};s.prototype._onElementHovered=function(e){this.fireElementHovered({elementId:e.getParameter("elementId")})};s.prototype._onElementCreated=function(e){var t=e.getParameter("element");if(this.getActiveConversation()){var i=a.byId(this.getActiveConversation());i.addContent(t);this._tool.destroyRedlineElements();i._activate(this._tool)}if(this.getActiveComment()){var o=a.byId(this.getActiveComment());o.addContent(t)}this.fireElementCreated({element:t})};s.prototype._onElementClicked=function(e){this.fireElementClicked({elementId:e.getParameter("elementId")})};s.prototype.setHeaderProperty=function(e,t){this._header.set(e,t);return this};s.prototype.getHeaderProperty=function(e){return this._header.get(e)};s.prototype.removeHeaderProperty=function(e){this._header.delete(e);return this};s.prototype.createConversation=function(e){var t=new o({conversationName:e});this.addConversation(t);this.setActiveConversation(t);return t};s.prototype.setActiveConversation=function(e){var i=a.byId(this.getActiveConversation());if(i){if(i.getViewInfo()){var o=this._updateViewInfo();i.setViewInfo(o)}i._deactivate()}this.setAssociation("activeConversation",e);var n=a.byId(this.getViewport());if(!n){return this}if(!e){this._tool.setActive(false,n);return this}this.fireConversationActivating({conversation:e});this._tool.destroyRedlineElements();if(e.getViewInfo()){var r=a.byId(n.getContentConnector()).getContent();var s=r.getViews();var l;for(var v=0;v<s.length;v++){if(s[v].getViewId()===e.getViewId()){l=s[v]}}if(l){t.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._readyForAnimation,this);var h=a.byId(n.getViewStateManager());var d=a.byId(h.getViewManager());d.setAllowAutoPlayAnimation(false);this._activatingView=true;if(this._tool.getActive()){this._tool.setActive(false,n)}d.activateView(l,true)}if(!this._tool.getActive()){this._tool.setActive(true,n)}}else if(this._tool.getActive()){this._tool.setActive(false,n)}if(e.getContent()){e._activate(this._tool)}if(e.getMeasurements()){var m=e.getMeasurements();n.getMeasurementSurface().fromJSON({measurements:m,scale:e.getMeasurementScale()},true);n.setShouldRenderFrame()}this.fireConversationActivated({conversation:e,viewportLocked:this._tool.getActive()});return this};s.prototype._readyForAnimation=function(){var e=a.byId(this.getViewport());if(!e){return}var i=a.byId(this.getActiveConversation());if(i){var o=a.byId(e.getViewStateManager()).getAnimationPlayer();o.setTime(i.getAnimationOffset());var n=i.getViewInfo();if(e.getCamera()&&e.getCamera().getCameraRef()){var r=e.getCamera().getCameraRef();if(n.camera.view&&r&&!r.view){r.view=n.camera.view;r.view.enabled=true}}e.setViewInfo(n)}this._activatingView=false;t.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._readyForAnimation,this);var s=a.byId(e.getViewStateManager());var l=a.byId(s.getViewManager());l.setAllowAutoPlayAnimation(true)};s.prototype.createElement=function(e){var t=a.byId(this.getActiveConversation());var i=a.byId(this.getViewport());if(!i){return e}if(t&&!t.getViewInfo()){var o=this._updateViewInfo();t.setViewId(i.getCurrentView().getViewId());t.setViewInfo(o);t.setAnimationOffset(a.byId(i.getViewStateManager()).getAnimationPlayer().getTime())}if(!this._tool.getActive()){this._tool.setActive(true,i)}this._tool.startAdding(e);return e};s.prototype.deactivateRedlineDrawing=function(){if(this._tool){this._tool.stopAdding()}return this};s.prototype.removeElement=function(e){var t=a.byId(this.getActiveConversation());if(t){t.removeContent(e);this._tool.destroyRedlineElements();t._activate(this._tool)}return this};s.prototype._normalizeElementsArray=function(e){var t=[];var i=this.getActiveRedlineElements();if(Array.isArray(e)){for(var o=0;o<e.length;o++){if(e[o]instanceof sap.ui.vk.RedlineElement){t.push(e[o])}else{for(var n=0;n<i.length;n++){if(e[o]===i[n].getElementId()){t.push(i[n])}}}}}else if(e instanceof sap.ui.vk.RedlineElement){t.push(e)}else{for(var r=0;r<i.length;r++){if(e===i[r].getElementId()){t.push(i[r])}}}return t};s.prototype.setHighlight=function(e,t){if(!e){return this}var i=this._normalizeElementsArray(e);for(var o=0;o<i.length;o++){var n=i[o];n.setHalo(true);if(t){n.setHaloColor(t)}else if(this._tool._haloColor){n.setHaloColor(this._tool._haloColor)}else{n.setHaloColor("rgba(255, 0, 0, 1)")}}this._tool.getGizmo().rerender();return this};s.prototype.setDefaultHighlightColor=function(e){if(e){this._tool._haloColor=e}return this};s.prototype.clearHighlight=function(e){if(!e){return this}var t=this._normalizeElementsArray(e);for(var i=0;i<t.length;i++){t[i].setHalo(false)}this._tool.getGizmo().rerender();return this};s.prototype.addStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().addStyleClass(e)}return this};s.prototype.removeStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().removeStyleClass(e)}return this};s.prototype.toggleStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().toggleStyleClass(e)}return this};s.prototype._updateViewInfo=function(){var e=a.byId(this.getViewport());if(!e){return{}}var t={camera:{matrices:true},visibility:true,selection:true};var i=e.getViewInfo(t);return i};s.prototype.freezeView=function(){var e=a.byId(this.getActiveConversation());var t=a.byId(this.getViewport());if(!t){return this}if(e&&!e.getViewInfo()){var i=this._updateViewInfo();e.setViewId(t.getCurrentView().getViewId());e.setViewInfo(i);e.setAnimationOffset(a.byId(t.getViewStateManager()).getAnimationPlayer().getTime())}if(!this._tool.getActive()){this._tool.setActive(true,t)}return this};s.prototype.unfreezeView=function(){var e=a.byId(this.getActiveConversation());if(e){var t=e.getComments();if(this._tool.getActive()&&this._tool.getRedlineElements().length===0&&(t.length===0||t.length===1&&!t[0].getText())){this._tool.setActive(false);e.setViewInfo(null)}}return this};s.prototype.getActiveRedlineElements=function(){if(this._tool){var e=this._tool.getRedlineElements();return e}};s.prototype._createConversationFromJSON=function(e){var t=new o;var i=t.importJSON(e);this.addConversation(t);return i};s.prototype.importJSON=function(e){e=r.upgrade(e);var t=new Set;this.setActiveConversation(null);this.destroyConversations();this.setActiveComment(null);var i=Object.entries(e.header);for(var o=0;o<i.length;o++){this.setHeaderProperty(i[o][0],i[o][1])}this._elementId=this.getHeaderProperty("elementId");var n=e.conversations;if(n){for(var a=0;a<n.length;a++){var s=this._createConversationFromJSON(n[a]);s.forEach(t.add,t)}}var l=this.getHeaderProperty("initialConversation");var v=this.getConversations();var h;if(v){for(var d=0;d<v.length;d++){if(v[d].getElementId()===l){h=v[d];break}}}this.setActiveConversation(h);return t};s.prototype.exportJSON=function(){var e="";if(this.getActiveConversation()){var t=a.byId(this.getActiveConversation());if(!this._activatingView&&t.getViewInfo()){var i=this._updateViewInfo();t.setViewInfo(i)}e=t.getElementId()}this.setHeaderProperty("initialConversation",e);if(!this.getHeaderProperty("elementId")){this.setHeaderProperty("elementId",this._elementId)}var o=Object.fromEntries(this._header);var n={schemaVersion:"1.0",header:o,conversations:this.getConversations().map(function(e){return e.exportJSON()})};return n};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineConversation", ["sap/ui/core/Element","sap/ui/base/ManagedObjectObserver","sap/ui/vk/uuidv4","sap/ui/vk/RedlineElementComment"],function(e,t,n,i){"use strict";var s=e.extend("sap.ui.vk.RedlineConversation",{metadata:{library:"sap.ui.vk",properties:{conversationName:{type:"string"},timestamp:{type:"int"},viewId:{type:"string",defaultValue:""},viewInfo:{type:"any",defaultValue:null},animationOffset:{type:"float",defaultValue:0},measurementScale:{type:"float",defaultValue:1}},aggregations:{comments:{singularName:"comment",type:"sap.ui.vk.RedlineElementComment",multiple:true}}},constructor:function(t,i){e.apply(this,arguments);if(typeof t==="object"){i=t;t=undefined}this._elementId=i&&i.elementId?i.elementId:n()}});s.prototype.getElementId=function(){return this._elementId};s.prototype.addContent=function(e){if(!this._elements){this._elements=new Map}var t;var n;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId();n=e.exportJSON()}else{t=e.elementId;n=e}this._elements.set(t,n);return this};s.prototype.removeContent=function(e){if(this._elements){var t;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId()}else if(typeof e==="string"){t=e}else{t=e.elementId}this._elements.delete(t)}return this};s.prototype.getContent=function(){var e=[];if(this._elements){e=Array.from(this._elements.values())}return e};s.prototype.addMeasurement=function(e){if(!this._measurements){this._measurements=new Map}this._measurements.set(e.id,e);return this};s.prototype.removeMeasurement=function(e){if(this._measurements){var t;if(typeof e==="string"){t=e}else{t=e.id}this._measurements.delete(t)}return this};s.prototype.getMeasurements=function(){var e=[];if(this._measurements){e=Array.from(this._measurements.values())}return e};s.prototype._activate=function(e){var n=this;var i={properties:true};if(!this._objectObserver){var s=function(e){if(e.type==="property"){n.addContent(e.object)}};this._objectObserver=new t(s)}this._objectObserver.disconnect();e.importJSON(this.getContent());var r=e.getRedlineElements();for(var a=0;a<r.length;a++){this._objectObserver.observe(r[a],i)}};s.prototype._deactivate=function(){if(this._objectObserver){this._objectObserver.disconnect()}};s.prototype._createCommentFromJSON=function(e){var t=new i;var n=t.importJSON(e);this.addComment(t);return n};s.prototype.exportJSON=function(){if(this.getContent()){this.getContent().forEach(function(e){if(!e.createTimestamp){e.createTimestamp=Date.now()}if(e.deletedByUser){e.deleteTimestamp=Date.now()}})}var e={conversationId:this.getElementId(),conversationName:this.getConversationName(),timestamp:this.getTimestamp()?this.getTimestamp():Date.now(),sceneView:this.getViewId(),viewInfo:this.getViewInfo(),animationOffset:this.getAnimationOffset(),measurementScale:this.getMeasurementScale(),comments:this.getComments().map(function(e){return e.exportJSON()}),content:this.getContent(),measurements:this.getMeasurements()};return e};s.prototype.importJSON=function(e){var t=new Set;if(e.hasOwnProperty("conversationId")){this._elementId=e.conversationId}if(e.hasOwnProperty("conversationName")){this.setConversationName(e.conversationName)}if(e.hasOwnProperty("timestamp")){this.setTimestamp(e.timestamp)}if(e.hasOwnProperty("sceneView")){this.setViewId(e.sceneView)}if(e.hasOwnProperty("viewInfo")){this.setViewInfo(e.viewInfo)}if(e.hasOwnProperty("animationOffset")){this.setAnimationOffset(e.animationOffset)}if(e.hasOwnProperty("measurementScale")){this.setMeasurementScale(e.measurementScale)}if(e.hasOwnProperty("comments")){var n=e.comments;if(n){for(var i=0;i<n.length;i++){var s=this._createCommentFromJSON(n[i]);if(s){t.add(s)}}}}if(e.hasOwnProperty("content")){var r=e.content;if(r){for(var a=0;a<r.length;a++){var o=r[a].createdByUser;if(o){t.add(o)}var m=r[a].deletedByUser;if(m){t.add(m)}this.addContent(r[a])}}}if(e.hasOwnProperty("measurements")){var f=e.measurements;if(f){for(var p=0;p<f.length;p++){this.addMeasurement(f[p])}}}return t};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesign", ["sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(e,t,i,n,s,r,a){"use strict";var o=t.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});o.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new n(this);this._designHandler=new s(this);this._loco=new r(this)};o.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler)}};o.prototype.onAfterRendering=function(){var e=this.getDomRef();e.style.width="100%";e.style.height="100%";if(this._isAddingModeActive){this._loco.addHandler(this._designHandler)}else{this._loco.addHandler(this._gestureHandler)}this.updatePanningRatio()};o.prototype.startAdding=function(e){this._isAddingModeActive=true;this._activeElementInstance=e;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this};o.prototype.stopAdding=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this};o.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};o.prototype._getTargetViewport=function(){return this._targetViewport};o.prototype._setTargetViewport=function(e){this._targetViewport=e;this._targetViewport.attachEvent("resize",this,this._onresize,this)};o.prototype._onresize=function(e){var t=e.oSource.getOutputSize();this.setProperty("virtualLeft",t.left,true);this.setProperty("virtualTop",t.top,true);this.setProperty("virtualSideLength",t.sideLength,true);this.invalidate()};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesignHandler", ["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","sap/ui/core/Core"],function(e,t,n){"use strict";var i=e.extend("sap.ui.vk.RedlineDesignHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(e){this._redlineDesign=e;this._x=0;this._y=0;this._gesture=false}});i.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};i.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};i.prototype._inside=function(e,t){var n=t.getDomRef(),i=false;if(n!==null){var r=this._getOffset(n);var s={x:r.x,y:r.y,width:n.getBoundingClientRect().width,height:n.getBoundingClientRect().height};i=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height}return i};i.prototype._onresize=function(e){this._gesture=false};i.prototype.beginGesture=function(e){var t=this.getViewport();if(this._inside(e,t)&&t._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;t._isDrawingOn=true;var i=t.getDomRef();var r=t._toVirtualSpace(e.x-i.getBoundingClientRect().left-window.pageXOffset,e.y-i.getBoundingClientRect().top-window.pageYOffset);t._activeElementInstance.setOriginX(r.x);t._activeElementInstance.setOriginY(r.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){t.invalidate()}else{var s=n.createRenderManager();t._activeElementInstance.render(s);s.flush(t.getDomRef(),false,true);s.destroy();var a=t.$();a.html(a.html())}e.handled=true}return this};i.prototype.move=function(e){var t=this.getViewport();if(t._activeElementInstance&&t._isDrawingOn){var n=t.getDomRef().getBoundingClientRect(),i=e.x-n.left-window.pageXOffset,r=e.y-n.top-window.pageYOffset;t._activeElementInstance.edit(i,r);e.handled=true}return this};i.prototype.endGesture=function(e){var t=this.getViewport();this._gesture=false;if(t._activeElementInstance){t.addRedlineElement(t._activeElementInstance);t.fireElementCreated({element:t._activeElementInstance});t.stopAdding();e.handled=true}return this};i.prototype.contextMenu=function(e){e.handled=true};i.prototype.getViewport=function(){return this._redlineDesign};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesignRenderer", ["./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(e,n){"use strict";var r=n.extend(e);r.apiVersion=2;r.render=function(n,r){e.render.call(this,n,r)};r.renderAfterRedlineElements=function(e,n){if(n._activeElementInstance&&n._isDrawingOn){n._activeElementInstance.render(e)}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElement", ["sap/ui/core/Element","sap/ui/vk/uuidv4"],function(t,e){"use strict";var r=t.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"},strokeDashArray:{type:"float[]",defaultValue:[]},halo:{type:"boolean",defaultValue:false},haloColor:{type:"string",defaultValue:"rgba(255, 0, 0, 1)"},createdByUser:{type:"any",defaultValue:""},createTimestamp:{type:"int",defaultValue:null},deletedByUser:{type:"any",defaultValue:""},deleteTimestamp:{type:"int",defaultValue:null},suppress:{type:"boolean",defaultValue:false},elementId:{type:"string",defaultValue:null}}},constructor:function(r,i){t.apply(this,arguments);if(typeof r==="object"){i=r;r=undefined}this.setElementId(i&&i.elementId?i.elementId:e())}});r.prototype.applyZoom=function(){};r.prototype.render=function(t){this.renderElement(t,this.getHalo())};r.prototype.renderElement=function(t,e){};r.prototype._colorToArray=function(t){var e=t.replace(/[^\d,.]/g,"").split(",");if(!e[3]){e.push(1)}return e};r.prototype._getHaloFilter=function(t){var e=this._colorToArray(this.getHaloColor());var r=e.join("");return"url(#halo"+r+")"};r.prototype.setHalo=function(t){this.setProperty("halo",t,true);var e=this.getDomRef();if(e){if(t){e.setAttribute("filter",this._getHaloFilter())}else{e.removeAttribute("filter")}}};r.prototype.exportJSON=function(){var t={originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth(),elementId:this.getElementId(),halo:this.getHalo(),haloColor:this.getHaloColor(),createdByUser:this.getCreatedByUser(),createTimestamp:this.getCreateTimestamp(),deletedByUser:this.getDeletedByUser(),deleteTimestamp:this.getDeleteTimestamp(),suppress:this.getSuppress()};if(this.getStrokeDashArray().length>0){t["strokeDashArray"]=this.getStrokeDashArray()}return t};r.prototype.importJSON=function(t){if(t.hasOwnProperty("originX")){this.setOriginX(t.originX)}if(t.hasOwnProperty("originY")){this.setOriginY(t.originY)}if(t.hasOwnProperty("opacity")){this.setOpacity(t.opacity)}if(t.hasOwnProperty("strokeColor")){this.setStrokeColor(t.strokeColor)}if(t.hasOwnProperty("strokeWidth")){this.setStrokeWidth(t.strokeWidth)}if(t.hasOwnProperty("strokeDashArray")){this.setStrokeDashArray(t.strokeDashArray)}if(t.hasOwnProperty("elementId")){this.setElementId(t.elementId)}if(t.hasOwnProperty("halo")){this.setHalo(t.halo)}if(t.hasOwnProperty("haloColor")){this.setHaloColor(t.haloColor)}if(t.hasOwnProperty("createdByUser")){this.setCreatedByUser(t.createdByUser)}if(t.hasOwnProperty("createTimestamp")){this.setCreateTimestamp(t.createTimestamp)}if(t.hasOwnProperty("deletedByUser")){this.setDeletedByUser(t.deletedByUser)}if(t.hasOwnProperty("deleteTimestamp")){this.setDeleteTimestamp(t.deleteTimestamp)}if(t.hasOwnProperty("suppress")){this.setSuppress(t.suppress)}return this};r.prototype.exportSVG=function(){return null};r.prototype.importSVG=function(t){if(t.getAttribute("x")){this.setOriginX(parseFloat(t.getAttribute("x")))}if(t.getAttribute("y")){this.setOriginY(parseFloat(t.getAttribute("y")))}if(t.getAttribute("opacity")){this.setOpacity(parseFloat(t.getAttribute("opacity")))}if(t.getAttribute("stroke")){this.setStrokeColor(t.getAttribute("stroke"))}if(t.getAttribute("stroke-width")){this.setStrokeWidth(parseFloat(t.getAttribute("stroke-width")))}if(t.getAttribute("stroke-dasharray")){this.setStrokeDashArray(t.getAttribute("stroke-dasharray").split(",").map(parseFloat))}if(t.getAttribute("data-sap-element-id")){this.setElementId(t.getAttribute("data-sap-element-id"))}this.setHalo(t.getAttribute("data-sap-halo")==="true");return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementComment", ["sap/ui/core/Element","sap/ui/vk/uuidv4"],function(e,t){"use strict";var n=e.extend("sap.ui.vk.RedlineElementComment",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:""},createdByUser:{type:"any",defaultValue:""},createTimestamp:{type:"int",defaultValue:null}}},constructor:function(n,s){e.apply(this,arguments);if(typeof n==="object"){s=n;n=undefined}this._elementId=s&&s.elementId?s.elementId:t()}});n.prototype.getElementId=function(){return this._elementId};n.prototype.getContent=function(){if(!this._elements){this._elements=new Set}var e=Array.from(this._elements);return e};n.prototype.addContent=function(e){if(!this._elements){this._elements=new Set}if(e instanceof sap.ui.vk.RedlineElement){var t=e.getElementId();this._elements.add(t)}else{this._elements.add(e)}return this};n.prototype.removeContent=function(e){if(this._elements){var t;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId()}else{t=e}this._elements.delete(t)}return this};n.prototype.addMeasurement=function(e){if(!this._measurements){this._measurements=new Set}this._measurements.add(e);return this};n.prototype.getMeasurements=function(){if(!this._measurements){this._measurements=new Set}var e=Array.from(this._measurements);return e};n.prototype.removeMeasurement=function(e){if(this._measurements){this._measurements.delete(e)}return this};n.prototype.clearContent=function(){if(this._elements){this._elements.clear()}return this};n.prototype.exportJSON=function(){var e={elementId:this.getElementId(),createdByUser:this.getCreatedByUser(),createTimestamp:this.getCreateTimestamp()?this.getCreateTimestamp():Date.now(),text:this.getText(),content:this.getContent(),measurements:this.getMeasurements()};return e};n.prototype.importJSON=function(e){if(e.hasOwnProperty("elementId")){this._elementId=e.elementId}if(e.hasOwnProperty("createTimestamp")){this.setCreateTimestamp(e.createTimestamp)}if(e.hasOwnProperty("text")){this.setText(e.text)}if(e.hasOwnProperty("content")){var t=e.content;if(t){for(var n=0;n<t.length;n++){this.addContent(t[n])}}}if(e.hasOwnProperty("createdByUser")){this.setCreatedByUser(e.createdByUser);return e.createdByUser}if(e.hasOwnProperty("measurements")){var s=e.measurements;if(s){for(var r=0;r<s.length;r++){this.addMeasurement(s[r])}}}};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementEllipse", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:1e-4},radiusY:{type:"float",defaultValue:1e-4},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});r.prototype.edit=function(t,e,i){var r=this.getParent(),s=r._toVirtualSpace(t,e),a=Math.abs(s.x-this._initialX),o=Math.abs(s.y-this._initialY);if(i){a=o=Math.max(a,o)}this.setOriginX((s.x+this._initialX)/2);this.setOriginY((s.y+this._initialY)/2);this.setRadiusX(a*.5);this.setRadiusY(o*.5);return this};r.prototype.applyZoom=function(t){this.setProperty("radiusX",this.getRadiusX()*t,true);this.setProperty("radiusY",this.getRadiusY()*t,true);return this};r.prototype.setRadiusX=function(t){this.setProperty("radiusX",t,true);var e=this.getDomRef();if(e){e.setAttribute("rx",this.getParent()._toPixelSpace(t))}};r.prototype.setRadiusY=function(t){this.setProperty("radiusY",t,true);var e=this.getDomRef();if(e){e.setAttribute("ry",this.getParent()._toPixelSpace(t))}};r.prototype.setOriginX=function(t){this.setProperty("originX",t,true);var e=this.getDomRef();if(e){e.setAttribute("cx",this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY()).x)}};r.prototype.setOriginY=function(t){this.setProperty("originY",t,true);var e=this.getDomRef();if(e){e.setAttribute("cy",this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY()).y)}};r.prototype.renderElement=function(t,e){var i=this.getParent();this._initialX=this.getOriginX();this._initialY=this.getOriginY();t.openStart("ellipse",this);var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.attr("cx",r.x);t.attr("cy",r.y);t.attr("rx",i._toPixelSpace(this.getRadiusX()));t.attr("ry",i._toPixelSpace(this.getRadiusY()));t.attr("fill",this.getFillColor());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("ellipse")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Ellipse){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("radiusX")){this.setRadiusX(r.radiusX)}if(r.hasOwnProperty("radiusY")){this.setRadiusY(r.radiusY)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}}else{i.error("wrong version number")}}else{i.error("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"ellipse");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("rx",this.getRadiusX());t.setAttribute("ry",this.getRadiusY());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};r.prototype.importSVG=function(e){if(e.tagName==="ellipse"){t.prototype.importSVG.call(this,e);if(e.getAttribute("rx")){this.setRadiusX(parseFloat(e.getAttribute("rx")))}if(e.getAttribute("ry")){this.setRadiusY(parseFloat(e.getAttribute("ry")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementFreehand", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});i.prototype.setPath=function(t){this.setProperty("path",t,true);var e=this.getDomRef();if(e){e.setAttribute("d",this._getProcessedPath())}};i.prototype.edit=function(t,e){var r=this.getParent();var i=r._toVirtualSpace(t,e);var s=this.getPath()||[];s.push(i.x-this.getOriginX(),i.y-this.getOriginY());this.setPath(s);var a=this.getDomRef();if(a){a.setAttribute("d",this._getProcessedPath())}return this};i.prototype.applyZoom=function(t){this.setProperty("path",this.getPath().map(function(e){return e*t}),true);return this};i.prototype._getProcessedPath=function(){var t=this.getParent(),e=t._toPixelSpace(this.getOriginX(),this.getOriginY());var r="";(this.getPath()||[]).forEach(function(i,s){i=t._toPixelSpace(i);if(s===0){r+="M "+(e.x+i)}else if(s===1){r+=" "+(e.y+i)}else{r+=" "+(s%2===0?"L "+(e.x+i):e.y+i)}});return r};i.prototype.renderElement=function(t,e){t.openStart("path",this);t.attr("d",this._getProcessedPath());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());t.attr("fill","none");if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("path")};i.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()})};i.prototype.importJSON=function(i){if(i.type===e.ElementType.Freehand){if(i.version===1){t.prototype.importJSON.call(this,i);if(i.hasOwnProperty("path")){this.setPath(i.path.slice())}}else{r.error("wrong version number")}}else{r.error("Redlining JSON import: Wrong element type")}return this};i.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"path");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("d",this.getPath());t.setAttribute("fill","none");t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};i.prototype.importSVG=function(e){if(e.tagName==="path"){t.prototype.importSVG.call(this,e);if(e.getAttribute("d")){this.setPath(e.getAttribute("d").split(",").map(parseFloat))}}else{r.error("Redlining SVG import: Wrong element type")}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementLine", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.RedlineElementLine",{metadata:{library:"sap.ui.vk",properties:{deltaX:{type:"float",defaultValue:0},deltaY:{type:"float",defaultValue:0},endArrowHead:{type:"boolean",defaultValue:false}}}});i.prototype.edit=function(t,e){var r=this.getParent(),i=r._toVirtualSpace(t,e);this.setDeltaX(i.x-this.getOriginX());this.setDeltaY(i.y-this.getOriginY());return this};i.prototype.applyZoom=function(t){this.setProperty("deltaX",this.getDeltaX()*t,true);this.setProperty("deltaY",this.getDeltaY()*t,true);return this};i.prototype.getP2=function(t){return this.getParent()._toPixelSpace(this.getOriginX()+this.getDeltaX(),this.getOriginY()+this.getDeltaY())};i.prototype.setDeltaX=function(t){this.setProperty("deltaX",t,true);var e=this.getDomRef();if(e){e.setAttribute("x2",this.getP2().x)}};i.prototype.setDeltaY=function(t){this.setProperty("deltaY",t,true);var e=this.getDomRef();if(e){e.setAttribute("y2",this.getP2().y)}};i.prototype.renderElement=function(t,e){var r=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());var i=this.getP2();t.openStart("line",this);t.attr("x1",r.x);t.attr("y1",r.y);t.attr("x2",i.x);t.attr("y2",i.y);t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}if(this.getEndArrowHead()){var a=this._colorToArray(this.getStrokeColor()).join("");t.attr("marker-end","url(#endArrowHead"+a+")")}t.openEnd();t.close("line")};i.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Line,version:1,deltaX:this.getDeltaX(),deltaY:this.getDeltaY(),endArrowHead:this.getEndArrowHead()})};i.prototype.importJSON=function(i){if(i.type===e.ElementType.Line){if(i.version===1){t.prototype.importJSON.call(this,i);if(i.hasOwnProperty("deltaX")){this.setDeltaX(i.deltaX)}if(i.hasOwnProperty("deltaY")){this.setDeltaY(i.deltaY)}if(i.hasOwnProperty("endArrowHead")){this.setEndArrowHead(i.endArrowHead)}}else{r.error("wrong version number")}}else{r.error("Redlining JSON import: Wrong element type")}return this};i.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"line");t.setAttribute("x1",this.getOriginX());t.setAttribute("y1",this.getOriginY());t.setAttribute("x2",this.getOriginX()+this.getDeltaX());t.setAttribute("y2",this.getOriginY()+this.getDeltaY());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());t.setAttribute("data-sap-end-arrow",this.getEndArrowHead());return t};i.prototype.importSVG=function(e){if(e.tagName==="line"){t.prototype.importSVG.call(this,e);if(e.getAttribute("x1")){this.setOriginX(parseFloat(e.getAttribute("x1")))}if(e.getAttribute("y1")){this.setOriginY(parseFloat(e.getAttribute("y1")))}if(e.getAttribute("x2")){this.setDeltaX(parseFloat(e.getAttribute("x2"))-this.getOriginX())}if(e.getAttribute("y2")){this.setDeltaY(parseFloat(e.getAttribute("y2"))-this.getOriginY())}if(e.getAttribute("data-sap-end-arrow")){this.setEndArrowHead(e.getAttribute("data-sap-end-arrow")==="true")}}else{r("Redlining SVG import: Wrong element type")}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementRectangle", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:.001},height:{type:"float",defaultValue:.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});r.prototype.init=function(){t.prototype.init.apply(this);this._originX=0;this._originY=0};r.prototype.setOriginX=function(t){this.setProperty("originX",t,true);this._originX=t};r.prototype.setOriginY=function(t){this.setProperty("originY",t,true);this._originY=t};r.prototype.edit=function(t,e,i){var r=this.getParent(),o=r._toVirtualSpace(t,e),s=o.x-this._originX,h=o.y-this._originY;if(i){if(Math.abs(s)>Math.abs(h)){if(s<0&&h<0||s>0&&h>0){h=s}else{h=-s}o.y=h+this._originY}else{if(s<0&&h<0||s>0&&h>0){s=h}else{s=-h}o.x=s+this._originX}}this.setProperty("originX",s<0?o.x:this._originX,true);this.setProperty("originY",h<0?o.y:this._originY,true);this.setWidth(Math.abs(s));this.setHeight(Math.abs(h));this.rerender();return this};r.prototype.applyZoom=function(t){this.setProperty("width",this.getWidth()*t,true);this.setProperty("height",this.getHeight()*t,true);return this};r.prototype.setWidth=function(t){this.setProperty("width",t,true);var e=this.getDomRef();if(e){e.setAttribute("width",this.getParent()._toPixelSpace(t))}};r.prototype.setHeight=function(t){this.setProperty("height",t,true);var e=this.getDomRef();if(e){e.setAttribute("height",this.getParent()._toPixelSpace(t))}};r.prototype.renderElement=function(t,e){var i=this.getParent();t.openStart("rect",this);var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.attr("x",r.x);t.attr("y",r.y);t.attr("width",i._toPixelSpace(this.getWidth()));t.attr("height",i._toPixelSpace(this.getHeight()));t.attr("fill",this.getFillColor());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("rect")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Rectangle){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("width")){this.setWidth(r.width)}if(r.hasOwnProperty("height")){this.setHeight(r.height)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}}else{i("wrong version number")}}else{i("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"rect");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("height",this.getHeight());t.setAttribute("width",this.getWidth());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};r.prototype.importSVG=function(e){if(e.tagName==="rect"){t.prototype.importSVG.call(this,e);if(e.getAttribute("width")){this.setWidth(parseFloat(e.getAttribute("width")))}if(e.getAttribute("height")){this.setHeight(parseFloat(e.getAttribute("height")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementText", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"},width:{type:"float",defaultValue:300},height:{type:"float",defaultValue:0}}}});r.prototype.edit=function(t,e){var i=this.getParent(),r=i._toVirtualSpace(t,e);this.setOriginX(r.x);this.setOriginY(r.y);this.rerender();return this};r.prototype.applyZoom=function(t){this.setFontSize(this.getFontSize()*t);this.setWidth(this.getWidth()*t);this.setHeight(this.getHeight()*t);return this};r.prototype.renderElement=function(t,e){var i=this.getParent();if(i==null){return}var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.openStart("foreignObject",this);t.attr("x",r.x);t.attr("y",r.y);t.attr("width","1");t.attr("height","1");if(e){t.attr("filter",this._getHaloFilter())}t.style("overflow","visible");t.openEnd();t.openStart("textArea");t.attr("spellcheck",false);if(this.getFont()){t.style("font-family",this.getFont())}t.style("font-size",this.getFontSize()+"px");t.style("color",this.getFillColor());t.style("opacity",this.getOpacity());t.style("background","transparent");t.style("border-style","none");t.style("resize","none");t.style("position","absolute");t.style("width",this.getWidth()+"px");t.style("height",(this.getHeight()||this.getFontSize()*1.2)+"px");t.openEnd();t.text(this.getText());t.close("textArea");t.close("foreignObject")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor(),width:this.getWidth(),height:this.getHeight()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Text){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("text")){this.setText(r.text)}if(r.hasOwnProperty("font")){this.setFont(r.font)}if(r.hasOwnProperty("fontSize")){this.setFontSize(r.fontSize)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}if(r.hasOwnProperty("width")){this.setWidth(r.width)}if(r.hasOwnProperty("height")){this.setHeight(r.height)}}else{i.error("wrong version number")}}else{i.error("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"text");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());if(this.getFont()){t.setAttribute("font-family",this.getFont())}t.setAttribute("font-size",this.getFontSize());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());t.setAttribute("width",this.getWidth());t.setAttribute("height",this.getHeight());t.textContent=this.getText();return t};r.prototype.importSVG=function(e){if(e.tagName==="text"){t.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")))}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")))}if(e.textContent){this.setText(e.textContent)}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"))}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}if(e.getAttribute("width")){this.setWidth(parseFloat(e.getAttribute("width")))}if(e.getAttribute("height")){this.setHeight(parseFloat(e.getAttribute("height")))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineGesturesHandler", ["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./NativeViewport","sap/ui/core/Core"],function(t,e,i,n){"use strict";var r=t.extend("sap.ui.vk.RedlineGesturesHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._redlineDesign=t;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;this._gesture=false}});r.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};r.prototype._getOffset=function(t){var e=t.getBoundingClientRect();return{x:e.left+window.pageXOffset,y:e.top+window.pageYOffset}};r.prototype._inside=function(t,e){var i=e.getDomRef(),n=false;if(i!==null){var r=this._getOffset(i);var o={x:r.x,y:r.y,width:i.getBoundingClientRect().width,height:i.getBoundingClientRect().height};n=t.x>=o.x&&t.x<=o.x+o.width&&t.y>=o.y&&t.y<=o.y+o.height}return n};r.prototype._onresize=function(t){this._gesture=false};r.prototype.beginGesture=function(t){var e=this.getViewport();if(this._inside(t,e)){this._gesture=true;this._x=t.x;this._y=t.y;this._d=t.d;this._initd=t.d;t.handled=true}return this};r.prototype._pan=function(t){var e=this.getViewport(),i=t.x-this._x,n=t.y-this._y;if(i||n){this._x=t.x;this._y=t.y;var r=e.getPanningRatio();e.firePan({deltaX:i*r,deltaY:n*r});e.getRedlineElements().forEach(function(t){t.setOriginX(t.getOriginX()+e._toVirtualSpace(i));t.setOriginY(t.getOriginY()+e._toVirtualSpace(n))});this._manualRender(e)}};r.prototype._zoom=function(t){var e=this.getViewport(),n=1;var r=t.d-this._d;this._d=t.d;if(this._initd>0){n=1+r*(1/this._initd)}else if(t.n===2){if(t.points[0].y>t.points[1].y){n=Math.max(1-r*.005,.333)}else{n=Math.min(1+r*.005,3)}}n=Math.min(Math.max(n,.88),1.12);var o=e._getTargetViewport();var s=32;var a=1/8;if(o instanceof i){s=o._getZoomInLimit();a=o._getZoomOutLimit();this._zoomFactor=o._getZoomFactor()}n=Math.min(Math.max(this._zoomFactor*n,a),s)/this._zoomFactor;this._zoomFactor*=n;var h=this._getOffset(e.getDomRef());var u=1-n,g=e._toVirtualSpace(t.x-h.x,t.y-h.y);e.getRedlineElements().forEach(function(t){t.applyZoom(n);var e=t.getOriginX(),i=t.getOriginY();e+=(g.x-e)*u;i+=(g.y-i)*u;t.setOriginX(e);t.setOriginY(i)});this._manualRender(e);e.fireZoom({originX:t.x-h.x,originY:t.y-h.y,zoomFactor:n})};r.prototype.move=function(t){if(this.getViewport().getDomRef()){if(t.n===1||t.n===2){this._pan(t)}if(t.n===2&&!t.buttons){this._zoom(t)}}t.handled=true;return this};r.prototype._manualRender=function(t){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){t.invalidate()}else{var e=n.createRenderManager();t.getRedlineElements().forEach(function(t){t.render(e)});e.flush(t.getDomRef(),false,false);e.destroy();var i=t.$();i.html(i.html())}};r.prototype.endGesture=function(t){this._gesture=false;t.handled=true;return this};r.prototype.contextMenu=function(t){t.handled=true};r.prototype.getViewport=function(){return this._redlineDesign};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineSurface", ["./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer","./Redline","sap/base/Log"],function(e,t,i,n,a,r,l){"use strict";var o=t.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});o.prototype.init=function(){};o.prototype.onAfterRendering=function(){};o.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON()})};o.prototype.importJSON=function(e){if(!jQuery.isArray(e)){e=[e]}e.forEach(function(e){var t;switch(e.type){case r.ElementType.Rectangle:t=sap.ui.vk.RedlineElementRectangle;break;case r.ElementType.Ellipse:t=sap.ui.vk.RedlineElementEllipse;break;case r.ElementType.Freehand:t=sap.ui.vk.RedlineElementFreehand;break;case r.ElementType.Line:t=sap.ui.vk.RedlineElementLine;break;case r.ElementType.Text:t=sap.ui.vk.RedlineElementText;break;default:l.warning("Unsupported JSON element type "+e.type)}if(t!=null){this.addRedlineElement((new t).importJSON(e))}}.bind(this));return this};o.prototype._toVirtualSpace=function(e,t){if(arguments.length===1){return e/this.getVirtualSideLength()}else{return{x:(e-this.getVirtualLeft())/this.getVirtualSideLength(),y:(t-this.getVirtualTop())/this.getVirtualSideLength()}}};o.prototype._toPixelSpace=function(e,t){if(arguments.length===1){return e*this.getVirtualSideLength()}else{return{x:e*this.getVirtualSideLength()+this.getVirtualLeft(),y:t*this.getVirtualSideLength()+this.getVirtualTop()}}};o.prototype.setPanningRatio=function(e){this.setProperty("panningRatio",e,true)};o.prototype.updatePanningRatio=function(){var e=this.getVirtualLeft(),t=this.getVirtualTop(),i=this.getDomRef(),n=i.getBoundingClientRect(),a=n.height,r=n.width,l;if(e===0&&(a<r&&t<0||a>r&&t>0)){l=a/r}else{l=1}this.setPanningRatio(l);return this};o.prototype.exportSVG=function(){var e=document.createElementNS(r.svgNamespace,"svg");this.getRedlineElements().map(function(t){e.appendChild(t.exportSVG())});return e};o.prototype.importSVG=function(e){e.childNodes.forEach(function(e){if(e.getAttribute){var t;switch(e.tagName){case"rect":t=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":t=sap.ui.vk.RedlineElementEllipse;break;case"path":t=sap.ui.vk.RedlineElementFreehand;break;case"line":t=sap.ui.vk.RedlineElementLine;break;case"text":t=sap.ui.vk.RedlineElementText;break;default:l.warning("Unsupported SVG element type "+t)}if(t){this.addRedlineElement((new t).importSVG(e))}}}.bind(this));return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineSurfaceRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("svg",n);e.class("sapUiVizkitRedlineSurface");e.openEnd();e.openStart("defs");e.openEnd();e.openStart("filter");e.attr("id","halo");e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","4");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter");e.close("defs");n.getRedlineElements().forEach(function(n){n.render(e)});this.renderAfterRedlineElements(e,n);e.close("svg")};e.renderAfterRedlineElements=function(e,n){};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineUpgradeManager", [],function(){"use strict";var e={};e.schemaVersions=[{version:"1.0"}];e.currentSchema=e.schemaVersions[e.schemaVersions.length-1];e.upgrade=function(r){return e._upgradeIfRequired(r)};e._upgradeIfRequired=function(r){var s;if(r.hasOwnProperty("schemaVersion")){r.schemaVersion=r.schemaVersion?r.schemaVersion:"1.0"}else{r.schemaVersion="1.0"}if(e.currentSchema.version!==r.schemaVersion){var n=e.schemaVersions.find(function(e){return e.version===r.schemaVersion});if(n&&n.upgradeFunction){s=n.upgradeFunction(r);s.schemaVersion=n.upgradeTargetVersion;s=e._upgradeIfRequired(s)}else{throw"There is no rule to upgrade Redline JSON from schema version "+r.schemaVersion}}else{s=r}return s};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RenderMode", [],function(){"use strict";var t={Default:"Default",XRay:"XRay",LineIllustration:"LineIllustration",ShadedIllustration:"ShadedIllustration",SolidOutline:"SolidOutline"};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RotationType", [],function(){"use strict";var e={Quaternion:"Quaternion",AngleAxis:"AngleAxis",Euler:"Euler"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SafeArea", ["sap/ui/core/Control","sap/ui/vk/SafeAreaRenderer"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.SafeArea",{metadata:{library:"sap.ui.vk",aggregations:{settingsControl:{type:"sap.ui.core.Control",multiple:false}}},constructor:function(e,i){t.apply(this,arguments)}});i.prototype.onAfterRendering=function(){this.resize()};i.prototype.resize=function(){var t=this.getDomRef();var e=this.getParent();if(!t||!e){return}var i=e.getDomRef().getBoundingClientRect();var s=i.width/i.height;var o=s;var r=e.getCurrentView();if(r&&r.getAspectRatio()&&r.getAspectRatio()>0&&r.getAspectRatio()<25){o=r.getAspectRatio()}var l=i.height;var a=i.width;if(s>o){t.style.height=l-4+"px";t.style.width=l*o-4+"px";t.style.left=(a-(l*o-4))/2+"px";t.style.top=""}else if(s<o){t.style.height=a/o-4+"px";t.style.width=a-4+"px";t.style.top=(l-(a/o-4))/2+"px";t.style.left=""}else{t.style.height=l-4+"px";t.style.width=a-4+"px"}if(this.getSettingsControl()){var p=this.getSettingsControl().getDomRef();var n=window.getComputedStyle(document.getElementById(this.getSettingsControl().sId));var g=n.height;p.style.position="absolute";if(s<o&&(l-parseFloat(t.style.height))/2>parseFloat(g)){p.style.bottom=parseFloat(t.style.height)+2+"px";p.style.left="-2px";p.style.top=""}else{p.style.top="0px";p.style.left="0px";p.style.bottom=""}}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SafeAreaRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);var i=t.getParent();if(i){if(i.getShowSafeArea()){e.class("sapVizKitSafeAreaVisible")}else{e.class("sapVizKitSafeAreaNotVisible")}}e.openEnd();if(t.getSettingsControl()){e.renderControl(t.getSettingsControl())}e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Scene", ["sap/ui/base/ManagedObject","./AnimationSequence","./AnimationTrack","./ViewGroup","./View","./Highlight"],function(e,t,i,s,r,n){"use strict";var u=e.extend("sap.ui.vk.Scene",{metadata:{library:"sap.ui.vk",abstract:true,properties:{doubleSided:{type:"boolean",defaultValue:false}}}});u.prototype.getInitialView=function(){return null};u.prototype.createSequence=function(e,i){var s=new t(e,i);this.addSequence(s);return s};u.prototype.getSequences=function(){if(!this._sequences){this._sequences=[]}return this._sequences};u.prototype.findSequence=function(e){if(!this._sequences){return undefined}return this._sequences.find(function(t){return t.getId()===e})};u.prototype.addSequence=function(e){if(!this._sequences){this._sequences=[]}this._sequences.push(e);return this};u.prototype.insertSequence=function(e,t){if(!this._sequences){this._sequences=[]}if(t<0){t=0}else if(t!==0&&t>=this._sequences.length){t=this._sequences.length}this._sequences.splice(t,0,e);return this};u.prototype.indexOfSequence=function(e){if(!this._sequences){return-1}return this._sequences.find(function(t){return t==e})};u.prototype.removeSequence=function(e){if(this._sequences){var t=this.indexOfSequence(e);if(t>=0){this._sequences.splice(t,1)}}return this};u.prototype.removeSequences=function(){if(this._sequences){this._sequences.splice(0)}return this};u.prototype.createTrack=function(e,t){var s=new i(e,t);this.addTrack(s);return s};u.prototype.getTracks=function(){if(!this._tracks){this._tracks=[]}return this._tracks};u.prototype.findTrack=function(e){if(!this._tracks){return undefined}return this._tracks.find(function(t){return t.getId()===e})};u.prototype.addTrack=function(e){if(!this._tracks){this._tracks=[]}this._tracks.push(e);return this};u.prototype.insertTrack=function(e,t){if(!this._tracks){this._tracks=[]}if(t<0){t=0}else if(t!==0&&t>=this._tracks.length){t=this._tracks.length}this._tracks.splice(t,0,e);return this};u.prototype.indexOfTrack=function(e){if(!this._tracks){return-1}return this._tracks.findIndex(function(t){return t==e})};u.prototype.removeTrack=function(e){if(this._tracks){var t=this.indexOfTrack(e);if(t>=0){this._tracks.splice(t,1)}}return this};u.prototype.removeTracks=function(){if(this._tracks){this._tracks.splice(0)}return this};u.prototype.getViewGroups=function(){if(!this._viewGroups){this._viewGroups=[]}return this._viewGroups};u.prototype.createViewGroup=function(e){if(!this._viewGroups){this._viewGroups=[]}var t=new s(e);this._viewGroups.push(t);return t};u.prototype.indexOfViewGroup=function(e){if(!this._viewGroups){return-1}return this._viewGroups.find(function(t){return t==e})};u.prototype.insertViewGroup=function(e,t){if(!this._viewGroups){this._viewGroups=[]}if(t<0){t=0}else if(t!==0&&t>=this._viewGroups.length){t=this._viewGroups.length}this._viewGroups.splice(t,0,e);return this};u.prototype.removeViewGroup=function(e){var t=this.indexOfViewGroup(e);if(t>=0){this._viewGroups.splice(t,1)}return this};u.prototype.removeViewGroups=function(){this._viewGroups.splice(0);return this};u.prototype.findViewGroupByView=function(e){var t;if(this._viewGroups){for(var i=0;i<this._viewGroups.length;i++){if(this._viewGroups[i].indexOfView(e)>=0){t=this._viewGroups[i];break}}}return t};u.prototype.getViews=function(){if(!this._views){this._views=[]}return this._views};u.prototype.createView=function(e){if(!this._views){this._views=[]}var t=new r(e);this._views.push(t);return t};u.prototype.removeView=function(e){if(!this._views){return this}var t=this.getViewGroups();if(Array.isArray(t)){t.forEach(function(t){t.removeView(e)})}var i=this._views.indexOf(e);if(i>=0){this._views.splice(i,1)}return this};u.prototype.createHighlight=function(e,t){var i=new n(e,t);if(!this._highlights){this._highlights=new Map}this._highlights.set(e,i);return i};u.prototype.getHighlight=function(e){var t;if(this._highlights){t=this._highlights.get(e)}return t};u.prototype.removeHighlight=function(e){if(this._highlights){this._highlights.delete(e)}return this};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SceneTree", ["./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/ui/core/Core","sap/ui/core/ResizeHandler","sap/m/Title","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/ui/core/Icon","./Core","./ViewStateManager","./SceneTreeRenderer","./getResourceBundle"],function(e,t,i,n,a,s,r,o,h,l,d,c,u,g,p,_,f,S){"use strict";var y=t.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",defaultValue:S().getText("SCENETREE_TITLE")},showTitle:{type:"boolean",defaultValue:true},showSearchField:{type:"boolean",defaultValue:true},legacyVisibilityMode:{type:"boolean",defaultValue:false}},aggregations:{treeTable:{type:"sap.ui.table.TreeTable",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},constructor:function(e,i){t.apply(this,arguments);p.observeAssociations(this)}});var b="sap-icon://show",C="sap-icon://hide";var v=S().getText("SCENETREE_VISIBILITYSTATEVISIBLE"),w=S().getText("SCENETREE_VISIBILITYSTATEHIDDEN");y.prototype._createNodeForSceneTree=function(e,t,i){var n=i.getVisibilityState(t);return{name:e,id:t,visible:n}};y.prototype.setScene=function(e,t){this.setViewStateManager(t);this._setScene(e)};y.prototype._setScene=function(e){this._scene=e;this.refresh()};y.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}var e=this;this._title=new o({width:"100%",textAlign:sap.ui.core.TextAlign.Center,text:this.getTitle()});this._searchField=new h({layoutData:new d({shrinkable:true,maxWidth:"400px"}),search:function(t){var i=t.getParameter("query"),n=e._scene.getDefaultNodeHierarchy(),a=e._viewStateManager;if(n&&a){var s=!i?[]:n.findNodesByName({value:i,predicate:"contains"});var r=new Set(s);var o=[];a.enumerateSelection(function(e){if(!r.has(e)){o.push(e)}});a.setSelectionState(o,false,false);a.setSelectionState(s,true,false)}}});this._toolbar=new l({content:[this._title,new c,this._searchField]});var s=new g({src:b,tooltip:v,width:"2em",height:"1.3em",size:"1.2em",press:function(t){var i=this.getSrc()!==b;this.setSrc(i?b:C);this.setTooltip(i?S().getText("SCENETREE_VISIBILITYSTATEVISIBLEALL"):S().getText("SCENETREE_VISIBILITYSTATEHIDDENALL"));e._toggleVisibilityForAllChildren(e._model.getData(),i)}});this._tree=new i({title:this._toolbar,columnHeaderHeight:32,columns:[new n({label:S().getText("SCENETREE_NAME"),tooltip:S().getText("SCENETREE_NAME"),template:new u({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new n(this.getId()+"-visibilityColumn",{label:s,template:new g({src:{path:"",formatter:function(e){if(!e){return null}return e.visible?b:C}},tooltip:{path:"",formatter:function(e){if(!e){return null}return e.visible?v:w}},height:"1.3em",size:"1.2em",press:function(t){var i=e._tree.getContextByIndex(this.getParent().getIndex());var n=i?i.getObject():null;if(n){e._viewStateManager.setVisibilityState(n.id,!n.visible,e.getLegacyVisibilityMode(),e.getLegacyVisibilityMode())}}}),width:"2.5em",resizable:false,hAlign:"Center"})],enableSelectAll:false,selectionMode:"MultiToggle",selectionBehavior:"RowSelector",visibleRowCountMode:"Fixed",expandFirstLevel:false,collapseRecursive:false,rowHeight:32});this.setAggregation("treeTable",this._tree);this.attachContentChanged(function(e){s.setSrc(b);s.setTooltip(v)});this._scene=null;this._syncing=false;this._updateSelectionTimer=0;this._updateVisibilityTimer=0;this._model=new a;this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._handleRowSelectionChange.bind(this));this._tree.attachFirstVisibleRowChanged(this._updateSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this))};y.prototype.setTitle=function(e){this.setProperty("title",e,true);this._title.setText(e);return this};y.prototype.setShowTitle=function(e){this.setProperty("showTitle",e,true);this._title.setVisible(e);this._updateTitleBar();return this};y.prototype.setShowSearchField=function(e){this.setProperty("showSearchField",e,true);this._searchField.setVisible(e);this._updateTitleBar();return this};y.prototype._updateTitleBar=function(){this._tree.setTitle(this.getShowTitle()||this.getShowSearchField()?this._toolbar:null);this._handleResize()};y.prototype.onBeforeRendering=function(){this._tree.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=r.register(this,this._handleResize.bind(this))}};y.prototype._handleRowSelectionChange=function(e){if(this._syncing||this._tree.getBinding("rows")._aSelectedContexts!=undefined){return}var t=[];var i=[];var n=e.getParameter("rowIndices");for(var a in n){var s=n[a];var r=this._tree.getContextByIndex(s);var o=r?r.getObject().id:null;if(o){(this._tree.isIndexSelected(s)?t:i).push(o)}}if(t.length>0){this._viewStateManager.setSelectionState(t,true)}if(i.length>0){this._viewStateManager.setSelectionState(i,false)}};y.prototype._onSelectionChanged=function(e){if(this._syncing){return}function t(e,t){var i=e.getBinding("rows");if(i){for(var n=e.getFirstVisibleRow(),a=Math.min(n+e.getVisibleRowCount(),i.getLength());n<a;n++){var s=i.getContextByIndex(n);if(s&&s.getObject().id===t){return true}}}return false}var i=e.getParameter("selected");if(i.length===1&&!t(this._tree,i[0])){if(this._updateSelectionTimer>0){clearTimeout(this._updateSelectionTimer);this._updateSelectionTimer=0}this._expandToNode(i[0],this._updateSelection.bind(this))}else if(this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0)}};y.prototype._updateSelection=function(){this._updateSelectionTimer=0;if(this._syncing){return}this._syncing=true;var e=this._viewStateManager,t=this._tree,i=t.getBinding("rows");if(e&&i){for(var n=t.getFirstVisibleRow(),a=Math.min(n+t.getVisibleRowCount(),i.getLength());n<a;n++){var s=i.getContextByIndex(n);if(s){var r=s.getObject().id;if(r){var o=e.getSelectionState(r);if(o!=t.isIndexSelected(n)){t[o?"addSelectionInterval":"removeSelectionInterval"](n,n)}}}}}this._syncing=false};y.prototype._expandToNode=function(e,t){var i={tree:this._tree,rows:this._tree.getBinding("rows"),index:0,nodeRef:e,ancestors:new Set(this._scene.getDefaultNodeHierarchy().getAncestors(e)),callback:t};function n(e,t,i){var n=e.getFirstVisibleRow(),a=e.getVisibleRowCount();if(t<n||t>=n+a){n=Math.min(Math.max(t-(a>>1),0),i-a);setTimeout(function(){e.setFirstVisibleRow(n)},0)}}function a(e,t){if(t&&t.getParameter("reason")!=="expand"){return}var i=e.rows.getLength();while(e.index<i){var a=e.rows.getContextByIndex(e.index);if(!a){break}var s=a.getObject().id;if(s===e.nodeRef){n(e.tree,e.index,i);break}if(e.ancestors.has(s)&&!e.tree.isExpanded(e.index)){e.tree.expand(e.index++);return}e.index++}e.rows.detachChange(e.expandHandlerProxy);e.callback()}i.expandHandlerProxy=a.bind(this,i);i.rows.attachChange(i.expandHandlerProxy);a(i)};y.prototype._dataChange=function(e){var t=e.getParameter("reason");if((t==="expand"||t==="collapse")&&this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0)}};y.prototype._toggleVisibilityForAllChildren=function(e,t){var i=e.hasOwnProperty("children")?e.children:e;for(var n=0;i[n]!=null;n++){this._viewStateManager.setVisibilityState(i[n].id,t,true)}};y.prototype._onVisibilityChanged=function(e){if(this._updateVisibilityTimer===0){this._updateVisibilityTimer=setTimeout(this._updateVisibility.bind(this),0)}};y.prototype._updateVisibility=function(){this._updateVisibilityTimer=0;this._getNodeVisibilityRecursive(this._model.getData());this._tree.getModel().refresh(true)};y.prototype._getNodeVisibilityRecursive=function(e){if(e.id!=null){e.visible=this._viewStateManager.getVisibilityState(e.id)}var t=e.hasOwnProperty("children")?e.children:e;for(var i=0;t[i]!=null;i++){this._getNodeVisibilityRecursive(t[i])}};y.prototype._handleResize=function(e){var t=e?e.size.height:this.getDomRef().clientHeight;var i=this._tree.getTitle()?2.1:1.1;this._tree.setVisibleRowCount(Math.max(Math.floor(t/(this._tree.getRowHeight()+1)-i),0));this._updateSelection()};y.prototype.refresh=function(){if(!this._scene||!this._viewStateManager||!this._viewStateManager.getNodeHierarchy()){this._model.setData([]);return}var e=this._scene.getDefaultNodeHierarchy();var t=[];var i=function(t,n){n.forEach(function(n){if(n.userData&&n.userData.skipIt){i(t,e.getChildren(n))}else{var a=e.createNodeProxy(n);var s=this._createNodeForSceneTree(a.getName(),a.getNodeRef(),this._viewStateManager);t.push(s);e.destroyNodeProxy(a);s.children=[];i(s.children,e.getChildren(n))}}.bind(this))}.bind(this);i(t,e.getChildren());this._model.setData(t);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this.fireContentChanged()};y.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);e.attachSelectionChanged(this._onSelectionChanged,this);e.attachVisibilityChanged(this._onVisibilityChanged,this);this.refresh()};y.prototype.onUnsetViewStateManager=function(e){this._viewStateManager=null;e.detachVisibilityChanged(this._onVisibilityChanged,this);e.detachSelectionChanged(this._onSelectionChanged,this);e.detachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);this.refresh()};y.prototype._onNodeHierarchyReplaced=function(e){this.refresh()};y.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){var t=s.byId(this.getContentConnector());if(t){var i=t.getDefaultViewStateManager();if(i){this.setViewStateManager(i)}}}this._setScene(e);return this};y.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesFinished(this._onContentChangesFinished,this);this._setContent(e.getContent())};y.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentChangesFinished(this._onContentChangesFinished,this);e.detachContentReplaced(this._onContentReplaced,this)};y.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};y.prototype._onContentChangesFinished=function(e){this.refresh()};return y});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SceneTreeRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.class("sapUiSizeCompact");e.class("sapUiVkSceneTree");e.openEnd();e.renderControl(n.getAggregation("treeTable"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SelectionDisplayMode", [],function(){"use strict";var i={Highlight:"Highlight",Outline:"Outline"};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SelectionMode", [],function(){"use strict";var e={None:"none",Exclusive:"exclusive",Sticky:"sticky"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Smart2DHandler", ["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.Smart2DHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t,e){this._viewport=t;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=e;this._previousColoring={nodeRef:null,nodeId:null,color:null}}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._viewport.getDomRef();if(e==null){return false}var i=this._getOffset(e);this._rect={x:i.x,y:i.y,w:e.offsetWidth,h:e.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.beginGesture=function(t){if(this._inside(t)){this._gesture=true;this._x=t.x;this._y=t.y}};i.prototype.callbackHover=function(){var t=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var e=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==e){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var i=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,i)}if(t.getHotspotNodeIds().indexOf(e)!==-1){var o=t.createNodeProxy(e);this._previousColoring={nodeRef:e,nodeId:e,color:o.getTintColorABGR()};t.destroyNodeProxy(o);this._viewport.showHotspots(e,true)}this._highlightedNodeRef=e}this._viewport.renderFrame()};i.prototype.hover=function(t){if(t.n==1&&this._inside(t)){this._x=t.x-this._rect.x;this._y=t.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var e=Date.now();if(e-this._lastRender>20){this.callbackHover()}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer)}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20)}t.handled=true}};i.prototype.move=function(t){if(this._gesture&&t.n==1){this._viewport.pan(t.x-this._x,t.y-this._y);this._x=t.x;this._y=t.y;t.handled=true}};i.prototype.endGesture=function(t){this._gesture=false};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/StepNavigation", ["sap/ui/core/Control","./library","./Core","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer","./dvl/GraphicsCoreApi","./dvl/getPointer","./dvl/getJSONObject","./dvl/Scene","./getResourceBundle","sap/base/Log","sap/ui/core/Core"],function(e,t,s,o,n,r,i,a,p,u,l,c,d,h){"use strict";var g=e.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{resize:{parameters:{oldSize:"object",size:"object"}},stepChanged:{parameters:{clientId:"object",type:"object",stepId:"object"}}}},constructor:function(t,o){e.apply(this,arguments);s.observeAssociations(this)}});g.prototype._onStepEvent=function(e){var t=this.getSettings();this.instanceSettings.currentStepId=e.stepId;switch(e.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:t.currentStepFinished=true;t.currentStepPaused=false;t.playAllActive=false;t.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:t.currentStepId=e.stepId;t.currentStepFinished=false;this._highlightStep(e.stepId);if(t.currentStepPaused){this.pauseStep()}break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_PLAYING:if(this.getShowStepInfo()&&this.stepMessagePopup&&!this.stepMessagePopup.isOpen()){this._highlightStep(e.stepId)}break;default:d.error(c().getText(o.VIT12.summary),o.VIT12.code,"sap.ui.vk.StepNavigation")}this.fireStepChanged({clientId:e.clientId,type:e.type,stepId:e.stepId})};g.prototype.setScene=function(e){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null}if(e){var t=e.getMetadata().getName();if(t!=="sap.ui.vk.dvl.Scene"){return}}this._scene=e;this.instanceSettings={};if(this._scene){this.oDvl=e.getGraphicsCore().getApi(a.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this)}delete this._procedures;var s=this.getProcedureList();var o=this.getSettings();o.reset();s.unbindItems();s.setSelectedItem(s.getFirstItem());if(o.stepInfo.stepMessagePopup){if(o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close()}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}var n=this._getStepThumbnails();this.oModel.setData(n);this._togglePlayPause(true);this._refreshControl();this.refresh()};g.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";if(e.prototype.init){e.prototype.init.call(this)}if(this.getSettings()==undefined){this.setSettings(new this._settings)}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel;this.setModel(this.oModel);this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false});this.setAggregation("thumbnailsContainer",this._thumbnailsScroller)}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:c().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getPreviousStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:c().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getNextStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:c().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var t=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var o=null;switch(t){case"0":if(!s.currentStepId){o=this.getNextStep(s.currentProcedureIndex);if(o){s.currentStepId=o.id}else{return}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){o=this.getNextStep(s.currentProcedureIndex);if(o){s.currentStepId=o.id}else{return}}s.playAllActive=true;var n=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,n,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:c().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(e){var t=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=t.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var o=0;o<this.oModel.oData.procedures.length;o++){if(this.oModel.oData.procedures[o].id==s.currentProcedureId){s.currentProcedureIndex=o;s.currentProcedure=this.oModel.oData.procedures[o];break}}if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this._refreshItems()}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem).bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name"));this.playMenuButton=new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]});this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:c().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var t=this.getSettings();this.pauseStep();t.currentStepPaused=true;t.isPlaying=false;this._togglePlayPause(true)}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(c().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));var s=this.getSettings();if(s.currentStepId){this._highlightStep(s.currentStepId)}}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(c().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));if(this.stepMessagePopup&&this.stepMessagePopup.isOpen()){this.stepMessagePopup.close()}}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer).addContent(this.playNextButton)};g.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};g.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};g.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};g.prototype.getScroller=function(){return this._thumbnailsScroller};g.prototype.getProcedureList=function(){var e=this.getId()+"-procedureList";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayMenuButton=function(){var e=this.getId()+"-playMenuButtonIcon";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayOptionButton=function(){var e=this.getId()+"-playOptionButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPauseButton=function(){var e=this.getId()+"-pauseButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayNextButton=function(){var e=this.getId()+"-playNextButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getPlayPreviousButton=function(){var e=this.getId()+"-playPreviousButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype.getShowStepInfoButton=function(){var e=this.getId()+"-showStepInfoButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};g.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(e,t,s,o){if(!this.targets[e]){this.targets[e]={type:"css",property:t,onValue:s,offValue:o}}},addMethod:function(e,t,s,o,n){var r=e.getId();if(!this.targets[r]){this.targets[r]={type:"method",target:e,method:t,onValue:s,offValue:o,useJQuery:n}}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(e,t,s,o){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(e);this._customHeaderText.setTooltip(e);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:o,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(s)}}}};g.prototype.refresh=function(e){d.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var t=this.getProcedureList();var s=this.getSettings();s.reset();t.setSelectedItem(t.getFirstItem());var o=this._getStepThumbnails();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this.oModel.setData(o);this._togglePlayPause(true);this._refreshControl()}else if(this.getVisible()){this._refreshControl()}return true};g.prototype.clear=function(){d.info("StepNavigation clear() called.");return true};g.prototype.onBeforeRendering=function(){if(this.getShowToolbar()){var e=this.getProcedureList();e.setModel(this.oModel);var t=this.getProcedureItemTemplate();e.bindItems("/procedures",t)}};g.prototype.onAfterRendering=function(){var e=this.getSettings();this._togglePlayPause(!e.isPlaying);if(e.currentStepId){this._highlightStep(e.currentStepId)}};var f={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this)}};g.prototype._togglePlayPause=function(e){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var t=this.getPlayOptionButton(),s=this.getPauseButton();if(e){if(h.getCurrentFocusedControlId()===s.getId()){t.addEventDelegate(f)}s.setVisible(false);t.setVisible(true)}else{if(h.getCurrentFocusedControlId()===t.getId()){s.addEventDelegate(f)}t.setVisible(false);s.setVisible(true)}}};g.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return}var e=this.getProcedureList();var t=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}e.unbindItems();if(this.oModel.oData.procedures.length>0){var o=this.oModel.oData.procedures[0];if(this.getShowToolbar()){e.bindItems("/procedures",t);e.selectedKey=o.id;e.enabled=true}this._refreshItems()}else{if(this.getShowToolbar()){e.bindItems("/procedures",t);e.enabled=false}if(this.getShowThumbnails()){var n=this.getScroller();n.destroyContent()}}};g.prototype._refreshItems=function(){var e=this;var t=[];var s=this.getProcedureList();var o=e.getSettings();var n=new sap.m.HBox;if(!o.currentProcedure){o.currentProcedure=e.oModel.oData.procedures[o.currentProcedureIndex];s.setSelectedItem(s.getFirstItem())}if(o.currentProcedureId!=""||e.oModel.oData.procedures.length>0){if(e.getShowThumbnails()){var r=e.getScroller();r.removeAllContent();t=e.oModel.oData.procedures[o.currentProcedureIndex].steps;var i=function(t){o.currentStepPaused=false;var s=h.byId(t.getSource().getId());e.playStep(s.getCustomData()[0].getValue("stepId"));o.playAllActive=false;e._togglePlayPause(false)};var a=function(e){var t=80;var s=e.getSource();var o=s.getDomRef().width;var n=s.getDomRef().height;var r=o/n;if(o>n){s.setWidth(t+"px");s.setHeight(t/r+"px")}else{s.setHeight(t+"px");s.setWidth(t*r+"px")}};for(var p=0;p<t.length;p++){var u=new sap.m.Image({alt:t[p].name,src:"data:image/"+t[p].thumbnailType+";base64,"+t[p].thumbnailData,densityAware:false,tooltip:t[p].name,press:i.bind(e),load:a,layoutData:new sap.m.FlexItemData({shrinkFactor:0})});u.data("stepId",t[p].id);u.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:t[p].id}));u.addStyleClass("sapVizKitStepNavigationStepItem");n.addItem(u)}r.addContent(n)}}};g.prototype._getPopupPlacement=function(e){var t=null;var s=0;while(e){s+=e.offsetTop;e=e.offsetParent}if(s>200){t=sap.m.PlacementType.Top}else{t=sap.m.PlacementType.Bottom}return t};g.prototype._isScrollingNecessary=function(e,t){var s;if(e&&t){var o=jQuery(e).offset().left+jQuery(e).width();var n=jQuery(t).width();if(o-jQuery(e).width()<0){s=true}else if(n-o<jQuery(e).width()){s=true}else{s=false}}else{s=false}return s};g.prototype._scrollToItem=function(e,t){var s={},o=jQuery(e).offset(),n=jQuery(t).scrollLeft();s.scrollLeft=o.left+(n-jQuery(t).offset().left);s.scrollLeft-=parseInt(jQuery(e).css("marginLeft"),10)||0;s.scrollLeft-=parseInt(jQuery(e).css("borderLeftWidth"),10)||0;jQuery(t).animate(s,50)};g.prototype._highlightStep=function(e){var t=this;if(t.getVisible()){var s=t.getSettings();var o=t.getStep(0,s.currentProcedureIndex,e);if(!s.currentProcedure){s.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex]}var n=t.getShowStepInfoButton();var r;var i=document.getElementById(n.getId());r=t._getPopupPlacement(i);if(t.getShowStepInfo()){s.stepInfo.openPopup.call(this,o.name,o.description,n,r)}else if(s.stepInfo.stepMessagePopup&&s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}if(t.getShowThumbnails()){var a=t.getScroller();var p=a.getContent()[0].getItems();for(var u=0;u<p.length;u++){if(p[u].getCustomData()[0].getValue("stepId")==e){p[u].addStyleClass("selected");if(t._isScrollingNecessary(p[u].$()[0],jQuery("#"+a.sId)[0])){t._scrollToItem(p[u].$()[0],jQuery("#"+a.sId)[0])}}else{p[u].removeStyleClass("selected")}}}}};g.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails()};g.prototype._getStepThumbnails=function(){var e=function(e,t,s){var o,n,r;try{var i=t.Scene.RetrieveThumbnail(e,s.id);if(i===sap.ve.dvl.DVLRESULT.NOTFOUND){o=this._emptyThumbnail}else{o=p(i)}r=o.substring(0,3);if(r==="iVB"){n="png"}else{n="jpg"}s.thumbnailData=o;s.thumbnailType=n}catch(e){if(e.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){d.error(e.message,e.code,"sap.ui.vk.StepNavigation")}s.thumbnailData=null;s.thumbnailType=null}};var t=this._retrieveProcedures();if(t.sceneId!=null){t.procedures.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.portfolios.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.hasThumbnails=true}this._procedures=t;return t};g.prototype._retrieveProcedures=function(e){var t=this;var s={};if(!t._procedures){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]}}else{s=t._procedures}if(t._scene&&s.sceneId!=(e||t._scene._dvlSceneRef)){var o=e||t._scene._dvlSceneRef;if(o!=null){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]};try{var r=u(t.oDvl.Scene.RetrieveProcedures(o));if(r!=null){s.hasThumbnails=false;s.sceneId=t._scene._dvlSceneRef;s.procedures=r.procedures;s.portfolios=r.portfolios}}catch(e){if(!(e instanceof n&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e}}}}return s};g.prototype.getStep=function(e,t,s){var o=this;var n=o.oDvl.Settings.LastLoadedSceneId;var r=null;if(n!=null){t=t!=null?t:0;var i=s?s:o.instanceSettings.currentStepId;var a=o._retrieveProcedures(n);var p=a.procedures[t];if(p&&p.steps.length>0){r=p.steps[0]}else{return null}if(i!=""){for(var u=0;u<p.steps.length;u++){var l=p.steps[u];if(l.id==i){var c=u+e;if(c<p.steps.length&&c>=0){r=p.steps[c]}else{r=null}break}}}}return r};g.prototype.pauseStep=function(){var e=this;var t=e.oDvl.Settings.LastLoadedSceneId;if(t!=null){e.oDvl.Scene.PauseCurrentStep(t)}};g.prototype._stepCount=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var o=0;if(s!=null){var n=t._retrieveProcedures(s);for(var r=0;r<n.procedures.length;r++){if(n.procedures[r].id==e){o=n.procedures[r].steps.length;break}else if(e==null){o+=n.procedures[r].steps.length}}}return o};g.prototype.getPreviousStep=function(e){var t=this;return t.getStep(-1,e)};g.prototype.getNextStep=function(e){var t=this;return t.getStep(1,e)};g.prototype.playStep=function(e,t,s){var o=this;var n=o.oDvl.Settings.LastLoadedSceneId;if(n!=null){o.instanceSettings.currentStepId=e;o.oDvl.Scene.ActivateStep(n,e,t!=null?t:true,s!=null?s:false)}};g.prototype.playAllSteps=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){var o=t._retrieveProcedures(s);var n=0;if(e!=null&&o.procedures.length>1){for(var r=0;r<o.procedures.length;r++){if(o.procedures[r].id==e){n=r;break}}}if(o.procedures.length>0){var i=o.procedures[n].steps[0];if(i){t.instanceSettings.currentStepId=i.id;t.oDvl.Scene.ActivateStep(s,i.id,true,true)}}}};g.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return this}var t=null;if(e&&e instanceof l){t=e}this.setScene(t);return this};return g});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/StepNavigationRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(e,i){if(!i.getVisible()){return}if(i.getShowToolbar()||i.getShowThumbnails){var r=i.getWidth()!=="auto"?i.getWidth():"100%";var n=i.getHeight()!=="auto"?i.getHeight():"auto";e.openStart("div",i);e.style("width",r);e.style("height",n);e.class("sapVizKitStepNavigation");var o=i.getTooltip_AsString();if(o){e.attr("title",o)}if(!i.getVisible()){e.style("visibility","hidden")}e.openEnd();e.renderControl(i.getAggregation("layout"));if(i.getShowThumbnails()){t._renderScrollerDiv(e,i)}e.close("div")}};t._renderScrollerDiv=function(t,e){t.renderControl(e.getAggregation("thumbnailsContainer"))};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Texture", ["sap/ui/base/ManagedObject"],function(e){"use strict";var t=e.extend("sap.ui.vk.Texture",{metadata:{library:"sap.ui.vk",properties:{id:{type:"string"},filterMode:{type:"int",defaultValue:0},uvRotationAngle:{type:"float",defaultValue:0},uvHorizontalOffset:{type:"float",defaultValue:0},uvVerticalOffset:{type:"float",defaultValue:0},uvHorizontalScale:{type:"float",defaultValue:0},uvVerticalScale:{type:"float",defaultValue:0},uvHorizontalTilingEnabled:{type:"boolean",defaultValue:true},uvVerticalTilingEnabled:{type:"boolean",defaultValue:true}}}});t.prototype.load=function(e){return this};t.prototype.getTextRef=function(){return null};return t});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/ToggleMenuButton", ["./library","sap/ui/core/Core","sap/ui/core/Control","sap/m/library","sap/m/Button","sap/m/ButtonRenderer","sap/m/ToggleButton","sap/m/Menu","sap/ui/core/EnabledPropagator","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/core/Popup","sap/ui/Device","sap/ui/events/KeyCodes","./ToggleMenuButtonRenderer"],function(e,t,o,r,i,n,s,a,p,u,l,g,h,d,f){"use strict";var c=l.TextDirection;var m=r.ButtonType;var y=g.Dock;var B=o.extend("sap.ui.vk.ToggleMenuButton",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.vk",properties:{type:{type:"sap.m.ButtonType",group:"Appearance",defaultValue:m.Default},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Behavior",defaultValue:true},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},menuPosition:{type:"sap.ui.core.Popup.Dock",group:"Misc",defaultValue:y.BeginBottom},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:c.Inherit},pressed:{type:"boolean",group:"Data",defaultValue:false}},aggregations:{_menu:{type:"sap.m.Menu",multiple:false,visibility:"hidden"},_toggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_arrowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},items:{type:"sap.ui.vk.ToggleMenuItem",multiple:true,forwarding:{getter:"_getMenu",aggregation:"items",forwardBinding:true}}},associations:{defaultItem:{type:"sap.ui.vk.ToggleMenuItem",multiple:false},ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{beforeMenuOpen:{},itemToggled:{parameters:{oldItem:{type:"sap.ui.vk.ToggleMenuItem"},newItem:{type:"sap.ui.vk.ToggleMenuItem"}}},itemSelected:{parameters:{item:{type:"sap.ui.vk.ToggleMenuItem"}}}}}});p.call(B.prototype);B.prototype.init=function(){if(o.init){o.init.call(this)}var e=new a({id:this.getId()+"-menu"});e.attachClosed(this._menuClosed,this);e.attachItemSelected(this._menuItemSelected,this);this.setAggregation("_menu",e);var r=new s({id:this.getId()+"-toggleButton",width:"100%",tooltip:this.getTooltip(),press:function(){var e=t.byId(this.getDefaultItem());if(e){this.fireItemToggled(this.getPressed()?{newItem:e,oldItem:null}:{newItem:null,oldItem:e})}}.bind(this)}).addStyleClass("sapUiVkTMBText");this.setAggregation("_toggleButton",r);var n=new i({id:this.getId()+"-arrowButton",icon:"sap-icon://slim-arrow-down",tooltip:this.getTooltip(),ariaHasPopup:l.aria.HasPopup.Menu,press:function(){this._handleArrowPress()}.bind(this)}).addStyleClass("sapUiVkTMBArrow");this.setAggregation("_arrowButton",n)};B.prototype._getMenu=function(){return this.getAggregation("_menu")};B.prototype._getToggleButton=function(){return this.getAggregation("_toggleButton")};B.prototype._getArrowButton=function(){return this.getAggregation("_arrowButton")};B.prototype.onAfterRendering=function(){var e=this._getToggleButton().$(),t=this._getArrowButton().$();e.attr("tabindex","-1");t.attr("tabindex","-1");e.removeAttr("title");t.removeAttr("title");e.removeAttr("aria-describedby");t.removeAttr("aria-describedby")};B.prototype._handleArrowPress=function(e){var t=this._getMenu(),o={zero:"0 0",plus2_right:"0 +2",minus2_right:"0 -2",plus2_left:"+2 0",minus2_left:"-2 0"};this.fireBeforeMenuOpen();if(this._popupOpened){this._getMenu().close();this._popupOpened=false;return}if(!t.getTitle()){t.setTitle(this.getText())}var r=[this,e];switch(this.getMenuPosition()){case y.BeginTop:r.push(y.BeginBottom,y.BeginTop,o.plus2_right);break;case y.BeginCenter:r.push(y.BeginCenter,y.BeginCenter,o.zero);break;case y.LeftTop:r.push(y.RightBottom,y.LeftBottom,o.plus2_left);break;case y.LeftCenter:r.push(y.RightCenter,y.LeftCenter,o.plus2_left);break;case y.LeftBottom:r.push(y.RightTop,y.LeftTop,o.plus2_left);break;case y.CenterTop:r.push(y.CenterBottom,y.CenterTop,o.plus2_left);break;case y.CenterCenter:r.push(y.CenterCenter,y.CenterCenter,o.zero);break;case y.CenterBottom:r.push(y.CenterTop,y.CenterBottom,o.minus2_right);break;case y.RightTop:r.push(y.LeftBottom,y.RightBottom,o.minus2_left);break;case y.RightCenter:r.push(y.LeftCenter,y.RightCenter,o.minus2_left);break;case y.RightBottom:r.push(y.LeftTop,y.RightTop,o.minus2_left);break;case y.EndTop:r.push(y.EndBottom,y.EndTop,o.plus2_right);break;case y.EndCenter:r.push(y.EndCenter,y.EndCenter,o.zero);break;case y.EndBottom:r.push(y.EndTop,y.EndBottom,o.minus2_right);break;case y.BeginBottom:default:r.push(y.BeginTop,y.BeginBottom,o.minus2_right);break}t.openBy.apply(t,r);if(this._getMenu()){this._popupOpened=true}this._writeAriaAttributes();if(!h.system.phone){this.setArrowState(true)}};B.prototype._menuClosed=function(){this._popupOpened=false;this.setArrowState(false);var e=this._getArrowButton();e.$().removeAttr("aria-controls");e.$().attr("aria-expanded","false")};B.prototype._writeAriaAttributes=function(){var e=this._getArrowButton(),t=this._getMenu();if(t){e.$().attr("aria-controls",t.getDomRefId());e.$().attr("aria-expanded","true")}};B.prototype.setArrowState=function(e){this._getArrowButton().$()[e?"addClass":"removeClass"]("sapMSBActive")};B.prototype.getPressed=function(){return this._getToggleButton().getPressed()};B.prototype.setProperty=function(e,t,r){if(e==="type"&&(t===m.Up||t===m.Back||t===m.Unstyled)){return this}var n=o.prototype.setProperty.apply(this,arguments);function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}if(e==="iconDensityAware"||e==="textDirection"){s.prototype.setProperty.apply(this._getToggleButton(),arguments)}else if(e==="text"||e==="type"||e==="icon"||e==="pressed"){var p="set"+a(e);s.prototype[p].call(this._getToggleButton(),t);if(e==="type"){i.prototype[p].call(this._getArrowButton(),t)}}return n};B.prototype.onkeydown=function(e){if(e.which===d.SPACE){e.preventDefault()}this._getToggleButton().onkeydown(e)};B.prototype.onkeyup=function(e){this._getToggleButton().onkeyup(e)};B.prototype.onsapup=function(e){this._handleArrowPress()};B.prototype.onsapdown=function(e){this._handleArrowPress()};B.prototype.onsapupmodifiers=function(e){this._handleArrowPress()};B.prototype.onsapdownmodifiers=function(e){this._handleArrowPress()};B.prototype.onsapshow=function(e){this._handleArrowPress();e.preventDefault()};B.prototype.getButtonTypeAriaLabelId=function(){var e=this._getToggleButton().getType();return n.getButtonTypeAriaLabelId(e)};B.prototype.getTitleAttributeValue=function(){var e=this.getTooltip_AsString(),t=u.getIconInfo(this.getIcon()),o;if(e||t&&t.text&&!this.getText()){o=e||t.text}return o};B.prototype.getOverflowToolbarConfig=function(){return{canOverflow:true,propsUnrelatedToSize:["enabled","type","icon"],autoCloseEvents:["press"]}};B.prototype._menuItemSelected=function(e){var o=e.getParameter("item");if(o.getToggleable()){var r=this._getToggleButton();var i=r.getPressed()?t.byId(this.getDefaultItem()):null;if(o!==i){this.setDefaultItem(o);r.setPressed(true);r.rerender();this.fireItemToggled({newItem:o,oldItem:i})}else{r.setPressed(!r.getPressed());this.fireItemToggled(r.getPressed()?{newItem:o,oldItem:null}:{newItem:null,oldItem:o})}}else{this.fireItemSelected({item:o})}this._popupOpened=false};B.prototype.getIcon=function(){return this._getToggleButton().getIcon()};B.prototype.getText=function(){return this._getToggleButton().getText()};B.prototype.setDefaultItem=function(e){this.setAssociation("defaultItem",e);if(e==null){return this}if(typeof e==="string"){e=t.byId(e)}var o=e.getIcon();var r=this._getToggleButton();r.setIcon(o);r.setText(o?null:e.getText());this.rerender()};B.prototype.onBeforeRendering=function(){if(!this.getDefaultItem()){var e=this.getItems().find(function(e){return e.getToggleable()});if(e){this.setDefaultItem(e)}}};return B});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ToggleMenuButtonRenderer", ["./library","sap/m/library","sap/ui/core/InvisibleText","sap/ui/core/ShortcutHintsMixin"],function(t,e,i,a){"use strict";var r=e.ButtonType;var n={apiVersion:2};var s="sapUiVkTMB";n.render=function(t,e){var i=e.getWidth(),n=e.getType(),o=e.getEnabled(),l=e.getTitleAttributeValue(),c;t.openStart("div",e).class(s);if(e._getToggleButton().getIcon()){t.class(s+"HasIcon")}if(n===r.Accept||n===r.Reject||n===r.Emphasized||n===r.Transparent||n===r.Attention||n===r.Neutral||n===r.Critical||n===r.Success||n===r.Negative){t.class(s+n)}this.writeAriaAttributes(t,e);t.attr("tabindex",o?"0":"-1");if(l&&!a.isDOMIDRegistered(e.getId())){t.attr("title",l)}if(i!=""||i.toLowerCase()==="auto"){t.style("width",i)}t.openEnd();t.openStart("div").class("sapUiVkTMBInner");if(!o){t.class("sapUiVkTMBInnerDisabled")}t.openEnd();t.renderControl(e._getToggleButton());t.renderControl(e._getArrowButton());t.close("div");if(l){c=e.getId()+"-tooltip";t.openStart("span",c);t.class("sapUiInvisibleText");t.openEnd();t.text(l);t.close("span")}t.close("div")};n.writeAriaAttributes=function(t,e){var i={};this.writeAriaRole(e,i);this.writeAriaLabelledBy(e,i);t.accessibilityState(e,i)};n.writeAriaRole=function(t,e){e["role"]="group"};n.writeAriaLabelledBy=function(t,e){var a="",r=t.getButtonTypeAriaLabelId(),n=t.getTitleAttributeValue(),s;if(r){a+=r;a+=" "}if(n){s=t.getId()+"-tooltip";a+=s+" "}a+=i.getStaticId("sap.m","SPLIT_BUTTON_DESCRIPTION")+" ";a+=i.getStaticId("sap.m","SPLIT_BUTTON_KEYBOARD_HINT");e["labelledby"]={value:a,append:true}};return n},true);
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/ToggleMenuItem", ["sap/m/MenuItem"],function(e){"use strict";var a=e.extend("sap.ui.vk.ToggleMenuItem",{metadata:{library:"sap.ui.vk",properties:{toggleable:{type:"boolean",group:"Behavior",defaultValue:true}}}});return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Toolbar", ["./library","sap/ui/core/Control","./ToolbarRenderer","./getResourceBundle","sap/ui/core/Core"],function(e,t,i,o,n){"use strict";var s=t.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",multiple:false}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"hidden"}}}});s.prototype._getToolbar=function(){return this._toolbar};s.prototype._onSceneTree=function(){this.oViewer=n.byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.sceneTree.userInteractionShow=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(this.oViewer._componentsState.sceneTree.userInteractionShow)}};s.prototype._onStepNavigation=function(){this.oViewer=n.byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.stepNavigation.userInteractionShow=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(this.oViewer._componentsState.stepNavigation.userInteractionShow)}};s.prototype._onFullScreen=function(){this.oViewer=n.byId(this.getViewer());if(this.oViewer!=null){var e=this._enterFullScreenButton.getPressed();this.oViewer.activateFullScreenMode(e)}};s.prototype._fullScreenHandler=function(e){var t=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(t);if(t){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen")}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen")}};s.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}var e=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:o().getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",e);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:o().getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:o().getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);this._toolbarTitle=new sap.m.Title;this.setAggregation("_toolbarTitle",this._toolbarTitle);this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:o().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var i=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:o().getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",i);var n=n=[new sap.m.ToolbarSpacer,this._toolbarTitle,new sap.m.ToolbarSpacer,new sap.m.ToolbarSeparator,this._sceneTreeButton,new sap.m.ToolbarSeparator,this._stepNavigationButton,new sap.m.ToolbarSeparator,this._enterFullScreenButton];this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:n});this.setAggregation("_toolbar",this._toolbar,true)};s.prototype.exit=function(){this.oViewer=n.byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this))}};s.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle())};s.prototype.refresh=function(){this.oViewer=n.byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true};s.prototype.onAfterRendering=function(){this.refresh()};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ToolbarRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("div",r);e.class("sapVizKitToolbar");e.openEnd();e.renderControl(r.getAggregation("_toolbar"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/TransformationMatrix", ["sap/ui/base/DataType","sap/base/assert"],function(n,r){"use strict";var t=n.getType("float[]");t.parseValue=function(n){var r=t.getComponentType();return n.split(/\s*,\s*|\s+/).map(r.parseValue.bind(r))};t.convertTo4x4=function(n){var r=n;return[r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,r[9],r[10],r[11],1]};t.canConvertTo4x3=function(n){var r=function(n,r){return Math.abs(n-r)<1e-5};return r(n[3],0)&&r(n[7],0)&&r(n[11],0)&&r(n[15],1)};t.convertTo4x3=function(n){var e=n;r(t.canConvertTo4x3(e),"The transformation matrix is invalid. The last column must be [0, 0, 0, 1].");return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10],e[12],e[13],e[14]]};t.convert3x2To4x3=function(n){return[n[0],n[1],0,n[2],n[3],0,0,0,1,n[4],n[5],0]};t.convert4x3To3x2=function(n){return new Float32Array([n[0],n[1],n[3],n[4],n[9],n[10]])};t.convert4x4To3x2=function(n){return new Float32Array([n[0],n[1],n[4],n[5],n[12],n[13]])};t.convertTo3x2=function(n){if(n){if(n.length===12){return t.convert4x3To3x2(n)}else if(n.length===16){return t.convert4x4To3x2(n)}}return new Float32Array([1,0,0,1,0,0])};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/View", ["sap/ui/base/ManagedObject","sap/ui/model/json/JSONModel","./findIndexInArray","./AnimationPlayback","./Core"],function(t,a,e,i,s){"use strict";var n=t.extend("sap.ui.vk.View",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IPlaybackCollection"],properties:{viewId:{type:"string"},name:{type:"string"},description:{type:"string"},aspectRatio:{type:"float"},autoPlayAnimation:{type:"boolean",defaultValue:true},topColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(238, 238, 238, 1)"},bottomColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"}}}});n.prototype.init=function(){this._playbacks=[];this._playbacksJSONData=[];this._model=new a({playbacks:this._playbacksJSONData});this._model.setSizeLimit(1e3*1e3);this._highlightIdNodesMap=new Map};n.prototype.exit=function(){this._playbacks=undefined;this._playbacksJSONData=undefined;this._highlightIdNodesMap=undefined};n.prototype.getCamera=function(){return this._camera};n.prototype.setCamera=function(t){this._camera=t;return this};n.prototype.hasHighlight=function(){return this._highlightIdNodesMap&&this._highlightIdNodesMap.size};n.prototype.getHighlightIdNodesMap=function(){return this._highlightIdNodesMap};n.prototype.addHighlightedNodes=function(t,a){var e=this._highlightIdNodesMap.get(t);if(!Array.isArray(a)){a=[a]}if(!e){this._highlightIdNodesMap.set(t,a)}else{e=e.concat(a.filter(function(t){return e.indexOf(t)<0}));this._highlightIdNodesMap.set(t,e)}};n.prototype.hasAnimation=function(){return this._playbacks&&this._playbacks.length};n.prototype.getPlaybacks=function(){return this._playbacks};n.prototype.getPlayback=function(t){if(t<0||t>=this._playbacks.length){return undefined}return this._playbacks[t]};n.prototype.indexOfPlayback=function(t){return e(this._playbacks,function(a){return a===t})};n.prototype.addPlayback=function(t,a){this._playbacks.push(t);this._playbacksJSONData.push(t.getJSONData());if(this._model){this._model.updateBindings()}t.setJSONModel(this._model);if(!a){this._firePlaybacksChanged("playbackAdded",t)}return this};n.prototype.insertPlayback=function(t,a,e){if(a<0){a=0}else if(a!==0&&a>=this._playbacks.length){a=this._playbacks.length}this._playbacks.splice(a,0,t);this._playbacksJSONData.splice(a,0,t.getJSONData());if(this._model){this._model.updateBindings()}if(!e){this._firePlaybacksChanged("playbackInserted",t)}return this};n.prototype.sortPlaybacks=function(t,a,e){this._playbacks.sort(function(t,a){return t.getStartTime()-a.getStartTime()});this._playbacksJSONData=[];this._playbacks.forEach(function(t){this._playbacksJSONData.push(t.getJSONData())}.bind(this));var i=true;for(var s=0;s<this._playbacks.length-1;s++){var n=this._playbacks[s].getStartTime();var r=this._playbacks[s+1].getStartTime();if(r-n<1e-5){i=false;break}}if(!e){this._firePlaybacksChanged("playbacksOrderChanged")}return i};n.prototype.removePlayback=function(t,a){var i;if(typeof t==="number"){i=t}else if(typeof t==="string"){i=e(this._playbacks,function(a){return a.getId()===t})}else{i=e(this._playbacks,function(a){return a===t})}var s;if(i!=null&&i>=0&&i<this._playbacks.length){s=this._playbacks[i];this._playbacks.splice(i,1);this._playbacksJSONData.splice(i,1);if(this._model){this._model.updateBindings()}}if(!a){this._firePlaybacksChanged("playbackRemoved",s)}return this};n.prototype.removePlaybacks=function(t){this._playbacks.splice(0);this._playbacksJSONData.splice(0);if(this._model){this._model.updateBindings()}if(!t){this._firePlaybacksChanged("playbacksRemoved")}return this};n.prototype.switchPlaybacks=function(t,a,e){var i,s;for(var n=0;n<this._playbacks.length;n++){if(this._playbacks[n]===t){i=n}else if(this._playbacks[n]===a){s=n}}if(i!==undefined&&s!==undefined){var r=this._playbacks[i];var o=this._playbacksJSONData[i];this._playbacks[i]=this._playbacks[s];this._playbacksJSONData[i]=this._playbacksJSONData[s];this._playbacks[s]=r;this._playbacksJSONData[s]=o}this.resetPlaybacksStartTimes(true);if(!e){this._firePlaybacksChanged("playbacksOrderChanged")}return this};n.prototype.resetPlaybacksStartTimes=function(t){if(this._playbacks.length===0){return this}var a=0;for(var e=0;e<this._playbacks.length;e++){this._playbacks[e].setStartTime(a);a+=this._playbacks[e].getDuration()}if(!t){this._firePlaybacksChanged("playbacksStartTimeChanged")}return this};n.prototype._firePlaybacksChanged=function(t,a){s.getEventBus().publish("sap.ui.vk","playbacksChanged",{viewId:this.getViewId(),operation:t,playback:a})};n.prototype.setPlaybacksReversed=function(t,a){for(var e=0;e<this._playbacks.length;e++){this._playbacks[e].setReversed(t)}if(!a){this._firePlaybacksChanged()}return this};n.prototype.getNodeInfos=function(){return this._nodeInfos?this._nodeInfos:[]};n.prototype.setNodeInfos=function(t){this._nodeInfos=t;return this};n.prototype.updateNodeInfos=function(t){var a=this.getNodeInfos();if(!a){return this.setNodeInfos(t)}var e=new Map;a.forEach(function(t,a){e.set(t.target,a)});var i=function(t,a){for(var e in a){t[e]=a[e]}};t.forEach(function(t){var s=e.get(t.target);if(s==null){a.push(t)}else{i(a[s],t)}});this.setNodeInfos(a);return this};n.prototype.getModel=function(){return this._model};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGallery", ["sap/ui/core/Control","sap/ui/core/IconPool","./library","./Core","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo","sap/base/Log"],function(e,t,i,s,n,o,r,a,l,p,c,h,d,u,g,m,_,f,v,V,w,y,S,I,T){"use strict";var b=e.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1},enabled:{type:"boolean",defaultValue:true}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer"},contentConnector:{type:"sap.ui.vk.ContentConnector"},host:{type:"sap.ui.vk.ViewportBase"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}},constructor:function(t,i){e.apply(this,arguments);s.observeAssociations(this)}});b.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}var i=this;window.addEventListener("resize",function(){i.resizeToolbarSpacer()},true);this._scene=null;this._vkScene=null;this._viewItems=[];this._viewManager=null;this._host=null;this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;t.addIcon("landscape-text","vk-icons","vk-icons","e019");t.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new y;if(this.getShowThumbnailContainer()){this.createThumbnailContainer()}if(this.getShowToolbar()){this.createToolbar()}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}s.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this)};b.prototype.exit=function(){s.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);this.setScene(null)};b.prototype.onSetViewManager=function(e){this._viewManager=e};b.prototype.onUnsetViewManager=function(e){this._viewManager=null};b.prototype._getSelectedViewGroup=function(){var e=this.getSelectedViewGroupIndex();var t;if(this._vkScene){var i=this._vkScene.getViewGroups();if(e>=0&&e<i.length){t=i[e]}}return t};b.prototype._getSelectedView=function(){var e;var t=this.getSelectedViewIndex();var i=this._getViews();if(i&&t>=0&&t<i.length){e=i[t]}return e};b.prototype._getViewGroups=function(){var e;if(this._vkScene){e=this._vkScene.getViewGroups()}return e};b.prototype._getViews=function(){var e=this._getSelectedViewGroup();var t;if(e){t=e.getViews()}else if(this._vkScene){t=this._vkScene.getViews()}return t};b.prototype._getViewIndex=function(e){var t=-1;var i=this._getViews();if(Array.isArray(i)){t=i.indexOf(e)}return t};b.prototype._getViewAnimationDuration=function(e){e=e||this._getSelectedView();var t;if(e){var i=e.getPlaybacks();if(Array.isArray(i)&&i.length){t=i.reduce(function(e,t){return e+t.getDuration()},0)}}return t};b.prototype.setVisible=function(t){if(e.prototype.setVisible){e.prototype.setVisible.call(this,t)}this.setDescription()};b.prototype.resizeToolbarSpacer=function(){if(this.getDomRef()){var e=this._nextItemButton.getDomRef().getBoundingClientRect().width;e+=this._playButton.getDomRef().getBoundingClientRect().width;e+=this._previousItemButton.getDomRef().getBoundingClientRect().width;var t=this.toolbar.getDomRef().getBoundingClientRect().width;var i=e/t*100;var s=50-i;this._toolbarSpacer.setWidth(s+"%")}};b.prototype.onAfterRendering=function(){this.resizeToolbarSpacer();if(document.getElementById("body")){var e=window.getComputedStyle(document.getElementById("body"));var t=e.getPropertyValue("background-color");var i;var s=this.getDomRef();if(t){if(t.indexOf("a")===-1){i=t.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");s.style.backgroundColor=i}else{var n=new RegExp("([^,]*)$");i=t.replace(n," "+this.getTransparency()+")");s.style.backgroundColor=i}}if(this.toolbar){var o=this.toolbar.getDomRef();o.style.backgroundColor="rgba(0, 0, 0, 0)"}}if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}if(this.getDomRef()){var r=this.getDomRef();if(!this.getEnabled()){var a=function(e){var t=e.children;for(var i=0;i<t.length;i++){t[i].tabIndex=-1;a(t[i])}};a(r);this.addStyleClass("sapVizKitViewGalleryDisabled")}else{this.removeStyleClass("sapVizKitViewGalleryDisabled")}}};b.prototype.setShowAnimationTimeSlider=function(e){this.setProperty("showAnimationTimeSlider",e);if(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider")}this._setupAnimationSlider()};b.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider")};b.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar")};b.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container")};b.prototype.createThumbnailContainer=function(){var e=this;this._hbox=new l;if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new S({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(t){var i=t.getParameter("droppedControl");e.reorderViews(i);e.fireViewOrderChange({view:e._draggedModelView,viewIndex:e._viewItems.indexOf(i)})}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true}this._scrollContainer=new u(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer)};b.prototype.reorderViews=function(e){var t=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(t,1);var i=this._viewItems.indexOf(e);this._modelViews.splice(i,0,this._draggedModelView);this._refreshItems()};b.prototype.createToolbar=function(){var e=this;this.toolbar=new _({design:sap.m.ToolbarDesign.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new g(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:r().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>0){e.setSelectedItem(e._viewItems[i-1])}}});this._nextItemButton=new g(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:r().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>=0&&i+1<e._viewItems.length){e.setSelectedItem(e._viewItems[i+1])}}});this._viewGroupSelector=new f({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new u({horizontal:false,vertical:true,content:[this._procedureList=new V({width:"100%",itemPress:function(t){e._clearUI();var i=this.indexOfItem(t.getParameter("item"));e.setSelectedViewGroupIndex(i)}})]})]});this._playButton=new m(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:r().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(e){this._setPlayState(e.getSource().getPressed());if(e.getSource().getPressed()){this._playProcedure()}else{this._pauseAnimation()}}.bind(this)});this._stepCount=new v({textAlign:sap.ui.core.TextAlign.Right,level:"H5",titleStyle:"H5"});this._currentGroupTitle=new v({text:r().getText("STEP_NAV_PROCEDURES"),tooltip:r().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new v({width:5/1920*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new v({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle)}.bind(this)});this._toolbarSpacer=new w;this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new w).addContent(this._stepCount).addContent(this._toolbarSpacer).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton)};b.prototype._setPlayState=function(e){if(this.getAggregation("toolbar")){this._playButton.setPressed(e);if(e){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(r().getText("STEP_NAV_PLAYMENU_PAUSE"))}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(r().getText("STEP_NAV_PLAYMENU_PLAY"))}}};b.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new p({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new _({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(e){this._toggleViewDescription()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new w,this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new h({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new u({horizontal:false,vertical:true,content:[this._stepDescriptionText=new c({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new l({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new u({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new c({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new _({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(e){this._toggleViewDescriptionVertical()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new h({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical"};b.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var e=this.getDomRef().getBoundingClientRect().height;var t=this._stepDescription.getDomRef().id;var i=this._stepDescriptionVertical.getDomRef().id;document.getElementById(t).style.bottom=e+"px";document.getElementById(i).style.bottom=e+"px";var s=this._host.getDomRef().getBoundingClientRect().height;document.getElementById(i).style.height=s-e+"px"}};b.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true)}this._stepDescriptionText.setVisible(false)}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true)}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false)}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}};b.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionText.rerender()};b.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionVerticalText.rerender()};b.prototype._getHBox=function(){return this._hbox};b.prototype._playProcedure=function(){this._manualTimeChange=false;if(this._viewManager){var e=this._getSelectedView();if(!e){var t=this._getViews();if(t&&t.length){e=t[0]}}if(e){this._viewManager.playViewGroup(e,this._getSelectedViewGroup())}}};b.prototype._pauseAnimation=function(){if(this._viewManager){this._viewManager.stopPlayingViewGroup()}};b.prototype.setPlayingAnimation=function(e){this._playingAnimation=e};b.prototype.onSetAnimationPlayer=function(e){this._animationPlayer=e;e.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.attachStateChanged(this._onAnimationPlayerStateChanged,this);this._setupAnimationSlider()};b.prototype.onUnsetAnimationPlayer=function(e){e.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.detachStateChanged(this._onAnimationPlayerStateChanged,this);this._animationPlayer=null};b.prototype._setupAnimationSlider=function(){var e=this.getAnimationTimeSlider();if(e&&this._animationPlayer){var t=this._getViewAnimationDuration();if(t){e.setMax(t);e.setStep(t/100);e.setValue(this._animationPlayer.getTime())}}};b.prototype._onAnimationPlayerTimeChanged=function(e){var t=e.getParameter("time");var i=this.getAnimationTimeSlider();if(i){i.setValue(t)}};b.prototype._onAnimationPlayerStateChanged=function(e){var t=e.getParameter("playing");this._setPlayState(t)};b.prototype._onProcedureFinished=function(e){this._setPlayState(false)};b.prototype.setScene=function(e){if(e&&e.loaders){for(var t=0;t<e.loaders.length;t++){var i=e.loaders[t];if(i.getMetadata&&i.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){if(this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this)}this._cdsLoader=i;this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break}else if(i.requestViewGroup){this._loader=i;break}}}if(e==null&&this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader=null}this._vkScene=e;this._refreshProcedures();this._resetCurrentView()};b.prototype._onViewActivated=function(e,t,i){var s;var n=i.view;var o=this._getViewGroups();if(o&&o.length>0){var r=o[this.getSelectedViewGroupIndex()];if(r&&r.getViewGroupId()!=n.viewGroupId){for(var a=0;a<o.length;a++){if(o[a].getViewGroupId()===n.viewGroupId){for(var l=0;l<o[a].getViews().length;l++){if(o[a].getViews()[l]===n){s=l;this.setSelectedViewGroupIndex(a,s);break}}}}}else{for(var p=0;r&&p<r.getViews().length;p++){if(r.getViews()[p]===n){s=p;this.viewActivated(s,n);break}}}}};b.prototype.onSetHost=function(e){if(e.getContent()){var t=function(t){var i=e.getContent();for(var s=0;s<i.length;s++){if(i[s].vitId==t){return s}}};e.removeContent(t("VIT-StepDescription"));e.removeContent(t("VIT-StepDescriptionVertical"))}this._createStepDescriptionBoxes();e.addContent(this._stepDescription);e.addContent(this._stepDescriptionVertical);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype.onUnsetHost=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype._attachAnimationTimeSlider=function(e){if(!e){return}e.attachChange(this._onSliderValueChange,this);e.attachLiveChange(this._onSliderValueLiveChange,this)};b.prototype._detachAnimationTimeSlider=function(e){if(!e){return}e.detachChange(this._onSliderValueChange,this);e.detachLiveChange(this._onSliderValueLiveChange,this)};b.prototype._onSliderValueLiveChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};b.prototype._onSliderValueChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};b.prototype._refreshProcedures=function(e){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems()}this._modelViews=null;var t=this._getViewGroups();if(t&&t.length>0){this._selectedGroupIndex=0;var i=0;t.forEach(function(t){if(this.getAggregation("toolbar")){this._procedureList.addItem(new sap.ui.core.Item({key:t.getViewGroupId(),text:t.getName()}))}if(e&&t.getViewGroupId()===e){this._selectedGroupIndex=i}i++}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(t[this._selectedGroupIndex].getName()).setTooltip(t[this._selectedGroupIndex].getName())}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(r().getText("STEP_NAV_PROCEDURES"))}this._refreshItems()};b.prototype.refresh=function(e){this.setScene(e)};var D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";b.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._stepCount.setText("");if(this._stepDescriptionText){this._stepDescriptionText.setHtmlText("")}if(this._stepDescriptionVerticalText){this._stepDescriptionVerticalText.setHtmlText("")}}if(this.getAggregation("container")){this._hbox.destroyItems()}this._viewItems=[];if(this._stepDescriptionToolbar){this._stepDescriptionToolbar.setVisible(false)}if(this._stepDescriptionVerticalToolbar){this._stepDescriptionVerticalToolbar.setVisible(false)}};b.prototype._refreshItems=function(){this._clearUI();var e=this;if(this._modelViews){var t=function(e){this.setSelectedItem(e.getSource())}.bind(this);this._modelViews.forEach(function(i){var s=true;var n=i.name||i.getName&&i.getName();var o=new a({alt:n,densityAware:false,tooltip:n,viewGallery:this,source:i.thumbnailData||D,press:function(s){o.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});o.setSource(i.thumbnailData||D);clearInterval(s.getSource().interval);t(s)},layoutData:new h({shrinkFactor:0})});var r=function(t,n){var r=t.width/n;var a=t.height;var l=n;var p=a;var c=document.createElement("canvas");var h=c.getContext("2d");var d=[];c.width=l;c.height=p;for(var u=0;u<r;u++){var g=l*u;h.clearRect(0,0,l,p);h.drawImage(t,g,0,l,p,0,0,l,p);d.push(c.toDataURL())}e.startAnimate=function(){if(s){s=false;o.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});var t=0;var i=function(){if(t<r){o.setSource(d[t]);t++}else{o.setSource(d[0]);t=0}};o.interval=setInterval(function(){i()},250)}};o.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});o.attachBrowserEvent("mouseout",function(t){s=true;o.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});clearInterval(o.interval);o.setSource(i.thumbnailData)})};if(i.animatedThumbnailData!==undefined){var l=document.createElement("img");l.onload=function(){r(l,i.tileWidth)};l.src=i.animatedThumbnailData}if(this.getEnableViewReordering()){o.addDragDropConfig(new I({dragStart:function(){e._draggedModelView=i}}));o.getMetadata().dnd.draggable=true}o.data("modelView",i);this._viewItems.push(o);if(this.getAggregation("container")){this._hbox.addItem(o)}if(this._hbox.getItems().length===1){o.data("help-id","vit-view-thumbnail",true)}}.bind(this));this.rerender()}};b.prototype.setSelectedItem=function(e){if(e.getCustomData().length>0){var t=e.getCustomData()[0].getValue();if(this._viewManager){this._viewManager.activateView(t)}}return this};b.prototype.setDescription=function(){if(!this._selectedItem){return}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return}if(this._selectedItem.getCustomData().length>0){var e=this._selectedItem.getCustomData()[0].getValue();var t=e.getDescription();if(t){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false)}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false)}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false}if(t!=null){this._stepDescriptionText.setHtmlText(t);this._stepDescriptionVerticalText.setHtmlText(t)}}};b.prototype.viewActivated=function(e){if(this._selectedItem){if(this.getSelectedViewIndex()!==e){this._selectedItem.removeStyleClass("selected")}}this._selectedItem=this._viewItems[e];if(!this._selectedItem){return this}if(this.getAggregation("toolbar")){var t=r().getText("VIEWS_TITLE_WITH_COUNT",[e+1,this._viewItems.length]);this._stepCount.setText(t);var i=this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1;var s=this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1;var n=this._selectedItem.getCustomData().length>0&&this._selectedItem.getCustomData()[0].getValue().getPlaybacks().length>0;this._previousItemButton.setEnabled(i);this._nextItemButton.setEnabled(s);this._playButton.setEnabled(n||s)}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500)}if(this._selectedItem.getCustomData().length>0){var o=this._selectedItem.getCustomData()[0].getValue();var a=o.getPlaybacks();var l=this.getAnimationTimeSlider();if(l){if(!a||a.length===0){l.setEnabled(false);l.setValue(0)}else{l.setEnabled(true)}}var p=o.name||o.getName&&o.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(p).setTooltip(p)}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this};b.prototype.getSelectedItem=function(){return this._selectedItem};b.prototype.getSelectedViewIndex=function(){for(var e=0;e<this._viewItems.length;e++){if(this._viewItems[e]===this.getSelectedItem()){return e}}return-1};b.prototype.setSelectedViewIndex=function(e){if(this._viewItems.length>e){this.setSelectedItem(this._viewItems[e])}};b.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex};b.prototype.setSelectedViewGroupIndex=function(e,t){var i=this._getViewGroups();if(i&&i.length>e){this._selectedGroupIndex=e;if(t==null){t=0}this._currentGroupTitle.setText(i[e].getName()).setTooltip(i[e].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if(!this._modelViews||this._modelViews.length===0){var s=i[e].getViewGroupId();var n=i[e].sceneId;var o=this;if(this._loader&&this._loader.requestViewGroup){this._loader.requestViewGroup(n,s,false).then(function(e){o._refreshItems();o.setSelectedViewIndex(t)}).catch(function(e){T.error(e)})}else if(this._cdsLoader){this._cdsLoader.loadViewGroup(n,s).then(function(e){o._refreshItems();o.setSelectedViewIndex(t)})}}else{this._refreshItems();this.setSelectedViewIndex(t)}}};b.prototype._isScrollingNecessary=function(e,t){if(e&&t){var i=e.getBoundingClientRect();return i.left<0||i.right>t.clientWidth}return false};b.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return}var t=e&&e.getMetadata&&e.getMetadata().getName();var i=t==="sap.ui.vk.threejs.Scene"||t==="sap.ui.vk.svg.Scene";this.setScene(i?e:null);if(i&&e.builders){for(var s=0;s<e.builders.length;s++){e.builders[s]._fireThumbnailLoaded=function(e){var t=null;for(var i=0;i<this._viewItems.length;i++){if(this._viewItems[i].data("modelView")==e.modelView){t=this._viewItems[i];break}}if(t){t.setSource(e.modelView.thumbnailData)}}.bind(this)}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};b.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesStarted(this._onContentChangesStarted,this);e.attachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);this._setContent(e.getContent())};b.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentChangesStarted(this._onContentChangesStarted,this);e.detachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);e.detachContentReplaced(this._onContentReplaced,this)};b.prototype._onContentChangesStarted=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null)};b.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};b.prototype._handleCdsViewGroupUpdate=function(e){var t=e.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems()}else{this._refreshProcedures(t)}this._resetCurrentView()};b.prototype._resetCurrentView=function(){if(this._viewManager){var e=this._viewManager.getActiveView();if(e&&this._viewItems){for(var t=0;t<this._viewItems.length;t++){var i=this._viewItems[t];var s=i.getCustomData()[0].getValue();if(s===e){if(this._selectedItem!==i){this.viewActivated(t);break}}}}if(this._selectedGroupIndex!==-1){var n=this._getViewGroups();if(n&&n.length){this._procedureList.setSelectedKey(n[0].getViewGroupId())}}}};return b});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.openEnd();e.renderControl(n.getAggregation("animationTimeSlider"));e.renderControl(n.getAggregation("toolbar"));e.renderControl(n.getAggregation("container"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryThumbnail", ["sap/m/Image","./Core","./ViewGalleryThumbnailRenderer"],function(e,t,a){"use strict";var l=e.extend("sap.ui.vk.ViewGalleryThumbnail",{metadata:{library:"sap.ui.vk",associations:{viewGallery:{type:"sap.ui.vk.ViewGallery"}},properties:{enabled:{type:"boolean",defaultValue:true},thumbnailWidth:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},thumbnailHeight:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},source:{type:"string",defaultValue:""},tooltip:{type:"string",defaultValue:""},selected:{type:"boolean",defaultValue:false},processing:{type:"boolean",defaultValue:false},animated:{type:"boolean",defaultValue:false}}},constructor:function(a,l){e.apply(this,arguments);this._viewGallery=null;t.observeAssociations(this)}});l.prototype.onSetViewGallery=function(e){this._viewGallery=e};l.prototype.onUnsetViewGallery=function(e){this._viewGallery=null};l.prototype._getIndex=function(){return this._viewGallery?this._viewGallery._viewItems.indexOf(this):-1};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryThumbnailRenderer", ["./library","sap/ui/Device"],function(e,t){"use strict";var i={apiVersion:2};i.render=function(e,t){e.openStart("div",t);e.style("height",t.getThumbnailHeight());e.style("width",t.getThumbnailWidth());e.style("background-image","url("+t.getSource()+")");e.class("sapVizKitViewGalleryThumbnail");e.attr("tabindex",0);var i=t.getTooltip();if(i){e.attr("title",i)}e.openEnd();var a=t._getIndex()+1;if(a>0){e.openStart("div");e.class("sapVizKitViewGalleryStepNumberText");e.openEnd();e.text(a.toString());e.close("div")}e.close("div")};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGroup", ["sap/ui/base/ManagedObject","./findIndexInArray"],function(i,t){"use strict";var e=i.extend("sap.ui.vk.ViewGroup",{metadata:{library:"sap.ui.vk",properties:{viewGroupId:{type:"string"},name:{type:"string"},description:{type:"string"}},associations:{}}});e.prototype.init=function(){this._views=[]};e.prototype.exit=function(){this._views=null};e.prototype.getViews=function(){return this._views};e.prototype.addView=function(i){this._views.push(i);return this};e.prototype.insertView=function(i,t){if(t<0){t=0}else if(t!==0&&t>=this._views.length){t=this._views.length}this._views.splice(t,0,i);return this};e.prototype.indexOfView=function(i){return t(this._views,function(t){return t==i})};e.prototype.removeView=function(i){var t=this.indexOfView(i);if(t>=0){this._views.splice(t,1)}return this};e.prototype.removeViews=function(){if(this._views){this._views.splice(0)}return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewManager", ["sap/ui/core/Element","./Core","./Scene","sap/ui/core/Core"],function(e,t,i,n){"use strict";var a=e.extend("sap.ui.vk.ViewManager",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IViewManager"],properties:{allowAutoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceViewTimeout:{type:"int",defaultValue:1e3}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},constructor:function(i,n){e.apply(this,arguments);t.observeLifetime(this);t.observeAssociations(this)}});a.prototype._setScene=function(e){if(this._scene!==e){this._scene=e;if(this._scene){var t=e.getInitialView();if(t){this.activateView(t)}}}return this};a.prototype.getScene=function(){return this._scene};a.prototype.getActiveView=function(){return this._activeView};a.prototype.getNextView=function(e,t){var i=this.getScene();if(!t){t=i.findViewGroupByView(e)}var n;var a=-1;if(!t){n=i.getViews();a=n.indexOf(e)}else{n=t.getViews();a=t.indexOfView(e)}if(a<0){return undefined}else if(a>=n.length-1){return undefined}a++;return n[a]};a.prototype._setContent=function(e){var t=null;if(e&&e instanceof i){t=e}this._setScene(t)};a.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};a.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};a.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};a.prototype.activateView=function(e,t){return this._activateView(e,null,!this.getAllowAutoPlayAnimation(),false,t)};a.prototype.playViewGroup=function(e,t){this._cancelPlayingViewGroup=false;if(e===this.getActiveView()){var i=n.byId(this.getAnimationPlayer());if(i){if(i.getTime()>=i.getTotalDuration()){i.setTime(0)}}return this._autoPlay(e,t,false,true)}this._activateView(e,t,false,true);return this};a.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var e=n.byId(this.getAnimationPlayer());if(e){e.stop()}};a.prototype._autoPlay=function(e,i,a,o){var r=t.getEventBus();var s=n.byId(this.getAnimationPlayer());var u=function(){if(this._cancelPlayingViewGroup){return}var t=this.getNextView(e,i);if(t){this._activateView(t,i,a,o)}else{r.publish("sap.ui.vk","procedureFinished")}}.bind(this);var c=function(e,t,i){if(i.source!==s){return}if(i.stopped){r.unsubscribe("sap.ui.vk","animationPlayStateChanged",c,this);if(i.endOfAnimation){u()}}};var p=function(){var t=e.getAutoPlayAnimation();if(o){if(s&&e.hasAnimation()&&t){r.subscribe("sap.ui.vk","animationPlayStateChanged",c,this)}else{setTimeout(function(){u()},this.getAutoAdvanceViewTimeout())}}if((!a||o)&&e.hasAnimation()&&t){if(s){s.play()}else{}}}.bind(this);p()};a.prototype._activateView=function(e,i,a,o,r){var s=n.byId(this.getAnimationPlayer());if(s){s.stop()}this._cancelPlayingViewGroup=false;var u=this;return new Promise(function(n,s){var c=t.getEventBus();u._activeView=e;var p=function(t,r,s){c.unsubscribe("sap.ui.vk","readyForAnimation",p,u);if(s.view!==e){return}if(u._cancelPlayingViewGroup){return}u._autoPlay(e,i,a,o,true);n({view:s.view});return};c.subscribe("sap.ui.vk","readyForAnimation",p,u);c.publish("sap.ui.vk","activateView",{source:u,view:e,notAnimateCameraChange:r,playViewGroup:o})})};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewStateManager", ["sap/base/util/ObjectPath","./Scene","./ViewStateManagerBase","sap/ui/core/Core"],function(t,e,i,n){"use strict";var o=i.extend("sap.ui.vk.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var a=o.getMetadata().getParent().getClass().prototype;o.prototype.init=function(){if(a.init){a.init.call(this)}this._implementation=null};o.prototype.exit=function(){this._destroyImplementation();if(a.exit){a.exit.call(this)}};o.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null}return this};o.prototype.getImplementation=function(){return this._implementation};o.prototype._setContent=function(t){var i=null;if(t&&t instanceof e){i=t}this._setScene(i);return this};o.prototype._setScene=function(i){if(i&&i instanceof e){var o=(this.getFeatures()||[]).includes("MultipleViewports");var a=i.getMetadata().getName();var r=this._implementation&&this._implementation.getMetadata().getName();var s=a==="sap.ui.vk.dvl.Scene"&&r==="sap.ui.vk.dvl.ViewStateManager"||a==="sap.ui.vk.threejs.Scene"&&(r==="sap.ui.vk.threejs.ViewStateManager"&&!o||r==="sap.ui.vk.threejs.v2.ViewStateManager"&&o)||a==="sap.ui.vk.svg.Scene"&&r==="sap.ui.vk.svg.ViewStateManager";if(!s){this._destroyImplementation();var m;if(a==="sap.ui.vk.dvl.Scene"){m="sap.ui.vk.dvl.ViewStateManager"}else if(a==="sap.ui.vk.threejs.Scene"){if(o){m="sap.ui.vk.threejs.v2.ViewStateManager"}else{m="sap.ui.vk.threejs.ViewStateManager"}}else if(a==="sap.ui.vk.svg.Scene"){m="sap.ui.vk.svg.ViewStateManager"}if(m){var p=this;var l=t.get(m);this._implementation=new l({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),viewManager:this.getViewManager(),visibilityChanged:function(t){p.fireVisibilityChanged({visible:t.getParameter("visible"),hidden:t.getParameter("hidden")})},selectionChanged:function(t){p.fireSelectionChanged({selected:t.getParameter("selected"),unselected:t.getParameter("unselected")})},outliningChanged:function(t){p.fireOutliningChanged({outlined:t.getParameter("outlined"),unoutlined:t.getParameter("unoutlined")})},opacityChanged:function(t){p.fireOpacityChanged({changed:t.getParameter("changed"),opacity:t.getParameter("opacity")})},tintColorChanged:function(t){p.fireTintColorChanged({changed:t.getParameter("changed"),tintColor:t.getParameter("tintColor"),tintColorABGR:t.getParameter("tintColorABGR")})},nodeHierarchyReplaced:function(t){p.fireNodeHierarchyReplaced({oldNodeHierarchy:t.getParameter("oldNodeHierarchy"),newNodeHierarchy:t.getParameter("newNodeHierarchy")})},viewStateApplying:function(t){p.fireViewStateApplying({view:t.getParameter("view")})},viewStateApplied:function(t){p.fireViewStateApplied({view:t.getParameter("view")})},transformationChanged:function(t){p.fireTransformationChanged(t.getParameters())},highlightColorChanged:function(t){p.fireHighlightColorChanged(t.getParameters())}});var h=n.byId(this.getViewManager());if(h){var u=n.byId(h.getAnimationPlayer());if(u){u.setViewStateManager(this._implementation)}}}}}else{this._destroyImplementation()}return this};o.prototype.getAnimationPlayer=function(){var t;var e=n.byId(this.getViewManager());if(e){t=n.byId(e.getAnimationPlayer())}return t};o.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy()};o.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges()};o.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete()};o.prototype.getVisibilityState=function(t){return this._implementation&&this._implementation.getVisibilityState(t)};o.prototype.setVisibilityState=function(t,e,i,n){if(this._implementation){this._implementation.setVisibilityState(t,e,i,n)}return this};o.prototype.resetVisibility=function(){return this._implementation&&this._implementation.resetVisibility()};o.prototype.enumerateSelection=function(t){if(this._implementation){this._implementation.enumerateSelection(t)}return this};o.prototype.enumerateOutlinedNodes=function(t){if(this._implementation&&this._implementation.enumerateOutlinedNodes){this._implementation.enumerateOutlinedNodes(t)}return this};o.prototype.setShowSelectionBoundingBox=function(t){if(this._implementation){this._implementation.setShowSelectionBoundingBox(t)}};o.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox()}};o.prototype.getSelectionState=function(t){return this._implementation&&this._implementation.getSelectionState(t)};o.prototype.setSelectionState=function(t,e,i,n){if(this._implementation){this._implementation.setSelectionState(t,e,i,n)}return this};o.prototype.setSelectionStates=function(t,e,i,n){if(this._implementation){this._implementation.setSelectionStates(t,e,i,n)}return this};o.prototype.getOutliningState=function(t){if(this._implementation&&this._implementation.getOutliningState){return this._implementation.getOutliningState(t)}else{return false}};o.prototype.setOutliningStates=function(t,e,i){if(this._implementation&&this._implementation.setOutliningStates){this._implementation.setOutliningStates(t,e,i)}return this};o.prototype.getJoints=function(){if(this._implementation&&this._implementation.getJoints){return this._implementation.getJoints()}return undefined};o.prototype.setJoints=function(t,e){if(this._implementation&&this._implementation.setJoints){this._implementation.setJoints(t,e)}return this};o.prototype.getOpacity=function(t){return this._implementation&&this._implementation.getOpacity(t)};o.prototype.setOpacity=function(t,e,i){if(this._implementation){this._implementation.setOpacity(t,e,i)}return this};o.prototype.getTotalOpacity=function(t){if(this._implementation&&this._implementation.getTotalOpacity){return this._implementation.getTotalOpacity(t)}return 1};o.prototype.setTotalOpacity=function(t,e){if(this._implementation&&this._implementation.setTotalOpacity){return this._implementation.setTotalOpacity(t,e)}return null};o.prototype.getRestOpacity=function(t){if(this._implementation&&this._implementation.getRestOpacity){return this._implementation.getRestOpacity(t)}return null};o.prototype.setRestOpacity=function(t,e){if(this._implementation&&this._implementation.setRestOpacity){this._implementation.setRestOpacity(t,e)}return this};o.prototype.restoreRestOpacity=function(t){if(this._implementation&&this._implementation.restoreRestOpacity){this._implementation.restoreRestOpacity(t)}return this};o.prototype.updateRestOpacity=function(t){if(this._implementation&&this._implementation.updateRestOpacity){this._implementation.updateRestOpacity(t)}return this};o.prototype.getTintColor=function(t,e){return this._implementation&&this._implementation.getTintColor(t,e)};o.prototype.setTintColor=function(t,e,i){if(this._implementation){this._implementation.setTintColor(t,e,i)}return this};o.prototype.setHighlightColor=function(t){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(t)}return this};o.prototype.getHighlightColor=function(t){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(t)}};o.prototype.setOutlineColor=function(t){if(this._implementation&&this._implementation.setOutlineColor){this._implementation.setOutlineColor(t)}return this};o.prototype.getOutlineColor=function(t){if(this._implementation&&this._implementation.getOutlineColor){return this._implementation.getOutlineColor(t)}else{return null}};o.prototype.setOutlineWidth=function(t){if(this._implementation&&this._implementation.setOutlineWidth){this._implementation.setOutlineWidth(t)}return this};o.prototype.getOutlineWidth=function(){if(this._implementation&&this._implementation.getOutlineWidth){return this._implementation.getOutlineWidth()}else{return 0}};o.prototype.setRecursiveOutlining=function(t){this.setProperty("recursiveOutlining",t,true);if(this._implementation&&this._implementation.setRecursiveOutlining){this._implementation.setRecursiveOutlining(t)}return this};o.prototype.setRecursiveSelection=function(t){this.setProperty("recursiveSelection",t,true);if(this._implementation){this._implementation.setRecursiveSelection(t)}return this};o.prototype.setHighlightDisplayState=function(t){if(this._implementation&&this._implementation.setHighlightDisplayState){this._implementation.setHighlightDisplayState(t)}return this};o.prototype.setTransformation=function(t,e){if(this._implementation&&this._implementation.setTransformation){this._implementation.setTransformation(t,e)}return this};o.prototype.getTransformation=function(t){if(this._implementation&&this._implementation.getTransformation){return this._implementation.getTransformation(t)}return null};o.prototype.getTransformationWorld=function(t){if(this._implementation&&this._implementation.getTransformationWorld){return this._implementation.getTransformationWorld(t)}return null};o.prototype.getRestTransformationWorld=function(t){if(this._implementation&&this._implementation.getRestTransformationWorld){return this._implementation.getRestTransformationWorld(t)}return null};o.prototype.getRestTransformationUsingJoint=function(t){if(this._implementation&&this._implementation.getRestTransformationUsingJoint){return this._implementation.getRestTransformationUsingJoint(t)}return null};o.prototype.updateNodesRestTransformation=function(t){if(this._implementation&&this._implementation.updateNodesRestTransformation){this._implementation.updateNodesRestTransformation(t)}return this};o.prototype.updateRestTransformation=function(t){if(this._implementation&&this._implementation.updateRestTransformation){this._implementation.updateRestTransformation(t)}return this};o.prototype.restoreRestTransformation=function(t){if(this._implementation&&this._implementation.restoreRestTransformation){this._implementation.restoreRestTransformation(t)}return this};o.prototype.setRestTransformation=function(t,e,i,n){if(this._implementation&&this._implementation.setRestTransformation){this._implementation.setRestTransformation(t,e,i,n)}return this};o.prototype.getRelativeTransformation=function(t){if(this._implementation&&this._implementation.getRelativeTransformation){return this._implementation.getRelativeTransformation(t)}return null};o.prototype.getRestTransformation=function(t){if(this._implementation&&this._implementation.getRestTransformation){return this._implementation.getRestTransformation(t)}return null};o.prototype.setInterpolatedRelativeValues=function(t,e){if(this._implementation&&this._implementation.setInterpolatedRelativeValues){return this._implementation.setInterpolatedRelativeValues(t,e)}return null};o.prototype._getEndPropertyInLastPlayback=function(t,e){if(this._implementation&&this._implementation._getEndPropertyInLastPlayback){return this._implementation._getEndPropertyInLastPlayback(t,e)}return null};o.prototype._getEndPropertyInPreviousPlayback=function(t,e,i){if(this._implementation&&this._implementation._getEndPropertyInPreviousPlayback){return this._implementation._getEndPropertyInPreviousPlayback(t,e,i)}return null};o.prototype._convertTracksToRelative=function(t){if(this._implementation&&this._implementation._convertTracksToRelative){this._implementation._convertTracksToRelative(t)}return this};o.prototype._setJointNodeOffsets=function(t,e){if(this._implementation&&this._implementation._setJointNodeOffsets){this._implementation._setJointNodeOffsets(t,e)}return this};o.prototype._setJointNodeMatrix=function(){if(this._implementation&&this._implementation._setJointNodeMatrix){this._implementation._setJointNodeMatrix()}return this};o.prototype._propagateOpacityToJointChildren=function(t,e){if(this._implementation&&this._implementation._propagateOpacityToJointChildren){this._implementation._propagateOpacityToJointChildren(t,e)}return this};o.prototype.setTranslationKey=function(t,e,i,n){if(this._implementation&&this._implementation.setTranslationKey){this._implementation.setTranslationKey(t,e,i,n)}return this};o.prototype.setScaleKey=function(t,e,i,n){if(this._implementation&&this._implementation.setScaleKey){this._implementation.setScaleKey(t,e,i,n)}return this};o.prototype.setRotationKey=function(t,e,i,n,o){if(this._implementation&&this._implementation.setRotationKey){this._implementation.setRotationKey(t,e,i,n,o)}return this};o.prototype.setOpacityKey=function(t,e,i,n){if(this._implementation&&this._implementation.setOpacityKey){this._implementation.setOpacityKey(t,e,i,n)}return this};o.prototype.getSymbolNodes=function(t){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(t)}return[]};o.prototype.getBackgroundImageType=function(){if(this._implementation&&this._implementation.getBackgroundImageType){return this._implementation.getBackgroundImageType()}return null};o.prototype.setBackgroundImageType=function(t){if(this._implementation&&this._implementation.setBackgroundImageType){return this._implementation.setBackgroundImageType(t)}return undefined};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewStateManagerBase", ["sap/ui/core/Element","./Core"],function(e,t){"use strict";var n=e.extend("sap.ui.vk.ViewStateManagerBase",{metadata:{library:"sap.ui.vk",abstract:true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},recursiveOutlining:{type:"boolean",defaultValue:false},features:{type:"string[]",defaultValue:[]}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},outliningChanged:{parameters:{outlined:{type:"any[]"},unoutlined:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"any"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"any"},tintColorABGR:{type:"any"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true},transformationChanged:{parameters:{changed:{type:"any"},transformation:{type:"any"}}},viewStateApplying:{parameters:{view:{type:"sap.ui.vk.View"}}},viewStateApplied:{parameters:{view:{type:"sap.ui.vk.View"}}},readyForAnimation:{parameters:{view:{type:"sap.ui.vk.View"}}},outlineColorChanged:{parameters:{outlineColor:{type:"sap.ui.core.CSSColor"},outlineColorABGR:{type:"int"}},enableEventBubbling:true},outlineWidthChanged:{parameters:{width:{type:"float"}},enableEventBubbling:true}}},constructor:function(n,a){e.apply(this,arguments);t.observeLifetime(this);t.observeAssociations(this)}});n.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};n.prototype.onUnsetContentConnector=function(e){e.detachContentReplaced(this._onContentReplaced,this);this._setContent(null)};n.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};n.prototype._setContent=function(e){return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Viewer", ["./library","sap/ui/core/Control","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","./ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./ViewerRenderer","./SelectionMode","./DrawerToolbar","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR","sap/base/Log"],function(e,t,i,n,o,s,r,a,l,h,p,c,u,g,d,v,_,f,w,y,m,S,b,V,C,T,P,R,E,N,I,A,M,D){"use strict";var F=t.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},showDrawerToolbar:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:3221225727},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},overlay:{type:"sap.ui.vk.Overlay",multiple:false},progressIndicator:{type:"sap.ui.vk.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});F.prototype.applySettings=function(e){this._inApplySettings=true;t.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());this._viewStateManager.setRecursiveSelection(this.getRecursiveSelection())}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false)};F.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._contentConnector=new o(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new v(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);D.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new S({viewStateManager:this._viewStateManager});this._viewManager=new m({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._drawerToolbar=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(e){var t=e.getParameter("pan");var i=e.getParameter("zoom");this.control.setPanAndZoom(t.x,t.y,i)},onViewportZoom:function(e){var t=e.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,t)},onViewportPan:function(e){var t=e.getParameter("dx");var i=e.getParameter("dy");this.control.setPanAndZoom(t,i,1)}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._toolbar=new _({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this._stackedViewport=new r(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new p({size:"auto",minSize:200})});this._splitter=new h(this.getId()+"-splitter",{layoutData:new sap.m.FlexItemData({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new d({visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new a(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(E().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new g({visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator)}};F.prototype.exit=function(){D.debug("sap.ui.vk.Viewer.exit() called.");if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);this._viewport.destroy();this._viewport=null}if(this._nativeViewport){this._nativeViewport.destroy();this._nativeViewport=null}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._drawerToolbar=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;if(t.prototype.exit){t.prototype.exit.apply(this)}};F.prototype._setMainScene=function(t){if(t instanceof e.Scene){if(t!==this._mainScene){this._mainScene=t;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true)}else{this.setShowSceneTree(false)}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(t,this._viewStateManager)}this.setEnableStepNavigation(this.getEnableStepNavigation()||this._componentsState.stepNavigation.defaultEnable);if(this.getEnableStepNavigation()){this._instantiateStepNavigation();this.setShowStepNavigation(this._componentsState.stepNavigation.userInteractionShow)}}if(this._stepNavigation){this._stepNavigation.refresh(t)}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false)}return this};F.prototype.getGraphicsCore=function(){return this._mainScene instanceof e.dvl.Scene?this._mainScene.getGraphicsCore():null};F.prototype.getScene=function(){return this._mainScene};F.prototype.getViewStateManager=function(){return this._viewStateManager};F.prototype.getViewport=function(){if(!this._viewport){this._viewport=new b(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:P.Exclusive,contentConnector:this._contentConnector});this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);this._drawerToolbar=new R({visible:this.getShowDrawerToolbar(),expanded:true,viewport:this._viewport});this._viewport.addContent(this._drawerToolbar)}return this._viewport};F.prototype.getNativeViewport=function(){if(this._nativeViewport){return this._nativeViewport}var t=this.getViewport().getImplementation();return t instanceof e.NativeViewport?t:null};F.prototype.getToolbar=function(){return this._toolbar};F.prototype.getSceneTree=function(){return this._sceneTree};F.prototype.getRedlineDesign=function(){return this._redlineDesign};F.prototype.getOverlay=function(){return this._overlayManager.control};F.prototype.setEnableOverlay=function(e){if(e!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",e);this._overlayManager.changed=true}return this};F.prototype.setEnableSceneTree=function(e){this.setProperty("enableSceneTree",e,true);if(!e){this.setProperty("showSceneTree",false)}this._updateLayout();return this};F.prototype.setEnableNotifications=function(e){this.setProperty("enableNotifications",e,true);this._messagePopover.setVisible(false);this._updateLayout();return this};F.prototype.setShowSceneTree=function(e){this.setProperty("showSceneTree",e,true);this._updateLayout();return this};F.prototype.setEnableStepNavigation=function(e){this.setProperty("enableStepNavigation",e,true);if(!e){this.setProperty("showStepNavigation",false)}this._updateLayout();return this};F.prototype.setShowStepNavigation=function(e){this.setProperty("showStepNavigation",e,true);this._updateLayout();return this};F.prototype.setEnableToolbar=function(e){this.setProperty("enableToolbar",e,true);this._toolbar.setVisible(e);return this};F.prototype.setShowDrawerToolbar=function(e){this.setProperty("showDrawerToolbar",e,true);if(this._drawerToolbar){this._drawerToolbar.setVisible(e)}return this};F.prototype.setRecursiveSelection=function(e){this.setProperty("recursiveSelection",e,true);if(this._viewStateManager){this._viewStateManager.setRecursiveSelection(e)}return this};F.prototype.setToolbarTitle=function(e){this.setProperty("toolbarTitle",e);this._toolbar.setTitle(e);return this};F.prototype.activateFullScreenMode=function(e){var t=function(e){return!!(e.fullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)};if(e){if(!t(document)){if(!this._fullScreenHandler){var i=this;this._fullScreenHandler=function(e){var n=t(document);if(!n){i.removeStyleClass("sapVizKitViewerFullScreen");document.removeEventListener("fullscreenchange",i._fullScreenHandler);document.removeEventListener("mozfullscreenchange",i._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",i._fullScreenHandler);document.removeEventListener("MSFullscreenChange",i._fullScreenHandler)}i.fireFullScreen({isFullScreen:n})}}var n=document.getElementsByClassName("sapVizKitViewer");var o=document.getElementsByTagName("body")[0];if(n.length){var s=this.getViewport().getDomRef();for(var r=0;r<n.length;++r){if(n[r].contains(s)){o=n[r];break}}}else{return this}if(o.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);o.requestFullScreen()}else if(o.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);o.webkitRequestFullScreen()}else if(o.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);o.mozRequestFullScreen()}else if(o.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);o.msRequestFullscreen()}}this.addStyleClass("sapVizKitViewerFullScreen")}else{if(t(document)){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}this.removeStyleClass("sapVizKitViewerFullScreen")}return this};F.prototype.getShowAllHotspots=function(){var e=this.getViewport().getImplementation();return e?e.getShowAllHotspots():this.getProperty("showAllHotspots")};F.prototype.setShowAllHotspots=function(e){this.setProperty("showAllHotspots",e,true);var t=this.getViewport().getImplementation();if(t){t.setShowAllHotspots(e)}return this};F.prototype.getHotspotColorABGR=function(){var e=this.getViewport().getImplementation();return e?e.getHotspotColorABGR():this.getProperty("hotspotColorABGR")};F.prototype.setHotspotColorABGR=function(e){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",I(A(e)),true);var t=this.getViewport().getImplementation();if(t){t.setHotspotColorABGR(e)}return this};F.prototype.getHotspotColor=function(){var e=this.getViewport().getImplementation();return e?e.getHotspotColor():this.getProperty("hotspotColor")};F.prototype.setHotspotColor=function(e){this.setProperty("hotspotColor",e,true);this.setProperty("hotspotColorABGR",M(N(e)),true);var t=this.getViewport().getImplementation();if(t){t.setHotspotColor(e)}return this};F.prototype.setRuntimeSettings=function(e){if(this._inApplySettings){this.setProperty("runtimeSettings",e,true);s.setRuntimeSettings(e)}else{D.error(E().getText(u.VIT29.summary),u.VIT29.code,"sap.ui.vk.Viewer")}return this};F.prototype.setWebGLContextAttributes=function(e){if(this._inApplySettings){this.setProperty("webGLContextAttributes",e,true);s.setWebGLContextAttributes(e)}else{D.error(E().getText(u.VIT30.summary),u.VIT30.code,"sap.ui.vk.Viewer")}return this};F.prototype.invalidate=function(e){if(e instanceof n){this._contentConnector.invalidate(e);return}t.prototype.invalidate.apply(this,arguments)};F.prototype._getContentConnector=function(){return this._contentConnector};F.prototype.onBeforeRendering=function(){this._showOverlay()};F.prototype.isTreeBinding=function(e){return e==="contentResources"};F.prototype.setBusy=function(e){if(e){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);t.prototype.setBusy.call(this,true)}this._busyIndicatorCounter+=1}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){t.prototype.setBusy.call(this,false)}}};F.prototype._updateLayout=function(){if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0)}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree)}this._sceneTree.setVisible(false)}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation())}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0)}if(this._toolbar){this._toolbar.refresh()}};F.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new f({layoutData:new p({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector})}return this};F.prototype._instantiateStepNavigation=function(){if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport.removeContent(this._stepNavigation);this._splitter.detachResize(this._handleSplitterResize,this);this._stepNavigation.destroy();this._stepNavigation=null}if(this._mainScene instanceof e.dvl.Scene){this._stepNavigation=new w({showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3)}else if(this._mainScene instanceof e.threejs.Scene||this._mainScene instanceof e.svg.Scene){this._stepNavigation=new y({host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3)}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation);this._splitter.attachResize(this._handleSplitterResize,this)}this._stepNavigation.setAnimationPlayer(this._animationPlayer)}return this};F.prototype._handleSplitterResize=function(){this._stepNavigation.resizeToolbarSpacer()};F.prototype._showViewport=function(){var e=this.getViewport().getImplementation();if(e){e.setHotspotColor(this.getProperty("hotspotColor"));e.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));e.setShowAllHotspots(this.getProperty("showAllHotspots"))}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this};F.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new V(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector})}if(this._viewport){this._viewport.setVisible(false)}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this};F.prototype._showOverlay=function(){var e=this._overlayManager;if(e.changed){var t;if(this.getEnableOverlay()){sap.ui.require(["sap/ui/vk/Overlay"],function(i){if(!e.initialized){if(!(t=this.getAggregation("overlay"))){t=new i}t.setZoomOnResize(false);e.control=t;e.initialized=true}else{t=e.control;t.reset()}if(this._nativeViewport&&this._nativeViewport.getVisible()){t.setTarget(this._nativeViewport);e.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",e.onNativeViewportMove,e)}else if(this._viewport&&this._viewport.getVisible()){t.setTarget(this._viewport);e.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",e.onViewportZoom,e);this._viewport.attachEvent("pan",e.onViewportPan,e)}this._stackedViewport.addContent(t);this._stackedViewport.addDelegate(e.delegate)}.bind(this))}else{this._nativeViewport.detachEvent("move",e.onNativeViewportMove,e);this._stackedViewport.removeDelegate(e.delegate);this._stackedViewport.removeContent(e.control);this._nativeViewport.setLimitZoomOut(e.savedLimitZoomOutState)}e.changed=false}};F.prototype._onAfterRenderingOverlay=function(e){var t=this._overlayManager.control.getDomRef();if(t&&(this._nativeViewport||this._viewport)){var i=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(t.parentNode!==i){t.parentNode.style.display="none"}i.appendChild(t);t.style.width="100%";t.style.height="100%"}};F.prototype.setDecryptionHandler=function(e){this._contentConnector.setDecryptionHandler(e);return this};F.prototype.setAuthorizationHandler=function(e){this._contentConnector.setAuthorizationHandler(e);return this};F.prototype._instantiateRedlineDesign=function(e){var t=this.getViewport().getImplementation();if(t&&t.getVisible()){var i=t&&t.getVisible()?t:null;var n=i.getOutputSize();this._redlineDesign=new C({visible:false,virtualTop:n.top,virtualLeft:n.left,virtualSideLength:n.sideLength,redlineElements:e});this._redlineDesign._setTargetViewport(i)}return this};F.prototype.activateRedlineDesign=function(t){var i=this.getViewport().getImplementation();if(i._activateRedline){i._activateRedline()}else if(i instanceof e.threejs.Viewport){i._viewportGestureHandler._activateRedline()}t=t||[];this._instantiateRedlineDesign(t);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var n=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i.pan(t,n);i.endGesture()})};var o=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),o=e.getParameter("zoomFactor");i.queueCommand(function(){i.beginGesture(t,n);i.zoom(o);i.endGesture()})};var s=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.pan(t,n);i._viewportGestureHandler._cameraController.endGesture()})};var r=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),o=e.getParameter("zoomFactor");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.zoom(o);i._viewportGestureHandler._cameraController.endGesture()})};if((i instanceof e.NativeViewport||i instanceof e.dvl.Viewport)&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",n.bind(this));this.getRedlineDesign().attachEvent("zoom",o.bind(this))}else if(i instanceof e.threejs.Viewport&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",s.bind(this));this.getRedlineDesign().attachEvent("zoom",r.bind(this))}else{D.error("Error: Viewport not supported")}return this};F.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var t=this.getViewport().getImplementation();if(t._deactivateRedline){t._deactivateRedline()}else if(t instanceof e.threejs.Viewport){t._viewportGestureHandler._deactivateRedline()}this.getRedlineDesign().destroy();this._redlineDesign=null}return this};F.prototype._onViewportViewActivated=function(e){this._componentsState.sceneTree.shouldBeEnabled=e.getParameter("type")==="3D"};F.prototype._removeProgressIndicator=function(e){setTimeout(function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0)}.bind(this),e)};F.prototype._handleContentReplaced=function(t){var i=t.getParameter("newContent");if(i instanceof e.Scene||i instanceof HTMLImageElement||i instanceof HTMLObjectElement){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio()}this._setMainScene(i)}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false)}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent()}};F.prototype._handleContentChangesStarted=function(e){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0);this._progressIndicator.setVisible(true)}};F.prototype._handleContentChangesFinished=function(e){D.info("Finished");this.setBusy(false);var t=e.getParameter("content");if(t){this.fireSceneLoadingSucceeded({scene:t})}var i=e.getParameter("failureReason");if(i){this.fireSceneLoadingFailed({reason:i});this._showNativeViewport();var n=E().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(i.errorMessage===n){this._nativeViewport.loadFailed()}else{var o=E().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(o)}(Array.isArray(i)?i:[i]).forEach(function(e){D.error(E().getText(u.VIT13.summary),e.errorMessage,"sap.ui.vk.Viewer")})}if(i||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator(0)}this.fireContentResourceChangesProcessed()};F.prototype._handleContentChangesProgress=function(e){function t(e,i){for(var n=0,o=e.length;n<o;n++){var s=e[n];var r=s.getSource();if(r===i||r instanceof File&&r.name===i){return s}s=t(s.getContentResources(),i);if(s){return s}}return null}if(this._progressIndicator.getVisible()){var i=e.getParameter("source")||"",n=e.getParameter("percentage"),o=e.getParameter("phase");var s=t(this.getContentResources(),i);if(s&&s.getName()!==undefined){i=s.getName()}else{if(i instanceof File){i=i.name}var r=i.match(/\..{3,4}$/);i=r&&r[0]?i.split(/\\|\//).pop():""}this._progressIndicator.setPercentValue(n);this._progressIndicator.setDisplayValue(i+" "+o+" / "+E().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")+": "+(n?Math.floor(n)+"%":""));if(n>=100){this._removeProgressIndicator(0)}}};F.prototype._handleContentDestroying=function(e){this.fireSceneDestroying({scene:e.getParameter("content").scene,preventGarbageCollection:e.getParameter("preventGarbageCollection")})};return F});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewerRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewer");if(t.getWidth()){e.style("width",t.getWidth())}if(t.getHeight()){e.style("height",t.getHeight())}e.openEnd();e.renderControl(t._layout);e.renderControl(t._progressIndicator);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Viewport", ["sap/base/util/ObjectPath","./ViewportBase","./ViewStateManager","./ViewportRenderer","./VisibilityMode","./RenderMode","./Scene","./Camera","sap/base/Log"],function(t,e,i,o,n,s,a,r,l){"use strict";var m=e.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",designtime:"sap/ui/vk/designtime/Viewport.designtime"}});var p=m.getMetadata().getParent().getClass().prototype;m.prototype.init=function(){if(p.init){p.init.call(this)}this._implementation=null};m.prototype.exit=function(){this._destroyImplementation();if(p.exit){p.exit.call(this)}};m.prototype.getImplementation=function(){return this._implementation};m.prototype._destroyImplementation=function(){if(this._implementation){var t=this.removeAllContent();var e=this;t.forEach(function(t){e.addAggregation("content",t)});this.setAggregation("safeArea",this._implementation.getSafeArea());this._implementation.destroy();this._implementation=null}return this};m.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo()}return p.getShowDebugInfo.call(this)};m.prototype.setShowDebugInfo=function(t){p.setShowDebugInfo.call(this,t);if(this._implementation){this._implementation.setShowDebugInfo(t)}return this};m.prototype.getAutoStartRendering=function(){if(this._implementation){return this._implementation.getAutoStartRendering()}return p.getAutoStartRendering.call(this)};m.prototype.setAutoStartRendering=function(t){p.setAutoStartRendering.call(this,t);if(this._implementation){this._implementation.setAutoStartRendering(t)}return this};m.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop()}return p.getBackgroundColorTop.call(this)};m.prototype.setBackgroundColorTop=function(t){p.setBackgroundColorTop.call(this,t);if(this._implementation){this._implementation.setBackgroundColorTop(t)}return this};m.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom()}return p.getBackgroundColorBottom.call(this)};m.prototype.setBackgroundColorBottom=function(t){p.setBackgroundColorBottom.call(this,t);if(this._implementation){this._implementation.setBackgroundColorBottom(t)}return this};m.prototype.setWidth=function(t){p.setWidth.call(this,t);if(this._implementation){this._implementation.setWidth(t)}return this};m.prototype.setHeight=function(t){p.setHeight.call(this,t);if(this._implementation){this._implementation.setHeight(t)}return this};m.prototype.setSelectionMode=function(t){this.setProperty("selectionMode",t,true);if(this._implementation){this._implementation.setProperty("selectionMode",t,true)}return this};m.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode()}return p.getSelectionMode.call(this)};m.prototype.setSelectionDisplayMode=function(t){p.setSelectionDisplayMode.call(this,t);if(this._implementation){this._implementation.setSelectionDisplayMode(t)}return this};m.prototype.getSelectionDisplayMode=function(){if(this._implementation){return this._implementation.getSelectionDisplayMode()}return p.getSelectionDisplayMode.call(this)};m.prototype.setShowSelectionBoundingBoxes=function(t){p.setShowSelectionBoundingBoxes.call(this,t);if(this._implementation){this._implementation.setShowSelectionBoundingBoxes(t)}return this};m.prototype.getShowSelectionBoundingBoxes=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBoxes()}return p.getShowSelectionBoundingBoxes.call(this)};m.prototype.setShowSafeArea=function(t){p.setShowSafeArea.call(this,t);if(this._implementation){this._implementation.setShowSafeArea(t)}return this};m.prototype.getShowSafeArea=function(){if(this._implementation){return this._implementation.getShowSafeArea()}return p.getShowSafeArea.call(this)};m.prototype.setShowAllHotspots=function(t){p.setShowAllHotspots.call(this,t);if(this._implementation){this._implementation.setShowAllHotspots(t)}return this};m.prototype.getShowAllHotspots=function(){if(this._implementation){return this._implementation.getShowAllHotspots()}return p.getShowAllHotspots.call(this)};m.prototype.setDisableHotspotHovering=function(t){p.setDisableHotspotHovering.call(this,t);if(this._implementation){this._implementation.setDisableHotspotHovering(t)}return this};m.prototype.getDisableHotspotHovering=function(){if(this._implementation){return this._implementation.getDisableHotspotHovering()}return p.getDisableHotspotHovering.call(this)};m.prototype.setHotspotColorABGR=function(t){p.setHotspotColorABGR.call(this,t);if(this._implementation){this._implementation.setHotspotColorABGR(t)}return this};m.prototype.getHotspotColorABGR=function(){if(this._implementation){return this._implementation.getHotspotColorABGR()}return p.getHotspotColorABGR.call(this)};m.prototype.setHotspotColor=function(t){p.setHotspotColor.call(this,t);if(this._implementation){this._implementation.setHotspotColor(t)}return this};m.prototype.getHotspotColor=function(){if(this._implementation){return this._implementation.getHotspotColor()}return p.getHotspotColor.call(this)};m.prototype.setKeepOutputSize=function(t){if(this._implementation&&this._implementation.setKeepOutputSize){this._implementation.setKeepOutputSize(t)}else{this.setProperty("keepOutputSize",t)}};m.prototype.getKeepOutputSize=function(){if(this._implementation&&this._implementation.getKeepOutputSize){return this._implementation.getKeepOutputSize()}return this.getProperty("keepOutputSize")};m.prototype.setShowAllHotspotsTintColor=function(t){if(this._implementation&&this._implementation.setShowAllHotspotsTintColor){this._implementation.setShowAllHotspotsTintColor(t)}else{this.setProperty("showAllHotspotsTintColor",t)}};m.prototype.getShowAllHotspotsTintColor=function(t){if(this._implementation&&this._implementation.getShowAllHotspotsTintColor){this._implementation.getShowAllHotspotsTintColor(t)}else{this.getProperty("showAllHotspotsTintColor",t)}};m.prototype.setCamera=function(t){p.setCamera.call(this,t);if(this._implementation){this._implementation.setCamera(t);return this}return this};m.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera()}return p.getCamera.call(this)};m.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame()}return this};m.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame()}};m.prototype.setRenderMode=function(t){if(this._implementation&&this._implementation.setRenderMode){this._implementation.setRenderMode(t)}return this};m.prototype.getRenderMode=function(){if(this._implementation&&this._implementation.getRenderMode){return this._implementation.getRenderMode()}return s.Default};m.prototype.setFreezeCamera=function(t){p.setFreezeCamera.call(this,t);if(this._implementation){this._implementation.setFreezeCamera(t)}return this};m.prototype.showHotspots=function(t,e,i){if(this._implementation&&this._implementation.showHotspots){this._implementation.showHotspots(t,e,i)}return this};m.prototype.addTool=function(t){this.addAssociation("tools",t);if(this._implementation){this._implementation.addTool(t)}};m.prototype.removeTool=function(t){this.removeAssociation("tools",t);if(this._implementation){this._implementation.removeTool(t)}};m.prototype.getTools=function(){if(this._implementation){return this._implementation.getTools()}return this.getAssociation("tools",[])};m.prototype.removeAllTools=function(){this.removeAllAssociation("tools");if(this._implementation){this._implementation.removeAllTools()}};m.prototype.addContent=function(t){if(this._implementation){this._implementation.addContent(t)}else{this.addAggregation("content",t)}};m.prototype.removeContent=function(t){if(this._implementation){return this._implementation.removeContent(t)}return this.removeAggregation("content",t)};m.prototype.getContent=function(){if(this._implementation){return this._implementation.getContent()}return this.getAggregation("content")};m.prototype.removeAllContent=function(){if(this._implementation){return this._implementation.removeAllContent()}return this.removeAggregation("content")};m.prototype.setOutputSettings=function(t){if(this._implementation&&this._implementation.setOutputSettings){this._implementation.setOutputSettings(t)}else{this.setAggregation("outputSettings",t)}};m.prototype.getOutputSettings=function(){if(this._implementation&&this._implementation.getOutputSettings){return this._implementation.getOutputSettings()}return this.getAggregation("outputSettings")};m.prototype.removeOutputSettings=function(){if(this._implementation){return this._implementation.removeAggregation("outputSettings")}return this.removeAggregation("outputSettings")};m.prototype.setSafeArea=function(t){if(this._implementation){this._implementation.setSafeArea(t)}else{this.setAggregation("safeArea",t)}};m.prototype.getSafeArea=function(){if(this._implementation){return this._implementation.getSafeArea()}return this.getAggregation("safeArea")};m.prototype.removeSafeArea=function(){if(this._implementation){return this._implementation.removeAggregation("safeArea")}return this.removeAggregation("safeArea")};m.prototype.addAnnotation=function(t){if(this._implementation){this._implementation.addAnnotation(t)}else{this.addAggregation("annotations",t)}};m.prototype.destroyAnnotations=function(){if(this._implementation){return this._implementation.destroyAnnotations()}return this.destroyAggregation("annotations")};m.prototype.getAnnotations=function(){if(this._implementation){return this._implementation.getAnnotations()}return this.getAggregation("annotations")};m.prototype.getSymbolNodes=function(t){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(t)}return[]};m.prototype.indexOfAnnotation=function(t){if(this._implementation){return this._implementation.indexOfAnnotation(t)}return this.indexOfAggregation("annotations",t)};m.prototype.removeAllAnnotations=function(){if(this._implementation){return this._implementation.removeAllAnnotations()}return this.removeAggregation("annotations")};m.prototype.removeAnnotation=function(t){if(this._implementation){return this._implementation.removeAnnotation(t)}return this.removeAggregation("annotations",t)};m.prototype.insertAnnotation=function(t,e){if(this._implementation){return this._implementation.insertAnnotation(t,e)}return this.insertAggregation("annotations",t,e)};m.prototype.getCurrentView=function(){if(this._implementation&&this._implementation.getCurrentView){return this._implementation.getCurrentView()}return null};m.prototype.pan=function(t,e){if(this._implementation&&this._implementation.pan){this._implementation.pan(t,e)}};m.prototype.rotate=function(t,e){if(this._implementation&&this._implementation.rotate){this._implementation.rotate(t,e)}};m.prototype.zoom=function(t){if(this._implementation&&this._implementation.zoom){this._implementation.zoom(t)}};m.prototype._setContent=function(t){p._setContent.apply(this,arguments);if(t instanceof HTMLImageElement||t instanceof HTMLObjectElement){this._setImage(t);return this}var e=null;var i=null;if(t){e=t;if(!(e instanceof a)){e=null}i=t.camera;if(!(i instanceof r)){i=null}}this._setScene(e);if(i){this.setCamera(i)}return this};m.prototype._setImage=function(e){var i="sap.ui.vk.NativeViewport";if(!this._implementation||this._implementation.getMetadata().getName()!==i){this._destroyImplementation();var o=t.get(i);this._implementation=new o({tools:this.getAssociation("tools"),content:this.getContent(),contentConnector:this.getAssociation("contentConnector")});this._implementation.setParent(this);this.invalidate()}return this};m.prototype._setScene=function(e){if(e instanceof a){var i=e.getMetadata().getName(),o=this._implementation&&this._implementation.getMetadata().getName(),n=i==="sap.ui.vk.dvl.Scene"&&o==="sap.ui.vk.dvl.Viewport"||i==="sap.ui.vk.threejs.Scene"&&o==="sap.ui.vk.threejs.Viewport"||i==="sap.ui.vk.svg.Scene"&&o==="sap.ui.vk.svg.Viewport";if(!n){this._destroyImplementation();var s;var r=this.getCamera();if(i==="sap.ui.vk.dvl.Scene"){s="sap.ui.vk.dvl.Viewport"}else if(i==="sap.ui.vk.threejs.Scene"){s="sap.ui.vk.threejs.Viewport"}else if(i==="sap.ui.vk.svg.Scene"){s="sap.ui.vk.svg.Viewport"}if(s){var l=t.get(s);this._implementation=new l({viewStateManager:this.getViewStateManager(),tools:this.getAssociation("tools"),content:this.getContent(),outputSettings:this.getOutputSettings(),safeArea:this.getSafeArea(),showSafeArea:this.getShowSafeArea(),showAllHotspots:this.getShowAllHotspots(),showAllHotspotsTintColor:this.getShowAllHotspotsTintColor(),disableHotspotHovering:this.getDisableHotspotHovering(),hotspotColorABGR:this.getHotspotColorABGR(),keepOutputSize:this.getKeepOutputSize(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),selectionDisplayMode:this.getSelectionDisplayMode(),showSelectionBoundingBoxes:this.getShowSelectionBoundingBoxes(),freezeCamera:this.getFreezeCamera(),renderMode:this.getRenderMode(),autoStartRendering:this.getAutoStartRendering()});this._implementation.setContentConnector(this.getContentConnector());var m=this.getAggregation("annotations");if(m){m.forEach(function(t){this.removeAggregation("annotations",t);this._implementation.addAnnotation(t)},this)}if(r){this._camera=null;this._implementation.setCamera(r)}this._implementation.setParent(this)}this.invalidate()}}else{this._destroyImplementation();this.invalidate()}return this};m.prototype.onSetViewStateManager=function(t){if(this._implementation){this._implementation.setViewStateManager(t)}};m.prototype.onUnsetViewStateManager=function(t){if(this._implementation){this._implementation.setViewStateManager(null)}};m.prototype.activateView=function(t,e,i){if(this._implementation){this._implementation.activateView(t,e,i);return this}else{l.error("no implementation");return this}};m.prototype.resetCurrentView=function(){if(this._implementation&&this._implementation.resetCurrentView){this._implementation.resetCurrentView();return this}else{l.error("no implementation");return this}};m.prototype.zoomTo=function(t,e,i,o){if(this._implementation){this._implementation.zoomTo(t,e,i,o)}else{l.error("zoomTo: no implementation")}return this};m.prototype.tap=function(t,e,i){if(this._implementation){this._implementation.tap(t,e,i)}return this};m.prototype.tapObject=function(t){if(this._implementation&&this._implementation.tapObject){this._implementation.tapObject(t)}return this};var h=function(t){t.camera={}};var u=function(t){if(typeof t.camera==="object"&&t.camera!==null){t.camera.matrices=false}};var f=function(t){if(typeof t.camera==="object"&&t.camera!==null){t.camera.useTransitionCamera=false}};var g=function(t){t.animation=true};var c=function(t){t.visibility=false};var _=function(t){if(typeof t.visibility==="object"&&t.visibility!==null){t.visibility.mode=n.Complete}};var d=function(t){t.selection=false};m.prototype.getViewInfo=function(t){if(!this._implementation){l.error("no implementation");return null}var e={};if(typeof t!=="object"||t===null){h(e);u(e);f(e);g(e);c(e);_(e);d(e)}else{if(typeof t.camera==="object"&&t.camera!==null){e.camera={};if(typeof t.camera.matrices==="boolean"){e.camera.matrices=t.camera.matrices}else if("matrices"in t.camera){e.camera.matrices=false}else{u(e)}if(typeof t.camera.useTransitionCamera==="boolean"){e.camera.useTransitionCamera=t.camera.useTransitionCamera}else if("useTransitionCamera"in t.camera){e.camera.useTransitionCamera=false}else{f(e)}}else if(typeof t.camera==="boolean"){if(t.camera===true){e.camera={};u(e);f(e)}else{e.camera=false}}else if("camera"in t){e.camera=false}else{h(e);u(e);f(e)}if(typeof t.animation==="boolean"){e.animation=t.animation}else if("animation"in t){e.animation=false}else{g(e)}if(typeof t.visibility==="object"&&t.visibility!==null){e.visibility={};if(t.visibility.mode===n.Complete||t.visibility.mode===n.Differences){e.visibility.mode=t.visibility.mode}else{_(e)}}else if(typeof t.visibility==="boolean"){if(t.visibility===true){e.visibility={};_(e)}else{e.visibility=false}}else if("visibility"in t){e.visibility=false}else{c(e);_(e)}if(typeof t.selection==="boolean"){e.selection=t.selection}else if("selection"in t){e.selection=false}else{d(e)}}return this._implementation.getViewInfo(e)};m.prototype.setViewInfo=function(t,e){if(this._implementation){this._implementation.setViewInfo(t,e)}else{l.error("no implementation")}return this};m.prototype.getImage=function(t,e,i,o,n){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(t,e,i,o,n)}return null};m.prototype.projectToScreen=function(t,e,i,o){if(this._implementation&&this._implementation.projectToScreen){return this._implementation.projectToScreen(t,e,i,o)}return p.projectToScreen(t,e,i,o)};m.prototype.normalizeRectangle=function(t,e,i,o){if(this._implementation&&this._implementation.normalizeRectangle){return this._implementation.normalizeRectangle(t,e,i,o)}return p.normalizeRectangle(t,e,i,o)};m.prototype.deNormalizeRectangle=function(t,e,i,o){if(this._implementation&&this._implementation.deNormalizeRectangle){return this._implementation.deNormalizeRectangle(t,e,i,o)}return p.deNormalizeRectangle(t,e,i,o)};m.prototype.getMeasurementSurface=function(){var t=this._implementation;return t==null?null:t.getMeasurementSurface()};return m});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportBase", ["sap/ui/core/Control","sap/ui/core/Core","./tools/Tool","./library","./Core","./SelectionMode","./SelectionDisplayMode","./RenderMode","./SafeArea"],function(e,t,n,a,i,o,r,l,s){"use strict";var u=e.extend("sap.ui.vk.ViewportBase",{metadata:{library:"sap.ui.vk",abstract:true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(50, 50, 50, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:o.Sticky},selectionDisplayMode:{type:"sap.ui.vk.SelectionDisplayMode",defaultValue:r.Highlight},showSelectionBoundingBoxes:{type:"boolean",defaultValue:true},freezeCamera:{type:"boolean",defaultValue:false},renderMode:{type:"sap.ui.vk.RenderMode",defaultValue:l.Default},showSafeArea:{type:"boolean",defaultValue:false},showAllHotspots:{type:"boolean",defaultValue:false},disableHotspotHovering:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:1493172411},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(89, 0, 0, 0.73)"},keepOutputSize:{type:"boolean",defaultValue:false},showAllHotspotsTintColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 0, .35)"},autoStartRendering:{type:"boolean",defaultValue:true}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false},tools:{type:"sap.ui.vk.tools.Tool",multiple:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true},safeArea:{type:"sap.ui.vk.SafeArea",multiple:false},annotations:{type:"sap.ui.vk.Annotation",multiple:true},outputSettings:{type:"sap.ui.vk.OutputSettings",multiple:false}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},resize:{parameters:{size:"object"},enableEventBubbling:true},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true},nodeZoomed:{parameters:{zoomed:{type:"any"},isZoomIn:{type:"boolean"}},enableEventBubbling:true},viewActivated:{parameters:{viewIndex:"int",view:"sap.ui.vk.View",type:{type:"string"}},enableEventBubbling:true},procedureFinished:{enableEventBubbling:true},viewFinished:{parameters:{viewIndex:"int"},enableEventBubbling:true}}},constructor:function(t,n){e.apply(this,arguments);i.observeAssociations(this)}});var p=u.getMetadata().getParent().getClass().prototype;u.prototype.init=function(){if(p.init){p.init.call(this)}if(this.getSafeArea()==null){this.setSafeArea(new s)}this._camera=null};u.prototype.exit=function(){if(this._camera){var e=t.byId(this.getContentConnector());if(e){var n=e.getContentManager();if(n){n.destroyCamera(this._camera)}this._camera=null}}if(p.exit){p.exit.call(this)}};u.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};u.prototype.onUnsetContentConnector=function(e){e.detachContentReplaced(this._onContentReplaced,this);this._setContent(null);this.setCamera(null)};u.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};u.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){var n=t.byId(this.getContentConnector());if(n){var a=n.getDefaultViewStateManager();if(a){this.setViewStateManager(a)}}}return this};u.prototype.addTool=function(e){this.addAssociation("tools",e);e=e instanceof n?e:t.byId(e);e.setViewport(this)};u.prototype.getImage=function(e,t){return null};u.prototype.stickySelectionHandler=function(e){if(this._viewStateManager==null){return}if(e.length===0){var t=[];if(this.getSelectionDisplayMode()===r.Outline){this._viewStateManager.enumerateOutlinedNodes(function(e){t.push(e)});if(t.length>0){this._viewStateManager.setOutliningStates([],t)}}else{this._viewStateManager.enumerateSelection(function(e){t.push(e)});if(t.length>0){this._viewStateManager.setSelectionStates([],t)}}}else{var n=[];var a=[];var i,o;if(this.getSelectionDisplayMode()===r.Outline){i=this._viewStateManager.getOutliningState(e);for(o=0;o<i.length;o++){if(i[o]){a.push(e[o])}else{n.push(e[o])}}this._viewStateManager.setOutliningStates(n,a)}else{i=this._viewStateManager.getSelectionState(e);for(o=0;o<i.length;o++){if(i[o]){a.push(e[o])}else{n.push(e[o])}}this._viewStateManager.setSelectionStates(n,a)}}};u.prototype.exclusiveSelectionHandler=function(e){if(this._viewStateManager==null){return}var t=true;if(e.length===1){t=!this._viewStateManager.getSelectionState(e[0])}else if(e.length>1){var n;if(this.getSelectionDisplayMode()===r.Outline){n=this._viewStateManager.getOutliningState(e)}else{n=this._viewStateManager.getSelectionState(e)}for(var a=0;a<n.length;a++){if(n[a]){t=false;break}}}var i=[];if(e.length===0||t){if(this.getSelectionDisplayMode()===r.Outline){this._viewStateManager.enumerateOutlinedNodes(function(e){i.push(e)})}else{this._viewStateManager.enumerateSelection(function(e){i.push(e)})}}if(this.getSelectionDisplayMode()===r.Outline){this._viewStateManager.setOutliningStates(e,i)}else{this._viewStateManager.setSelectionStates(e,i)}};u.prototype.setCamera=function(e){if(e!==this._camera){var n=t.byId(this.getContentConnector());if(this._camera&&n){var a=n.getContentManager();if(a){a.destroyCamera(this._camera)}}}this._camera=e;return this};u.prototype.getCamera=function(){return this._camera};u.prototype.activateView=function(e,t,n){return this};u.prototype.pan=function(e,t){return this};u.prototype.rotate=function(e,t){return this};u.prototype.zoom=function(e){return this};u.prototype.projectToScreen=function(e,t,n,a){return{x:0,y:0,depth:0}};u.prototype.normalizeRectangle=function(e,t,n,a){return{x:0,y:0,width:0,height:0}};u.prototype.deNormalizeRectangle=function(e,t,n,a){return{x:0,y:0,width:0,height:0}};u.prototype.renderTools=function(e){var n=this.getTools();for(var a=0,i=n.length;a<i;a++){var o=t.byId(n[a]);var r=o.getGizmoForContainer(this);if(r&&r.hasDomElement()){e.renderControl(r)}}};u.prototype.renderContent=function(e){var t=this.getContent();for(var n=0,a=t.length;n<a;n++){e.renderControl(t[n])}};u.prototype.getMeasurementSurface=function(){return null};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportHandler", ["sap/ui/base/EventProvider","sap/base/Log"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.ViewportHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._viewport=t;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){if(this._rect==null||true){var e=this._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.hover=function(t){if(this._viewport.hover&&this._inside(t)){this._viewport.queueCommand(function(){this._viewport.hover(t.x-this._rect.x,t.y-this._rect.y)}.bind(this));t.handled=true}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._gesture=true;var i=t.x-this._rect.x,s=t.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=i;this._evt.y=s;this._evt.d=t.d;this._evt.initd=t.d;this._evt.avgd=t.d;this._evt.avgx=0;this._evt.avgy=0;e.debug("Loco: beginGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.beginGesture(i,s)}.bind(this));t.handled=true;if(document.activeElement){try{document.activeElement.blur()}catch(t){}}var n=document.getElementById(this._viewport.getIdForLabel());n.focus()}this._nomenu=false};i.prototype.move=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;var n=i-this._evt.x;var o=s-this._evt.y;var r=t.d-this._evt.d;this._evt.tdx=this._evt.tdx+n;this._evt.tdy=this._evt.tdy+o;this._evt.tdd=this._evt.tdd+r;this._evt.x=i;this._evt.y=s;this._evt.d=t.d;this._evt.avgx=this._evt.avgx*.99+n*.01;this._evt.avgy=this._evt.avgy*.99+o*.01;var h=1;if(this._evt.initd>0){h=1+r*(1/this._evt.initd)}else if(t.n==2){if(t.points[0].y>t.points[1].y){h=1-r*.005;if(h<.333){h=.333}}else{h=1+r*.005;if(h>3){h=3}}}if(this._evt.initd>0){var d=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);e.debug("AvgDist: "+d);if(Math.abs(t.d-this._evt.avgd)/this._evt.avgd<d/10){h=1}}this._evt.avgd=this._evt.avgd*.97+t.d*.03;this._evt.n=t.n;switch(t.n){case 1:e.debug("Loco: Rotate: "+n+", "+o);this._viewport.queueCommand(function(){this._viewport.rotate(n,o)}.bind(this));break;case 2:e.debug("Loco: Pan: "+n+", "+o);if(h!=0&&h!=1){e.debug("Loco: Zoom: "+h)}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(n,o)}if(n<10&&o<10&&h!=0&&h!=1&&this._evt.tdd!==0){this._viewport.zoom(h)}}.bind(this));break;default:break}this._nomenu=true;t.handled=true}};i.prototype.endGesture=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: endGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.endGesture()}.bind(this));this._gesture=false;t.handled=true}};i.prototype.click=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: click: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,false)}.bind(this));t.handled=true}};i.prototype.doubleClick=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: doubleClick: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,true)}.bind(this));t.handled=true}};i.prototype.contextMenu=function(t){if(this._inside(t)||this._nomenu||t.buttons==5){this._nomenu=false;t.handled=true}};i.prototype.keyEventHandler=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");if(t._implementation){e.attr("tabindex",-1)}else{e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure")}var i=t.getWidth();if(i){e.style("width",i)}var n=t.getHeight();if(n){e.style("height",n)}e.openEnd();if(t._implementation){e.renderControl(t._implementation)}else if(t.getContent()){var r=t.getContent();for(var a=0,o=r.length;a<o;a++){e.renderControl(r[a])}}e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/VisibilityMode", [],function(){"use strict";var e={Complete:"complete",Differences:"differences"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ZoomTo", [],function(){"use strict";var e={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/abgrToColor", [],function(){"use strict";var e=function(e){return{red:e&255,green:e>>>8&255,blue:e>>>16&255,alpha:(e>>>24&255)/255}};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/colorToABGR", [],function(){"use strict";var e=function(e){return(e.alpha*255<<24|e.blue<<16|e.green<<8|e.red)>>>0};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/colorToCSSColor", [],function(){"use strict";var e=function(e){return"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/cssColorToColor", [],function(){"use strict";var e=function(){var e=false;var r=document.createElement("div");r.id="sap.ui.vk.colorConverter";r.style.setProperty("display","none","important");return function(t){if(!e){if(document.body){document.body.appendChild(r);e=true}else{return{red:0,green:0,blue:0,alpha:1}}}r.style.setProperty("color","rgba(0, 0, 0, 0)","important");r.style.setProperty("color",t,"important");var n=window.getComputedStyle(r).color;if(n==="transparent"){return{red:0,green:0,blue:0,alpha:0}}else{var a=n.split("(")[1].split(")")[0].split(",");return{red:parseInt(a[0],10),green:parseInt(a[1],10),blue:parseInt(a[2],10),alpha:a.length===4?parseFloat(a[3]):1}}}}();return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/BaseNodeProxy", ["../BaseNodeProxy","./getJSONObject"],function(e,t){"use strict";var d=e.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});d.prototype.init=function(e,t){this._dvl=e?e.getGraphicsCore()._getDvl():null;this._dvlSceneRef=e?e.getSceneRef():null;this._dvlNodeRef=t};d.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null};d.prototype.getNodeRef=function(){return this._dvlNodeRef};d.prototype.getNodeId=function(){return this._dvlNodeRef};d.prototype.getName=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName};d.prototype.getNodeMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata};d.prototype.getHasChildren=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN};d.prototype.getSceneRef=function(){return this._dvlNodeRef};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ContentManager", ["../ContentManager","../getResourceBundle"],function(e,t){"use strict";var r=e.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk"}});var n=r.getMetadata().getParent().getClass().prototype;r.prototype.init=function(){if(n.init){n.init.call(this)}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[]};r.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null}if(n.exit){n.exit.call(this)}};var o={},i={antialias:true,alpha:true,premultipliedAlpha:true};r.getRuntimeSettings=function(){return o};r.setRuntimeSettings=function(e){o=e};r.getWebGLContextAttributes=function(){return i};r.setWebGLContextAttributes=function(e){i=Object.assign(i,e)};r.prototype._getGraphicsCore=function(){var e=this;return new Promise(function(t,r){if(e._graphicsCore){t(e._graphicsCore)}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(r){r.create(o,i).then(function(r){e._graphicsCore=r;e._graphicsCore.attachSceneLoadingStarted(e._handleDvlSceneLoadingStarted,e);e._graphicsCore.attachSceneLoadingFinished(e._handleDvlSceneLoadingFinished,e);e._graphicsCore.attachSceneLoadingProgress(e._handleDvlSceneLoadingProgress,e);t(e._graphicsCore)})})}})};r.prototype._handleDownloadingProgress=function(e){var r=e.getParameter("source"),n=e.getParameter("loaded"),o=e.getParameter("total"),i=o?n/o*50:0;this.fireContentChangesProgress({phase:t().getText("PROGRESS_INDICATOR_DOWNLOADING"),source:r,percentage:i})};r.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:t().getText("PROGRESS_INDICATOR_RENDERING"),source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50})};r.prototype._handleDvlSceneLoadingStarted=function(e){};r.prototype._handleDvlSceneLoadingFinished=function(e){};r.prototype.loadContent=function(e,t){this.fireContentChangesStarted();var r=this;this._getGraphicsCore().then(function(n){n.setDecryptionHandler(r._decryptionHandler);n.setAuthorizationHandler(r._authorizationHandler);n.setRetryCount(r._retryCount);n.loadContentResourcesAsync(t,function(o){var i=[];if(o){o.forEach(function(e){i.push({error:e,errorMessage:"Failed to download source '"+(e.source instanceof File?e.source.name:e.source)+"'."})})}var a=e?e:undefined;n.updateSceneTreeAsync(a,t).then(function(e){var t={content:e.scene};if(e.failureReason){i=i.concat(e.failureReason)}if(i.length>0){t.failureReason=i}sap.ui.require(["sap/ui/vk/dvl/Viewport","sap/ui/vk/dvl/ViewStateManager"],function(){r.fireContentChangesFinished(t)})}).catch(function(e){if(typeof e==="string"){i.push({error:e,errorMessage:e})}else{i.push({error:e,errorMessage:e.message?e.message:e.errorMessage})}r.fireContentChangesFinished({content:null,failureReason:i})})},r._handleDownloadingProgressProxy)},function(e){r.fireContentChangesFinished({content:null,failureReason:{error:e,errorMessage:"Failed to create DVL graphics core object."}})});return this};r.prototype.destroyContent=function(e){if(e){this._graphicsCore.destroyScene(e)}return this};r.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/GraphicsCore", ["sap/ui/base/EventProvider","../thirdparty/html2canvas","../ve/dvl","./Scene","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages","sap/ui/thirdparty/URI","./GraphicsCoreApi","./checkResult","./getPointer","./getJSONObject","../getResourceBundle","../utf8ArrayBufferToString","sap/base/assert","sap/base/util/uid","sap/base/Log","sap/ui/core/Core"],function(e,t,r,n,o,s,i,a,c,u,d,l,h,v,f,p,_,g,y,S){"use strict";function m(e){return e instanceof File?"local":"remote"}function w(e){return e instanceof File?e.name:e}var C=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}})};C.prototype.isInUse=function(){return this._refCount>0};C.prototype.addRef=function(){++this._refCount;return this};C.prototype.release=function(){--this._refCount;_(this._refCount>=0,"Too many calls to SourceDatum.release().");return this};C.prototype.destroy=function(){};var D=function(e,t,r){C.call(this,e);Object.defineProperties(this,{content:{value:r,writable:false,enumerable:true},vdsSourceDatum:{value:t,writable:false,enumerable:true}})};D.prototype=Object.create(C.prototype);D.prototype.constructor=D;D.prototype.destroy=function(){_(this.vdsSourceDatum,"VDSL source without VDS reference");if(this.vdsSourceDatum){this.vdsSourceDatum.release()}C.prototype.destroy.call(this)};var R=function(e,t,r){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:t,writable:false,enumerable:true},root:{value:!!r,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}})};R.prototype.isInUse=function(){return this._refCount>0};R.prototype.addRef=function(){++this._refCount;return this};R.prototype.release=function(){--this._refCount;_(this._refCount>=0,"Too many calls to DvlSceneDatum.release().");return this};R.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release()}};var L=function(e,t){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new L(e)})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!t},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this};L.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release()}};var I=function(e,t){Object.defineProperties(this,{vkScene:{value:e},shadowContentResource:{value:t}})};var P=e.extend("sap.ui.vk.dvl.GraphicsCore",{metadata:{library:"sap.ui.vk",publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},constructor:function(t,r){e.apply(this);var n=jQuery.extend({},t,{filePackagePrefixURL:sap.ui.require.toUrl("sap/ui/vk/ve")+"/"});this._dvlClientId=g();var o=this;this._initialized=new Promise(function(e){o._initResolve=e});sap.ve.dvl.createRuntime(n).then(function(e){o._dvl=e;o._dvl.CreateCoreInstance(o._dvlClientId);l(o._dvl.Core.Init(o._DVLMajorVersion,o._DVLMinorVersion));var t=S;t.attachLocalizationChanged(o._onlocalizationChanged,o);l(o._dvl.Core.SetLocale(t.getConfiguration().getLanguageTag()));o._canvas=o._createRenderingCanvasAndContext(r);o._rendererId=h(o._dvl.Core.CreateRenderer());o._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,o._rendererId);o._initResolve()});this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoop=this._renderLoop.bind(this);this._viewStateManagers=[];this._authorizationHandler=null;this._retryCount=1},_DVLMajorVersion:7,_DVLMinorVersion:6});P.create=function(e,t){return new Promise(function(r,n){try{var o=new P(e,t);o._initialized.then(function(){r(o)})}catch(e){n(e)}})};P.prototype.destroy=function(){S.detachLocalizationChanged(this._onlocalizationChanged,this);var t=this._viewports.slice();t.reverse();t.forEach(function(e){e.control.setGraphicsCore(null)});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();_(this._dvlSceneData.length===0,"Not all DVL scenes are destroyed when sap.ui.vk.dvl.Scene objects are destroyed.");this._dvlSceneData=null;this._cleanupSourceData();_(this._sourceData.length===0,"Not all sources are deleted.");this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;e.prototype.destroy.apply(this)};P.prototype._createRenderingCanvasAndContext=function(e){var t=document.createElement("canvas");t.id=g();this._webGLContext=this._dvl.Core.CreateWebGLContext(t,e);return t};P.prototype._getCanvas=function(){return this._canvas};P.prototype._getWebGLContext=function(){return this._webGLContext};P.prototype._getDvl=function(){return this._dvl};P.prototype._getDvlClientId=function(){return this._dvlClientId};P.prototype._findSourceData=function(e){var t=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._destroySourceDatum=function(e){if(!(e instanceof D)){this._dvl.Core.DeleteFileByUrl(w(e.source),m(e.source))}e.destroy();return this};P.prototype._cleanupSourceData=function(){var e=false;for(var t=this._sourceData.length-1;t>=0;--t){var r=this._sourceData[t];if(!r.isInUse()){var n=r instanceof D?r.vdsSourceDatum:null;this._sourceData.splice(t,1);this._destroySourceDatum(r);if(n&&!n.isInUse()){e=true}}}if(e){this._cleanupSourceData()}return this};P.prototype._findDvlSceneData=function(e){var t=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this};P.prototype._cleanupDvlSceneData=function(){for(var e=this._dvlSceneData.length-1;e>=0;--e){var t=this._dvlSceneData[e];if(!t.isInUse()){this._dvlSceneData.splice(e,1);this._destroyDvlSceneDatum(t)}}};P.prototype._findVkSceneData=function(e){var t=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._cleanupVkSceneData=function(){for(var e=this._vkSceneData.length-1;e>=0;--e){this.destroyScene(this._vkSceneData[e].vkScene)}};P.prototype._destroyShadowContentResource=function(e,t){if(t.children){t.children.forEach(this._destroyShadowContentResource.bind(this,e))}if(t.nodeProxy){var r=e.getDefaultNodeHierarchy();try{r.removeNode(t.nodeProxy.getNodeRef())}catch(e){var n="Failed to delete node with ID = "+t.nodeProxy.getNodeRef()+".";if(e instanceof a){n+=" Error code: "+e.code+". Message: "+e.message+"."}y.error(n)}r.destroyNodeProxy(t.nodeProxy)}t.destroy()};P.prototype._filterContentResources=function(e,t){var r=[];e.forEach(function e(n){if(t(n)){r.push(n)}n.getContentResources().forEach(e)});return r};P.prototype._getContentResourcesWithMissingPasswords=function(e){var t=this._dvl.Library;return this._filterContentResources(e,function(e){var r=e.getSource();try{return r&&v(t.RetrieveInfo(w(r),m(r))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED&&!e.getPassword()}catch(e){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(r)+"'");return false}})};P.prototype._getContentResourcesWithEncryptedVds3=function(e){var t=this._dvl.Library;return this._filterContentResources(e,function(e){var r=e.getSource();if(r){try{var n=v(t.RetrieveInfo(w(r),m(r)));return n.major<=3&&n.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED}catch(e){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(r)+"'");return false}}else{return false}})};P.prototype._collectAndCheckSourceProperties=function(e){var t=e.dvlSceneDatum.sourceDatum;if(!t){return this}try{if(t instanceof D){t=t.vdsSourceDatum}var r=v(this._dvl.Library.RetrieveInfo(w(t.source),m(t.source)));e.sourceProperties={version:{major:r.major,minor:r.minor}};if(r.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){e.sourceProperties.compressed=true}if(r.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){e.sourceProperties.encrypted=true}}catch(t){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(e.source)+"'")}return this};P.prototype.loadContentResourcesAsync=function(e,t,r){var n=this,o=[],i=new Map;e.forEach(function e(t){var r=t.getSource();if(r&&o.indexOf(r)<0&&n._findSourceData({source:r}).length===0){o.push(r);var s=t.getSource();var a;if(s instanceof Object){a=s.name}else{a=s}if(t.getSourceType()==="vdsl"||t.getSourceType()==="vds"&&a.split(".").pop()==="vdsl"){i.set(r,{})}}t.getContentResources().forEach(e)});var a=[];if(o.length>0){var d;var l=new s(o,null,this._authorizationHandler,this._retryCount).attachItemSucceeded(function(e){var t=e.getParameter("source");var r=e.getParameter("response");if(i.has(t)){var n=p(r);if(n.trim().length===0){d=d||[];d.push({source:t,status:c.VIT22.code,statusText:f().getText(c.VIT22.summary)});y.error(f().getText(c.VIT22.summary),c.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var s=n.split(/\n|\r\n/);var h=s[0].match(/^file=(.+)$/);if(!h){d=d||[];d.push({source:t,status:c.VIT23.code,statusText:f().getText(c.VIT23.summary)});y.error(f().getText(c.VIT23.summary),c.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var v=i.get(t);v.content=s;var _=h[1];var g=_;var S=new u(g);if(S.is("relative")){if(t instanceof File){d=d||[];d.push({source:t,status:c.VIT24.code,statusText:f().getText(c.VIT24.summary)});y.error(f().getText(c.VIT24.summary),c.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var w=new u(t);_=S.absoluteTo(w).href()}}v.referencedSource=_;v.content[0]=v.content[0].replace(g,this._dvl.Core.GetFilename(v.referencedSource,"remote"));if(o.indexOf(v.referencedSource)<0&&this._findSourceData({source:v.referencedSource}).length===0){o.push(v.referencedSource);l.queue(v.referencedSource)}}}}else{var D=t instanceof File;var R=D?t.name:t;var L=m(t);this._dvl.Core.CreateFileFromArrayBuffer(r,R,L);a.push(new C(t))}},this).attachAllItemsCompleted(function(e){Array.prototype.push.apply(this._sourceData,a);i.forEach(function(e,t){var r=this._findSourceData({source:e.referencedSource})[0];if(r){var n=new D(t,r,e.content.join("\n"));this._sourceData.push(n);r.addRef()}}.bind(this));if(t){t(d)}},this).attachItemFailed(function(e){d=d||[];d.push({source:e.getParameter("source"),status:e.getParameter("status"),statusText:e.getParameter("statusText")})},this);if(r){l.attachItemProgress(r,this)}l.start()}else if(t){t()}return this};P.prototype._buildPlaceholders=function(e,t,r,n){var o=[];n.forEach(function t(r,n,s){var i=e.createNode(r,s.name,n);s.nodeProxy=e.createNodeProxy(i);if(s.localMatrix){s.nodeProxy.setLocalMatrix(s.localMatrix)}if(s.source){o.push(s)}s.children.forEach(t.bind(this,i,null))}.bind(this,t,r));return o};P.prototype._updatePlaceholders=function(e,t,r){var n=this,o=e.getDefaultNodeHierarchy(),s=[];(function t(r,i,a){function c(e,t){if(!e&&!t){return true}else if(!!e^!!t){return false}else{return e.source===t.getSource()&&e.sourceType===t.getSourceType()&&e.name===t.getName()&&e.password===t.getPassword()}}function u(e,t){t._shadowContentResource=e;e.sourceId=t.getSourceId();e.localMatrix=t.getLocalMatrix();if(e.nodeProxy){e.nodeProxy.setLocalMatrix(e.localMatrix)}}var d=0;var l=jQuery.sap.arrayDiff(r,i,c,true);l.forEach(function(c){for(;d<c.index;++d){t(r[d].children,i[d].getContentResources(),r[d].nodeProxy.getNodeRef());u(r[d],i[d])}if(c.type==="delete"){n._destroyShadowContentResource(e,r[c.index]);r.splice(c.index,1)}else if(c.type==="insert"){var l;if(d<r.length&&r[d].nodeProxy){l=r[d].nodeProxy.getNodeRef()}var h=new L(i[c.index]);s=s.concat(n._buildPlaceholders(o,a,l,[h]));r.splice(c.index,0,h);++d}});for(;d<r.length;++d){t(r[d].children,i[d].getContentResources(),r[d].nodeProxy&&r[d].nodeProxy.getNodeRef());u(r[d],i[d])}})(t.fake?t.children:[t],r,null);return s};P.prototype._loadAndMergeContentResource=function(e,t){if(t.source){var r=this._findSourceData({source:t.source})[0];if(!r){y.warning("Failed to load content resource with sourceId '"+t.sourceId+"' due to failed downloading from URL '"+w(t.source)+"'.")}else{var n=t.nodeProxy.getNodeRef();var o=this._findDvlSceneData({sourceDatum:r,root:false})[0];if(!o){try{o=new R(h(r instanceof D?this._dvl.Core.LoadSceneFromVDSL(r.content,t.password):this._dvl.Core.LoadSceneByUrl(w(t.source),t.password,m(t.source))),r,false)}catch(e){y.error(f().getText(c.VIT34.summary)+": "+w(t.source),c.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return}this._dvlSceneData.push(o);r.addRef()}t.dvlSceneDatum=o;o.addRef();this._collectAndCheckSourceProperties(t);this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,this._rendererId);this._dvl.Scene.Merge(e._dvlSceneRef,o.dvlSceneId,n)}}};P.prototype.buildSceneTree=function(e){if(e.length===0){return null}var t;var r;var s=e.map(function(e){return new L(e)});if(s.length===1&&s[0].name==null){r=s[0];if(r.source){var i=this._findSourceData({source:r.source})[0];try{t=new R(h(i instanceof D?this._dvl.Core.LoadSceneFromVDSL(i.content,r.password):this._dvl.Core.LoadSceneByUrl(w(r.source),r.password,m(r.source))),i,true)}catch(e){y.error(f().getText(c.VIT34.summary)+": "+w(r.source),c.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null}i.addRef()}else{t=new R(this._dvl.Core.CreateEmptyScene(),null,true)}}else{var a=new o({sourceType:"vds",sourceId:g()});r=new L(a,true);a.destroy();a=null;Array.prototype.push.apply(r.children,s);s=[r];t=new R(this._dvl.Core.CreateEmptyScene(),null,true)}this._dvlSceneData.push(t);r.dvlSceneDatum=t;t.addRef();this._collectAndCheckSourceProperties(r);var u=new n(this,t.dvlSceneId);this._vkSceneData.push(new I(u,r));this._buildPlaceholders(u.getDefaultNodeHierarchy(),null,null,r.children).forEach(this._loadAndMergeContentResource.bind(this,u.getDefaultNodeHierarchy()));return u};P.prototype.updateSceneTree=function(e,t,r){if(t.length===0){return null}var n;var o=this._getContentResourcesWithEncryptedVds3(t);if(o.length>0){y.error(f().getText(c.VIT25.summary),c.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");n=n||{};n.contentResourcesWithEncryptedVds3=o}var s=this._getContentResourcesWithMissingPasswords(t);if(s.length>0){y.error(f().getText(c.VIT21.summary),c.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");n=n||{};n.contentResourcesWithMissingPasswords=s}if(n&&r){r(n)}if(!e){return this.buildSceneTree(t)}var i=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var a=!!i.source;var u=t.length===1&&!!t[0].getSource();if(!(a&&u&&i.source===t[0].getSource()||!a&&!u&&i.fake===t.length>1)||!i.fake&&t.length===1&&i.name!==t[0].getName()){return this.buildSceneTree(t)}this._updatePlaceholders(e,i,t).forEach(this._loadAndMergeContentResource.bind(this,e.getDefaultNodeHierarchy()));e.getDefaultNodeHierarchy().fireChanged();return e};P.prototype._loadDvlSceneAsync=function(e,t){return new Promise(function(r,n){var o;var s=function(t){o();this.fireSceneLoadingFinished({source:e.source,sceneId:t.sceneId});r(t.sceneId)};var i=function(t){o();var r=t.errorMessage;if(r==null){r=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(t.errorCode):""}var s={source:e.source,errorCode:t.errorCode,errorMessage:r};this.fireSceneLoadingFinished(s);n(s)};var c=function(t,r){this.fireSceneLoadingProgress({source:w(e.source),percentage:r});return true}.bind(this);o=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(i,this);this._dvl.Client.detachSceneLoaded(s,this)}.bind(this);this._dvl.Client.attachSceneLoaded(s,this);this._dvl.Client.attachSceneFailed(i,this);this._dvl.Client.NotifyFileLoadProgress=c;this.fireSceneLoadingStarted({source:w(e.source)});try{l(e instanceof D?this._dvl.Core.LoadSceneFromVDSLAsync(e.content,t):this._dvl.Core.LoadSceneByUrlAsync(w(e.source),t,m(e.source)))}catch(e){o();i.call(this,{errorCode:e instanceof a?e.code:sap.ve.dvl.DVLRESULT.FAIL,errorMessage:e instanceof a?null:e})}}.bind(this))};var b=function(e,t){return new Promise(function(r){(function n(o){if(o>=e.length){r()}else{t(e[o]).catch(function(){}).then(function(){n(o+1)})}})(0)})};P.prototype._loadAndMergeContentResourcesAsync=function(e,t){var r,n=this;return b(t,function(t){if(t.source){var o=n._findSourceData({source:t.source})[0];if(!o){var s="Failed to load content resource with sourceId '"+t.sourceId+"' due to failed downloading from URL '"+w(t.source)+"'.";y.warning(s);r=r||[];r.push({errorMessage:s,source:t.source});return Promise.reject()}return function(){var e=n._findDvlSceneData({sourceDatum:o,root:false})[0];if(e){return Promise.resolve(e)}else{return n._loadDvlSceneAsync(o,t.password).then(function(t){e=new R(t,o,false);n._dvlSceneData.push(e);o.addRef();return Promise.resolve(e)},function(e){r=r||[];r.push(e);return Promise.reject()})}}().then(function(r){t.dvlSceneDatum=r;r.addRef();n._collectAndCheckSourceProperties(t);var o=t.nodeProxy.getNodeRef();n._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,n._rendererId);n._dvl.Scene.Merge(e._dvlSceneRef,r.dvlSceneId,o);return Promise.resolve()})}return Promise.resolve()}).then(function(){return Promise.resolve(r)})};P.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null)}var t=e.map(function(e){return new L(e)});return function(){var e;if(t.length===1&&t[0].name==null){e=t[0];if(e.source){var r=this._findSourceData({source:e.source})[0];if(r){return this._loadDvlSceneAsync(r,e.password).then(function(t){var n=new R(t,r,true);r.addRef();return Promise.resolve({shadowContentResource:e,dvlSceneDatum:n})})}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:e.source})}}return Promise.resolve({shadowContentResource:e,dvlSceneDatum:new R(this._dvl.Core.CreateEmptyScene(),null,true)})}else{var n=new o({sourceType:"vds",sourceId:g()});e=new L(n,true);n.destroy();n=null;Array.prototype.push.apply(e.children,t);t=[e];return Promise.resolve({shadowContentResource:e,dvlSceneDatum:new R(this._dvl.Core.CreateEmptyScene(),null,true)})}}.call(this).then(function(e){this._dvlSceneData.push(e.dvlSceneDatum);e.shadowContentResource.dvlSceneDatum=e.dvlSceneDatum;e.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(e.shadowContentResource);var t=new n(this,e.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new I(t,e.shadowContentResource));var r=t.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(r,this._buildPlaceholders(t.getDefaultNodeHierarchy(),null,null,e.shadowContentResource.children)).then(function(e){return Promise.resolve({scene:t,failureReason:e})})}.bind(this))};P.prototype.updateSceneTreeAsync=function(e,t){if(t.length===0){return Promise.resolve(null)}var r=this._getContentResourcesWithEncryptedVds3(t);if(r.length>0){y.error(f().getText(c.VIT25.summary),c.VIT25.code,"sap.ui.vk.dvl.GraphicsCore")}var n=this._getContentResourcesWithMissingPasswords(t);if(n.length>0){y.error(f().getText(c.VIT21.summary),c.VIT21.code,"sap.ui.vk.dvl.GraphicsCore")}if(!e){return this.buildSceneTreeAsync(t)}var o=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var s=!!o.source;var i=t.length===1&&!!t[0].getSource();if(!(s&&i&&o.source===t[0].getSource()||!s&&!i&&o.fake===t.length>1)||!o.fake&&t.length===1&&o.name!==t[0].getName()){return this.buildSceneTreeAsync(t)}return new Promise(function(r,n){var s=e.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(s,this._updatePlaceholders(e,o,t)).then(function(t){r({scene:e,failureReason:t});s.fireChanged()})}.bind(this))};P.prototype.destroyScene=function(e){var t;for(t=0;t<this._vkSceneData.length;++t){if(this._vkSceneData[t].vkScene===e){break}}if(t===this._vkSceneData.length){y.warning("Scene with id '"+e.getId()+"' is not created by this GraphicsCore.");return this}var r=this._vkSceneData.splice(t,1)[0];this._destroyShadowContentResource(e,r.shadowContentResource);e.destroy();return this};var T=function(e,t,r){_(Array.isArray(e),"The first parameter must be an array.");_(typeof t==="function","The second parameter must be a function.");for(var n=0,o=e.length;n<o;++n){if(t.call(r,e[n],n,e)){return n}}return-1};var V=function(e,t){return T(e,function(e){return e.control===t})};var E=function(e,t){return T(e,function(e){return e.rendererId===t})};P.prototype._registerViewport=function(e){_(e,"The viewportControl parameter must not be null.");if(V(this._viewports,e)>=0){return false}var t={control:e,canvas:null,rendererId:null};if(this._viewports.length===0){t.canvas=this._canvas;t.rendererId=this._rendererId;this._startRenderLoop()}else{if(this._viewports.length===1){var r=this._viewports[0];r.control._setCanvas(r.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this)}t.canvas=document.createElement("canvas");t.rendererId=this._dvl.Core.CreateRenderer()}e._setCanvas(t.canvas);e._setRenderer(t.rendererId);e.attachResize(this._handleViewportResize,this);this._viewports.push(t);return true};P.prototype._deregisterViewport=function(e){_(e,"The viewportControl parameter must not be null.");var t=V(this._viewports,e);if(t<0){return false}_(t>0||this._viewports.length===1,"The first registered viewport control must be deregistered last.");var r=this._viewports.splice(t,1)[0];if(this._viewports.length===0){this._stopRenderLoop()}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var n=this._viewports[1-t];n.control._setCanvas(n.canvas=this._canvas)}this._dvl.Core.DeleteRenderer(r.rendererId)}e.detachResize(this._handleViewportResize,this);e._setRenderer(null);e._setCanvas(null);return true};P.prototype._getViewportCount=function(){return this._viewports.length};P.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(e){return e.canvas.width}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(e){return e.canvas.height}))}};P.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}return this};P.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null}return this};P.prototype._renderLoop=function(){var e;return function(){var t=this._viewports.length>1;this._viewports.forEach(function(r){var n=r.canvas,o=r.rendererId;this._dvl.Renderer._processCommandQueue(o);if(n.width>0&&n.height>0&&this._dvl.Renderer.ShouldRenderFrame(o)){if(t&&e!==o){this._dvl.Renderer.SetDimensions(n.width,n.height,o)}r.control.renderFrame();e=o}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}}();P.prototype._handleFrameFinished=function(e){_(this._viewports.length>1,"Method _handleFrameFinished should be only called when there are multiple viewports.");if(this._viewports.length>1){var t=E(this._viewports,e.rendererId);if(t>=0){var r=this._viewports[t].canvas,n=r.getContext("2d"),o=r.width,s=r.height;n.drawImage(this._canvas,0,this._canvas.height-s,o,s,0,0,o,s)}}};P.prototype.createViewStateManager=function(e,t){var r=new i;r._setNodeHierarchy(e).setShouldTrackVisibilityChanges(t);this._viewStateManagers.push(r);return r};P.prototype.destroyViewStateManager=function(e){var t=this._viewStateManagers.indexOf(e);if(t>=0){this._viewStateManagers.splice(t,1)[0].destroy()}return this};P.prototype.showDebugInfo=function(e){this._viewports.forEach(function(t){t.control.setShowDebugInfo(e)});return this};P.prototype.getApi=function(e){switch(e){case d.LegacyDvl:return this._dvl;default:return null}};P.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this};P.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){l(this._dvl.Core.SetLocale(S.getConfiguration().getLanguageTag()))}};P.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler()};P.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this};P.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;return this};P.prototype.setRetryCount=function(e){this._retryCount=Math.max(e,0);return this};P.prototype.attachSceneLoadingFinished=function(e,t,r){return this.attachEvent("sceneLoadingFinished",e,t,r)};P.prototype.detachSceneLoadingFinished=function(e,t){return this.detachEvent("sceneLoadingFinished",e,t)};P.prototype.fireSceneLoadingFinished=function(e,t,r){return this.fireEvent("sceneLoadingFinished",e,t,r)};P.prototype.attachSceneLoadingProgress=function(e,t,r){return this.attachEvent("sceneLoadingProgress",e,t,r)};P.prototype.detachSceneLoadingProgress=function(e,t){return this.detachEvent("sceneLoadingProgress",e,t)};P.prototype.fireSceneLoadingProgress=function(e,t,r){return this.fireEvent("sceneLoadingProgress",e,t,r)};P.prototype.attachSceneLoadingStarted=function(e,t,r){return this.attachEvent("sceneLoadingStarted",e,t,r)};P.prototype.detachSceneLoadingStarted=function(e,t){return this.detachEvent("sceneLoadingStarted",e,t)};P.prototype.fireSceneLoadingStarted=function(e,t,r){return this.fireEvent("sceneLoadingStarted",e,t,r)};return P});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/GraphicsCoreApi", [],function(){"use strict";var e={LegacyDvl:"LegacyDvl"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/LayerProxy", ["../LayerProxy","./getJSONObject"],function(e,t){"use strict";var r=e.extend("sap.ui.vk.dvl.LayerProxy",{metadata:{library:"sap.ui.vk",publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},constructor:function(t,r){e.call(this);this._dvl=t?t.getGraphicsCore()._getDvl():null;this._dvlSceneRef=t?t.getSceneRef():null;this._dvlLayerId=r}});r.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;e.prototype.destroy.call(this)};r.prototype.getLayerId=function(){return this._dvlLayerId};r.prototype.getVeIds=function(){return t(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId))};r.prototype.getName=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name};r.prototype.getDescription=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description};r.prototype.getLayerMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata};r.prototype.getNodes=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/NodeHierarchy", ["../NodeHierarchy","../NodeContentType","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages","../DvlException","./checkResult","./getJSONObject","../getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(e,t,r,o,i,s,n,d,a,c,N,l,h){"use strict";var v={modeDictionary:{equals:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE},contains:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE},startsWith:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE}}};var D=e.extend("sap.ui.vk.dvl.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new r(o),constructor:function(t){e.call(this);this._graphicsCore=t.getGraphicsCore();this._scene=t;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[]}});D.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;e.prototype.destroy.call(this)};D.prototype.getGraphicsCore=function(){return this._graphicsCore};D.prototype.getScene=function(){return this._scene};D.prototype.getSceneRef=function(){return this._dvlSceneRef};D.prototype.enumerateChildren=function(e,t,r,o){if(typeof e==="function"){o=r;r=t;t=e;e=undefined}var i;if(e){if(r||(c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){i=c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes}else{i=[]}}else{i=c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes}if(o){i.forEach(t)}else{var s=this._baseNodeProxyPool.borrowObject();try{i.forEach(function(e){s.init(this,e);t(s);s.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(s)}}return this};D.prototype.enumerateAncestors=function(e,t,r){var o=c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(r){o.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};D.prototype.createNodeProxy=function(e){var t=new i(this,e);this._nodeProxies.push(t);return t};D.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};D.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}if(e){if(t||(c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes}else{return[]}}else{return c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes}};D.prototype.getAncestors=function(e){return c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes};D.prototype.findNodesByName=function(e){var t=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,r=[],o,i;if(e===undefined||e===null||jQuery.isEmptyObject(e)){o=v.modeDictionary.contains(false);i=[""]}else{if(e.value===undefined||e.value===null||e.value===""){h.error(N().getText(n.VIT6.summary),n.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}var s=e.hasOwnProperty("predicate")?e.predicate:"equals";if(s===undefined||s===null||s===""){h.error(N().getText(n.VIT7.summary),n.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}else if(["equals","contains","startsWith"].indexOf(s)===-1){h.error(N().getText(n.VIT8.summary),n.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}o=v.modeDictionary[s](e.caseSensitive);i=typeof e.value==="string"?[e.value]:e.value}for(var d=0;d<i.length;d++){r=r.concat(c(this._dvl.Scene.FindNodes(this._dvlSceneRef,t,o,i[d])).nodes)}return l(r)};D.prototype.createLayerProxy=function(e){var t=new s(this,e);this._layerProxies.push(t);return t};D.prototype.destroyLayerProxy=function(e){var t=this._layerProxies.indexOf(e);if(t>=0){this._layerProxies.splice(t,1)[0].destroy()}return this};D.prototype.getLayers=function(){return c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers};D.prototype.getHotspotNodeIds=function(){var e=c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return e.length>0?e:this._getLegacyHotspotNodeIds()};D.prototype._getLegacyHotspotNodeIds=function(){var e=this.getLayers(),t=[];for(var r=0;r<e.length;r++){var o=this.createLayerProxy(e[r]),i=o.getName();if(i.toLowerCase()==="hotspots"){t=o.getNodes();this.destroyLayerProxy(o);break}this.destroyLayerProxy(o)}return t};D.prototype.createNode=function(e,t,r){var o=this._dvl.Scene.CreateNode(this._dvlSceneRef,e,t,r);this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o};D.prototype.createNodeCopy=function(e,t,r,o){var i=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,e,t,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,r,o);this.fireNodeCreated({nodeRef:i,nodeId:i});this.fireChanged();return i};D.prototype.getNodeContentType=function(e){return t.Regular};D.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){this.fireNodeRemoving({nodeRef:e,nodeId:e});try{a(this._dvl.Scene.DeleteNode(this._dvlSceneRef,e))}catch(r){var t="Failed to delete node with ID = "+e+".";if(r instanceof d){t+=" Error code: "+r.code+". Message: "+r.message+"."}h.error(t)}}.bind(this));this.fireChanged();return this};return D});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/NodeProxy", ["../NodeProxy","./getJSONObject","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix"],function(e,t,o,r,i,n,d){"use strict";var l=e.extend("sap.ui.vk.dvl.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(t,o){e.call(this);this._dvl=t?t.getGraphicsCore()._getDvl():null;this._dvlSceneRef=t?t.getSceneRef():null;this._dvlNodeRef=o}});l.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;e.prototype.destroy.call(this)};l.prototype.getNodeRef=function(){return this._dvlNodeRef};l.prototype.getNodeId=function(){return this._dvlNodeRef};l.prototype.getVeIds=function(){return t(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef))};l.prototype.getName=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName};l.prototype.getLocalMatrix=function(){return d.convertTo4x3(t(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix)};l.prototype.setLocalMatrix=function(e){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,e&&d.convertTo4x4(e));this.setProperty("localMatrix",e,true);return this};l.prototype.getWorldMatrix=function(){return d.convertTo4x3(t(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix)};l.prototype.setWorldMatrix=function(e){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,e&&d.convertTo4x4(e));this.setProperty("worldMatrix",e,true);return this};l.prototype.getOpacity=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity};l.prototype.setOpacity=function(e){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,e);this.setProperty("opacity",e,true);return this};l.prototype.getTintColorABGR=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor};l.prototype.setTintColorABGR=function(e){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,e);this.setProperty("tintColorABGR",e,true);this.setProperty("tintColor",r(i(e)),true);return this};l.prototype.getTintColor=function(){return r(i(this.getTintColorABGR()))};l.prototype.setTintColor=function(e){var t=n(o(e));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,t);this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",e,true);return this};l.prototype.getNodeMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata};l.prototype.getHasChildren=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN};l.prototype.getClosed=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/Scene", ["../Scene","./NodeHierarchy","sap/base/util/uid"],function(e,t,r){"use strict";var i=e.extend("sap.ui.vk.dvl.Scene",{metadata:{library:"sap.ui.vk"},constructor:function(t,i){e.call(this);this._id=r();this._graphicsCore=t;this._dvlSceneRef=i;this._defaultNodeHierarchy=null}});i.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}this._dvlSceneRef=null;this._graphicsCore=null;e.prototype.destroy.call(this)};i.prototype.getId=function(){return this._id};i.prototype.getGraphicsCore=function(){return this._graphicsCore};i.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new t(this)}return this._defaultNodeHierarchy};i.prototype.getSceneRef=function(){return this._dvlSceneRef};i.prototype.setDoubleSided=function(e){this.setProperty("doubleSided",e,true);this._graphicsCore._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_BACKFACING,e);return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ViewStateManager", ["sap/ui/core/Element","../ViewStateManagerBase","./GraphicsCoreApi","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","sap/base/util/array/uniqueSort"],function(e,t,i,s,r,n,a,o,l){"use strict";var h;var d=t.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var c=d.getMetadata().getParent().getClass().prototype;d.prototype.init=function(){if(c.init){c.init.call(this)}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map;this._selectedNodes=new Set;this._visibilityTracker=new h;this._closedNodeProcessed=false};d.prototype._setContent=function(e){var t=null;if(e&&e instanceof o){t=e}this._setScene(t);return this};d.prototype._setScene=function(e){if(e){this._setNodeHierarchy(e.getDefaultNodeHierarchy())}else{this._setNodeHierarchy(null)}return this};d.prototype._setNodeHierarchy=function(e){var t=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear()}if(e){var s=e.getScene(),r=s.getSceneRef();this._nodeHierarchy=e;this._dvl=s.getGraphicsCore().getApi(i.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);this._nodeHierarchy.attachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._populateNodeStates(this._dvl.Scene.RetrieveSceneInfo(r,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes)}if(e!==t){this.fireNodeHierarchyReplaced({oldNodeHierarchy:t,newNodeHierarchy:e})}return this};d.prototype._populateNodeStates=function(e){var t=this,i=[],s=[],r=[],n=[],a=this._nodeHierarchy.getScene(),o=a.getSceneRef();e.forEach(function e(a){var l=t._dvl.Scene.RetrieveNodeInfo(o,a,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(a,{flags:l.Flags,visible:l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE});if(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(a)}(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?i:s).push(a);(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?r:n).push(a);l.ChildNodes.forEach(e)});this.fireSelectionChanged({selected:r,unselected:n});this.fireVisibilityChanged({visible:i,hidden:s});return this};d.prototype._handleNodeCreated=function(e){this._populateNodeStates([e.getParameter("nodeRef")])};d.prototype._handleNodeRemoving=function(e){var t=e.getParameter("nodeRef"),i=this;var s=function(e){i._nodeHierarchy.enumerateChildren(e,s,true,true);i._nodeStates.delete(e)};s(t)};d.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};d.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};d.prototype.getVisibilityComplete=function(){var e=this.getNodeHierarchy(),t=e.findNodesByName(),i=[],s=[];t.forEach(function(t){var r=e.createNodeProxy(t),n=jQuery.grep(r.getVeIds(),function(e){return e.type==="VE_LOCATOR"});n=Array.isArray(n)&&n.length>0?n[0].fields[0].value:null;e.destroyNodeProxy(r);if(n){if(this.getVisibilityState(t)){i.push(n)}else{s.push(n)}}},this);return{visible:i,hidden:s}};d.prototype.resetVisibility=function(){this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY,this._scene);return this};var f=function(e,t,i){return e.has(i)&&(e.get(i).flags&t)!==0};d.prototype._getVisibilityFlagState=function(e){return f(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,e)};d.prototype._getSelectionFlagState=function(e){return f(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,e)};var u=function(e,t,i,s){if(e.has(s)){var r=e.get(s);r.flags=r.flags&~i|t&i}else{e.set(s,{flags:t&i})}};d.prototype._setFlags=function(e,t,i){if(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(e,(t&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false)}if(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(e,(t&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false)}u(this._nodeStates,t,i&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),e);return this};d.prototype._getFlags=function(e,t){var i=this._nodeStates.get(e),s=i&&i.flags;return s!==undefined?s&t:null};d.prototype.getVisibilityState=function(e){return Array.isArray(e)?e.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(e)};d.prototype.setVisibilityState=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}var r=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getVisibilityFlagState(e)!==t},this);var n=function(e,t){var i=[];this._nodeHierarchy.enumerateChildren(e,function(e){i.push(e)},true,true);i.forEach(function(e){var i=this._nodeStates.get(e);if(t){if(i.visible){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;n(e,t)}}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;n(e,t)}},this)}.bind(this);if(r.length>0){r.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(i.flags===undefined){i.flags=0}if(t){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE}}else{i={flags:t?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0};this._nodeStates.set(e,i)}i.visible=t;n(e,t)},this);if(this.getShouldTrackVisibilityChanges()){r.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged({visible:t?r:[],hidden:t?[]:r})}return this};d.prototype.enumerateSelection=function(e){this._selectedNodes.forEach(e);return this};d.prototype.getSelectionState=function(e){return Array.isArray(e)?e.map(this._getSelectionFlagState,this):this._getSelectionFlagState(e)};d.prototype.setSelectionState=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}var r=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e);if(this.getRecursiveSelection()&&!t){r=this._nodeHierarchy._appendAncestors(r)}r=r.filter(function(e){return e&&this._getSelectionFlagState(e)!==t},this);if(r.length>0){r.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(i.flags===undefined){i.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}if(t){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}}else{var s=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:s|(t?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)})}this._selectedNodes[t?"add":"delete"](e)},this);if(!s){this.fireSelectionChanged({selected:t?r:[],unselected:t?[]:r})}}return this};d.prototype.setSelectionStates=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}if(!Array.isArray(t)){t=[t]}var r=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e);var n=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t);if(this.getRecursiveSelection()){n=this._nodeHierarchy._appendAncestors(n,r)}r=r.filter(function(e){return e&&this._getSelectionFlagState(e)===false},this);n=n.filter(function(e){return e&&this._getSelectionFlagState(e)===true},this);if(r.length>0){r.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(t.flags===undefined){t.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}t.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:i|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED})}this._selectedNodes["add"](e)},this)}if(n.length>0){n.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(t.flags===undefined){t.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}t.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:i})}this._selectedNodes["delete"](e)},this)}if(!s){if(r.length>0||n.length>0){this.fireSelectionChanged({selected:r,unselected:n})}}return this};d.prototype._handleStepEvent=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear()}};d.prototype._collectNodesRecursively=function(e,t){var i=[],s=this;if(t===undefined){t=false}e.forEach(function e(r){i.push(r);s._nodeHierarchy.enumerateChildren(r,e,t,true)});return i};d.prototype._getOpacity=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).opacity;return t===undefined?null:t}else{return null}};d.prototype.getOpacity=function(e){if(Array.isArray(e)){return e.map(this._getOpacity,this)}else{return this._getOpacity(e)}};d.prototype.setOpacity=function(e,t,i){if(!Array.isArray(e)){e=[e]}var s=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getOpacity(e)!==t},this);if(s.length>0){s.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(t===null){delete i.opacity}else{i.opacity=t}}else if(t!==null){this._nodeStates.set(e,{opacity:t})}},this);this.fireOpacityChanged({changed:s,opacity:t})}return this};d.prototype._getTintColorABGR=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).tintColorABGR;return t===undefined?null:t}else{return null}};d.prototype._getTintColor=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).tintColorABGR;return t===undefined?null:r(n(t))}else{return null}};d.prototype.getTintColor=function(e,t){var i=t?"_getTintColorABGR":"_getTintColor";if(Array.isArray(e)){return e.map(this[i],this)}else{return this[i](e)}};d.prototype.setTintColor=function(e,t,i){if(!Array.isArray(e)){e=[e]}var r=null;switch(typeof t){case"number":r=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){r=a(s(t))}break;default:t=null;break}var n=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getTintColorABGR(e)!==r},this);if(n.length>0){n.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(r===null){delete t.tintColorABGR}else{t.tintColorABGR=r}}else if(r!==null){this._nodeStates.set(e,{tintColorABGR:r})}},this);this.fireTintColorChanged({changed:n,tintColor:t,tintColorABGR:r})}return this};h=function(){this._visibilityChanges=new Set};h.prototype.getInfo=function(e){var t=function(e){return e.type==="VE_LOCATOR"};var i=[];this._visibilityChanges.forEach(function(s){var r=e.createNodeProxy(s),n=jQuery.grep(r.getVeIds(),t);n=Array.isArray(n)&&n.length>0?n[0].fields[0].value:null;e.destroyNodeProxy(r);if(n){i.push(n)}});return i};h.prototype.clear=function(){this._visibilityChanges.clear()};h.prototype.trackNodeRef=function(e){if(this._visibilityChanges.has(e)){this._visibilityChanges.delete(e)}else{this._visibilityChanges.add(e)}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/Viewport", ["sap/ui/core/ResizeHandler","../abgrToColor","../CameraFOVBindingType","../CameraProjectionType","../colorToABGR","../colorToCSSColor","../Core","../cssColorToColor","../getResourceBundle","../glMatrix","../Loco","../Messages","../SelectionMode","../Smart2DHandler","../ViewportBase","../ViewportHandler","../VisibilityMode","../ZoomTo","../OutputSettings","./getJSONObject","./Scene","./ViewportRenderer","sap/base/Log"],function(e,t,i,r,o,n,a,s,d,l,h,v,p,c,_,f,u,m,R,y,g,I,C){"use strict";var V;var S=function(){if(V){return}V={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};V.decodedProjectionType[r.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;V.decodedProjectionType[r.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;V.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=r.Perspective;V.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=r.Orthographic;V.decodedBindingType[i.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;V.decodedBindingType[i.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;V.decodedBindingType[i.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;V.decodedBindingType[i.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=i.Minimum;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=i.Maximum;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=i.Horizontal;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=i.Vertical;V.decodedZoomTo[m.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;V.decodedZoomTo[m.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;V.decodedZoomTo[m.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;V.decodedZoomTo[m.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;V.decodedZoomTo[m.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;V.decodedZoomTo[m.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;V.decodedZoomTo[m.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;V.decodedZoomTo[m.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;V.decodedZoomTo[m.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;V.decodedZoomTo[m.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;V.decodedZoomTo[m.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;V.decodedZoomTo[m.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;V.decodedZoomTo[m.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT};var T=_.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",properties:{backgroundColorTopABGR:{type:"int",defaultValue:4278190080},backgroundColorBottomABGR:{type:"int",defaultValue:4294967295}},events:{pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},frameRenderingFinished:{}}}});var O=T.getMetadata().getParent().getClass().prototype;T.prototype.init=function(){if(O.init){O.init.call(this)}this._eventBus=a.getEventBus();this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new f(this);this._loco=new h(this);this._loco.addHandler(this._viewportHandler,-1);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null};T.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){e.deregister(this._resizeListenerId);this._resizeListenerId=null}this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(O.exit){O.exit.call(this)}};T.prototype.setGraphicsCore=function(e){S();if(e!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null}this._graphicsCore=e;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId)}}return this};T.prototype.getGraphicsCore=function(){return this._graphicsCore};T.prototype._setCanvas=function(e){var t=this.getDomRef()&&this._canvas!==e;this._canvas=e;if(t){this.invalidate()}return this};T.prototype._setRenderer=function(e){this._dvlRendererId=e;return this};T.prototype._updateLastPlayedStep=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=e.stepId;this._updateOutputSettings()}};T.prototype.setScene=function(e){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(e&&e.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=e?e.getSceneRef():null;if(e){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var t=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(t){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId)}else{var i=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var r=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(i.red,i.green,i.blue,i.alpha,r.red,r.green,r.blue,r.alpha,this._dvlRendererId)}this._updateOutputSettings();this.fireViewActivated({type:t?"2D":"3D"})}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler)}this.invalidate()}}return this};T.prototype._updateOutputSettings=function(){var e=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO);var t=this._dvl.Scene.RetrieveOutputSettings(this._dvlSceneRef,e.StepId);var i=new R({width:t.width,height:t.height,dpi:t.dpi});this.setOutputSettings(i)};T.prototype._isSmart2DContent=function(){var e=y(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return e&&e.length>0};T.prototype._isSmart2DContentLegacy=function(){var e=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),t=this._dvl.Camera.GetRotation(e),i=this._dvl.Camera.GetProjection(e);return t[0]===90&&t[1]===-90&&t[2]===0&&i===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC};T.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler)}this._smart2DHandler=new c(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler,0)}if(this.getShowAllHotspots()){var e=this._viewStateManager.getNodeHierarchy(),t=e.getHotspotNodeIds();this.showHotspots(t,true)}};T.prototype._fireUrlClicked=function(e){this.fireUrlClicked({url:e.url,nodeRef:e.nodeId})};T.prototype.setHotspotColorABGR=function(e){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",n(t(this.getProperty("hotspotColorABGR"))),true);return this};T.prototype.setHotspotColor=function(e){this.setProperty("hotspotColor",e,true);this.setProperty("hotspotColorABGR",o(s(this.getProperty("hotspotColor"))),true);return this};T.prototype._getStepAndProcedureIndexes=function(e,t){var i=-1,r=-1,o=false;for(var n=0;n<e.length;n++){if(!o){for(var a=0;a<e[n].steps.length;a++){if(e[n].steps[a].id===t){r=a;i=n;o=true;break}}}else{break}}return{stepIndex:r,procedureIndex:i}};T.prototype._getStepVeIdById=function(e){if(e){var t=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,e);if(Array.isArray(t)){for(var i=0,r=t.length;i<r;++i){var o=t[i];if(o.source==="SAP"&&o.type==="VE_VIEWPORT"&&Array.isArray(o.fields)){for(var n=0,a=o.fields.length;n<a;++n){var s=o.fields[n];if(s.name==="ID"){return s.value}}}}}}return null};T.prototype._getStepIdByVeId=function(e,t){for(var i=0,r=e.length;i<r;++i){var o=e[i].steps;for(var n=0,a=o.length;n<a;++n){var s=o[n].id;if(this._getStepVeIdById(s)===t){return s}}}return null};var D=function(e){e.camera={}};var E=function(e){if(typeof e.camera==="object"&&e.camera!==null){e.camera.matrices=false}};var P=function(e){if(typeof e.camera==="object"&&e.camera!==null){e.camera.useTransitionCamera=false}};var b=function(e){e.animation=true};var w=function(e){e.visibility=false};var N=function(e){if(typeof e.visibility==="object"&&e.visibility!==null){e.visibility.mode=u.Complete}};T.prototype.getViewInfo=function(e){if(!this._dvlSceneRef){return null}var t={};if(typeof e!=="object"||e===null){D(t);E(t);P(t);b(t);w(t);N(t)}else{if(typeof e.camera==="object"&&e.camera!==null){t.camera={};if(typeof e.camera.matrices==="boolean"){t.camera.matrices=e.camera.matrices}else if("matrices"in e.camera){t.camera.matrices=false}else{E(t)}if(typeof e.camera.useTransitionCamera==="boolean"){t.camera.useTransitionCamera=e.camera.useTransitionCamera}else if("useTransitionCamera"in e.camera){t.camera.useTransitionCamera=false}else{P(t)}}else if(typeof e.camera==="boolean"){if(e.camera===true){t.camera={};E(t);P(t)}else{t.camera=false}}else if("camera"in e){t.camera=false}else{D(t);E(t);P(t)}if(typeof e.animation==="boolean"){t.animation=e.animation}else if("animation"in e){t.animation=false}else{b(t)}if(typeof e.visibility==="object"&&e.visibility!==null){t.visibility={};if(e.visibility.mode===u.Complete||e.visibility.mode===u.Differences){t.visibility.mode=e.visibility.mode}else{N(t)}}else if(typeof e.visibility==="boolean"){if(e.visibility===true){t.visibility={};N(t)}else{t.visibility=false}}else if("visibility"in e){t.visibility=false}else{w(t);N(t)}}var i={};if(t.camera){var o=null;if(t.camera.useTransitionCamera){o=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(o===sap.ve.dvl.DVLID_INVALID){o=null}}if(o===null){o=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId)}var n=this._dvl.Camera.GetRotation(o),a=this._dvl.Camera.GetOrigin(o);i.camera={rotation:{yaw:n[0],pitch:n[1],roll:n[2]},position:{x:a[0],y:a[1],z:a[2]},projectionType:V.encodedProjectionType[this._dvl.Camera.GetProjection(o)],bindingType:V.encodedBindingType[this._dvl.Camera.GetFOVBinding(o)]};if(this._matView){i.viewMatrix=this._matView.slice()}if(this._matProj){i.projectionMatrix=this._matProj.slice()}if(i.camera.projectionType===r.Perspective){i.camera.fieldOfView=this._dvl.Camera.GetFOV(o)}else if(i.camera.projectionType===r.Orthographic){i.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(o)}if(t.camera.matrices){var s=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);i.camera.matrices={view:s.view,projection:s.projection}}}if(t.animation){var l=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),h=l.StepId!==sap.ve.dvl.DVLID_INVALID;var p=h?l.StepId:this._lastPlayedStep,c=h?l.StepTime:0,_=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),f=this._getStepAndProcedureIndexes(_.procedures,p),m=this._getStepVeIdById(p);i.animation={animationTime:c,stepIndex:f.stepIndex,procedureIndex:f.procedureIndex};if(m){i.animation.stepVeId=m}}if(t.visibility&&this._viewStateManager){i.visibility={mode:t.visibility.mode};if(t.visibility.mode===u.Complete){var R=this._viewStateManager.getVisibilityComplete();i.visibility.visible=R.visible;i.visibility.hidden=R.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){i.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{C.warning(d().getText(v.VIT32.summary),v.VIT32.code,"sap.ui.vk.dvl.Viewport")}}return i};T.prototype.setViewInfo=function(e,t){var i=false;if(e.animation){var o=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),n=e.animation.procedureIndex,a=e.animation.stepIndex,s=e.animation.stepVeId,l,h=e.animation.animationTime||0;if(s||a>=0&&n>=0){if(s){l=this._getStepIdByVeId(o.procedures,e.animation.stepVeId)}else if(n>=0&&n<o.procedures.length){if(a>=0&&a<o.procedures[n].steps.length){l=o.procedures[n].steps[a].id}else{C.error(d().getText(v.VIT26.summary),v.VIT26.code,"sap.ui.vk.dvl.Viewport")}}else{C.error(d().getText(v.VIT27.summary),v.VIT27.code,"sap.ui.vk.dvl.Viewport")}if(l){this._dvl.Renderer.ActivateStep(this._dvlRendererId,l,false,false,h);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId)}}else{i=true}}if(e.camera){var p;if(e.camera.projectionType===r.Perspective||e.camera.projectionType===r.Orthographic){p=V.decodedProjectionType[e.camera.projectionType]}else{C.error(d().getText(v.VIT19.summary),v.VIT19.code,"sap.ui.vk.dvl.Viewport");p=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE}var c=this._dvl.Scene.CreateCamera(this._dvlSceneRef,p,sap.ve.dvl.DVLID_INVALID);if(p===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(c,e.camera.fieldOfView)}else if(p===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(c,e.camera.zoomFactor)}if(e.camera.position){this._dvl.Camera.SetOrigin(c,e.camera.position.x,e.camera.position.y,e.camera.position.z)}if(e.camera.rotation){this._dvl.Camera.SetRotation(c,e.camera.rotation.yaw,e.camera.rotation.pitch,e.camera.rotation.roll)}if(e.camera.bindingType){var _=V.decodedBindingType[e.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(c,_)}t=t||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,c,t);this._dvl.Scene.DeleteNode(this._dvlSceneRef,c)}if(e.viewMatrix){this._matView=e.viewMatrix.slice()}if(e.projectionMatrix){this._matProj=e.projectionMatrix.slice()}if(e.visibility){var f=this._viewStateManager.getNodeHierarchy(),m=new Map,R=f.findNodesByName();R.forEach(function(e){var t=f.createNodeProxy(e),i=jQuery.grep(t.getVeIds(),function(e){return e.type==="VE_LOCATOR"});i=Array.isArray(i)&&i.length>0?i[0].fields[0].value:null;f.destroyNodeProxy(t);if(i){m.set(i,e)}});switch(e.visibility.mode){case u.Complete:var y=e.visibility.visible,g=e.visibility.hidden;y.forEach(function(e){this._viewStateManager.setVisibilityState(m.get(e),true,false)},this);g.forEach(function(e){this._viewStateManager.setVisibilityState(m.get(e),false,false)},this);break;case u.Differences:if(i){this.resetView({camera:false,visibility:true,transition:false})}e.visibility.changes.forEach(function(e){var t=m.get(e);if(t){this._viewStateManager.setVisibilityState(t,!this._viewStateManager.getVisibilityState(t),false)}},this);break;default:C.error(d().getText(v.VIT28.summary),v.VIT28.code,"sap.ui.vk.dvl.Viewport");break}}return this};T.prototype.setSelectionRect=function(e){if(!e){this._dvl.Renderer.DrawSelectionRect(0,0,0,0,this._dvlRendererId)}else{var t=this._toDvlRendererCoord(e.x1,e.y1);var i=this._toDvlRendererCoord(e.x2,e.y2);this._dvl.Renderer.DrawSelectionRect(t.x,t.y,i.x,i.y,this._dvlRendererId)}};T.prototype.getOutputSize=function(){var e=this.getViewInfo().camera.bindingType,t=this.getDomRef().getBoundingClientRect(),i=t.width,r=t.height,o;switch(V.decodedBindingType[e]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:o=Math.min(i,r);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:o=Math.max(i,r);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:o=i;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:o=r;break;default:break}return{left:(i-o)/2,top:(r-o)/2,sideLength:o}};T.prototype.onBeforeRendering=function(){if(this._resizeListenerId){e.deregister(this._resizeListenerId);this._resizeListenerId=null}};T.prototype.onAfterRendering=function(){var t=this.getDomRef();if(this._canvas){t.appendChild(this._canvas)}this._resizeListenerId=e.register(this,this._handleResize.bind(this));this._handleResize({size:{width:t.clientWidth,height:t.clientHeight}})};T.prototype._handleResize=function(e){if(this._dvlRendererId&&this._canvas){var t=e.size.width*window.devicePixelRatio;var i=e.size.height*window.devicePixelRatio;if(this._matProj){var r=this._matProj[0];var o=this._matProj[5];var n=Math.max(r,o);if(t>i){r=n*i/t;o=n}else{r=n;o=n*t/i}this._matProj[8]*=r/this._matProj[0];this._matProj[9]*=o/this._matProj[5];this._matProj[0]=r;this._matProj[5]=o}var a=96*window.devicePixelRatio;var s=this.getAggregation("outputSettings");this._gestureRatio=1;if(this.getKeepOutputSize()&&s&&s.getDpi()>0){var d=s.getWidth()/25.4*a;var l=s.getHeight()/25.4*a;var h=d/t;var v=l/i;var p=h>v?h:v;t*=p;i*=p;this._gestureRatio=p}this._dvl.Renderer.SetDimensions(t,i,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,a,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_MIN_VISIBLE_OBJECT_SIZE,1,this._dvlRendererId);this._canvas.width=t;this._canvas.height=i;this._canvas.style.width=e.size.width+"px";this._canvas.style.height=e.size.height+"px";this.fireResize({size:{width:e.size.width,height:e.size.height}});return true}};T.prototype._onVisibilityChanged=T.prototype._onSelectionChanged=T.prototype._onOpacityChanged=T.prototype._onTintColorChanged=function(e){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId)}};T.prototype.showHotspots=function(e,t,i){var r=sap.ui.vk.dvl.NodeProxy.prototype[typeof i==="string"?"setTintColor":"setTintColorABGR"];var o=function(e,t,i){var o=e.createNodeProxy(i);r.call(o,t);e.destroyNodeProxy(o)};if(!Array.isArray(e)){e=[e]}var n=i===undefined?this.getHotspotColorABGR():i;if(!t){n=0}var a=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var s=[];e.forEach(function(e){var t=y(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);Array.prototype.push.apply(s,t)}.bind(this));Array.prototype.push.apply(s,e);s.forEach(o.bind(null,a,n))}else{var d=[];var l=function(e){var t=a.getChildren(e);Array.prototype.push.apply(d,t);t.forEach(l)};e.forEach(l);Array.prototype.push.apply(d,e);d.forEach(o.bind(null,a,n))}return this};T.prototype._getDecomposedABGR=function(e){return{red:(e>>>0&255)/255,green:(e>>>8&255)/255,blue:(e>>>16&255)/255,alpha:(e>>>24&255)/255}};T.prototype._setBackgroundColor=function(){if(this._dvl){var e=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),t=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(e.red,e.green,e.blue,e.alpha,t.red,t.green,t.blue,t.alpha,this._dvlRendererId)}};T.prototype.setBackgroundColorTopABGR=function(e){this.setProperty("backgroundColorTopABGR",e,true);this._setBackgroundColor();return this};T.prototype.setBackgroundColorTop=function(e){this.setProperty("backgroundColorTop",e,true);return this.setBackgroundColorTopABGR(o(s(e)))};T.prototype.setBackgroundColorBottomABGR=function(e){this.setProperty("backgroundColorBottomABGR",e,true);this._setBackgroundColor();return this};T.prototype.setBackgroundColorBottom=function(e){this.setProperty("backgroundColorBottom",e,true);return this.setBackgroundColorBottomABGR(o(s(e)))};T.prototype.setKeepOutputSize=function(e){this.setProperty("keepOutputSize",e);this._updateViewportSize()};T.prototype.setOutputSettings=function(e){this.setAggregation("outputSettings",e);this._updateViewportSize()};T.prototype._updateViewportSize=function(){var e=this.getDomRef();if(e){this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}})}};T.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId)}return this};T.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId)};function A(e,t,i){return e+(t-e)*i}function M(e,t,i){i=Math.min(Math.max((i-e)/(t-e),0),1);return i*i*i*(i*(i*6-15)+10)}T.prototype._updateRedlineZoomToAnimation=function(){var e=this._anim;var t=e.startProjRect;var i=e.endProjRect;var r=Math.min(M(0,1,(Date.now()-e.startTime)/e.duration),1);var o={left:A(t.left,i.left,r),right:A(t.right,i.right,r),top:A(t.top,i.top,r),bottom:A(t.bottom,i.bottom,r)};if(this._redlineHandler){var n=e.currentProjRect;var a=(n.left+n.right)*.5;var s=(n.top+n.bottom)*.5;var d=(o.left+o.right)*.5;var l=(o.top+o.bottom)*.5;var h=this.getDomRef();var v=(a-d)*h.clientWidth/(n.right-n.left);var p=(s-l)*h.clientHeight/(n.bottom-n.top);this._redlineHandler.pan(v,p);this._redlineHandler.zoom((n.right-n.left)/(o.right-o.left),h.clientWidth*.5,h.clientHeight*.5);e.currentProjRect=o}B(this._matProj,o);if(r>=1){delete this._anim}};T.prototype.renderFrame=function(){if(this._dvlRendererId){if(this._matView&&this._matProj){if(this._anim){this._updateRedlineZoomToAnimation()}this.renderFrameEx(this._matView,this._matProj,this._dvlRendererId);if(this._anim){this.setShouldRenderFrame()}}else{this._dvl.Renderer.RenderFrame(this._dvlRendererId)}}return this};T.prototype.renderFrameEx=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(e,t),this._dvlRendererId)}return this};T.prototype.resetView=function(e){if(e!==undefined&&!jQuery.isPlainObject(e)){C.error(d().getText(v.VIT31.summary),v.VIT31.code,"sap.ui.vk.dvl.Viewport")}var t={camera:true,transition:true,visibility:false};jQuery.extend(t,e);if(t.camera||t.visibility){var i=(t.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(t.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(t.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(i,this._dvlRendererId);this._lastPlayedStep=null}}return this};T.prototype.canIsolateNode=function(e){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(e,this._dvlRendererId)}else{return false}};T.prototype.setIsolatedNode=function(e){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(e,this._dvlRendererId)}return this};T.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId)}else{return sap.ve.dvl.DVLID_INVALID}};T.prototype._toDvlRendererCoord=function(e,t){if(this._matProj){var i=this.getDomRef();var r=L(this._matProj);var o=L(this._dvl.Renderer.GetCameraMatrices().projection);var n=r.left+(r.right-r.left)*(e/i.clientWidth);var a=r.top+(r.bottom-r.top)*(t/i.clientHeight);e=(n-o.left)/(o.right-o.left)*i.clientWidth;t=(a-o.top)/(o.bottom-o.top)*i.clientHeight}return{x:e*window.devicePixelRatio*this._gestureRatio,y:t*window.devicePixelRatio*this._gestureRatio}};T.prototype.hitTest=function(e,t){if(this._dvlRendererId){var i=this._toDvlRendererCoord(e,t);var r=this._dvl.Renderer.HitTest(i.x,i.y,this._dvlRendererId).id;this.setShouldRenderFrame();return r}else{return null}};T.prototype.setShowDebugInfo=function(e){this.setProperty("showDebugInfo",e,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,e,this._dvlRendererId)}return this};T.prototype._handleFrameFinished=function(e){if(e.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished()}};T.prototype.beginGesture=function(e,t){if(this._dvlRendererId){this._gesturePoint={x:e,y:t};var i=this._toDvlRendererCoord(e,t);this._dvl.Renderer.BeginGesture(i.x,i.y,this._dvlRendererId)}return this};T.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId)}return this};T.prototype._activateRedline=function(){this.renderFrame();var e=this._dvl.Renderer.GetCameraMatrices();this._matView=e.view;this._matProj=e.projection};T.prototype._deactivateRedline=function(){this._matView=null;this._matProj=null};T.prototype.pan=function(e,t){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){this._redlineHandler.pan(e,t)}if(this._matProj){var i=this.getDomRef();this._matProj[8]-=e*2/i.clientWidth;this._matProj[9]+=t*2/i.clientHeight;this.setShouldRenderFrame()}else{this._dvl.Renderer.Pan(e*window.devicePixelRatio*this._gestureRatio,t*window.devicePixelRatio*this._gestureRatio,this._dvlRendererId)}this.firePan({dx:e,dy:t})}return this};T.prototype.rotate=function(e,t){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){return this.pan(e,t)}this._dvl.Renderer.Rotate(e*window.devicePixelRatio*this._gestureRatio,t*window.devicePixelRatio*this._gestureRatio,this._dvlRendererId);this.fireRotate({dx:e,dy:t})}return this};function L(e){var t=e[15]===1;var i=2/e[0];var r=2/e[5];var o,n;if(t){o=-e[12]*i;n=-e[13]*r}else{o=e[8]*i;n=e[9]*r}var a=(i+o)*.5;var s=o-a;var d=(r+n)*.5;var l=n-d;return{left:s,top:d,right:a,bottom:l}}function B(e,t){var i=e[15]===1;e[0]=2/(t.right-t.left);e[5]=2/(t.top-t.bottom);if(i){e[12]=-(t.right+t.left)/(t.right-t.left);e[13]=-(t.top+t.bottom)/(t.top-t.bottom)}else{e[8]=(t.right+t.left)/(t.right-t.left);e[9]=(t.top+t.bottom)/(t.top-t.bottom)}}T.prototype.zoom=function(e){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){this._redlineHandler.zoom(e)}if(this._matProj){var t=this.getDomRef();var i=L(this._matProj);var r=i.left+(i.right-i.left)*this._gesturePoint.x/t.clientWidth;var o=i.top+(i.bottom-i.top)*this._gesturePoint.y/t.clientHeight;var n=1/e;i.left=r+(i.left-r)*n;i.right=r+(i.right-r)*n;i.top=o+(i.top-o)*n;i.bottom=o+(i.bottom-o)*n;B(this._matProj,i);this.setShouldRenderFrame()}else{this._dvl.Renderer.Zoom(e,this._dvlRendererId)}this.fireZoom({zoomFactor:e})}return this};T.prototype.zoomTo=function(e,t,i,r){if(this._dvlRendererId){var o=0;if(Array.isArray(e)){for(var n in e){o|=V.decodedZoomTo[e[n]]}}else{o=V.decodedZoomTo[e]}this._dvl.Renderer.ZoomTo(o,t,i,r,this._dvlRendererId)}return this};T.prototype._redlineZoomTo=function(e){var t=[Infinity,Infinity,-Infinity,-Infinity];if(e!==sap.ve.dvl.DVLID_INVALID){var i=this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_BBOX).bbox;var r=this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,e).matrix;if(i&&r){var o=l.vec3,n=l.mat4;var a=n.multiply(n.create(),this._matProj,this._matView);var s=n.multiply(n.create(),a,r);var d=i.min,h=i.max;[o.fromValues(d[0],d[1],d[2]),o.fromValues(h[0],h[1],h[2]),o.fromValues(d[0],d[1],h[2]),o.fromValues(d[0],h[1],h[2]),o.fromValues(h[0],d[1],h[2]),o.fromValues(h[0],h[1],d[2]),o.fromValues(d[0],h[1],d[2]),o.fromValues(h[0],d[1],d[2])].forEach(function(e){o.transformMat4(e,e,s);if(e[2]>0){t[0]=Math.min(t[0],e[0]);t[1]=Math.min(t[1],e[1]);t[2]=Math.max(t[2],e[0]);t[3]=Math.max(t[3],e[1])}})}}var v=L(this._matProj);this._anim={startTime:Date.now(),duration:500,startProjRect:v,currentProjRect:v};if(t[2]>t[0]&&t[3]>t[1]){var p=this._anim.startProjRect;var c=A(p.left,p.right,(t[0]+t[2])*.25+.5);var _=A(p.top,p.bottom,(t[3]+t[1])*-.25+.5);var f=Math.max(t[2]-t[0],t[3]-t[1])*.5;var u=(p.right-p.left)*.5*f;var m=(p.top-p.bottom)*.5*f;this._anim.endProjRect={left:c-u,top:_+m,right:c+u,bottom:_-m}}else{this._anim.endProjRect=L(this._dvl.Renderer.GetCameraMatrices().projection)}this.setShouldRenderFrame()};T.prototype.tap=function(e,t,i){if(this._dvlRendererId){var r=this._toDvlRendererCoord(e,t),o;if(!i){o=this.hitTest(e,t);var n={picked:o===sap.ve.dvl.DVLID_INVALID||o==null?[]:[o]};this.fireNodesPicked(n);if(this.getSelectionMode()===p.Exclusive){this.exclusiveSelectionHandler(n.picked)}else if(this.getSelectionMode()===p.Sticky){this.stickySelectionHandler(n.picked)}if(o!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:o,nodeId:o,x:e,y:t},true,true)}this._dvl.Renderer.Tap(r.x,r.y,false,false,this._dvlRendererId)}else if(!this.getFreezeCamera()){if(this._matView&&this._matProj){o=this.hitTest(e,t);this._redlineZoomTo(o)}else{this._dvl.Renderer.Tap(r.x,r.y,true,false,this._dvlRendererId)}}}return this};T.prototype.rectSelect=function(e,t,i,r){var o=[];if(this._dvlRendererId){var n=this._toDvlRendererCoord(e,t);var a=this._toDvlRendererCoord(i,r);var s=y(this._dvl.Renderer.RectSelect(n.x,n.y,a.x,a.y,this._dvlRendererId));if(s.SelectedNodes){o=s.SelectedNodes}}return o};T.prototype.queueCommand=function(e){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(e,this._dvlRendererId)}return this};T.prototype._setContent=function(e){O._setContent.apply(this,arguments);var t=null;if(e&&e instanceof g){t=e}this._setScene(t);return this};T.prototype._setScene=function(e){var t=e&&e.getGraphicsCore();this.setGraphicsCore(t);this.setScene(e);if(e&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler()}};T.prototype.onSetContentConnector=function(e){_.prototype.onSetContentConnector.call(this,e);e.attachContentChangesFinished(this._onContentChangesFinished,this)};T.prototype.onUnsetContentConnector=function(e){e.detachContentChangesFinished(this._onContentChangesFinished,this);_.prototype.onUnsetContentConnector.call(this,e)};T.prototype._onContentChangesFinished=function(e){if(e.getSource().getContentResources().length>1){this.zoomTo(m.Visible,sap.ve.dvl.DVLID_INVALID,0,0)}this.setShouldRenderFrame()};T.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachOpacityChanged(this._onOpacityChanged,this);e.attachSelectionChanged(this._onSelectionChanged,this);e.attachTintColorChanged(this._onTintColorChanged,this);e.attachVisibilityChanged(this._onVisibilityChanged,this);if(this._dvl){this._dvl.Renderer.SetViewStateManager(e,this._dvlRendererId);if(this._isSmart2DContent()||this._isSmart2DContentLegacy()){this._initializeSmart2DHandler()}}};T.prototype.onUnsetViewStateManager=function(e){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId)}e.detachOpacityChanged(this._onOpacityChanged,this);e.detachSelectionChanged(this._onSelectionChanged,this);e.detachTintColorChanged(this._onTintColorChanged,this);e.detachVisibilityChanged(this._onVisibilityChanged,this);this._viewStateManager=null};var x={x:-2,y:-2};var F=2;var G=5;[{key:"left",dx:-F,dy:0},{key:"right",dx:+F,dy:0},{key:"up",dx:0,dy:-F},{key:"down",dx:0,dy:+F}].forEach(function(e){T.prototype["onsap"+e.key]=function(t){this.beginGesture(x.x,x.y);this.rotate(e.dx,e.dy);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}});[{key:"left",dx:-G,dy:0},{key:"right",dx:+G,dy:0},{key:"up",dx:0,dy:-G},{key:"down",dx:0,dy:+G}].forEach(function(e){T.prototype["onsap"+e.key+"modifiers"]=function(t){if(t.shiftKey&&!(t.ctrlKey||t.altKey||t.metaKey)){this.beginGesture(x.x,x.y);this.pan(e.dx,e.dy);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}}});[{key:"minus",d:.98},{key:"plus",d:1.02}].forEach(function(e){T.prototype["onsap"+e.key]=function(t){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(e.d);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}});return T});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure");var r=t.getWidth();if(r){e.style("width",r)}var i=t.getHeight();if(i){e.style("height",i)}e.openEnd();t.renderTools(e);t.renderContent(e);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/checkResult", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(t<0){var i=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(t):"";e.error(i,JSON.stringify({errorCode:t}),"sap.ve.dvl");throw new r(t,i)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/getJSONObject", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(typeof t==="number"){var i=t;var n=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(i):"";e.error(n,JSON.stringify({errorCode:i}),"sap.ve.dvl");throw new r(i,n)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/getPointer", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(typeof t==="number"){var i=t;var n=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(i):"";e.error(n,JSON.stringify({errorCode:i}),"sap.ve.dvl");throw new r(i,n)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/findIndexInArray", [],function(){"use strict";var r=function(r,n,t){if(Array.isArray(r)&&typeof n==="function"){for(var i=0,e=r.length;i<e;i++){if(n.call(t,r[i],i,r)){return i}}}return-1};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/getResourceBundle", ["sap/ui/core/Core"],function(e){"use strict";return e.getLibraryResourceBundle.bind(e,"sap.ui.vk.i18n")},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/glMatrix", ["./thirdparty/gl-matrix"],function(r){"use strict";r.glMatrix.setMatrixArrayType(Float64Array);return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateOrbitHelperDvl", ["sap/ui/base/EventProvider"],function(e){"use strict";var t=e.extend("sap.ui.vk.helpers.RotateOrbitHelperDvl",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(e,t){this._tool=e;this._dvl=t;this._dvlRendererId=this._tool._viewport._dvlRendererId}});t.prototype.destroy=function(){this._rotateOrbitTool=null};t.prototype.activateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true)}return this};t.prototype.deactivateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false)}return this};t.prototype.rotate=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.Rotate(e*window.devicePixelRatio,t*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:e,dy:t})}return this};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateOrbitHelperThree", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.helpers.RotateOrbitHelperThree",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(t){this._tool=t}});e.prototype.destroy=function(){this._tool=null};e.prototype.activateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this};e.prototype.deactivateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this};e.prototype.rotate=function(t,e){this._tool._viewport._viewportGestureHandler._cameraController.rotate(t,e,false);return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateTurntableHelperDvl", ["sap/ui/base/EventProvider"],function(e){"use strict";var t=e.extend("sap.ui.vk.helpers.RotateTurntableHelperDvl",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(e,t){this._tool=e;this._dvl=t;this._dvlRendererId=this._tool._viewport._dvlRendererId}});t.prototype.destroy=function(){this._rotateOrbitTool=null};t.prototype.activateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false)}return this};t.prototype.deactivateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true)}return this};t.prototype.rotate=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.Rotate(e*window.devicePixelRatio,t*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:e,dy:t})}return this};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateTurntableHelperThree", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.helpers.RotateTurntableHelperThree",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(t){this._tool=t}});e.prototype.destroy=function(){this._tool=null};e.prototype.activateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this};e.prototype.deactivateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this};e.prototype.rotate=function(t,e){this._tool._viewport._viewportGestureHandler._cameraController.rotate(t,e,true);this._tool.fireRotate({dx:t,dy:e});return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/WorkerScriptLoader", ["sap/ui/thirdparty/URI"],function(t){"use strict";var i={};i.absoluteUri=function(i){var r=new t(sap.ui.require.toUrl(i));if(r.is("relative")){r=r.absoluteTo(new t(document.baseURI))}return r};i.loadScript=function(t,i){var r=this.absoluteUri(t);var e=[];if(i&&i.length>0){i.forEach(function(t){e.push("'"+this.absoluteUri(t)+"'")},this)}e.push("'"+r.toString()+"'");return new Worker((window.URL||window.webkitURL).createObjectURL(new Blob(["importScripts("+e.join()+");"],{type:"application/javascript"})))};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/library", ["sap/ui/core/Core","sap/base/util/ObjectPath","sap/ui/core/library","./BillboardBorderLineStyle","./BillboardCoordinateSpace","./BillboardHorizontalAlignment","./BillboardStyle","./BillboardTextEncoding","./CameraFOVBindingType","./CameraProjectionType","./ContentResourceSourceCategory","./ContentResourceSourceTypeToCategoryMap","./DetailViewShape","./DetailViewType","./DvlException","./IncludeUsageIdType","./LeaderLineMarkStyle","./MapContainerButtonType","./Redline","./RenderMode","./SelectionMode","./TransformationMatrix","./VisibilityMode","./ZoomTo","./abgrToColor","./colorToABGR","./cssColorToColor","./colorToCSSColor","./getResourceBundle","./utf8ArrayBufferToString","./dvl/GraphicsCoreApi","./dvl/checkResult","./dvl/getJSONObject","./dvl/getPointer","./tools/AxisColours","./tools/CoordinateSystem","./tools/HitTestClickType","./tools/HitTestIdMode","./tools/PredefinedView"],function(e,o){"use strict";var t=e.initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core"],interfaces:["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"],types:[],controls:["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.NodesTransitionHelper","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.svg.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.PoiManipulationTool"],noLibraryCSS:false,version:"1.108.4",designtime:"sap/ui/vk/designtime/library.designtime"});if(t==null){t=o.get("sap.ui.vk")}var a={};a["sap/ui/vk/thirdparty/three"]={exports:"THREE",amd:true};a["sap/ui/vk/thirdparty/html2canvas"]={exports:"html2canvas",amd:true};a["sap/ui/vk/thirdparty/gl-matrix"]={exports:"glMatrix",amd:true};a["sap/ui/vk/thirdparty/imagetracer"]={exports:"ImageTracer",amd:true};sap.ui.loader.config({shim:a});var i=function(e,o){var t="new extend getMetadata";if(o){t+=" "+o}sap.ui.lazyRequire("sap.ui.vk."+e,t)};i("AnimationPlayback");i("AnimationSequence");i("BaseNodeProxy");i("Camera");i("ContentConnector","registerSourceType");i("ContentManager");i("ContentResource");i("Core");i("DownloadManager");i("ImageContentManager");i("LayerProxy");i("Loco");i("Material");i("NodeHierarchy");i("NodeProxy");i("OrthographicCamera");i("PerspectiveCamera");i("RedlineDesignHandler");i("RedlineGesturesHandler");i("Scene");i("Smart2DHandler");i("Texture");i("View");i("ViewportHandler");i("dvl.BaseNodeProxy");i("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");i("dvl.GraphicsCore");i("dvl.LayerProxy");i("dvl.NodeHierarchy");i("dvl.NodeProxy");i("dvl.Scene");i("helpers.RotateOrbitHelperDvl");i("helpers.RotateOrbitHelperThree");i("helpers.RotateTurntableHelperDvl");i("helpers.RotateTurntableHelperThree");i("Highlight");i("svg.BaseNodeProxy");i("svg.ContentManager","registerLoader");i("svg.NodeHierarchy");i("svg.NodeProxy");i("svg.Scene");i("threejs.AnimationSequence");i("threejs.BaseNodeProxy");i("threejs.Billboard");i("threejs.Callout");i("threejs.ContentDeliveryService");i("threejs.ContentManager","registerLoader");i("threejs.DetailView");i("threejs.LayerProxy");i("threejs.Material");i("threejs.NodeHierarchy");i("threejs.NodeProxy");i("threejs.OrthographicCamera");i("threejs.PerspectiveCamera");i("threejs.Scene");i("threejs.Texture");i("threejs.Thrustline");i("threejs.ViewportGestureHandler");i("tools.AnchorPointToolHandler");i("tools.CrossSectionToolHandler");i("tools.HitTestToolHandler");i("tools.MoveToolHandler");i("tools.RectSelectToolHandler");i("tools.RotateToolHandler");i("tools.ScaleToolHandler");i("tools.TooltipToolHandler");return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/matai/MataiLoader", ["sap/base/Log","sap/ui/core/Core","sap/ui/base/ManagedObject","../getResourceBundle","../threejs/SceneBuilder","../svg/SceneBuilder","../helpers/WorkerScriptLoader","../DownloadManager"],function(e,r,t,a,n,o,s,i){"use strict";var u={FinishedTree:a().getText("SCENE_CONTEXT_FINISHED_TREE"),LoadingGeometries:a().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),LoadingTextures:a().getText("SCENE_CONTEXT_LOADING_TEXTURES"),LoadingModelViews:a().getText("SCENE_CONTEXT_LOADING_MODEL_VIEWS")};var c=t.extend("sap.ui.vk.matai.MataiLoader",{metadata:{library:"sap.ui.vk",events:{contentChangesProgress:{parameters:{source:"any",phase:"string",percent:"float"}},contentLoadingFinished:{parameters:{source:"any",node:"any"}}}}});var d=c.getMetadata().getName();function g(e,r,t){var a=e._progress;a.phase=r;a.count=t;var n=40+60*(a.totalCount?a.count/a.totalCount:1);e._loader.fireContentChangesProgress({source:e._contentResource&&e._contentResource.getSource(),phase:r,percentage:Math.min(n,100)})}var l=1;var E=new Map;var f=function(){var r;return function(){return r||(r=new Promise(function(r,t){var n=s.loadScript("sap/ui/vk/matai/MataiLoaderWorker.js",["sap/ui/vk/ve/matai.js"]);var o=0;var i=-1;var c=-2;var l=-3;var f=-4;var v=-5;var R=-6;var _=-7;var L=-8;function p(e){var r=a();switch(e){case i:return r.getText("LOADER_FILENOTFOUND");case c:return r.getText("LOADER_WRONGFILEFORMAT");case l:return r.getText("LOADER_WRONGPASSWORD");case f:return r.getText("LOADER_ERRORREADINGFILE");case v:return r.getText("LOADER_FILECONTENT");case R:return r.getText("LOADER_NODEFAULTVIEW");case _:return r.getText("LOADER_FILECONTENT");case L:return r.getText("LOADER_ERRORREADINGREFERENCEDFILE");default:return r.getText("LOADER_UNKNOWNERROR")}}function T(r,t,a){var n=p(t);r._reject({status:t,errorText:n});e.error(n,a,d);O(r,t)}function O(r,t){e.info("Matai loading finished");r.loadingFinished({result:t});r._loader.fireContentLoadingFinished({source:r._contentResource,node:r._rootNode});r._loader=null;var a=r._id;n.postMessage({method:"destroyContext",args:{sceneBuilderId:a}});E.delete(a)}n.onmessage=function(t){var s=t.data;if(s.event==="runtimeCreated"){r(this);return}var i=s.sceneBuilderId;var c=E.get(i);var l=c.sceneBuilder;if("event"in s){switch(s.event){case"contextCreated":if(s.result===o){n.postMessage({method:"loadFile",args:{sceneBuilderId:i}})}else{T(l,s.result)}break;case"fileLoaded":if(s.result===o){if(c.waitingCount===0){n.postMessage({method:"buildScene",args:{sceneBuilderId:i}})}}else{T(l,s.result)}break;case"referencedFileLoaded":c.waitingCount-=1;if(s.result!==o){e.error(p(s.result),s.fileName,d)}if(c.waitingCount===0){n.postMessage({method:"buildScene",args:{sceneBuilderId:i}})}break;case"referencedFileRequested":var f=c.dependencyLoader;if(f==null){e.error(a().getText("LOADER_NODEPENDENCYLOADER"),null,d)}else{var v=s.fileName;var R=s.veId;var _=s.veVersion;var L=c.files;var m=L.get(v);if(m==null){m=f.load(v);L.set(v,m)}c.waitingCount+=1;m.then(function(e){var r=e.buffer;e.buffer=null;n.postMessage({method:"loadReferencedFile",args:{sceneBuilderId:i,buffer:r,fileName:v,veId:R,veVersion:_}},r==null?[]:[r])},function(){c.waitingCount-=1;e.error(a().getText("LOADER_ERRORREADINGREFERENCEDFILE"),v,d);if(c.waitingCount===0){n.postMessage({method:"buildScene",args:{sceneBuilderId:i}})}})}break;case"sceneBuilt":O(l,s.result);break;default:break}}else{try{l[s.method].apply(l,s.args)}catch(r){e.error("SceneBuilder."+s.method+"()",r)}switch(s.method){case"setScene":var N=s.args[0];l._progress.totalCount=N.meshCount+N.imageCount+N.modelViewCount;g(l,u.FinishedTree,0);break;case"setGeometry":g(l,u.LoadingGeometries,l._progress.count+1);break;case"createImage":g(l,u.LoadingTextures,l._progress.count+1);break;case"createThumbnail":g(l,u.LoadingModelViews,l._progress.count+1);break;default:break}}};n.onerror=function(e){t(e)};var m=s.absoluteUri("sap/ui/vk/ve/").toString();n.postMessage({method:"createRuntime",args:{scriptDirectory:m}})}))}}();function v(t,s,i,u,c,d,g){var v=c.getDependencyLoader();f().then(function(f){f.onerror=function(r){e.error("Error in WebWorker",r);g(a().getText("LOADER_ERRORREADINGFILE"))};var R=new(u.isObject3D?n:o)(u,c,d,g);R._loader=t;R._progress={};R._id=l++;E.set(R._id,{sceneBuilder:R,dependencyLoader:v,files:new Map,waitingCount:0});f.postMessage({method:"createContext",args:{sceneBuilderId:R._id,buffer:s,fileName:i,locale:r.getConfiguration().getLanguageTag()}},[s])},function(e){g(e)})}c.prototype.load=function(e,r,t,n){var o=this;return new Promise(function(s,u){if(typeof r.getSource()==="string"){var c=r.getSource();new i([c],undefined,t,n).attachItemSucceeded(function(t){var a=t.getParameter("source");var n=t.getParameter("response");v(o,n,a,e,r,s,u)},this).attachItemFailed(function(e){var r=e.getParameter("statusText");if(r===""){r=a().getText("VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE")}u(r)},this).start()}else if(r.getSource()instanceof File){var d=new FileReader;d.onload=function(t){v(o,t.target.result,r.getSource().name,e,r,s,u)};d.onerror=function(e){u(e)};d.readAsArrayBuffer(r.getSource())}})};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Angle", ["./Measurement","./MeasurementType","./Utils"],function(t,i,e){"use strict";var o=function(i){t.apply(this,arguments);this._angle=i&&"angle"in i?i.angle:0;this._state=i&&"state"in i?i.state:0;this._scale=i&&"scale"in i?i.scale:1;this._point1=i&&"point1"in i?i.point1.slice():[0,0,0];this._point2=i&&"point2"in i?i.point2.slice():[0,0,0];this._point3=i&&"point3"in i?i.point3.slice():[0,0,0];this._point4=i&&"point4"in i?i.point4.slice():[0,0,0]};o.prototype=Object.create(t.prototype);o.prototype.constructor=o;o.prototype.isAngle=true;t._classMap.set(i.Angle,o);o.prototype.getAngle=function(){return this._angle};o.prototype.setAngle=function(t){this._angle=t;return this};o.prototype.getState=function(){return this._state};o.prototype.setState=function(t){this._state=t;return this};o.prototype.getPoint1=function(){return this._point1};o.prototype.setPoint1=function(t){var i=this._point1;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint2=function(t){var i=this._point2;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint3=function(t){var i=this._point3;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint4=function(t){var i=this._point4;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.getRadiusScale=function(){return this._scale};o.prototype.setRadiusScale=function(t){this._scale=t;return this};o.prototype.setAngleRadius=function(t,i,o,n,r,s){var a=e.computeEdgeDirection(i,t);var p=e.computeEdgeDirection(n,r);var c=e.computeEdgeDirection(o,s);var u=e.computePointToPointDistance(s,o);var h=e.computePointToPointDistance(r,o);var l=e.computePointToPointDistance(n,o);if(l>h){h=l}var v=h>0?u/h:1;var _=e.angleBetweenVectors2D(a[0],a[1],c[0],c[1]);var f=e.angleBetweenVectors2D(a[0],a[1],p[0],p[1]);if(_<0){_+=2*Math.PI}if(f<0){f+=2*Math.PI;if(_<f){v=-v}}else if(_>f){v=-v}return this.setRadiusScale(v)};o.prototype.toString=function(){return"{ visible: "+this._visible+", angle: "+this._angle+", state: "+this._state+", scale: "+this._scale+", p1: ["+this._point1.join(", ")+"]"+", p2: ["+this._point2.join(", ")+"]"+", p3: ["+this._point3.join(", ")+"]"+", p4: ["+this._point4.join(", ")+"]"+" }"};o.prototype.isEdge1Defined=function(){var t=this._point1;var i=this._point2;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.isEdge2Defined=function(){var t=this._point3;var i=this._point4;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.getPoints=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;var r=t;var s=i;var a=i;var p=i;var c=i;var u=i;var h;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var l=e.findClosestPointEdgeToEdge([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);a=[l[0],l[1],l[2]];u=[l[3],l[4],l[5]];var v=e.computeEdgeDirection(t,i);var _=e.computeEdgeDirection(o,n);var f=e.compareNormal(v,_,true)?null:e.findClosestPointLineToLine([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);if(f){h=e.computePointToPointDistance2(t,a)>e.computePointToPointDistance2(i,a);r=h?t:i;s=h?i:t;h=e.computePointToPointDistance2(o,u)>e.computePointToPointDistance2(n,u);p=h?n:o;c=h?o:n}else if(e.compareNormal(v,_,false)){p=o;c=n}else{p=n;c=o}}return[r[0],r[1],r[2],s[0],s[1],s[2],a[0],a[1],a[2],u[0],u[1],u[2],p[0],p[1],p[2],c[0],c[1],c[2]]};o.prototype.computeAngle=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var r=e.computeEdgeDirection(i,t);var s=e.computeEdgeDirection(o,n);var a=e.dotProduct(r,s);this.setAngle(Math.acos(a))}else{this.setAngle(0)}};o.prototype.toJSON=function(){return{type:i.Angle,id:this._id,visible:this._visible,angle:this._angle,state:this._state,scale:this._scale,point1:Array.from(this._point1),point2:Array.from(this._point2),point3:Array.from(this._point3),point4:Array.from(this._point4),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Area", ["./Measurement","./MeasurementType","./Utils"],function(t,i,o){"use strict";var e=function(i){t.apply(this,arguments);this._area=i&&"area"in i?i.area:0;this._position=i&&"position"in i?i.position.slice():[0,0,0];this._points=i&&"points"in i?i.points.slice():[]};e.prototype=Object.create(t.prototype);e.prototype.constructor=e;e.prototype.isArea=true;t._classMap.set(i.Area,e);e.prototype.getPoints=function(){return this._points};e.prototype.getPosition=function(){return this._position};e.prototype.getArea=function(){return this._area};e.prototype.duplicateLastPoint=function(){var t=this._points;var i=t.length-3;t.push(t[i]);t.push(t[i+1]);t.push(t[i+2]);this.updateContourPositionAndArea();return this};e.prototype.replaceLastPoints=function(t,i,o){if(t){this._points.splice(-t*3,t*3)}if(o){for(var e=i.length-3;e>=0;e-=3){this._points.push(i[e],i[e+1],i[e+2])}}else{this._points=this._points.concat(i)}this.updateContourPositionAndArea();return this};e.prototype.replaceLastPoint=function(t){var i=this._points;var o=i.length-3;i[o]=t[0];i[o+1]=t[1];i[o+2]=t[2];this.updateContourPositionAndArea();return this};e.prototype.deletePredLastPoints=function(t){var i=this._points;var o=i.pop();var e=i.pop();var s=i.pop();var n=(t-1)*3;if(n>0){this._points.splice(-n,n)}var r=i.length;if(r>=3){i[r-3]=s;i[r-2]=e;i[r-1]=o}this.updateContourPositionAndArea();return this};e.prototype.toString=function(){return"{ visible: "+this._visible+", area: "+this._area+", position: ["+this._position.join(", ")+"]"+", points: ["+this._points.join(", ")+"]"+" }"};e.prototype.updateContourPositionAndArea=function(){var t=this._points;var i=t.length;if(o.equalPoints(t,0,t,i-3)){i-=3}var e=0;var s=0;var n=0;var r;for(var a=0;a<i;a+=3){var p=a+3;if(p>=i){p=0}e+=t[a]*t[p+1]-t[a+1]*t[p];r=t[a]*t[p+1]-t[p]*t[a+1];s+=(t[a]+t[p])*r;n+=(t[a+1]+t[p+1])*r}e*=.5;r=i>=9?1/(6*e):0;this._position=[s*r,n*r,0];this._area=i<9?null:-Math.abs(e)};e.prototype.setFromFace=function(t){var i=t.getValue();var e=i.vertices;if(t.isClosedContour()){this._points=Array.from(e);this.updateContourPositionAndArea()}else{var s=i.triangles;var n,r,a=0;var p=[0,0,0];for(var u=0,h=s.length;u<h;u+=3){n=o.computeTriangleArea(e,s[u]*3,s[u+1]*3,s[u+2]*3);r=o.computeTriangleAverageCoordinate(e,s[u]*3,s[u+1]*3,s[u+2]*3);p[0]+=n*r[0];p[1]+=n*r[1];p[2]+=n*r[2];a+=n}this._area=a;this._position=o.scalePoint(p,1/a)}};e.prototype.finalize=function(){var t=this._points;if(o.isClosedContour(t)){t.pop();t.pop();t.pop()}this._area=Math.abs(this._area)};e.prototype.hasSelfIntersections=function(){return o.hasSelfIntersections(this._points,false)};e.prototype.hasSelfIntersectionsLastEdge=function(){return o.hasSelfIntersectionsLastEdge(this._points)};e.prototype.toJSON=function(){return{type:i.Area,id:this._id,visible:this._visible,area:this._area,position:Array.from(this._position),points:Array.from(this._points),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/ColorRadioButton", ["sap/m/RadioButton"],function(e){"use strict";var o=e.extend("sap.ui.vk.measurements.ColorRadioButton",{metadata:{library:"sap.ui.vk",properties:{color:"sap.ui.core.CSSColor"}},renderer:{apiVersion:2,render:function(e,o){e.openStart("div",o).class("sapUiVizKitMeasurementColorRb").attr("tabindex",o.hasOwnProperty("_iTabIndex")?o._iTabIndex:0);if(o.getSelected()){e.class("sapUiVizKitMeasurementColorRbSel")}e.openEnd();e.openStart("div").style("background-color",o.getColor()).openEnd().close("div");e.close("div")}}});return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Distance", ["./Measurement","./MeasurementType"],function(t,o){"use strict";var i=function(o){t.apply(this,arguments);this._showArrows=o&&"showArrows"in o?o.showArrows:true;this._point1=o&&"point1"in o?o.point1.slice():[0,0,0];this._point2=o&&"point2"in o?o.point2.slice():[0,0,0]};i.prototype=Object.create(t.prototype);i.prototype.constructor=i;i.prototype.isDistance=true;t._classMap.set(o.Distance,i);i.prototype.getShowArrows=function(){return this._showArrows};i.prototype.setShowArrows=function(t){this._showArrows=t;return this};i.prototype.getPoint1=function(){return this._point1};i.prototype.setPoint1=function(t){var o=this._point1;o[0]=t[0];o[1]=t[1];o[2]=t[2];return this};i.prototype.getPoint2=function(){return this._point2};i.prototype.setPoint2=function(t){var o=this._point2;o[0]=t[0];o[1]=t[1];o[2]=t[2];return this};i.prototype.toString=function(){return"{ visible: "+this._visible+", showArrows: "+this._showArrows+", p1: ["+this._point1.join(", ")+"]"+", p2: ["+this._point2.join(", ")+"]"+" }"};i.prototype.getDistance=function(){var t=this._point1;var o=this._point2;var i=t[0]-o[0];var r=t[1]-o[1];var n=t[2]-o[2];return Math.sqrt(i*i+r*r+n*n)};i.prototype.toJSON=function(){return{type:o.Distance,id:this._id,visible:this._visible,showArrows:this._showArrows,point1:Array.from(this._point1),point2:Array.from(this._point2),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Edge", ["sap/base/assert","./Feature","./FeatureType"],function(e,t,r){"use strict";var o=[0,0,0,0,0,0];var s=function(e){t.apply(this,arguments);this._edge=new Float64Array(6);this.setValue(e&&e.edge||o)};s.prototype=Object.create(t.prototype);s.prototype.constructor=s;s.prototype.isEdge=true;t._classMap.set(r.Edge,s);s.prototype.setValue=function(t){e(t.length===6,"Edge array must have 6 elements");this._edge.set(t);return this};s.prototype.getValue=function(){return this._edge};s.prototype.toJSON=function(){return{type:r.Edge,edge:Array.from(this._edge)}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Face", ["sap/base/assert","./Feature","./FeatureType","./Utils"],function(e,n,t,r){"use strict";var a={vertices:[0,0,0],triangles:null,boundingSpheres:null,edges:null,planeEquation:null};var s=function(e){n.apply(this,arguments);this._face={};this.setValue(e&&e.face||a)};s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.isFace=true;n._classMap.set(t.Face,s);s.prototype.isClosedContour=function(){return!this._face.triangles};s.prototype.setValue=function(n){e(n.vertices.length%3===0,"Vertices array must have 3x elements");var t=this._face;t.vertices=new Float64Array(n.vertices);if(!n.triangles){t.triangles=null;t.boundingSpheres=null;t.edges=null;t.planeEquation=null;return this}var a=t.vertices;e(n.triangles.length%3===0,"Triangles array must have 3x elements");t.triangles=new Int32Array(n.triangles);var s=t.triangles;var i,l,o,u;var g,p,h;if(n.boundingSpheres){e(n.boundingSpheres.length%4===0,"Bounding spheres must have 4x elements");e(n.boundingSpheres.length/4===n.triangles.length/3,"Number of triangles and bounding spheres must match");t.boundingSpheres=new Float64Array(n.boundingSpheres)}else{t.boundingSpheres=new Float64Array(4*(s.length/3));var c=0;for(g=0,h=s.length;g<h;g+=3){i=s[g]*3;l=[a[i],a[i+1],a[i+2]];i=s[g+1]*3;o=[a[i],a[i+1],a[i+2]];i=s[g+2]*3;u=[a[i],a[i+1],a[i+2]];r.computeTriangleBoundingSphere(l,o,u,t.boundingSpheres,c);c+=4}}if(n.edges){e(n.edges.length%2===0,"Edges array must have 2x elements");t.edges=new Int32Array(n.edges)}else{var f=new Set;for(g=0,h=s.length;g<h;g+=3){for(p=0;p<3;++p){l=s[g+p];o=s[g+(p+1)%3];if(l<o){i=l+":"+o}else{i=o+":"+l}if(f.has(i)){f.delete(i)}else{f.add(i)}}}g=0;t.edges=new Int32Array(f.size*2);f.forEach(function(e){i=e.split(":");t.edges[g]=Number(i[0]);t.edges[g+1]=Number(i[1]);g+=2})}if(n.planeEquation){e(n.planeEquation.length===4,"Plane equation have 4 elements");t.planeEquation=new Float64Array(n.planeEquation)}else{e(s.length>=3,"Expecting at least one triangle");t.planeEquation=new Float64Array(r.computePlaneEquation(a,s[0]*3,s[1]*3,s[2]*3))}return this};s.prototype.getValue=function(){return this._face};s.prototype.toJSON=function(e){var n=this._face;var r={type:t.Face,face:{vertices:Array.from(n.vertices)}};if(n.triangles){r.face.triangles=Array.from(n.triangles)}if(e){if(n.boundingSpheres){r.face.boundingSpheres=Array.from(n.boundingSpheres)}if(n.edges){r.face.edges=Array.from(n.edges)}if(n.planeEquation){r.face.planeEquation=Array.from(n.planeEquation)}}return r};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Feature", ["sap/base/Log"],function(t){"use strict";var e=function(t){this._context=t!=null&&"context"in t?t.context:null;this._featureId=t!=null&&"featureId"in t?t.featureId:null};e.prototype.isFeature=true;e._classMap=new Map;e.prototype.setContext=function(t){this._context=t;return this};e.prototype.getContext=function(){return this._context};e.prototype.setFeatureId=function(t){this._featureId=t;return this};e.prototype.getFeatureId=function(){return this._featureId};e.prototype.toJSON=function(){return{}};e.createFromJSON=function(n){if(n!=null){var r=e._classMap.get(n.type);if(r){return new r(n)}t.warning("Unknown feature type:",n.type)}return null};e.prototype.clone=function(){return e.createFromJSON(this.toJSON(true))};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/FeatureType", [],function(){"use strict";var e={Vertex:"Vertex",Edge:"Edge",Face:"Face"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Measurement", ["sap/base/Log","./Feature","../uuidv4"],function(t,e,i){"use strict";var r=function(t){this._id=t&&"id"in t?t.id:i();this._visible=t&&"visible"in t?t.visible:true;this._highlighted=false;this._features=[];if(t.features){t.features.forEach(function(t){this._features.push(e.createFromJSON(t))},this)}};r.prototype.isMeasurement=true;r._classMap=new Map;r.prototype.getId=function(){return this._id};r.prototype.getVisible=function(){return this._visible};r.prototype.setVisible=function(t){this._visible=t;return this};r.prototype.setHighlighted=function(t){this._highlighted=t;return this};r.prototype.getHighlighted=function(){return this._highlighted};r.prototype.setFeatures=function(t){this._features=t.map(function(t){return t!=null?t.clone():null});return this};r.prototype.getFeatures=function(){return this._features};r.createFromJSON=function(e){if(e!=null){var i=r._classMap.get(e.type);if(i){return new i(e)}t.warning("Unknown measurement type:",e.type)}return null};r.prototype.clone=function(){return r.createFromJSON(this.toJSON())};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeasurementType", [],function(){"use strict";var e={Angle:"Angle",Distance:"Distance",Area:"Area"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeshAnalyzer", ["./Utils"],function(e){"use strict";var t=new Float64Array(3);var r=new Float64Array(3);var i=new Float64Array(3);var n=new Uint32Array(3);var a=new Float64Array(3*3);function s(e,t){var r=e*3;var i=t*2;this._vertices=new Float64Array((r+i)*3);this._vertexCount=0;this._vertexToVertexIndices=new Uint32Array((e*3+t*2)*2);this._vertexToVertexConnectivity=new Uint32Array((r+i)*2);this._vertexToVertexEdgeId=null;this._triangles=new Uint32Array(e*3);this._triangleFaceId=new Uint32Array(e);this._triangleFaceId.fill(4294967295);this._triangleDoubleSidedFlag=new Uint8Array(e);this._triangleCount=0;this._triangleBoundingSphere=null;this._lines=new Uint32Array(t*2);this._lineCount=0;this._vertexSearchMap=new Map;this._vertexNextIndexWithSameHash=new Uint32Array(e*3);this._indexSearchMap=new Map;this._vertexTriangleIndices=new Uint32Array(e*3);this._vertexTriangleUsage=new Uint32Array(r*2)}s.prototype._pointsEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]};s.prototype._hashTypedArray=function(e){var t=new Uint8Array(e.buffer);var r=2166136261;for(var i=0,n=t.length;i<n;++i){r^=t[i];r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)}return r>>>0};s.prototype._addVertex=function(e){var t=this._hashTypedArray(e);var r;var i=this._vertexSearchMap.get(t);var n;if(i!==undefined){do{n=i*3;if(this._vertices[n]===e[0]&&this._vertices[n+1]===e[1]&&this._vertices[n+2]===e[2]){return i}r=i;i=this._vertexNextIndexWithSameHash[i]}while(i>0)}n=this._vertexCount*3;this._vertices[n]=e[0];this._vertices[n+1]=e[1];this._vertices[n+2]=e[2];if(r!==undefined){this._vertexNextIndexWithSameHash[r]=this._vertexCount}else{this._vertexSearchMap.set(t,this._vertexCount)}return this._vertexCount++};s.prototype._finishMeshBuildingPart1=function(){this._vertexSearchMap=undefined;this._vertexNextIndexWithSameHash=undefined;this._indexSearchMap=undefined;this._buildVertexTriangleUsage();this._buildFaceIds();var e=this._buildEdges();return e};s.prototype._finishMeshBuildingPart2=function(e){this._vertexTriangleIndices=undefined;this._vertexTriangleUsage=undefined;this._buildEdgeIds(e);this._triangleBoundingSphere=new Float64Array(this._triangleCount*4);this._computeBoundingSpheres()};s.prototype.finishMeshBuilding=function(){var e=this._finishMeshBuildingPart1();this._finishMeshBuildingPart2(e)};s.prototype._buildVertexTriangleUsage=function(){var e=0;var t=this._vertexCount;var r;for(r=0;r<t;++r){this._vertexTriangleUsage[r*2]=e;e+=this._vertexTriangleUsage[r*2+1];this._vertexTriangleUsage[r*2+1]=0}var i;var n;var a;var s=this._triangleCount;for(r=0;r<s;++r){for(a=0;a<3;++a){i=this._triangles[r*3+a];t=this._vertexTriangleUsage[i*2+1];n=this._vertexTriangleUsage[i*2]+t;this._vertexTriangleIndices[n]=r;t++;this._vertexTriangleUsage[i*2+1]=t}}};s.prototype._buildEdges=function(){var e=0;var t;var r;var i;var n;var a;var s;var v;var o;var h;var l=this._lineCount;var u;var _;var g=new Set;var d=this._vertexToVertexIndices;var x;var c=function(t){d[e]=Number(t.split(":")[0]);e++};for(var f=0,p=this._vertexCount;f<p;++f){this._vertexToVertexConnectivity[f*2]=e;u=e;t=this._vertexTriangleUsage[f*2];r=t+this._vertexTriangleUsage[f*2+1];g.clear();for(i=t;i<r;++i){n=this._vertexTriangleIndices[i];_=this._triangleFaceId[n];n*=3;for(a=0;a<3;++a){s=this._triangles[n+a];if(s!==f){x=s+":"+_;if(g.has(x)){g.delete(x)}else{g.add(x)}}}}g.forEach(c);for(v=0;v<l;++v){o=this._lines[v*2];h=this._lines[v*2+1];if(o===f){d[e]=h;e++}else if(h===f){d[e]=o;e++}}this._vertexToVertexConnectivity[f*2+1]=e-u}return e};s.prototype.addTriangle=function(n,a,s){if(this._triangleCount*3+3>this._triangles.length){return-1}t.set([n[0],n[1],n[2]]);r.set([a[0],a[1],a[2]]);i.set([s[0],s[1],s[2]]);if(this._pointsEqual(t,r)||this._pointsEqual(t,i)||this._pointsEqual(r,i)){return-2}if(e.isDegenerateTriangle(t,r,i)){return-3}var v=this._addVertex(t);var o=this._addVertex(r);var h=this._addVertex(i);var l=[h,v,o];if(v<o){if(v<h){l=[v,o,h]}}else if(o<h){l=[o,h,v]}var u=l[0]+":"+l[1]+":"+l[2];var _=this._indexSearchMap.get(u);if(_!==undefined){return _}_=this._indexSearchMap.get(l[0]+":"+l[2]+":"+l[1]);if(_!==undefined){this._triangleDoubleSidedFlag[_]=true;return _}this._indexSearchMap.set(u,this._triangleCount);var g=this._triangleCount*3;this._triangles[g]=l[0];this._triangles[g+1]=l[1];this._triangles[g+2]=l[2];this._vertexTriangleUsage[v*2+1]++;this._vertexTriangleUsage[o*2+1]++;this._vertexTriangleUsage[h*2+1]++;return this._triangleCount++};s.prototype.addLine=function(e,i){if(this._lineCount*2+2>this._lines.length){return-1}t.set([e[0],e[1],e[2]]);r.set([i[0],i[1],i[2]]);if(this._pointsEqual(t,r)){return-2}var n=this._addVertex(t);var a=this._addVertex(r);var s=n<a?[n,a]:[a,n];var v=s[0]+":"+s[1];var o=this._indexSearchMap.get(v);if(o!==undefined){return o}this._indexSearchMap.set(v,this._lineCount);var h=this._lineCount*2;this._lines[h]=s[0];this._lines[h+1]=s[1];return this._lineCount++};s.prototype._buildFaceIds=function(){var t=new Uint8Array(this._triangleCount);var r=[];var i;var n;var a;var s;var v;var o;var h;var l;var u;var _;var g;var d;var x;var c;var f;var p;var T=0;for(var y=0,V=this._triangleCount;y<V;++y){if(t[y]===0){i=this.isTriangleDoubleSided(y);n=this.computeTriangleNormal(y);this._triangleFaceId[y]=T;r.push(y);while(r.length>0){a=r.pop();t[a]=1;s=a*3;for(v=0;v<3;++v){o=this._triangles[s+v];h=this._triangles[s+(v+1)%3];l=this._triangles[s+(v+2)%3];u=this._vertexTriangleUsage[o*2];_=u+this._vertexTriangleUsage[o*2+1];for(g=u;g<_;++g){d=this._vertexTriangleIndices[g];x=false;c=d*3;for(f=0;f<3;++f){p=this._triangles[c+f];if(p===h||p===l){x=true}}if(x&&!t[d]&&this._triangleFaceId[d]!==T){this._triangleFaceId[d]=T;if(e.compareNormal(n,this.computeTriangleNormal(d),i||this.isTriangleDoubleSided(d))){r.push(d)}}}}}T++}}};s.prototype._buildEdgeIds=function(t){this._vertexToVertexEdgeId=new Int32Array(t);var r=new Uint8Array(t);var i=1;var n=new Float64Array(3);var a=new Float64Array(3);var s=new Float64Array(3);var v=new Float64Array(3);var o;var h;var l;var u;var _;var g;var d;var x;var c;var f;var p;var T;for(var y=0,V=this._vertexCount;y<V;++y){n.set(this.getVertex(y));o=this._vertexToVertexConnectivity[y*2];h=o+this._vertexToVertexConnectivity[y*2+1];for(l=o;l<h;++l){if(r[l]===0){r[l]=1;u=this._vertexToVertexIndices[l];if(u<y){this._vertexToVertexEdgeId[l]=0;continue}this._vertexToVertexEdgeId[l]=i;_=y;g=u;a.set(this.getVertex(g));e.computeEdgeDirection(n,a,s);n.set(a);for(d=0;d<2;++d){x=true;while(x){x=false;c=this._vertexToVertexConnectivity[g*2];f=c+this._vertexToVertexConnectivity[g*2+1];for(p=c;p<f;++p){T=this._vertexToVertexIndices[p];if(T!==_&&r[p]===0&&this._vertexToVertexEdgeId[p]!==i){this._vertexToVertexEdgeId[p]=i;a.set(this.getVertex(T));e.computeEdgeDirection(n,a,v);if(e.compareNormal(s,v)){_=g;g=T;r[p]=1;n.set(a);x=true;if(d>0){this._vertexToVertexEdgeId[p]=-this._vertexToVertexEdgeId[p]}break}}}}_=u;g=y;n.set(this.getVertex(y));s[0]=-s[0];s[1]=-s[1];s[2]=-s[2]}i++}}}};s.prototype._computeBoundingSpheres=function(){var t=0;var r=0;var i;var n;var a;for(var s=0,v=this._triangleCount;s<v;++s){i=this.getVertex(this._triangles[t]);n=this.getVertex(this._triangles[t+1]);a=this.getVertex(this._triangles[t+2]);e.computeTriangleBoundingSphere(i,n,a,this._triangleBoundingSphere,r);t+=3;r+=4}};s.prototype.intersectSphere=function(t,r,i,s,v,o,h){var l=a.subarray(0,3);var u=a.subarray(3,6);var _=a.subarray(6,9);var g={faceId:null,faceDistance:null,edgeId:null,edgeDistance:null,vertexId:null,vertexDistance:null};var d=null;var x=null;var c;var f;var p;var T;var y;var V;var I;var C;var w;var S;var U=r*r;var E=s||v;for(var A=0,b=this._triangleCount;A<b;++A){c=e.computePointToPointDistance(this._triangleBoundingSphere,t,A*4);if(c>r+this._triangleBoundingSphere[A*4+3]){continue}for(f=0;f<3;f++){n[f]=this._triangles[A*3+f]}l.set(this.getVertex(n[0]));u.set(this.getVertex(n[1]));_.set(this.getVertex(n[2]));if(i){p=e.getNearestPointOnTriangle(a,t);T=e.computePointToPointDistance2(p,t);if(T>U){continue}if(!g.faceDistance||T<g.faceDistance){g.faceDistance=T;g.faceId=this._triangleFaceId[A]}}if(E){for(y=0;y<3;++y){if(y===0){V=l}else if(y===1){V=u}else{V=_}if(s){I=(y+1)%3;if(I===0){C=l}else if(I===1){C=u}else{C=_}w=e.computeEdgeToPointDistance2(V,C,t);if(w<=U&&(!g.edgeDistance||w<g.edgeDistance)){g.edgeDistance=w;d=n[y];x=n[I]}}if(v){S=e.computePointToPointDistance2(V,t);if(S<=U&&(!g.vertexDistance||S<g.vertexDistance)){g.vertexDistance=S;g.vertexId=n[y]}}}}}if(g.edgeDistance!==null){g.edgeId=this.getEdgeId(d,x)}return g};s.prototype.getEdgeId=function(e,t){var r=e<t?[e,t]:[t,e];var i=this._vertexToVertexConnectivity[r[0]*2];var n=i+this._vertexToVertexConnectivity[r[0]*2+1];for(var a=i;a<n;++a){if(r[1]===this._vertexToVertexIndices[a]){var s=this._vertexToVertexEdgeId[a];return s<0?-s:s}}return null};s.prototype.buildEdgePath=function(e,t){var r=[];var i=0;var n=null;var a=null;var s;var v;var o;var h;var l;var u=-e;while(i<this._vertexCount){s=this._vertexToVertexConnectivity[i*2];v=s+this._vertexToVertexConnectivity[i*2+1];for(o=s;o<v;++o){l=this._vertexToVertexEdgeId[o];if(l===e){n=this._vertexToVertexIndices[o]}else if(l===u){a=this._vertexToVertexIndices[o]}}if(n){h=this.getVertex(i);r.push(h[0]);r.push(h[1]);r.push(h[2]);break}i++}while(n){s=this._vertexToVertexConnectivity[n*2];v=s+this._vertexToVertexConnectivity[n*2+1];h=this.getVertex(n);if(t&&r.length===6){r[3]=h[0];r[4]=h[1];r[5]=h[2]}else{r.push(h[0]);r.push(h[1]);r.push(h[2])}n=null;for(o=s;o<v;++o){if(this._vertexToVertexEdgeId[o]===e){n=this._vertexToVertexIndices[o];break}}}while(a){s=this._vertexToVertexConnectivity[a*2];v=s+this._vertexToVertexConnectivity[a*2+1];h=this.getVertex(a);if(t&&r.length===6){r[0]=h[0];r[1]=h[1];r[2]=h[2]}else{r.unshift(h[0],h[1],h[2])}a=null;for(o=s;o<v;++o){if(this._vertexToVertexEdgeId[o]===u){a=this._vertexToVertexIndices[o];break}}}return r};s.prototype.buildFace=function(t){var r=this._triangleCount;var i=this._triangleFaceId;var n=this._triangleBoundingSphere;var a=this._triangles;var s=0;var v=this._vertices;var o=[1,0,0,0];var h=new Uint32Array(this._vertexCount);var l=0;var u;for(u=0;u<r;++u){if(i[u]===t){l++}}var _=new Uint32Array(l*3);var g=new Float64Array(l*4);var d=new Set;var x;var c;var f;var p;var T;l=0;for(u=0;u<r;++u){if(i[u]===t){for(x=0;x<3;++x){f=a[u*3+x];p=h[f];if(p===0){++s;h[f]=s;p=s}_[l*3+x]=p-1}for(x=0;x<4;++x){g[l*4+x]=n[u*4+x]}for(x=0;x<3;++x){c=_[l*3+x];p=_[l*3+(x+1)%3];if(c<p){T=c+":"+p}else{T=p+":"+c}if(d.has(T)){d.delete(T)}else{d.add(T)}}if(l===0){var y=a[u*3]*3;var V=a[u*3+1]*3;var I=a[u*3+2]*3;o=e.computePlaneEquation(v,y,V,I)}l++}}var C=new Float64Array(s*3);for(u=0,l=this._vertexCount;u<l;++u){p=h[u];if(p!==0){x=(p-1)*3;c=u*3;C[x]=v[c];C[x+1]=v[c+1];C[x+2]=v[c+2]}}var w=[];d.forEach(function(e){p=e.split(":");w.push(Number(p[0]));w.push(Number(p[1]))});return{vertices:C,triangles:_,boundingSpheres:g,edges:w,planeEquation:o}};s.prototype.getTriangleCount=function(){return this._triangleCount};s.prototype.getLineCount=function(){return this._lineCount};s.prototype.getVertexCount=function(){return this._vertexCount};s.prototype.isTriangleDoubleSided=function(e){return this._triangleDoubleSidedFlag[e]>0};s.prototype.getVertex=function(e){var t=e*3;return[this._vertices[t],this._vertices[t+1],this._vertices[t+2]]};s.prototype.computeTriangleNormal=function(t){var r=this._triangles[t*3]*3;var i=this._triangles[t*3+1]*3;var n=this._triangles[t*3+2]*3;var a=[this._vertices[r],this._vertices[r+1],this._vertices[r+2]];var s=e.pointMinusPoint(this._vertices,a,i);var v=e.pointMinusPoint(this._vertices,a,n);var o=e.crossProduct(s,v);var h=e.dotProduct(o,o);if(h===0){return[1,0,0]}h=1/Math.sqrt(h);return[o[0]*h,o[1]*h,o[2]*h]};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeshAnalyzer2D", ["./Utils","sap/base/Log"],function(e,r){"use strict";function t(e,a){this._uid=e.uid;var i=Math.sqrt(a[2]*a[2]+a[3]*a[3]);this._samplingKoeff=1e4/i;this._tagName=e.tagName();this._matrix=e._matrixWorld();this._invMatrix=t.invertMatrix3x2(this._matrix);switch(this._tagName){case"ellipse":this.cx=e.cx;this.cy=e.cy;this.rx=e.rx;this.ry=e.ry;break;case"image":this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height;break;case"line":case"linearGradient":this.x1=e.x1;this.y1=e.y1;this.x2=e.x2;this.y2=e.y2;break;case"path":this.segments=e.segments;break;case"polygon":case"polyline":this.points=e.points;break;case"rect":this.x=e.x;this.y=e.y;this.rx=e.rx;this.ry=e.ry;this.width=e.width;this.height=e.height;break;case"text":break;default:r.error("Unknown svg tag: "+this._tagName);break}}t.invertMatrix3x2=function(e){var t=e[0];var a=e[1];var i=e[2];var n=e[3];var s=e[4];var l=e[5];var o=t*n-a*i;if(!o){r.error("Empty determinant of matrix 'a'");return null}o=1/o;var v=[];v.push(n*o);v.push(-a*o);v.push(-i*o);v.push(t*o);v.push((i*l-n*s)*o);v.push((a*s-t*l)*o);return v};t.transform2d=function(e,r){var t=e[0];var a=e[1];return[r[0]*t+r[2]*a+r[4],r[1]*t+r[3]*a+r[5]]};t.distanceToRectangle=function(r,t,a,i,n,s,l,o,v){var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g=[];for(var x=0;x<4;++x){var P=s+(x===0||x===3?0:o);var y=l+(x===0||x===1?0:v);g.push(P,y);if(n){p=e.computePointToPointDistance2([P,y,0],d);if(p<c){c=p;h=[P,y]}}if(i){var T=(x+1)%4;var b=s+(T===0||T===3?0:o);var D=l+(T===0||T===1?0:v);p=e.computeEdgeToPointDistance2([P,y,0],[b,D,0],d);if(p<f){f=p;m=[P,y,b,D]}}}var _=c<u?h:null;var M=f<u?m:null;g.push(g[0],g[1]);return[_,M,!_&&M?g:null]};t.distanceToLine=function(r,t,a,i,n,s,l,o,v){var u=null;var c=null;var h=a*a;var f=[s,l,0];var m=[o,v,0];var p=[r,t,0];if(i&&e.computeEdgeToPointDistance2(f,m,p)<h){c=[f[0],f[1],m[0],m[1]]}if(n){var d=e.computePointToPointDistance2(f,p);var g=e.computePointToPointDistance2(m,p);if(d<g&&d<h){u=f}else if(g<d&&g<h){u=m}}return[u,c]};t.distanceToPolyLine=function(r,t,a,i,n,s,l){var o=null;var v=null;var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g;var x;var P;var y;var T=l.length;if(T<2){return[]}for(var b=0;b<T;b+=2){g=l[b];x=l[b+1];if(n){p=e.computePointToPointDistance2([g,x,0],d);if(p<c){c=p;h=[g,x]}}if(i){if(b>0){p=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);if(p<f){f=p;m=[P,y,g,x]}}else if(s){P=l[T-2];y=l[T-1];f=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);m=[P,y,g,x]}}P=g;y=x}if(c<u){o=h}if(f<u){v=m}var D=null;if(!o&&v){D=Array.from(l);if(s){D.push(l[0],l[1])}}return[o,v,D]};t.distanceToEllipse=function(r,t,a,i,n,s,l,o,v){var u=null;var c=[r,t,0];var h=[i,n,0];var f=e.computePointToPointDistance2(h,c);u=[i,n];var m=e.computeEdgeDirection(h,c);var p=e.angleBetweenVectors2D(1,0,m[0],m[1]);if(o!=null&&v!=null){p=e.clampAngle(p,o,v)}m=[i+s*Math.cos(p),n+l*Math.sin(p),0];var d=e.computePointToPointDistance2(m,c);if(d<f){f=d;u=m}return f<a*a?u:null};t.computeArcCenter=function(r,t,a,i,n,s,l,o){var v=l===false;var u=o!==false;var c=.5*(r-a);var h=.5*(t-i);var f=c*c/(n*n)+h*h/(s*s);if(f>1){f=Math.sqrt(f);n=n*f;s=s*f}var m=n*s;var p=n*h;var d=s*c;f=p*p+d*d;if(!f){return null}var g=Math.sqrt(Math.abs((m*m-f)/f));if(v==u){g=-g}var x=g*p/s;var P=-g*d/n;var y=x+.5*(r+a);var T=P+.5*(t+i);var b=(c-x)/n;var D=(c+x)/n;var _=(h-P)/s;var M=(h+P)/s;var A=e.angleBetweenVectors2D(1,0,b,_);var E=e.clampAngle2PI(e.angleBetweenVectors2D(b,_,-D,-M));if(!u){E-=2*Math.PI}return{cx:y,cy:T,rx:n,ry:s,startAngle:A,deltaAngle:E}};t.sampleBezier=function(r,t,a,i,n){return n?e.bezierCubic2D(r,t,i,n,a):e.bezierQuadric2D(r,t,i,a)};t.sampleBezierCurve=function(r,a,i,n,s){var l=e.computePointToPointDistance2D(r,i);if(n){l+=e.computePointToPointDistance2D(i,n);l+=e.computePointToPointDistance2D(n,a)}else{l+=e.computePointToPointDistance2D(i,a)}var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=t.sampleBezier(u/o,r,a,i,n);v.push(c[0],c[1])}return v};t.sampleEllipse=function(e,r,t,a,i,n,s){var l=Math.max(t,a)*n;var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=i+u*n/o;v.push(e+t*Math.cos(c),r+a*Math.sin(c))}return v};t.distanceToBezier=function(r,a,i,n,s,l,o){var v=[r,a,0];var u=Number.MAX_VALUE;var c;var h;var f;var m;var p;var d=100;var g=function(e){if(e<=0){return n}if(e>=1){return s}return t.sampleBezier(e,n,s,l,o)};for(p=0;p<=d;++p){f=p/d;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p=.5/d;while(p>1e-8){for(d=0;d<2;++d){f=d==0?c-p:c+p;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p*=.5}return u>i*i?null:g(c)};t.distanceToPath=function(r,a,i,n,s,l,o,v,u){var c=[];var h=[];var f=null;var m=null;var p=0;var d=i*i;var g=Number.MAX_VALUE;var x;var P=Number.MAX_VALUE;var y;var T;var b=[r,a,0];var D;var _;var M;var A;var E;var k=0;var w=0;var I=0;var L=0;var N=null;var z=null;var B=null;var C=null;var V=function(e,r,t,a,i){var n=c.length;if(!n||c[n-2]!==e||c[n-1]!==r){p++;h.push(i?-p:p);c.push(e,r)}h.push(i?-p:p);c.push(t,a)};var U=function(e,r,t,a,i){var n=e;var s=r;var l,o;for(var v=0,u=t.length;v<u;v+=2){l=t[v];o=t[v+1];V(n,s,l,o,true);n=l;s=o}V(n,s,a,i,true)};var X=function(){if(s){T=e.computePointToPointDistance2([k,w,0],b);if(T<g){g=T;x=[k,w];m=null}}if(N!=null){if(l){V(N,z,k,w,false)}if(n){T=e.computeEdgeToPointDistance2([N,z,0],[k,w,0],b);if(T<P){P=T;y=[N,z,k,w];f=h.length-1}}}N=k;z=w};for(var q=0,K=v.length;q<K;++q){D=v[q];_=D.points;M=D.dimension||2;switch(D.type){case"arc":N=k;z=w;if(D.relative){k+=_[0];w+=_[1]}else{k=_[0];w=_[1]}var S=t.computeArcCenter(N,z,k,w,D.major,D.minor,D.short,D.clockwise);if(S){if(l){U(N,z,t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),k,w)}if(s){var G=t.distanceToEllipse(r,a,i,S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle);if(G){var R=e.computePointToPointDistance2(G,b);if(R<g){g=R;x=G;f=h.length-1;if(o&&e.computePointToPointDistance2(G,[N,z,0])>d&&e.computePointToPointDistance2(G,[k,w,0])>d){m=[N,z].concat(t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),[k,w])}}}}}break;case"move":N=null;z=null;k=_[0];w=_[1];I=k;L=w;X();for(A=M,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"line":N=k;z=w;for(A=0,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"close":N=k;z=w;k=I;w=L;X();break;case"bezier":var j=D.degree||2;var Q=0;var W=j-1;if(D.smooth){W--;B=k;C=w}var F=[null,null];for(A=0,E=_.length-1;A<E;A+=M){if(Q===0){I=k;L=w;N=null;z=null}if(Q<W){if(D.relative){F[Q]=[k+_[A],w+_[A+1]]}else{F[Q]=[_[A],_[A+1]]}Q++}else{if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}var H=[2*I-B,2*L-C];var J=D.smooth||j===2?0:1;B=F[J][0];C=F[J][1];var O=D.smooth?H:F[0];var Y=j===2?null:[B,C];var Z=[I,L];var $=[k,w];if(l){U(Z[0],Z[1],t.sampleBezierCurve(Z,$,O,Y,u),$[0],$[1])}if(s){var ee=t.distanceToBezier(r,a,i,Z,$,O,Y);if(ee){var re=e.computePointToPointDistance2(ee,b);if(re<g){g=re;x=ee;f=h.length-1;if(o&&e.computePointToPointDistance2(ee,[I,L,0])>d&&e.computePointToPointDistance2(ee,[k,w,0])>d){m=[Z[0],Z[1]].concat(t.sampleBezierCurve(Z,$,O,Y,u),[$[0],$[1]])}}}}Q=0}}break;default:break}}var te=g<d?x:null;var ae=P<d?y:null;var ie=l&&(te||ae)?e.findClosedContour(c,h,f):null;return[te,ae,ie,te?m:null]};t.prototype.intersectSphere=function(r,a,i,n,s,l,o){var v={faceId:null,edgeId:null,vertexId:null,contourId:null,curvedEdgeId:null,edge:null,vertex:null,contour:null,curvedEdge:null};var u=r[0];var c=r[1];var h=t.transform2d([u,c],this._invMatrix);var f=t.transform2d([u+a,c],this._invMatrix);u=h[0];c=h[1];var m=Math.sqrt((f[0]-u)*(f[0]-u)+(f[1]-c)*(f[1]-c));var p=[];switch(this._tagName){case"ellipse":if(s){var d=t.distanceToEllipse(u,c,m,this.cx,this.cy,this.rx,this.ry,null,null);if(d){if(l){var g=t.sampleEllipse(this.cx,this.cy,this.rx,this.ry,0,2*Math.PI,this._samplingKoeff);g.push(g[0],g[1]);p.push(d,null,g)}else{p.push(d)}}}break;case"rect":case"image":p=t.distanceToRectangle(u,c,m,n,s,this.x,this.y,this.width,this.height);break;case"line":case"linearGradient":p=t.distanceToLine(u,c,m,n,s,this.x1,this.y1,this.x2,this.y2);break;case"path":p=t.distanceToPath(u,c,m,n,s,l,o,this.segments,this._samplingKoeff);break;case"polygon":p=t.distanceToPolyLine(u,c,m,n,s,true,this.points);break;case"polyline":p=t.distanceToPolyLine(u,c,m,n,s,false,this.points);break;default:break}f=p.length>0?p[0]:null;if(f){var x=t.transform2d([f[0],f[1]],this._matrix);v.vertex=[x[0],x[1],0];v.vertexId="v"+x[0]+":"+x[1]}f=p.length>1?p[1]:null;if(f){var P=t.transform2d([f[0],f[1]],this._matrix);var y=t.transform2d([f[2],f[3]],this._matrix);v.edge=[P[0],P[1],0,y[0],y[1],0];v.edgeId="e"+P[0]+":"+P[1]+":"+y[0]+":"+y[1]}f=p.length>2?p[2]:null;var T;if(l&&f&&f.length>=6){var b=[];for(var D=0,_=f.length/2;D<_;++D){T=t.transform2d([f[D*2],f[D*2+1]],this._matrix);b.push(T[0],T[1],0)}if(e.isClosedContour(b)&&!e.hasSelfIntersections(b,false)){v.contour=b;v.contourId="cc:"+(this._uid?this._uid:"")+":"+b[0]+":"+b[1]}}f=p.length>3?p[3]:null;if(o&&f&&f.length>=6){var M=[];for(var A=0,E=f.length/2;A<E;++A){T=t.transform2d([f[A*2],f[A*2+1]],this._matrix);M.push(T[0],T[1],0)}if(!e.hasSelfIntersections(M,true)){v.curvedEdge=M;v.curvedEdgeId="ce:"+(this._uid?this._uid:"")+":"+M[0]+":"+M[1]}}return v};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Settings", [],function(){"use strict";var e="sap.ui.vk.measurements.Settings";var t={color:0,precision:1,units:"mm",featureVertex:true,featureEdge:true,featureFace:true};var r={};r.load=function(){var r=self.localStorage.getItem(e);if(r==null){r={}}else{try{r=JSON.parse(r)}catch(e){r={}}}return Object.assign(Object.assign({},t),r)};r.save=function(t){var r;if("scale"in t){r=t.scale;delete t.scale}self.localStorage.setItem(e,JSON.stringify(t));if(r!=null){t.scale=r}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Surface", ["sap/base/Log","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/core/format/NumberFormat","../getResourceBundle","./Measurement","../glMatrix","./Settings","./Utils"],function(e,t,r,i,a,n,s,o,u){"use strict";var m=6;var c=16;var l="http://www.w3.org/2000/svg";var d=t.extend("sap.ui.vk.measurements.Surface",{metadata:{library:"sap.ui.vk"},constructor:function(){t.call(this);var e=document.createElementNS(l,"svg");e._surface=this;e.classList.add("sapUiVizKitMeasurementSurface");e.innerHTML="<defs>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start-highlighted'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end-highlighted'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start0'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end0'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start1'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end1'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start2'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end2'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start3'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end3'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start4'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end4'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"</defs>";var r=document.createElementNS(l,"g");var i=document.createElementNS(l,"g");var a=document.createElementNS(l,"g");e.append(r,i,a);this._svgDomRef=e;this._featuresDomRef=r;this._measurementsDomRef=i;this._measurementsUnderConstructionDomRef=a;this._features=[];this._measurements=[];this._measurementsUnderConstruction=[];this._settings=o.load();this._settings.scale=1}});d.prototype.destroy=function(){if(this._svgDomRef!=null){this._svgDomRef.remove();this._svgDomRef._surface=null}this._svgDomRef=null;this._featuresDomRef=null;this._measurementsDomRef=null;this._measurementsUnderConstructionDomRef=null;this._features=null;this._measurements=null;this._measurementsUnderConstruction=null;this._settings=null;t.prototype.destroy(this)};d.prototype.getDomRef=function(){return this._svgDomRef};d.prototype.addMeasurement=function(e){this._addMeasurement(e,false);this.fireMeasurementsAdded({measurements:[e]});return this};d.prototype._addMeasurement=function(e,t){var r;if(e.isDistance){r=document.createElementNS(l,"g");r.dataset.sapUiVkMeasurement=true;var i=document.createElementNS(l,"line");var a=document.createElementNS(l,"rect");var n=document.createElementNS(l,"text");n.appendChild(document.createTextNode(""));r.append(i,a,n)}else if(e.isAngle){r=document.createElementNS(l,"g");r.dataset.sapUiVkMeasurement=true;var s=document.createElementNS(l,"path");var o=document.createElementNS(l,"path");o.classList.add("sapUiVizKitMeasurementDashed");var u=document.createElementNS(l,"path");u.classList.add("sapUiVizKitMeasurementDotted");var m=document.createElementNS(l,"path");var c=document.createElementNS(l,"rect");var d=document.createElementNS(l,"text");d.appendChild(document.createTextNode(""));r.append(s,o,u,m,c,d)}else if(e.isArea){r=document.createElementNS(l,"g");r.dataset.sapUiVkMeasurement=true;var h=document.createElementNS(l,"path");h.classList.add("sapUiVizKitMeasurementFill");h.setAttribute("opacity",.5);var v=document.createElementNS(l,"path");v.classList.add("sapUiVizKitMeasurementStroke");v.setAttribute("opacity",.5);var f=document.createElementNS(l,"path");f.classList.add("sapUiVizKitMeasurementArea");var p=document.createElementNS(l,"path");p.classList.add("sapUiVizKitMeasurementAreaEdgeIntersecting");var g=document.createElementNS(l,"rect");var y=document.createElementNS(l,"text");y.appendChild(document.createTextNode(""));r.append(h,v,f,p,g,y)}else{throw new Error("Unknown measurement object")}if(t){this._measurementsUnderConstruction.push(e);this._measurementsUnderConstructionDomRef.appendChild(r)}else{this._measurements.push(e);this._measurementsDomRef.appendChild(r)}r._measurement=e;return this};d.prototype.removeMeasurement=function(e){this.fireMeasurementsRemoving({measurements:[e]});this._removeMeasurement(e,false);return this};d.prototype._removeMeasurement=function(e,t){var r;var i;if(t){r=this._measurementsUnderConstruction;i=this._measurementsUnderConstructionDomRef}else{r=this._measurements;i=this._measurementsDomRef}var a=r.indexOf(e);if(a>=0){r.splice(a,1);i.children[a].remove()}e.getFeatures().forEach(function(e){if(e){this.removeFeature(e)}},this);return this};d.prototype.beginMeasurementConstruction=function(e){this._addMeasurement(e,true);return this};d.prototype.endMeasurementConstruction=function(e){var t=this._measurementsUnderConstruction.indexOf(e);if(t>=0){this._measurementsUnderConstruction.splice(t,1);this._measurements.push(e);this._measurementsDomRef.appendChild(this._measurementsUnderConstructionDomRef.children[t]);this.fireMeasurementsAdded({measurements:[e]})}return this};d.prototype.cancelMeasurementConstruction=function(e){this._removeMeasurement(e,true);return this};d.prototype.highlightMeasurement=function(e,t,r,i){var a=this._measurements;var n=a.indexOf(e);if(n<0){return}e.setHighlighted(t);var s=this._measurementsDomRef.children[n];var o=s.children[0];var u=this.getMeasurementArrowColorCode();if(t){if(u!==""){s.classList.remove("sapUiVizKitMeasurement"+u)}s.classList.add("sapUiVizKitMeasurementHighlighted");if(e.isArea){s.children[2].removeAttribute("opacity")}else{o.setAttribute("marker-start","url(#arrow-start-highlighted)");o.setAttribute("marker-end","url(#arrow-end-highlighted)")}e.getFeatures().forEach(function(e){if(e){this.addFeature(e);var t=this._features.indexOf(e);if(t>=0){h(this._featuresDomRef.children[t],e,r,i,this._settings)}}},this)}else{s.classList.remove("sapUiVizKitMeasurementHighlighted");if(u!==""){s.classList.add("sapUiVizKitMeasurement"+u)}if(e.isArea){s.children[2].setAttribute("opacity",.5)}else{o.setAttribute("marker-start","url(#arrow-start"+u+")");o.setAttribute("marker-end","url(#arrow-end"+u+")")}e.getFeatures().forEach(function(e){if(e){this.removeFeature(e)}},this)}};d.prototype.getMeasurements=function(){return this._measurements};d.prototype.getMeasurementById=function(e){return this._measurements.find(function(t){return t.getId()===e})};d.prototype.addFeature=function(e){if(this._features.indexOf(e)>=0){return this}var t;if(e.isVertex){t=document.createElementNS(l,"circle")}else if(e.isEdge){t=document.createElementNS(l,"line")}else if(e.isFace){t=document.createElementNS(l,"g");var r=document.createElementNS(l,"path");var i=document.createElementNS(l,"path");i.classList.add("sapUiVizKitMeasurementContour");t.append(r,i)}else{throw new Error("Unknown measurement feature")}this._features.push(e);this._featuresDomRef.append(t);return this};d.prototype.removeFeature=function(e){var t=this._features;var r=t.indexOf(e);if(r>=0){t.splice(r,1);this._featuresDomRef.children[r].remove()}return this};function h(e,t,r,i,a){var n=null;if(t.isVertex){n=D}else if(t.isEdge){n=V}else if(t.isFace){n=x}if(n!=null){n(e,t,r,i,a)}}d.prototype.update=function(e,t){var r;var i;var a=this._measurements;var n=this._measurementsDomRef.children;for(var s=0;s<2;++s){for(r=0,i=a.length;r<i;++r){var o=a[r];var u=n[r];if(o.getVisible()){u.setAttribute("visibility","visible")}else{u.setAttribute("visibility","hidden");continue}var m=null;if(o.isDistance){m=y}else if(o.isAngle){m=E}else if(o.isArea){m=k}if(m!=null){m(u,o,e,t,this._settings)}}a=this._measurementsUnderConstruction;n=this._measurementsUnderConstructionDomRef.children}var c=this._features;var l=this._featuresDomRef.children;for(r=0,i=c.length;r<i;++r){h(l[r],c[r],e,t,this._settings)}return this};var v=new Map;r.attachLocalizationChanged(function(){v.clear()});function f(e,t){var r=t.precision;var n=t.units;var s=t.scale*u.getUnitFactor(n);var o=v.get(r);if(o==null){o=i.getFloatInstance({minFractionDigits:r,maxFractionDigits:r});v.set(r,o)}var m=a().getText("MEASUREMENTS_DISTANCE_VALUE",[o.format(e*s),u.translateUnits(n)]);return m}function p(e,t,r,i,a,n){e.childNodes[0].data=r;var s=e.getBBox().width+10;var o=26;var u=i-s*.5;var m=a-o*.5;if(n&&n.x>=u&&n.x<=u+s&&n.y>=m&&n.y<=m+o){a-=o;m-=o}t.x.baseVal.value=u;t.y.baseVal.value=m;t.width.baseVal.value=s;e.setAttribute("x",i);e.setAttribute("y",a)}function g(e,t,r){var i=r?"sapUiVizKitMeasurementHighlighted":"sapUiVizKitMeasurement"+t;if(!e.classList.contains(i)){e.classList.forEach(function(e,t,r){r.remove(e)});e.classList.add(i)}}function y(e,t,r,i,a){var n=U(a);var s=t.getHighlighted();g(e,n,s);var o=t.getPoint1();var u=t.getPoint2();var c=r.projectToScreen(o[0],o[1],o[2],i);var l=r.projectToScreen(u[0],u[1],u[2],i);var d=e.children[0];if(t.getShowArrows()){var h=l.x-c.x;var v=l.y-c.y;var y=Math.sqrt(h*h+v*v);if(Math.abs(y)<1e-5){e.setAttribute("visibility","hidden");return this}var b=m*h/y;var A=m*v/y;d.x1.baseVal.value=c.x+b;d.y1.baseVal.value=c.y+A;d.x2.baseVal.value=l.x-b;d.y2.baseVal.value=l.y-A;d.setAttribute("marker-start",s?"url(#arrow-start-highlighted)":"url(#arrow-start"+n+")");d.setAttribute("marker-end",s?"url(#arrow-end-highlighted)":"url(#arrow-end"+n+")")}else{d.x1.baseVal.value=c.x;d.y1.baseVal.value=c.y;d.x2.baseVal.value=l.x;d.y2.baseVal.value=l.y;d.removeAttribute("marker-start");d.removeAttribute("marker-end")}e.removeAttribute("visibility");var M=(c.x+l.x)*.5;var _=(c.y+l.y)*.5;p(e.children[2],e.children[1],f(t.getDistance(),a),M,_,c);return this}function b(e,t,r,i){var a=i|0;var n=e.projectToScreen(r[a+0],r[a+1],r[a+2],t);return[n.x,n.y,0]}function A(e,t,r){var i=r|0;var a=s.vec3.fromValues(t[i],t[i+1],t[i+2]);s.vec3.transformMat4(a,a,e);return a}function M(e,t,r,i){var a=A(r,i);return b(e,t,a)}function _(e,t){return s.vec3.fromValues(t*Math.cos(e),t*Math.sin(e),0)}function E(e,t,r,n,o){var l=U(o);var d=t.getHighlighted();g(e,l,d);var h=t.getPoints();var f=[h[6],h[7],h[8]];var y=[h[9],h[10],h[11]];var b=u.pointMinusPoint(f,y);b=u.pointMinusPoint(h,b);var E=[h[15],h[16],h[17]];var S=u.normalize(u.crossProduct(u.computeEdgeDirection(y,b),u.computeEdgeDirection(y,E)));var k=s.mat4.create();var D=s.quat.create();s.quat.rotationTo(D,s.vec3.fromValues(0,0,1),s.vec3.fromValues(S[0],S[1],S[2]));s.mat4.fromRotationTranslation(k,D,s.vec3.fromValues(y[0],y[1],y[2]));var V=s.mat4.create();s.mat4.invert(V,k);var x=A(V,h,0);var w=A(V,h,3);var R=A(V,f);var C=A(V,y);var N=A(V,h,12);var L=A(V,h,15);var P=M(r,n,k,x);var T=M(r,n,k,w);var F="M"+P[0]+" "+P[1]+" L"+T[0]+" "+T[1];var H=u.computePointToPointDistance(x,w);var I=u.computePointToPointDistance(C,N);var z=u.computePointToPointDistance(C,L);var K=I>z?I:z;var j=t.getState();if(j>0&&H>0&&K>0){var W=M(r,n,k,N);var X=W;var Y=T;if(X[0]!==Y[0]||X[1]!==Y[1]){F+=" M"+X[0]+" "+X[1]}var O=M(r,n,k,L);F+=" L"+O[0]+" "+O[1];var B=u.computeEdgeDirection(w,x);var q=u.computeEdgeDirection(N,L);var J=t.getRadiusScale();var Z=J<0;var G=K*Math.abs(J);var Q=u.angleBetweenVectors2D(1,0,B[0],B[1]);var $=u.angleBetweenVectors2D(B[0],B[1],q[0],q[1]);if($<0){Q=u.angleBetweenVectors2D(B[0],B[1],-1,0);$=-$}var ee=Q+$/2;var te=t.getAngle();var re=Math.PI/180;X=M(r,n,k,_(ee,G));Y=M(r,n,k,_(ee+re,G));var ie=re*m/u.computePointToPointDistance(X,Y);if(Z){ee+=Math.PI;te=2*Math.PI-te;$=$-2*Math.PI;ie=-ie}var ae=Math.ceil(Math.abs($)/(Math.PI/2));var ne=Q+ie;var se=($-ie-ie)/ae;var oe="";for(var ue=0;ue<ae;++ue){var me=_(ne+se*ue,G);var ce=_(ne+se*(1+ue),G);var le=me[0];var de=me[1];var he=ce[0];var ve=ce[1];var fe=le*le+de*de;var pe=fe+le*he+de*ve;var ge=4/3*(Math.sqrt(2*fe*pe)-pe)/(le*ve-de*he);var ye=[le-ge*de,de+ge*le,0];var be=[he+ge*ve,ve-ge*he,0];if(ue===0){me=M(r,n,k,me);oe+=" M"+me[0]+" "+me[1]}ye=M(r,n,k,ye);be=M(r,n,k,be);ce=M(r,n,k,ce);oe+=" C"+ye[0]+" "+ye[1]+" "+be[0]+" "+be[1]+" "+ce[0]+" "+ce[1]}var Ae=e.children[0];Ae.setAttribute("d",oe);Ae.setAttribute("marker-start",d?"url(#arrow-start-highlighted)":"url(#arrow-start"+l+")");Ae.setAttribute("marker-end",d?"url(#arrow-end-highlighted)":"url(#arrow-end"+l+")");Ae.setAttribute("opacity",j===1?.5:1);Ae.removeAttribute("visibility");Ae=e.children[1];var Me=M(r,n,k,R);var _e=M(r,n,k,C);var Ee=Me[0]!==_e[0]||Me[1]!==_e[1];X=_e;Y=M(r,n,k,_(Q,G));var Se=u.computePointToPointDistance(X,Y)+c;var ke=u.computeEdgeDirection(X,Y);var De=u.pointPlusPoint(u.scalePoint(ke,Se),X);var Ve="";if(Ee){Ve="M"+X[0]+" "+X[1]+" L"+De[0]+" "+De[1]}else if(u.computeEdgeToPointDistance2(P,T,De)>.001){Ve="M"+P[0]+" "+P[1]+" L"+De[0]+" "+De[1]}X=_e;Y=M(r,n,k,_(Q+$,G));Se=u.computePointToPointDistance(X,Y)+c;ke=u.computeEdgeDirection(X,Y);De=u.pointPlusPoint(u.scalePoint(ke,Se),X);if(u.computeEdgeToPointDistance2(W,O,De)>.001){Ve+="M"+O[0]+" "+O[1]+" L"+De[0]+" "+De[1]}if(Ve.length>0){Ae.setAttribute("d",Ve);Ae.removeAttribute("visibility")}else{Ae.setAttribute("d","");Ae.setAttribute("visibility","hidden")}Ae=e.children[2];if(Ee){X=Me;Y=_e;Ae.setAttribute("d","M"+X[0]+" "+X[1]+" L"+Y[0]+" "+Y[1]);Ae.removeAttribute("visibility")}else{Ae.setAttribute("d","");Ae.setAttribute("visibility","hidden")}var xe=o.precision;var Ue=v.get(xe);if(Ue==null){Ue=i.getFloatInstance({minFractionDigits:xe,maxFractionDigits:xe});v.set(xe,Ue)}var we=a().getText("MEASUREMENTS_ANGLE_VALUE",Ue.format(180*te/Math.PI));X=M(r,n,k,_(ee,G));p(e.children[5],e.children[4],we,X[0],X[1],null);e.children[3].removeAttribute("visibility");e.children[4].removeAttribute("visibility");e.children[5].removeAttribute("visibility")}else{e.children[0].setAttribute("visibility","hidden");e.children[1].setAttribute("visibility","hidden");e.children[2].setAttribute("visibility","hidden");e.children[4].setAttribute("visibility","hidden");e.children[5].setAttribute("visibility","hidden")}var Re=e.children[3];Re.setAttribute("d",F);g(Re,"StrokeColor"+l,false);Re.removeAttribute("visibility");return this}function S(e,t){var r=t.precision;var n=t.units;var s=t.scale*u.getUnitFactor(n);var o=v.get(r);if(o==null){o=i.getFloatInstance({minFractionDigits:r,maxFractionDigits:r});v.set(r,o)}var m=a().getText("MEASUREMENTS_AREA_VALUE",[o.format(e*s*s),u.translateUnits(n,"2")]);return m}function k(e,t,r,i,a){var n=U(a);var s=t.getHighlighted();g(e,n,s);var o=t.getArea();var u=o&&o<0;if(u){o=-o}var m=t.getPoints();var c=e.children[2];var l=m?m.length:0;if(l>=6){var d="";for(var h=0;h<l;h+=3){var v=b(r,i,m,h);d+=(h===0?"M":" L")+v[0]+" "+v[1]}if(!u){d+=" Z"}c.setAttribute("d",d);c.removeAttribute("visibility")}else{c.setAttribute("visibility","hidden")}c.classList.remove("sapUiVizKitMeasurementAreaSelfIntersecting");var f=t.hasSelfIntersections();if(f){c.classList.add("sapUiVizKitMeasurementAreaSelfIntersecting")}var y=e.children[3];if(l>=6&&t.hasSelfIntersectionsLastEdge()){var A=b(r,i,m,l-6);var M=b(r,i,m,l-3);y.setAttribute("d","M"+A[0]+" "+A[1]+" L"+M[0]+" "+M[1]);y.removeAttribute("visibility")}else{y.setAttribute("visibility","hidden")}var _=t.getFeatures();if(_&&Array.isArray(_)&&_.length===1&&_[0].isFace){x(e,_[0],r,i,null)}else{e.children[0].setAttribute("d","");e.children[1].setAttribute("d","")}if(s||u){c.removeAttribute("opacity")}else{c.setAttribute("opacity",.5)}var E=e.children[4];var k=e.children[5];if(o&&!f){var D=b(r,i,t.getPosition());p(k,E,S(o,a),D[0],D[1],null);k.removeAttribute("visibility");E.removeAttribute("visibility")}else{k.setAttribute("visibility","hidden");E.setAttribute("visibility","hidden")}return this}function D(e,t,r,i,a){var n=t.getValue();var s=r.projectToScreen(n[0],n[1],n[2],i);e.cx.baseVal.value=s.x;e.cy.baseVal.value=s.y;return this}function V(e,t,r,i,a){var n=t.getValue();var s=r.projectToScreen(n[0],n[1],n[2],i);e.x1.baseVal.value=s.x;e.y1.baseVal.value=s.y;s=r.projectToScreen(n[3],n[4],n[5],i);e.x2.baseVal.value=s.x;e.y2.baseVal.value=s.y;return this}function x(e,t,r,i,a){var n=t.getValue();var s=n.vertices;var o=n.triangles;var u=n.edges;var m;var c;var l;var d;var h;h="";for(l=0,d=o?o.length:0;l<d;l+=3){m=o[l]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+="M"+c.x+" "+c.y;m=o[l+1]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y;m=o[l+2]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y+" Z "}e.children[0].setAttribute("d",h);h="";for(l=0,d=u?u.length:0;l<d;l+=2){m=u[l]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+="M"+c.x+" "+c.y;m=u[l+1]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y}e.children[1].setAttribute("d",h);return this}d.prototype.hitTest=function(e,t){var r=this._svgDomRef;var i=r.getBoundingClientRect();var a=r.style;a.pointerEvents="auto";var n=document.elementFromPoint(e+i.x,t+i.y);a.pointerEvents="none";var s=n&&n.parentElement;return s!=null&&s.dataset.sapUiVkMeasurement==="true"?s:null};d.prototype.updateSettings=function(e){Object.assign(this._settings,e);return this};d.prototype.getScale=function(){return this._settings.scale};d.prototype.setScale=function(e){if(e!==this._settings.scale){var t={oldScale:this._settings.scale,newScale:e};this._settings.scale=e;this.fireScaleChanged(t)}return this};function U(e){return e.color}d.prototype.getMeasurementArrowColorCode=function(){return U(this._settings)};d.prototype.toJSON=function(e){var t=Array.isArray(e)?e:this._measurements;return{scale:this._settings.scale,measurements:t.map(function(e){return e.toJSON()})}};d.prototype.fromJSON=function(t,r){if("scale"in t){if(t.scale>0){this.setScale(t.scale)}else{e.error("Incorrect 'scale' value: "+t.scale)}}var i=t.measurements.map(n.createFromJSON);var a;if(r){a=this._measurements.slice()}else{a=t.measurements.map(function(e){return e.id}).map(this.getMeasurementById,this).filter(function(e){return e!=null})}if(a.length>0){this.fireMeasurementsRemoving({measurements:a});a.forEach(function(e){this._removeMeasurement(e,false)},this)}if(i.length>0){i.forEach(function(e){this._addMeasurement(e,false)},this);this.fireMeasurementsAdded({measurements:i})}};var w={measurementsAdded:"measurementsAdded",measurementsRemoving:"measurementsRemoving",scaleChanged:"scaleChanged"};d.prototype.attachMeasurementsAdded=function(e,t,r){return this.attachEvent(w.measurementsAdded,e,t,r)};d.prototype.detachMeasurementsAdded=function(e,t){return this.detachEvent(w.measurementsAdded,e,t)};d.prototype.fireMeasurementsAdded=function(e){return this.fireEvent(w.measurementsAdded,e)};d.prototype.attachMeasurementsRemoving=function(e,t,r){return this.attachEvent(w.measurementsRemoving,e,t,r)};d.prototype.detachMeasurementsRemoving=function(e,t){return this.detachEvent(w.measurementsRemoving,e,t)};d.prototype.fireMeasurementsRemoving=function(e){return this.fireEvent(w.measurementsRemoving,e)};d.prototype.attachScaleChanged=function(e,t,r){return this.attachEvent(w.scaleChanged,e,t,r)};d.prototype.detachScaleChanged=function(e,t){return this.detachEvent(w.scaleChanged,e,t)};d.prototype.fireScaleChanged=function(e){return this.fireEvent(w.scaleChanged,e)};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Utils", ["sap/base/Log","../getResourceBundle"],function(t,n){"use strict";var r=1e-6;var e=1e-6;var o=1e-6;var i=1e-8;var a=1e-5;var u=new Float64Array(9);var s=2*Math.PI;var c={};c.compareNormal=function(t,n,e){if(c.computePointToPointDistance2(t,n)<r){return true}if(e){var o=c.pointPlusPoint(t,n);if(c.magnitude2(o)<r){return true}}return false};c.computeEdgeDirection=function(t,n,r){var e=c.normalize(c.pointMinusPoint(n,t));if(r){r[0]=e[0];r[1]=e[1];r[2]=e[2];return null}return e};c.scalePoint=function(t,n){return[n*t[0],n*t[1],n*t[2]]};c.normalize=function(t){var n=c.magnitude2(t);n=n<r?1:1/Math.sqrt(n);return c.scalePoint(t,n)};c.magnitude2=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]};c.dotProduct=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]};c.crossProduct=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]};c.equalPoints=function(t,n,r,e){return t[n]===r[e]&&t[n+1]===r[e+1]&&t[n+2]===r[e+2]};c.angleBetweenVectors2D=function(n,r,e,o){var a=n*e+r*o;var u=Math.sqrt((n*n+r*r)*(e*e+o*o));if(u<i){t.error("Degenerate angle: ax="+n+" ay="+r+" bx="+e+" by="+o);return 0}var s=a/u;if(s<-1){s=-1}else if(s>1){s=1}var c=Math.acos(s);return n*o<r*e?-c:c};c.isDegenerateTriangle=function(t,n,r){var e=c.pointMinusPoint(n,t);var i=c.pointMinusPoint(r,t);var a=c.dotProduct(e,e);var u=c.dotProduct(e,i);var s=c.dotProduct(i,i);var v=2*(a*s-u*u);return Math.abs(v)<=o};c.computeTriangleBoundingSphere=function(n,r,e,i,a){var u=c.pointMinusPoint(r,n);var s=c.pointMinusPoint(e,n);var v=c.dotProduct(u,u);var f=c.dotProduct(u,s);var l=c.dotProduct(s,s);var P=2*(v*l-f*f);var d=[n[0],n[1],n[2]];var g;if(Math.abs(P)<=o){t.error("Degenerate triangle detected! All 3 points on the same line: ("+n+") ("+r+") ("+e+")");g=[d[0],d[1],d[2]]}else{var p=(v*l-l*f)/P;var m=(l*v-v*f)/P;if(p<=0){g=[.5*(n[0]+e[0]),.5*(n[1]+e[1]),.5*(n[2]+e[2])]}else if(m<=0){g=[.5*(n[0]+r[0]),.5*(n[1]+r[1]),.5*(n[2]+r[2])]}else if(p+m>=1){g=[.5*(r[0]+e[0]),.5*(r[1]+e[1]),.5*(r[2]+e[2])];d=[r[0],r[1],r[2]]}else{g=[n[0]+p*u[0]+m*s[0],n[1]+p*u[1]+m*s[1],n[2]+p*u[2]+m*s[2]]}}i[a]=g[0];i[a+1]=g[1];i[a+2]=g[2];i[a+3]=c.computePointToPointDistance(g,d)};c.getNearestPointOnTriangle=function(t,n){var r=c.normalize(c.crossProduct(c.pointMinusPoint(t,t,3),c.pointMinusPoint(t,t,6)));var e=c.pointMinusPoint(n,t);var o=c.dotProduct(e,r);var i=c.scalePoint(r,-o);var a=c.pointPlusPoint(n,i);for(var u=0;u<3;++u){var s=u*3;var v=[t[s],t[s+1],t[s+2]];s=(u+1)%3*3;var f=[t[s],t[s+1],t[s+2]];s=(u+2)%3*3;var l=[t[s],t[s+1],t[s+2]];var P=c.normalize(c.pointMinusPoint(f,v));var d=c.normalize(c.pointMinusPoint(l,v));var g=c.normalize(c.pointMinusPoint(l,f));var p=c.scalePoint(c.pointPlusPoint(P,d),-1);var m=c.pointMinusPoint(P,g);var h=c.dotProduct(c.crossProduct(p,c.pointMinusPoint(a,v)),r);var T=c.dotProduct(c.crossProduct(m,c.pointMinusPoint(a,f)),r);if(h>=0&&T<=0){var M=c.pointMinusPoint(v,a);var D=c.pointMinusPoint(f,a);if(c.dotProduct(c.crossProduct(M,D),r)<0){return c.projectPointToEdge(v,f,a)}}}return a};c.pointOnLine=function(t,n){return[t[0]+(t[3]-t[0])*n,t[1]+(t[4]-t[1])*n,t[2]+(t[5]-t[2])*n]};c.projectPointToLine=function(t,n){var e=[t[0],t[1],t[2]];var o=[t[3],t[4],t[5]];var i=c.pointMinusPoint(o,e);var a=c.magnitude2(i);if(a<r){return 0}return c.dotProduct(i,c.pointMinusPoint(n,e))/a};c.projectPointToEdge=function(t,n,e){var o=c.pointMinusPoint(n,t);var i=c.magnitude2(o);if(i<r){return t}var a=c.dotProduct(o,c.pointMinusPoint(e,t))/i;if(a<=0){return t}if(a>=1){return n}return[t[0]+o[0]*a,t[1]+o[1]*a,t[2]+o[2]*a]};c.computeEdgeToPointDistance2=function(t,n,r){return c.computePointToPointDistance2(c.projectPointToEdge(t,n,r),r)};c.computePointToPointDistance=function(t,n,r){return Math.sqrt(c.computePointToPointDistance2(t,n,r))};c.computePointToPointDistance2D=function(t,n,r){return c.computePointToPointDistance([t[0],t[1],0],[n[0],n[1],0])};c.computePointToPointDistance2=function(t,n,r){var e=c.pointMinusPoint(t,n,r);return c.magnitude2(e)};c.pointMinusPoint=function(t,n,r){var e=r|0;return[t[e+0]-n[0],t[e+1]-n[1],t[e+2]-n[2]]};c.pointPlusPoint=function(t,n,r){var e=r|0;return[t[e+0]+n[0],t[e+1]+n[1],t[e+2]+n[2]]};c.bezierQuadric2D=function(t,n,r,e){var o=t*t;var i=1-t;var a=i*i;var u=2*i*t;var s=n[0]*a;var c=n[1]*a;s+=r[0]*u;c+=r[1]*u;s+=e[0]*o;c+=e[1]*o;return[s,c,0]};c.bezierCubic2D=function(t,n,r,e,o){var i=t*t;var a=i*t;var u=1-t;var s=u*u;var c=s*u;var v=3*s*t;var f=3*u*i;var l=n[0]*c;var P=n[1]*c;l+=r[0]*v;P+=r[1]*v;l+=e[0]*f;P+=e[1]*f;l+=o[0]*a;P+=o[1]*a;return[l,P,0]};c.findClosestPointEdgeToPoint=function(t,n){return c.projectPointToEdge([t[0],t[1],t[2]],[t[3],t[4],t[5]],n)};c.findClosestPointFaceToPoint=function(t,n){var r=t.vertices;var e=t.triangles;var o;var i;var a;var s;var v;var f;for(var l=0,P=e.length;l<P;l+=3){for(v=0;v<3;++v){f=e[l+v]*3;u[v*3]=r[f];u[v*3+1]=r[f+1];u[v*3+2]=r[f+2]}a=c.getNearestPointOnTriangle(u,n);s=c.computePointToPointDistance2(a,n);if(!l||s<o){o=s;i=a}}return i};c.computePlaneEquation=function(t,n,r,e){var o=[t[n],t[n+1],t[n+2]];var i=c.pointMinusPoint(t,o,r);var a=c.pointMinusPoint(t,o,e);var u=c.crossProduct(i,a);var s=c.dotProduct(u,u);if(s!==0){u=c.scalePoint(u,1/Math.sqrt(s));return[u[0],u[1],u[2],-c.dotProduct(o,u)]}return[1,0,0,0]};c.intersectPlanes=function(t,n){var e=c.crossProduct(t,n);var o=c.magnitude2(e);if(o<r){return null}var i=c.scalePoint(c.pointPlusPoint(c.scalePoint(c.crossProduct(e,n),t[3]),c.scalePoint(c.crossProduct(t,e),n[3])),1/o);var a=c.pointPlusPoint(i,e);return[i[0],i[1],i[2],a[0],a[1],a[2]]};c.intersectLines=function(t,n){return c.findClosestPointEdgeToEdge(t,n,true,true)};c.findClosestPointLineToLine=function(t,n){return c.findClosestPointEdgeToEdge(t,n,true,false)};c.findClosestPointEdgeToEdge=function(t,n,r,o){var u=c.pointMinusPoint(t,t,3);var s=c.pointMinusPoint(n,n,3);var v=c.pointMinusPoint(t,n,0);var f=c.dotProduct(u,u);var l=c.dotProduct(u,s);var P=c.dotProduct(s,s);var d=c.dotProduct(u,v);var g=c.dotProduct(s,v);var p=f*P-l*l;var m,h=p;var T,M=p;var D=p<a;if(D){m=.5;h=1;T=.5;M=1}else{m=l*g-P*d;T=f*g-l*d;if(!r){if(m<0){m=0;T=g;M=P}else if(m>h){m=h;T=g+l;M=P}}}if(!r){if(T<0){T=0;if(-d<0){m=0}else if(-d>f){m=h}else{m=-d;h=f}}else if(T>M){T=M;if(-d+l<0){m=0}else if(-d+l>f){m=h}else{m=-d+l;h=f}}}f=Math.abs(m)<i;l=Math.abs(T)<i;var b=f?0:m/h;var E=l?0:T/M;P=Math.abs(m-h)<i;d=Math.abs(T-M)<i;if(P){b=1}if(d){E=1}v=c.pointOnLine(t,b);u=c.pointOnLine(n,E);p=c.computePointToPointDistance2(v,u);if(o&&p>e){return null}if(r){return D?null:[b,E]}if(D||f||l||P||d){P=c.findClosestPointEdgeToPoint(t,u);f=c.computePointToPointDistance2(P,u);d=c.findClosestPointEdgeToPoint(n,v);l=c.computePointToPointDistance2(d,v);if(f<l){if(f+i<p){p=f;for(g=0;g<3;++g){v[g]=P[g]}}}else if(l+i<p){p=l;for(g=0;g<3;++g){u[g]=d[g]}}for(f=0;f<6;f+=3){l=[n[f],n[f+1],n[f+2]];P=c.findClosestPointEdgeToPoint(t,l);d=c.computePointToPointDistance2(P,l);if(d+i<p){p=d;for(g=0;g<3;++g){v[g]=P[g];u[g]=l[g]}}}for(f=0;f<6;f+=3){l=[t[f],t[f+1],t[f+2]];P=c.findClosestPointEdgeToPoint(n,l);d=c.computePointToPointDistance2(P,l);if(d+i<p){p=d;for(g=0;g<3;++g){v[g]=l[g];u[g]=P[g]}}}}return[v[0],v[1],v[2],u[0],u[1],u[2]]};c.findClosestPointFaceToEdge=function(n,r){var e=performance.now();var o=n.triangles;var i=n.vertices;var a=n.edges;var s=n.boundingSpheres;var v=Number.MAX_VALUE;var f;var l;var P;var d;var g;var p;var m;var h=[r[3],r[4],r[5]];for(d=0,m=a.length;d<m;d+=2){for(g=0;g<2;++g){p=a[d+g]*3;u[g*3]=i[p];u[g*3+1]=i[p+1];u[g*3+2]=i[p+2]}l=c.findClosestPointEdgeToEdge(u,r);P=c.computePointToPointDistance2(l,l,3);if(P<v){v=P;f=l}}v=Math.sqrt(v);var T=[(r[0]+r[3])/2,(r[1]+r[4])/2,(r[2]+r[5])/2];var M=c.computePointToPointDistance(r,r,3)/2;var D;var b=performance.now()-e;var E;for(d=0,m=o.length;d<m;d+=3){P=c.computePointToPointDistance(s,T,d*4);if(P<M+v+s[d*4+3]){for(g=0;g<3;++g){D=o[d+g]*3;u[g*3]=i[D];u[g*3+1]=i[D+1];u[g*3+2]=i[D+2]}E=r;for(g=0;g<2;++g){l=c.getNearestPointOnTriangle(u,E);P=c.computePointToPointDistance(l,E);if(P<v){v=P;f[0]=l[0];f[1]=l[1];f[2]=l[2];f[3]=E[0];f[4]=E[1];f[5]=E[2]}E=h}}}var C=performance.now()-e;if(C>10){t.info("Face[t"+n.triangles.length+"/e"+n.edges.length+"/v"+n.vertices.length+"] distance to Edge in "+C.toFixed(1)+"ms ("+b.toFixed(0)+" + "+(C-b).toFixed(0)+")")}return f};c.findClosestPointFaceToFace=function(n,r){var e=performance.now();var o=n.vertices;var i=r.vertices;var a=n.edges;var s=r.edges;var v;var f;var l;var P;var d;var g;var p;var m=Number.MAX_VALUE;var h;var T;var M=new Float64Array(6);var D;var b;for(l=0,d=a.length;l<d;l+=2){for(v=0;v<2;++v){f=a[l+v]*3;M[v*3]=o[f];M[v*3+1]=o[f+1];M[v*3+2]=o[f+2]}for(P=0,g=s.length;P<g;P+=2){for(v=0;v<2;++v){f=s[P+v]*3;u[v*3]=i[f];u[v*3+1]=i[f+1];u[v*3+2]=i[f+2]}h=c.findClosestPointEdgeToEdge(M,u);p=c.computePointToPointDistance2(h,h,3);if(p<m){m=p;T=h}}}m=Math.sqrt(m);var E;var C;var q;var F=n.edges;var A=n.vertices;var w=r.triangles;var L=r.vertices;var x=r.boundingSpheres;var I=performance.now()-e;for(var N=0;N<2;++N){for(l=0,d=F.length;l<d;l+=2){for(v=0;v<2;++v){f=F[l+v];f*=3;M[v*3]=A[f];M[v*3+1]=A[f+1];M[v*3+2]=A[f+2]}q=[M[3],M[4],M[5]];D=[(M[0]+M[3])/2,(M[1]+M[4])/2,(M[2]+M[5])/2];b=c.computePointToPointDistance(M,M,3)/2;for(E=0,g=w.length;E<g;E+=3){p=c.computePointToPointDistance(x,D,E*4);if(p<b+m+x[E*4+3]){for(v=0;v<3;++v){f=w[E+v]*3;u[v*3]=L[f];u[v*3+1]=L[f+1];u[v*3+2]=L[f+2]}C=M;for(v=0;v<2;++v){h=c.getNearestPointOnTriangle(u,C);p=c.computePointToPointDistance(h,C);if(p<m){m=p;if(N>0){T[0]=h[0];T[1]=h[1];T[2]=h[2];T[3]=C[0];T[4]=C[1];T[5]=C[2]}else{T[0]=C[0];T[1]=C[1];T[2]=C[2];T[3]=h[0];T[4]=h[1];T[5]=h[2]}}C=q}}}}F=r.edges;A=r.vertices;w=n.triangles;L=n.vertices;x=n.boundingSpheres}var z=performance.now()-e;if(z>20){t.info("Face[t"+n.triangles.length+"/e"+n.edges.length+"/v"+n.vertices.length+"] distance to Face[t"+r.triangles.length+"/e"+r.edges.length+"/v"+r.vertices.length+"] in "+z.toFixed(1)+"ms ("+I.toFixed(0)+" + "+(z-I).toFixed(0)+")")}return T};c.hasSelfIntersections=function(t,n){var r=t?t.length/3:0;if(r>2){var e=n?r-1:r;var o,a,u;var s=[0,0,0,0,0,0];var v=[0,0,0,0,0,0];for(var f=0;f<e;++f){u=f*3;s[0]=t[u];s[1]=t[u+1];s[2]=t[u+2];u=(f+1)%r*3;s[3]=t[u];s[4]=t[u+1];s[5]=t[u+2];for(o=f+2;o<e;++o){u=o*3;v[0]=t[u];v[1]=t[u+1];v[2]=t[u+2];u=(o+1)%r*3;v[3]=t[u];v[4]=t[u+1];v[5]=t[u+2];if(!c.equalPoints(s,0,v,0)&&!c.equalPoints(s,0,v,3)&&!c.equalPoints(s,3,v,0)&&!c.equalPoints(s,3,v,3)){a=c.intersectLines(s,v);if(a&&a[0]>i&&a[0]<1-i&&a[1]>i&&a[1]<1-i){return true}}}}}return false};c.hasSelfIntersectionsLastEdge=function(t){var n=t?t.length/3:0;if(n>2){var r,e;var o=t.slice(t.length-6,t.length);var a=[0,0,0,0,0,0];for(var u=0;u<n;++u){e=u*3;a[0]=t[e];a[1]=t[e+1];a[2]=t[e+2];e=(u+1)%n*3;a[3]=t[e];a[4]=t[e+1];a[5]=t[e+2];if(!c.equalPoints(o,0,a,0)&&!c.equalPoints(o,0,a,3)&&!c.equalPoints(o,3,a,0)&&!c.equalPoints(o,3,a,3)){r=c.intersectLines(o,a);if(r&&r[0]>i&&r[0]<1-i&&r[1]>i&&r[1]<1-i){return true}}}}return false};c.computeTriangleArea=function(t,n,r,e){var o=[t[n],t[n+1],t[n+2]];var i=[t[r],t[r+1],t[r+2]];var a=[t[e],t[e+1],t[e+2]];var u=c.computePointToPointDistance(o,i);var s=c.computePointToPointDistance(i,a);var v=c.computePointToPointDistance(a,o);var f=(u+s+v)/2;return Math.sqrt(f*((f-u)*(f-s)*(f-v)))};c.computeTriangleAverageCoordinate=function(t,n,r,e){return[(t[n]+t[r]+t[e])/3,(t[n+1]+t[r+1]+t[e+1])/3,(t[n+2]+t[r+2]+t[e+2])/3]};c.translateUnits=function(t,r){var e=null;switch(t){case"mm":e="MM";break;case"cm":e="CM";break;case"m":e="M";break;case"in":e="IN";break;case"ft":e="FT";break;default:return""}return n().getText("UNITS_SHORT_"+e+(r?r:""))};c.getUnitFactor=function(t){switch(t){case"mm":return 1;case"cm":return 1/10;case"m":return 1/1e3;case"in":return 1/25.4;case"ft":return 1/(25.4*12);default:return 1}};c.clampAngle2PI=function(t){while(t>=s){t-=s}while(t<0){t+=s}return t};c.clampAngle=function(t,n,r){var e=c.clampAngle2PI(t);var o=c.clampAngle2PI(r<0?n-r+s:n);var i=c.clampAngle2PI(r<0?n:n+r);if(i<o){if(e<o){o-=s}else{i+=s}}return Math.max(Math.min(e,i),o)};c.isClosedContour=function(t){return t&&t.length>9&&c.equalPoints(t,0,t,t.length-3)};c.findClosedContour=function(t,n,r){var e=Math.abs(n[0]);var o=Math.abs(n[r]);var i=Math.abs(n[n.length-1]);var a=i-e+1;var u=Array.apply(null,{length:a*2});var s,c;for(s=0;s<n.length;++s){var v=Math.abs(n[s])-e;if(u[v*2]===undefined){u[v*2]=s}u[v*2+1]=s}var f=(o-e)*2;var l=u[f];var P=u[f+1];var d=t.slice(l*2,P*2+2);var g=n.slice(l,P+1);r-=l;u[f]=null;u[f+1]=null;var p=false;var m=true;var h=true;var T,M;var D,b;while(p||m){h=!h;D=d[h?0:d.length-2];b=d[h?1:d.length-1];m=p;p=false;for(s=0;s<a;++s){f=s*2;l=u[f];P=u[f+1];if(u[f]!=null){if(D===t[l*2]&&b===t[l*2+1]){T=t.slice(l*2+2,P*2+2);M=n.slice(l+1,P+1);p=true}else if(D===t[P*2]&&b===t[P*2+1]){T=[];for(c=P*2-2;c>=l*2;c-=2){T.push(t[c],t[c+1])}M=n.slice(l,P).reverse();p=true}}if(p){u[f]=null;u[f+1]=null;if(h){r+=M.length;g=M.reverse().concat(g);var E=[];for(c=T.length-2;c>=0;c-=2){E.push(T[c],T[c+1])}d=E.concat(d)}else{g=g.concat(M);d=d.concat(T)}break}}}var C=g.length;for(s=r-1;s>=0;--s){if(g[s]>=0){D=d[s*2];b=d[s*2+1];for(c=r;c<C;++c){if(c-s>=3&&g[c]>=0&&D===d[c*2]&&b===d[c*2+1]){return d.slice(s*2,c*2+2)}}}}return null};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Vertex", ["sap/base/assert","./Feature","./FeatureType"],function(t,e,r){"use strict";var o=[0,0,0];var s=function(t){e.apply(this,arguments);this._vertex=new Float64Array(3);this.setValue(t&&t.vertex||o)};s.prototype=Object.create(e.prototype);s.prototype.constructor=s;s.prototype.isVertex=true;e._classMap.set(r.Vertex,s);s.prototype.setValue=function(e){t(e.length===3,"Vertex array must have 3 elements");this._vertex.set(e);return this};s.prototype.getValue=function(){return this._vertex};s.prototype.toJSON=function(){return{type:r.Vertex,vertex:Array.from(this._vertex)}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/BaseNodeProxy", ["../BaseNodeProxy"],function(e){"use strict";var t=e.extend("sap.ui.vk.svg.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});t.prototype.init=function(e,t){this._element=t};t.prototype.reset=function(){this._element=null};t.prototype.getNodeRef=function(){return this._element};t.prototype.getNodeId=function(){return this._element};t.prototype.getName=function(){return this._element.name||"<"+this._element.type+">"};t.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{}};t.prototype.getSceneRef=function(){return this._element};return t});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/ContentDeliveryService", ["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../svg/SceneBuilder","../getResourceBundle","../ObjectType"],function(e,t,r,n,a,o){"use strict";var i=t.extend("sap.ui.vk.svg.ContentDeliveryService",{metadata:{library:"sap.ui.vk",properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geometriesBatchSize:{type:"int",defaultValue:128},geometriesMaxBatchDataSize:{type:"int",defaultValue:1048576},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:1048576},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0},skipLowLODRendering:{type:"boolean",defaultValue:false}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},constructor:function(e,a){this._loader=new r;this._loader.setSceneBuilder(new n);t.apply(this,arguments);this._transientSceneMap=new Map;this._currentNodeHierarchy=null}});i.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests()};i.prototype.setMaxActiveRequests=function(e){this._loader.setMaxActiveRequests(e);return this};i.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength()};i.prototype.setMaxUrlLength=function(e){this._loader.setMaxUrlLength(e);return this};i.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize()};i.prototype.setMeshesBatchSize=function(e){this._loader.setMeshesBatchSize(e);return this};i.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize()};i.prototype.setMaterialsBatchSize=function(e){this._loader.setMaterialsBatchSize(e);return this};i.prototype.getGeometriesBatchSize=function(){return this._loader.getGeometriesBatchSize()};i.prototype.setGeometriesBatchSize=function(e){this._loader.setGeometriesBatchSize(e);return this};i.prototype.getGeometriesMaxBatchDataSize=function(){return this._loader.getGeometriesMaxBatchDataSize()};i.prototype.setGeometriesMaxBatchDataSize=function(e){this._loader.setGeometriesMaxBatchDataSize(e);return this};i.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize()};i.prototype.setGeomMeshesBatchSize=function(e){this._loader.setGeomMeshesBatchSize(e);return this};i.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize()};i.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._loader.setGeomMeshesMaxBatchDataSize(e);return this};i.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize()};i.prototype.setAnnotationsBatchSize=function(e){this._loader.setAnnotationsBatchSize(e);return this};i.prototype.getTracksBatchSize=function(){return this._loader.getTracksBatchSize()};i.prototype.setTracksBatchSize=function(e){this._loader.setTracksBatchSize(e);return this};i.prototype.getSequencesBatchSize=function(){return this._loader.getSequencesBatchSize()};i.prototype.setSequencesBatchSize=function(e){this._loader.setSequencesBatchSize(e);return this};i.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold()};i.prototype.setVoxelThreshold=function(e){this._loader.setVoxelThreshold(e);return this};i.prototype.getSkipLowLODRendering=function(){return this._loader.getSkipLowLODRendering()};i.prototype.setSkipLowLODRendering=function(e){this._loader.setSkipLowLODRendering(e);return this};function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16).toLowerCase()})}i.prototype.initUrl=function(e,t,n){var a=this;function o(){a.fireSceneUpdated({})}function i(){var e;if(a._loader&&a._loader.currentSceneInfo){var t=a._loader.getContext(a._loader.currentSceneInfo.id);if(t){e=t.currentViewGroupId}}a.fireViewGroupUpdated({currentViewGroupId:e})}if(!this._loader.running()||this._loader.getUrl()!==e){if(this._loader.running()){var d=this._loader.sceneBuilder;this._loader.dispose();this._loader=new r;this._loader.setSceneBuilder(d)}this._loader.onErrorCallbacks.attach(this._reportError.bind(a));this._loader.onMaterialFinishedCallbacks.attach(o);this._loader.onImageFinishedCallbacks.attach(o);this._loader.onImageDetailsFinishedCallbacks.attach(o);this._loader.onSetGeometryCallbacks.attach(o);this._loader.onViewGroupUpdatedCallbacks.attach(i);this._loader.setUrl(e);this._loader.setCorrelationId(n?n:s());return this._loader.run()}else if(!t){this._loader.cleanup()}return Promise.resolve("Loader is ready")};i.prototype._reportError=function(e){this.fireErrorReported(e)};i.prototype._createLoadParam=function(t,r,n,a){var o=this;var i;var s=false;var d;if(this._currentNodeHierarchy){d=this._currentNodeHierarchy.getScene()}var c={root:n,includeHidden:a.getIncludeHidden(),includeAnimation:a.getIncludeAnimation(),pushPMI:a.getPushPMI(),includeBackground:a.getIncludeBackground(),includeParametric:a.getIncludeParametric(),includeUsageId:a.getIncludeUsageId(),metadataFilter:a.getMetadataFilter(),useSecureConnection:a.getUseSecureConnection(),activateView:a.getActivateView(),enableLogger:a.getEnableLogger(),pushViewGroups:a.getPushViewGroups(),vkScene:d,onActiveCamera:function(e){var t=false;var r=o._loader.getContext(a.getVeid());if(r&&r.phase<2){i=e;t=true}if(!t){o.fireCameraChanged({sceneId:a.getVeid(),camera:e})}},onInitialSceneFinished:function(e){s=true;t({node:n,camera:i,contentResource:a,initialView:e,annotations:o.getSceneBuilder()._annotations,loader:o})},onSceneCompleted:function(){o.fireSceneCompleted({sceneId:a.getVeid()})},onLoadingFinished:function(){var e,t;if(o._loader&&o._loader.currentSceneInfo){var r=o._loader.getContext(o._loader.currentSceneInfo.id);if(r){e=r.currentViewId;t=r.currentViewGroupId}}o.fireLoadingFinished({currentViewId:e,currentViewGroupId:t})},onContentChangesProgress:function(e){o.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})},onInitialViewCompleted:function(){o.fireInitialViewCompleted({sceneId:a.getVeid()})}};var u=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var n;if(t.getParameter("errorText")){n=t.getParameter("errorText")}else if(t.getParameter("error")){n=t.getParameter("error")}else if(t.getParameter("reason")){n=t.getParameter("reason")}else{n="failed to load: unknown reason"}if(s){var a=t.getParameter("error");if(a&&a===4){o.initUrl(this._loader.getUrl(),true)}}else{o.detachErrorReported(u);if(t.getParameter("events")){n=n+"\n"+JSON.stringify(t.getParameter("events"))}r(n)}};o.attachErrorReported(u);return c};i.prototype.load=function(e,t,r){var n=this;var o=t.getNodeProxy();if(o){this._currentNodeHierarchy=o.getNodeHierarchy()}return new Promise(function(o,i){if(!t.getSource()||!t.getVeid()){i(a().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return}n.initUrl(t.getSource(),true);var s=n._createLoadParam(o,i,e,t);if(n._loader){n._loader.request(t.getVeid(),s,r)}})};i.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder()}return null};i.prototype.decrementResourceCountersForDeletedTreeNode=function(e){var t=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(t,e)};i.prototype.loadTransientScene=function(e,t,r){var n=this;return new Promise(function(o,i){if(!e||!t){i(a().getText("CONTENTDELIVERYSERVICE_MSG_INVALIDARGUMENTS"));return}if(n._transientSceneMap.has(e)){var s=n._transientSceneMap.get(e).clone();t.add(s);o({nodeRef:s});return}if(!n._loader){i(a().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}var d=function(){n.detachLoadingFinished(d);if(n._transientSceneMap.get(e)){var r=n._transientSceneMap.get(e).clone();t.add(r);o({nodeRef:r})}};if(n._loader.contextMap.has(e)){n.attachLoadingFinished(d);return}var c={};c.name="transient";c.userData.currentSceneId=n.getSceneBuilder()._currentSceneId;var u=function(){var r=n._loader.getContext(e);r.onSceneCompletedCallbacks.detach(u);c.userData.entityId=r.defaultRootEntityId;n._transientSceneMap.set(e,c);var a=c.clone();t.add(a);o({nodeRef:a})};var l={root:c,onSceneCompleted:u,useSecureConnection:r};n._loader.request(e,l)})};i.prototype.update=function(e,t,r){var n=this;return new Promise(function(o,i){if(!n._loader){i(a().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}n._loader.update(e,t,r).then(function(e){if(n._currentNodeHierarchy){for(var t=0;t<e.replacedNodeRefs.length;t++){n._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:e.replacedNodeRefs[t],ReplacementNodeRef:e.replacementNodeRefs[t],ReplacedNodeId:e.replacedNodeRefs[t],ReplacementNodeId:e.replacementNodeRefs[t]})}}o({sceneVeId:e.sceneVeId,sids:e.sidArray})}).catch(function(e){return i(e)})})};i.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null}this._transientSceneMap=null};i.prototype.loadView=function(t,r,n,a){if(typeof n==="undefined"){n="static"}var o=this;return this._loader.requestView(t,n,r,null,a).then(function(e){if(o._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){o._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.updatePlaybacks=function(t,r,n){var a=this;return this._loader.requestView(t,"static",r,n,true).then(function(e){if(a._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){a._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}a.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.loadViewGroup=function(t,r,n){var a=this;return this._loader.requestViewGroup(t,r,n).then(function(e){a.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.loadAnnotation=function(t,r){var n=this;return this._loader.requestAnnotation(t,r).then(function(e){n.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.assignMaterialToNodes=function(e,t,r,n){return Promise.resolve()};i.prototype.replaceMaterialOnNodes=function(e,t,r,n){return Promise.resolve()};i.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true}else{return false}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/ContentManager", ["sap/base/Log","../ContentManager","./Scene","./SceneBuilder","./Element","../Messages","../getResourceBundle","./Viewport","./ViewStateManager"],function(e,t,r,a,o,n,i){"use strict";var s=t.extend("sap.ui.vk.svg.ContentManager",{metadata:{library:"sap.ui.vk",events:{errorReported:{parameters:{error:{type:"any"}}}}}});var d=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(d.init){d.init.call(this)}};s.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null}if(d.exit){d.exit.call(this)}};s.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};s.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};s.prototype.loadContent=function(t,a){var o=this;var s=function(){o.fireContentChangesStarted();var t=new r;o._loadContentResources(t,a).then(function(r){e.info("Content loading resolved",r);if(r&&r.length>0&&r[0].initialView){t.setInitialView(r[0].initialView)}var a;for(a=0;a<r.length;a++){if(r[a].camera){t.camera=r[a].camera;break}}if(r.length>0){var n=r[0];t.backgroundTopColor=n.backgroundTopColor;t.backgroundBottomColor=n.backgroundBottomColor}for(a=0;a<r.length;a++){if(r[a].loader){t.loaders=t.loaders||[];t.loaders.push(r[a].loader)}if(r[a].builder){t.builders=t.builders||[];t.builders.push(r[a].builder)}}if(o._totaraLoader){t.setSceneBuilder(o._totaraLoader.getSceneBuilder())}o.fireContentChangesFinished({content:t})},function(t){e.info("Content loading rejected:",t);var r;if(typeof t==="string"){r=t}else if(t.errorText){r=t.errorText}else if(t.message){r=t.message}r=r||i().getText(n.VIT37.summary);e.error(i().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),r);o.fireContentChangesFinished({content:null,failureReason:[{error:t,errorMessage:r}]})})};s();return this};s.prototype._getTotaraLoader=function(){if(this._totaraLoader==null){return new Promise(function(e){var t="sap/ui/vk/totara/TotaraLoader";sap.ui.require([t],function(t){var r=new t;r.setSceneBuilder(new a);e(r)})})}return Promise.resolve(this._totaraLoader)};s.prototype._getMataiLoader=function(){if(this._mataiLoader==null){var e=this;return new Promise(function(t){var r="sap/ui/vk/matai/MataiLoader";sap.ui.require([r],function(r){t(e._mataiLoader=new r)})})}return Promise.resolve(this._mataiLoader)};s.prototype._createLoadParam=function(t,r,a,o){var n=this;var i;var s=false;var d={root:a,vkScene:this._currentScene,enableLogger:o.getEnableLogger(),includeAnimation:false,includeBackground:o.getIncludeBackground(),includeHidden:o.getIncludeHidden(),includeParametric:true,includeUsageId:o.getIncludeUsageId(),metadataFilter:o.getMetadataFilter(),pushPMI:true,pushViewGroups:o.getPushViewGroups(),useSecureConnection:o.getUseSecureConnection(),onActiveCamera:function(e){i=e},onInitialSceneFinished:function(e){s=true;t({node:a,contentResource:o,initialView:e,camera:i,loader:n._totaraLoader})},onLoadingFinished:function(){n.fireContentLoadingFinished({source:o,node:a})},onContentChangesProgress:function(e){n.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})}};var u=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var a;if(t.getParameter("errorText")){a=t.getParameter("errorText")}else if(t.getParameter("error")){a=t.getParameter("error")}else if(t.getParameter("reason")){a=t.getParameter("reason")}else{a="failed to load: unknown reason"}if(s){var o=t.getParameter("error");if(o&&o===4){n.initUrl(this._loader.getUrl(),true)}}else{n.detachErrorReported(u);if(t.getParameter("events")){a=a+"\n"+JSON.stringify(t.getParameter("events"))}r(a)}};n.attachErrorReported(u);return d};s.prototype._reportError=function(e){this.fireErrorReported(e)};s.prototype._loadStream=function(e,t){var r=this;return new Promise(function(a,o){r._getTotaraLoader().then(function(n){r._totaraLoader=n;var i=r._createLoadParam(a,o,e,t);n.onErrorCallbacks.attach(r._reportError.bind(r));n.setUrl(t.getSource());n.run();n.request(t.getVeid(),i,r._authorizationHandler)})})};s.prototype._loadVDS4=function(e,t){var r=this;return this._getMataiLoader().then(function(a){if(a){r._mataiLoader=a;a.attachContentChangesProgress(r._handleContentChangesProgress,r);a.attachContentLoadingFinished(r._handleContentLoadingFinished,r);return a.load(e,t)}else{return Promise.resolve({node:e,contentResource:t})}})};s.prototype._loadContentResources=function(e,t){this._currentScene=e;this._currentNodeHierarchy=e.getDefaultNodeHierarchy();var r=[];var a=this;t.forEach(function e(t,n){var i=new o;i.name=n.getName();i.sourceId=n.getSourceId();t.add(i);n._shadowContentResource={nodeProxy:this._currentNodeHierarchy.createNodeProxy(i)};var s=n._contentManagerResolver;var d=s&&s.settings?s.settings.loader:null;if(d){if(typeof d==="function"){r.push(d(i,n,a._authorizationHandler))}else if(d&&d.load){i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(d.load(i,n,a._authorizationHandler));this._totaraLoader=d._loader;this._totaraLoader.onLoadingFinishedCallbacks.attach(function(){a.fireContentLoadingFinished({source:n,node:i})})}else{r.push(Promise.resolve({node:i,contentResource:n}))}}else{var u=n.getSourceType();switch(u?u.toLowerCase():null){case"stream2d":{i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(this._loadStream(i,n));break}case"vds4-2d":{i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(this._loadVDS4(i,n));break}default:break}}}.bind(this,e.getRootElement()));return Promise.all(r)};s.prototype.destroyContent=function(e){if(e){e.destroy()}if(this._totaraLoader){this._totaraLoader.dispose();this._totaraLoader=null}else if(this._mataiLoader&&e.builders&&Array.isArray(e.builders)){e.builders.forEach(function(e){if(e){e.cleanup()}});this._mataiLoader.destroy();this._mataiLoader=null}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Element", ["../abgrToColor","../cssColorToColor","../NodeContentType","sap/base/assert","sap/base/util/uid"],function(t,e,i,s,r){"use strict";var o=function(t){t=t||{};this.type="Group";this.uid=r();this.sid=t.sid||undefined;this.name=t.name||undefined;this.vMask=1|0;this.sMask=0|0;this.matrix=new Float32Array(t.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=i.Regular;this.materialId=t.materialID;if(t.lineStyle){this.lineStyle=t.lineStyle}if(t.fillStyle){this.fillStyle=t.fillStyle}this.userData=t.subelement?{skipIt:true}:{};this.classList=new Set};function n(t,i){if(t===null||t===undefined){return Float32Array([0,0,0,i])}var s=t.match(/\w\w/g).map(function(t){return parseInt(t,16)});if(s.length==4){i=s[3]/255}if(s.length<3||isNaN(s[0]+s[1]+s[2]+i)){t=e(t);return new Float32Array([t.red/255,t.green/255,t.blue/255,t.alpha])}return new Float32Array([s[0]/255,s[1]/255,s[2]/255,i])}function h(t,e){if(t){if(typeof t==="string"){return n(t,e)}else if(t.length===4){return new Float32Array(t)}else{return new Float32Array([t[0],t[1],t[2],e])}}return new Float32Array([0,0,0,0])}o.prototype.defaultFillAlpha=0;o.prototype.setFillStyle=function(t,e){if(t){this.fillStyle=t;if(t.fillURL){this.fillURL=t.fillURL}else{this.fill=h(t.colour,1)}}else{this.fill=new Float32Array([0,0,0,0])}if(this._fillStyleId){this.removeClass(this._fillStyleId);this._fillStyleId=null}if(e){this.invalidate()}};o.prototype.setLineStyle=function(t,e){if(t){this.lineStyle=t;this.stroke=h(t.colour,1);this.strokeWidth=t.width||1;this.strokeDashArray=o._convertDashes(t.dashes||[],this.strokeWidth)}else{this.stroke=new Float32Array([0,0,0,0]);this.strokeWidth=1;this.strokeDashArray=[]}if(this._lineStyleId){this.removeClass(this._lineStyleId);this._lineStyleId=null}if(e){this.invalidate()}};o.prototype.setMaterial=function(t,e){t=t||{};if(this.materialId===t.materialId){this.setFillStyle(this.fillStyle);var i=this.lineStyle;if(i){this.setLineStyle(i)}else{this.stroke=h(t.lineColor,1);this.strokeWidth=t.lineWidth!==undefined?t.lineWidth:1;this.strokeDashArray=t.lineStyle&&t.lineStyle.dashPattern||[]}}for(var s=0,r=this.children.length;s<r;s++){this.children[s].setMaterial(t)}if(e){this.invalidate()}};o._convertDashes=function(t,e){var i=[];for(var s=0;s<t.length;s++){var r=t[s]*10;if(r>0){i.push(r);i.push(0)}else if(r<0){i.push(0);i.push(-r)}else{i.push(e);i.push(e)}}return i};o._convertToDashes=function(t,e){var i=[];for(var s=0;s<t.length;s+=2){var r=t[s];var o=t[s+1];if(r===e&&o===e){i.push(0)}else if(o===0){i.push(r*.1)}else if(r===0){i.push(o*-.1)}}return i};o.prototype.add=function(t){if(t.parent!==null){t.parent.remove(t)}t.parent=this;this.children.push(t);t.sMask=this.sMask;if(this.highlightColor){t.highlightColor=this.highlightColor}var e=this._hasHostpotAncestor();if(e||this.nodeContentType===i.Hotspot){this._updateHotspotDescendants(e?null:this)}if(this.domRef){t.traverse(function(t){if(!t.domRef){t.domRef=p(t)?t.parent.domRef:t._createDomElement()}if(t.domRef&&t.parent.domRef&&t.parent.domRef!==t.domRef&&t.domRef.parentNode!==t.parent.domRef){t.parent.domRef.appendChild(t.domRef)}})}return this};o.prototype.remove=function(t){var e=this.children.indexOf(t);if(e!==-1){if(t.domRef&&this.domRef&&t.domRef.parentNode===this.domRef){this.domRef.removeChild(t.domRef)}t.parent=null;this.children.splice(e,1)}return this};o.prototype.replace=function(t,e){var i=this.children.indexOf(t);if(i!==-1){t.parent=null;e.parent=this;this.children[i]=e;e.domRef=t.domRef;e.invalidate()}return this};o.prototype._vkPersistentId=function(){var t=this;do{if(t.sid){return t.sid}t=t.parent}while(t);return null};o.prototype._vkGetNodeContentType=function(){return this.nodeContentType};o.prototype._updateHotspotDescendants=function(t){this.traverse(function(e){if(e===t){return}e.userData.skipIt=true;if(e._isGeometryNode()){e.fill=e.stroke=new Float32Array([1,1,1,1]);this._updateColor()}else if(e.domRef){e.domRef.removeAttribute("filter");e.domRef.removeAttribute("opacity")}}.bind(this))};o.prototype._initAsHotspot=function(){if(this._hasHostpotAncestor()){return}this._updateHotspotDescendants(this);if(this.domRef!==null){if(this.domRef===(this.parent&&this.parent.domRef)){this.invalidate()}else{this._updateColor()}}};o.prototype._vkSetNodeContentType=function(t){this.nodeContentType=t;if(t===i.Hotspot){this._initAsHotspot()}};o.prototype.traverse=function(t){t(this);var e=this.children;for(var i=0,s=e.length;i<s;i++){e[i].traverse(t)}};o.prototype.traverseAncestors=function(t){var e=this.parent;if(e!==null){t(e);e.traverseAncestors(t)}};o.prototype.traverseVisible=function(t,e){if(this.isVisible(e)){t(this);var i=this.children;for(var s=0,r=i.length;s<r;s++){i[s].traverseVisible(t,e)}}};o.prototype.setVisible=function(t,e){if(!this.userData.skipIt){if(e){this.vMask|=t}else{this.vMask&=~t}if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^p(this)){this.invalidate()}else if(e){this.domRef.removeAttribute("display")}else{this.domRef.setAttribute("display","none")}}}};o.prototype.isVisible=function(t){return this.userData.skipIt||(this.vMask&t)!==0};o.prototype._updateColor=function(t){var e=this.domRef;if(e!==null){if(this.nodeContentType===i.Hotspot&&!this._hasHostpotAncestor()){e.setAttribute("filter","url(#"+this.getHotspotEffectDef().name+")");e.setAttribute("opacity",this._getHotspotOpacity())}else{var s=e.setAttribute.bind(e);if(this.highlightColor||this.tintColor){if(this._fillStyleId){this.removeClass(this._fillStyleId)}this._setFillStyleAttributes(s);if(this._lineStyleId){this.removeClass(this._lineStyleId)}this._setLineStyleAttributes(s)}else{if(this._fillStyleId){this.addClass(this._fillStyleId);e.removeAttribute("fill")}else{this._setFillStyleAttributes(s)}if(this._lineStyleId){this.addClass(this._lineStyleId);e.removeAttribute("stroke");e.removeAttribute("stroke-width");e.removeAttribute("vector-effect");e.removeAttribute("stroke-dasharray")}else{this._setLineStyleAttributes(s)}}}}};o.prototype._getHotspotOpacity=function(){return this.highlightColor||this.customHotspotColor||this.hotspotColor?1:0};o._hotspotEffectName=function(t){return"hotspot-effect-"+m(t.red,t.green,t.blue,t.alpha)};o.prototype.getHotspotEffectDef=function(){var i;if(this.highlightColor){i=t(this.highlightColor)}else{var s=this.customHotspotColor||this.hotspotColor;if(s){i=typeof s==="number"?t(s):e(s)}else{i={red:0,green:0,blue:0,alpha:0}}}return{name:o._hotspotEffectName(i),color:i}};o.prototype.setSelected=function(t,e,i){if(e){this.sMask|=t;this.highlightColor=i}else{this.sMask&=~t;delete this.highlightColor}this._updateColor(t)};o.prototype.isSelected=function(t){return(this.sMask&t)!==0};o.prototype.setTintColor=function(t,e){s(this.nodeContentType!==i.Hotspot&&"setTintColor() method is not for hotspots, use setHotspotColor() method");this.tintColor=e;this._updateColor(t)};o.prototype.getTintColor=function(){return this.tintColor};o.prototype.setHotspotColor=function(t,e){s(this.nodeContentType===i.Hotspot&&"setHotspotColor() method is only for hotspots");this.hotspotColor=e;this._updateColor(t)};o.prototype.setCustomHotspotColor=function(t,e){s(this.nodeContentType===i.Hotspot&&"setCustomHotspotColor() method is only for hotspots");this.customHotspotColor=e;this._updateColor(t)};o.prototype._isGeometryNode=function(){return this.constructor!==o};o.prototype.setOpacity=function(t){s(this.nodeContentType!==i.Hotspot&&"setOpacity() method is not for hotspots");if(this._isGeometryNode()){return}this.opacity=t;if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^p(this)){this.invalidate()}else if(t!==undefined){this.domRef.setAttribute("opacity",t)}else{this.domRef.removeAttribute("opacity")}}};function a(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0}o.prototype.setMatrix=function(t){this.matrix.set(t);if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^p(this)){this.invalidate()}else if(!this.parent||this.domRef!==this.parent.domRef){if(!a(t)){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")")}else{this.domRef.removeAttribute("transform")}}}};o._multiplyMatrices=function(t,e){var i=t[0],s=t[2],r=t[4];var o=t[1],n=t[3],h=t[5];var a=e[0],l=e[2],f=e[4];var d=e[1],p=e[3],u=e[5];return new Float32Array([i*a+s*d,o*a+n*d,i*l+s*p,o*l+n*p,i*f+s*u+r,o*f+n*u+h])};o._invertMatrix=function(t){var e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],n=t[5],h=e*r-i*s;if(h===0){return new Float32Array([0,0,0,0,0,0])}var a=1/h;var l=new Float32Array(6);l[0]=r*a;l[1]=-i*a;l[2]=-s*a;l[3]=e*a;l[4]=(n*s-r*o)*a;l[5]=(i*o-n*e)*a;return l};o._decompose=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);var i=Math.sqrt(t[2]*t[2]+t[3]*t[3]);var s=t[0]*t[3]-t[1]*t[2];if(s<0){i*=-1}var r=t[0]/e,o=t[1]/e,n=t[2]/i,h=t[3]/i;var a,l;if(r+h+1>0){l=.5/Math.sqrt(2+r+h);a=[0,0,(n-o)*l,.25/l]}else{l=2*Math.sqrt(2-r-h);a=[0,0,.25*l,(n-o)/l]}return{position:[t[4],t[5],0],quaternion:a,scale:[e,i,1]}};o._compose=function(t,e,i){var s=i[0],r=i[1];var o=e[0],n=e[1],h=-e[2],a=e[3];var l=o*n,f=h*h,d=a*h;return new Float32Array([(1-(n*n+f)*2)*s,(l+d)*2*s,(l-d)*2*r,(1-(o*o+f)*2)*r,t[0],t[1]])};o._transformPoint=function(t,e,i){return{x:t*i[0]+e*i[2]+i[4],y:t*i[1]+e*i[3]+i[5]}};o.prototype._matrixWorld=function(t){if(t!==undefined){return o._multiplyMatrices(t,this.matrix)}else{var e=this.parent;var i=this.matrix;while(e!==null){i=o._multiplyMatrices(e.matrix,i);e=e.parent}return i}};function l(t,e,i,s,r){t.min.x=Math.min(t.min.x,e-s);t.min.y=Math.min(t.min.y,i-r);t.max.x=Math.max(t.max.x,e+s);t.max.y=Math.max(t.max.y,i+r)}function f(t){return t*t}o.prototype._expandBoundingBoxCE=function(t,e,i,s,r,o){l(t,i*e[0]+s*e[2]+e[4],i*e[1]+s*e[3]+e[5],Math.abs(r*e[0])+Math.abs(o*e[2]),Math.abs(r*e[1])+Math.abs(o*e[3]))};o.prototype._expandBoundingBoxCR=function(t,e,i,s,r,o){l(t,i*e[0]+s*e[2]+e[4],i*e[1]+s*e[3]+e[5],Math.sqrt(f(r*e[0])+f(o*e[2])),Math.sqrt(f(r*e[1])+f(o*e[3])))};o.prototype._expandBoundingBox=function(t,e){};o.prototype._expandBoundingBoxRecursive=function(t,e,i){if(this.isVisible(e)){var s=this._matrixWorld(i);this._expandBoundingBox(t,s);var r=this.children;for(var o=0,n=r.length;o<n;o++){r[o]._expandBoundingBoxRecursive(t,e,s)}}};function d(t,e){var i=t.width*.5;var s=t.height*.5;var r=t.x+i;var o=t.y+s;var n=r*e[0]+o*e[2]+e[4];var h=r*e[1]+o*e[3]+e[5];var a=Math.abs(i*e[0])+Math.abs(s*e[2]);var l=Math.abs(i*e[1])+Math.abs(s*e[3]);return{x:n-a,y:h-l,width:a*2,height:l*2}}o.prototype._getBBox=function(t){if(this.domRef){var e;if(!this.parent||this.domRef!==this.parent.domRef){e=this.domRef.getBBox();if(t&&e){e=d(e,t)}return e}var i=Infinity,s=Infinity,r=-Infinity,n=-Infinity;for(var h=0,a=this.children.length;h<a;h++){var l=this.children[h];e=l._getBBox(t?o._multiplyMatrices(t,l.matrix):l.matrix);if(e){i=Math.min(i,e.x);s=Math.min(s,e.y);r=Math.max(r,e.x+e.width);n=Math.max(n,e.y+e.height)}}if(i<=r&&s<=n){return{x:i,y:s,width:r-i,height:n-s}}}return null};function p(t){return t.parent!==null&&t.constructor===o&&a(t.matrix)&&t.opacity===undefined&&(t.nodeContentType!==i.Hotspot||t._hasHostpotAncestor())&&t.vMask===1}o.prototype._getSceneTreeElement=function(){var t=this;var e=t.parent;while(e){if(e.userData.closed||e.nodeContentType!==i.Regular){t=e}e=e.parent}while(t.userData.skipIt){t=t.parent}return t};function u(t,e,i){function s(t,e,i){var s,r;for(var o=0,n=t.length;o<n;o++){var h=t[o];var a=e*h.x+i*h.y;if(o===0||s>a){s=a}if(o===0||r<a){r=a}}return{min:s,max:r}}var r=[o._transformPoint(t.x,t.y,e),o._transformPoint(t.x+t.width,t.y,e),o._transformPoint(t.x+t.width,t.y+t.height,e),o._transformPoint(t.x,t.y+t.height,e)];var n=[{x:i.x1,y:i.y1},{x:i.x2,y:i.y1},{x:i.x2,y:i.y2},{x:i.x1,y:i.y2}];var h=r.concat(n);for(var a=0,l=h.length-1;a<h.length;l=a++){var f=h[l];var d=h[a];var p=d.y-f.y,u=f.x-d.x;var c=s(r,p,u);var y=s(n,p,u);if(c.max<y.min||y.max<c.min){return false}}return true}o.prototype._findRectElementsRecursive=function(t,e,i,s){if(this.isVisible(i)){var r=this._matrixWorld(s);if(this._isGeometryNode()){var o=this._getBBox();if(o&&u(o,r,e)){t.add(this._getSceneTreeElement())}}var n=this.children;for(var h=0,a=n.length;h<a;h++){n[h]._findRectElementsRecursive(t,e,i,r)}}};o.prototype.tagName=function(){return"g"};o.prototype._setBaseAttributes=function(t,e){t("id",this.uid);if(this.nodeContentType===i.Hotspot){if(!this._hasHostpotAncestor()){t("filter","url(#"+this.getHotspotEffectDef().name+")");t("opacity",this._getHotspotOpacity())}}else if(this.opacity!==undefined){t("opacity",this.opacity)}if(!a(this.matrix)){t("transform","matrix("+this.matrix.join(",")+")")}if(!this.isVisible(e)){t("display","none")}if(!this._fillStyleId||!this.classList.has(this._fillStyleId)){this._setFillStyleAttributes(t)}if(!this._lineStyleId||!this.classList.has(this._lineStyleId)){this._setLineStyleAttributes(t)}if(this.classList.size){t("class",Array.from(this.classList).join(" "))}};o.prototype._setSpecificAttributes=function(t,e){};o.prototype._setFillStyleAttributes=function(t){if(this.fillURL!==undefined){t("fill",this.fillURL)}else if(this.fill!==undefined){t("fill",this._cssColor(this.fill))}};o.prototype._setLineStyleAttributes=function(t){if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){t("stroke",this._cssColor(this.stroke));if(this.strokeWidth!==1){t("stroke-width",this.strokeWidth)}t("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){t("stroke-dasharray",this.strokeDashArray.join(" "))}}};o.prototype.render=function(t,e,s){var r=p(this),o;if(!r){o=this.tagName();t.openStart(o);if(s&&this._isGeometryNode()){var n=s._getFillStyleId(this);if(this._fillStyleId!==n){if(this._fillStyleId){this.removeClass(this._fillStyleId)}this._fillStyleId=n;if(n){this.addClass(this._fillStyleId)}}var h=s._getLineStyleId(this);if(this._lineStyleId!==h){if(this._lineStyleId){this.removeClass(this._lineStyleId)}this._lineStyleId=h;if(h){this.addClass(this._lineStyleId)}}}var a=t.attr.bind(t);this._setBaseAttributes(a,e);this._setSpecificAttributes(a,null);t.openEnd();if(this._renderContent){this._renderContent(t)}}var l=[];this.children.forEach(function(r){if(r.nodeContentType===i.Hotspot){l.push(r)}else{r.render(t,e,s)}});l.forEach(function(i){i.render(t,e)});if(!r){t.close(o)}};o._svgNamespace="http://www.w3.org/2000/svg";o.prototype._createDomElement=function(t){var e=document.createElementNS(o._svgNamespace,this.tagName());var i=e.setAttribute.bind(e);this._setBaseAttributes(i,1<<t);this._setSpecificAttributes(i,e);if(this._createContent){this._createContent(e)}return e};function c(t,e){var i=t.domRef;if(i&&i!==e&&i.parentNode===e){return i}var s=t.children;for(var r=0,o=s.length;r<o;r++){i=c(s[r],e);if(i!==null){return i}}return null}o.prototype._replaceParentDomRef=function(t,e){for(var i=0,s=this.children.length;i<s;i++){var r=this.children[i];if(r.domRef){if(r.domRef===t){r.domRef=e;r._replaceParentDomRef(t,e)}else if(r.domRef.parentNode===t){if(t.parentNode===e){e.insertBefore(r.domRef,t)}else{e.appendChild(r.domRef)}}}}};o.prototype.invalidate=function(t){var e=this.domRef;if(e!==null){var i=this.parent&&this.parent.domRef;if(p(this)){if(e!==i){this.domRef=i;this._replaceParentDomRef(e,this.domRef);e.remove()}}else{this.domRef=this._createDomElement(t);if(e===i){i.insertBefore(this.domRef,c(this,i))}else if(i){i.replaceChild(this.domRef,e)}this._replaceParentDomRef(e,this.domRef)}}};o.prototype._setDomRef=function(t){this.domRef=t;var e=this.children;for(var i=0,s=e.length;i<s;i++){var r=e[i];var o=document.getElementById(r.uid);if(o===null&&p(r)){o=t}r._setDomRef(o)}};o.prototype.getElementByProperty=function(t,e){if(this[t]===e){return this}var i=this.children;for(var s=0,r=i.length;s<r;s++){var o=i[s].getElementByProperty(t,e);if(o!==null){return o}}return null};o.prototype.getElementById=function(t){return this.getElementByProperty("uid",t)};o.prototype.copy=function(t,e){this.name=t.name;this.matrix=t.matrix.slice();this.nodeContentType=t.nodeContentType;this.materialId=t.materialId;this.lineStyle=t.lineStyle;this.fillStyle=t.fillStyle;this.classList=new Set(t.classList);if(t.opacity!==undefined){this.opacity=t.opacity}if(t.tintColor!==undefined){this.tintColor=t.tintColor}if(t.hotspotColor){this.hotspotColor=t.hotspotColor}if(t.customHotspotColor){this.customHotspotColor=t.customHotspotColor}if(t.fillURL!==undefined){this.fillURL=t.fillURL}if(t.fill!==undefined){this.fill=t.fill.slice()}if(t.stroke!==undefined){this.stroke=t.stroke.slice()}if(t.strokeWidth!==undefined){this.strokeWidth=t.strokeWidth}if(t.strokeDashArray!==undefined){this.strokeDashArray=t.strokeDashArray.slice()}if(t.userData.skipIt){this.userData.skipIt=true}if(e||e===undefined){for(var i=0,s=t.children.length;i<s;i++){this.add(t.children[i].clone())}}return this};o.prototype.clone=function(){return(new this.constructor).copy(this)};function y(t,e,i){return t+(e-t)*i}function m(t,e,i,s){var r=(t<<24|e<<16|i<<8|s*255)>>>0;return"#"+("00000000"+r.toString(16)).slice(-8)}function v(t){return m(t[0]*255,t[1]*255,t[2]*255,t[3])}o.prototype._cssColor=function(e){var i=e[3];if(i===0){return"none"}var s=e[0]*255;var r=e[1]*255;var o=e[2]*255;var n=this.tintColor;if(n){n=t(n);var h=n.alpha;if(h>0){s=y(s,n.red,h);r=y(r,n.green,h);o=y(o,n.blue,h)}}var a=this.highlightColor;if(a){a=t(a);var l=a.alpha;if(l>0){s=y(s,a.red,l);r=y(r,a.green,l);o=y(o,a.blue,l);i=y(i,l,l)}}return m(s,r,o,i)};function _(t,e){function i(t,e){return Object.entries(t).every(function(t){return e[t[0]]===t[1]})&&Object.entries(e).every(function(e){return t[e[0]]===e[1]})}var s=e.findIndex(function(e){return i(e,t)});if(s<0){s=e.length;e.push(t)}return s}o.prototype._getParametricShape=function(t,e,i){var s={};if(!a(this.matrix)){var r=o._decompose(this.matrix);s.t=r.position;s.r=r.quaternion;s.s=r.scale}var n=this._hasHostpotAncestor();if(!n&&this.fill!==undefined){s.fill=_({colour:v(this.fill)},t)}var h=parseFloat(this.strokeWidth);if(this.stroke!==undefined&&this.stroke[3]>0&&h>0&&(h!==1||this.strokeDashArray.length>0)){var l={width:typeof this.strokeWidth==="number"?this.strokeWidth+"px":this.strokeWidth};if(!n){l.colour=v(this.stroke)}if(this.strokeDashArray.length>0){l.dashes=o._convertToDashes(this.strokeDashArray,this.strokeWidth)}s.stroke=_(l,e)}return s};o.prototype.getParametricContent=function(t,e,i){var s=[];this.children.forEach(function(r){var o=r._getParametricShape(t,e,i);if(o.type!==undefined){s.push(o)}});if(s.length===0){return null}return s.length===1?s[0]:{shapes:s}};o.prototype._hasHostpotAncestor=function(){var t=this.parent;while(t){if(t.nodeContentType===i.Hotspot){return true}t=t.parent}return false};o.prototype.addClass=function(t){this.classList.add(t);if(this.domRef){this.domRef.setAttribute("class",Array.from(this.classList).join(" "))}return this};o.prototype.removeClass=function(t){this.classList.delete(t);if(this.domRef){if(this.classList.size){this.domRef.setAttribute("class",Array.from(this.classList).join(" "))}else{this.domRef.removeAttribute("class")}}return this};o.prototype.hasClass=function(t){return this.classList.has(t)};o.prototype.toggleClass=function(t){if(this.hasClass(t)){this.removeClass(t)}else{this.addClass(t)}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Ellipse", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Ellipse";this.cx=i.cx||0;this.cy=i.cy||0;this.rx=i.major||i.radius||0;this.ry=i.minor||i.radius||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"ellipse"};i.prototype._expandBoundingBox=function(t,i){var r=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;this._expandBoundingBoxCR(t,i,this.cx,this.cy,this.rx+r,this.ry+r)};i.prototype._setSpecificAttributes=function(t){if(this.cx){t("cx",this.cx)}if(this.cy){t("cy",this.cy)}t("rx",this.rx);t("ry",this.ry)};i.prototype._getParametricShape=function(i,r,s){var e=t.prototype._getParametricShape.call(this,i,r,s);if(this.rx===this.ry){e.type="circle";e.radius=this.rx}else{e.type="ellipse";e.major=this.rx;e.minor=this.ry}return e};i.prototype.copy=function(i,r){t.prototype.copy.call(this,i,r);this.cx=i.cx;this.cy=i.cy;this.rx=i.rx;this.ry=i.ry;return this};return i});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/HotspotHelper", ["../NodeContentType","./Element","./Rectangle","./Path","sap/base/assert","sap/base/util/uid","../TransformationMatrix","../thirdparty/imagetracer","../uuidv4"],function(t,e,r,a,i,o,n,s,l){"use strict";var u=function(){};u.prototype.createHotspot=function(e,r,a,i,o){var n=e.getDefaultNodeHierarchy().createNode(r,i,null,t.Hotspot,o);this.updateHotspot(n,a);return n};u.prototype.removeHotspot=function(t,e){t.getDefaultNodeHierarchy().removeNode(e)};u.prototype.duplicateHotspot=function(t,r,a,i){t=Array.isArray(t)?t:[t];var o;if(a){o=e._multiplyMatrices(e._invertMatrix(t[0]._matrixWorld()),a)}else if(i){var n=i._camera._transformRect({x1:0,y1:0,x2:30,y2:30});o=[1,0,0,1,n.x2-n.x1,n.y2-n.y1]}var s=e._invertMatrix(r._matrixWorld());var l=[];t.forEach(function(t){var a=t.clone();a.userData.duplicatedFrom=t.sid;var i=e._multiplyMatrices(o,t._matrixWorld());var n=e._multiplyMatrices(s,i);a.matrix.set(n);r.add(a);l.push(a)});return l.length===1?l[0]:l};u.prototype.updateHotspot=function(a,i){var o=a.children.length;while(o-- >0){var n=a.children[o];if(n.userData.sourceJointNode!==undefined){a.remove(n)}}if(i){a.userData.jointNodes=Array.from(i)}var s=e._invertMatrix(a._matrixWorld());function l(i){i.traverse(function(i){if(i.nodeContentType===t.Hotspot||i.parent===a){return}var o;if(i.type==="Image"){o=new r({x:i.x,y:i.y,width:i.width,height:i.height})}else if(i.type!=="Group"){o=(new i.constructor).copy(i,false)}if(o){o.matrix=e._multiplyMatrices(s,i._matrixWorld());o.userData.sourceJointNode=i;a.add(o)}})}i=a.userData.jointNodes;if(i){i.forEach(function(e){if(e.nodeContentType!==t.Hotspot&&e.parent!==a){l(e)}})}a._initAsHotspot()};u.prototype.getHotspotRelatedNodes=function(t){if(t&&t.userData&&t.userData.jointNodes){return t.userData.jointNodes}return[]};u.prototype.mergeHotspots=function(r,a){var i=r.getDefaultNodeHierarchy();var s=a[0];var l=i.createNode(null,s.name,null,t.Hotspot,{sid:o()});var u=[],d=[];var h=e._invertMatrix(l._matrixWorld());var c=function(t,e){return e._vkGetNodeContentType()===t};a.forEach(function(r){if(r.children.every(c.bind(null,t.Hotspot))){var a=r.children.length;while(a--){var i=r.children[0];var o=e._multiplyMatrices(h,i._matrixWorld());r.remove(i);l.add(i);i.matrix=o;u.push(i)}d.push(r)}else if(r.children.every(c.bind(null,t.Regular))){r.parent.remove(r);l.add(r);r.matrix=e._multiplyMatrices(h,r._matrixWorld());u.push(r)}});if(u){l.userData.jointNodes=Array.from(u)}if(s.hotspotColor!=null){l.setHotspotColor(s.vMask,s.hotspotColor)}if(s.customHotspotColor!=null){l.setCustomHotspotColor(s.vMask,s.customHotspotColor)}i.removeNode(d);var p=[],f=[],m=[],v=[],g=[];var y={name:l.name,contentType:t.Hotspot,joints:[],children:[]};l.userData.jointNodes.forEach(function(e,r){var a=e.getParametricContent(m,v,g);f.push(a);p.push({name:e.name,transform:n.convert3x2To4x3(e.matrix),parametric:r,contentType:t.Hotspot});y.joints.push({child:r,type:"LINK",action:"bubble"});y.children.push(r)});p.push(y);a.forEach(function(t){p.push({suppressed:true,sid:t.sid})});var x=r.getViewStateManager().getCurrentView();return{nodeRef:l,request:{views:[{id:x.getViewId(),name:x.getName(),nodes:p}],parametrics:f,fillstyles:m,linestyles:v,textStyles:g}}};u.prototype.mergeElements=function(r,a){i(a.length&&"HotspotHelper.mergeElements: at least one node must be provided");var n=r.createNode(null,a[0].name,null,t.Regular,{sid:o()});var s=e._invertMatrix(n._matrixWorld());var l={name:n.name,contentType:"geometry",parametric:0};var u=[l],d=[],h=[],c=[],p=[];var f=new Set;a.forEach(function(t){t.traverse(function(t){if(t._isGeometryNode()){f.add(t)}})});a.forEach(function(t){u.push({suppressed:true,sid:t.sid})});f.forEach(function(t){var r=t._matrixWorld();t.parent.remove(t);n.add(t);t.setMatrix(e._multiplyMatrices(s,r));t.userData.skipIt=true;var a=t._getParametricShape(h,c,p);if(a.type!==undefined){d.push(a)}});a.forEach(function(t){if(!f.has(t)){t.parent.remove(t)}});var m={nodes:u,parametrics:[{shapes:d}]};if(h.length>0){m.fillStyles=h}if(c.length>0){m.lineStyles=c}if(p.length>0){m.textStyles=p}return{nodeRef:n,request:m}};u.prototype.createHotspotFromGeometry=function(r,i,o){return new Promise(function(n,l){r=Array.isArray(r)?r:[r];var u=[];r.forEach(function(t){t.traverseVisible(function(t){if(t._isGeometryNode()){u.push(t)}},-1>>>0)});if(u.length===1){switch(u[0].type){case"Rectangle":case"Ellipse":case"Line":var d=i.createNode(o,r[0].name,null,t.Hotspot);d.setMatrix(e._multiplyMatrices(e._invertMatrix(d.parent._matrixWorld()),u[0]._matrixWorld()));var h=u[0].clone();h.setMatrix([1,0,0,1,0,0]);d.add(h);n(d);return;default:break}}var c;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");u.forEach(function(t){var e=t._getBBox(t._matrixWorld());if(!c){c=e}else{c.width=Math.max(c.x+c.width,e.x+e.width);c.height=Math.max(c.y+c.height,e.y+e.height);c.x=Math.min(c.x,e.x);c.y=Math.min(c.y,e.y);c.width-=c.x;c.height-=c.y}var r=t.domRef.cloneNode(true);if(r.getAttribute("fill")){r.setAttribute("fill","#000")}if(r.getAttribute("stroke")){r.setAttribute("stroke","#000")}r.setAttribute("transform","matrix("+t._matrixWorld().join(",")+")");p.appendChild(r)});var f=c.width*.05;var m=c.height*.05;c.x-=f;c.y-=m;c.width+=f*2;c.height+=m*2;p.setAttribute("width",Math.ceil(1e3*c.width/Math.max(c.width,c.height)));p.setAttribute("height",Math.ceil(1e3*c.height/Math.max(c.width,c.height)));p.setAttribute("viewBox",[c.x,c.y,c.width,c.height].join(" "));p.setAttribute("font-family",'"72","72full",Arial,Helvetica,sans-serif');var v=new Image;v.onload=function(){var u=document.createElement("canvas");var d=u.width=this.width;var h=u.height=this.height;var p=u.getContext("2d");var f=i.createNode(o,r[0].name,null,t.Hotspot);var m=f.parent._matrixWorld();var v=m[3]<0;if(v){f.setMatrix(e._multiplyMatrices(e._invertMatrix(m),[c.width/d,0,0,-c.height/h,c.x,c.y+c.height]));p.transform(1,0,0,-1,0,h)}else{f.setMatrix(e._multiplyMatrices(e._invertMatrix(m),[c.width/d,0,0,c.height/h,c.x,c.y]))}p.drawImage(this,0,0,d,h);var g=p.getImageData(0,0,d,h);function y(t,e){return t+e*d<<2}var x=p.createImageData(d,h);var w,_;var M,H;function N(t,e){return t>=0&&t<d&&e>=0&&e<h?M[y(t,e)+3]:0}for(var b=0;b<2;b++){M=g.data;H=x.data;for(_=1;_<h;_++){for(w=1;w<d;w++){if(N(w,_)>127||N(w-1,_)>127||N(w+1,_)>127||N(w,_-1)>127||N(w,_+1)>127){H[y(w,_)+3]=255}}}var C=g;g=x;x=C}var D=g.data;function A(t,e){var r=y(t,e);return D[r+3]<128&&D[r]!==1}var E=[0,0];while(E.length>0){_=E.pop();w=E.pop();D[y(w,_)]=1;if(w+1<d&&A(w+1,_)){E.push(w+1,_)}if(w>0&&A(w-1,_)){E.push(w-1,_)}if(_+1<h&&A(w,_+1)){E.push(w,_+1)}if(_>0&&A(w,_-1)){E.push(w,_-1)}}for(_=0;_<h;_++){for(w=0;w<d;w++){if(A(w,_)){D[y(w,_)+3]=255}}}var S=s.imagedataToSVG(g,{ltres:2,qtres:2,pathomit:8,rightangleenhance:false,colorsampling:0,numberofcolors:2,mincolorratio:0,colorquantcycles:1,blurradius:0,blurdelta:20,strokewidth:0,linefilter:true,roundcoords:0,pal:[{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255}],desc:false});var T=[];var W=(new DOMParser).parseFromString(S,"image/svg+xml");if(W&&W.firstChild&&W.firstChild.tagName==="svg"){for(var I=W.firstChild.firstChild;I!==null;I=I.nextSibling){if(I.tagName==="path"&&I.getAttribute("opacity")>.5){T=T.concat(a._extractSegmentsFromDomRef(I))}}}if(T.length>0){f.add(new a({segments:T}));n(f)}else{f.parent.remove(f);l()}};v.src="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(p))})};u.prototype.createRequest=function(e,r){if(!e||!r){return null}var a=[];var i=[];var o=[];var s=[];var u=[];var d=r&&r._currentView;function h(e,r){r.setNodePersistentId(e,l());var d={name:e.name,transform:n.convert3x2To4x3(e.matrix),veId:e.sid};if(e.nodeContentType===t.Hotspot){d.contentType="HOTSPOT"}if(e.userData.duplicatedFrom){d.duplicatedFrom=e.userData.duplicatedFrom;delete e.userData.duplicatedFrom}var c=e.getParametricContent(o,s,u);if(c){d.parametric=i.length;i.push(c)}var p=a.length;a.push(d);var f=e.children;if(f.length>0){var m=[];for(var v=0;v<f.length;v++){if(f[v].type==="Group"){m.push(h(f[v],r))}}if(m.length>0){d.children=m}}return p}var c=r.getScene();(Array.isArray(e)?e:[e]).forEach(function(t){h(t,c)});var p={views:[{id:d&&d.getViewId(),nodes:a}],parametrics:i};if(o.length>0){p.fillstyles=o}if(s.length>0){p.linestyles=s}if(u.length>0){p.textStyles=u}return p};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Image", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Image";this.x=i.x||0;this.y=i.y||0;this.width=i.width||0;this.height=i.height||0;this.data=i.data||null;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"image"};i.prototype.setMaterial=function(t,i){if(t&&this.materialId===t.materialId){var h=t.textureWidth;var e=t.textureHeight;if(h&&e){this.width=h;this.height=e}if(t.texture){this.data=t.texture}if(i){this.invalidate()}}};i.prototype._setSpecificAttributes=function(t,i){if(this.x){t("x",this.x)}if(this.y){t("y",this.y)}if(this.width>0&&this.height>0&&this.data){t("width",this.width);t("height",this.height);if(i){i.setAttribute("href",this.data)}else{t("href",this.data)}}};i.prototype._expandBoundingBox=function(t,i){var h=this.width*.5;var e=this.height*.5;this._expandBoundingBoxCE(t,i,this.x+h,this.y+e,h,e)};i.prototype._getParametricShape=function(i,h,e){var a=t.prototype._getParametricShape.call(this,i,h,e);a.type="rectangle";a.width=this.width;a.length=this.height;return a};i.prototype.copy=function(i,h){t.prototype.copy.call(this,i,h);this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.data=i.data;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Line", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Line";this.x1=i.x1||0;this.y1=i.y1||0;this.x2=i.x2||0;this.y2=i.y2||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"line"};i.prototype.setFillStyle=function(t,i){};i.prototype._expandBoundingBox=function(t,i){var e=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;this._expandBoundingBoxCE(t,i,this.x1,this.y1,e,e);this._expandBoundingBoxCE(t,i,this.x2,this.y2,e,e)};i.prototype._setSpecificAttributes=function(t){t("x1",this.x1);t("y1",this.y1);t("x2",this.x2);t("y2",this.y2)};i.prototype._getParametricShape=function(i,e,s){var o=t.prototype._getParametricShape.call(this,i,e,s);o.type="line";o.x1=this.x1;o.y1=this.y1;o.x2=this.x2;o.y2=this.y2;return o};i.prototype.copy=function(i,e){t.prototype.copy.call(this,i,e);this.x1=i.x1;this.y1=i.y1;this.x2=i.x2;this.y2=i.y2;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/LinearGradient", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="LinearGradient";this.x1=i.x1;this.y1=i.y1;this.x2=i.x2;this.y2=i.y2;this.gradient=i.gradient||[];this.gradientUnits="userSpaceOnUse"};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"linearGradient"};i.prototype._setBaseAttributes=function(t,i){t("id",this.uid)};i.prototype._setSpecificAttributes=function(t){if(this.x1!==undefined){t("x1",this.x1)}if(this.y1!==undefined){t("y1",this.y1)}if(this.x2!==undefined){t("x2",this.x2)}if(this.y2!==undefined){t("y2",this.y2)}if(this.gradientTransform!==undefined){t("gradientTransform","matrix("+this.gradientTransform.join(",")+")")}if(this.gradientUnits!==undefined){t("gradientUnits",this.gradientUnits)}};i.prototype._renderContent=function(t){var i=this.gradient;for(var e=0,n=i.length;e<n;e+=2){t.openStart("stop");t.attr("offset",i[e]);t.attr("stop-color",i[e+1]);t.openEnd();t.close("stop")}};i.prototype._createContent=function(i){var e=this.gradient;for(var n=0,r=e.length;n<r;n+=2){var s=document.createElementNS(t._svgNamespace,"stop");s.setAttribute("offset",e[n]);s.setAttribute("stop-color",e[n+1]);i.append(s)}};i.prototype.copy=function(i,e){t.prototype.copy.call(this,i,e);this.x1=i.x1;this.y1=i.y1;this.x2=i.x2;this.y2=i.y2;this.gradient=i.gradient.slice();if(this.gradientUnits!==undefined){this.gradientUnits=i.gradientUnits}if(i.gradientTransform!==undefined){this.gradientTransform=i.gradientTransform.slice()}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/NodeHierarchy", ["../NodeHierarchy","sap/ui/base/ObjectPool","./Element","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(e,t,n,o,r,i,a,d,s,c,u){"use strict";var h={equals:function(e,t){return e===t},contains:function(e,t){return e.indexOf(t)!==-1},startsWith:function(e,t){return e.indexOf(t)===0}};var f=e.extend("sap.ui.vk.svg.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new t(o),constructor:function(t){e.call(this);this._scene=t;this._nodeProxies=[]}});f.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;e.prototype.destroy.call(this)};f.prototype.getScene=function(){return this._scene};f.prototype.getSceneRef=function(){return this._scene.getRootElement()};f.prototype.enumerateChildren=function(e,t,n,o){if(typeof e==="function"){o=n;n=t;t=e;e=undefined}var r=this.getChildren(e,n);if(o){r.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{r.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};f.prototype.enumerateAncestors=function(e,t,n){var o=this.getAncestors(e);if(n){o.forEach(t)}else{var r=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){r.init(this,e);t(r);r.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(r)}}return this};f.prototype.createNodeProxy=function(e){var t=new r(this,e);this._nodeProxies.push(t);return t};f.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};f.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}e=e||this._scene.getRootElement();return t||!e.closed?e.children:[]};f.prototype.getAncestors=function(e){var t=[];e.traverseAncestors(function(e){t.unshift(e)});if(t.length>0&&t[0]===this._scene.getRootElement()){t.shift()}return t};f.prototype.findNodesByName=function(e){var t=[];if(e===undefined||e===null||e===""||jQuery.isEmptyObject(e)){this._scene.getRootElement().children.forEach(function(e){e.traverse(function(e){t.push(e)})})}else{var n=h[e.predicate||"equals"];if(n===undefined){u.error(a().getText(i.VIT8.summary),i.VIT8.code,"sap.ui.vk.svg.NodeHierarchy")}else if(!Array.isArray(e.value)&&typeof e.value!=="string"){u.error(a().getText(i.VIT6.summary),i.VIT6.code,"sap.ui.vk.svg.NodeHierarchy")}else{var o=Array.isArray(e.value)?e.value:[e.value];if(!e.caseSensitive){for(var r in o){o[r]=o[r].toLowerCase()}}this._scene.getRootElement().children.forEach(function(r){r.traverse(function(r){var i=r.name||"";if(!e.caseSensitive){i=i.toLowerCase()}for(var a in o){if(n(i,o[a])){t.push(r);break}}})})}}return t};f.prototype.createLayerProxy=function(e){return null};f.prototype.destroyLayerProxy=function(e){return this};f.prototype.getLayers=function(){return[]};f.prototype.getHotspotNodeIds=function(){var e=[];this._scene.getRootElement().traverse(function(t){if(t._vkGetNodeContentType()===d.Hotspot){e.push(t)}});return e};f.prototype.attachChanged=function(e,t,n){return this.attachEvent("changed",e,t,n)};f.prototype.detachChanged=function(e,t,n){return this.detachEvent("changed",e,t,n)};f.prototype.fireChanged=function(e,t,n){return this.fireEvent("changed",e,t,n)};f.prototype.attachNodeCreated=function(e,t,n){return this.attachEvent("nodeCreated",e,t,n)};f.prototype.detachNodeCreated=function(e,t,n){return this.detachEvent("nodeCreated",e,t,n)};f.prototype.fireNodeCreated=function(e,t,n){return this.fireEvent("nodeCreated",e,t,n)};f.prototype.attachNodeRemoving=function(e,t,n){return this.attachEvent("nodeRemoving",e,t,n)};f.prototype.detachNodeRemoving=function(e,t,n){return this.detachEvent("nodeRemoving",e,t,n)};f.prototype.fireNodeRemoving=function(e,t,n){return this.fireEvent("nodeRemoving",e,t,n)};f.prototype.attachNodeReplaced=function(e,t,n){return this.attachEvent("nodeReplaced",e,t,n)};f.prototype.detachNodeReplaced=function(e,t,n){return this.detachEvent("nodeReplaced",e,t,n)};f.prototype.fireNodeReplaced=function(e,t,n){return this.fireEvent("nodeReplaced",e,t,n)};f.prototype.attachNodeUpdated=function(e,t,n){return this.attachEvent("nodeUpdated",e,t,n)};f.prototype.detachNodeUpdated=function(e,t,n){return this.detachEvent("nodeUpdated",e,t,n)};f.prototype.fireNodeUpdated=function(e,t,n){return this.fireEvent("nodeUpdated",e,t,n)};f.prototype.createNode=function(e,t,o,r,i){var u=this.getScene().getSceneBuilder();var h=null;if(u){i=i||{};i.name=i.name||t;i.sid=i.sid||s();h=u.createNode(i);if(!e){e=h.parent}}else{if(!e){e=this._scene.getRootElement()}h=new n;h.name=t;e.add(h)}var f=e.children.indexOf(o);c(e.children[e.children.length-1]===h,a().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){e.children.splice(f,0,e.children.pop())}if(r){h._vkSetNodeContentType(r)}else{h._vkSetNodeContentType(d.Regular)}if(i&&u){switch(h._vkGetNodeContentType()){case d.Annotation:i.node=h;i.nodeId=h._vkPersistentId();u.createAnnotation(i);break;default:}}this.fireNodeCreated({nodeRef:h,nodeId:h});this.fireChanged();return h};f.prototype.getNodeContentType=function(e){if(e==null){return d.Regular}var t=e._vkGetNodeContentType();if(!t){t=d.Regular}return t};f.prototype.createNodeCopy=function(e,t,n,o){if(!t){t=this._scene.getRootElement()}var r=t.children.indexOf(o);var i=e.clone(true);i.name=n;t.add(i);c(t.children[t.children.length-1]===i,a().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(r>=0){t.children.splice(r,0,t.children.pop())}this.fireNodeCreated({nodeRef:i,nodeId:i});this.fireChanged();return i};f.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){if(e&&e.parent){this.fireNodeRemoving({nodeRef:e,nodeId:e});e.parent.remove(e)}}.bind(this));var n=this.getScene().getSceneBuilder();if(n){t.forEach(n.removeNode,n)}this.fireChanged();return this};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/NodeProxy", ["../NodeProxy","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./Element"],function(t,e,r,o,n,i,s){"use strict";var p=t.extend("sap.ui.vk.svg.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(e,r){t.call(this);this._element=r;this._nodeHierarchy=e}});p.prototype.destroy=function(){this._element=null;t.prototype.destroy.call(this)};p.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};p.prototype.getNodeRef=function(){return this._element};p.prototype.getNodeId=function(){return this._element};p.prototype.getVeIds=function(){return this._element.userData.veids||[]};p.prototype.getVeId=function(){return this._element.sid};p.prototype.getName=function(){return this._element.name||"<"+this._element.type+">"};p.prototype.getLocalMatrix=function(){return i.convert3x2To4x3(this._element.matrix)};p.prototype.setLocalMatrix=function(t){if(t){this._element.matrix=i.convert4x3To3x2(t)}this.setProperty("localMatrix",t,true);return this};p.prototype.getWorldMatrix=function(){return i.convert3x2To4x3(this._element._matrixWorld())};p.prototype.setWorldMatrix=function(t){if(t){var e=i.convert4x3To3x2(t);var r=this._element;if(r.parent){r.matrix=s._multiplyMatrices(s._invertMatrix(r.parent._matrixWorld()),e)}else{r.matrix=e}}this.setProperty("worldMatrix",t,true);return this};p.prototype.getOpacity=function(){return this._element.opacity};p.prototype.setOpacity=function(t){this.setProperty("opacity",t,true);return this};p.prototype.getTintColorABGR=function(){return this._element.tintColor};p.prototype.setTintColorABGR=function(t){this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",r(o(t)),true);return this};p.prototype.getTintColor=function(){return r(o(this._element.tintColor))};p.prototype.setTintColor=function(t){var r=n(e(t));this.setProperty("tintColorABGR",r,true);this.setProperty("tintColor",t,true);return this};p.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{}};p.prototype.getHasChildren=function(){return this._element.children.length>0};p.prototype.getClosed=function(){return!!this._element.closed};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/OrthographicCamera", ["../OrthographicCamera"],function(t){"use strict";var i=t.extend("sap.ui.vk.svg.OrthographicCamera",{metadata:{library:"sap.ui.vk"}});var o=t.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(o.init){o.init.call(this)}this.zoom=1;this.offsetX=0;this.offsetY=0;this._width=0;this._height=0;this.zoomedObject=null};i._MIN_ZOOM=1e-15;i.prototype.update=function(t,o,h){if(this._width!==t||this._height!==o){if(this._width>0&&this._height>0){var s=Math.min(t,o)/Math.min(this._width,this._height);s=Math.max(s,i._MIN_ZOOM/this.zoom);this.zoom*=s;this.offsetX=(this.offsetX-this._width*.5)*s+t*.5;this.offsetY=(this.offsetY-this._height*.5)*s+o*.5}else{h=true}this._width=t;this._height=o;if(h){this.reset()}}};i.prototype.reset=function(){if(this._initialZoom){this.setZoomFactor(this._initialZoom)}if(this._initialPosition){this.setPosition(this._initialPosition)}};i.prototype._getViewBox=function(){var t=this.zoom>0?1/this.zoom:1;return[-this.offsetX*t,-this.offsetY*t,this._width*t,this._height*t]};i.prototype._setViewBox=function(t,o,h){this.zoom=Math.min(o,h)/Math.min(t[2],t[3]);this.zoom=Math.max(this.zoom,i._MIN_ZOOM);this.offsetX=o*.5-(t[0]+t[2]*.5)*this.zoom;this.offsetY=h*.5-(t[1]+t[3]*.5)*this.zoom;this._width=o;this._height=h};i.prototype._zoomTo=function(t,o,h,s){var e=Math.min(o/(t.max.x-t.min.x),h/(t.max.y-t.min.y))/(1+(s||0));e=Math.max(e,i._MIN_ZOOM);this.zoom=e;this.offsetX=(o-(t.min.x+t.max.x)*e)*.5;this.offsetY=(h-(t.min.y+t.max.y)*e)*.5;this._width=o;this._height=h};i.prototype._screenToWorld=function(t,i){return{x:(t-this.offsetX)/this.zoom,y:(i-this.offsetY)/this.zoom}};i.prototype._worldToScreen=function(t,i){return{x:t*this.zoom+this.offsetX,y:i*this.zoom+this.offsetY}};i.prototype._transformRect=function(t){var i=this._screenToWorld(t.x1,t.y1);var o=this._screenToWorld(t.x2,t.y2);return{x1:Math.min(i.x,o.x),y1:Math.min(i.y,o.y),x2:Math.max(i.x,o.x),y2:Math.max(i.y,o.y)}};i.prototype._getYSign=function(){return this.getUpDirection()[1]>=0?-1:1};i.prototype.getPosition=function(){var t=this.zoom>0?1/this.zoom:1;return[(this._width*.5-this.offsetX)*t,(this._height*.5-this.offsetY)*t*this._getYSign(),0]};i.prototype.setPosition=function(t){if(Array.isArray(t)&&t.length>=2){if(!this._initialPosition){this._initialPosition=t.slice()}if(this._width>0&&this._height>0){this.offsetX=this._width*.5-t[0]*this.zoom;this.offsetY=this._height*.5-t[1]*this._getYSign()*this.zoom}}};i.prototype.getZoomFactor=function(){return this.zoom*2/Math.min(this._width,this._height)};i.prototype.setZoomFactor=function(t){if(this._initialZoom==null){this._initialZoom=t}if(this._width>0&&this._height>0){var o=t*.5*Math.min(this._width,this._height);o=Math.max(o,i._MIN_ZOOM);this.offsetX+=(this._width*.5-this.offsetX)*(this.zoom-o)/this.zoom;this.offsetY+=(this._height*.5-this.offsetY)*(this.zoom-o)/this.zoom;this.zoom=o}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Path", ["sap/base/Log","./Element"],function(e,t){"use strict";var i=function(e){e=e||{};t.call(this,e);this.type="Path";this.segments=e.segments||[];this.setMaterial(e.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"path"};i.prototype._expandBoundingBox=function(e,t){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(e,t,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}var n=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var r=0,s=0;for(var a=0,o=this.segments.length;a<o;a++){var p=this.segments[a];var h=p.points;var f=p.dimension||2,c,u;switch(p.type){case"arc":if(p.relative){r+=h[0];s+=h[1]}else{r=h[0];s=h[1]}this._expandBoundingBoxCE(e,t,r,s,n,n);break;case"move":r=h[0];s=h[1];this._expandBoundingBoxCE(e,t,r,s,n,n);for(c=f,u=h.length-1;c<u;c+=f){if(p.relative){r+=h[c];s+=h[c+1]}else{r=h[c];s=h[c+1]}this._expandBoundingBoxCE(e,t,r,s,n,n)}break;case"line":for(c=0,u=h.length-1;c<u;c+=f){if(p.relative){r+=h[c];s+=h[c+1]}else{r=h[c];s=h[c+1]}this._expandBoundingBoxCE(e,t,r,s,n,n)}break;case"bezier":var d=p.degree||2;for(c=0,u=h.length-1;c<u;c+=f){if(p.relative){this._expandBoundingBoxCE(e,t,r+h[c],s+h[c+1],n,n);if(c/f%d===d-1){r+=h[c];s+=h[c+1]}}else{r=h[c];s=h[c+1];this._expandBoundingBoxCE(e,t,r,s,n,n)}}break;default:break}}};function n(t,i){var n,r;var s=i.points;switch(i.degree||2){case 2:for(n=0,r=s.length-3;n<r;n+=4){t.push(i.relative?"q":"Q",s[n],s[n+1],s[n+2],s[n+3])}break;case 3:if(!i.smooth){for(n=0,r=s.length-5;n<r;n+=6){t.push(i.relative?"c":"C",s[n],s[n+1],s[n+2],s[n+3],s[n+4],s[n+5])}}else{for(n=0,r=s.length-3;n<r;n+=4){t.push(i.relative?"s":"S",s[n],s[n+1],s[n+2],s[n+3])}}break;default:e.warning("Unsupported bezier segment degree:",i.type);break}}function r(e,t){var i=t.points;e.push("M",i[0],i[1]);var n=t.dimension||2;for(var r=n,s=i.length-1;r<s;r+=n){e.push("L",i[r],i[r+1])}}function s(e,t){var i=t.points;var n=t.dimension||2;for(var r=0,s=i.length-1;r<s;r+=n){e.push(t.relative?"l":"L",i[r],i[r+1])}}function a(e,t){e.push(t.relative?"a":"A",t.major,t.minor,"0",t.short===false?"1":"0",t.clockwise===false?"0":"1",t.points[0],t.points[1])}i.prototype._setSpecificAttributes=function(t){var i=[];this.segments.forEach(function(t){switch(t.type){case"move":r(i,t);break;case"line":s(i,t);break;case"close":i.push("Z");break;case"arc":a(i,t);break;case"bezier":n(i,t);break;default:e.warning("Unsupported path segment type:",t.type,JSON.stringify(t));break}});if(i.length>0){t("d",i.join(" "))}};i.prototype._getParametricShape=function(e,i,n){var r=t.prototype._getParametricShape.call(this,e,i,n);r.type="path";r.segments=this.segments;return r};i.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);for(var n=0,r=e.segments.length;n<r;n++){var s=e.segments[n];var a={type:s.type};if(s.points!==undefined){a.points=s.points.slice()}if(s.dimension!==undefined){a.dimension=s.dimension}if(s.degree!==undefined){a.degree=s.degree}if(s.smooth!==undefined){a.smooth=s.smooth}if(s.relative!==undefined){a.relative=s.relative}if(s.major!==undefined){a.major=s.major}if(s.minor!==undefined){a.minor=s.minor}if(s.short!==undefined){a.short=s.short}if(s.clockwise!==undefined){a.clockwise=s.clockwise}this.segments.push(a)}return this};i._extractSegmentsFromDomRef=function(t){var i=[];var n=t.getAttribute("d").split(" ");var r=0;function s(){return n[r++]}function a(){return parseFloat(s())}for(var o=s();o!==undefined;o=s()){switch(o){case"M":i.push({type:"move",points:[a(),a()]});break;case"L":i.push({type:"line",points:[a(),a()]});break;case"Q":i.push({type:"bezier",degree:2,relative:false,points:[a(),a(),a(),a()]});break;case"Z":i.push({type:"close"});break;default:e.warning('Path.createFromDomRef: "'+o+'" path segment is not supported.');break}}return i};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Polyline", ["./Element"],function(t){"use strict";var o=function(o){o=o||{};t.call(this,o);this.type="Polyline";this.points=new Float32Array(o.points||[0,0,100,100]);this.closed=o.closed||false;this.setMaterial(o.material)};o.prototype=Object.assign(Object.create(t.prototype),{constructor:o});o.prototype.tagName=function(){return this.closed?"polygon":"polyline"};o.prototype._expandBoundingBox=function(t,o){var i=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var e=this.points;for(var s=0,n=e.length;s<n;s+=2){this._expandBoundingBoxCE(t,o,e[s],e[s+1],i,i)}};o.prototype._setSpecificAttributes=function(t){t("points",this.points.join(" "))};o.prototype._getParametricShape=function(o,i,e){var s=t.prototype._getParametricShape.call(this,o,i,e);s.type="polyline";s.points=Array.from(this.points);s.closed=this.closed;s.dim=2;return s};o.prototype.copy=function(o,i){t.prototype.copy.call(this,o,i);this.points=o.points.slice();this.closed=o.closed;return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Rectangle", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Rectangle";this.x=i.x||0;this.y=i.y||0;this.width=i.width||0;this.height=i.height||i.length||0;this.rx=i.rx||i.radius||0;this.ry=i.ry||i.radius||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"rect"};i.prototype._expandBoundingBox=function(t,i){var h=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var e=this.width*.5;var r=this.height*.5;this._expandBoundingBoxCE(t,i,this.x+e,this.y+r,e+h,r+h)};i.prototype._setSpecificAttributes=function(t){if(this.x){t("x",this.x)}if(this.y){t("y",this.y)}t("width",this.width);t("height",this.height);if(this.rx){t("rx",this.rx)}if(this.ry){t("ry",this.ry)}};i.prototype._getParametricShape=function(i,h,e){var r=t.prototype._getParametricShape.call(this,i,h,e);r.type="rectangle";r.width=this.width;r.length=this.height;r.radius=Math.min(this.rx,this.ry);return r};i.prototype.copy=function(i,h){t.prototype.copy.call(this,i,h);this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.rx=i.rx;this.ry=i.ry;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Scene", ["../Scene","./NodeHierarchy","./Element"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.svg.Scene",{metadata:{library:"sap.ui.vk"},constructor:function(){t.call(this);this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null}});i.prototype.init=function(){this._root=new r;this._root.userData.skipIt=true};i.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}this._sceneBuilder=null;this._root=null;t.prototype.destroy.call(this)};i.prototype.setViewStateManager=function(t){this._currentViewStateManager=t;return this};i.prototype.getViewStateManager=function(){return this._currentViewStateManager};i.prototype.getId=function(){return this._root&&this._root.id};i.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new e(this)}return this._defaultNodeHierarchy};i.prototype.getRootElement=function(){return this._root};i.prototype.setSceneBuilder=function(t){this._sceneBuilder=t};i.prototype.getSceneBuilder=function(){return this._sceneBuilder};i.prototype.nodeRefToPersistentId=function(t){return Array.isArray(t)?t.map(function(t){return t._vkPersistentId()}):t._vkPersistentId()};i.prototype.persistentIdToNodeRef=function(t){var e=this._sceneBuilder;if(Array.isArray(t)){return t.map(function(t){return e?e.getNode(t):null})}else{return e?e.getNode(t):null}};i.prototype.setNodePersistentId=function(t,e,r){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(t,e,r):false};i.prototype.getInitialView=function(){return this._initialView};i.prototype.setInitialView=function(t){this._initialView=t};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/SceneBuilder", ["sap/base/Log","./Element","./Ellipse","./Rectangle","./Line","./Polyline","./Path","./Text","./Image","./LinearGradient","./OrthographicCamera","../View","../NodeContentType","../TransformationMatrix","../getResourceBundle","../totara/TotaraUtils","../colorToCSSColor"],function(e,t,i,r,a,s,n,o,h,d,l,u,p,c,m,f,_){"use strict";var v=function(e,t,i,r){this._rootNode=e;this._contentResource=t;this._resolve=i;this._reject=r;this._cameras=new Map;this._sceneIdTreeNodesMap=new Map;this._sceneIdRootNodeMap=new Map;this._materialMap=new Map;this._annotationsMap=new Map;this._annotationNodesMap=new Map;this._materialNodesMap=new Map;this._nodes=new Map;this._viewGroups=new Map;this._views=new Map;this._viewThumbnails=new Map;this._geometries=new Map;this._geometryMeshes=new Map;this._meshNodes=new Map;this._meshSubmeshes=new Map;this._images=new Map;this._imageTextures=new Map;this._fillStyles=new Map;this._lineStyles=new Map;this._textStyles=new Map;this._joints=new Map;this._yIndex=1;this._materialsByTextureImageId=new Map;if(t){var a=t.getNodeProxy();var s=a.getNodeHierarchy();this._vkScene=s.getScene();var n=t.getSource();if(n&&n.name){this._sceneIdTreeNodesMap.set(n.name,this._nodes);this._sceneIdRootNodeMap.set(n.name,e);this._currentSceneId=n.name}if(this._rootNode){this._rootNode.userData.skipIt=!t.getName()}}};v.prototype.setScene=function(t){if(t.result!==0){var i={status:t.result};switch(t.result){case-1:i.errorText=m().getText("LOADER_FILENOTFOUND");break;case-2:i.errorText=m().getText("LOADER_WRONGFILEFORMAT");break;case-3:i.errorText=m().getText("LOADER_WRONGPASSWORD");break;case-4:i.errorText=m().getText("LOADER_ERRORREADINGFILE");break;case-5:i.errorText=m().getText("LOADER_FILECONTENT");break;default:i.errorText=m().getText("LOADER_UNKNOWNERROR")}this._reject(i)}else{this._yIndex=1;this._rootNode.matrix[3]=t.upAxis===2?-1:1;var r=this._cameras.get(t.cameraId);e.info("setScene",JSON.stringify(t),r);this._resolve({node:this._rootNode,camera:r,backgroundTopColor:t.backgroundTopColor,backgroundBottomColor:t.backgroundBottomColor,contentResource:this._contentResource,builder:this})}};v.prototype.setRootNode=function(e,t,i,r){this._rootNode=e;e.sid=t;this._nodes.set(t,e);this._viewGroups=new Map;this._views=new Map;if(i){this._sceneIdTreeNodesMap.set(i,this._nodes);this._sceneIdRootNodeMap.set(i,e);this._currentSceneId=i}if(r){this._vkScene=r}return this};v.prototype.setNodePersistentId=function(e,t,i){this._resetCurrentScene(i);e.sid=t;this._nodes.set(t,e);return true};v.prototype.cleanup=function(){this._rootNode=null;this._currentSceneId=null;this._contentResource=null;this._resolve=null;this._reject=null;if(this._nodes){this._nodes.clear()}if(this._viewGroups){this._viewGroups.clear()}if(this._views){this._views.clear()}this._cameras.clear();this._materialMap.clear();this._annotationsMap.clear();this._annotationNodesMap.clear();this._materialNodesMap.clear();this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._materialsByTextureImageId.clear();this._viewThumbnails.clear();this._geometries.clear();this._geometryMeshes.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._images.clear();this._imageTextures.clear();this._joints.clear();this._fillStyles.clear();this._lineStyles.clear();this._textStyles.clear()};v.prototype.getNode=function(e,t){if(t){this._resetCurrentScene(t);if(this._nodes){return this._nodes.get(e)}}else{var i=this._sceneIdTreeNodesMap.values();var r=i.next();while(!r.done){var a=r.value.get(e);if(a){return a}r=i.next()}}return null};v.prototype._resetCurrentScene=function(e){if(e&&e!==this._currentSceneId){var t=this._sceneIdTreeNodesMap.get(e);if(t){this._nodes=t}else{this._nodes=new Map}var i=this._sceneIdRootNodeMap.get(e);if(i){this._rootNode=i}else{this._rootNode=null}this._currentSceneId=e}};v.prototype.createCamera=function(e,t){this._resetCurrentScene(t);var i=new l;i.setUpDirection(Array.isArray(e.up)?e.up:[0,1,0]);i.setZoomFactor(e.zoom);i.setPosition(e.origin);this._cameras.set(e.id,i);return i};v.prototype.getCamera=function(e){return this._cameras.get(e)};v.prototype.hasMesh=function(e){return this._meshSubmeshes.has(e)};v.prototype.hasImage=function(e){return this._images.has(e)};v.prototype.hasAnnotation=function(e){return this._annotationsMap.has(e)};function g(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){if(e[t].type===undefined||e[t].type==="mesh"||e[t].type==="line"){return e[t]}}}return null}v.prototype.setMeshNode=function(e,t){this._setMeshNode(this._nodes.get(e),t)};v.prototype.setModelViewVisibilitySet=function(){};v.prototype.setAnimationPlaybacks=function(){};v.prototype.loadingFinished=function(e){};v.prototype.createThumbnail=function(e){var t=this._viewThumbnails.get(e.imageId);if(t){t.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,e.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:t})}}};v.prototype.setSubmeshes=function(e){var t,i,r,a,s;for(var n=0,o=e.length;n<o;++n){t=e[n];i=t.submeshes;for(a=0,s=i.length;a<s;++a){r=i[a];this.insertSubmesh(r)}}};v.prototype.insertSubmesh=function(e){if(!e.lods){return false}var t=g(e.lods);if(!t){return false}e.boundingBox=t.boundingBox;var i=this._geometries.get(t.id);if(i){var r=this._meshNodes.get(e.meshId);if(r){for(var a=0;a<r.length;a++){this._addGeometryToNode(r[a],i,e)}}}else{f.pushElementIntoMapArray(this._geometryMeshes,t.id,e)}f.pushElementIntoMapArray(this._meshSubmeshes,e.meshId,e)};v.prototype.getViewGroup=function(e,t){this._resetCurrentScene(t);var i=this._viewGroups.get(e);var r=[];if(i&&i.views){for(var a=0;a<i.views.length;a++){var s=i.views[a].id;var n=this._views.get(s);if(n){r.push(n)}}}return r};v.prototype.insertViewGroup=function(e,t){this._resetCurrentScene(t);var i=this._viewGroups.get(e.id);if(!i){i=this._vkScene.createViewGroup({viewGroupId:e.id,name:e.name,description:e.description});this._viewGroups.set(e.id,i)}else{i.setViewGroupId(e.id);i.setName(e.name);i.setDescription(e.description)}i.type=e.type;i.metadata=e.metadata;i.veids=e.veids;i.views=e.views;i.sceneId=e.sceneId;return this};v.prototype.insertView=function(e,t){this._resetCurrentScene(t);var i=this._vkScene.createView({viewId:e.viewId,name:e.name,description:e.description?'<pre class="sapVizKitViewGalleryStepDescriptionPre">'+e.description+"</pre>":e.description,aspectRatio:e.safeAreaAspectRatio,autoPlayAnimation:e.autoPlayAnimation});i.userData={viewInfo:e};if(e.thumbnailId){var r=this._images.get(e.thumbnailId);if(r){i.thumbnailData=r}else{this._viewThumbnails.set(e.thumbnailId,i)}}if(e.cameraId){i.setCamera(this._cameras.get(e.cameraId))}i.type=e.type;i.flyToTime=e.flyToTime;i.preDelay=e.preDelay;i.postDelay=e.postDelay;i.navigationMode=e.navigationMode;var a=this._getSavedColor(e.topColour,localStorage.getItem("color.backgroundTop"));if(a!=null){i.setTopColor(a)}var s=this._getSavedColor(e.bottomColour,localStorage.getItem("color.backgroundBottom"));if(s!=null){i.setBottomColor(s)}i.dimension=e.dimension;i.query=e.query;i.metadata=e.metadata;i.veids=e.veids;i.viewGroupId=e.viewGroupId;i.id=e.viewId;this._views.set(e.viewId,i);if(i.viewGroupId){var n=this._viewGroups.get(i.viewGroupId);if(n){n.addView(i)}}return this};v.prototype.getView=function(e,t){this._resetCurrentScene(t);return this._views.get(e)};v.prototype.setViewCamera=function(e,t,i){this._resetCurrentScene(i);var r=this._cameras.get(e);var a=this._views.get(t);if(r&&a){a.setCamera(r)}return this};v.prototype.getChildNodeIds=function(e,t,i){this._resetCurrentScene(t);var r=this._nodes.get(e);var a=[];if(!r){return a}if(r&&r.children){for(var s=0;s<r.children.length;s++){var n=r.children[s];if(n.userData.treeNode&&n.userData.treeNode.sid){a.push(n.userData.treeNode.sid)}else if(i&&n.userData.submeshInfo&&n.userData.submeshInfo.id){a.push(n.userData.submeshInfo.id)}}}return a};v.prototype.setViewNodeInfos=function(e,t,i){this._resetCurrentScene(i);var r=this._views.get(t);r.setNodeInfos(e);return this};v.prototype.finalizeViewGroups=function(e){this._resetCurrentScene(e);var t=this._viewGroups.entries();var i=t.next();while(!i.done){var r=i.value[1];var a=i.value[0];if(!r||!r.views||!r.views.length){i=t.next();continue}r.removeViews();for(var s=0;s<r.views.length;s++){var n=r.views[s].id;var o=this._views.get(n);if(o&&o.userData.viewInfo.thumbnailId&&!o.thumbnailData){var h=this._images.get(o.userData.viewInfo.thumbnailId);if(h){o.thumbnailData=h}}if(o){o.viewGroupId=a;r.addView(o)}}i=t.next()}return this};v.prototype.setVoxelThreshold=function(e){return this};v.prototype.getVoxelThreshold=function(){return 0};v.prototype.createNode=function(e,i){this._resetCurrentScene(i);var r=e.transform;var a=new t({sid:e.sid,name:e.name,matrix:c.convertTo3x2(r)});this._nodes.set(e.sid,a);var s=a.userData;if(e.metadata){s.metadata=e.metadata}if(e.veids){s.veids=e.veids}if(e.usageIds){s.usageIds=e.usageIds}if(e.parametricId){s.parametricId=e.parametricId}else if(e.meshId){this._setMeshNode(a,e.meshId)}s.treeNode=e;a.setVisible(1,e.visible?e.visible:true);if(e.visualisable===false){s.skipIt=true}if(e.joints){e.joints.forEach(function(e){var t=this._nodes.get(e.parentSid);if(t){t.userData.jointNodes=t.userData.jointNodes||[];t.userData.jointNodes.push(a)}else{f.pushElementIntoMapArray(this._joints,e.parentSid,a)}},this)}var n=this._joints.get(e.sid);if(n){s.jointNodes=s.jointNodes?s.jointNodes.concat(n):n}if(e.viewBox){s.viewBox=e.viewBox}var o=this._nodes.get(e.parentId);(o||this._rootNode).add(a);if(e.contentType==="HOTSPOT"){a._vkSetNodeContentType(p.Hotspot)}else if(e.contentType==="ANNOTATION"){a._vkSetNodeContentType(p.Annotation)}return a};v.prototype.preferMeshes=function(){return false};v.prototype.createAnnotation=function(e,t){f.pushElementIntoMapArray(this._annotationNodesMap,e.annotationId,e.nodeId);var i=this.getAnnotation(e.annotationId);if(i){this.createImageNote(i,t)}};v.prototype.remove=function(e,t){this._resetCurrentScene(t);var i=this;e=[].concat(e);e.forEach(function(e){var r=i._nodes.get(e);if(r){i._nodes.delete(e);for(var a=0;a<r.children.length;a++){var s=r.children[a];if(s.userData&&s.userData.treeNode&&s.userData.treeNode.sid){i.remove(s.userData.treeNode.sid,t)}}}});return this};function y(e){return new Float32Array([Math.max(e[3]-e[0],Number.EPSILON),0,0,Math.max(e[4]-e[1],Number.EPSILON),(e[3]+e[0])*.5,(e[4]+e[1])*.5])}v.prototype._addGeometryToNode=function(e,t,i){var r=i.materialId;var a=this._getMaterial(r);var s=t.data;var o=s.indices;var h=s.points;var d=new Float32Array([1,0,0,1,0,0]);if(t.isPositionQuantized&&i.boundingBox&&i.boundingBox.length===6){d=y(i.boundingBox)}if(i.transform){}var l,u,p,c;var m=o.length;var _=[];if(t.isPolyline){for(l=0,u=-1;l<m;l+=2,u=c){p=o[l]*3;c=o[l+1]*3;if(p!==u){_.push({type:"move",points:[h[p],h[p+this._yIndex]]});_.push({type:"line",points:[h[c],h[c+this._yIndex]]})}else{_[_.length-1].points.push(h[c],h[c+this._yIndex])}}}else{a=Object.assign(Object.assign({},a),{lineColor:[0,0,0,0],lineWidth:0});for(l=0;l<m;l+=3){u=o[l]*3;p=o[l+1]*3;c=o[l+2]*3;_.push({type:"move",points:[h[u],h[u+this._yIndex]]});_.push({type:"line",points:[h[p],h[p+this._yIndex],h[c],h[c+this._yIndex]]});_.push({type:"close"})}}var v=new n({segments:_,isTriangleMesh:!t.isPolyline,matrix:d,material:a,materialID:r,fillStyle:t.isPolyline?null:{colour:a.color},subelement:true});v.uid+="-g";e.add(v);f.pushElementIntoMapArray(this._materialNodesMap,r,v)};v.prototype.setGeometry=function(e){this._geometries.set(e.id,e);var t=this._geometryMeshes.get(e.id);if(t){for(var i=0;i<t.length;i++){var r=t[i];var a=this._meshNodes.get(r.meshId);if(a){for(var s=0;s<a.length;s++){this._addGeometryToNode(a[s],e,r)}}}}if(this._fireSceneUpdated){this._fireSceneUpdated()}return this};v.prototype._setMeshNode=function(e,t){f.pushElementIntoMapArray(this._meshNodes,t,e);var i=this._meshSubmeshes.get(t);if(i){for(var r=0;r<i.length;r++){var a=i[r];var s=g(a.lods);if(s){var n=this._geometries.get(s.id);if(n){this._addGeometryToNode(e,n,a)}}}}};var I=[0,0];var w=[0,0,0,1];var M=[1,1];function N(e){return t._compose(e.t||I,e.r||w,e.s||M)}v.prototype.setParametricContent=function(t,i,r){if(i==null){e.warning("Empty parametric content for node "+t);return}this._resetCurrentScene(r);var a=this._nodes.get(t);a.uid+="-p";var s=i.shapes;if(s){for(var n=0;n<s.length;n++){this._createObject(s[n],a)}}else{this._createObject(i,a)}};function S(e,t,i,r,a){return[e+i*Math.cos(a),t+r*Math.sin(a)]}v.prototype._createObject=function(t,h){t.matrix=N(t);t.subelement=true;if(t.materialID){t.material=this._getMaterial(t.materialID)}if(this._lineStyles&&t.stroke_id!==undefined){t.lineStyle=this._lineStyles.get(t.stroke_id)}if(this._fillStyles&&t.fill_id!==undefined){t.fillStyle=this._fillStyles.get(t.fill_id);if(t.fillStyle.gradient){var l=new d(t.fillStyle);t.fillStyle.fillURL="url(#"+l.uid+")";h.add(l)}}if(this._textStyles&&t.style_id!==undefined){t.style=this._textStyles.get(t.style_id);t.textStyles=this._textStyles}var u;switch(t.type){case"arc":case"ellipticalArc":var p=t.cx||0;var c=t.cy||0;var m=t.major||t.radius;var _=t.minor||t.radius;var v=t.start>t.end?t.start-Math.PI*2:t.start;var g=t.end;t.segments=[{type:"move",points:S(p,c,m,_,v)},{type:"arc",major:m,minor:_,short:Math.abs(g-v)<Math.PI,clockwise:g>v,points:S(p,c,m,_,g)}];u=new n(t);break;case"rectangle":u=new r(t);break;case"line":u=new a(t);break;case"polyline":u=new s(t);break;case"ellipse":case"circle":u=new i(t);break;case"text":if(this._rootNode.matrix[3]<0){t.matrix[2]*=-1;t.matrix[3]*=-1}u=new o(t);break;case"path":u=new n(t);break;default:e.warning("Unsupported parametric type",t.type);u=null;break}if(u){u.userData.po=t;u.uid+="-s";if(t.materialID){f.pushElementIntoMapArray(this._materialNodesMap,t.materialID,u)}h.add(u)}};v.prototype.createImageNote=function(e,t){this._resetCurrentScene(t);if(e.type==="image"){var i=e.label.materialId;if(!i){return}var r=this._getMaterial(i);this._annotationsMap.set(e.id,e);var a=this._annotationNodesMap.get(e.id)||[];this._annotationNodesMap.delete(e.id);if(e.nodeId){a.push(e.nodeId)}for(var s=0;s<a.length;s++){var n=this._nodes.get(a[s]);if(n){var o=new h({materialID:i,material:r,subelement:true,matrix:[1,0,0,-1,0,0]});n.add(o);f.pushElementIntoMapArray(this._materialNodesMap,i,o)}}}};v.prototype.removeNode=function(e){this._nodes.delete(e.sid);e.children.forEach(this.removeNode,this)};v.prototype.createMaterial=function(e){var t=[];var i=e.id;var r=this._getMaterial(i);r.lineColor=e.lineColour;r.lineWidth=e.lineWidth||1;r.lineStyle={width:e.lineWidth||1,haloWidth:e.lineHaloWidth||0,endCapStyle:e.lineEndRound?1:0,dashPattern:e.lineDashPattern||[],dashPatternScale:e.lineDashPatternScale,widthCoordinateSpace:e.lineWidthCoordinateSpace};if(e.emissiveColour){r.color=e.emissiveColour}if(e.opacity!==undefined){r.opacity=e.opacity}if(e.textureEmissive&&e.textureEmissive.length&&e.textureEmissive[0].imageId){var a=e.textureEmissive[0].imageId;if(this._images.has(a)){r.texture=this._images.get(a)}else{var s={imageId:e.textureEmissive[0].imageId};t.push(s);f.pushElementIntoMapArray(this._imageTextures,a,{materialId:i});if(!r.userData){r.userData={}}r.userData.imageIdsToLoad=new Set;r.userData.imageIdsToLoad.add(s.imageId)}r.textureWidth=e.textureEmissive[0].width;r.textureHeight=e.textureEmissive[0].height;f.pushElementIntoMapArray(this._materialsByTextureImageId,a,{materialId:i})}var n=this._materialNodesMap.get(i);if(n){for(var o=0;o<n.length;o++){n[o].setMaterial(r,true)}}return t};v.prototype._getMaterial=function(e){return this._materialMap.get(e)||this._createTemporaryMaterial(e)};v.prototype._createTemporaryMaterial=function(e){var t={materialId:e,lineColor:[0,0,0,1],lineWidth:1};this._materialMap.set(e,t);return t};v.prototype.checkMaterialExists=function(e,t){if(!this._materialMap.get(e)){if(t){this._createTemporaryMaterial(e)}return false}return true};v.prototype.materialNeeded=function(e){return false};v.prototype.getAnnotation=function(e){return this._annotationsMap.get(e)};v.prototype.updateViewsForReplacedNodes=function(e){};v.prototype.insertFillStyle=function(e){this._fillStyles.set(e.veid,e)};v.prototype.insertLineStyle=function(e){this._lineStyles.set(e.veid,e)};v.prototype.insertTextStyle=function(e){this._textStyles.set(e.veid,e)};var b=function(e){var t="";try{var i=32768;var r=0;var a=e.length;var s;while(r<a){s=e.slice(r,Math.min(r+i,a));t+=String.fromCharCode.apply(null,s);r+=i}}catch(e){t=""}return t};v.prototype.createImage=function(t){if(t.binaryData.length<32){e.warning("SceneBuilder.createImage()","Can't create image from empty data");return this}var i=new DataView(t.binaryData.buffer);var r=true;if(i.getUint8(0,true)===parseInt("0xFF",16)&&i.getUint8(1,true)===parseInt("0xD8",16)){r=false}var a=b(t.binaryData);var s="data:image/"+(r?"png":"jpeg")+";base64,"+btoa(a);this._images.set(t.id,s);var n=this._imageTextures.get(t.id);if(n&&n.length){this._imageTextures.delete(t.id);n.forEach(function(e){var i=this._getMaterial(e.materialId);i.texture=s;if(i.userData&&i.userData.imageIdsToLoad&&i.userData.imageIdsToLoad.size){i.userData.imageIdsToLoad.delete(t.id)}var r=this._materialNodesMap.get(e.materialId);if(r){for(var a=0;a<r.length;a++){r[a].setMaterial(i,true)}}}.bind(this))}return this};v.prototype.setViewThumbnail=function(e,t,i,r){this._resetCurrentScene(i);var a=this._views.get(t);var s=this._images.get(e);if(a&&s){if(a.userData!==undefined){if(a.userData.viewInfo.thumbnailId===e){a.thumbnailData=s}}}return this};v.prototype._getSavedColor=function(e,t){if(e&&e.length>2){return _({red:Math.floor(e[0]*255),green:Math.floor(e[1]*255),blue:Math.floor(e[2]*255),alpha:e.length>3?e[3]:1})}else if(t){return t}return undefined};return v});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Text", ["./Element","./Path","sap/base/util/uid"],function(t,e,i){"use strict";var n=function(e){e=e||{};t.call(this,e);this.type="Text";this.text=e.text;this.content=e.content||(e.children?y(e.children,e.textStyles):[]);this.style=e.style||{};this.style.size=this.style.size||"1em";this.x=e.x||0;this.y=e.y||0;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}this.fillStyle=e.fillStyle||{colour:[0,0,0,1]};this.lineStyle=e.lineStyle||{colour:[0,0,0,0],width:1};if(this.style.fill){this.fillStyle.veid="t"+this.style.veid;this.fillStyle.colour=this.style.fill}if(this.style.stroke){this.lineStyle.veid="t"+this.style.veid;this.lineStyle.colour=this.style.stroke}this.setMaterial(e.material)};n.prototype=Object.assign(Object.create(t.prototype),{constructor:n});n.prototype.tagName=function(){return"text"};n.prototype.defaultFillAlpha=1;var s=document.createElement("canvas");var a=s.getContext("2d");n.prototype._expandBoundingBox=function(t,e){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(t,e,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}function n(t){var e="";for(var i=0,s=t.length;i<s;i++){var a=t[i];if(a.text){e+=a.text}if(a.content){e+=n(a.content)}}return e}var s=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;a.font=this.style.size+" "+(this.style.fontFace||"Arial");var r=a.measureText((this.text?this.text:"")+(this.content?n(this.content):""));var o=r.width*.5+s;var f=(r.actualBoundingBoxAscent||this.style.size)*.5+s;this._expandBoundingBoxCE(t,e,this.x+o,this.y-f,o,f)};function r(t,e,i){if(t.size){e("font-size",t.size)}if(t.fontFace){e("font-family",t.fontFace)}if(t.fontStyle){e("font-style",t.fontStyle)}if(t.fontWeight){e("font-weight",t.fontWeight)}if(t.textDecoration){e("text-decoration",t.textDecoration)}if(!i){if(t.fill){e("fill",t.fill)}if(t.stroke){e("stroke",t.stroke)}}}n.prototype._setSpecificAttributes=function(t){t("x",this.x);t("y",this.y);if(this.dx){t("dx",this.dx)}if(this.dy){t("dy",this.dy)}r(this.style,t,true)};function o(t,e){if(t.x!==undefined){e("x",t.x)}if(t.y!==undefined){e("y",t.y)}if(t.dx){e("dx",t.dx)}if(t.dy){e("dy",t.dy)}}function f(t,i){if(!t||t.length===0){return}var n=i.attr.bind(i);for(var s=0,a=t.length;s<a;s++){var d=t[s];switch(d.type){case 10:case undefined:case"text":i.text(d.text);break;case 11:case"span":i.openStart("tspan");o(d,n);if(d.style){r(d.style,n)}i.openEnd();if(d.text){i.text(d.text)}f(d.content,i);i.close("tspan");break;case 12:case"path":i.openStart("textPath");o(d,n);if(d.style){r(d.style,n)}if(!d.path&&d.pathSegments){d.path=new e({segments:d.pathSegments})}var h=d.path;if(h instanceof e){i.attr("href","#"+h.uid);i.openEnd();i.openStart(h.tagName());i.attr("id",h.uid);h._setSpecificAttributes(n);i.openEnd();i.close(h.tagName())}else{i.openEnd()}if(d.text){i.text(d.text)}f(d.content,i);i.close("textPath");break;default:break}}}n.prototype._renderContent=function(t){if(this.text){t.text(this.text)}f(this.content,t)};function d(i,n){if(!i||i.length===0){return}var s,a;for(var f=0,h=i.length;f<h;f++){var l=i[f];switch(l.type){case 10:case undefined:case"text":n.append(l.text);break;case 11:case"span":s=document.createElementNS(t._svgNamespace,"tspan");a=s.setAttribute.bind(s);o(l,a);if(l.style){r(l.style,a)}if(l.text){s.append(l.text)}d(l.content,s);n.append(s);break;case 12:case"path":s=document.createElementNS(t._svgNamespace,"textPath");a=s.setAttribute.bind(s);o(l,a);if(l.style){r(l.style,a)}if(!l.path&&l.pathSegments){l.path=new e({segments:l.pathSegments})}var c=l.path;if(c instanceof e){s.setAttribute("href","#"+c.uid);var p=document.createElementNS(t._svgNamespace,c.tagName());p.setAttribute("id",c.uid);c._setSpecificAttributes(p.setAttribute.bind(p));s.append(p)}if(l.text){s.append(l.text)}d(l.content,s);n.append(s);break;default:break}}}n.prototype._createContent=function(t){if(this.text){t.append(this.text)}d(this.content,t)};function h(t){switch(typeof t){case"number":return t;case"string":if(t.endsWith("pt")){return parseFloat(t)*4/3}else if(t.endsWith("em")){return parseFloat(t)*16}return parseFloat(t);default:return 0}}function l(t){var e=[];for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];if(n.data!==undefined){e.push({type:10,text:n.data})}else if(n.childNodes.length>0){var s={type:11,content:l(n)};var a=n.style;var r={};if(a.fontSize){r.size=a.fontSize}if(a.fontFamily){r.fontFace=a.fontFamily.replaceAll('"',"'")}if(a.textDecoration){r.textDecoration=a.textDecoration}if(a.color){r.fill=a.color}switch(n.tagName){case"EM":r.fontStyle="italic";break;case"STRONG":r.fontWeight="bold";break;default:break}if(Object.keys(r).length){s.style=r}e.push(s)}}return e}function c(t){var e=0;for(var i=0;i<t.length;i++){var n=t[i];var s=n.style&&n.style.size;if(s!==undefined){s=h(s);if(typeof s=="number"&&isFinite(s)){e=Math.max(e,s)}}if(n.content){e=Math.max(e,c(n.content))}}return e}n.prototype.setHtmlTextContent=function(t){var e=document.createElement("html");e.innerHTML=t;var i=[];var n=e.getElementsByTagName("body");var s=n.length>0?n[0].childNodes:[];for(var a=0,r=this.y;a<s.length;a++){var o=s[a];if(o.childNodes.length>0){var f=l(o);var d;if(o.nodeName==="P"){d=Math.max(c(f),h(this.style.size));r+=a>0?d:0}i.push({type:11,x:(o.style.paddingLeft||0)+this.x,y:r,content:l(o)});if(o.nodeName==="P"){r+=d*.25}}else if(o.data){i.push({type:10,text:o.data})}}delete this.text;this.content=i;this.invalidate()};function p(t,e){var i="";var n=[];for(var s=0;s<t.length;s++){var a=t[s];switch(a.type){case 10:case undefined:case"text":i+=a.text;break;case 11:case"span":case 12:case"path":var r=a.style;if(!e||a.y!==undefined||a.dy!==undefined){n.push("p");i+='<p style="text-align: left;';if(a.x){i+=" padding-left: "+(typeof a.x==="number"?a.x+"px":a.x)+";"}i+='">'}if(r){if(r.textDecoration||r.size||r.fontFace||r.fill){n.push("span");i+='<span style="';if(r.textDecoration){i+="text-decoration: "+r.textDecoration+";"}if(r.size){i+="font-size: "+h(r.size)*.75+"pt;"}if(r.fill){i+="color: "+r.fill+";"}if(r.fontFace){i+="font-family: "+r.fontFace+";"}i+='">'}if(r.fontStyle==="italic"){n.push("em");i+="<em>"}if(r.fontWeight==="bold"){n.push("strong");i+="<strong>"}}if(n.length===0){n.push("span");i+="<span>"}if(a.text){i+=a.text}i+=p(a.content,true);var o=n.pop();while(o!==undefined){i+="</"+o+">";o=n.pop()}break;default:break}}return i}n.prototype.getHtmlTextContent=function(){var t=p(this.content,false);return this.text?this.text+t:t};function y(t,e){var i=[];for(var n=0;n<t.length;n++){var s=t[n];switch(s.type){case undefined:case"text":i.push({type:10,text:s.text});break;default:case"span":case"path":var a={type:s.type==="path"?12:11};if(s.x!==undefined){a.x=s.x}if(s.y!==undefined){a.x=s.y}if(s.dx!==undefined){a.x=s.dx}if(s.dy!==undefined){a.x=s.dy}if(s.style_id){a.style=e.get(s.style_id)}if(s.text){a.text=s.text}if(s.children){a.content=y(s.children,e)}i.push(a);break}}return i}function x(t,e){var n=[];for(var s=0;s<t.length;s++){var a=t[s];switch(a.type){case 10:case undefined:n.push({text:a.text});break;case 11:case"span":case 12:case"path":var r={type:"span"};if(a.x!==undefined){r.x=a.x}if(a.y!==undefined){r.y=a.y}if(a.dx!==undefined){r.dx=a.dx}if(a.dy!==undefined){r.dy=a.dy}if(a.text){r.text=a.text}var o=a.style;if(o){o.veid=o.veid||i();r["style_id"]=o.veid;e.push(o)}if(a.content){r.children=x(a.content,e)}n.push(r);break;default:break}}return n}n.prototype._getParametricShape=function(e,n,s){var a=t.prototype._getParametricShape.call(this,e,n,s);a.type="text";if(a.s){a.s[1]*=-1}if(this.x){a.x=this.x}if(this.y){a.y=this.y}if(this.dx){a.dx=this.dx}if(this.dy){a.dy=this.dy}var r=this.style;if(r){r.veid=r.veid||i();a["style_id"]=r.veid;s.push(r)}if(this.text){a.text=this.text}a.children=x(this.content,s);return a};n.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);this.text=e.text;this.content=e.content;this.style=e.style;this.x=e.x;this.y=e.y;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}return this};return n});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/ViewStateManager", ["sap/base/Log","../Core","../ViewStateManagerBase","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../AnimationTrackType","../NodeContentType","./Scene","./Element","sap/ui/core/Core"],function(t,e,i,r,s,a,n,o,h,l,c,f){"use strict";var u;var d=i.extend("sap.ui.vk.svg.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var p=d.getMetadata().getParent().getClass().prototype;d.prototype.init=function(){if(p.init){p.init.call(this)}this._mask=1|0;this._nodeHierarchy=null;this._selectedNodes=new Set;this._visibilityTracker=new u;this.setHighlightColor(3204448443);e.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this)};d.prototype.exit=function(){e.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this)};d.prototype._setContent=function(t){if(t===this._scene){return this}var e=null;if(t&&t instanceof l){e=t}this._setScene(e);if(e){var i=e.getInitialView();if(i){this._currentView=i;this._resetNodesStatusByCurrentView(this._currentView)}}return this};d.prototype._setScene=function(t){this._setNodeHierarchy(t?t.getDefaultNodeHierarchy():null);if(t){t.setViewStateManager(this)}this._scene=t;return this};d.prototype._setNodeHierarchy=function(t){var e=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._selectedNodes.clear();this._visibilityTracker.clear()}if(t){this._nodeHierarchy=t;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var i=this;var r=t.findNodesByName();r.forEach(function(t){(t.isVisible(i._mask)?i._initialState.visible:i._initialState.hidden).push(t)});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden})}if(t!==e){this.fireNodeHierarchyReplaced({oldNodeHierarchy:e,newNodeHierarchy:t})}return this};d.prototype._handleNodeReplaced=function(t){var e=t.getParameter("ReplacedNodeRef");var i=t.getParameter("ReplacementNodeRef");if(this.getSelectionState(e)){this.setSelectionState(i,true);this.setSelectionState(e,false)}};d.prototype._handleNodeUpdated=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionState(e,false);this.setSelectionState(e,true)}};d.prototype._handleNodeRemoving=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionState(e,false,true,true)}};d.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};d.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};d.prototype.getCurrentView=function(){var t=f.byId(this.getViewManager());if(!t){return null}var e=t.getActiveView();return e};d.prototype.getVisibilityComplete=function(){var t=this.getNodeHierarchy(),e=t.findNodesByName(),i=[],r=[];e.forEach(function(e){var s=t.createNodeProxy(e);var a=s.getVeId();t.destroyNodeProxy(s);if(a){if(this.getVisibilityState(e)){i.push(a)}else{r.push(a)}}},this);return{visible:i,hidden:r}};d.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear()};d.prototype.getVisibilityState=function(t){var e=this._mask;if(Array.isArray(t)){return t.map(function(t){return t?t.isVisible(e):false})}return t?t.isVisible(e):false};d.prototype.setVisibilityState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}var s=Array.isArray(e);var a=[];var n=t;if(i){n=[];t.forEach(function(t,i){var r=this._collectNodesRecursively(t);n=n.concat(r);var o=a.length;a.length=o+r.length;a.fill(s?e[i]:e,o)},this)}else if(!s){a.length=n.length;a.fill(e)}else{a=e}var o=[];var h=new Set;var l=this._mask;var c=n.filter(function(t,e){if(h.has(t)){return false}h.add(t);var i=t?t.isVisible(l)!=a[e]:false;if(i){o.push(a[e])}return i},this);if(c.length>0){var f={visible:[],hidden:[]};c.forEach(function(t,e){if(o[e]){t.setVisible(l,true);f.visible.push(t);if(r){var i=t.parent;while(i){i.visible=true;i=i.parent}}}else{t.setVisible(l,false);f.hidden.push(t)}},this);if(this.getShouldTrackVisibilityChanges()){c.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged(f)}return this};d.prototype.enumerateSelection=function(t){this._selectedNodes.forEach(t);return this};d.prototype.getSelectionState=function(t){var e=this._selectedNodes;function i(t){return e.has(t)}return Array.isArray(t)?t.map(i):i(t)};d.prototype._getSelectionComplete=function(){var t=this.getNodeHierarchy(),e=[];function i(e){var i=t.createNodeProxy(e);var r=i.getVeId();t.destroyNodeProxy(i);return r}this._selectedNodes.forEach(function(t){var r=i(t);if(r){e.push(r)}});return{selected:e}};d.prototype._isAncestorSelected=function(t){t=t.parent;while(t){if(this._selectedNodes.has(t)){return true}t=t.parent}return false};d.prototype._updateHighlightColor=function(t,e){var i=e||this._selectedNodes.has(t);t.setSelected(this._mask,i,this._highlightColorABGR);if(t.nodeContentType!==h.Hotspot){var r=t.children;for(var s=0,a=r.length;s<a;s++){this._updateHighlightColor(r[s],i)}}};d.prototype.setSelectionState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}t=(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t).filter(function(t,e,i){return i.indexOf(t)===e});if(this.getRecursiveSelection()&&!e){t=this._nodeHierarchy._appendAncestors(t)}var s=t.filter(function(t){return this._selectedNodes.has(t)!==e},this);if(s.length>0){s.forEach(function(t){if(t){this._selectedNodes[e?"add":"delete"](t)}},this);s.forEach(function(t){if(t){this._updateHighlightColor(t,e||this._isAncestorSelected(t))}},this);if(!r){this.fireSelectionChanged({selected:e?s:[],unselected:e?[]:s})}}return this};d.prototype.setSelectionStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e;if(this.getRecursiveSelection()){e=this._nodeHierarchy._appendAncestors(e,t)}var s=t.filter(function(t){return t&&this._selectedNodes.has(t)===false},this);var a=e.filter(function(t){return t&&this._selectedNodes.has(t)===true},this);if(s.length>0||a.length>0){s.forEach(function(t){this._selectedNodes.add(t);this._updateHighlightColor(t,true)},this);a.forEach(function(t){this._selectedNodes.delete(t)},this);a.forEach(function(t){this._updateHighlightColor(t,this._isAncestorSelected(t))},this);if(!r){this.fireSelectionChanged({selected:s,unselected:a})}}return this};d.prototype._collectNodesRecursively=function(t){var e=[],i=this;if(!Array.isArray(t)){t=[t]}t.forEach(function t(r){e.push(r);i._nodeHierarchy.enumerateChildren(r,t,false,true)});return e};d.prototype._getOpacity=function(t){return t.opacity!==undefined?t.opacity:null};d.prototype.getOpacity=function(t){if(Array.isArray(t)){return t.map(this._getOpacity,this)}else{return this._getOpacity(t)}};d.prototype.setTotalOpacity=function(t,e){this.setOpacity(t,e);return{opacity:e,totalOpacity:e}};d.prototype.setOpacity=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);if(e===null){e=undefined}else if(r){e.forEach(function(t,i){if(t===null){e[i]=undefined}})}var s=[];var a=t;if(!r){s.length=a.length;s.fill(e)}else{s=e}var n=[];var o=new Set;var h=a.filter(function(t,e){if(o.has(t)){return false}o.add(t);var i=t?t.opacity!==s[e]:false;if(i){n.push(s[e])}return i},this);if(h.length>0){h.forEach(function(t,e){t.setOpacity(n[e])},this);this.fireOpacityChanged({changed:h,opacity:r?n:n[0]})}return this};d.prototype._getTintColorABGR=function(t){return t.tintColor!==undefined?t.tintColor:null};d.prototype._getTintColor=function(t){return t.tintColor!==undefined?s(a(t.tintColor)):null};d.prototype.getTintColor=function(t,e){var i=e?"_getTintColorABGR":"_getTintColor";if(Array.isArray(t)){return t.map(this[i],this)}else{return this[i](t)}};function y(t){switch(typeof t){case"number":return t>>>0;case"string":return sap.ui.core.CSSColor.isValid(t)?n(r(t)):undefined;default:return undefined}}d.prototype.setTintColor=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);var s=[];var a=t;if(i){a=[];t.forEach(function(t,i){var n=this._collectNodesRecursively(t);a=a.concat(n);var o=s.length;s.length=o+n.length;s.fill(r?e[i]:e,o)},this)}else if(!r){s.length=a.length;s.fill(e)}else{s=e}var n=[];var o=new Set;var h=a.filter(function(t,e){if(o.has(t)){return false}o.add(t);var i=t?t.tintColor!==y(s[e]):false;if(i){n.push(s[e])}return i},this);if(h.length>0){var l=this._mask;var c=[];h.forEach(function(t,e){var i=y(n[e]);t.setTintColor(l,i);c.push(i)},this);var f={changed:h,tintColor:r?n:n[0],tintColorABGR:r?c:c[0]};this.fireTintColorChanged(f)}return this};d.prototype.setHighlightColor=function(t){t=y(t);if(t===undefined){return this}this._highlightColorABGR=t;if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(t){this._updateHighlightColor(t,true)},this)}this.fireHighlightColorChanged({highlightColor:s(a(t)),highlightColorABGR:t});return this};d.prototype.getHighlightColor=function(t){return t?this._highlightColorABGR:s(a(this._highlightColorABGR))};d.prototype.getTransformationWorld=function(t){function e(t){return c._decompose(t._matrixWorld())}if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};d.prototype.getTransformation=function(t){function e(t){var e=c._decompose(t.matrix);return{translation:e.position,quaternion:e.quaternion,scale:e.scale}}if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};function g(t){return new Float32Array([t[0],t[4],t[1],t[5],t[3],t[7]])}d.prototype.setTransformation=function(e,i){var r=Array.isArray(e);if(!Array.isArray(e)){e=[e]}var s={changed:[],transformation:[]};var a=function(t){return c._decompose(t.matrix)};if(!i){e.forEach(function(t){if(t.userData.matrix){t.setMatrix(t.userData.matrix);delete t.userData.matrix}s.changed.push(t);s.transformation.push(a(t))},this)}else{if(!Array.isArray(i)){i=[i]}e.forEach(function(e,r){if(!e.userData.matrix){e.userData.matrix=e.matrix.slice()}var n=i[r];if(n.transform){e.setMatrix(g(n.transform))}else{var o;if(n.quaternion){o=n.quaternion}else if(n.angleAxis){var h=n.angleAxis;var l=h[3]/2,f=Math.sin(l);o=[h[0]*f,h[1]*f,h[2]*f,Math.cos(l)]}else if(n.euler){t.warning("svg.ViewStateManager.setTransformation: Euler angles are not yet supported");o=[0,0,0,1]}var u=c._compose(n.translation,o,n.scale);e.setMatrix(u)}s.changed.push(e);s.transformation.push(a(e))},this)}if(!r){s.changed=s.changed[0];s.transformation=s.transformation[0]}this.fireTransformationChanged(s);return this};d.prototype._resetNodesStatusByCurrentView=function(t){var e=this.getNodeHierarchy();var i=t.getNodeInfos();if(!e||!i){return}var r=[];var s=[];i.forEach(function(t){if(t.target){if(t.transform){r.push(t.target);s.push({transform:t.transform})}else if(t[o.Translate]&&t[o.Rotate]&&t[o.Scale]){r.push(t.target);s.push({translation:t[o.Translate].slice(),quaternion:t[o.Rotate].slice(),scale:t[o.Scale].slice()})}}});if(t.userData&&t.userData.nodeStartDataByAnimation){t.userData.nodeStartDataByAnimation.forEach(function(t,e){if(t[o.Translate]&&t[o.Rotate]&&t[o.Scale]){r.push(e);s.push({translation:t[o.Translate].slice(),quaternion:t[o.Rotate].slice(),scale:t[o.Scale].slice()})}})}if(r.length){this.setTransformation(r,s)}var a=[];var n=[];i.forEach(function(t){if(!t.target.userData.skipIt){(t.visible?a:n).push(t.target)}});this.setVisibilityState(e.getChildren()[0].children,false,true);this.setVisibilityState(a,true,false);this.setVisibilityState(n,false,false)};d.prototype._onActivateView=function(t,e,i){var r=this.getViewManager();if(r&&i.source.getId()===r){this.activateView(i.view)}};d.prototype.activateView=function(t){this.fireViewStateApplying({view:t});this._resetNodesStatusByCurrentView(t);this.fireViewStateApplied({view:t});e.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:t});return this};d.prototype.setJoints=function(t,e){return this};d.prototype._propagateOpacityToJointChildren=function(t,e){return this};d.prototype._setJointNodeMatrix=function(){return this};u=function(){this._visibilityChanges=new Set};u.prototype.getInfo=function(t){var e=[];this._visibilityChanges.forEach(function(i){var r=t.createNodeProxy(i);var s=r.getVeId();t.destroyNodeProxy(r);if(s){e.push(s)}else{e.push(t.getScene().nodeRefToPersistentId(i))}});return e};u.prototype.clear=function(){this._visibilityChanges.clear()};u.prototype.trackNodeRef=function(t){if(this._visibilityChanges.has(t)){this._visibilityChanges.delete(t)}else{this._visibilityChanges.add(t)}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Viewport", ["../Core","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../ViewStateManager","./ViewStateManager","../ViewportHandler","../VisibilityMode","../ZoomTo","../SelectionMode","../NodeContentType","../getResourceBundle","../Messages","./Scene","./OrthographicCamera","../measurements/Surface","./Rectangle","./HotspotHelper","../colorToCSSColor","../cssColorToColor","../colorToABGR","../abgrToColor","sap/base/Log","sap/ui/core/Core"],function(e,t,i,s,a,r,o,n,h,l,c,f,u,d,m,g,p,_,v,y,w,C,S,b,V){"use strict";var x=t.extend("sap.ui.vk.svg.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{offset:"float[]",zoom:"float"},enableEventBubbling:true},hotspotEnter:{parameters:{nodeRef:"any"},enableEventBubbling:true},hotspotLeave:{parameters:{nodeRef:"any"},enableEventBubbling:true}}}});var R=x.getMetadata().getParent().getClass().prototype;x.prototype.init=function(){if(R.init){R.init.call(this)}this._measurementSurface=new p;this._resizeListenerId=null;this._animLoopRequestId=0;this._animLoopFunction=this._animLoop.bind(this);this._width=this._height=0;this._camera=new g;this._gestureX=0;this._gestureY=0;this._scene=null;this._selectionRect=new _({material:{lineColor:[.75,.75,0,1],lineStyle:{dashPattern:[2,2]}}});this._styles=new Map;this.raster={rasterImage:new Image,vectorImage:new Image,bmpCanvas:null,rasterMode:false,useRasterMode:false,delayEnd:false,timer:null,nodesThreshold:1e4};this.raster.vectorImage.onload=function(){var e=this.raster.bmpCanvas.getContext("2d");e.clearRect(0,0,this.raster.bmpCanvas.width,this.raster.bmpCanvas.height);e.drawImage(this.raster.vectorImage,0,0);this.raster.rasterImage.width=this.raster.bmpCanvas.width;this.raster.rasterImage.height=this.raster.bmpCanvas.height;this.raster.rasterImage.src=this.raster.bmpCanvas.toDataURL()}.bind(this);this._viewportHandler=new n(this);this._loco=new a(this);this._loco.addHandler(this._viewportHandler,-1);this._hotspotHelper=new v;this._currentViewIndex=0;this._currentView=null;e.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);V.attachLocalizationChanged(this._onLocalizationChanged,this)};x.prototype.exit=function(){V.detachLocalizationChanged(this._onLocalizationChanged,this);e.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._measurementSurface.destroy();this._measurementSurface=null;this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}this.setScene(null);this._renderer=null;this._loco=null;this._viewportHandler=null;if(R.exit){R.exit.call(this)}this.raster.rasterMode=false;this.raster.useRasterMode=false};x.prototype._onLocalizationChanged=function(e){var t=this._measurementSurface;if(t&&t.getMeasurements().length>0){t.update(this,this.getCamera())}};x.prototype.onBeforeRendering=function(){if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}};x.prototype.onAfterRendering=function(){this._resizeListenerId=i.register(this,this._handleResize.bind(this));var e=this.getDomRef();e.append(this._measurementSurface.getDomRef());if(this._scene){var t=this._scene.getRootElement();t._setDomRef(document.getElementById(t.uid));this._svgElement=t.domRef.parentNode}this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}})};x.prototype._handleResize=function(e){var t=this._width;var i=this._height;this._width=e.size.width;this._height=e.size.height;this._camera.update(this._width,this._height,false);if((t===0||i===0)&&!this._camera._initialPosition){this.zoomTo(l.All,null,0,0)}else{this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()})}var s=this._measurementSurface.getDomRef();s.style.width=this._width+"px";s.style.height=this._height+"px";this.fireResize({size:{width:this._width,height:this._height}});if(this._svgElement!=null){this.raster.bmpCanvas=this._svgElement.previousSibling;this._updateRasterImage()}return true};x.prototype.setScene=function(e){if(this._scene){this._scene.getDefaultNodeHierarchy().detachNodeCreated(this._nodeCreatedHandler,this)}this._scene=e;this._currentViewIndex=0;this._currentView=null;this._styles.clear();if(e){var t=this._scene.getDefaultNodeHierarchy();this.raster.useRasterMode=t.findNodesByName().length>this.raster.nodesThreshold;t.attachNodeCreated(this._nodeCreatedHandler,this);var i=e.getInitialView();if(i){this.activateView(i)}this._onContentLoadingFinished()}return this};x.prototype.setCamera=function(e){if(!(e instanceof g)){return this}if(R.setCamera){R.setCamera.call(this,e)}if(e){e.update(this._width,this._height,true);this._updateViewBox()}return this};x.prototype._nodeCreatedHandler=function(e){var t=e.getParameter("nodeRef");if(t._vkGetNodeContentType()===f.Annotation&&t.children&&t.children.length&&t.children[0].type==="Image"){this.invalidate()}};x.prototype.getScene=function(){return this._scene};x.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.attachSelectionChanged(this._onOutliningOrSelectionChanged,this)};x.prototype.onUnsetViewStateManager=function(e){e.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);this._viewStateManager=null};x.prototype._getViewStateManagerSVG=function(){if(this._viewStateManager){if(this._viewStateManager instanceof o){return this._viewStateManager}if(this._viewStateManager instanceof r&&this._viewStateManager._implementation instanceof o){return this._viewStateManager._implementation}}return null};x.prototype.hitTest=function(e,t,i,s){var a=this._getViewStateManagerSVG();if(!a||!this._scene){return null}var r=this._scene.getRootElement();var o=this.getDomRef().getBoundingClientRect();var n=function(e,t){var i=document.elementFromPoint(e+o.x,t+o.y);return i!==null&&i.id?r.getElementById(i.id):null};var h=n(e,t);if(i){var l=3;var c=3;for(var f=t-c;f<t+c&&!h;f++){for(var u=e-l;u<e+l&&!h;u++){h=n(u,f)}}}if(s){return h}return h?h._getSceneTreeElement():null};x.prototype.tap=function(e,t,i){var s=this.hitTest(e,t,true);if(!i){this.tapObject(s);if(s!==null){this.fireNodeClicked({nodeRef:s,x:e,y:t},true,true)}}else if(!this.getFreezeCamera()){if(s&&this._camera.zoomedObject!==s){this._camera.zoomedObject=s;this.zoomTo(l.Node,this._camera.zoomedObject,.5,.1)}else{this._camera.zoomedObject=null;this.zoomTo(l.Visible,null,.5,0)}}return this};x.prototype.tapObject=function(e){var t={picked:e?[e]:[]};this.fireNodesPicked(t);if(this.getSelectionMode()===c.Exclusive){this.exclusiveSelectionHandler(t.picked)}else if(this.getSelectionMode()===c.Sticky){this.stickySelectionHandler(t.picked)}return this};var M={x:-2,y:-2};var E=2;var B=5;x.prototype.onkeydown=function(e){if(!e.isMarked()){switch(e.keyCode){case s.ARROW_LEFT:case s.ARROW_RIGHT:case s.ARROW_UP:case s.ARROW_DOWN:if(e.ctrlKey||e.altKey||e.metaKey){break}var t={x:0,y:0};switch(e.keyCode){case s.ARROW_LEFT:t.x=-1;break;case s.ARROW_RIGHT:t.x=+1;break;case s.ARROW_UP:t.y=-1;break;case s.ARROW_DOWN:t.y=+1;break;default:break}this.beginGesture(M.x,M.y);if(e.shiftKey){this.pan(B*t.x,B*t.y)}else{this.rotate(E*t.x,E*t.y,true)}this.endGesture();e.preventDefault();e.stopPropagation();break;case 189:case s.PLUS:case s.NUMPAD_MINUS:case s.NUMPAD_PLUS:this.beginGesture(this._width*.5,this._height*.5);this.zoom(e.keyCode===s.PLUS||e.keyCode===s.NUMPAD_PLUS?1.02:.98);this.endGesture();e.preventDefault();e.stopPropagation();break;case s.D:if(e.ctrlKey){this._dumpSceneData()}break;default:break}}};x.prototype._onOutliningOrSelectionChanged=function(e){var t=this.getTools();for(var i=0;i<t.length;i++){var s=V.byId(t[i]);var a=s.getGizmoForContainer(this);if(a&&a.handleSelectionChanged){a.handleSelectionChanged(e)}}};x.prototype.setSelectionRect=function(e){var t=document.getElementById(this._selectionRect.uid);if(t){if(e){t.removeAttribute("display");e=this._camera._transformRect(e);t.setAttribute("x",e.x1,e.x2);t.setAttribute("y",e.y1,e.y2);t.setAttribute("width",e.x2-e.x1);t.setAttribute("height",e.y2-e.y1)}else{t.setAttribute("display","none")}}};x.prototype._select=function(e){var t=this._getViewStateManagerSVG();if(t&&this._scene){e=this._camera._transformRect(e);var i=new Set;this._scene.getRootElement()._findRectElementsRecursive(i,e,t._mask);return Array.from(i)}return[]};x.prototype.getImage=function(e,t,i,s,a){return null};x.prototype._setContent=function(e){R._setContent.apply(this,arguments);this.setScene(e instanceof m?e:null);if(this.getScene()){this.setCamera(new g);var t=this.getScene().getInitialView();if(t&&this._getViewStateManagerSVG()){this.activateView(t,false,true)}}if(this._measurementSurface!=null){this._measurementSurface.setScale(1)}return this};x.prototype.onSetContentConnector=function(e){t.prototype.onSetContentConnector.call(this,e);e.attachContentLoadingFinished(this._onContentLoadingFinished,this)};x.prototype.onUnsetContentConnector=function(e){e.detachContentLoadingFinished(this._onContentLoadingFinished,this);t.prototype.onUnsetContentConnector.call(this,e)};x.prototype._onContentLoadingFinished=function(e){if(this._scene){var t=this._scene.getDefaultNodeHierarchy();if(t){var i=this._getViewStateManagerSVG();var s=i&&i._mask||1;var a=this.getShowAllHotspots()?this.getShowAllHotspotsTintColor():null;var r=t.getHotspotNodeIds();r.forEach(function(e){this._hotspotHelper.updateHotspot(e,undefined);if(a!=null){e.setHotspotColor(s,a)}if(this.getDisableHotspotHovering()){e.addClass("sapUiVizKitNonInteractiveHotspot")}},this)}if(!this._camera._initialZoom||this._camera._initialZoom===-1){this.zoomTo(l.All,null,0,0)}this.invalidate()}};function I(e,t,i){return e+(t-e)*i}function H(e,t,i){i=Math.min(Math.max((i-e)/(t-e),0),1);return i*i*i*(i*(i*6-15)+10)}x.prototype._animLoop=function(){this._animLoopRequestId=0;var e=this._anim;if(e){var t=e.start;var i=e.end;var s=Date.now();var a=Math.min(H(0,1,(s-t.time)/e.duration),1);var r=this._camera.offsetX;var o=this._camera.offsetY;var n=this._camera.zoom;this._camera.offsetX=I(t.offsetX,i.offsetX,a);this._camera.offsetY=I(t.offsetY,i.offsetY,a);this._camera.zoom=I(t.zoom,i.zoom,a);if(this._redlineHandler){this._redlineHandler.pan(this._camera.offsetX-r,this._camera.offsetY-o);this._redlineHandler.zoom(this._camera.zoom/n,this._camera.offsetX,this._camera.offsetY)}this.fireCameraChanged({viewBox:this._getViewBox()});if(this._updateViewBox()&&s-t.time<e.duration){this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction)}else{delete this._anim;this._endRasterMode()}}};x.prototype.getCurrentView=function(){return this._currentView};x.prototype._onViewStateApplied=function(e,t,i){if(i.source===this._getViewStateManagerSVG()){this.activateView(i.view)}};x.prototype.activateView=function(t){if(!this._scene){return this}var i=this._scene.getViewGroups();var s=this;if(i){i.forEach(function(e){e.getViews().forEach(function(i){if(i===t){s._currentViewIndex=e.getViews().indexOf(i)}})})}this.fireViewActivated({viewIndex:this._currentViewIndex,view:t});e.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:t,viewIndex:this._currentViewIndex});this._currentView=t;var a=t.getCamera();if(a){this.setCamera(a)}var r=t.getTopColor();if(r!=null){if(Array.isArray(r)&&r.length>2){this.setBackgroundColorTop(y({red:Math.floor(r[0]*255),green:Math.floor(r[1]*255),blue:Math.floor(r[2]*255),alpha:r.length>3?r[3]:1}))}else{this.setBackgroundColorTop(r)}}var o=t.getBottomColor();if(o!=null){if(Array.isArray(o)&&o.length>2){this.setBackgroundColorBottom(y({red:Math.floor(o[0]*255),green:Math.floor(o[1]*255),blue:Math.floor(o[2]*255),alpha:o.length>3?o[3]:1}))}else{this.setBackgroundColorBottom(o)}}e.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:this._getViewStateManagerSVG(),view:t,ignoreAnimationPosition:false});this.rerender();this.fireViewFinished({viewIndex:this._currentViewIndex});return this};x.prototype.resetCurrentView=function(){if(this._currentView){this._getViewStateManagerSVG()._resetNodesStatusByCurrentView(this._currentView);this.rerender()}return this};x.prototype.zoomTo=function(e,t,i,s){if(this._width===0||this._height===0||this._scene==null){return this}var a={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};var r=this._getViewStateManagerSVG();(Array.isArray(e)?e:[e]).forEach(function(e){switch(e){case l.All:this._scene.getRootElement()._expandBoundingBoxRecursive(a,-1>>>0);break;case l.Visible:if(r){this._scene.getRootElement()._expandBoundingBoxRecursive(a,r._mask)}break;case l.Selected:if(r){r.enumerateSelection(function(e){e._expandBoundingBoxRecursive(a,-1>>>0)})}break;case l.Node:if(!t){return this}if(Array.isArray(t)){t.forEach(function(e){e._expandBoundingBoxRecursive(a,-1>>>0)})}else{t._expandBoundingBoxRecursive(a,-1>>>0)}break;case l.Restore:b.error(u().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case l.NodeSetIsolation:b.error(u().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case l.RestoreRemoveIsolation:b.error(u().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case l.ViewLeft:case l.ViewRight:case l.ViewTop:case l.ViewBottom:case l.ViewBack:case l.ViewFront:return this;default:break}}.bind(this));if(a.min.x>=a.max.x||a.min.y>=a.max.y){a={min:{x:0,y:0},max:{x:1,y:1}}}var o=new g;o._zoomTo(a,this._width,this._height,s);this._activateCamera(o,i);return this};x.prototype._activateCamera=function(e,t){if(t>0&&!this._animLoopRequestId){this._anim={start:{time:Date.now(),offsetX:this._camera.offsetX,offsetY:this._camera.offsetY,zoom:this._camera.zoom},end:{offsetX:e.offsetX,offsetY:e.offsetY,zoom:e.zoom},duration:t*1e3};this._startRasterMode();this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction)}else{if(this._redlineHandler){this._redlineHandler.pan(e.offsetX-this._camera.offsetX,e.offsetY-this._camera.offsetY);this._redlineHandler.zoom(e.zoom/this._camera.zoom,e.offsetX,e.offsetY)}this._camera.zoom=e.zoom;this._camera.offsetX=e.offsetX;this._camera.offsetY=e.offsetY;this._updateViewBox();this._updateRasterImage();this.fireCameraChanged({viewBox:this._getViewBox()})}};x.prototype.beginGesture=function(e,t){this._gestureX=(e-this._camera.offsetX)/this._camera.zoom;this._gestureY=(t-this._camera.offsetY)/this._camera.zoom};x.prototype.endGesture=function(){this._gestureX=0;this._gestureY=0;this._endRasterMode()};x.prototype._updateRasterImage=function(){if(this._svgElement==null||!this.raster.useRasterMode||!this.raster.bmpCanvas){return}this.raster.bmpCanvas.width=this._width*devicePixelRatio;this.raster.bmpCanvas.height=this._height*devicePixelRatio;this.raster.bmpCanvas.style.width=this._width+"px";this.raster.bmpCanvas.style.height=this._height+"px";this.raster.bmpCanvas.viewBox=this._getViewBox();if(sap.ui.Device.browser.firefox){this._svgElement.setAttribute("width",this.raster.bmpCanvas.width+"px");this._svgElement.setAttribute("height",this.raster.bmpCanvas.height+"px")}var e=(new XMLSerializer).serializeToString(this._svgElement);var t="data:image/svg+xml; charset=utf8, "+encodeURIComponent(e);if(sap.ui.Device.browser.firefox){this._svgElement.setAttribute("width","100%");this._svgElement.setAttribute("height","100%")}this.raster.vectorImage.width=this.raster.bmpCanvas.width;this.raster.vectorImage.height=this.raster.bmpCanvas.height;this.raster.vectorImage.src=t};x.prototype._startRasterMode=function(e){if(this.raster.timer){clearTimeout(this.raster.timer);this.raster.timer=null}if(this.raster.rasterMode||!this.raster.useRasterMode||this._svgElement==null){return}this.raster.rasterMode=true;this.raster.delayEnd=e;this._svgElement.style.display="none";this.raster.bmpCanvas.style.display="block"};x.prototype._endRasterMode=function(){if(!this.raster.rasterMode){return}var e=function(){this.raster.bmpCanvas.style.display="none";this._svgElement.style.display="";this.raster.rasterMode=false;this._updateRasterImage()}.bind(this);if(this.raster.delayEnd){this.raster.timer=setTimeout(function(){this.raster.timer=null;e()}.bind(this),1e3)}else{e()}};x.prototype.pan=function(e,t){if(!this.getFreezeCamera()){this._startRasterMode();this._camera.offsetX+=e;this._camera.offsetY+=t;this._updateViewBox();if(this._redlineHandler){this._redlineHandler.pan(e,t)}this.fireCameraChanged({viewBox:this._getViewBox()})}};x.prototype.rotate=function(e,t){this.pan(e,t)};x.prototype.zoom=function(e){if(!this.getFreezeCamera()){this._startRasterMode(true);var t=this._camera.zoom;this._camera.zoom=Math.max(this._camera.zoom*e,g._MIN_ZOOM);this._camera.offsetX+=this._gestureX*(t-this._camera.zoom);this._camera.offsetY+=this._gestureY*(t-this._camera.zoom);if(this._redlineHandler){this._redlineHandler.zoom(this._camera.zoom/t)}this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()})}};x.prototype.hover=function(e,t){var i=this._getViewStateManagerSVG();if(!i){return}var s=this.getDisableHotspotHovering()?null:this.hitTest(e,t);if(this._hotspotElement&&this._hotspotElement!==s){this.fireHotspotLeave({nodeRef:this._hotspotElement});if(!this.getShowAllHotspots()){this._hotspotElement.setHotspotColor(i._mask,null)}this._hotspotElement=null}if(s&&s._vkGetNodeContentType()===f.Hotspot){this._hotspotElement=s;if(!this.getShowAllHotspots()){s.setHotspotColor(i._mask,this.getHotspotColorABGR())}this.fireHotspotEnter({nodeRef:s})}};x.prototype._getViewBox=function(){return this._camera._getViewBox()};x.prototype._bmpDraw=function(){var e=this._getViewBox();var t=this.raster.bmpCanvas.getContext("2d");t.clearRect(0,0,this.raster.bmpCanvas.width,this.raster.bmpCanvas.height);if(this.raster.bmpCanvas.viewBox){var i=this._camera._worldToScreen(this.raster.bmpCanvas.viewBox[0],this.raster.bmpCanvas.viewBox[1]);var s=this._camera._worldToScreen(e[0],e[1]);t.translate((i.x-s.x)*devicePixelRatio,(i.y-s.y)*devicePixelRatio);var a=this.raster.bmpCanvas.viewBox[3]/e[3];t.scale(a,a)}t.drawImage(this.raster.rasterImage,0,0);this.raster.bmpCanvas.viewBox=e};x.prototype._updateViewBox=function(){if(this._svgElement==null){return false}if(this.raster.rasterMode){window.requestAnimationFrame(this._bmpDraw.bind(this))}if(this._measurementSurface!=null){this._measurementSurface.update(this,this.getCamera())}this._svgElement.setAttribute("viewBox",this._getViewBox().join(" "));return true};x.prototype.getViewInfo=function(e){var t={};if(e==null){e={}}if(e.camera==null){e.camera=true}if(e.camera){t.camera={viewBox:this._getViewBox()}}if(e.visibility&&this._viewStateManager){var i=e.visibility.mode==null?h.Complete:e.visibility.mode;t.visibility={mode:i};if(i===h.Complete){var s=this._viewStateManager.getVisibilityComplete();t.visibility.visible=s.visible;t.visibility.hidden=s.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){t.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{b.warning(u().getText(d.VIT32.summary),d.VIT32.code,"sap.ui.vk.threejs.Viewport")}}var a=this._getViewStateManagerSVG();if(e.selection&&a){t.selection=a._getSelectionComplete()}return t};x.prototype.setViewInfo=function(e,t){var i=e.camera;if(i&&i.viewBox){var s=new g;s._setViewBox(i.viewBox,this._width,this._height);this._activateCamera(s,t)}var a=new Map;if(e.visibility||e.selection){var r=this._viewStateManager.getNodeHierarchy(),o=r.findNodesByName();o.forEach(function(e){var t=r.createNodeProxy(e);var i=t.getVeId();r.destroyNodeProxy(t);if(i){a.set(i,e)}})}if(e.visibility){switch(e.visibility.mode){case h.Complete:var n=e.visibility.visible,l=e.visibility.hidden;n.forEach(function(e){this._viewStateManager.setVisibilityState(a.get(e),true,false)},this);l.forEach(function(e){this._viewStateManager.setVisibilityState(a.get(e),false,false)},this);break;case h.Differences:this._viewStateManager.resetVisibility();e.visibility.changes.forEach(function(e){var t=a.get(e);if(t){this._viewStateManager.setVisibilityState(t,!this._viewStateManager.getVisibilityState(t),false)}},this);break;default:b.error(u().getText(d.VIT28.summary),d.VIT28.code,"sap.ui.vk.threejs.Viewport");break}}var c=this._getViewStateManagerSVG();var f=e.selection;if(f&&c){var m=c._getSelectionComplete();if(Array.isArray(f.selected)){var p=[];var _=[];f.selected.forEach(function(e){var t=a.get(e);if(t){p.push(t)}});m.selected.forEach(function(e){var t=a.get(e);if(t&&f.selected.indexOf(e)<0){_.push(t)}});c.setSelectionStates(p,_,false,false)}}return this};x.prototype.queueCommand=function(e){if(this instanceof x){e()}return this};x.prototype.getOutputSize=function(){var e=this.getDomRef().getBoundingClientRect();var t=e.width;var i=e.height;var s;s=Math.min(t,i);return{left:(t-s)*.5,top:(i-s)*.5,sideLength:s}};x.prototype.setShouldRenderFrame=function(){this.invalidate()};x.prototype._isPanoramicActivated=function(){return false};x.prototype.setShowAllHotspots=function(e){this.setProperty("showAllHotspots",e,true);var t=this._getViewStateManagerSVG();if(t){var i=t._mask;var s=t.getNodeHierarchy().getHotspotNodeIds();var a=this._hotspotElement;var r=this.getShowAllHotspotsTintColor();s.forEach(function(t){if(e){t.setHotspotColor(i,r)}else if(t===a){t.setHotspotColor(i,this.getHotspotColorABGR())}else{t.setHotspotColor(i,null)}},this);if(s.length>0){this.invalidate()}}};x.prototype.setDisableHotspotHovering=function(e){this.setProperty("disableHotspotHovering",e,true);if(e){this.hover(0,0)}var t=this._getViewStateManagerSVG();if(t){var i=t.getNodeHierarchy().getHotspotNodeIds();i.forEach(function(t){if(e){t.addClass("sapUiVizKitNonInteractiveHotspot")}else{t.removeClass("sapUiVizKitNonInteractiveHotspot")}})}};x.prototype.setHotspotColorABGR=function(e){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",y(S(e)),true);this.invalidate();return this};x.prototype.setHotspotColor=function(e){this.setProperty("hotspotColor",e,true);this.setProperty("hotspotColorABGR",C(w(e)),true);this.invalidate();return this};x.prototype.showHotspots=function(e,t,i){if(e==null){return this}if(!Array.isArray(e)){e=[e]}var s=t?i||this.getHotspotColorABGR():null;var a=this._getViewStateManagerSVG()._mask;e.forEach(function(e){e.setCustomHotspotColor(a,s)});this.invalidate();return this};x.prototype._getFillStyleId=function(e){if(e.highlightColor||e.tintColor){return null}var t;if(e.fillStyle&&e.fillStyle.veid!==undefined){t="f"+e.fillStyle.veid}else if(e.fill!==undefined&&e.fill[3]===0){t="fn"}else{return null}if(!this._styles.has(t)){var i=[];e._setFillStyleAttributes(function(e,t){i.push(e,t)});this._styles.set(t,i)}return t};x.prototype._getLineStyleId=function(e){if(e.highlightColor||e.tintColor){return null}var t;if(e.lineStyle&&e.lineStyle.veid!==undefined){t="l"+e.lineStyle.veid}else if(e.materialId){t="m"+e.materialId}else{return null}if(!this._styles.has(t)){var i=[];e._setLineStyleAttributes(function(e,t){i.push(e,t)});this._styles.set(t,i)}return t};x.prototype.getMeasurementSurface=function(){return this._measurementSurface};x.prototype._dumpSceneData=function(){var e=this._scene.getDefaultNodeHierarchy();var t=e.findNodesByName();var i=b.getLevel();b.setLevel(b.Level.INFO);b.info("**************************************");b.info("Nodes in the scene: "+t.length);var s=0;var a=0;var r=0;var o=0;var n=document.getElementsByTagName("svg")[0];var h=function(e){s+=e.children.length;var t=e;var i=1;while(t!=n){t=t.parentNode;i++}if(a<i){a=i}if(e.children.length===0){r++;if(e.tagName==="g"){o++}}for(var l=0;l<e.children.length;l++){h(e.children[l])}};h(n);b.info("DOM statistics:");b.info("    Nodes:      "+s);b.info("    Tree depth: "+a);b.info("    Leaf nodes: "+r);b.info("    Empty nodes:"+o);b.info("    Groups:     "+document.getElementsByTagName("g").length);b.info("    Lines:      "+document.getElementsByTagName("line").length);b.info("    Polylines:   "+document.getElementsByTagName("polyline").length);b.info("    Polygons:   "+document.getElementsByTagName("polygon").length);b.info("    Paths:      "+document.getElementsByTagName("path").length);b.info("    Ellipses:   "+document.getElementsByTagName("ellipse").length);b.info("    Rectangles: "+document.getElementsByTagName("rect").length);b.info("    Texts:      "+document.getElementsByTagName("text").length);b.info("    Images:     "+document.getElementsByTagName("image").length);b.info("**************************************");b.setLevel(i)};x.prototype.projectToScreen=function(e,t,i,s){var a=s._worldToScreen(e,t,0);a.z=0;return a};return x});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/ViewportRenderer", ["./Element","../abgrToColor"],function(e,t){"use strict";var o={apiVersion:2};o.render=function(o,r){o.openStart("div",r);o.class("sapVizKitViewport");o.attr("tabindex",0);o.attr("aria-label","Image");o.attr("role","figure");o.style("width",r.getWidth());o.style("height",r.getHeight());o.style("background-image","linear-gradient("+r.getBackgroundColorTop()+","+r.getBackgroundColorBottom()+")");o.openEnd();o.openStart("canvas");o.style("display","none");o.openEnd();o.close("canvas");o.openStart("svg");o.attr("width","100%");o.attr("height","100%");o.attr("viewBox",r._getViewBox().join(" "));o.style("position","absolute");o.openEnd();var a=r.getScene();if(a){var n=r._getViewStateManagerSVG();var i=new Map;var s=t(n._highlightColorABGR);var l=t(r.getHotspotColorABGR());i.set(e._hotspotEffectName(s),s);i.set(e._hotspotEffectName(l),l);var c=a.getDefaultNodeHierarchy();c.getHotspotNodeIds().forEach(function(e){var t=e.getHotspotEffectDef();i.set(t.name,t.color)});i.forEach(function(e,t){o.openStart("filter");o.attr("id",t);o.openEnd();o.openStart("feColorMatrix");o.attr("in","SourceGraphic");o.attr("type","matrix");o.attr("values","0 0 0 0 "+e.red/255+", 0 0 0 0 "+e.green/255+", 0 0 0 0 "+e.blue/255+", 0 0 0 "+e.alpha+" 0");o.openEnd();o.close("feColorMatrix");o.close("filter")});a.getRootElement().render(o,n?n._mask:-1|0,r)}r._selectionRect.render(o,0|0);if(r._styles.size>0){o.openStart("defs");o.openEnd();o.openStart("style");o.openEnd();r._styles.forEach(function(e,t){o.text("."+t+"{\n");for(var r=0;r<e.length;r+=2){o.text(e[r]+":"+e[r+1]+";\n")}o.text("}\n")});o.close("style");o.close("defs")}o.close("svg");r.renderTools(o);r.renderContent(o);o.close("div")};return o},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/AnimationHelper", ["../thirdparty/three","../View","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../AnimationTrackValueTypeSize","../AnimationRotateType","../AnimationMath"],function(e,t,a,r,n,i,o,s){"use strict";var u=function(){};u.prototype._getChildNodesWithMaterial=function(e,t){for(var a=0;e.children&&a<e.children.length;a++){var r=e.children[a];if(r&&r.material&&r.material.color){t.push(r)}this._getChildNodesWithMaterial(r,t)}};u.prototype._getVkTrackType=function(e){switch(e.type){case"TRANSLATE":return r.Translate;case"ROTATE":return r.Rotate;case"SCALE":return r.Scale;case"OPACITY":return r.Opacity;case"COLOR":return r.Color;default:}};u.prototype._getVkTrackValueType=function(e,t){switch(e.type){case"TRANSLATE":return n.Vector3;case"ROTATE":if(t===o.Quaternion){return n.Quaternion}else if(t===o.AngleAxis){return n.AngleAxis}else{return n.Euler}break;case"SCALE":return n.Vector3;case"OPACITY":return n.Scalar;case"COLOR":return n.Vector3;default:}};u.prototype.insertEmptyTrack=function(e,t,a,r){var n=this._getVkTrackValueType(e);var i=r.createTrack(null,{trackValueType:n,isAbsoluteValue:e.isAbsoluteValue});if(t&&a){t.setNodeAnimation(a,this._getVkTrackType(e),i,true)}};u.prototype.insertTracks=function(e,t,a,r){e.forEach(function(e){var o=t.get(e.id);var s=r.findTrack(e.id.toString());if(Array.isArray(o)&&o.length){if(!s){var u=this._getVkTrackValueType(o[0],e.rotateType);var f=i.get(u);s=r.createTrack(e.id.toString(),{trackValueType:u,cycleForward:e.cyclicInfo.cyclicEnd,cycleBackward:e.cyclicInfo.cyclicStart,infinite:e.infinite,isAbsoluteValue:o[0].isAbsoluteValue});if(e.times){e.times.forEach(function(t,a){var r;if(u===n.Scalar){r=e.values[a]}else{r=[];for(var i=0;i<f;i++){r.push(e.values[a*f+i])}}s.insertKey(t,r,true)})}}o.forEach(function(e){var t=r.findSequence(e.sequenceId);var n=a.get(e.targetId);if(t&&n){t.setNodeAnimation(n,this._getVkTrackType(e),s,true)}},this)}},this);return this};u.prototype.setInitialNodePositionsFromSubsequentViews=function(e,t,a){if(!e||!e.length){return}var r;var n;var i;var o=new Map;for(var s=e.length-1;s>0;s--){var u=e[s];var f;if(u){f=u.getPlaybacks()}if(f){for(var l=f.length-1;l>=0;l--){var c=f[l];if(c){r=t.findSequence(c.getSequence().getId());if(r){if(a&&!r.hasHighlight()){continue}if(!c.getReversed()){n=r.getNodesBoundaryValues(true).entries()}else{n=r.getNodesBoundaryValues(false).entries()}i=n.next();while(!i.done){o.set(i.value[0],i.value[1]);i=n.next()}}}}}var v=e[s-1];if(v){if(!v.userData){v.userData={}}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map}n=o.entries();i=n.next();while(!i.done){v.userData.nodeStartDataByAnimation.set(i.value[0],i.value[1]);i=n.next()}}}};u.prototype.setInitialNodePositionsFromPreviousViews=function(e,t,a){if(!e||!e.length){return}var r;var n;var i;var o=new Map;for(var s=0;s<e.length-1;s++){var u=e[s];var f;if(u){f=u.getPlaybacks()}if(f){for(var l=0;l<f.length;l++){var c=f[l];if(c){r=t.findSequence(c.getSequence().getId());if(r){if(a&&!r.hasHighlight()){continue}if(!c.getReversed()){n=r.getNodesBoundaryValues(false).entries()}else{n=r.getNodesBoundaryValues(true).entries()}i=n.next();while(!i.done){o.set(i.value[0],i.value[1]);i=n.next()}}}}}var v=e[s+1];if(v){if(!v.userData){v.userData={}}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map}n=o.entries();i=n.next();while(!i.done){v.userData.nodeStartDataByAnimation.set(i.value[0],i.value[1]);i=n.next()}}}};u.prototype.setInitialNodePositionsOnView=function(e,t,a){if(!e){return}var r;var n;var i=0;var o=null;o=e.getPlaybacks();if(!o||!o.length){return}if(!e.userData){e.userData={}}if(!e.userData.nodeStartDataByAnimation){e.userData.nodeStartDataByAnimation=new Map}for(var s=o.length-1;s>=i;s--){var u=o[s];var f=t.findSequence(u.getSequence().getId());if(f){if(a&&!f.hasHighlight()){continue}if(u.getReversed()){r=f.getNodesBoundaryValues(false).entries()}else{r=f.getNodesBoundaryValues(true).entries()}n=r.next();while(!n.done){e.userData.nodeStartDataByAnimation.set(n.value[0],n.value[1]);n=r.next()}}}};u.prototype.setInitialNodePositionsFromCurrenetViews=function(e,t,a){if(!e||!e.length){return}for(var r=0;r<e.length;r++){var n=e[r];if(!n){continue}this.setInitialNodePositionsOnView(n,t,a)}};u.prototype.setPlaybackStartTimes=function(e,t){if(!e||!e.length){return}for(var a=0;a<e.length;a++){var r=e[a];if(!r){continue}var n=null;if(r){n=r.getPlaybacks()}if(!n||!n.length){continue}var i=0;for(var o=0;o<n.length;o++){var s=n[o];var u=s.getSequence();if(u){u.resetDuration(true)}s.setStartTime(i);i+=s.getDuration()}}};u.prototype.prepareViewForAnimation=function(e){var t=e.getNodeInfos();if(!t){return}if(!e.userData){e.userData={}}if(!e.userData.nodesDataByView){e.userData.nodesDataByView=new Map}else{return}function a(e){return(new THREE.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],0,0,0,1)}for(var r=0;r<t.length;r++){var n=t[r];if(!n||!n.target){continue}var i={};if(n.transform){i.position=new THREE.Vector3;i.scale=new THREE.Vector3;i.quaternion=new THREE.Quaternion;var o=a(n.transform);o.decompose(i.position,i.quaternion,i.scale);e.userData.nodesDataByView.set(n.target,i)}}};u.prototype.getNodePositionByView=function(e,t){var a;if(!e){return a}if(!e.userData||!e.userData.nodesDataByView){this.prepareViewForAnimation(e)}if(e.userData&&e.userData.nodesDataByView){a=e.userData.nodesDataByView.get(t)}return a};u.prototype.getNodePositionFromNearestPlayback=function(e,t,a,r){var n;if(!t||!e){return n}var i=t.getPlaybacks();if(!i){return n}var o;var s;var u=0;for(o=0;o<i.length;o++){s=i[o];if(a==s.getSequenceId()){u=s.getStartTime();break}}var f=0;for(o=0;o<i.length;o++){s=i[o];var l=s.getStartTime();if(u<=l){continue}if(a==s.getSequenceId()){continue}var c=e.findSequence(s.getSequenceId());if(c){var v;if(s.getReversed()){v=c.getNodesStartValues()}else{v=c.getNodesEndValues()}var g=v.get(r);if(g&&l>=f){n=g;f=l}}}return n};u.prototype._buildViewInitialState=function(e,t,a){var i=t.indexOf(e);if(i<0){return undefined}var o;var u;var f;var l=new Map;var c=function(e,t,a){var r=l.get(e);if(!r){r={target:e};l.set(e,r)}r[t]=a};var v=function(e,t){if(!e){return}var a=e.getNodeAnimation();if(a){a.forEach(function(e){var a=e.nodeRef;for(var i in r){var o=r[i];var u=e[o];if(u&&u.getKeysCount()){var f=t?0:u.getKeysCount()-1;var l=u.getKey(f);var v=u.getKeysType();var g=0;if(v===n.AngleAxis){g=1}var d=s.interpolate(v,l,l,g,u);c(a,o,d.value)}}})}};for(o=t.length-1;o>=i;o--){f=t[o].getPlaybacks();if(Array.isArray(f)){for(u=f.length-1;u>=0;u--){v(f[u].getSequence(),true)}}}for(o=0;o<i;o++){f=t[o].getPlaybacks();if(Array.isArray(f)){for(u=0;u<f.length;u++){v(f[u].getSequence(),false)}}}return l};u.prototype.buildViewsInitialState=function(e,t){if(!Array.isArray(e)){return}var a=function(e){var t=[];e.forEach(function(e,a){t.push(e)});return t};e.forEach(function(r){var n=this._buildViewInitialState(r,e,t);if(n){r.updateNodeInfos(a(n))}},this)};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/BBoxSubdivider", [],function(){"use strict";var t=function(){this.unpack=function(t){if(!t||t.bytelength<1){return false}try{this.nLevel=t[0];if(this.nLevel>5){return false}this.numDivision=Math.pow(2,this.nLevel);this.octree=new Uint8Array(Math.pow(this.numDivision,3));this.streamOffset=1;this._decodeRecursive(t,0,0,0,0)}catch(t){return false}return true};this.getUnpacked=function(){return this.octree};this._setValue=function(t,e,i,r){this.octree[i*this.numDivision*this.numDivision+e*this.numDivision+t]=r?1:0};this._decodeRecursive=function(t,e,i,r,n){if(n===this.nLevel){this._setValue(e,i,r,true);return true}if(this.streamOffset>=t.length){return false}var s=t[this.streamOffset];this.streamOffset++;e*=2;i*=2;r*=2;if(n>=this.nLevel){return true}for(var u=0;u<2;u++){for(var o=0;o<2;o++){for(var a=0;a<2;a++){if((s&1<<u*4+o*2+a)!==0){if(!this._decodeRecursive(t,e+a,i+o,r+u,n+1)){return false}}else{this._clearBitsRecursive(e+a,i+o,r+u,n+1)}}}}return true};this._clearBitsRecursive=function(t,e,i,r){if(r===this.nLevel){this._setValue(t,e,i,false);return}t*=2;e*=2;i*=2;if(r>=this.nLevel){return}for(var n=0;n<2;n++){for(var s=0;s<2;s++){for(var u=0;u<2;u++){this._clearBitsRecursive(t+u,e+s,i+n,r+1)}}}}};var e=function(t){this.numDivision=t;this.xyzToIndexMap=new Map;this.points=[];this.getOrCreatePointAt=function(t,e,i,r,n){var s=t+":"+e+":"+i+":"+r+":"+n;var u=this.xyzToIndexMap.get(s);if(u){return u}this.points.push(t/this.numDivision-.5,e/this.numDivision-.5,i/this.numDivision-.5);u=this.points.length/3-1;this.xyzToIndexMap.set(s,u);return u}};var i=function(t,e,i){this.level=t;this.numDivision=e;this.unpacked=i;this.getValue=function(t,e,i){if(t<0||e<0||i<0||t>=this.numDivision||e>=this.numDivision||i>=this.numDivision){return 0}return this.unpacked[i*this.numDivision*this.numDivision+e*this.numDivision+t]}};var r=function(){};r.unpackSubDividedBoundingBox=function(e){var r=new t;if(r.unpack(e)){return new i(r.nLevel,r.numDivision,r.getUnpacked())}return null};r.makeSubDividedBoundingBoxGeometry=function(t){if(!t){return null}var i=[];var r=t.level;var n=Math.pow(2,r);var s=new e(n);var u,o,a,h,f,v,l,c;for(u=0;u<=n;u++){for(o=0;o<n;o++){for(a=0;a<n;a++){h=t.getValue(u,o,a)-t.getValue(u-1,o,a);if(h!==0){f=s.getOrCreatePointAt(u,o,a,0,h);v=s.getOrCreatePointAt(u,o+1,a,0,h);l=s.getOrCreatePointAt(u,o+1,a+1,0,h);c=s.getOrCreatePointAt(u,o,a+1,0,h);if(h<0){i.push(f,v,l);i.push(f,l,c)}else{i.push(l,v,f);i.push(c,l,f)}}}}}for(o=0;o<=n;o++){for(u=0;u<n;u++){for(a=0;a<n;a++){h=t.getValue(u,o,a)-t.getValue(u,o-1,a);if(h!==0){f=s.getOrCreatePointAt(u,o,a,1,h);v=s.getOrCreatePointAt(u+1,o,a,1,h);l=s.getOrCreatePointAt(u+1,o,a+1,1,h);c=s.getOrCreatePointAt(u,o,a+1,1,h);if(h>0){i.push(f,v,l);i.push(f,l,c)}else{i.push(l,v,f);i.push(c,l,f)}}}}}for(a=0;a<=n;a++){for(u=0;u<n;u++){for(o=0;o<n;o++){h=t.getValue(u,o,a)-t.getValue(u,o,a-1);if(h!==0){f=s.getOrCreatePointAt(u,o,a,2,h);v=s.getOrCreatePointAt(u+1,o,a,2,h);l=s.getOrCreatePointAt(u+1,o+1,a,2,h);c=s.getOrCreatePointAt(u,o+1,a,2,h);if(h<0){i.push(f,v,l);i.push(f,l,c)}else{i.push(l,v,f);i.push(c,l,f)}}}}}var p=new THREE.BufferGeometry;var g=new THREE.BufferAttribute(new Uint16Array(i),1);var m=new THREE.BufferAttribute(new Float32Array(s.points),3);p.setIndex(g);p.setAttribute("position",m);p.computeFaceNormals();p.computeVertexNormals();p.computeBoundingSphere();return p};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/BaseNodeProxy", ["../BaseNodeProxy"],function(t){"use strict";var e=t.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});e.prototype.init=function(t,e){this._object3D=e};e.prototype.reset=function(){this._object3D=null};e.prototype.getNodeRef=function(){return this._object3D};e.prototype.getNodeId=function(){return this._object3D};e.prototype.getName=function(){return this._object3D.name||"<"+this._object3D.type+">"};e.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{}};e.prototype.getHasChildren=function(){return this._object3D.children.length>0};e.prototype.getSceneRef=function(){return this._object3D};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Billboard", ["sap/ui/base/ManagedObject","../thirdparty/three","../thirdparty/html2canvas","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","./ThreeUtils","../NodeContentType"],function(t,e,i,r,a,o,n,l,h,s){"use strict";var d=t.extend("sap.ui.vk.threejs.Billboard",{metadata:{library:"sap.ui.vk",properties:{node:{type:"any",defaultValue:new THREE.Group},text:{type:"string",defaultValue:""},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:20},fontWeight:{type:"string",defaultValue:"normal"},fontItalic:{type:"boolean",defaultValue:false},textColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderOpacity:{type:"float",defaultValue:1},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},backgroundOpacity:{type:"float",defaultValue:.5},encoding:{type:"sap.ui.vk.BillboardTextEncoding",defaultValue:a.PlainText},width:{type:"float",defaultValue:100},height:{type:"float",defaultValue:100},style:{type:"sap.ui.vk.BillboardStyle",defaultValue:o.None},borderLineStyle:{type:"sap.ui.vk.BillboardBorderLineStyle",defaultValue:n.Solid},borderWidth:{type:"float",defaultValue:2},horizontalAlignment:{type:"sap.ui.vk.BillboardHorizontalAlignment",defaultValue:l.Left},texture:{type:"any",defaultValue:null},material:{type:"any"},link:{type:"string",defaultValue:""},coordinateSpace:{type:"sap.ui.vk.BillboardCoordinateSpace",defaultValue:r.Viewport},position:{type:"any",defaultValue:new THREE.Vector3(0,0,0)},renderOrder:{type:"int",defaultValue:0}}}});d.prototype._planeGeometry=new THREE.PlaneBufferGeometry(1,1);d.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}var e=new THREE.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true,alphaTest:.05,premultipliedAlpha:true,side:THREE.DoubleSide});this.setProperty("material",e,true);this._billboard=new THREE.Mesh(this._planeGeometry,e);this._needUpdateTexture=true};d.prototype.exit=function(){if(t.prototype.exit){t.prototype.exit.call(this)}if(this._billboard){h.disposeObject(this._billboard);this._billboard=null}};d.prototype.setNode=function(t){if(t instanceof THREE.Object3D){this.setProperty("node",t,true);t.add(this._billboard);t.matrixAutoUpdate=false;t.isBillboard=true;t.userData.billboard=this;this._traverse(function(t){t.userData.skipIt=true})}return this};d.prototype._traverse=function(t){t(this._billboard)};d.prototype.setEncoding=function(t){this.setProperty("encoding",t,true);this._needUpdateTexture=true;return this};d.prototype.setText=function(t){this.setProperty("text",t,true);this._needUpdateTexture=true;return this};d.prototype.setFont=function(t){this.setProperty("font",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontSize=function(t){this.setProperty("fontSize",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontWeight=function(t){this.setProperty("fontWeight",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontItalic=function(t){this.setProperty("fontItalic",t,true);this._needUpdateTexture=true;return this};d.prototype.setStyle=function(t){this.setProperty("style",t,true);this._needUpdateTexture=true;return this};d.prototype.setWidth=function(t){this.setProperty("width",t,true);this._needUpdateTexture=true;return this};d.prototype.setHeight=function(t){this.setProperty("height",t,true);this._needUpdateTexture=true;return this};d.prototype.setTextColor=function(t){this.setProperty("textColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBackgroundColor=function(t){this.setProperty("backgroundColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBackgroundOpacity=function(t){this.setProperty("backgroundOpacity",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderWidth=function(t){this.setProperty("borderWidth",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderLineStyle=function(t){this.setProperty("borderLineStyle",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderColor=function(t){this.setProperty("borderColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderOpacity=function(t){this.setProperty("borderOpacity",t,true);this._needUpdateTexture=true;return this};d.prototype.setHorizontalAlignment=function(t){this.setProperty("horizontalAlignment",t,true);this._needUpdateTexture=true;return this};d.prototype.setLink=function(t){this.setProperty("link",t,true);this._needUpdateTexture=true;return this};d.prototype.setTexture=function(t){this.setProperty("texture",t,true);this._billboard.material.map=t;return this};d.prototype.setMaterial=function(t){this.setProperty("material",t,true);this._billboard.material=t;return this};d.prototype.setRenderOrder=function(t){this.setProperty("renderOrder",t,true);this._traverse(function(e){e.renderOrder=t});return this};d.prototype._renderBackground=function(t,e,i,r){t.fillStyle=this.getBackgroundColor();t.strokeStyle=this.getBorderColor();t.lineWidth=r;switch(this.getBorderLineStyle()){default:t.setLineDash([]);break;case n.Dash:t.setLineDash([r*5,r]);break;case n.Dot:t.setLineDash([r*2,r]);break;case n.DashDot:t.setLineDash([r*5,r,r*2,r]);break;case n.DashDotDot:t.setLineDash([r*5,r,r*2,r,r*2,r]);break}var a=r/2;if(this.getStyle()===o.RectangularShape){t.globalAlpha=this.getBackgroundOpacity();if(t.globalAlpha>0){t.fillRect(0,0,e,i)}t.globalAlpha=r>0?this.getBorderOpacity():0;if(t.globalAlpha>0){t.strokeRect(a,a,e-r,i-r)}}else if(this.getStyle()===o.CircularShape){var l=e/2;var h=i/2;var s=e/2;t.beginPath();t.arc(l,h,s-a,0,2*Math.PI);t.closePath();t.globalAlpha=this.getBackgroundOpacity();if(t.globalAlpha>0){t.fill()}t.globalAlpha=r>0?this.getBorderOpacity():0;if(t.globalAlpha>0){t.stroke()}}t.globalAlpha=1;t.setLineDash([])};d.prototype._getFont=function(t){return(this.getFontItalic()?"italic ":"")+this.getFontWeight()+" "+this.getFontSize()*t+"px "+(this.getFont()||"Arial")};d.prototype._renderPlainText=function(t){var e=document.createElement("canvas");var i=e.getContext("2d");var r=this.getFontSize()*t;var a=this._getFont(t);i.font=a;var l=Math.ceil(r);var h=this.getBorderLineStyle()!==n.None?this.getBorderWidth()*t:0;var s=Math.ceil(r*.2+h);var d=this.getText().split("\n");var u=0;d.forEach(function(t){u=Math.max(u,i.measureText(t).width)});var p=this.getLink();if(p.length>0){u=Math.max(u,i.measureText(p).width)}u=Math.ceil(u*.5)*2;var c=d.length+(p.length>0?1:0);var g=Math.ceil(l*c*.5)*2;var y=u+s*2;var f=g+s*2;if(this.getStyle()===o.CircularShape){y=f=Math.max(y,f)}this._width=y/t;this._height=f/t;e.width=THREE.Math.ceilPowerOfTwo(y);e.height=THREE.Math.ceilPowerOfTwo(f);this._renderBackground(i,y,f,h);i.font=a;i.textAlign=this.getHorizontalAlignment();i.textBaseline="middle";var x=["left","center","right"].indexOf(i.textAlign);var m=y+u*(x-1)>>1;var v=f-(c-1)*l>>1;i.fillStyle=this.getTextColor();i.filter="blur(0px)";for(var b in d){i.fillText(d[b],m,v+l*b)}if(p.length>0){i.fillStyle="#00f";i.textAlign="right";i.textBaseline="bottom";i.fillText(p,y-s,f-s)}this._setBillboardTexture(e,y,f)};d.prototype._renderHtmlText=function(t){var e=document.createElement("canvas");var r=e.getContext("2d");var a=this.getBorderLineStyle()!==n.None?this.getBorderWidth()*t:0;var l=Math.ceil(a);var h=Math.ceil(this.getWidth()*t)+l*2;var s=Math.ceil(this.getHeight()*t)+l*2;if(this.getStyle()===o.CircularShape){h=s=Math.max(h,s)}this._width=h/t;this._height=s/t;e.width=THREE.Math.ceilPowerOfTwo(h);e.height=THREE.Math.ceilPowerOfTwo(s);this._renderBackground(r,h,s,a);var d=this.getLink();if(d.length>0){r.font=this._getFont(t);r.fillStyle="#00f";r.textAlign="right";r.textBaseline="bottom";r.fillText(d,h-l,s-l)}var u=document.createElement("iframe");u.style.visibility="hidden";u.width=(h-l*2)/t;u.height=(s-l*2)/t;u.sandbox="allow-same-origin";document.body.appendChild(u);var p=u.contentDocument||u.contentWindow.document;p.open();p.close();p.body.innerHTML=this.getText();var c=document.createElement("canvas");c.width=u.width*t;c.height=u.height*t;c.style.width=u.width+"px";c.style.height=u.height+"px";var g=c.getContext("2d");g.scale(t,t);this._billboard.material.visible=false;i(p.body,{canvas:c,backgroundColor:null}).then(function(t){if(t.width>0&&t.height>0){e.getContext("2d").drawImage(t,l,l)}setTimeout(this._setBillboardTexture.bind(this,e,h,s),0);document.body.removeChild(u)}.bind(this))};d.prototype._renderText=function(t){var e=this.getFont()||"Arial";var r=this.getFontSize()*1.333;var l=4;var h=1.2;var s=1.25;var d;var u;var p=document.createElement("canvas");p.id="jDVLAnnotationCanvas-"+Math.random().toString(36).substr(2,9);p.style.visibility="hidden";p.style.display="none";var c=2048;var g=1024;var y=Math.pow(2,Math.ceil(Math.log(t)/Math.LN2));p.width=c*y;p.height=g*y;document.body.appendChild(p);var f=p.getContext("2d");var x=Math.min(Math.max(Math.round(this.getFontWeight()/100),1),9)*100;f.font=x+(this.getFontItalic()?" italic ":" ")+r+"px "+e;var m=Math.ceil(r*h);var v=this.getWidth();var b=this.getHeight();var T=this.getBorderLineStyle()!==n.None?this.getBorderWidth():0;var w=(this.getEncoding()===a.PlainText?1024:v)-(l+T)*2;var M=((this.getEncoding()===a.PlainText?1024:this.getHeight())-(l+T)*2)/m|0;var E=0;var S=0;var _=this.getText();var B=this.getLink();var C=this.getEncoding()===a.PlainText?_.split("\n"):[];C.length=Math.min(C.length,B.length>0?M-1:M);function k(t){return t.substr(0,t.length-2)+""}var P=[];if(B.length>0){var W=M-C.length;while(B.length>0&&C.length<W){var D=B;while(f.measureText(D).width>w&&D.length>1){D=D.substring(0,D.length-1)}P.push(D);B=B.substring(D.length,B.length)}if(B.length>0){P[P.length-1]=k(P[P.length-1])}for(var A=0;A<P.length;A++){S=Math.max(f.measureText(P[A]).width,S)}}if(this.getEncoding()===a.PlainText){for(var H=0;H<C.length;H++){E=Math.max(f.measureText(C[H]).width,E)}var R=f.measureText(" ").width;v=Math.max(E,S)+R+l*2;b=(C.length+P.length)*m+l*2}else if(this.getEncoding()===a.HtmlText&&typeof i!="undefined"){d=document.createElement("iframe");d.style.visibility="hidden";d.sandbox="allow-same-origin";document.body.appendChild(d);u=d.contentDocument||d.contentWindow.document;u.open();u.close();u.documentElement.innerHTML=_;(function t(){var e;if(u.styleSheets.length===0){e=u.createElement("style");e.type="text/css";e.appendChild(document.createTextNode(""));u.head.appendChild(e)}e=u.querySelector("style");e.sheet.insertRule("* { margin: 0; padding: 0; line-height: 1; }",0);e.sheet.insertRule("span { line-height: "+s+"; overflow-wrap: break-word;  }",1);var i=e.sheet.cssRules;var r=[];for(var a=0;a<i.length;a++){r.push(i[a].cssText)}e.textContent=r.join("\n");u.body.removeAttribute("style");var o=u.body.querySelectorAll("p");if(o.length>0){o[0].style.marginTop=0;o[0].style.paddingTop="1px";o.forEach(function(t,e){t.style.whiteSpace="normal"})}u.body.querySelectorAll("span").forEach(function(t){var e=t.style.fontFamily.split(",");e.forEach(function(t,i){e[i]='"'+t.trim().replaceAll(/[\u0022\u0027]/g,"")+'"'});t.style.fontFamily=e.join(", ")})})();var V=function(t){function e(t,e){if(e.left<t.left){t.left=e.left}if(e.right>t.right){t.right=e.right}if(e.top<t.top){t.top=e.top}if(e.bottom>t.bottom){t.bottom=e.bottom}}u.body.style.margin=0;u.body.style.padding=0;u.body.style.border=0;var i=u.createElement("div");while(u.body.childNodes.length){var r=u.body.childNodes[0];i.appendChild(r)}u.body.appendChild(i);i.style.margin=0;i.style.padding=0;i.style.border=0;i.style.position="absolute";var a={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};var o;var n;if(t===undefined){i.style.width="min-content";i.style.height="min-content";i.style.overflowWrap="normal";u.querySelectorAll("span").forEach(function(t){e(a,t.getBoundingClientRect())});o=Math.ceil(a.right-a.left);n=Math.ceil(a.bottom-a.top);var h=a.width/a.height;var s=16/9;if(h>s){t={width:o,height:n}}else{var p=o*n;var c=Math.sqrt(p/s);var g=c*s;t={width:Math.ceil(g),height:Math.ceil(c)}}}i.style.width=t.width+"px";i.style.height=t.height+"px";i.style.overflowWrap="normal";u.querySelectorAll("span").forEach(function(t){e(a,t.getBoundingClientRect())});o=Math.ceil(a.right-a.left);if(Math.abs(o-t.width)>l){o=Math.min(o,t.width-2*l)}d.width=o;i.style.width=o+"px";a={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};u.querySelectorAll("p").forEach(function(t){e(a,t.getBoundingClientRect())});n=Math.ceil(a.bottom-a.top);var y={width:o,height:n};while(i.childNodes.length){var f=i.childNodes[0];u.body.appendChild(f)}u.body.removeChild(i);return y};var L={width:Math.ceil(v),height:Math.ceil(b)};L=V(v>0&&b>0?L:undefined);L.width+=l*2;L.height+=l*2;if(v<L.width){v=L.width}if(b<L.height){b=L.height}}v=Math.ceil(v+2*T);b=Math.ceil(b+2*T);if(this.getStyle()===o.CircularShape){v=b=Math.max(v,b)}v*=t;b*=t;var F=Math.pow(2,Math.ceil(Math.log(v)/Math.LN2));var O=Math.pow(2,Math.ceil(Math.log(b)/Math.LN2));F=Math.min(F,p.width);O=Math.min(O,p.height);var U=1;if(v>F||b>O){U=Math.min(F/v,O/b);v*=U;b*=U;t*=U}var I=v;var q=b;this._width=v/t;this._height=b/t;l*=t;T*=t;r*=t;m*=t;E*=t;f.fillStyle=this.getBackgroundColor();f.strokeStyle=this.getBorderColor();f.lineWidth=T;var j=T/2;switch(this.getBorderLineStyle()){default:f.setLineDash([]);break;case n.Dash:f.setLineDash([T*5,T]);break;case n.Dot:f.setLineDash([T*2,T]);break;case n.DashDot:f.setLineDash([T*5,T,T*2,T]);break;case n.DashDotDot:f.setLineDash([T*5,T,T*2,T,T*2,T]);break}var z=this.getBackgroundOpacity();var N=this.getBorderOpacity();if(this.getStyle()===o.RectangularShape){if(z>0){f.globalAlpha=z;f.fillRect(0,0,v,b)}f.globalAlpha=T>0?N:0;if(f.globalAlpha>0){f.strokeRect(j,j,v-T,b-T)}}else if(this.getStyle()===o.CircularShape){var G=v/2;var Q=b/2;var J=Math.min(G,Q);f.beginPath();f.arc(G,Q,J-j,0,2*Math.PI);f.closePath();if(z>0){f.globalAlpha=z;f.fill()}f.globalAlpha=T>0?N:0;if(N>0){f.stroke()}}f.globalAlpha=1;f.setLineDash([]);f.font=x+(this.getFontItalic()?" italic ":" ")+r+"px "+e;f.textAlign="left";f.textBaseline="middle";function K(){if(P.length>0){f.fillStyle="#0000FF";b-=P.length*m;var t=(v-S)*.5;var e=b-T-l+m*.5;for(var i=0;i<P.length;i++){f.fillText(P[i],t,e);e+=m}}}if(this.getEncoding()===a.PlainText){K();f.fillStyle=this.getTextColor();f.strokeStyle=this.getBackgroundColor();f.lineWidth=3;var X=(v-E)*.5;var Y=(b-(C.length-P.length-1)*m)*.5;if(C.length==1){var Z=f.measureText(_);var $=Z.actualBoundingBoxDescent+Z.actualBoundingBoxAscent;f.textAlign="center";f.textBaseline="bottom";X=v*.5;Y=(b-2*T-$)*.5+$+l}for(var tt=0;tt<C.length;tt++){if(this.getStyle()===o.TextGlow){f.strokeText(C[tt],X,Y)}f.fillText(C[tt],X,Y);Y+=m}this._setBillboardTexture(p,I,q);document.body.removeChild(p)}else if(this.getEncoding()===a.HtmlText&&typeof i!="undefined"){K();var et=v-T*2;var it=b-T*2;et/=t;it/=t;d.width=et;d.height=it;d.scale=U;d.sandbox="allow-same-origin";l/=t;u.body.style.width=et-2*l+"px";u.body.style.height=it-2*l+"px";u.body.style.margin=0;u.body.style.padding=l+"px";var rt=document.createElement("canvas");rt.style.width=et+"px";rt.style.height=it+"px";rt.width=et*t;rt.height=it*t;var at=rt.getContext("2d");at.scale(t,t);i(u.documentElement,{canvas:rt,backgroundColor:null,width:et,height:it}).then(function(t){if(t.width>0&&t.height>0){var e=p.getContext("2d");e.scale(U,U);e.drawImage(t,T,T)}setTimeout(this._setBillboardTexture.bind(this,p,I,q),0);document.body.removeChild(d);document.body.removeChild(p)}.bind(this))}else{document.body.removeChild(p)}};d.prototype._setBillboardTexture=function(t,e,i){var r=e/t.width,a=i/t.height;this._billboard.geometry=new THREE.PlaneBufferGeometry(1,1).setAttribute("uv",new THREE.Float32BufferAttribute([0,1,r,1,0,1-a,r,1-a],2));var o=new THREE.CanvasTexture(t);o.magFilter=THREE.NearestFilter;this._billboard.material.map=o;this._billboard.material.needsUpdate=true;this._billboard.material.visible=true};var u=new THREE.Vector4,p=new THREE.Vector3,c=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Quaternion,f=new THREE.Vector3;d.prototype._updateTexture=function(){this._width=this.getWidth();this._height=this.getHeight();if(this.getText()&&!this.getTexture()){this._renderText(window.devicePixelRatio)}};d.prototype._update=function(t,e,i){var a=this.getNode();if(!a||!a.visible){return}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture()}a.matrix.getInverse(a.parent.matrixWorld);a.matrix.decompose(a.position,a.quaternion,a.scale);a.matrixWorld.identity();var o=this._billboard;var n=this.getPosition();var l=o.position;var h=1;if(n){l.copy(n)}else{l.setScalar(0)}o.quaternion.copy(e.quaternion);var s=this.getCoordinateSpace();if(s===r.Screen){var d=THREE.Math.lerp(e.near,e.far,1e-4);h=(e.isPerspectiveCamera?2*d:2)/e.projectionMatrix.elements[5];l.set(l.x*h,l.y*h,-d).applyMatrix4(e.matrixWorld);h*=2}else if(s===r.Viewport){if(i.x>i.y){l.x*=i.y/i.x}else{l.y*=i.x/i.y}l.z=-.9999;l.unproject(e);u.copy(l).applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix);var g=u.x/u.w*.5*i.x,y=u.y/u.w*.5*i.y;h=u.w*2/(i.x*e.projectionMatrix.elements[0]);p.setFromMatrixColumn(e.matrixWorld,0).multiplyScalar(h*(Math.round(g)-g));c.setFromMatrixColumn(e.matrixWorld,1).multiplyScalar(h*(Math.round(y)-y));l.add(p).add(c)}o.scale.set((this._width>=0?this._width:.5*i.x/i.y)*h,(this._height>=0?this._height:.5)*h,1);o.updateMatrix();o.updateMatrixWorld()};d.prototype._ortho2DUpdate=function(t,e){if(!this.visible){return}var i=this.userData.originalTransform;var r=e.near*1.0001;if(Math.abs(i.q.w-1)>.001){r=Math.min(r+e.near*i.s.length()*.5,(e.near+e.far)*.5)}this.position.copy(i.p).multiplyScalar(2/e.projectionMatrix.elements[5]);this.position.z=-1;this.position.multiplyScalar(r).applyMatrix4(e.matrixWorld);y.copy(e.quaternion).multiply(i.q);this.quaternion.copy(y);this.scale.copy(i.s).multiplyScalar(r*.5);this.scale.z=Math.min(r-e.near,this.scale.z*.001);this.matrixWorld.compose(this.position,this.quaternion,this.scale);this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true)};d.prototype._billboardViewUpdate=function(t,e,i,r){if(!this.visible){return}this.parent.matrixWorld.decompose(g,y,f);y.inverse().multiply(e.quaternion);this.quaternion.copy(y);if(this._vkGetNodeContentType()===s.Symbol){if(r===undefined){var a=(new THREE.Vector3).setFromMatrixColumn(e.matrixWorld,2);this._vkSetOpacity(Math.max(a.dot(this.userData.direction),0)*.8+.2)}u.copy(this.getWorldPosition(g));u.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix);var o=u.w*2/(t.getSize(new THREE.Vector2).x*e.projectionMatrix.elements[0]);this.scale.setScalar(o);if(!this.userData._symbolCenterFixed){if(!this.userData.boundingBox||this.userData.boundingBox.isEmpty()){this._vkCalculateObjectOrientedBoundingBox();if(this.userData.boundingBox.isEmpty()){return}}var n=this.userData.boundingBox.getCenter(new THREE.Vector3).multiplyScalar(-1);this.traverse(function(t){if(t.geometry){t.position.add(n);t.updateMatrix()}});this._vkCalculateObjectOrientedBoundingBox();this.userData._symbolCenterFixed=true}}this.updateMatrix();this.updateMatrixWorld()};d.prototype._lockToViewportUpdate=function(t,e){var i=0;this.children.forEach(function(t){if(t.visible&&Math.abs(t.quaternion.w-1)>.001){i=Math.max(i,t.scale.length())}});var r=Math.min(e.near*(1.0001+i*.5),(e.near+e.far)*.5);this.position.setFromMatrixColumn(e.matrixWorld,2).multiplyScalar(-r);this.position.add(e.position);this.scale.setScalar(r*2/e.projectionMatrix.elements[5]);this.matrixWorld.compose(this.position,e.quaternion,this.scale);this.matrix.getInverse(this.parent.matrixWorld).multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true)};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Callout", ["../thirdparty/three","sap/ui/base/ManagedObject","./Billboard","../thirdparty/html2canvas","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../BillboardStyle","../LeaderLineMarkStyle","./ThreeUtils"],function(e,t,a,r,i,l,s,n,o,h){"use strict";var p=a.extend("sap.ui.vk.threejs.Callout",{metadata:{library:"sap.ui.vk",properties:{anchorNode:{type:"any",defaultValue:null},depthTest:{type:"boolean",defaultValue:true}}}});p.prototype.init=function(){if(a.prototype.init){a.prototype.init.call(this)}this._lines=[];this._heads=[]};p.prototype.exit=function(){if(a.prototype.exit){a.prototype.exit.call(this)}this._lines.forEach(function(e){h.disposeObject(e)});this._lines=null;this._heads.forEach(function(e){h.disposeObject(e)});this._heads=null};p.prototype._traverse=function(e){a.prototype._traverse.call(this,e);this._lines.forEach(e);this._heads.forEach(e)};p.prototype.setDepthTest=function(e){this.setProperty("depthTest",e,true);this._traverse(function(t){t.material.depthTest=e});return this};var d=new THREE.Vector4,u=new THREE.Vector4,y=new THREE.Vector4,c=new THREE.Vector2,x=new THREE.Vector2,f=new THREE.Vector2,m=new THREE.Quaternion,v=new THREE.Matrix4,g=new THREE.Vector2,M=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3(0,0,1),T=new THREE.Matrix4,b=new THREE.Matrix4;p.prototype._update=function(e,t,a){var r=this.getNode();if(!r||!r.visible){return}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture()}r.matrix.getInverse(r.parent.matrixWorld);r.matrix.decompose(r.position,r.quaternion,r.scale);r.matrixWorld.identity();var i=this.getPosition(),l=this._billboard.position;if(i){l.copy(i)}else{l.setScalar(0)}var s=this.getAnchorNode();if(s){l.applyMatrix4(s.matrixWorld)}this._billboard.quaternion.copy(t.quaternion);T.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);d.copy(l).applyMatrix4(T);c.copy(d).multiplyScalar(1/d.w).multiply(a);var o=d.w*2/(a.x*t.projectionMatrix.elements[0]);this._billboard.scale.set(o*this._width,o*this._height,1);M.setFromMatrixColumn(t.matrixWorld,0).multiplyScalar(o*(Math.round(c.x*.5)-c.x*.5));w.setFromMatrixColumn(t.matrixWorld,1).multiplyScalar(o*(Math.round(c.y*.5)-c.y*.5));l.add(M).add(w);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();var h=this.getStyle()===n.CircularShape;var p=t.near;function _(e,t,a){if(e<t){return e-t}else if(e>a){return e-a}return 0}this._lines.forEach(function(e){if(e.userData.targetNode){e.matrix.copy(e.userData.targetNode.matrixWorld)}else{e.matrix.identity()}e.matrixWorld.copy(e.matrix);if(e.isPolylineMesh){e.material.resolution.copy(a)}if(e.isHaloMesh){return}var r=e.geometry.vertices;var i=r[0];var l=r[r.length-2];var s=r[r.length-1];var n=e.userData.startPointMesh;var o=false;var M=[0,r.length-1];if(n!==undefined){i.copy(n.userData.targetVertex)}b.multiplyMatrices(T,e.matrixWorld);if(e.userData.extensionLength>0&&r.length>2){M.push(r.length-2);d.copy(r[r.length-3]).applyMatrix4(b);x.copy(d).multiplyScalar(1/d.w).multiply(a);l.set(Math.sign(x.x-c.x)*.5*(1+e.userData.extensionLength/this._width),0,0);l.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(v.getInverse(e.matrixWorld))}d.copy(l).applyMatrix4(b);x.copy(d).multiplyScalar(1/d.w).multiply(a);if(h){var w=g.copy(x).sub(c).length();o=w<this._width;g.multiplyScalar(.5/w);s.set(g.x,g.y,0)}else{var S=_(x.x,c.x-this._width,c.x+this._width),D=_(x.y,c.y-this._height,c.y+this._height);o=S===0&&D===0;if(Math.abs(S)>Math.abs(D)){s.set(Math.sign(S)*.5,0,0)}else{s.set(0,Math.sign(D)*.5,0)}}if(o){s.copy(l)}else{s.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(v.getInverse(e.matrixWorld))}e.geometry.verticesNeedUpdate=true;if(n!==undefined){n.position.copy(n.userData.targetVertex).applyMatrix4(e.matrixWorld);d.copy(n.position).applyMatrix4(T);var R=d.w/(a.x*t.projectionMatrix.elements[0]);n.scale.setScalar(R);n.visible=false;var H=false;if(d.w>=p){u.copy(d);y.copy(r[1]).applyMatrix4(b);if(y.w<p){var P=(u.w-p)/(u.w-y.w);y.sub(u).multiplyScalar(P).add(u)}f.copy(u).multiplyScalar(1/u.w);x.copy(y).multiplyScalar(1/y.w);g.copy(x).sub(f).multiply(a);H=g.length()<n.userData.lineOffset;m.setFromAxisAngle(E,Math.atan2(g.y,g.x));n.quaternion.copy(t.quaternion).multiply(m);n.updateMatrix();n.matrixWorld.copy(n.matrix);n.matrixWorldNeedsUpdate=false;f.multiply(a).sub(c);n.visible=h?f.length()>this._width:Math.abs(f.x)>this._width||Math.abs(f.y)>this._height;if(H||!n.visible){i.copy(r[1])}else{i.set(n.userData.lineOffset,0,0).applyMatrix4(n.matrixWorld).applyMatrix4(v.getInverse(e.matrixWorld))}}}e.geometry._updateVertices(M);e.computeLineDistances(b,a,t instanceof THREE.PerspectiveCamera?p:undefined);if(e.userData.haloMesh){e.userData.haloMesh.material.lineLength=e.material.lineLength}}.bind(this))};p.prototype._createMarkMesh=function(e,t,a,r){var i=a===o.Arrow;var l=window.devicePixelRatio;var s=t.width;var n=s*t.haloWidth;r=(Array.isArray(r)||r instanceof Float32Array)&&r.length===2?r:[1,1];var h,p;if(i){h=Math.max(35*r[0],s*5);p=Math.max(15*r[1],s*2)}else{h=p=Math.max(2*r[0],s*2)}h=Math.ceil(h+n*2);p=Math.ceil(p+n*2);var d=document.createElement("canvas");d.width=THREE.Math.ceilPowerOfTwo(h*l);d.height=THREE.Math.ceilPowerOfTwo(p*l);var u=d.getContext("2d");var y=h/2,c=p/2;u.fillStyle="#FFF";u.scale(l,l);if(i){u.beginPath();u.moveTo(0,c);u.lineTo(h,0);u.lineTo(h,p);u.closePath();u.fill();var x=h*c/Math.sqrt(h*h+c*c),f=(x-n)/x;var m=h-h*f,v=c*(h*f-n)/h;u.fillStyle=e.getStyle();u.beginPath();u.moveTo(m,c);u.lineTo(h-n,c-v);u.lineTo(h-n,c+v);u.closePath();u.fill()}else{var g=h*.5,M=g-n;u.beginPath();u.ellipse(y,c,g,g,0,0,Math.PI*2);u.fill();u.fillStyle=e.getStyle();u.beginPath();u.ellipse(y,c,M,M,0,0,Math.PI*2);u.fill()}u.fillRect(h-n,c-s*.5,n,s);var w=new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(d),flatShading:true,transparent:true,alphaTest:.05,premultipliedAlpha:true,side:THREE.DoubleSide,depthTest:this.getDepthTest()});var E=new THREE.PlaneBufferGeometry(h*2,p*2);if(i){E.translate(h,0,0)}var T=new THREE.Mesh(E,w);T.userData.skipIt=true;T.userData.lineOffset=i?h*2-1:h-n*2;var b=new THREE.Vector2(h*l/d.width,p*l/d.height);var _=T.geometry.attributes.uv.array;for(var S=0,D=_.length;S<D;S+=2){_[S]*=b.x;_[S+1]=1-(1-_[S+1])*b.y}return T};p.prototype.addLeaderLine=function(e,t,a,r,n,h,p){var d=this.getNode();if(p>0&&e.length<3){e.push(e[e.length-1].clone())}var u=a.userData.lineStyle||{};u.width=u.width||1;u.haloWidth=u.haloWidth||0;u.endCapStyle=u.endCapStyle||0;var y=u.endCapStyle||e.length>2?1:0;var c=(y&&(r!==o.None||u.endCapStyle===0)?1:0)|(y&&(n!==o.None||u.endCapStyle===0)?2:0);var x=new i;x.setVertices(e);var f;if(u.haloWidth>0){var m=new l({color:16777215,lineColor:16777215,linewidth:u.width*(u.haloWidth*2+1),dashCapStyle:u.endCapStyle,segmentCapStyle:y,trimStyle:c,transparent:true,depthTest:this.getDepthTest()});f=new s(x,m);f.userData.skipIt=true;f.userData.targetNode=t;f.matrixAutoUpdate=false;f.renderOrder=this.getRenderOrder();f.isHaloMesh=true;d.add(f);this._lines.push(f)}var v=new l({color:16777215,lineColor:a.color,linewidth:u.width,dashCapStyle:u.endCapStyle,segmentCapStyle:y,trimStyle:c,dashPattern:u.dashPattern||[],dashScale:u.dashPatternScale||1,transparent:true,depthTest:this.getDepthTest()});var g=new s(x,v);g.userData.skipIt=true;g.userData.targetNode=t;g.userData.extensionLength=p;g.userData.haloMesh=f;g.matrixAutoUpdate=false;g.renderOrder=this.getRenderOrder();d.add(g);this._lines.push(g);if(r!==o.None){var M=this._createMarkMesh(a.color,u,r,h);M.userData.targetVertex=x.vertices[0].clone();M.matrixAutoUpdate=false;M.renderOrder=this.getRenderOrder();g.userData.startPointMesh=M;d.add(M);this._heads.push(M)}return g};return p});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ContentDeliveryService", ["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../threejs/SceneBuilder","./Material","../thirdparty/three","../getResourceBundle","../ObjectType"],function(e,t,r,a,n,o,i,s){"use strict";var c=t.extend("sap.ui.vk.threejs.ContentDeliveryService",{metadata:{library:"sap.ui.vk",properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geometriesBatchSize:{type:"int",defaultValue:128},geometriesMaxBatchDataSize:{type:"int",defaultValue:1048576},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:1048576},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0},skipLowLODRendering:{type:"boolean",defaultValue:false}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},constructor:function(e,n){this._loader=new r;this._loader.setSceneBuilder(new a);t.apply(this,arguments);this._transientSceneMap=new Map;this._currentNodeHierarchy=null}});c.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests()};c.prototype.setMaxActiveRequests=function(e){this._loader.setMaxActiveRequests(e);return this};c.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength()};c.prototype.setMaxUrlLength=function(e){this._loader.setMaxUrlLength(e);return this};c.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize()};c.prototype.setMeshesBatchSize=function(e){this._loader.setMeshesBatchSize(e);return this};c.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize()};c.prototype.setMaterialsBatchSize=function(e){this._loader.setMaterialsBatchSize(e);return this};c.prototype.getGeometriesBatchSize=function(){return this._loader.getGeometriesBatchSize()};c.prototype.setGeometriesBatchSize=function(e){this._loader.setGeometriesBatchSize(e);return this};c.prototype.getGeometriesMaxBatchDataSize=function(){return this._loader.getGeometriesMaxBatchDataSize()};c.prototype.setGeometriesMaxBatchDataSize=function(e){this._loader.setGeometriesMaxBatchDataSize(e);return this};c.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize()};c.prototype.setGeomMeshesBatchSize=function(e){this._loader.setGeomMeshesBatchSize(e);return this};c.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize()};c.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._loader.setGeomMeshesMaxBatchDataSize(e);return this};c.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize()};c.prototype.setAnnotationsBatchSize=function(e){this._loader.setAnnotationsBatchSize(e);return this};c.prototype.getTracksBatchSize=function(){return this._loader.getTracksBatchSize()};c.prototype.setTracksBatchSize=function(e){this._loader.setTracksBatchSize(e);return this};c.prototype.getSequencesBatchSize=function(){return this._loader.getSequencesBatchSize()};c.prototype.setSequencesBatchSize=function(e){this._loader.setSequencesBatchSize(e);return this};c.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold()};c.prototype.setVoxelThreshold=function(e){this._loader.setVoxelThreshold(e);return this};c.prototype.getSkipLowLODRendering=function(){return this._loader.getSkipLowLODRendering()};c.prototype.setSkipLowLODRendering=function(e){this._loader.setSkipLowLODRendering(e);return this};c.prototype.initUrl=function(e,t,a){var n=this;function o(){n.fireSceneUpdated({})}function i(){var e;if(n._loader&&n._loader.currentSceneInfo){var t=n._loader.getContext(n._loader.currentSceneInfo.id);if(t){e=t.currentViewGroupId}}n.fireViewGroupUpdated({currentViewGroupId:e})}if(!this._loader.running()||this._loader.getUrl()!==e){if(this._loader.running()){var s=this._loader.sceneBuilder;this._loader.dispose();this._loader=new r;this._loader.setSceneBuilder(s)}this._loader.onErrorCallbacks.attach(this._reportError.bind(n));this._loader.onMaterialFinishedCallbacks.attach(o);this._loader.onImageFinishedCallbacks.attach(o);this._loader.onSetGeometryCallbacks.attach(o);this._loader.onViewGroupUpdatedCallbacks.attach(i);this._loader.setUrl(e);this._loader.setCorrelationId(a?a:THREE.Math.generateUUID().toLowerCase());return this._loader.run()}else if(!t){this._loader.cleanup()}return Promise.resolve("Loader is ready")};c.prototype._reportError=function(e){this.fireErrorReported(e)};c.prototype._createLoadParam=function(t,r,a,n){var o=this;var i;var s=false;var c;if(this._currentNodeHierarchy){c=this._currentNodeHierarchy.getScene()}var d={root:a,vkScene:c,activateView:n.getActivateView(),enableLogger:n.getEnableLogger(),includeAnimation:n.getIncludeAnimation(),includeBackground:n.getIncludeBackground(),includeHidden:n.getIncludeHidden(),includeParametric:n.getIncludeParametric(),includeUsageId:n.getIncludeUsageId(),metadataFilter:n.getMetadataFilter(),pushPMI:n.getPushPMI(),pushViewGroups:n.getPushViewGroups(),useSecureConnection:n.getUseSecureConnection(),onActiveCamera:function(e){var t=false;var r=o._loader.getContext(n.getVeid());if(r&&r.phase<2){i=e;t=true}if(!t){o.fireCameraChanged({sceneId:n.getVeid(),camera:e})}},onInitialSceneFinished:function(e){s=true;t({node:a,camera:i,contentResource:n,initialView:e,annotations:o.getSceneBuilder()._annotations,loader:o})},onSceneCompleted:function(){o.fireSceneCompleted({sceneId:n.getVeid()})},onLoadingFinished:function(){var e,t;if(o._loader&&o._loader.currentSceneInfo){var r=o._loader.getContext(o._loader.currentSceneInfo.id);if(r){e=r.currentViewId;t=r.currentViewGroupId}}o.fireLoadingFinished({currentViewId:e,currentViewGroupId:t})},onContentChangesProgress:function(e){o.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})},onInitialViewCompleted:function(){o.fireInitialViewCompleted({sceneId:n.getVeid()})}};var u=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var a;if(t.getParameter("errorText")){a=t.getParameter("errorText")}else if(t.getParameter("error")){a=t.getParameter("error")}else if(t.getParameter("reason")){a=t.getParameter("reason")}else{a="failed to load: unknown reason"}if(s){var n=t.getParameter("error");if(n&&n===4){o.initUrl(this._loader.getUrl(),true)}}else{o.detachErrorReported(u);if(t.getParameter("events")){a=a+"\n"+JSON.stringify(t.getParameter("events"))}r(a)}};o.attachErrorReported(u);return d};c.prototype.load=function(e,t,r){var a=this;var n=t.getNodeProxy();if(n){this._currentNodeHierarchy=n.getNodeHierarchy()}return new Promise(function(n,o){if(!t.getSource()||!t.getVeid()){o(i().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return}a.initUrl(t.getSource(),true);var s=a._createLoadParam(n,o,e,t);if(a._loader){a._loader.request(t.getVeid(),s,r)}})};c.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder()}return null};c.prototype.decrementResourceCountersForDeletedTreeNode=function(e){var t=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(t,e)};c.prototype.loadTransientScene=function(e,t,r){var a=this;return new Promise(function(n,o){if(!e||!t){o(i().getText("CONTENTDELIVERYSERVICE_MSG_INVALIDARGUMENTS"));return}if(a._transientSceneMap.has(e)){var s=a._transientSceneMap.get(e).clone();t.add(s);n({nodeRef:s});return}if(!a._loader){o(i().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}var c=function(){a.detachLoadingFinished(c);if(a._transientSceneMap.get(e)){var r=a._transientSceneMap.get(e).clone();t.add(r);n({nodeRef:r})}};if(a._loader.contextMap.has(e)){a.attachLoadingFinished(c);return}var d=new THREE.Object3D;d.name="transient";d.userData.currentSceneId=a.getSceneBuilder()._currentSceneId;var u=function(){var r=a._loader.getContext(e);r.onSceneCompletedCallbacks.detach(u);d.userData.entityId=r.defaultRootEntityId;a._transientSceneMap.set(e,d);var o=d.clone();t.add(o);n({nodeRef:o})};var l={root:d,onSceneCompleted:u,useSecureConnection:r};a._loader.request(e,l)})};c.prototype.update=function(e,t,r){var a=this;return new Promise(function(n,o){if(!a._loader){o(i().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}a._loader.update(e,t,r).then(function(e){if(a._currentNodeHierarchy){for(var t=0;t<e.replacedNodeRefs.length;t++){a._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:e.replacedNodeRefs[t],ReplacementNodeRef:e.replacementNodeRefs[t],ReplacedNodeId:e.replacedNodeRefs[t],ReplacementNodeId:e.replacementNodeRefs[t]})}}n({sceneVeId:e.sceneVeId,sids:e.sidArray})}).catch(function(e){return o(e)})})};c.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null}this._transientSceneMap=null};c.prototype.loadView=function(t,r,a,n){if(typeof a==="undefined"){a="static"}var o=this;return this._loader.requestView(t,a,r,null,n).then(function(e){if(o._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){o._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};c.prototype.updatePlaybacks=function(t,r,a){var n=this;return this._loader.requestView(t,"static",r,a,true).then(function(e){if(n._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){n._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}n.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};c.prototype.loadViewGroup=function(t,r,a){var n=this;return this._loader.requestViewGroup(t,r,a).then(function(e){n.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};c.prototype.assignMaterialToNodes=function(t,r,a,o){var i=this;return this._loader.requestMaterial(t,r).then(function(e){function r(e,t,a){if(!t){return}if(t.userData.markedForNotAssigningMaterial){delete t.userData.markedForNotAssigningMaterial;return}if(i._currentNodeHierarchy){var o=i._currentNodeHierarchy.createNodeProxy(t);var c=new n;c.setMaterialRef(e);o.assignMaterial(c);i._currentNodeHierarchy.destroyNodeProxy(o)}if(a){t.children.forEach(function(t){if(!t||t.userData.objectType===s.PMI||t.userData.objectType===s.Hotspot){return}r(e,t,a)})}}if(!o){for(var c=0;c<a.length;c++){r(e,a[c],true)}}else{for(var d=0;d<a.length;d++){a[d].userData.markedForNotAssigningMaterial=true}var u=i._loader.getContext(t);var l=u.root;r(e,l,true)}i.fireSceneUpdated({});return true}).catch(function(t){e.error(t);return false})};c.prototype.replaceMaterialOnNodes=function(t,r,a,n){var o=this;return Promise.all([this._loader.requestMaterial(t,r),this._loader.requestMaterial(t,a)]).then(function(e){var r=e[0];var a=e[1];function i(e,t,r){if(!e){return}if(o._currentNodeHierarchy){var a=o._currentNodeHierarchy.createNodeProxy(e);a.replaceMaterial(t,r);o._currentNodeHierarchy.destroyNodeProxy(a)}e.children.forEach(function(e){i(e,t,r)})}if(!n){var s=o._loader.getContext(t);i(s.root,r,a)}else if(Array.isArray(n)){n.forEach(function(e){i(e,r,a)})}else{i([n],r,a)}o.fireSceneUpdated({});return true}).catch(function(t){e.error(t);return false})};c.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true}else{return false}};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ContentManager", ["sap/base/Log","../thirdparty/three","../ContentManager","./Scene","../TransformationMatrix","./PerspectiveCamera","./OrthographicCamera","../Messages","../getResourceBundle","./ContentDeliveryService","./Viewport","./ViewStateManager"],function(e,t,r,a,o,n,i,s,d,l){"use strict";var u=r.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});var c=u.getMetadata().getParent().getClass().prototype;u.prototype.init=function(){if(c.init){c.init.call(this)}};u.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null}if(this.defaultMataiLoader){this.defaultMataiLoader.destroy();this.defaultMataiLoader=null}if(c.exit){c.exit.call(this)}};u.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};u.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};function h(e){if(e&&e.isMesh){e.castShadow=true;e.receiveShadow=false}if(e&&e.children){for(var t=0;t<e.children.length;t++){h(e.children[t])}}}function f(e,t){if(e){var r=new THREE.Group;e.add(r);r.name="DefaultLights";r.private=true;var a=(new THREE.Box3).setFromObject(e);var o=new THREE.Vector3;a.getSize(o);var n=o.length();var i=new THREE.PointLight;i.color.setRGB(.72,.72,.81);a.getCenter(i.position);i.visible=true;i.private=true;r.add(i);var s=[new THREE.Color(.2,.2,.2),new THREE.Color(.32,.32,.36),new THREE.Color(.36,.36,.36)];var d=[new THREE.Vector3(2,1.5,.5),new THREE.Vector3(-2,-1.1,2.5),new THREE.Vector3(-.04,-.01,-2)];for(var l=0,u=s.length;l<u;l++){var c=new THREE.DirectionalLight;c.color.copy(s[l]);c.position.copy(d[l]);c.private=true;r.add(c)}if(t){h(e);var f=new THREE.DirectionalLight;f.color.setRGB(.5,.5,.5);f.position.set(0,1,0);f.castShadow=true;f.shadow.mapSize.width=512;f.shadow.mapSize.height=512;var g=2e3;f.shadow.camera.left=-g;f.shadow.camera.right=g;f.shadow.camera.top=g;f.shadow.camera.bottom=-g;f.shadow.camera.far=3500;f.shadow.bias=-1e-4;f.private=true;r.add(f);var p=new THREE.PlaneBufferGeometry(a.getSize().x,a.getSize().z);var C=new THREE.ShadowMaterial;C.opacity=.2;var v=new THREE.Mesh(p,C);v.rotation.x=-Math.PI/2;v.position.x=a.getCenter().x;v.position.y=a.min.y-n*.1;v.position.z=a.getCenter().z;e.add(v);v.receiveShadow=true}}}u.prototype.loadContent=function(t,r){var o=this;var n=function(){o.fireContentChangesStarted();var t=new THREE.Scene,n=new a(t);o._loadContentResources(n,r).then(function(t){e.info("Content loading resolved");if(t&&t.length>0&&t[0].initialView){n.setInitialView(t[0].initialView)}for(var r=0;r<t.length;r++){if(t[r].camera){n.camera=t[r].camera;break}}if(t.length>0){var a=t[0];n.backgroundTopColor=a.backgroundTopColor;n.backgroundBottomColor=a.backgroundBottomColor;n.renderMode=a.renderMode;n.upAxis=a.upAxis;n.annotations=a.annotations}for(var i=0;i<t.length;i++){if(t[i].loader){n.loaders=n.loaders||[];n.loaders.push(t[i].loader)}if(t[i].builder){n.builders=n.builders||[];n.builders.push(t[i].builder)}}if(n.loaders){o._initSceneWithCDSLoaderIfExists(n,n.loaders)}f(n.getSceneRef(),false);o.fireContentChangesFinished({content:n})},function(t){e.info("Content loading rejected:",t);var r;if(typeof t==="string"){r=t}else if(t.errorText){r=t.errorText}else if(t.message){r=t.message}r=r||d().getText(s.VIT37.summary);e.error(d().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),r);o.fireContentChangesFinished({content:null,failureReason:[{error:t,errorMessage:r}]})})};n();return this};u.prototype._findLoader=function(e){if(e._contentManagerResolver&&e._contentManagerResolver.settings&&e._contentManagerResolver.settings.loader){return Promise.resolve(e._contentManagerResolver.settings.loader)}if(e.getSource()){var t=e.getSourceType().toLowerCase();var r=this;switch(t){case"stream":{if(this.defaultCdsLoader==null){return new Promise(function(e){var t="sap/ui/vk/threejs/ContentDeliveryService";sap.ui.require([t],function(t){e(r.defaultCdsLoader=new t({authorizationHandler:r._authorizationHandler}))})})}return Promise.resolve(this.defaultCdsLoader)}case"vds4":{if(this.defaultMataiLoader==null){return new Promise(function(e){var t="sap/ui/vk/matai/MataiLoader";sap.ui.require([t],function(t){e(r.defaultMataiLoader=new t)})})}return Promise.resolve(this.defaultMataiLoader)}default:break}}return Promise.resolve(null)};u.prototype._loadContentResources=function(e,t){var r=[];t.forEach(function t(a,n){var i=new THREE.Group;i.name=n.getName();i.sourceId=n.getSourceId();n._shadowContentResource={nodeProxy:e.getDefaultNodeHierarchy().createNodeProxy(i)};var s=n.getLocalMatrix();if(s){i.applyMatrix4((new THREE.Matrix4).fromArray(o.convertTo4x4(s)))}a.add(i);var d=this;r.push(this._findLoader(n).then(function(e){if(e){if(e.attachContentChangesProgress){e.attachContentChangesProgress(d._handleContentChangesProgress,d)}if(e.attachContentLoadingFinished){e.attachContentLoadingFinished(d._handleContentLoadingFinished,d)}}if(typeof e==="function"){return e(i,n,d._authorizationHandler,d._retryCount)}else if(e&&e.load){return e.load(i,n,d._authorizationHandler,d._retryCount)}else{return Promise.resolve({node:i,contentResource:n})}}));n.getContentResources().forEach(t.bind(this,i))}.bind(this,e.getSceneRef()));return Promise.all(r)};u.prototype._initSceneWithCDSLoaderIfExists=function(e,t){if(t){var r;for(var a=0;a<t.length;a++){if(t[a]instanceof l){r=t[a].getSceneBuilder();break}}if(r){e.setSceneBuilder(r);e.getDefaultNodeHierarchy().attachNodeRemoving(function(e){var t=e.getParameter("nodeRef");if(t.userData.treeNode&&t.userData.treeNode.sid){r.decrementResourceCountersForDeletedTreeNode(t.userData.treeNode.sid)}});return true}}return false};u.prototype.destroyContent=function(e){if(e){e.destroy()}if(e.loaders&&Array.isArray(e.loaders)&&e.loaders.length>0){if(e.loaders[0]._loader&&e.loaders[0]._loader.sceneBuilder){e.loaders[0]._loader.removeContext(e.loaders[0]._loader.currentSceneInfo.id);e.loaders[0]._loader.sceneBuilder.cleanup()}if(e.loaders[0].detachContentChangesProgress){e.loaders[0].detachContentChangesProgress(this._handleContentChangesProgress,this)}if(e.loaders[0].detachContentLoadingFinished){e.loaders[0].detachContentLoadingFinished(this._handleContentLoadingFinished,this)}}else if(e.builders&&Array.isArray(e.builders)){e.builders.forEach(function(e){if(e){e.cleanup()}})}return this};u.prototype.createOrthographicCamera=function(){return new i};u.prototype.createPerspectiveCamera=function(){return new n};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/DetailView", ["../thirdparty/three","sap/ui/base/ManagedObject","../thirdparty/html2canvas","../DetailViewType","../DetailViewShape","./OrthographicCamera","./PerspectiveCamera"],function(e,t,r,i,a,o,n){"use strict";var s=t.extend("sap.ui.vk.threejs.DetailView",{metadata:{library:"sap.ui.vk",properties:{name:{type:"string",defaultValue:""},camera:{type:"any",defaultValue:null},type:{type:"sap.ui.vk.DetailViewType",defaultValue:i.DetailView},shape:{type:"sap.ui.vk.DetailViewShape",defaultValue:a.Box},borderWidth:{type:"float",defaultValue:2},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#000"},origin:{type:"any",defaultValue:new THREE.Vector2(0,0)},size:{type:"any",defaultValue:new THREE.Vector2(.5,.5)},attachmentPoint:{type:"any",defaultValue:null},metadata:{type:"any",defaultValue:{}},veId:{type:"any",defaultValue:{}},visibleNodes:{type:"any",defaultValue:null},targetNodes:{type:"any",defaultValue:null}}}});s.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._backgroundColor=new THREE.Color;this._node=new THREE.Group;var e=new THREE.MeshBasicMaterial({depthTest:false});this._line=new THREE.Mesh(new THREE.BufferGeometry,e);this._line.renderOrder=0;this._node.add(this._line);var r=new THREE.BufferGeometry;r.setIndex([0,1,2]);var i=new THREE.MeshBasicMaterial({color:this._backgroundColor,depthTest:false});this._triangle=new THREE.Mesh(r,i);this._triangle.renderOrder=1;this._node.add(this._triangle);this._billboard=new THREE.Mesh(new THREE.BufferGeometry,new THREE.MeshBasicMaterial({depthTest:false}));this._billboard.renderOrder=2;this._node.add(this._billboard);this._border=new THREE.Mesh(new THREE.BufferGeometry,e);this._border.renderOrder=3;this._node.add(this._border)};s.prototype.setCamera=function(e){if(e instanceof n||e instanceof o){this.setProperty("camera",e,true)}return this};s.prototype.setShape=function(e){this.setProperty("shape",e,true);return this};s.prototype.setBackgroundColor=function(e){this.setProperty("backgroundColor",e,true);this._backgroundColor.setStyle(e);this._triangle.material.color.copy(this._backgroundColor);return this};s.prototype.setBorderColor=function(e){this.setProperty("borderColor",e,true);this._border.material.map=null;return this};s.prototype.setBorderWidth=function(e){this.setProperty("borderWidth",e,true);this._border.material.map=null;return this};s.prototype.setOrigin=function(e){if(e instanceof THREE.Vector2){this.setProperty("origin",e,true)}return this};s.prototype.setSize=function(e){if(e instanceof THREE.Vector2){this.setProperty("size",e,true)}return this};var l=-.5,h=1.5,u=new THREE.Vector4,p=new THREE.Vector3,d=new THREE.Vector3,c=new THREE.Vector3,f=new THREE.Vector2,y=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Matrix4;function b(e,t){return Math.PI*(3*(e+t)-Math.sqrt((3*e+t)*(e+3*t)))}function _(e,t,r,i,a,o){var n=e[t],s=e[t+1],l=e[a],h=e[a+1],u=e[o],p=e[o+1],d=i-s,c=n-r;var f=((l-n)*d+(h-s)*c)/((l-u)*d+(h-p)*c);e[a]=l+(u-l)*f;e[a+1]=h+(p-h)*f}function g(e,t,r,i){f.set(e[r+1]-e[t+1],e[t]-e[r]).normalize().multiplyScalar(i);e[t]+=f.x;e[t+1]+=f.y;e[r]+=f.x;e[r+1]+=f.y}function m(e,t){var r=e.length;for(var i=0;i<6;i+=3){var a=i===0?t*l:t*h;var o=e[i],n=e[i+1];for(var s=i;s<r-6;s+=6){var u=e[s],p=e[s+1];e[s]=o;e[s+1]=n;o=e[s+6];n=e[s+7];g(e,s,s+6,a);if(s>i){_(e,s-6,u,p,s,s+6)}}}}s.prototype._createBoxViewport=function(e,t,r,i){var a=[-e,-t,0,e,-t,0,e,t,0,-e,t,0];var o=this._billboard.geometry;o.setIndex([0,1,2,0,2,3]);o.setAttribute("position",new THREE.Float32BufferAttribute(a,3));o.setAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,1,1,0,1],2));if(this._border.visible){var n=[],s;for(s=0;s<a.length;s+=3){var l=a[s],h=a[s+1];n.push(l,h,0,l,h,0)}n.push(n[0],n[1],0,n[0],n[1],0);m(n,this._borderWidth);s=n.length-6;n[0]=n[s];n[s+1]=n[1];n[3]=n[s+3];n[s+4]=n[4];this._createBorderGeometry(this._border.geometry,n)}};s.prototype._createCircleViewport=function(e,t,r,i){var a=[0,0,0],o=[.5,.5],n=[];var s=THREE.Math.clamp(Math.round(b(e,t)/24),32,256);var l=2*Math.PI/s;for(var u=0;u<s;u++){var p=u*l,d=Math.cos(p),c=Math.sin(p);a.push(d*e,c*t,0);o.push(d*.5+.5,c*.5+.5);n.push(0,u+1,u+1<s?u+2:1)}var y=this._billboard.geometry;y.setIndex(n);y.setAttribute("position",new THREE.Float32BufferAttribute(a,3));y.setAttribute("uv",new THREE.Float32BufferAttribute(o,2));var E=this._borderWidth*h;this._createCircleBorder(a,e,t,r&&f.set(r.x/(e+E),r.y/(t+E)).length()>1?r:null,i)};s.prototype._createCircleBorder=function(e,t,r,i,o){var n=this._borderWidth,s=[],u,p,d;if(i&&(o!==a.Circle&&o!==a.CircleLine)){s.push(i.x,i.y,0,i.x,i.y,0);var c=Math.PI*.05;var y=Math.atan2(i.y*t,i.x*r)+c;var E=e.length/3-3;c=2*(Math.PI-c)/E;for(u=0;u<=E;u++){var v=y+u*c;p=Math.cos(v)*t;d=Math.sin(v)*r;s.push(p,d,0,p,d,0)}var b=[i.x,i.y,0,s[6],s[7],0,s[s.length-3],s[s.length-2],0];s.push(i.x,i.y,0,i.x,i.y,0);m(s,n);u=s.length-6;var _=f.set(s[9],s[10]).sub(i).length();var g=f.set(s[9]-s[u-3],s[10]-s[u-2]).length()*.5;var T=i.length();T=1-n*2*_/(g*T);s[u+0]=s[0]=i.x*T;s[u+1]=s[1]=i.y*T;s[u+3]=s[3]=i.x;s[u+4]=s[4]=i.y;var x=this._triangle.geometry;T=(1+T)*.5;b[0]*=T;b[1]*=T;x.setAttribute("position",new THREE.Float32BufferAttribute(b,3));this._triangle.visible=true;this._triangle.material.color.set(o===a.SolidPointer||o===a.SolidArrow?this.getBorderColor():this._backgroundColor)}else{this._line.visible=this._line.visible&&i!==null;for(u=3;u<e.length;u+=3){p=e[u];d=e[u+1];s.push(p,d,0,p,d,0)}s.push(s[0],s[1],0,s[0],s[1],0);m(s,n);u=s.length-6;s[u]=s[0]=e[3]+n*l;s[u+3]=s[3]=e[3]+n*h;s[u+1]=s[1]=e[4];s[u+4]=s[4]=e[4]}this._createBorderGeometry(this._border.geometry,s)};s.prototype._createBorderGeometry=function(e,t){var r,i=t.length/3;var a=[];for(r=2;r<i;r+=2){a.push(r-1,r,r-2,r+1,r,r-1)}var o=[];var n=this._borderU;for(r=0;r<i;r+=2){o.push(0,.5,n,.5)}e.setIndex(a);e.setAttribute("position",new THREE.Float32BufferAttribute(t,3));e.setAttribute("uv",new THREE.Float32BufferAttribute(o,2))};s.prototype._createLine=function(e){var t=[0,0,0,0,0,0,e.x,e.y,0,e.x,e.y,0];g(t,0,6,-this._borderWidth);g(t,3,9,this._borderWidth);this._createBorderGeometry(this._line.geometry,t)};s.prototype._updateGeometry=function(e,t,r){var i=this.getShape(),o=this.getAttachmentPoint(),n=this.getOrigin();this._border.visible=i!==a.BoxNoOutline;this._line.visible=i===a.BoxLine||i===a.CircleLine;this._triangle.visible=false;if(o){u.copy(o).applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix);o=u.w>0?o:null;var s=u.x/u.w*t.x/t.y,l=u.y/u.w;c.set(s-n.x,l-n.y,0).multiplyScalar(t.y)}switch(i){default:case a.Box:case a.BoxLine:case a.BoxNoOutline:this._createBoxViewport(e.x,e.y,o?c:null,i);break;case a.Circle:case a.CircleLine:case a.CirclePointer:case a.CircleArrow:case a.CircleBubbles:case a.SolidPointer:case a.SolidArrow:this._createCircleViewport(e.x,e.y,o?c:null,i);break}if(this._line.visible){this._createLine(c)}};s.prototype._updateBorderTexture=function(e){var t=Math.round(this.getBorderWidth()*e);this._borderWidth=t+2;var r=THREE.Math.ceilPowerOfTwo(this._borderWidth);this._borderU=this._borderWidth/r;this._borderWidth/=e;var i=new ArrayBuffer(r*4);var a=new Uint32Array(i);var o=new THREE.Color(this.getBorderColor());o=o.r*255|o.g*255<<8|o.b*255<<16|4278190080;a.fill(o&16777215);for(var n=1;n<=t;n++){a[n]=o}var s=new THREE.DataTexture(new Uint8Array(i),r,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter);s.needsUpdate=true;this._border.material.map=s;this._border.material.needsUpdate=true;this._line.material=this._border.material};function T(e){var t=e.elements;var r=t[15]===1;var i=2/t[0];var a=2/t[5];var o,n;if(r){o=-t[12]*i;n=-t[13]*a}else{o=t[8]*i;n=t[9]*a}var s=(i+o)*.5;var l=o-s;var h=(a+n)*.5;var u=n-h;return{left:l,top:h,right:s,bottom:u}}function x(e,t){var r=e.elements;var i=r[15]===1;r[0]=2/(t.right-t.left);r[5]=2/(t.top-t.bottom);if(i){r[12]=-(t.right+t.left)/(t.right-t.left);r[13]=-(t.top+t.bottom)/(t.top-t.bottom)}else{r[8]=(t.right+t.left)/(t.right-t.left);r[9]=(t.top+t.bottom)/(t.top-t.bottom)}}function w(e,t,r,i){var a=r.x/i.x;var o=r.y/i.y;u.copy(t).applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix);var n=(u.x/u.w-a)*.5+.5;var s=(u.y/u.w-o)*.5+.5;var l=T(e.projectionMatrix);var h={};h.left=THREE.Math.lerp(l.left,l.right,n);h.right=THREE.Math.lerp(l.left,l.right,n+a);h.top=THREE.Math.lerp(l.top,l.bottom,1-s-o);h.bottom=THREE.Math.lerp(l.top,l.bottom,1-s);x(e.projectionMatrix,h)}var R=new THREE.Vector2;s.prototype._render=function(e,t,r,a,o){e.getSize(R);var n=e.getPixelRatio(),s=this.getOrigin(),l=this._node,h=l.position;if(!this._border.material.map){this._updateBorderTexture(n)}y.copy(this.getSize()).multiplyScalar(R.y*.5);y.set(Math.round(y.x)<<1,Math.round(y.y)<<1);h.set(s.x*R.y/R.x,s.y,0).unproject(t);u.copy(h).applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);var c=(u.x/u.w*.5+.5)*R.x,f=(u.y/u.w*.5+.5)*R.y;var b=u.w/(R.x*t.projectionMatrix.elements[0]);l.scale.setScalar(b);p.setFromMatrixColumn(t.matrixWorld,0).multiplyScalar(b*2*(Math.round(c)-c));d.setFromMatrixColumn(t.matrixWorld,1).multiplyScalar(b*2*(Math.round(f)-f));h.add(p).add(d);l.quaternion.copy(t.quaternion);l.updateMatrix();l.updateMatrixWorld();this._updateGeometry(y,R,t);E.copy(y).multiplyScalar(n);if(!this._renderTarget||this._renderTarget.width!==E.x||this._renderTarget.height!==E.y){this._renderTarget=new THREE.WebGLRenderTarget(E.x,E.y,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});this._billboard.material.map=this._renderTarget.texture;this._billboard.material.needsUpdate=true}var _;if(this.getType()===i.Cutaway){_=t;v.copy(_.projectionMatrix);w(_,h,y,R)}else{_=this.getCamera();_.adjustClipPlanes(a);_.update(y.x,y.y);_=_.getCameraRef()}var g=new Set;r.children.forEach(function(t){if(t.userData._vkDynamicObjects){t.userData._vkDynamicObjects.forEach(function(t){if(t.parent){if(t.userData.is2D||t.isBillboard){if(t.visible){g.add(t)}t.visible=false}else{t._vkUpdate(e,_,y)}}})}});if(o){o.position.copy(_.position);o.updateMatrix();o.updateMatrixWorld()}var m=this.getTargetNodes();var T=this.getTargetNodes();if(Array.isArray(T)){m.forEach(function(e){e.userData._visible=e.visible;e.visible=true})}if(Array.isArray(T)){T.forEach(function(e){e.userData._visible=e.visible;e.visible=false})}e.setClearColor(this._backgroundColor,1);e.setRenderTarget(this._renderTarget);e.clear();e.render(r,_);if(_===t){t.projectionMatrix.copy(v)}if(Array.isArray(m)){m.forEach(function(e){e.visible=e.userData._visible})}if(Array.isArray(T)){T.forEach(function(e){e.visible=e.userData._visible})}e.setRenderTarget(null);e.render(this._node,t);r.children.forEach(function(e){if(e.userData._vkDynamicObjects){e.userData._vkDynamicObjects.forEach(function(e){if(e.parent&&(e.userData.is2D||e.isBillboard)){e.visible=g.has(e)}})}})};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/HighlightPlayer", ["sap/ui/base/Object","../thirdparty/three","../HighlightDisplayState"],function(t,e,i){"use strict";var s=t.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=i.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map}});s.prototype.reset=function(t,e){this.stop();this._highlightsNodesMap.clear();this._state=i.stopped;if(t&&e){var s=t.getHighlightIdNodesMap();var a=this;s.forEach(function(t,i){var s=e.getHighlight(i);a.addHighlights(s,t)})}return this};s.prototype.setViewStateManager=function(t){this._viewStateManager=t};s.prototype.addHighlights=function(t,e){if(t&&e&&e.length){this._highlightsNodesMap.set(t,{nodes:e})}};s.prototype.start=function(t){if(this._state===i.pausing){this._startTime=t-this._timeElapsed}else{this._startTime=t;this._timeElapsed=0}this._state=i.playing;var e=this._viewStateManager;this._highlightsNodesMap.forEach(function(t,i){var s=[];t.nodes.forEach(function(t){while(t){if(!t.visible){e.setVisibilityState(t,true,false);s.push(t)}t=t.parent}});t.hiddenNodes=s.length>0?s:undefined})};s.prototype.play=function(t){if(this._state!==i.playing){return false}this._timeElapsed=t-this._startTime;var e=this;var s=[];this._highlightsNodesMap.forEach(function(t,i){var a=i.getColour(e._timeElapsed/1e3);var h=t.nodes,n;if(a!==undefined){for(n=0;n<h.length;n++){h[n]._vkSetHighlightColor(a.colour)}}var o=i.getOpacity(e._timeElapsed/1e3);if(o!==undefined){for(n=0;n<h.length;n++){h[n]._vkSetOpacity(o.opacity)}if(o.isCompleted&&i.isFadeOut()&&t.hiddenNodes!==undefined){e._viewStateManager.setVisibilityState(t.hiddenNodes,false,false)}}if((a===undefined||a.isCompleted)&&(o===undefined||o.isCompleted)){s.push(i)}});s.forEach(function(t){e._highlightsNodesMap.delete(t)});if(this._highlightsNodesMap.size===0){this._state=i.stopped;return false}return true};s.prototype.stop=function(t){this._timeElapsed=0;this._startTime=0;var e=this;this._highlightsNodesMap.forEach(function(t,i){var s=t.nodes;for(var a=0;a<s.length;a++){var h=s[a];h._vkSetHighlightColor(undefined);h._vkSetOpacity(undefined)}if(i.isFadeOut()&&s.hiddenNodes!=undefined){e._viewStateManager.setVisibilityState(s.hiddenNodes,false,false)}});this._state=i.stopped;return this};s.prototype.pause=function(t){if(this._state===i.stopped){return this}this._timeElapsed=t-this._startTime;this._state=i.pausing;return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/HitTester", ["sap/base/Log","../thirdparty/three"],function(e,r){"use strict";var a=function(){this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._depthMaterial=new THREE.ShaderMaterial({vertexShader:["#include <clipping_planes_pars_vertex>","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\t#include <clipping_planes_vertex>","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","void main() {","\t#include <clipping_planes_fragment>","\thighp vec4 value = vec4(fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * gl_FragCoord.z));","\tvalue.xyz -= value.yzw * (1.0 / 255.0);","\tgl_FragColor  = value;","}"].join("\n"),side:THREE.DoubleSide,clipping:true});this._renderTarget=new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter});this._renderTarget.texture.generateMipmaps=false;this._renderTarget.depthBuffer=true};var t;var i=new THREE.Matrix4;var n=new THREE.Frustum;var l=new THREE.Matrix4;var o=new THREE.Vector2;var s=new THREE.Raycaster;var u=new THREE.Ray;var c=new THREE.Sphere;var v=[];var f=new Uint8Array(4);var p=new THREE.Vector3;function h(e){var r=e.parent;while(r){if(r.userData.closed){e=r}r=r.parent}while(e.parent&&e.userData.skipIt){e=e.parent}return e}a.prototype.hitTest=function(e,r,a,d,g,m,E,T,x){if(!t||t.constructor!==E.constructor){t=new E.constructor}t.copy(E);var y=E.view;if(y){var M=y.width/a;var _=y.height/d;t.setViewOffset(y.fullWidth,y.fullHeight,y.offsetX+(e-.5)*M,y.offsetY+(r-.5)*_,M,_)}else{t.setViewOffset(a,d,e-.5,r-.5,1,1)}t.updateMatrixWorld();t.updateProjectionMatrix();i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);n.setFromProjectionMatrix(i);s.setFromCamera(o.set(0,0),t);var R=g.getContext();var w=Math.min(R.getParameter(R.RED_BITS),8);var b=Math.min(R.getParameter(R.GREEN_BITS),8);var C=Math.min(R.getParameter(R.BLUE_BITS),8);var H=w+b;var S=(1<<w)-1;var j=(1<<b)-1;var P=(1<<C)-1;var B=1/S;var F=1/j;var D=1/P;var I=this._maskMaterial;var O=g.getClearColor().clone();var W=g.getClearAlpha();var V=g.autoClear;g.setRenderTarget(this._renderTarget);g.clippingPlanes=T||[];g.autoClear=false;g.setClearColor(0,0);g.clear(true,true,false);var k=I.color;var z=0;v.length=0;var G=x&&x.ignoreUnderlay?null:[];var L=[];var N=x&&x.ignoreOverlay?null:[];function U(e,r){if(!e.visible){return}r=r||e.userData.renderStage;var a=e.geometry;if(a&&e.material&&n.intersectsObject(e)){var t=e.matrixWorld;if(a.boundingSphere==null){a.computeBoundingSphere()}c.copy(a.boundingSphere);c.applyMatrix4(t);if(s.ray.intersectsSphere(c)){l.getInverse(t);u.copy(s.ray).applyMatrix4(l);if(a.boundingBox==null||u.intersectsBox(a.boundingBox)){if(!r){L.push(e)}else if(r<0){if(G){G.push(e)}}else if(N){N.push(e)}}}}var i=e.children;for(var o=0,v=i.length;o<v;o++){U(i[o],r)}}U(m);function A(e){z+=1;v.push(e);k.setRGB((z&S)*B,(z>>w&j)*F,(z>>H&P)*D);var r=e.material;e.material=I;g.render(e,t);e.material=r}if(G!=null&&G.length>0){G.forEach(A);g.clearDepth()}L.forEach(A);if(N!=null&&N.length>0){g.clearDepth();N.forEach(A)}g.readRenderTargetPixels(this._renderTarget,0,0,1,1,f);z=(f[0]>>8-w)+(f[1]>>8-b<<w)+(f[2]>>8-C<<H);var X=z>0?v[z-1]:null;var Y;if(X){var q=X.material;X.material=this._depthMaterial;g.clear(true,true,false);g.render(X,t);X.material=q;g.readRenderTargetPixels(this._renderTarget,0,0,1,1,f);Y=(f[0]+(f[1]+(f[2]+f[3]/255)/255)/255)/255*2-1;p.set(0,0,Y).applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}g.setRenderTarget(null);g.clippingPlanes=[];g.setClearColor(O,W);g.autoClear=V;return X?{distance:s.ray.origin.distanceTo(p),point:p,object:h(X)}:null};a.prototype.hitTestPrecise=function(e,r,a,t,i,n,l){s.setFromCamera(o.set(e/a*2-1,r/t*-2+1),n);if(l&&l.length>0){for(var u in l){var c=l[u];var v=c.distanceToPoint(s.ray.origin),f=-v/c.normal.dot(s.ray.direction);if(f>0){if(v<0){s.near=Math.max(s.near,f)}else{s.far=Math.min(s.far,f)}}else if(v<0){return null}}}var p=s.intersectObjects(i.children,true);if(l&&l.length>0){s.near=0;s.far=Infinity}if(p){for(var d in p){var g=p[d];var m=h(g.object);if(m.visible&&!m.isBillboard&&!m.isDetailView){g.object=m;return g}}}return null};a.prototype.hitTestPoint=function(e,r,a,t,i,n,l){s.setFromCamera(o.set(e/a*2-1,r/t*-2+1),n);if(l&&l.length>0){for(var u in l){var c=l[u];var v=c.distanceToPoint(s.ray.origin),f=-v/c.normal.dot(s.ray.direction);if(f>0){if(v<0){s.near=Math.max(s.near,f)}else{s.far=Math.min(s.far,f)}}else if(v<0){return null}}}var p=s.intersectObjects(i.children,true);if(l&&l.length>0){s.near=0;s.far=Infinity}return p.length===1?p[0].point:null};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/MarchingCubes", [],function(){"use strict";var a=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);var r=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];var v=function(a,r,v,o,e){var f;var i=[0,0,0];if(Math.abs(a-o)<1e-5){return r}if(Math.abs(a-e)<1e-5){return v}if(Math.abs(o-e)<1e-5){return r}f=(a-o)/(e-o);i[0]=r[0]+f*(v[0]-r[0]);i[1]=r[1]+f*(v[1]-r[1]);i[2]=r[2]+f*(v[2]-r[2]);return i};var o=function(){};var e=[[],[],[],[],[],[],[],[],[],[],[],[]];var f=function(o){var f=.75;var i=0;if(o.val[0]>f){i|=1}if(o.val[1]>f){i|=2}if(o.val[2]>f){i|=4}if(o.val[3]>f){i|=8}if(o.val[4]>f){i|=16}if(o.val[5]>f){i|=32}if(o.val[6]>f){i|=64}if(o.val[7]>f){i|=128}if(a[i]==0){return[]}if(a[i]&1){e[0]=v(f,o.pos[0],o.pos[1],o.val[0],o.val[1])}if(a[i]&2){e[1]=v(f,o.pos[1],o.pos[2],o.val[1],o.val[2])}if(a[i]&4){e[2]=v(f,o.pos[2],o.pos[3],o.val[2],o.val[3])}if(a[i]&8){e[3]=v(f,o.pos[3],o.pos[0],o.val[3],o.val[0])}if(a[i]&16){e[4]=v(f,o.pos[4],o.pos[5],o.val[4],o.val[5])}if(a[i]&32){e[5]=v(f,o.pos[5],o.pos[6],o.val[5],o.val[6])}if(a[i]&64){e[6]=v(f,o.pos[6],o.pos[7],o.val[6],o.val[7])}if(a[i]&128){e[7]=v(f,o.pos[7],o.pos[4],o.val[7],o.val[4])}if(a[i]&256){e[8]=v(f,o.pos[0],o.pos[4],o.val[0],o.val[4])}if(a[i]&512){e[9]=v(f,o.pos[1],o.pos[5],o.val[1],o.val[5])}if(a[i]&1024){e[10]=v(f,o.pos[2],o.pos[6],o.val[2],o.val[6])}if(a[i]&2048){e[11]=v(f,o.pos[3],o.pos[7],o.val[3],o.val[7])}var s=[];for(var t=0;t<r[i].length;t+=3){var l=[];l.push(e[r[i][t]]);l.push(e[r[i][t+1]]);l.push(e[r[i][t+2]]);s.push(l)}return s};o.march=function(a){var r=a.numDivision;var v=[];var o,e,i;for(o=0;o<r+2;o++){for(e=0;e<r+2;e++){for(i=0;i<r+2;i++){if(i===0||e===0||o===0||i===r+1||e===r+1||o===r+1){v.push(0)}else{var s=a.unpacked[(o-1)*r*r+(e-1)*r+(i-1)];v.push(Number(s))}}}}var t=r+2;var l=r+2;var n=[];for(o=0;o<r+1;o++){for(e=0;e<r+1;e++){for(i=0;i<r+1;i++){var p=v[o*t*t+e*l+i];var u=v[o*t*t+e*l+i+1];var h=v[(o+1)*t*t+e*l+i+1];var c=v[(o+1)*t*t+e*l+i];var m=v[o*t*t+(e+1)*l+i];var b=v[o*t*t+(e+1)*l+i+1];var w=v[(o+1)*t*t+(e+1)*l+i+1];var A=v[(o+1)*t*t+(e+1)*l+i];var E=i/r-.55;var g=(i+1)/r-.55;var d=e/r-.55;var y=(e+1)/r-.55;var B=o/r-.55;var H=(o+1)/r-.55;var M={pos:[[E,d,B],[g,d,B],[g,d,H],[E,d,H],[E,y,B],[g,y,B],[g,y,H],[E,y,H]],val:[p,u,h,c,m,b,w,A]};n=n.concat(f(M))}}}var N=new Uint16Array(n.length*3);var R=new Float32Array(n.length*9);for(var T=0;T<n.length;T++){N[T*3]=T*3;N[T*3+1]=T*3+1;N[T*3+2]=T*3+2;R[T*9]=n[T][0][0];R[T*9+1]=n[T][0][1];R[T*9+2]=n[T][0][2];R[T*9+3]=n[T][1][0];R[T*9+4]=n[T][1][1];R[T*9+5]=n[T][1][2];R[T*9+6]=n[T][2][0];R[T*9+7]=n[T][2][1];R[T*9+8]=n[T][2][2]}var x=new THREE.BufferGeometry;var F=new THREE.BufferAttribute(N,1);var U=new THREE.BufferAttribute(R,3);x.setIndex(F);x.setAttribute("position",U);x.computeFaceNormals();x.computeVertexNormals();x.computeBoundingSphere();return x};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Material", ["../Material","../thirdparty/three","./MaterialType","./Texture","../cssColorToColor","../colorToCSSColor","./ThreeUtils"],function(t,e,i,a,r,n,s){"use strict";var o=t.extend("sap.ui.vk.threejs.Material",{metadata:{library:"sap.ui.vk"},constructor:function(e){switch(e){default:case i.MeshPhongMaterial:this._nativeMaterial=new THREE.MeshPhongMaterial({color:11184810});break;case i.LineBasicMaterial:this._nativeMaterial=new THREE.LineBasicMaterial({color:11184810});break;case i.MeshBasicMaterial:this._nativeMaterial=new THREE.MeshBasicMaterial({color:11184810});break}t.call(this)}});var l=o.getMetadata().getParent().getClass().prototype;o.prototype.init=function(){if(l.init){l.init.call(this)}};o.prototype.exit=function(){if(l.exit){l.exit.call(this)}if(this._nativeMaterial){s.disposeMaterial(this._nativeMaterial);this._nativeMaterial=null}};o.prototype.getMaterialRef=function(){return this._nativeMaterial};o.prototype.setMaterialRef=function(t){this._nativeMaterial=t;return this};o.prototype.getId=function(){if(this._nativeMaterial&&this._nativeMaterial.userData&&this._nativeMaterial.userData.materialId){return this._nativeMaterial.userData.materialId}};o.prototype.setId=function(t){this._nativeMaterial.userData.materialId=t;return this};o.prototype.getName=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.name){return this._nativeMaterial.userData.name}};o.prototype.setName=function(t){this._nativeMaterial.userData.name=t;return this};o.prototype.getAmbientColour=function(){};o.prototype.setAmbientColour=function(t){return this};o.prototype.getDiffuseColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.color){var t={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1};return n(t)}};o.prototype.setDiffuseColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var e=r(t);this._nativeMaterial.color=new THREE.Color(e.red/255,e.green/255,e.blue/255)}return this};o.prototype.getEmissiveColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.emissive){var t={red:Math.round(this._nativeMaterial.emissive.r*255),green:Math.round(this._nativeMaterial.emissive.g*255),blue:Math.round(this._nativeMaterial.emissive.b*255),alpha:1};return n(t)}};o.prototype.setEmissiveColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var e=r(t);this._nativeMaterial.emissive=new THREE.Color(e.red/255,e.green/255,e.blue/255)}return this};o.prototype.getSpecularColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.specular){var t={red:Math.round(this._nativeMaterial.specular.r*255),green:Math.round(this._nativeMaterial.specular.g*255),blue:Math.round(this._nativeMaterial.specular.b*255),alpha:1};return n(t)}};o.prototype.setSpecularColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var e=r(t);this._nativeMaterial.specular=new THREE.Color(e.red/255,e.green/255,e.blue/255)}return this};o.prototype.getOpacity=function(){if(this._nativeMaterial.opacity!==undefined){return this._nativeMaterial.opacity}};o.prototype.setOpacity=function(t){if(t>=0&&t<=1){this._nativeMaterial.opacity=t;this._nativeMaterial.transparent=this._nativeMaterial.opacity<1}return this};o.prototype.getGlossiness=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.shininess){return this._nativeMaterial.shininess/100}};o.prototype.setGlossiness=function(t){if(this._nativeMaterial.isMeshPhongMaterial){this._nativeMaterial.shininess=t*100}return this};o.prototype.getLineColour=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.color){var t={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1};return n(t)}};o.prototype.setLineColour=function(t){if(this._nativeMaterial.isLineBasicMaterial){var e=r(t);this._nativeMaterial.color=new THREE.Color(e.red/255,e.green/255,e.blue/255)}return this};o.prototype.getLineWidth=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.linewidth!==undefined){return this._nativeMaterial.linewidth}};o.prototype.setLineWidth=function(t){if(this._nativeMaterial.isLineBasicMaterial){this._nativeMaterial.linewidth=t}return this};o.prototype.getTextureDiffuse=function(){if(this._nativeMaterial.map){var t=new a;t.setTextureRef(this._nativeMaterial.map);return t}};o.prototype.setTextureDiffuse=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.map=t.getTextureRef()}return this};o.prototype.getTextureBump=function(){if(this._nativeMaterial.bumpMap){var t=new a;t.setTextureRef(this._nativeMaterial.bumpMap);return t}};o.prototype.setTextureBump=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.bumpMap=t.getTextureRef()}return this};o.prototype.getTextureOpacity=function(){if(this._nativeMaterial.alphaMap){var t=new a;t.setTextureRef(this._nativeMaterial.alphaMap);return t}};o.prototype.setTextureOpacity=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.alphaMap=t.getTextureRef()}return this};o.prototype.getTextureReflection=function(){if(this._nativeMaterial.envMap){var t=new a;t.setTextureRef(this._nativeMaterial.envMap);return t}};o.prototype.setTextureReflection=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.envMap=t.getTextureRef();if(this._nativeMaterial.envMap){this._nativeMaterial.envMap.mapping=THREE.SphericalReflectionMapping;this._nativeMaterial.combine=THREE.AddOperation}}return this};o.prototype.getTextureEmissive=function(){if(this._nativeMaterial.emissiveMap){var t=new a;t.setTextureRef(this._nativeMaterial.emissiveMap);return t}};o.prototype.setTextureEmissive=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.emissiveMap=t.getTextureRef()}return this};o.prototype.getTextureAmbientOcclusion=function(){if(this._nativeMaterial.aoMap){var t=new a;t.setTextureRef(this._nativeMaterial.aoMap);return t}};o.prototype.setTextureAmbientOcclusion=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.aoMap=t.getTextureRef()}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/MaterialType", [],function(){"use strict";var a={MeshPhongMaterial:"MeshPhongMaterial",MeshBasicMaterial:"MeshBasicMaterial",LineBasicMaterial:"LineBasicMaterial"};return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/NodeHierarchy", ["../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(e,t,r,n,o,i,a,s,d,c){"use strict";var u={equals:function(e,t){return e===t},contains:function(e,t){return e.indexOf(t)!==-1},startsWith:function(e,t){return e.indexOf(t)===0}};var f=e.extend("sap.ui.vk.threejs.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new t(r),constructor:function(t){e.call(this);this._scene=t;this._nodeProxies=[]}});f.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;e.prototype.destroy.call(this)};f.prototype.getScene=function(){return this._scene};f.prototype.getSceneRef=function(){return this._scene.getSceneRef()};f.prototype.enumerateChildren=function(e,t,r,n){if(typeof e==="function"){n=r;r=t;t=e;e=undefined}var o=this.getChildren(e,r);if(n){o.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};f.prototype.enumerateAncestors=function(e,t,r){var n=this.getAncestors(e);if(r){n.forEach(t)}else{var o=this._baseNodeProxyPool.borrowObject();try{n.forEach(function(e){o.init(this,e);t(o);o.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(o)}}return this};f.prototype.createNodeProxy=function(e){var t=new n(this,e);this._nodeProxies.push(t);return t};f.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};f.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}if(!e){e=this._scene.getSceneRef()}var r=[];if(t||!e.userData.closed){e.children.forEach(function(e){if(!e.private&&(e.geometry===undefined||!e.userData.skipIt)){r.push(e)}})}return r};f.prototype.getAncestors=function(e){var t=[];e.traverseAncestors(function(e){t.unshift(e)});if(t.length>0&&t[0]===this._scene.getSceneRef()){t.shift()}return t};f.prototype.findNodesByName=function(e){var t=[];if(e===undefined||e===null||e===""||jQuery.isEmptyObject(e)){this._scene.getSceneRef().children.forEach(function(e){e.traverse(function(e){if(!e.private&&!e.userData.skipIt){t.push(e)}})})}else{var r=u[e.predicate||"equals"];if(r===undefined){c.error(i().getText(o.VIT8.summary),o.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy")}else if(!Array.isArray(e.value)&&typeof e.value!=="string"){c.error(i().getText(o.VIT6.summary),o.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy")}else{var n=Array.isArray(e.value)?e.value:[e.value];if(!e.caseSensitive){for(var a in n){n[a]=n[a].toLowerCase()}}this._scene.getSceneRef().children.forEach(function(o){o.traverse(function(o){if(!o.private&&!o.userData.skipIt){var i=o.name||"";if(!e.caseSensitive){i=i.toLowerCase()}for(var a in n){if(r(i,n[a])){t.push(o);break}}}})})}}return t};f.prototype.findNodesByUsageIdPath=function(e,t,r){var n=[];function o(i,a,s){if(!i.userData.skipIt){if(a>=0){var d=t[a];if(d==="**"){d=t[++a];s=true}var c=d==="*";if(!c&&Array.isArray(i.userData.usageIds)){var u=i.userData.usageIds.find(function(t){return t.name===e});var f=u&&u.keys;var h=Array.isArray(d)?d:[d];if(Array.isArray(f)&&f.length===h.length){c=f.every(function(e){return h.some(function(t){return t.name===e.name&&t.value===e.value})})}}if(c){a++;if(a>=t.length){n.push(i);return}s=false}else if(!s){return}}else{a=0}}if(!i.userData.closed||r&&r.stepIntoClosedNodes){i.children.forEach(function(e){o(e,a,s)})}}o(r&&r.searchUnder||this._scene.getSceneRef(),-1,false);return n};f.prototype.createLayerProxy=function(e){return null};f.prototype.destroyLayerProxy=function(e){return this};f.prototype.getLayers=function(){return[]};f.prototype.getHotspotNodeIds=function(){return null};f.prototype.attachChanged=function(e,t,r){return this.attachEvent("changed",e,t,r)};f.prototype.detachChanged=function(e,t,r){return this.detachEvent("changed",e,t,r)};f.prototype.fireChanged=function(e,t,r){return this.fireEvent("changed",e,t,r)};f.prototype.attachNodeCreated=function(e,t,r){return this.attachEvent("nodeCreated",e,t,r)};f.prototype.detachNodeCreated=function(e,t,r){return this.detachEvent("nodeCreated",e,t,r)};f.prototype.fireNodeCreated=function(e,t,r){return this.fireEvent("nodeCreated",e,t,r)};f.prototype.attachNodeRemoving=function(e,t,r){return this.attachEvent("nodeRemoving",e,t,r)};f.prototype.detachNodeRemoving=function(e,t,r){return this.detachEvent("nodeRemoving",e,t,r)};f.prototype.fireNodeRemoving=function(e,t,r){return this.fireEvent("nodeRemoving",e,t,r)};f.prototype.attachNodeReplaced=function(e,t,r){return this.attachEvent("nodeReplaced",e,t,r)};f.prototype.detachNodeReplaced=function(e,t,r){return this.detachEvent("nodeReplaced",e,t,r)};f.prototype.fireNodeReplaced=function(e,t,r){return this.fireEvent("nodeReplaced",e,t,r)};f.prototype.attachNodeUpdated=function(e,t,r){return this.attachEvent("nodeUpdated",e,t,r)};f.prototype.detachNodeUpdated=function(e,t,r){return this.detachEvent("nodeUpdated",e,t,r)};f.prototype.fireNodeUpdated=function(e,t,r){return this.fireEvent("nodeUpdated",e,t,r)};f.prototype.createNode=function(e,t,r,n,o){var c=this.getScene().getSceneBuilder();var u=null;if(c){o=o||{};o.name=o.name||t;o.sid=o.sid||s();u=c.createNode(o);if(!e){e=u.parent}}else{if(!e){e=this._scene.getSceneRef()}u=new THREE.Group;u.name=t;e.add(u)}var f=e.children.indexOf(r);d(e.children[e.children.length-1]===u,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){e.children.splice(f,0,e.children.pop())}if(n){u._vkSetNodeContentType(n)}else{u._vkSetNodeContentType(a.Regular)}if(o&&c){switch(u._vkGetNodeContentType()){case a.Annotation:o.node=u;o.nodeId=u._vkPersistentId();c.createAnnotation(o);break;case a.Background:c.setParametricContent(o.sid,o.parametricContent);break;default:}}this.fireNodeCreated({nodeRef:u,nodeId:u});this.fireChanged();return u};f.prototype.getNodeContentType=function(e){if(e==null){return a.Regular}var t=e._vkGetNodeContentType();if(!t){t=a.Regular}return t};f.prototype.createNodeCopy=function(e,t,r,n){if(!t){t=this._scene.getSceneRef()}var o=t.children.indexOf(n);var a=e.clone(true);a.name=r;t.add(a);d(t.children[t.children.length-1]===a,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(o>=0){t.children.splice(o,0,t.children.pop())}this.fireNodeCreated({nodeRef:a,nodeId:a});this.fireChanged();return a};f.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){if(e&&e.parent){this.fireNodeRemoving({nodeRef:e,nodeId:e});e.parent.remove(e)}}.bind(this));var r=this.getScene().getSceneBuilder();if(r){t.forEach(r.removeNode,r)}this.fireChanged();return this};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/NodeProxy", ["../NodeProxy","./Material","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./ThreeExtensions","../ObjectType"],function(t,e,r,a,i,o,n,s,l){"use strict";var u=t.extend("sap.ui.vk.threejs.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(e,r){t.call(this);this._object3D=r;this._nodeHierarchy=e}});u.prototype.destroy=function(){this._object3D=null;t.prototype.destroy.call(this)};u.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};u.prototype.getNodeRef=function(){return this._object3D};u.prototype.getNodeId=function(){return this._object3D};u.prototype.getVeIds=function(){return this._object3D.userData.veids||[]};u.prototype.getVeId=function(){return this._object3D.userData.treeNode?this._object3D.userData.treeNode.sid:null};u.prototype.getMaterialId=function(){var t=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){t=this._object3D.children[0]}}if(t.material!==undefined&&t.material.userData!==undefined&&t.material.userData.materialId!==undefined){return t.material.userData.materialId}else if(t.userData.originalMaterial!==undefined&&t.userData.originalMaterial.userData!==undefined&&t.userData.originalMaterial.userData.materialId!==undefined){return t.userData.originalMaterial.userData.materialId}return undefined};u.prototype.getName=function(){return this._object3D.name||"<"+this._object3D.type+">"};u.prototype._updateAncestorsBoundingBox=function(){var t=this._object3D.parent;while(t){if(t.userData.boundingBox!==undefined){t._vkCalculateObjectOrientedBoundingBox()}t=t.parent}};u.prototype.getLocalMatrix=function(){return n.convertTo4x3(this._object3D.matrix.elements)};u.prototype.setLocalMatrix=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("localMatrix",t,true);return this};u.prototype.setLocalMatrixNotUpdatingBBox=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true)}this.setProperty("localMatrix",t,true);return this};u.prototype.getWorldMatrix=function(){return n.convertTo4x3(this._object3D.matrixWorld.elements)};u.prototype.setWorldMatrix=function(t){if(t){var e=this._object3D;e.matrixWorld.fromArray(n.convertTo4x4(t));if(e.parent){e.matrix.multiplyMatrices((new THREE.Matrix4).getInverse(e.parent.matrixWorld),e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("worldMatrix",t,true);return this};u.prototype.getOpacity=function(){return this._object3D.userData.opacity};u.prototype.setOpacity=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setOpacity(this._object3D,t)}else{this._object3D._vkSetOpacity(t)}this.setProperty("opacity",t,true);return this};u.prototype.getTintColorABGR=function(){return this._object3D.userData.tintColor};u.prototype.setTintColorABGR=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setTintColor(this._object3D,t)}else{this._object3D._vkSetTintColor(t)}this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",a(i(t)),true);return this};u.prototype.getTintColor=function(){return a(i(this._object3D.userData.tintColor))};u.prototype.setTintColor=function(t){var e=o(r(t));var a=this._nodeHierarchy.getScene().getViewStateManager();if(a){a.setTintColor(this._object3D,e)}else{this._object3D._vkSetTintColor(e)}this.setProperty("tintColorABGR",e,true);this.setProperty("tintColor",t,true);return this};u.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{}};u.prototype.getHasChildren=function(){return this._object3D.children.length>0};u.prototype.getClosed=function(){return!!this._object3D.userData.closed};u.prototype.getBoundingBox=function(){return this._object3D.userData.boundingBox};u.prototype.assignMaterial=function(t){var e=function(t,e){var r;if(t.userData){r=t.userData.materialId;e.userData.materialId=r}if(e.material!==undefined){if(e.userData.highlightColor!==undefined){if(e.userData.originalMaterial.side){t.side=e.userData.originalMaterial.side}e.userData.originalMaterial=t;t.userData.materialUsed++;e.material=t.clone();var a=i(e.userData.highlightColor);e.material.color.lerp(new THREE.Color(a.red/255,a.green/255,a.blue/255),a.alpha);if(t.userData.defaultHighlightingEmissive&&e.userData.highlightColor!==0){e.material.emissive.copy(t.userData.defaultHighlightingEmissive)}if(t.userData.defaultHighlightingSpecular&&e.userData.highlightColor!==0){e.material.specular.copy(t.userData.defaultHighlightingSpecular)}}else{if(e.material.side){t.side=e.material.side}e.material=t;t.userData.materialUsed++;delete e.userData.originalMaterial}e._vkUpdateMaterialOpacity()}};e(t.getMaterialRef(),this._object3D);if(!this._object3D.children){return this}this._object3D.children.forEach(function(r){if(!r||r.userData.objectType===l.PMI||r.userData.objectType===l.Hotspot){return}e(t.getMaterialRef(),r)});return this};u.prototype.enumerateMaterials=function(t){var r=function(t,e,a){if(t){if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}if(t.children){t.children.forEach(function(t){if(t){if(a){r(t,e,a)}else if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}}})}}};var a=new Set;r(this._object3D,a,t);var i=[];a.forEach(function(t){i.push(t)});var o=[];for(var n=0;n<i.length;n++){var s=new e;s.setMaterialRef(i[n]);o.push(s)}return o};u.prototype.replaceMaterial=function(t,e){var r=typeof t.getMaterialRef==="function"?t.getMaterialRef():t;var a=typeof e.getMaterialRef==="function"?e.getMaterialRef():e;if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===r){this._object3D.userData.originalMaterial=a;this._object3D._vkUpdateMaterialColor()}else if(this._object3D.material&&this._object3D.material===r){this._object3D.material=a}if(!this._object3D.children){return this}this._object3D.children.forEach(function(t){if(t&&t.userData.originalMaterial&&t.userData.originalMaterial===r){t.userData.originalMaterial=a;t._vkUpdateMaterialColor()}else if(t&&t.material&&t.material===r){t.material=a}});return this};u.prototype.getLocalTranslate=function(){var t=this._object3D;return[t.position.x,t.position.y,t.position.z]};u.prototype.getLocalScale=function(){var t=this._object3D;return[t.scale.x,t.scale.y,t.scale.z]};u.prototype.getLocalRotationInQuaternion=function(){var t=this._object3D;return[t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w]};u.prototype.getLocalRotationInAngleAxis=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=2*Math.acos(e.w);var a=Math.sqrt(1-e.w*e.w);var i,o,n;if(a<.001){i=e.x;o=e.y;n=e.z}else{i=e.x/a;o=e.y/a;n=e.z/a}return[i,o,n,r]};u.prototype.getLocalRotationInEuler=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=26;var a=e.x*e.y+e.z*e.w;var i,o,n;if(a>.499){i=2*Math.atan2(e.x,e.w);o=Math.PI/2;n=0}if(a<-.499){i=-2*Math.atan2(e.x,e.w);o=-Math.PI/2;n=0}else{var s=e.x*e.x;var l=e.y*e.y;var u=e.z*e.z;i=Math.atan2(2*e.y*e.w-2*e.x*e.z,1-2*l-2*u);o=Math.asin(2*a);n=Math.atan2(2*e.x*e.w-2*e.y*e.z,1-2*s-2*u)}return[i,o,n,r]};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/NodesTransitionHelper", ["../thirdparty/three","sap/ui/core/Element","../TransformationMatrix"],function(t,e,i){"use strict";var a=e.extend("sap.ui.vk.threejs.NodesTransitionHelper",{metadata:{library:"sap.ui.vk",properties:{},publicMethods:["setViewStateManager","setNodeForDisplay","setDisappearingNode","setAppearingNode","clear","startDisplay","displayNodesMoving"],events:{displaying:{},displayed:{}}}});a.prototype.init=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=new Map;this._nodeLocalMatrixMapForVisibility=new Map;this._timeIntervalForDisplay=500;this._startTimeForDisplay=0};a.prototype.destroy=function(){this._viewStateManager=null;this._nodeLocalmMatrixMap=null;this._nodeLocalMatrixMapForVisibility=new Map;if(e.prototype.destroy){e.prototype.destroy.apply(this,arguments)}};a.prototype.setViewStateManager=function(t){this._viewStateManager=t};a.prototype.setNodeForDisplay=function(t,e){this._nodeLocalmMatrixMap.set(t,{oldMatrix:t.getLocalMatrix(),newMatrix:e?i.convertTo4x3(e.elements):null})};a.prototype.setDisappearingNode=function(t){var e=t.getLocalMatrix();var i=[e[0]*1e-4,e[1],e[2],e[3],e[4]*1e-4,e[5],e[6],e[7],e[8]*1e-4,e[9],e[10],e[11]];this._nodeLocalMatrixMapForVisibility.set(t,{oldMatrix:e,newMatrix:i,visible:false});this._viewport.getViewStateManager().setVisibilityState(t.getNodeRef(),true,false)};a.prototype.setAppearingNode=function(t){var e=t.getLocalMatrix();var i=[e[0]*1e-4,e[1],e[2],e[3],e[4]*1e-4,e[5],e[6],e[7],e[8]*1e-4,e[9],e[10],e[11]];this._nodeLocalMatrixMapForVisibility.set(t,{oldMatrix:i,newMatrix:e,visible:true})};a.prototype._interpolateNodePositionForVisibility=function(t,e,i){var a=t.getNodeRef();return i>=1?e.visible:a.visible};a.prototype._interpolateNodePosition=function(t,e,a,o){var r=(new THREE.Matrix4).fromArray(i.convertTo4x4(e));var s=new THREE.Vector3;var n=new THREE.Quaternion;var p=new THREE.Vector3;r.decompose(s,n,p);var l=(new THREE.Matrix4).fromArray(i.convertTo4x4(a));var M=new THREE.Vector3;var d=new THREE.Quaternion;var c=new THREE.Vector3;l.decompose(M,d,c);var y=(new THREE.Vector3).lerpVectors(s,M,o);var h=(new THREE.Quaternion).copy(n).slerp(d,o);var f=(new THREE.Vector3).lerpVectors(p,c,o);return{translation:y.toArray(),quaternion:h.toArray(),scale:f.toArray()}};a.prototype.startDisplay=function(t){if(this._nodeLocalmMatrixMap.size===0){return}this._timeIntervalForDisplay=t!==undefined?t:500;this._startTimeForDisplay=Date.now();this._nodeLocalmMatrixMap.forEach(function(t,e){if(!t.newMatrix){t.newMatrix=e.getLocalMatrix()}});this.fireDisplaying()};a.prototype.displayNodesMoving=function(){if(this._startTimeForDisplay===0||this._nodeLocalmMatrixMap===null||this._nodeLocalmMatrixMap.size===0){return}var t=Math.min((Date.now()-this._startTimeForDisplay)/this._timeIntervalForDisplay,1);t=1-Math.pow(1-t,3);var e={nodeRefs:[],positions:[]};this._nodeLocalmMatrixMap.forEach(function(i,a){if(a&&i.oldMatrix&&i.newMatrix){var o=this._interpolateNodePosition(a,i.oldMatrix,i.newMatrix,t);e.nodeRefs.push(a.getNodeRef());e.positions.push(o)}}.bind(this));if(e.nodeRefs.length){this._viewStateManager.setTransformation(e.nodeRefs,e.positions)}var i={nodeRefs:[],values:[]};this._nodeLocalMatrixMapForVisibility.forEach(function(e,a){if(a&&e){var o=this._interpolateNodePositionForVisibility(a,e,t);i.nodeRefs.push(a.getNodeRef());i.values.push(o)}}.bind(this));this._viewStateManager.setVisibilityState(i.nodeRefs,i.values);if(t===1){this.clear();this.fireDisplayed()}};a.prototype.clear=function(){this._nodeLocalmMatrixMap.clear();this._nodeLocalMatrixMapForVisibility.clear();this._startTimeForDisplay=0};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/OrthographicCamera", ["../OrthographicCamera","../thirdparty/three"],function(t,e){"use strict";var a=t.extend("sap.ui.vk.threejs.OrthographicCamera",{metadata:{library:"sap.ui.vk"}});var i=t.getMetadata().getParent().getClass().prototype;a.prototype.init=function(){if(i.init){i.init.call(this)}var t=1;var e=2e5;this._nativeCamera=new THREE.OrthographicCamera(-1,1,1,-1,t,e);this._nativeCamera.position.set(0,0,1e4);this._nativeCamera.zoom=-1;this.setUsingDefaultClipPlanes(true)};a.prototype.update=function(t,e){var a=1/Math.min(t,e);this.setLeft(t*-a);this.setRight(t*a);this.setTop(e*a);this.setBottom(e*-a);var i=this._nativeCamera.view;if(i&&i.enabled){var r=i.fullWidth/i.fullHeight;var n=t/e;var o=Math.min(n,1)/Math.min(r,1);var s=o*r/n;var p=t/i.fullWidth;var u=e/i.fullHeight;i.offsetX=(i.offsetX*s+(i.fullWidth-i.width)*(1-s)*.5)*p;i.offsetY=(i.offsetY*o+(i.fullHeight-i.height)*(1-o)*.5)*u;i.width*=p;i.height*=u;i.fullWidth=t;i.fullHeight=e}this._nativeCamera.updateProjectionMatrix()};a.prototype.exit=function(){if(i.exit){i.exit.call(this)}this._nativeCamera=null};a.prototype.getLeft=function(){return this._nativeCamera.left};a.prototype.setLeft=function(t){this._nativeCamera.left=t;return this};a.prototype.getRight=function(){return this._nativeCamera.right};a.prototype.setRight=function(t){this._nativeCamera.right=t;return this};a.prototype.getTop=function(){return this._nativeCamera.top};a.prototype.setTop=function(t){this._nativeCamera.top=t;return this};a.prototype.getBottom=function(){return this._nativeCamera.bottom};a.prototype.setBottom=function(t){this._nativeCamera.bottom=t;return this};a.prototype.getZoomFactor=function(){return this._nativeCamera.zoom};a.prototype.setZoomFactor=function(t){this._nativeCamera.zoom=t;return this};a.prototype.getCameraRef=function(){return this._nativeCamera};a.prototype.setCameraRef=function(t){this._nativeCamera=t;return this};a.prototype.getNearClipPlane=function(){return this._nativeCamera.near};a.prototype.setNearClipPlane=function(t){this._nativeCamera.near=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getFarClipPlane=function(){return this._nativeCamera.far};a.prototype.setFarClipPlane=function(t){this._nativeCamera.far=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getPosition=function(){return this._nativeCamera.position.toArray()};a.prototype.setPosition=function(t){this._nativeCamera.position.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray()};a.prototype.setUpDirection=function(t){this._nativeCamera.up.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getTargetDirection=function(){var t=new THREE.Vector3;this._nativeCamera.getWorldDirection(t);return t.toArray()};a.prototype.setTargetDirection=function(t){var e=(new THREE.Vector3).fromArray(t);e.add(this._nativeCamera.position);this._nativeCamera.lookAt(e);return this};a.prototype.setUsingDefaultClipPlanes=function(t){this._nativeCamera.userData.usingDefaultClipPlanes=t;return this};a.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes};a.prototype.adjustClipPlanes=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.near=-t.max.z;e.far=-t.min.z;var a=Math.max((e.far-e.near)*.0025,.001);e.near-=a;e.far+=a;if(e.near<0){var i=new THREE.Vector3(0,0,-1).transformDirection(e.matrixWorld).multiplyScalar(e.near);e.position.add(i);e.far-=e.near;e.near=0;e.updateMatrixWorld()}e.updateProjectionMatrix();return this};a.prototype.adjustZoom=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.zoom=1/Math.max(t.min.x/e.left,t.max.y/e.top,t.max.x/e.right,t.min.y/e.bottom);e.updateProjectionMatrix();return this};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/OutlineRenderer", ["../thirdparty/three","sap/base/Log","./ThreeUtils"],function(e,t,a){"use strict";var r=function(e){this._outlineWidth=e;this._copyMaterial=new THREE.MeshBasicMaterial({transparent:true,fog:false});this._maskMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,fog:false});this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{mask:{value:null},offset:{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","\tvTC = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","float delta(vec3 c1,  vec3 c2) {","\tvec3 dc = c1 - c2;","\treturn dot(dc, dc);","}","void main() {","\tvec3 c = texture2D(mask, vTC).rgb;","\tvec3 c1 = texture2D(mask, vTC + offset.xy).rgb;","\tvec3 c2 = texture2D(mask, vTC - offset.xy).rgb;","\tvec3 c3 = texture2D(mask, vTC + offset.zw).rgb;","\tvec3 c4 = texture2D(mask, vTC - offset.yw).rgb;","\tvec4 a = vec4(delta(c, c1), delta(c, c2), delta(c, c3), delta(c, c4));","\tgl_FragColor = vec4(1.0, 1.0, 1.0, sign(dot(a, a)));","}"].join("\n")});this._expandMaterial=new THREE.ShaderMaterial({uniforms:{mask:{value:null},offset:{value:new THREE.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","\tvTC = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","void main() {","\tfloat a = texture2D(mask, vTC).a;","\ta += texture2D(mask, vTC + offset.xy).a;","\ta += texture2D(mask, vTC - offset.xy).a;","\ta += texture2D(mask, vTC + offset.zw).a;","\ta += texture2D(mask, vTC - offset.yw).a;","\tgl_FragColor = vec4(1.0, 1.0, 1.0, a * 0.5);","}"].join("\n")});this._screenCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this._screenMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2))};r.prototype.setOutlineWidth=function(e){this._outlineWidth=e};r.prototype.render=function(e,t,a,r,i,s){if(!r||!r.length){return}var n=e.getSize(new THREE.Vector2);var o=2;var l=n.width*o;var h=n.height*o;if(!this._renderTarget1||this._renderTarget1.width!==l||this._renderTarget1.height!==h){var v={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};this._renderTarget1=new THREE.WebGLRenderTarget(l,h,v);this._renderTarget1.texture.generateMipmaps=false;this._renderTarget2=new THREE.WebGLRenderTarget(l,h,v);this._renderTarget2.texture.generateMipmaps=false}var c;var u;if(s){c=new Map;u=new Map;s.forEach(function(e){if(!e.node||!e.parent){return}c.set(e.node,e);if(e.parent){var t=u.get(e.parent)||[];t.push(e);u.set(e.parent,t)}})}var f;var d=new Set;var m=function(e){if(e.isMesh){d.add({mesh:e,color:f})}};var _;for(_=0;_<r.length;_++){var M=r[_];f=new THREE.Color((_+1&255)/255,(_+1>>8&255)/255,(_+1>>16&255)/255);M._vkTraverseNodes(m,c,u)}if(d.size===0){return}var T=e.getClearColor().clone();var g=e.getClearAlpha();var p=e.autoClear;e.autoClear=false;e.setClearColor(0,0);var E;var C=this._renderTarget1;var x=this._renderTarget2;e.setRenderTarget(C);e.clear(true,true,false);var w=d.values();var k=w.next();while(!k.done){var R=k.value.mesh;this._maskMaterial.color=k.value.color;k=w.next();E=R.material;R.material=this._maskMaterial;e.render(R,a);R.material=E}var y=new THREE.Vector4(1/l,0,0,1/h);E=this._outlineMaterial;E.uniforms.mask.value=C.texture;E.uniforms.offset.value=y;this._screenMesh.material=E;e.setRenderTarget(x);e.render(this._screenMesh,this._screenCamera);if(this._outlineWidth>1){E=this._expandMaterial;E.uniforms.offset.value=y;this._screenMesh.material=E;for(_=1;_<this._outlineWidth;_++){var H=C;C=x;x=H;E.uniforms.mask.value=C.texture;e.setRenderTarget(x);e.render(this._screenMesh,this._screenCamera)}}E=this._copyMaterial;E.map=x.texture;E.color=i;this._screenMesh.material=E;e.setRenderTarget(null);e.render(this._screenMesh,this._screenCamera);e.setClearColor(T,g);e.autoClear=p};r.prototype.dispose=function(){if(this._copyMaterial){a.disposeMaterial(this._copyMaterial);this._copyMaterial=null}if(this._maskMaterial){a.disposeMaterial(this._maskMaterial);this._maskMaterial=null}if(this._outlineMaterial){a.disposeMaterial(this._outlineMaterial);this._outlineMaterial=null}if(this._expandMaterial){a.disposeMaterial(this._expandMaterial);this._expandMaterial=null}if(this._screenMesh){a.disposeObject(this._screenMesh);this._screenMesh=null}};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ParametricGenerators", ["../thirdparty/three"],function(e){"use strict";var n={generateSphere:function(e,n){var t=new THREE.SphereGeometry(e.radius,32,32);var r=new THREE.Mesh(t,n||undefined);r.name="sphere";return r},generateBox:function(e){},generatePlane:function(e,n){var t=new THREE.PlaneGeometry(e.length,e.width);var r=new THREE.Mesh(t,n||undefined);r.name="plane";r.rotation.x=Math.PI/2;r.position.set(-e.length/2,-e.width/2,0);return r}};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PerspectiveCamera", ["../PerspectiveCamera","../thirdparty/three"],function(t,e){"use strict";var a=t.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{library:"sap.ui.vk"}});var i=t.getMetadata().getParent().getClass().prototype;a.prototype.init=function(){if(i.init){i.init.call(this)}var t=1;var e=1e4;this._nativeCamera=new THREE.PerspectiveCamera(30,1,t,e);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true)};a.prototype.update=function(t,e){var a=this._nativeCamera.aspect;var i=this._nativeCamera.zoom;this._nativeCamera.aspect=t/e;this._nativeCamera.zoom=Math.min(this._nativeCamera.aspect,1);var r=this._nativeCamera.view;if(r&&r.enabled){var n=t/r.fullWidth;var o=e/r.fullHeight;var s=this._nativeCamera.zoom/i;var p=s*a/this._nativeCamera.aspect;r.offsetX=(r.offsetX*p+(r.fullWidth-r.width)*(1-p)*.5)*n;r.offsetY=(r.offsetY*s+(r.fullHeight-r.height)*(1-s)*.5)*o;r.width*=n;r.height*=o;r.fullWidth=t;r.fullHeight=e}this._nativeCamera.updateProjectionMatrix()};a.prototype.exit=function(){if(i.exit){i.exit.call(this)}this._nativeCamera=null};a.prototype.getFov=function(){return this._nativeCamera.fov};a.prototype.setFov=function(t){this._nativeCamera.fov=t;this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getCameraRef=function(){return this._nativeCamera};a.prototype.setCameraRef=function(t){this._nativeCamera=t;return this};a.prototype.getNearClipPlane=function(){return this._nativeCamera.near};a.prototype.setNearClipPlane=function(t){this._nativeCamera.near=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getFarClipPlane=function(){return this._nativeCamera.far};a.prototype.setFarClipPlane=function(t){this._nativeCamera.far=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getPosition=function(){return this._nativeCamera.position.toArray()};a.prototype.setPosition=function(t){this._nativeCamera.position.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray()};a.prototype.setUpDirection=function(t){this._nativeCamera.up.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection().toArray()};a.prototype.setTargetDirection=function(t){var e=(new THREE.Vector3).fromArray(t);e.add(this._nativeCamera.position);this._nativeCamera.lookAt(e);return this};a.prototype.setUsingDefaultClipPlanes=function(t){this._nativeCamera.userData.usingDefaultClipPlanes=t;return this};a.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes};a.prototype.adjustClipPlanes=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.near=-t.max.z;e.far=-t.min.z;var a=Math.max(Math.max(e.far-e.near,e.far)*.0025,.001);e.near-=a;e.far+=a;e.near=Math.max(e.near,a);e.far=Math.max(e.far,e.near+a);var i=-(e.far+e.near)/(e.far-e.near);var r=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=i;e.projectionMatrix.elements[14]=r;e.projectionMatrixInverse.getInverse(e.projectionMatrix);return this};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PoiHelper", ["../NodeContentType","../TransformationMatrix","sap/base/util/uid"],function(e,t,r){"use strict";var n=function(){this._currentSceneId=null};n.prototype.createPOI=function(n,a,o,i,s,c){o=o._implementation||o;s=s||{x:1,y:1};c=c||{};c.sid=c.sid||r();if(!c.transform){var d=o.getDomRef().getBoundingClientRect();var u=i.x-d.left;var m=i.y-d.top;var f=o.hitTest(u,m,{ignoreOverlay:true});if(!f){return Promise.reject()}var v=(new THREE.Matrix4).compose(f.point,o._getNativeCamera().quaternion,new THREE.Vector3(Number(s.x),Number(s.y),1));c.transform=t.convertTo4x3(v.elements);var l={picked:f.object?[f.object]:[]};o.fireNodesPicked(l);if(l.picked&&l.picked.length>0){var p=l.picked[0];if(p&&p.userData){c.referenceNode=l.picked[0].userData.nodeId}}else{c.referenceNode=f.object.userData.nodeId}}else if(c.transform.length===16){c.transform=t.convertTo4x3(c.transform)}c.transformType=c.transformType||"BILLBOARD_VIEW";if(this._currentSceneId){n.getSceneBuilder()._resetCurrentScene(this._currentSceneId)}var g=o._cdsLoader;if(g){var y=g.getSkipLowLODRendering();g.setSkipLowLODRendering(true);var x=n.getDefaultNodeHierarchy();var E=x.createNode(null,"Sample POI",null,e.Symbol,c);var w=o.getCurrentView()||n.getViews()[0];w.updateNodeInfos([{target:E,visible:true}]);return g.loadTransientScene(a,E).then(function(e){g.setSkipLowLODRendering(y);o.setShouldRenderFrame();var r=e.nodeRef;r.traverse(function(e){e.userData.skipIt=true});this._currentSceneId=r.userData.currentSceneId;Object.assign(r.userData.treeNode,c);var n={transform:t.convertTo4x4(c.transform),veid:c.sid,entityId:r.userData.entityId,name:c.name||"Sample POI",transformType:"view",contentType:"symbol",referenceNode:c.referenceNode};return n}.bind(this))}return Promise.reject()};n.prototype.removePOI=function(e,t){var r=e.getDefaultNodeHierarchy();var n=e.getViewStateManager();n.setVisibilityState(t,false,true);r.removeNode(t)};n.prototype.getPOIList=function(e){var t=e.getViewStateManager();return t?t.getSymbolNodes():[]};var a={spherical:"360Image",planar:"2DImage"};n.prototype.getBackgroundImageType=function(e){return a[e.getBackgroundProjection()]};n.prototype.getPoiRect=function(e,t){var r=e._getNativeCamera();var n=new THREE.Box3;n.setFromObject(t);var a=[new THREE.Vector3(n.min.x,n.min.y,n.min.z),new THREE.Vector3(n.max.x,n.max.y,n.max.z),new THREE.Vector3(n.min.x,n.min.y,n.max.z),new THREE.Vector3(n.min.x,n.max.y,n.max.z),new THREE.Vector3(n.max.x,n.min.y,n.max.z),new THREE.Vector3(n.max.x,n.max.y,n.min.z),new THREE.Vector3(n.min.x,n.max.y,n.min.z),new THREE.Vector3(n.max.x,n.min.y,n.min.z)];var o=new THREE.Frustum;o.setFromProjectionMatrix((new THREE.Matrix4).multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse));if(!o.intersectsBox(n)){return false}var i=new THREE.Vector3(1,1,1);var s=new THREE.Vector3(-1,-1,-1);var c=new THREE.Vector3;for(var d=0;d<a.length;++d){if(!o.containsPoint(a[d])){return false}var u=c.copy(a[d]);var m=u.project(r);i.min(m);s.max(m)}var f=new THREE.Box2(i,s);var v=e.getDomRef().getBoundingClientRect();var l=new THREE.Vector2(v.width/2,v.height/2);var p=f.min.clone().multiply(l);var g=f.max.clone().multiply(l);var y=g.x-p.x;var x=g.y-p.y;return{width:y,height:x}};n.prototype.adjustPoi=function(e,r){if(e.getBackgroundProjection()!=="planar"){var n=r.getWorldPosition(new THREE.Vector3).project(e._getNativeCamera());var a=e.hitTest((n.x*.5+.5)*e._width,(n.y*-.5+.5)*e._height,{ignoreOverlay:true});if(a){r.position.copy(a.point)}r.quaternion.copy(e._getNativeCamera().quaternion);r.updateMatrix();r.updateMatrixWorld();r.userData.direction=(new THREE.Vector3).setFromMatrixColumn(r.matrixWorld,2).normalize()}r.userData.transform=t.convertTo4x3(r.matrixWorld.elements)};n.prototype.updateNodeId=function(e,t,r){var n=e.getViewStateManager();var a=n?n.getSymbolNodes(t)[0]:null;if(a){a.userData.nodeId=r;a.userData.treeNode.sid=r;e.setNodePersistentId(a,r)}return a};n.prototype.updatePOI=function(e,r,n,a,o){var i=e.getScene();var s=e._viewStateManager.getSymbolNodes(r)[0];o=o||{};var c=e._cdsLoader;if(s&&c){s.name=o.name||s.name;if(a){s.baseScale.set(a.x,a.y)}var d=c.getSkipLowLODRendering();c.setSkipLowLODRendering(true);if(o.transform){if(o.transform.length===16){o.transform=t.convertTo4x3(o.transform)}s.position.set(o.transform[9],o.transform[10],o.transform[11])}if(n){var u=e._viewStateManager.getNodeHierarchy();s.children.forEach(function(e){u.removeNode(e)});return c.loadTransientScene(n,s).then(function(t){c.setSkipLowLODRendering(d);var r=t.nodeRef;r.traverse(function(e){e.userData.skipIt=true});i.getSceneBuilder()._resetCurrentScene(r.userData.currentSceneId);r.userData.treeNode.sid=s.userData.treeNode.sid;s.userData._symbolCenterFixed=false;e.setShouldRenderFrame();return{target:r,entityId:r.userData.entityId}})}else{e.setShouldRenderFrame();var m=s.children[0];return Promise.resolve({target:m,entityId:s.userData.treeNode.entityId||m.userData.entityId})}}};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineGeometry", ["../thirdparty/three"],function(t){"use strict";function e(){THREE.InstancedBufferGeometry.call(this);this.type="PolylineGeometry";var t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0];var e=[2,-1,2,1,1,-1,1,1,-1,-1,-1,1,-2,-1,-2,1];var n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n);this.setAttribute("position",new THREE.Float32BufferAttribute(t,3));this.setAttribute("uv",new THREE.Float32BufferAttribute(e,2))}e.prototype=Object.assign(Object.create(THREE.InstancedBufferGeometry.prototype),{constructor:e,isPolylineGeometry:true,setVertices:function(t){this.vertices=t;var e=t.length-1;var n=new Float32Array(6*e);for(var r=0,i=0;r<e;r++){var s=t[r],o=t[r+1];n[i++]=s.x;n[i++]=s.y;n[i++]=s.z;n[i++]=o.x;n[i++]=o.y;n[i++]=o.z}var u=new THREE.InstancedInterleavedBuffer(n,6,1);this.setAttribute("instanceStart",new THREE.InterleavedBufferAttribute(u,3,0));this.setAttribute("instanceEnd",new THREE.InterleavedBufferAttribute(u,3,3));var a=new THREE.InstancedInterleavedBuffer(new Float32Array(2*e),2,1);this.setAttribute("instanceDistance",new THREE.InterleavedBufferAttribute(a,2,0));this.computeBoundingBox();this.computeBoundingSphere();return this},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},_updateVertices:function(t){var e=this.vertices;var n=this.attributes.instanceStart.data;var r=n.array;t.forEach(function(t){var n=e[t];var i=t*6-3;if(i>=0){r[i+0]=n.x;r[i+1]=n.y;r[i+2]=n.z}if(i+5<r.length){r[i+3]=n.x;r[i+4]=n.y;r[i+5]=n.z}});n.needsUpdate=true;this.computeBoundingBox();this.computeBoundingSphere()}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineMaterial", ["../thirdparty/three"],function(e){"use strict";var t={lineColor:{value:new THREE.Color(1,1,1)},linewidth:{value:1},resolution:{value:new THREE.Vector2(1,1)},dashScale:{value:1},dashPeriod:{value:new THREE.Vector3(1,1,1)},dashAtlas:{value:null},lineLength:{value:1e5}};var i=THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,t]);var n=["#include <common>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","","uniform float linewidth;","uniform vec2 resolution;","","attribute vec3 instanceStart;","attribute vec3 instanceEnd;","","varying vec2 vTC;","","#if defined(USE_DASH) || TRIM_STYLE","attribute vec2 instanceDistance;","varying float vLineDistance;","#endif","","void trimSegment(const in vec4 start, inout vec4 end) {","\t// trim end segment so it terminates between the camera plane and the near plane","","\t// conservative estimate of the near plane","\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column","\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column","\tfloat nearEstimate = -0.5 * b / a;","","\tfloat t = (nearEstimate - start.z) / (end.z - start.z);","","\tend.xyz = mix(start.xyz, end.xyz, t);","}","","void main() {","\tvTC = uv * linewidth;","","\t// camera space","\tvec4 start = modelViewMatrix * vec4(instanceStart, 1.0);","\tvec4 end = modelViewMatrix * vec4(instanceEnd, 1.0);","","\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane","\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space","\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly","\t// perhaps there is a more elegant solution -- WestLangley","","\tbool perspective = (projectionMatrix[ 2 ][ 3 ] == -1.0); // 4th entry in the 3rd column","\tif (perspective) {","\t\tif (start.z < 0.0 && end.z >= 0.0) {","\t\t\ttrimSegment(start, end);","\t\t} else if (end.z < 0.0 && start.z >= 0.0) {","\t\t\ttrimSegment(end, start);","\t\t}","\t}","","\t// clip space","\tvec4 clipStart = projectionMatrix * start;","\tvec4 clipEnd = projectionMatrix * end;","","\t// ndc space","\tvec2 ndcStart = clipStart.xy / clipStart.w;","\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;","","\t// direction","\tvec2 dir = (ndcEnd - ndcStart) * resolution;","\tfloat l = length(dir);","\tdir = normalize(dir);","","\t// perpendicular to dir","\tvec2 offset = vec2(dir.y, -dir.x) * position.x;","","#if defined(USE_DASH) || TRIM_STYLE","\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y);","#endif","","\t// endcaps","\tif ( position.y < 0.0 ) {","\t\toffset -= dir;","#if defined(USE_DASH)","\t\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y * linewidth / l);","#endif","\t} else if ( position.y > 1.0 ) {","\t\toffset += dir;","#if defined(USE_DASH)","\t\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, 1.0 + (position.y - 1.0) * linewidth / l);","#endif","\t}","","\t// select end","\tvec4 clip = (position.y < 0.5) ? clipStart : clipEnd;","\tclip /= clip.w; // remove perspective correction","","\tclip.xy += offset * (linewidth / resolution);","","\tgl_Position = clip;","","\tvec4 mvPosition = (position.y < 0.5) ? start : end; // this is an approximation","","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>","}"].join("\n");var a=["uniform vec3 diffuse;","uniform vec3 lineColor;","uniform float opacity;","uniform float linewidth;","","#ifdef USE_DASH","uniform float dashScale;","uniform vec3 dashPeriod;","uniform sampler2D dashAtlas;","#endif","","#if (TRIM_STYLE & 2)","uniform float lineLength;","#endif","","varying float vLineDistance;","","#include <common>","#include <color_pars_fragment>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","","varying vec2 vTC;","","void main() {","","#include <clipping_planes_fragment>","","\tvec4 diffuseColor = vec4(diffuse * lineColor, opacity);","","\tvec2 uv = abs(vTC);","\tdiffuseColor.a *= clamp(linewidth + 0.5 - uv.y, 0.0, 1.0); // line antialiasing","","#if (TRIM_STYLE & 1)","\tif (vLineDistance < 0.0)","\t\tdiscard;","#endif","","#if (TRIM_STYLE & 2)","\tif (vLineDistance > lineLength)","\t\tdiscard;","#endif","","\tif (uv.x > linewidth) { // apply segment cap","#if (SEGMENT_CAP_STYLE == 1) // round cap","\t\tvec2 delta = vec2(uv.y, uv.x - linewidth);","\t\tdiffuseColor.a *= clamp(linewidth - length(delta), 0.0, 1.0);","#else","\t\tdiffuseColor.a *= clamp(linewidth + 1.0 - uv.x, 0.0, 1.0);","#endif","\t}","","#include <logdepthbuf_fragment>","#include <color_fragment>","","#ifdef USE_DASH","\tfloat x = fract(vLineDistance * dashPeriod.y / dashScale);","\tvec4 dash = texture2D(dashAtlas, vec2(x * dashPeriod.z, 0.5));","\tdash.zw *= 255.0;","\tx *= dashPeriod.x;","\tdash.zw = vec2(dash.z - x, x - dash.w);","\tx = min(dash.z, dash.w) * dashScale;","#if (DASH_CAP_STYLE == 1) // round cap","\tvec2 delta = vec2(x * 2.0, uv.y);","\tdiffuseColor.a *= max(step(x / linewidth, 0.0), clamp(linewidth + 0.5 - length(delta), 0.0, 1.0));","#else // no cap","\tdiffuseColor.a *= clamp(0.5 - x, 0.0, 1.0);","#endif","#endif","","\tgl_FragColor = diffuseColor;","","#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","}"].join("\n");function r(e){THREE.ShaderMaterial.call(this,{type:"PolylineMaterial",uniforms:THREE.UniformsUtils.clone(i),vertexShader:n,fragmentShader:a});this.defines.DASH_CAP_STYLE=0;this.defines.SEGMENT_CAP_STYLE=0;this.defines.TRIM_STYLE=0;this._dashPattern=[];Object.defineProperties(this,{color:{enumerable:true,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},lineColor:{enumerable:true,get:function(){return this.uniforms.lineColor.value},set:function(e){this.uniforms.lineColor.value=e}},linewidth:{enumerable:true,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashCapStyle:{enumerable:true,get:function(){return this.defines.DASH_CAP_STYLE},set:function(e){this.defines.DASH_CAP_STYLE=e}},segmentCapStyle:{enumerable:true,get:function(){return this.defines.SEGMENT_CAP_STYLE},set:function(e){this.defines.SEGMENT_CAP_STYLE=e}},trimStyle:{enumerable:true,get:function(){return this.defines.TRIM_STYLE},set:function(e){this.defines.TRIM_STYLE=e}},dashScale:{enumerable:true,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashPattern:{enumerable:true,get:function(){return this._dashPattern},set:function(e){this._dashPattern=e;this._updateDashAtlas()}},resolution:{enumerable:true,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},lineLength:{enumerable:true,get:function(){return this.uniforms.lineLength.value},set:function(e){this.uniforms.lineLength.value=e}}});this.setValues(e)}r.prototype=Object.create(THREE.ShaderMaterial.prototype);r.prototype.constructor=r;r.prototype.isLineMaterial=true;r.prototype._updateDashAtlas=function(){if(!this._dashPattern.length){delete this.defines.USE_DASH;this.uniforms.dashAtlas.value=null;this.needsUpdate=true;return}var e=Array.from(this._dashPattern);if(e.length&1){e=e.concat(e)}var t=e.reduce(function(e,t){return e+Math.ceil(t)});var i=THREE.Math.ceilPowerOfTwo(t);this.uniforms.dashPeriod.value.set(t,1/t,t/i);var n=new Uint8Array(i*4);for(var a=0,r=0,s=0;a<e.length;a++){var o=e[a];var l=a&1?r+o:r;var d=a&1?r:r+o;var c=a&1?0:255;while(o-- >0){n[s++]=c;n[s++]=0;n[s++]=l;n[s++]=d;r++}}var u=new THREE.DataTexture(n,i,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);u.needsUpdate=true;this.defines.USE_DASH="";this.uniforms.dashAtlas.value=u;this.needsUpdate=true};r.prototype.copy=function(e){THREE.ShaderMaterial.prototype.copy.call(this,e);this.color.copy(e.color);this.lineColor.copy(e.lineColor);this.linewidth=e.linewidth;this.dashCapStyle=e.dashCapStyle;this.segmentCapStyle=e.segmentCapStyle;this.trimStyle=e.trimStyle;this.dashPattern=e.dashPattern;this.resolution=e.resolution;this.lineLength=e.lineLength;return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineMesh", ["../thirdparty/three","./PolylineGeometry","./PolylineMaterial"],function(e,t,r){"use strict";function a(e,a){var i=e!==undefined?e:new t;var l=a!==undefined?a:new r;THREE.Mesh.call(this,i,l);this.type="PolylineMesh"}a.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:a,isPolylineMesh:true,computeLineDistances:function(){var e=new THREE.Vector4;var t=new THREE.Vector4;var r=new THREE.Vector2;var a=new THREE.Vector2;return function(i,l,n){var c=this.geometry;var o=c.attributes.instanceDistance.data;var s=o.array;var p=c.vertices;var y=0,u;e.copy(p[0]).applyMatrix4(i);for(var w=0,d=0,f=o.count;w<f;w++,d+=2){t.copy(p[w+1]).applyMatrix4(i);if(n!==undefined){if(e.w>=n){r.copy(e).multiplyScalar(1/e.w);if(t.w>=n){a.copy(t).multiplyScalar(1/t.w)}else{u=(e.w-n)/(e.w-t.w);a.copy(t).sub(e).multiplyScalar(u).add(e).multiplyScalar(1/n)}}else if(t.w>=n){a.copy(t).multiplyScalar(1/t.w);u=(t.w-n)/(t.w-e.w);r.copy(e).sub(t).multiplyScalar(u).add(t).multiplyScalar(1/n)}else{r.set(0,0,0);a.set(0,0,0)}}else{r.copy(e);a.copy(t)}s[d]=y;y+=a.sub(r).multiply(l).length()*.5;s[d+1]=y;e.copy(t)}this.material.lineLength=y;o.needsUpdate=true;return this}}()});return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Scene", ["../Scene","./NodeHierarchy","../RenderMode","./ThreeExtensions","./ThreeUtils","sap/base/util/uid"],function(e,t,i,r,a,n){"use strict";var o=e.extend("sap.ui.vk.threejs.Scene",{metadata:{library:"sap.ui.vk"},constructor:function(t){e.call(this);this._id=n();this._scene=t;this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;this._animationSequenceMap=new Map;this._initialView=null;this._materialMap=new Map}});o.prototype.init=function(){this._outlineColor=new THREE.Vector4(0,0,0,1);this._outlineMaterial=new THREE.ShaderMaterial({uniforms:{color:{value:this._outlineColor}},vertexShader:["attribute vec3 normal1;","attribute vec3 normal2;","#include <clipping_planes_pars_vertex>","uniform vec4 color;","varying vec4 vColor;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvec3 eyeDirection = mvPosition.xyz;","\tvec3 n1 = normalMatrix * normal1;","\tvec3 n2 = normalMatrix * normal2;","\tvColor = color;","\tvColor.a *= step(dot(eyeDirection, n1) * dot(eyeDirection, n2), 0.0);","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","varying vec4 vColor;","void main() {","\t#include <clipping_planes_fragment>","\tif (vColor.a < ALPHATEST) discard;","\tgl_FragColor = vColor;","}"].join("\n"),depthWrite:false,depthFunc:THREE.LessEqualDepth,polygonOffset:true,polygonOffsetFactor:-4,blending:THREE.NormalBlending,alphaTest:.01,clipping:true});this._solidWhiteMaterial=new THREE.MeshBasicMaterial({color:16777215})};o.prototype.clearThreeScene=function(){if(!this._scene){return}var e=[];var t=[];a.getAllTHREENodes([this._scene],e,t);var i=new Map;var r=new Map;e.forEach(function(e){if(e instanceof THREE.Mesh){if(!i.has(e.geometry.uuid)){a.disposeGeometry(e);i.set(e.geometry.uuid,true)}if(e.material){if(!r.has(e.material.uuid)){a.disposeMaterial(e.material);r.set(e.material.uuid,true)}}if(e.userData&&e.userData.originalMaterial&&e.userData.originalMaterial.uuid!==e.material.uuid&&!r.has(e.userData.originalMaterial.uuid)){a.disposeMaterial(e.userData.originalMaterial);r.set(e.userData.originalMaterial.uuid,true)}}e.parent.remove(e)});t.forEach(function(e){e.parent.remove(e)});i.clear();r.clear()};o.prototype.destroy=function(){this.clearThreeScene();if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}a.disposeMaterial(this._solidWhiteMaterial);a.disposeMaterial(this._outlineMaterial);this._sceneBuilder=null;if(this._scene){this._scene.dispose()}this._scene=null;this._currentViewStateManager=null;this._animationSequenceMap.clear();this._materialMap.clear();e.prototype.destroy.call(this)};o.prototype.setDoubleSided=function(e){this.setProperty("doubleSided",e,true);this._scene.traverse(function(t){if(t.material!==undefined){var i=t.userData;var r=THREE.FrontSide;var a;if(i.originalMaterial){if(i.originalMaterial.userData===undefined){i.originalMaterial.userData={}}a=i.originalMaterial.userData;if(a.originalMaterialSide===undefined){a.originalMaterialSide=i.originalMaterial.side}r=a.originalMaterialSide}else{if(t.material.userData===undefined){t.material.userData={}}a=t.material.userData;if(a.originalMaterialSide===undefined){a.originalMaterialSide=t.material.side}r=a.originalMaterialSide}t.material.side=e?THREE.DoubleSide:r}});return this};o.prototype.setViewStateManager=function(e){this._currentViewStateManager=e;return this};o.prototype.getViewStateManager=function(){return this._currentViewStateManager};o.prototype.getId=function(){return this._id};o.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new t(this)}return this._defaultNodeHierarchy};o.prototype._computeBoundingBox=function(e,t,i){var r=new THREE.Box3;if(this._scene){this._scene._expandBoundingBox(r,e,t,i)}return r};o.prototype.getSceneRef=function(){return this._scene};o.prototype.setSceneBuilder=function(e){this._sceneBuilder=e};o.prototype.getSceneBuilder=function(){return this._sceneBuilder};o.prototype.nodeRefToPersistentId=function(e){return Array.isArray(e)?e.map(function(e){return e._vkPersistentId()}):e._vkPersistentId()};o.prototype.persistentIdToNodeRef=function(e){var t=this._sceneBuilder;if(Array.isArray(e)){return e.map(function(e){return t?t.getNode(e):null})}else{return t?t.getNode(e):null}};o.prototype.setNodePersistentId=function(e,t,i){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(e,t,i):false};o.prototype.setAnnotationPersistentId=function(e,t,i){return this._sceneBuilder?this._sceneBuilder.setAnnotationPersistentId(e,t,i):false};o.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[]}var e=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(e){return e.enumerateMaterials(true)}else{return[]}};var l=0;function s(e,t){var i=e.x-t.x;if(i<-l){return true}if(i>l){return false}var r=e.y-t.y;if(r<-l){return true}if(r>l){return false}return e.z-t.z<-l}function u(e,t,i){if(t<i){var r=c(e,t,i);u(e,t,r-1);u(e,r+1,i)}return e}function c(e,t,i){var r=e[i],a=t;for(var n=t;n<i;n++){if(s(e[n],r)){f(e,n,a);a++}}f(e,i,a);return a}function f(e,t,i){if(t!=i){var r=e[t];e[t]=e[i];e[i]=r}}var d=new THREE.Vector3;function h(e){e.computeBoundingBox();e.boundingBox.getSize(d);l=Math.max(d.x,d.y,d.z)*1e-4;var t=e.vertices,i=t.length,r=e.faces.length;if(i===0||r===0){return}var a,n;for(a=0;a<i;a++){t[a].index=a}u(t,0,t.length-1);var o=[],c=[];o.push(t[0]);c[t[0].index]=o.length-1;for(a=1;a<i;a++){if(s(o[o.length-1],t[a])){o.push(t[a])}c[t[a].index]=o.length-1}e.vertices=o;for(a=0,r=e.faces.length,n=0;a<r;a++){var f=e.faces[a];var h=e.faces[n];h.a=c[f.a];h.b=c[f.b];h.c=c[f.c];if(h.a!==h.b&&h.b!==h.c&&h.c!==h.a){n++}}e.faces.length=n}function p(e,t){THREE.BufferGeometry.call(this);this.type="OutlineGeometry";var i=Math.cos(THREE.Math.DEG2RAD*(t!==undefined?t:1));var r={},a,n;var o,l=["a","b","c"];var s=new THREE.Vector3;var u;if(e.isBufferGeometry){u=new THREE.Geometry;u.fromBufferGeometry(e)}else{u=e.clone()}h(u);u.computeFaceNormals();var c=u.vertices;var f=u.faces;for(var d=0,p=f.length;d<p;d++){var m=f[d];for(var v=0,y=2;v<3;y=v++){a=m[l[y]];n=m[l[v]];o=Math.min(a,n)+","+Math.max(a,n);if(r[o]===undefined){r[o]={index1:a,index2:n,face1:d,face2:undefined}}else{r[o].face2=d}}}var M=[];var _=[];var g=[];for(o in r){var E=r[o];if(E.face2===undefined||f[E.face1].normal.dot(f[E.face2].normal)<=i&&s.copy(c[E.index2]).sub(c[E.index1]).cross(f[E.face1].normal).dot(f[E.face2].normal)>0){var x=c[E.index1];M.push(x.x,x.y,x.z);x=c[E.index2];M.push(x.x,x.y,x.z);var B=f[E.face1].normal;_.push(B.x,B.y,B.z);_.push(B.x,B.y,B.z);if(E.face2!==undefined){var S=f[E.face2].normal;g.push(S.x,S.y,S.z);g.push(S.x,S.y,S.z)}else{g.push(0,0,0);g.push(0,0,0)}}}this.setAttribute("position",new THREE.Float32BufferAttribute(M,3));this.setAttribute("normal1",new THREE.Float32BufferAttribute(_,3));this.setAttribute("normal2",new THREE.Float32BufferAttribute(g,3))}p.prototype=Object.create(THREE.BufferGeometry.prototype);p.prototype.constructor=p;function m(e){return e===null||e.min.x>=e.max.x&&e.min.y>=e.max.y&&e.min.z>=e.max.z}function v(e){var t=null;if(e.isMesh&&e.geometry&&!m(e.geometry.boundingBox)&&!e.userData.skipIt){t=e.geometry;if(t.isBufferGeometry){t=(new THREE.Geometry).fromBufferGeometry(t)}}for(var i=0,r=e.children.length;i<r;i++){var a=e.children[i];if(a.isMesh&&a.geometry&&!m(a.geometry.boundingBox)&&a.userData.skipIt){if(t===null){t=new THREE.Geometry}var n=a.geometry;if(n.isBufferGeometry){n=(new THREE.Geometry).fromBufferGeometry(n)}t.merge(n,a.matrix)}}return t}function y(e,t){var i=e.userData;if(i.defaultMaterial===undefined){i.defaultMaterial=i.originalMaterial||e.material}e.material=t;i.originalMaterial=null;e._vkUpdateMaterialColor();e._vkUpdateMaterialOpacity()}function M(e){var t=e.userData;if(t.defaultMaterial){e.material=t.defaultMaterial;delete t.defaultMaterial;t.originalMaterial=null;e._vkUpdateMaterialColor();e._vkUpdateMaterialOpacity()}}o.prototype._createOutlineGeometry=function(e){if(this._scene){this._scene._vkTraverseMeshNodes(function(t){if(t.isOutline){t.visible=true}else{if(!t.hasOutline){var r;try{r=v(t)}catch(e){r=null}if(r!==null){t.hasOutline=true;var a=new p(r);a.boundingBox=new THREE.Box3;var n=new THREE.LineSegments(a,this._outlineMaterial);n.isOutline=true;n.renderOrder=t.renderOrder+.5;t.add(n)}}if(t.isMesh&&t.material&&!t.material.isLineBasicMaterial&&!t.material.isLineMaterial){switch(e){case i.LineIllustration:y(t,this._solidWhiteMaterial);break;case i.ShadedIllustration:var o=(t.userData.defaultMaterial||t.userData.originalMaterial||t.material).clone();if(o.emissive){o.color.multiplyScalar(.5);o.emissive.multiplyScalar(.5).addScalar(.5)}else{o.color.multiplyScalar(.5).addScalar(.5)}y(t,o);break;default:M(t);break}}}}.bind(this))}};o.prototype._hideOutlineGeometry=function(){if(this._scene){this._scene._vkTraverseMeshNodes(function(e){if(e.isOutline){e.visible=false}if(e.isMesh){M(e)}})}};o.prototype.getInitialView=function(){return this._initialView};o.prototype.setInitialView=function(e){this._initialView=e};o.prototype.getMaterial=function(e){return this._materialMap.get(e)};o.prototype.setMaterial=function(e,t){this._materialMap.set(e,t)};o.prototype.clearMaterials=function(){this._materialMap.forEach(function(e,t){e.destroy()});this._materialMap.clear()};o.prototype._getNativeMaterial=function(e){var t=e?this._materialMap.get(e):null;return t?t.getMaterialRef():null};o.prototype._setNodeMaterial=function(e,t){var i=this._getNativeMaterial(t);e.children.forEach(function(e){if(e.material){if(i){if(e.userData.materialId!==t){this._sceneBuilder._setSubmeshMaterial(e,i,t)}}else{var r=e.userData.initialMaterialId;if(r&&e.userData.materialId!==r){var a=this._getNativeMaterial(r);if(a){this._sceneBuilder._setSubmeshMaterial(e,a,r)}}}}}.bind(this))};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/SceneBuilder", ["../thirdparty/three","sap/base/Log","./BBoxSubdivider","./UsageCounter","../totara/TotaraUtils","./OrthographicCamera","./PerspectiveCamera","./DetailView","./AnimationHelper","./Thrustline","../View","./Billboard","./Callout","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","../LeaderLineMarkStyle","../DetailViewType","../DetailViewShape","../AnimationPlayback","../AnimationRotateType","../RenderMode","./Material","./MaterialType","./SphericalMapMaterial","../ObjectType","./MarchingCubes","./ParametricGenerators","../NodeContentType","./ThreeExtensions","sap/base/util/uid","./ThreeUtils","sap/base/assert","../colorToCSSColor"],function(e,t,a,i,r,n,s,o,d,l,u,h,c,p,f,m,v,g,y,_,w,D,b,I,S,M,T,C,x,A,k,N,O,R,V,P){"use strict";var E=function(e,t,a,i){this._rootNode=e;this._contentResource=t;this._resolve=a;this._reject=i;this._callouts=new Map;this._cameras=new Map;this._images=new Map;this._imageIdsAndTileWidths=new Map;this._imageTextures=new Map;this._geometries=new Map;this._meshNodes=new Map;this._meshSubmeshes=new Map;this._geometryMeshes=new Map;this._materialMeshes=new Map;this._materialClones=new Map;this._joints=[];this._annotations=new Map;this._imageAddedToMaterialHandlers=[];if(e){this._nodes=new Map;this._tracks=new Map;this._trackIdSequenceNodeMap=new Map;this._viewGroups=new Map;this._views=new Map}else{this._nodes=null;this._tracks=null;this._trackIdSequenceNodeMap=null;this._viewGroups=null;this._views=null}this._currentSceneId=null;this._sceneIdTreeNodesMap=new Map;this._sceneIdRootNodeMap=new Map;this._animationHelper=new d(this);if(t){var r=t.getNodeProxy();var n=r.getNodeHierarchy();this._vkScene=n.getScene();var s=t.getSource();if(s&&s.name){this._sceneIdTreeNodesMap.set(s.name,this._nodes);this._sceneIdRootNodeMap.set(s.name,e);this._currentSceneId=s.name}if(this._rootNode){this._rootNode.userData.skipIt=!t.getName()}}this._viewThumbnails=new Map;this._thrustlines=new Map;this._animations=new Map;this._animationTracks=new Map;this._jointNodesMap=new Map;this._jointParentsMap=new Map;this._upAxis=2;this._voxelThreshold=0};E.prototype.getVoxelThreshold=function(){return this._voxelThreshold};E.prototype.setVoxelThreshold=function(e){this._voxelThreshold=e;return this};var B=[I.Default,I.Default,I.Default,I.LineIllustration,I.SolidOutline,I.ShadedIllustration];E.prototype.setScene=function(e){this._vkScene.setSceneBuilder(this);var t=this._cameras.get(e.cameraId);this._upAxis=e.upAxis;this._resolve({node:this._rootNode,camera:t,backgroundTopColor:e.backgroundTopColor,backgroundBottomColor:e.backgroundBottomColor,upAxis:e.upAxis,annotations:this._annotations,contentResource:this._contentResource,builder:this})};E.prototype.setRootNode=function(e,t,a,i){this._rootNode=e;this._nodes=new Map;this._nodes.set(t,e);this._tracks=new Map;this._trackIdSequenceNodeMap=new Map;this._sequenceIdToPlaybacks=new Map;this._viewGroups=new Map;this._views=new Map;if(a){this._sceneIdTreeNodesMap.set(a,this._nodes);this._sceneIdRootNodeMap.set(a,e);this._currentSceneId=a}if(i){this._vkScene=i}return this};E.prototype._resetCurrentScene=function(e){if(e&&e!==this._currentSceneId){var t=this._sceneIdTreeNodesMap.get(e);if(t){this._nodes=t}else{this._nodes=null}var a=this._sceneIdRootNodeMap.get(e);if(a){this._rootNode=a}else{this._rootNode=null}this._currentSceneId=e}};E.prototype.getNode=function(e,t){if(t){this._resetCurrentScene(t);if(this._nodes){return this._nodes.get(e)}}else{var a=this._sceneIdTreeNodesMap.values();var i=a.next();while(!i.done){var r=i.value.get(e);if(r){return r}i=a.next()}}return null};E.prototype.hasMesh=function(e){return this._meshSubmeshes.has(e)};E.prototype.hasImage=function(e){return this._images.has(e)};E.prototype.hasAnnotation=function(e){return this._annotations.has(e)};E.prototype.setNodePersistentId=function(e,t,a){if(!e.userData.treeNode){e.userData.treeNode={}}var i=null;if(e.userData.treeNode.sid){i=e.userData.treeNode.sid;delete e.userData.treeNode.sid}this._resetCurrentScene(a);e.userData.treeNode.sid=t;if(this._nodes){if(i){this._nodes.delete(i)}this._nodes.set(t,e);return true}return false};E.prototype.setAnnotationPersistentId=function(e,t,a){this._resetCurrentScene(a);if(this._annotations){var i=this._annotations.get(e.id);if(i){this._annotations.delete(e.id);i.annotation.id=t;this._annotations.set(t,i);return true}}return false};var L=function(t){var a=new e.Matrix4;if(t.length===3){a.setPosition((new e.Vector3).fromArray(t))}else if(t.length===12){a.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1)}else if(t.length===16){a.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}else{throw"Invalid matrix format"}return a};var H={r:.0235,g:.0235,b:.0235};var q={r:.0602,g:.0602,b:.0602};E.prototype._createTemporaryMaterial=function(t,a){var i=new S(a||M.MeshPhongMaterial);var r=i.getMaterialRef();r.userData.defaultHighlightingEmissive=H;r.userData.defaultHighlightingSpecular=q;r.userData.materialUsed=0;r.userData.materialId=t;r.userData.toBeUpdated=true;if(this._vkScene.getDoubleSided()){r.side=e.DoubleSide;r.userData.originalMaterialSide=e.FrontSide}this._vkScene.setMaterial(t,i);var n=this._materialMeshes.get(t);if(n){n.forEach(function(e){this._updateMeshSubmeshesMaterial(e,t,r)},this)}return r};E.prototype._getMaterialRef=function(e){var t=this._vkScene.getMaterial(e);return t?t.getMaterialRef():null};E.prototype.checkMaterialExists=function(e,t){if(this._getMaterialRef(e)===null){if(t){this._createTemporaryMaterial(e)}return false}return true};E.prototype.materialNeeded=function(e){return true};E.prototype.attachImageAddedToMaterial=function(e,t){this._imageAddedToMaterialHandlers.push({func:e,listener:t});return this};E.prototype.detachImageAddedToMaterial=function(e,t){for(var a=0;a<this._imageAddedToMaterialHandlers.length;a++){var i=this._imageAddedToMaterialHandlers[a];if(i.func===e&&i.listener===t){this._imageAddedToMaterialHandlers.splice(a,1);return this}}return this};E.prototype.fireImageAddedToMaterial=function(e){var t=this._imageAddedToMaterialHandlers.slice();t.forEach(function(t){t.func.call(t.listener,e)});return this};E.prototype._attachMaterialClone=function(e,t){r.pushElementIntoMapArray(this._materialClones,e,t)};E.prototype._addDynamicObject=function(e,t,a){var i=this._rootNode.userData;if(!i._vkDynamicObjects){i._vkDynamicObjects=[]}if(i._vkDynamicObjects.indexOf(e)<0){i._vkDynamicObjects.push(e)}e._vkUpdate=t;if(a){e.userData.is2D=true}};E.prototype.createNode=function(t,a){this._resetCurrentScene(a);var i=new e.Group;this._nodes.set(t.sid,i);var r;var n=this._jointNodesMap.get(t.sid);if(n&&n.length){for(r=0;r<n.length;r++){n[r].node=i}}var s=this._jointParentsMap.get(t.sid);if(s&&s.length){for(r=0;r<s.length;r++){s[r].parent=i}}var o=this._nodes.get(t.parentId);(o||this._rootNode).add(i);var d=i.userData;d.treeNode=t;if(t.closed){d.closed=true}if(t.selectable===false){d.selectable=false}if(t.visualisable===false&&t.contentType!=="SYMBOL"){d.skipIt=true}if(t.metadata){d.metadata=t.metadata}if(t.veids){d.veids=t.veids}if(t.usageIds){d.usageIds=t.usageIds}if(t.sid){d.nodeId=t.sid}if(t.name){i.name=t.name}if(t.visible!==undefined){i.visible=!!t.visible}if(o){var l;if(d.skipIt||o.name&&i.name===o.name+" offset geometry"){d.skipIt=true}else{l=o;while(l){if(l.userData.closed){d.skipIt=true;d.skipItClosed=true}l=l.parent}}if(o.userData.symbolContent){d.skipIt=true;if(d.skipItClosed===true){d.skipItClosed=false}d.symbolContent=true}if(i.visible&&!d.skipIt&&this._contentResource){l=o;while(l){l.visible=true;l=l.parent}}}if(t.renderOrder){i.renderOrder=t.renderOrder}if(t.renderMethod){d.renderMethod=t.renderMethod}if(t.renderStage){d.renderStage=t.renderStage}d.opacity=t.opacity;if(t.transform){i.applyMatrix4(L(t.transform));if(!isFinite(i.quaternion.x)||!isFinite(i.quaternion.y)||!isFinite(i.quaternion.z)||!isFinite(i.quaternion.w)){i.quaternion.set(0,0,0,1)}}i.updateMatrixWorld(true);if(t.transformType){d.transformType=t.transformType;switch(t.transformType){case"ORTHO2D":d.originalTransform={p:i.position.clone(),q:i.quaternion.clone(),s:i.scale.clone()};this._addDynamicObject(i,h.prototype._ortho2DUpdate,true);break;case"BILLBOARD_VIEW":this._addDynamicObject(i,h.prototype._billboardViewUpdate,false);break;case"LOCK_TOVIEWPORT":this._addDynamicObject(i,h.prototype._lockToViewportUpdate,true);break;default:break}}if(t.materialId){d.materialId=t.materialId}if(t.geometryType){d.geometryType=t.geometryType}if(t.meshId){this.setMeshNode(t.sid,t.meshId)}if(t.parametricId){this.setParametricNode(t.sid,t.parametricId,t.visible)}if(i.parent.userData.objectType===C.Hotspot){d.objectType=C.Hotspot}else if(i.parent.userData.objectType===C.PMI){d.objectType=C.PMI}else if(t.contentType==="HOTSPOT"){d.objectType=C.Hotspot}else if(t.contentType==="PMI"){d.objectType=C.PMI}if(t.contentType==="REFERENCE"){i._vkSetNodeContentType(k.Reference)}else if(t.contentType==="ANNOTATION"){i._vkSetNodeContentType(k.Annotation)}else if(t.contentType==="BACKGROUND"){i._vkSetNodeContentType(k.Background)}else if(t.contentType==="SYMBOL"){i._vkSetNodeContentType(k.Symbol);d.symbolContent=true}return i};E.prototype.removeNode=function(e){this._nodes.delete(e._vkPersistentId());this._annotations.forEach(function(t){if(t.node===e){this._annotations.delete(t.annotation.id)}}.bind(this));e.children.forEach(this.removeNode,this)};E.prototype.hasNode=function(e){return this._nodes.has(e._vkPersistentId())};function G(t,a,r){var n;if(t.isPolyline){var s=null;if(a&&a.type===M.LineBasicMaterial){s=a}else{s=new e.LineBasicMaterial({color:16711680,linewidth:1});if(a){s.color.copy(a.color);s.userData.materialId=a.userData.materialId}}n=new e.LineSegments(t,s)}else{n=new e.Mesh(t,a)}if(t.isPositionQuantized){j(n,r.boundingBox)}i.increaseGeometryUsed(t);return n}E.prototype.getChildNodeIds=function(e,t,a){this._resetCurrentScene(t);var i=this._nodes.get(e);var r=[];if(!i){return r}if(i&&i.children){for(var n=0;n<i.children.length;n++){var s=i.children[n];if(s.userData.treeNode&&s.userData.treeNode.sid){r.push(s.userData.treeNode.sid)}else if(a&&s.userData.submeshInfo&&s.userData.submeshInfo.id){r.push(s.userData.submeshInfo.id)}}}return r};function W(e){for(var t=0;t<e.length;t++){if(e[t].type==="box"&&e[t].data){return e[t]}}return null}function z(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){if(e[t].type===undefined||e[t].type==="mesh"||e[t].type==="line"){return e[t]}}}return null}function j(e,t){if(t&&t.length===6){e.position.set((t[3]+t[0])*.5,(t[4]+t[1])*.5,(t[5]+t[2])*.5);e.scale.set(Math.max(t[3]-t[0],Number.EPSILON),Math.max(t[4]-t[1],Number.EPSILON),Math.max(t[5]-t[2],Number.EPSILON));e.updateMatrix()}}E.prototype.setSubmeshes=function(e){var t,a,i,r,n;for(var s=0,o=e.length;s<o;++s){t=e[s];a=t.submeshes;for(r=0,n=a.length;r<n;++r){i=a[r];this.insertSubmesh(i)}}};E.prototype.insertSubmesh=function(t,i){var n=this._getMaterialRef(t.materialId)||this._createTemporaryMaterial(t.materialId);var s,o;if(t.lods){var d=z(t.lods);if(!d){return false}o=this._geometries.get(d.id);if(o){s=G(o,n,d);if(o.userData&&o.userData.noNormal&&t.materialId){this.updateMaterialForGeometryWithoutNormal(t.materialId)}}else{var l=true;var u=d.boundingBox;if(u&&i){var h=(u[3]-u[0])/(i[3]-i[0]);var c=(u[4]-u[1])/(i[4]-i[1]);var p=(u[5]-u[2])/(i[5]-i[2]);l=h>this._voxelThreshold||c>this._voxelThreshold||p>this._voxelThreshold}var f;var m=l&&W(t.lods);if(m&&m.data){var v=r.base64ToUint8Array(m.data);var g=a.unpackSubDividedBoundingBox(v);f=x.march(g)}s=new e.Mesh(f?f:new e.BoxBufferGeometry(1,1,1),n);if(u&&u.length===6){var y=new e.Matrix4;y.scale(new e.Vector3(Math.max(u[3]-u[0],Number.EPSILON),Math.max(u[4]-u[1],Number.EPSILON),Math.max(u[5]-u[2],Number.EPSILON)));y.setPosition(new e.Vector3((u[3]+u[0])*.5,(u[4]+u[1])*.5,(u[5]+u[2])*.5));s.geometry.applyMatrix4(y)}s.userData.geometryId=d.id;s.userData.lodInfo=d;r.pushElementIntoMapArray(this._geometryMeshes,d.id,t.meshId)}}else{return false}if(t.transform){s.applyMatrix4(L(t.transform))}s.updateMatrixWorld(true);s.userData.submeshId=t.id;s.userData.initialMaterialId=t.materialId;s.userData.meshId=t.meshId;s.userData.materialId=t.materialId;s.userData.submeshInfo=t;r.pushElementIntoMapArray(this._materialMeshes,t.materialId,t.meshId);r.pushElementIntoMapArray(this._meshSubmeshes,t.meshId,s);var _=this._meshNodes.get(t.meshId);if(_){_.forEach(function(a){var i=s instanceof e.Mesh?s._vkClone():s.clone();if(a.userData.transformType==="ORTHO2D"){i.position.setScalar(0);i.scale.setScalar(1)}i.userData.skipIt=true;i.renderOrder=a.renderOrder;if(a.userData.materialId){R.disposeMaterial(i.material);i.material=this._getMaterialRef(a.userData.materialId)||s.material;i.userData.materialId=a.userData.materialId}if(i.material&&a.userData&&a.userData.geometryType&&(a.userData.geometryType==="PLANE"||a.userData.geometryType==="SURFACE")){i.material.side=e.DoubleSide;if(this._vkScene.getDoubleSided()){if(!i.material.userData){i.material.userData={}}i.material.userData.originalMaterialSide=e.DoubleSide}}a.add(i);i.updateMatrixWorld(true);U(a,t.materialId,this._materialClones)}.bind(this))}return true};function F(e,t,a,r){for(var n=0;n<e.length;n++){var s=e[n];if(t!=null&&s.userData.geometryId===t&&s.geometry!==a){if(s.type==="Mesh"&&!a.isPolyline){if(s.geometry){R.disposeGeometry(s)}s.geometry=a;if(a.isPositionQuantized&&!(s.parent&&s.parent.userData.transformType==="ORTHO2D")){j(s,s.userData.lodInfo.boundingBox)}s.updateMatrixWorld(true);i.increaseGeometryUsed(a)}else{var o=G(a,s.material,s.userData.lodInfo);o.position.copy(s.position);o.quaternion.copy(s.quaternion);o.scale.copy(s.scale);o.matrix.copy(s.matrix);o.updateMatrixWorld(true);o.userData=s.userData;o.renderOrder=s.renderOrder;o.parent=s.parent;e[n]=o;s.parent=null}}}}E.prototype._setSubmeshMaterial=function(e,t,a){i.increaseMaterialUsed(t);e.material=t;e.userData.materialId=a;delete e.userData.originalMaterial;e._vkUpdateMaterialOpacity();if(e.material!==t){r.pushElementIntoMapArray(this._materialClones,a,e.material)}};E.prototype._updateMaterial=function(e,t,a){e.children.forEach(function(e){if(e.material&&e.userData.materialId===t){this._setSubmeshMaterial(e,a,t)}}.bind(this))};E.prototype._updateMeshSubmeshesMaterial=function(e,t,a){var i=this._meshSubmeshes.get(e);if(i){i.forEach(function(e){if(e.material&&e.material.userData.materialId===t){e.material=a}})}};function U(e,t,a){e.children.forEach(function(e){if(e.material&&(!t||t===e.material.userData.materialId)){var i=e.material;e._vkUpdateMaterialOpacity();if(e.material!==i){r.pushElementIntoMapArray(a,e.material.userData.materialId,e.material)}}})}function K(t,a){var i=new Float32Array(t.length);var r=new e.Vector3;var n=new e.Vector3;var s=new e.Vector3;var o=new e.Vector3;var d,l;for(d=0,l=a.length;d<l;d+=3){var u=[a[d]*3,a[d+1]*3,a[d+2]*3];r.fromArray(t,u[0]);n.fromArray(t,u[1]).sub(r);s.fromArray(t,u[2]).sub(r);o.crossVectors(n,s).normalize();for(var h=0;h<3;h++){var c=u[h];i[c]+=o.x;i[c+1]+=o.y;i[c+2]+=o.z}}for(d=0,l=i.length;d<l;d+=3){o.fromArray(i,d).normalize().toArray(i,d)}return i}E.prototype.setGeometry=function(t){var a=new e.BufferGeometry;var i=t.data;var r=new e.BufferAttribute(new Uint16Array(i.indices),1);var n=new e.BufferAttribute(new Float32Array(i.points),3);a.setIndex(r);a.setAttribute("position",n);if(!t.isPolyline){if(!i.normals||i.normals.length!==n.array.length){i.normals=K(n.array,r.array)}var s=new e.BufferAttribute(new Float32Array(i.normals),3);a.setAttribute("normal",s);if(i.uvs&&i.uvs.length*3===i.points.length*2){a.setAttribute("uv",new e.BufferAttribute(new Float32Array(t.data.uvs),2))}}else{a.isPolyline=true}a.computeBoundingBox();a.computeBoundingSphere();a.isPositionQuantized=t.isPositionQuantized;a.userData.geometryId=t.id;a.userData.geometryUsed=0;this._geometries.set(t.id,a);var o=this._geometryMeshes.get(t.id);if(o){for(var d=0;d<o.length;d++){var l=o[d];var u=this._meshNodes.get(l);if(u){for(var h=0;h<u.length;h++){F(u[h].children,t.id,a)}}var c=this._meshSubmeshes.get(l);if(c){F(c,t.id,a)}}}if(this._fireSceneUpdated){this._fireSceneUpdated()}return this};E.prototype.setMeshNode=function(t,a){var i=this._nodes.get(t);if(i){r.pushElementIntoMapArray(this._meshNodes,a,i);var n=this._meshSubmeshes.get(a);if(n){n.forEach(function(t){var a=t instanceof e.Mesh?t._vkClone():t.clone();if(i.userData.transformType==="ORTHO2D"){a.position.setScalar(0);a.scale.setScalar(1)}a.userData.skipIt=true;a.renderOrder=i.renderOrder;if(i.userData.materialId){R.disposeMaterial(a.material);a.material=this._getMaterialRef(i.userData.materialId)||t.material;a.userData.materialId=i.userData.materialId}i.add(a)}.bind(this));U(i,null,this._materialClones)}}};E.prototype.setParametricNode=function(e,t,a){var i=this._nodes.get(e);if(i){i.userData.parametricVisible=a!==undefined?a:true}};E.prototype.progress=function(e){t.log("reading progress:",e)};E.prototype.loadingFinished=function(e){if(this._fireLoadingFinished){this._fireLoadingFinished(e)}};E.prototype.getGeometry=function(e){return this._geometries.get(e)};var Q={rect:m.RectangularShape,circle:m.CircularShape,none:m.None,textGlow:m.TextGlow};var Y={none:v.None,solid:v.Solid,dash:v.Dash,dot:v.Dot,dashdot:v.DashDot,dashdotdot:v.DashDotDot};var J={left:g.Left,center:g.Center,right:g.Right};var X={none:y.None,point:y.Point,arrow:y.Arrow};var Z=new e.Color;function $(t){var a=new e.Matrix4;var i=new e.Matrix4;var r=t;while(r&&r.userData.originalTransform){V(r.userData.transformType==="ORTHO2D");var n=r.userData.originalTransform;a.compose(n.p,n.q,n.s);i.premultiply(a);r=r.parent}i.decompose(t.position,t.quaternion,t.scale)}E.prototype.createAnnotation=function(a,i){this._resetCurrentScene(i);var r=this._nodes.get(a.nodeId);if(!r){t.warning("Annotation node not found",a);return}if(r.userData.originalTransform){$(r)}var n=a.type;if(n===undefined){this.createLegacyAnnotation(a,r);return}if(n==="html"){a.id=a.id||O();var s=[];if(a.leaderLines){a.leaderLines.forEach(function(e){if(e.start&&e.start.sid){s.push(this._nodes.get(e.start.sid))}},this)}this._annotations.set(a.id,{annotation:a,node:r,attachment:a.attachment&&a.attachment.sid?this._nodes.get(a.attachment.sid):null,targetNodes:s});return}var o=a.label||{};var d=a.text||{};var l=o.colour||[1,1,1,1];var u=o.borderColour||[0,0,0,1];var p={node:r,renderOrder:r.renderOrder||0,style:Q[o.shape]||m.RectangularShape,width:o.width||64,height:o.height||64,backgroundColor:Z.fromArray(l).getStyle(),backgroundOpacity:l[3],borderColor:Z.fromArray(u).getStyle(),borderOpacity:u[3],borderWidth:o.borderColour?o.borderWidth||0:0,borderLineStyle:Y[o.borderLineStyle]||v.Solid,horizontalAlignment:J[d.align]};if(d.html){p.encoding=f.HtmlText;p.text=d.html}else{p.encoding=f.PlainText;p.text=d.text;p.font=d.fontFace||"Arial";p.fontSize=Math.abs(d.fontSize)||16;p.fontWeight=Math.min(d.fontWeight,900);p.fontItalic=d.fontItalic;p.textColor=Z.fromArray(d.colour||[0,0,0]).getStyle()}if(n==="text"){var g=r.position;p.position=new e.Vector3(g.x*2,g.y*2,g.z);var y=new h(p);y.setText(p.text);this._addDynamicObject(r,y._update.bind(y),true)}else if(n==="note"){var _=a.attachment||{};p.position=(new e.Vector3).fromArray(_.position||[0,0,0]);p.anchorNode=this._nodes.get(_.sid)||this._rootNode;p.depthTest=false;var w=new c(p);w.setText(p.text);this._callouts.set(a.id,w);this._addDynamicObject(r,w._update.bind(w),false)}else{t.warning("Unsupported annotation type",a)}};var ee=[m.RectangularShape,m.CircularShape,m.None,m.TextGlow];var te=[p.Viewport,p.Screen,p.World];var ae=[v.None,v.Solid,v.Dash,v.Dot,v.DashDot,v.DashDotDot];var ie=[y.None,y.Point,y.Arrow];var re=[g.Left,g.Center,g.Right];function ne(e){var t=e.toString(16);if(e.length>=3){t=(e[0]*255<<16|e[1]*255<<8|e[2]*255).toString(16)}return"#"+"000000".substring(t.length)+t}function se(e){if(!e){return false}for(var t=0,a=e.length;t<a;t++){if(!isFinite(e[t])){return false}}return true}E.prototype.createLegacyAnnotation=function(a,i){var r=a.position;if(!se(r)){t.warning("Incorrect annotation position",a);return}a.coordinateSpace|=0;var n=a.backgroundOpacity;if(!n){n=a.backgroundColour?a.backgroundColour[3]:0}var s=a.borderOpacity;if(!s){s=a.borderColour?a.borderColour[3]:0}var o={node:i,coordinateSpace:te[a.coordinateSpace],style:ee[a.shape||0],width:a.width,height:a.height,backgroundColor:a.backgroundColour?ne(a.backgroundColour):"#fff",backgroundOpacity:n,borderColor:a.borderColour?ne(a.borderColour):"#000",borderOpacity:s,borderWidth:a.borderWidth,borderLineStyle:ae[a.borderLineStyle]};if(a.encoding!==undefined){o.encoding=a.encoding?f.HtmlText:f.PlainText;o.font=a.font;o.fontSize=a.fontSize;o.fontWeight=Math.min(a.fontWeight,900);o.fontItalic=a.fontItalic;o.textColor=ne(a.textColour);o.link=a.link;o.horizontalAlignment=re[a.textHorizontalAlignment];o.position=(new e.Vector3).fromArray(r)}else if(a.fontFace){o.encoding=f.PlainText;o.font=a.fontFace;o.fontSize=Math.abs(a.fontSize);o.fontWeight=Math.min(a.fontWeight,900);o.textColor=ne(a.textColour)}else{o.encoding=f.HtmlText}if(a.coordinateSpace<2){if(!o.positions){o.position=new e.Vector3(r[0]*2-1,r[1]*-2+1,r[2])}o.renderOrder=(a.order|0)+1e3;var d=new h(o);d.setText(a.text);this._addDynamicObject(i,d._update.bind(d),true)}else{o.anchorNode=this._nodes.get(a.sid)||this._rootNode;if(!o.position){o.position=(new e.Vector3).fromArray(r)}o.depthTest=false;o.renderOrder=a.order|0;if(a.alwaysOnTop){o.renderOrder=1}var l=new c(o);l.setText(a.text);this._callouts.set(a.id,l);this._addDynamicObject(i,l._update.bind(l),false)}};function oe(e){while(e){if(e.userData.transformType){return e.userData.transformType}e=e.parent}}E.prototype.createImageNote=function(a,i){this._resetCurrentScene(i);var r=this._nodes.get(a.nodeId);if(!r){t.warning("Image annotation node not found",a);return}if(r.userData.originalTransform){$(r)}if(a.type==="image"){var n=a.label||{};var s=n.materialId;var o=this._getMaterialRef(s);if(!o){t.warning("Image annotation material not found",a);return}if(n.projection==="spherical"){r.position.setScalar(0);r.scale.setScalar(1);n.width=-1;n.height=-1;r.userData.transformType="LOCK_TOVIEWPORT";r.userData.renderStage=-1;var d=o;o=new T({upAxis:this._upAxis,map:d.map,color:d.color});o.userData=d.userData;this._vkScene.getMaterial(s)._nativeMaterial=o}o.depthTest=false;o.depthWrite=false;o.blending=e.CustomBlending;o.side=e.DoubleSide;if(r.userData.renderStage===undefined){if(a.order){r.userData.renderStage=Math.sign(a.order)}else if(a.order===undefined&&oe(r)!==undefined){r.userData.renderStage=1}}switch(r.userData.transformType){case"ORTHO2D":case"LOCK_TOVIEWPORT":var l=new h({node:r,renderOrder:r.renderOrder||0,coordinateSpace:p.Screen,position:new e.Vector3(r.position.x,r.position.y,0),width:(n.width||200)*r.scale.x*.5,height:(n.height||200)*r.scale.y*.5});l.setMaterial(o);r.position.setScalar(0);r.scale.setScalar(1);this._addDynamicObject(r,l._update.bind(l),true);break;case"BILLBOARD_VIEW":default:var u=new e.Mesh(h.prototype._planeGeometry,o);u.scale.set(n.width,n.height,1);u.updateMatrix();r.add(u);break}}else{this.createLegacyImageNote(a,r)}};E.prototype.createLegacyImageNote=function(t,a){var i=(new e.Vector3).fromArray(t.position);var r=t.width;var n=t.height;if(!t.properlyAligned){i.x+=t.width*.5;i.y+=t.height*.5;i.applyMatrix4(a.matrix);r=t.width*.5*a.matrix.elements[0];n=t.height*.5*a.matrix.elements[5]}var s=this._getMaterialRef(t.labelMaterialId);s.depthTest=false;s.depthWrite=false;s.blending=e.CustomBlending;if(oe(a)==="LOCK_TOVIEWPORT"){var o=new h({node:a,coordinateSpace:p.Screen,renderOrder:(t.order|0)+1e3,position:i,width:r,height:n});o.setMaterial(s);this._addDynamicObject(a,o._update.bind(o),true)}else{var d=new e.Mesh(h.prototype._planeGeometry,s);d.renderOrder=(t.order|0)+1e3;d.position.copy(i);d.scale.set(r*2,n*2,1);d.updateMatrix();a.add(d);a.scale.setScalar(1);a.updateMatrix()}};E.prototype.insertLeaderLine=function(a,i){this._resetCurrentScene(i);var r=this._callouts.get(a.annotationId);if(r){var n=this._getMaterialRef(a.materialId);if(!n){t.warning("Leader line material not found",a);return}var s=[];var o=a.points;for(var d=0,l=o.length;d<l;d++){s.push((new e.Vector3).fromArray(o[d]))}var u;if(a.start){var h=a.start||{};var c=a.end||{};var p=a.extension||{};u=this._nodes.get(a.start.sid)||this._rootNode;r.addLeaderLine(s,u,n,X[h.style]||y.None,X[c.style]||y.None,h.size,p.length||0)}else{u=this._nodes.get(a.startPointSid)||this._rootNode;r.addLeaderLine(s,u,n,ie[a.startPointHeadStyle],ie[a.endPointHeadStyle],a.pointHeadConstant,a.extensionLength)}}};E.prototype._findDetailViewNodes=function(e){var a=[];if(e){e.forEach(function(e){var i=this._nodes.get(e);if(i){a.push(i)}else{t.warning("Unknown detailView node reference",e)}}.bind(this))}return a};E.prototype.createDetailView=function(a,i){this._resetCurrentScene(i);var r=this._nodes.get(a.nodeId);if(!r){t.warning("Detail view node not found",a);return}var n=a.label;if(!n){this.createLegacyDetailView(a,r);return}var s=a.attachment;var d={name:a.name,camera:n.camera?this.createCamera(n.camera):null,type:a.cutaway?_.Cutaway:_.DetailView,borderWidth:n.borderWidth||0,backgroundColor:Z.fromArray(n.colour||[1,1,1]).getStyle(),borderColor:Z.fromArray(n.borderColour||[1,1,1]).getStyle(),origin:new e.Vector2(r.position.x*2-1+r.scale.x,r.position.y*-2+1-r.scale.x),size:new e.Vector2(r.scale.x,r.scale.y),attachmentPoint:(new e.Vector3).fromArray(s.position||[0,0,0]),veId:a.veid,visibleNodes:this._findDetailViewNodes(a.visibleNodes),targetNodes:this._findDetailViewNodes(a.targetNodes)};if(n.shape==="rect"){d.shape=!n.leaderStyle||n.leaderStyle==="none"?w.Box:w.BoxLine}else{d.shape={none:w.Circle,line:w.CircleLine,pointer:w.CirclePointer,arrow:w.CircleArrow,bubbles:w.CircleBubbles}[n.leaderStyle]||w.Circle}var l=new o(d);if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[]}this._rootNode.userData._vkDetailViews.push({detailView:l,node:r,renderOrder:a.renderOrder||r.renderOrder||0})};E.prototype.createLegacyDetailView=function(t,a){if(!t.properlyAligned){if(!t.shape){t.shape=t.leaderStyle?w.BoxLine:w.Box}else{t.shape=[w.Circle,w.CircleLine,w.CirclePointer,w.CircleArrow,w.CircleBubbles][t.leaderStyle||0]}t.type=t.cutaway?_.Cutaway:_.DetailView;t.camera=t.camera?this.createCamera(t.camera):null;t.origin=new e.Vector2(a.position.x*2-1+a.scale.x,a.position.y*-2+1-a.scale.x);t.size=new e.Vector2(a.scale.x,a.scale.y);t.renderOrder=a.renderOrder}else{t.type=[_.DetailView,_.Cutaway][t.type];t.shape=[w.Box,w.Circle,w.CircleLine,w.CirclePointer,w.CircleArrow,w.CircleBubbles,w.BoxLine,w.BoxNoOutline,w.SolidPointer,w.SolidArrow][t.shape];t.camera=this._cameras.get(t.cameraId);t.origin=(new e.Vector2).fromArray(t.origin);t.size=(new e.Vector2).fromArray(t.size)}var i=new o({name:t.name,camera:t.camera,type:t.type,shape:t.shape,borderWidth:t.borderWidth||0,backgroundColor:t.backgroundColour?ne(t.backgroundColour):"#fff",borderColor:t.borderColour?ne(t.borderColour):"#000",origin:t.origin,size:t.size,attachmentPoint:(new e.Vector3).fromArray(t.attachment),metadata:t.metadata,veId:t.veid,visibleNodes:this._findDetailViewNodes(t.visibleNodes),targetNodes:this._findDetailViewNodes(t.targetNodes)});if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[]}this._rootNode.userData._vkDetailViews.push({detailView:i,node:a,renderOrder:t.renderOrder||0})};E.prototype.insertThrustline=function(t){var a=this._nodes.get(t.thrustlineId);if(a&&!this._thrustlines.get(t.thrustlineId)){var i=new l({node:a,principleAxis:(new e.Vector3).fromArray(t.principleAxis),material:this._getMaterialRef(t.materialId)});var r=[];var n=0;var s=0;var o=0;for(var d=0;d<t.itemCount;d++){var u={};u.target=this._nodes.get(t.targets[d]);u.majorAxisIndex=t.itemMajorAxisesIndices[d];var h;u.basisAxises=[];o=n+t.itemBasisAxisesCounts[d];for(h=n;h<o;h++){var c={};c.x=t.itemBasisAxisesCoordinates[h*3];c.y=t.itemBasisAxisesCoordinates[h*3+1];c.z=t.itemBasisAxisesCoordinates[h*3+2];u.basisAxises.push(c)}n=o;u.dimension={};u.dimension.x=t.itemDimensionsCoordinates[d*3];u.dimension.y=t.itemDimensionsCoordinates[d*3+1];u.dimension.z=t.itemDimensionsCoordinates[d*3+2];u.center={};u.center.x=t.itemCentersCoordinates[d*3];u.center.y=t.itemCentersCoordinates[d*3+1];u.center.z=t.itemCentersCoordinates[d*3+2];u.boundPoints=[];o=s+t.itemBoundPointsCounts[d];for(h=s;h<o;h++){var p={};p.x=t.itemBoundPointsCoordinates[h*3];p.y=t.itemBoundPointsCoordinates[h*3+1];p.z=t.itemBoundPointsCoordinates[h*3+2];u.boundPoints.push(p)}s=o;r.push(u)}i.setItems(r);var f=0;var m=[];for(var v=0;v<t.segmentCount;v++){var g={};g.startItemIndex=t.segmentsStartItemIndices[v];g.endItemIndex=t.segmentsEndItemIndices[v];g.startBoundIndex=t.segmentsStartBoundIndices[v];g.endBoundIndex=t.segmentsEndBoundIndices[v];g.ratios=[];o=f+t.segmentRatioCounts[v];for(var y=0;y<o;y++){var _={};_.x=t.segmentRatiosCoordinates[y*2];_.y=t.segmentRatiosCoordinates[y*2+1];g.ratios.push(_)}f=o;m.push(g)}i.setSegments(m);this._thrustlines.set(t.thrustlineId,i);this._addDynamicObject(a,i._update.bind(i),false)}};E.prototype.updateViewsForReplacedNodes=function(e){var t=new Map;e.forEach(function(e){var a=this._nodes.get(e.sid);if(a){t.set(e.sid,a)}},this);function a(e,t){var a=e.getNodeInfos();a.forEach(function(e){var a=e.target;if(a&&a.userData&&a.userData.treeNode&&a.userData.treeNode.sid){var i=t.get(a.userData.treeNode.sid);if(i){e.target=i;i.updateMatrixWorld()}}})}function i(t,a){var i;var r=t.getPlaybacks();for(var n=0;n<r.length;n++){var s=r[n];var o=s.getSequence();if(o){var d=false;var l=o.getNodeAnimation();for(var u=0;u<l.length;u++){var h=l[u];var c=h.nodeRef;if(c&&c.userData&&c.userData.treeNode&&c.userData.treeNode.sid){i=a.get(c.userData.treeNode.sid);if(i){o.removeNodeAnimation(c,null,true);for(var p in h){if(p==="nodeRef"){continue}o.setNodeAnimation(i,p,h[p],true)}d=true}}}var f=o.getJoint();for(var m=0;f&&m<f.length;m++){var v=f[m];if(v.parentSid){i=a.get(v.parentSid);if(i){v.parent=i;d=true}}if(v.nodeSid){i=a.get(v.nodeSid);if(i){v.node=i;d=true}}}if(d){o._fireSequenceChanged()}}}e.forEach(function(e){var t=e.target;if(t&&t.userData&&t.userData.treeNode&&t.userData.treeNode.sid){var i=a.get(t.userData.treeNode.sid);if(i){e.target=i;i.updateMatrixWorld()}}})}this._views.forEach(function(e,r){a(e,t);i(e,t)})};E.prototype._decrementResourceCounters=function(e){e.traverse(function(e){if(e.isMesh){i.decreaseMaterialUsed(e.material);i.decreaseGeometryUsed(e.geometry)}})};E.prototype.decrementResourceCountersForDeletedTreeNode=function(e,t){this._resetCurrentScene(t);var a=this;e=[].concat(e);e.forEach(function(e){var t=a._nodes.get(e);if(t){a._decrementResourceCounters(t);a._nodes.delete(e)}});return this};E.prototype.remove=function(e,t){this._resetCurrentScene(t);var a=this;e=[].concat(e);e.forEach(function(e){var i=a._nodes.get(e);if(i){a._decrementResourceCounters(i);if(i.parent){i.parent.remove(i)}a._nodes.delete(e);for(var r=0;r<i.children.length;r++){var n=i.children[r];if(n.userData&&n.userData.treeNode&&n.userData.treeNode.sid){a.remove(n.userData.treeNode.sid,t)}}}});return this};E.prototype.resourcesCleanUp=function(){var e=this._geometries;e.forEach(function(e){var t=e.userData.geometryUsed;if(t<=0){e.dispose()}});return this};E.prototype.createCamera=function(t,a){this._resetCurrentScene(a);var i=t.near||1;var r=t.far||2e5;if(t.origin.length===3&&t.origin[0]===0&&t.origin[1]===0&&t.origin[2]===0){t.ortho=false;t.rotate=true}var o;if(t.ortho){o=new e.OrthographicCamera(-1,1,1,-1,i,r);o.zoom=t.zoom||-1}else{o=new e.PerspectiveCamera(e.Math.radToDeg(t.fov),1,i,r)}if(t.origin){o.position.fromArray(t.origin)}if(t.up){o.up.fromArray(t.up);if(t.notUseDirectionVector){o.up.sub(o.position)}o.up.normalize()}if(t.rotate){o.userData.rotate=t.rotate;o.up.set(0,1,0)}if(t.target){var d=(new e.Vector3).fromArray(t.target);if(!t.notUseDirectionVector){d.add(o.position)}o.lookAt(d)}this._rootNode.userData.camera=o;var l=null;if(o.isOrthographicCamera){l=new n}else if(o.isPerspectiveCamera){l=new s}l.setCameraRef(o);l.setUsingDefaultClipPlanes(true);var u=t.id;if(u){this._cameras.set(u,l)}this._rootNode.userData.camera=l;return l};E.prototype.insertCamera=function(e,t,a){this._resetCurrentScene(a);var i=this._nodes.get(e);var r=this._cameras.get(t);if(i&&r){(i||this._rootNode).add(r.parent?r.clone():r)}return this};E.prototype.getCamera=function(e){return this._cameras.get(e)};E.prototype.updateMaterialForGeometryWithoutNormal=function(t){var a=this._getMaterialRef(t);if(a&&a.emissive){a.emissive.copy(a.color);a.side=e.DoubleSide;if(this._vkScene.getDoubleSided()){if(!a.userData){a.userData={}}a.userData.originalMaterialSide=e.DoubleSide}}return this};E.prototype.createMaterial=function(t){var a=[];var i=t.id;var n=this._getMaterialRef(i);var s;if(t.lineWidth>0){if(!n||!n.isLineBasicMaterial){s=new S(M.LineBasicMaterial);n=s.getMaterialRef();this._vkScene.setMaterial(i,s)}n.color=new e.Color(t.lineColour[0],t.lineColour[1],t.lineColour[2]);n.linewidth=t.lineWidth;n.userData.lineStyle={width:t.lineWidth,haloWidth:t.lineHaloWidth||0,endCapStyle:t.lineEndRound?1:0,dashPattern:t.lineDashPattern||[],dashPatternScale:t.lineDashPatternScale,widthCoordinateSpace:t.lineWidthCoordinateSpace};n.userData.materialInfo=t;n.userData.materialId=i;return a}var o=null;if(t.textureEmissive){if(!n||!n.isMeshBasicMaterial){o=n;n=this._createTemporaryMaterial(i,M.MeshBasicMaterial)}}if(!n){n=this._createTemporaryMaterial(i)}delete n.userData.toBeUpdated;n.userData.materialInfo=t;if(t.diffuseColour){n.color.fromArray(t.diffuseColour)}if(t.specularColour&&n.specular){n.specular.fromArray(t.specularColour)}var d=true;if(t.emissiveColour){if(n.emissive){n.emissive.fromArray(t.emissiveColour);if(n.emissive.r!==0||n.emissive.g!==0||n.emissive.b!==0){d=false;n.depthFunc=e.LessDepth}}else{n.color.fromArray(t.emissiveColour)}}if(d&&t.ambientColour&&n.emissive){n.emissive.fromArray(t.ambientColour);n.emissive.multiplyScalar(.2)}if(n.opacity!==undefined){n.opacity=t.opacity;n.transparent=t.opacity<.99;if(n.transparent){n.side=e.DoubleSide}}var l=n.glossiness?n.glossiness:0;var u=n.specularLevel?n.specularLevel:0;n.shininess=l*2+u*3;n.userData.defaultHighlightingEmissive=H;n.userData.defaultHighlightingSpecular=q;n.userData.imageIdsToAddAsTexture=new Set;var h,c;if(t.textureDiffuse){c=t.textureDiffuse;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}else if(t.textureDecal){c=t.textureDecal;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}if(t.textureBump){c=t.textureBump;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}if(t.textureEmissive){c=t.textureEmissive;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}if(t.textureAmbientOcclusion){c=t.textureAmbientOcclusion;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}if(t.textureReflection){c=t.textureReflection;h=c[0]||c;n.userData.imageIdsToAddAsTexture.add(h.imageId)}if(n.userData.imageIdsToAddAsTexture.size===0){delete n.userData.imageIdsToAddAsTexture}a=this.updateTextureMaps(i);if(a.length>0){n.userData.imageIdsToLoad=new Set;for(var p=0;p<a.length;p++){var f=a[p];r.pushElementIntoMapArray(this._imageTextures,f.imageId,{textureType:f.textureType,materialId:i});n.userData.imageIdsToLoad.add(f.imageId)}}var m=this._materialMeshes.get(i);if(m){for(var v=0;v<m.length;v++){var g=m[v];var y=this._meshNodes.get(g);if(y){for(var _=0;_<y.length;_++){this._updateMaterial(y[_],i,n)}}if(o){this._updateMeshSubmeshesMaterial(g,i,n)}}}if(o){R.disposeMaterial(o)}return a};E.prototype.getMaterial=function(e){return this._getMaterialRef(e)};var de=function(e){var t="";try{var a=32768;var i=0;var r=e.length;var n;while(i<r){n=e.slice(i,Math.min(i+a,r));t+=String.fromCharCode.apply(null,n);i+=a}}catch(e){t=""}return t};E.prototype.createImage=function(e){if(e.binaryData.length<32){t.warning("SceneBuilder.createImage()","Can't create image from empty data");return this}var a=new DataView(e.binaryData.buffer);var i=true;if(a.getUint8(0,true)===parseInt("0xFF",16)&&a.getUint8(1,true)===parseInt("0xD8",16)){i=false}var r=de(e.binaryData);var n="data:image/"+(i?"png":"jpeg")+";base64,"+btoa(r);this._images.set(e.id,n);var s=this._imageTextures.get(e.id);if(s){this._imageTextures.delete(e.id);for(var o=0;o<s.length;o++){var d=s[o];this.updateTextureMap(d.materialId,d.textureType)}}return this};var le=new e.TextureLoader;var ue={Diffuse:0,Bump:1,Opacity:2,Reflection:3,Refraction:4,Specular:5,Ambient:6,Emissive:7,SpecularLevel:8,Glossiness:9,AmbientOcclusion:10,Decal:11};E.prototype.updateTextureMaps=function(e){var t=[];var a=this._getMaterialRef(e);if(!a){return t}var i=a.userData.materialInfo;if(!i){return t}if(i.textureDiffuse){var r=this.updateTextureMap(e,ue.Diffuse);if(r.imageId){t.push(r)}}else if(i.textureDecal){var n=this.updateTextureMap(e,ue.Decal);if(n.imageId){t.push(n)}}if(i.textureBump){var s=this.updateTextureMap(e,ue.Bump);if(s.imageId){t.push(s)}}if(i.textureEmissive){var o=this.updateTextureMap(e,ue.Emissive);if(o.imageId){a[a.emissive?"emissive":"color"].setRGB(1,1,1);t.push(o)}}if(i.textureAmbientOcclusion){var d=this.updateTextureMap(e,ue.AmbientOcclusion);if(d.imageId){t.push(d)}}if(i.textureReflection){var l=this.updateTextureMap(e,ue.Reflection);if(l.imageId){t.push(l)}}return t};E.prototype.updateTextureMap=function(t,a){var i={textureType:a,imageId:null};var r=this._getMaterialRef(t);if(!r){return i}var n=r.userData.materialInfo;if(!n){return i}var s=null;switch(a){case ue.Diffuse:s=n.textureDiffuse;break;case ue.Decal:s=n.textureDecal;break;case ue.Bump:s=n.textureBump;break;case ue.Reflection:s=n.textureReflection;break;case ue.Emissive:s=n.textureEmissive;break;case ue.AmbientOcclusion:s=n.textureAmbientOcclusion;break;default:break}if(!s){return i}var o=s[0]||s;var d=this._images.get(o.imageId);if(!d){i.imageId=o.imageId;return i}if(r.userData.imageIdsToLoad){r.userData.imageIdsToLoad.delete(o.imageId);if(r.userData.imageIdsToLoad.size===0){delete r.userData.imageIdsToLoad}}if(r.userData.parametricType==="sphere"){o.uvHorizontalScale=-1}var l=o.influence!==undefined?o.influence:0;function u(t,i){switch(a){case ue.Diffuse:case ue.Decal:t.map=i;t.transparent|=d.startsWith("data:image/png");break;case ue.Bump:t.bumpMap=i;t.bumpScale=l;break;case ue.Opacity:t.alphaMap=i;break;case ue.Reflection:i.mapping=e.EquirectangularReflectionMapping;t.envMap=i;t.combine=e.AddOperation;t.reflectivity=l;break;case ue.Emissive:t[t.emissiveMap!==undefined?"emissiveMap":"map"]=i;if(t.isSphericalMapMaterial){i.minFilter=e.LinearFilter}break;case ue.AmbientOcclusion:t.aoMap=i;break;default:}t.needsUpdate=true}le.load(d,function(a){a.wrapS=o.uvHorizontalTilingEnabled?e.RepeatWrapping:e.ClampToEdgeWrapping;a.wrapT=o.uvVerticalTilingEnabled?e.RepeatWrapping:e.ClampToEdgeWrapping;a.magFilter=o.filterMode===1?e.NearestFilter:e.LinearFilter;a.minFilter=o.filterMode===1?e.NearestFilter:e.LinearMipMapLinearFilter;a.anisotropy=4;var i=o.uvHorizontalOffset||0;var n=o.uvVerticalOffset||0;a.repeat.set(o.uvHorizontalScale||1,o.uvVerticalScale||1);a.center.set(-i,-n);a.offset.set(i,n);a.rotation=-o.uvRotationAngle;if(r.isMeshBasicMaterial){a.generateMipmaps=false;a.minFilter=o.filterMode===1?e.NearestFilter:e.LinearFilter}u(r,a);if(r.userData.imageIdsToAddAsTexture&&o.imageId){r.userData.imageIdsToAddAsTexture.delete(o.imageId);if(r.userData.imageIdsToAddAsTexture.size===0){delete r.userData.imageIdsToAddAsTexture}}var s=this._materialClones.get(t);if(s){s.forEach(function(e){u(e,a)})}this.fireImageAddedToMaterial({materialId:t});if(this._fireSceneUpdated){this._fireSceneUpdated()}}.bind(this));return i};E.prototype.insertPlayback=function(e,t,a){this._resetCurrentScene(a);var i=this._vkScene.findSequence(e.sequenceId);var n=new D(e.id,{sequence:i,timeScale:e.speed?1/e.speed:1,preDelay:e.preDelay?e.preDelay:0,postDelay:e.postDelay?e.postDelay:0,repeats:e.repeat?Math.abs(e.repeat):0,reversed:e.reversed?true:false,startTime:e.start?e.start:0});var s=this._views.get(t);if(s){s.addPlayback(n)}if(!i){r.pushElementIntoMapArray(this._sequenceIdToPlaybacks,e.sequenceId,n)}return this};E.prototype.insertSequence=function(e,t){var a=this._vkScene.findSequence(e.id);if(a){return this}var i;if(e.endTime){if(e.startTime){i=e.endTime-e.startTime}else{i=e.endTime}}else{i=1}a=this._vkScene.createSequence(e.id,{name:e.name,duration:i});if(Array.isArray(e.joints)){e.joints.forEach(function(e){var t=this._joints[e];if(t){a.setJoint(t,true)}}.bind(this))}if(e.nodes&&e.nodes.length>0){for(var n=0;n<e.nodes.length;n++){var s=e.nodes[n];if(s.empty){s.type=s.binding;var o=this._nodes.get(s.sid);this._animationHelper.insertEmptyTrack(s,a,o,this._vkScene);continue}r.pushElementIntoMapArray(this._trackIdSequenceNodeMap,s.trackId,{sequenceId:e.id,targetId:s.sid,type:s.binding,pivot:s.pivot,isAbsoluteValue:s.isAbsoluteValue})}}var d=this._sequenceIdToPlaybacks.get(e.id);if(d){d.forEach(function(e){e.setSequence(a)})}return this};E.prototype.insertTracks=function(e){this._animationHelper.insertTracks(e,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);return this};E.prototype.insertJoints=function(e,t){this._resetCurrentScene(t);this._joints=[];e.forEach(function(e){var t=this._nodes.get(e.childSid);var a=this._nodes.get(e.parentSid);var i={id:e.id,node:t,parent:a,translation:new Float32Array(e.t?e.t:[0,0,0]),quaternion:new Float32Array(e.q?e.q:[0,0,0,1]),scale:new Float32Array(e.s?e.s:[1,1,1])};if(!t){var r=this._jointNodesMap.get(e.childSid);if(!r){r=[]}r.push(i);this._jointNodesMap.set(e.childSid,r)}if(!a){var n=this._jointParentsMap.get(e.parentSid);if(!n){n=[]}n.push(i);this._jointParentsMap.set(e.parentSid,n)}this._joints.push(i)}.bind(this));return this};E.prototype.finalizeAnimation=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent}e.userData.tracks=this._tracks}return this};E.prototype.finalizePlaybacks=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent}}else{return this}if(!e.userData.animationNodeOriginalData){e.userData.animationNodeOriginalData=new Map}var t;var a=this._viewGroups.entries();var i=a.next();while(!i.done){t=i.value[1];i=a.next();var r=[];for(var n=0;n<t.getViews().length;n++){if(t.getViews()[n].id){var s=this._views.get(t.getViews()[n].id);if(s){r.push(s)}}}}return this};E.prototype.finalizeViewGroups=function(e){this._resetCurrentScene(e);var t=this._viewGroups.entries();var a=t.next();while(!a.done){var i=a.value[1];var r=a.value[0];if(!i||!i.views||!i.views.length){a=t.next();continue}i.removeViews();for(var n=0;n<i.views.length;n++){var s=i.views[n].id;var o=this._views.get(s);if(o&&o.userData.viewInfo.thumbnailId&&!o.thumbnailData){var d=this._images.get(o.userData.viewInfo.thumbnailId);if(d){o.thumbnailData=d}}if(o){o.viewGroupId=r;i.addView(o)}}a=t.next()}return this};E.prototype.insertViewGroup=function(e,t){this._resetCurrentScene(t);var a=this._viewGroups.get(e.id);if(!a){a=this._vkScene.createViewGroup({viewGroupId:e.id,name:e.name,description:e.description});this._viewGroups.set(e.id,a)}else{a.setViewGroupId(e.id);a.setName(e.name);a.setDescription(e.description)}a.type=e.type;a.metadata=e.metadata;a.veids=e.veids;a.views=e.views;a.sceneId=e.sceneId;return this};E.prototype.getViewGroup=function(e,t){this._resetCurrentScene(t);var a=this._viewGroups.get(e);var i=[];if(a&&a.views){for(var r=0;r<a.views.length;r++){var n=a.views[r].id;var s=this._views.get(n);if(s){i.push(s)}}}return i};E.prototype.insertView=function(e,t){this._resetCurrentScene(t);if(e.description){var a=new RegExp("^<[^>]*?>");if(a.test(e.description)){var i=new RegExp("(^(<[^>]*?>s*)+)|((<[^>]*?>s*)+$)","g");var r=e.description.replace(i,"");if(!r){e.description=r}}}var n=this._vkScene.createView({viewId:e.viewId,name:e.name,description:e.description?'<pre class="sapVizKitViewGalleryStepDescriptionPre">'+e.description+"</pre>":e.description,aspectRatio:e.safeAreaAspectRatio,autoPlayAnimation:e.autoPlayAnimation});n.userData={};n.userData.viewInfo=e;if(e.thumbnailId){var s=this._images.get(e.thumbnailId);if(s){n.thumbnailData=s}else{this._viewThumbnails.set(e.thumbnailId,n)}}if(e.animatedThumbnailId){var o=this._images.get(e.animatedThumbnailId);if(o){n.animatedThumbnailData=o;n.tileWidth=this._imageIdsAndTileWidths.get(e.animatedThumbnailId)}}if(e.cameraId){n.setCamera(this._cameras.get(e.cameraId))}n.type=e.type;n.flyToTime=e.flyToTime;n.preDelay=e.preDelay;n.postDelay=e.postDelay;n.navigationMode=e.navigationMode;var d=this._getSavedColor(e.topColour,localStorage.getItem("color.backgroundTop"));if(d!=null){n.setTopColor(d)}var l=this._getSavedColor(e.bottomColour,localStorage.getItem("color.backgroundBottom"));if(l!=null){n.setBottomColor(l)}n.renderMode=B[e.renderMethod];n.dimension=e.dimension;n.query=e.query;n.metadata=e.metadata;n.veids=e.veids;n.viewGroupId=e.viewGroupId;n.id=e.viewId;this._views.set(e.viewId,n);if(n.viewGroupId){var u=this._viewGroups.get(n.viewGroupId);if(u){u.addView(n)}}return this};E.prototype.setModelViewVisibilitySet=function(e){var a=this._views.get(e.viewId);var i=new Set;var r=[];e.visibleNodes.forEach(function(e){var a=this._nodes.get(e);if(a){i.add(a);r.push({target:a,visible:true})}else{t.warning("Unknown modelView visible node reference",e)}}.bind(this));Array.from(i).forEach(function(e){e=e.parent;while(e&&!i.has(e)){i.add(e);r.push({target:e,visible:true});e=e.parent}});if(a){a.updateNodeInfos(r)}};E.prototype.recordHighlightedNodeInView=function(e,t,a,i){this._resetCurrentScene(i);var r=this._views.get(a);if(!r){return this}var n=this._nodes.get(t);if(!n){return this}r.addHighlightedNodes(e,n);return this};E.prototype.insertHighlightStyle=function(e){var t=this._vkScene.getHighlight(e.id);if(t){return this}if(e.duration>0){if(e.colours&&e.colours.length===1&&(!e.opacities||e.opacities.length===1)){var a=e.colours[0];e.colours.push([a[0],a[1],a[2],0])}else if(!e.colours&&e.opacities&&e.opacities.length===1){e.opacities.push(0)}}this._vkScene.createHighlight(e.id,e);return this};E.prototype.insertModelViewHighlight=function(t){var a=this._views.get(t.viewId);if(a){var i=[];t.highlightNodes.forEach(function(e){var t=this._nodes.get(e);if(t){i.push(t)}else{}}.bind(this));var r={duration:t.duration,cycles:t.cycles};if(!t.id){t.id=e.Math.generateUUID().toLowerCase()}var n=new e.Color(t.color1).toArray();var s=new e.Color(t.color2).toArray();n[3]=(t.color1>>>24&255)/255;s[3]=(t.color2>>>24&255)/255;r.colours=[n,s];r.opacities=[t.opacity1,t.opacity2];this._vkScene.createHighlight(t.id,r);a.addHighlightedNodes(t.id,i)}};E.prototype.createThumbnail=function(e){var t=this._viewThumbnails.get(e.imageId);if(t){t.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,e.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:t})}}};E.prototype.highlightStyleExists=function(e){var t=this._vkScene.getHighlight(e);return t!==undefined};E.prototype.getView=function(e,t){this._resetCurrentScene(t);return this._views.get(e)};E.prototype.getSequence=function(e){return this._vkScene.findSequence(e)};E.prototype.setViewCamera=function(e,t,a){this._resetCurrentScene(a);var i=this._cameras.get(e);var r=this._views.get(t);if(i&&r){r.setCamera(i)}return this};E.prototype.setViewNodeInfos=function(e,t,a){this._resetCurrentScene(a);var i=this._views.get(t);i.setNodeInfos(e);return this};E.prototype.setViewThumbnail=function(e,t,a,i){this._resetCurrentScene(a);var r=this._views.get(t);var n=this._images.get(e);if(i){this._imageIdsAndTileWidths.set(e,i)}if(r&&n){if(r.userData!==undefined){if(r.userData.viewInfo.thumbnailId===e){r.thumbnailData=n}else if(r.userData.viewInfo.animatedThumbnailId===e){r.animatedThumbnailData=n;r.tileWidth=i}}}return this};E.prototype.cleanup=function(){this._rootNode=null;this._currentSceneId=null;this._contentResource=null;this._resolve=null;this._reject=null;if(this._vkScene){this._vkScene.clearMaterials()}this._callouts.forEach(function(e){e.destroy()});this._callouts.clear();this._cameras.forEach(function(t){if(!t instanceof e.Camera){t.destroy()}});this._cameras.clear();this._images.clear();this._imageIdsAndTileWidths.clear();this._imageTextures.clear();this._geometries.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._geometryMeshes.clear();this._materialMeshes.clear();this._materialClones.clear();this._joints=[];this._annotations.clear();this._imageAddedToMaterialHandlers=[];if(this._nodes){this._nodes.clear()}if(this._tracks){this._tracks.clear()}if(this._trackIdSequenceNodeMap){this._trackIdSequenceNodeMap.clear()}if(this._viewGroups){this._viewGroups.clear()}if(this._views){this._views.clear()}this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._viewThumbnails.clear();this._thrustlines.clear();this._animations.clear();this._animationTracks.clear();this._jointNodesMap.clear();this._jointParentsMap.clear()};E.prototype.insertAnimationGroup=function(e){var t=this._vkScene.findSequence(e.animationGroupRef.toString());if(!t){var a;if(e.endTime){a=e.endTime-e.startTime;if(!e.startTime){e.startTime=0}}t=this._vkScene.createSequence(e.animationGroupRef.toString(),{name:e.name,duration:a});if(!t.userData){t.userData={}}t.userData.animations=[]}if(e.modelViewRef){var i=this._views.get(e.modelViewRef);if(i){var r=this._vkScene.findSequence(e.animationGroupRef.toString());var n=new D({sequence:r,timeScale:e.playbackSpeed?1/e.playbackSpeed:1,preDelay:e.playbackPreDelay?e.playbackPreDelay:0,postDelay:e.playbackPostDelay?e.playbackPostDelay:0,repeat:e.playbackRepeat?Math.abs(e.playbackRepeat):0,reversed:e.playbackReversed?true:false,startTime:0});i.addPlayback(n)}}};E.prototype.insertAnimation=function(e){var t=this._animations.get(e.animationRef);if(!t){t={};t.type=e.animationType;t.targetRefs=[];t.targetPivots=[];t.sequenceId=e.animationGroupRef.toString();t.trackIds=new Set;t.tracks=[];this._animations.set(e.animationRef,t)}if(e.animationGroupRef){var a=this._vkScene.findSequence(e.animationGroupRef.toString());if(!a.userData.animations.includes(e.animationRef)){a.userData.animations.push(e.animationRef)}}};E.prototype.insertAnimationTarget=function(e){var t=this._animations.get(e.animationRef);if(t){if(!t.targetRefs.includes(e.targetRef)){t.targetRefs.push(e.targetRef);t.targetPivots.push({x:e.targetPivotX,y:e.targetPivotY,z:e.targetPivotZ})}}};E.prototype.insertAnimationTrack=function(e){var t=this._animationTracks.get(e.animationTrackRef);var a=e.animationRef;if(!t){delete e.animationRef;t=e;this._animationTracks.set(e.animationTrackRef,t)}if(!a){return}var i=this._animations.get(a);if(!i||!i.sequenceId){return}if(i.trackIds.has(t.animationTrackRef)){return}i.trackIds.add(t.animationTrackRef);for(var n=0;i.targetRefs&&n<i.targetRefs.length;n++){var s=i.targetRefs[n];var o=i.targetPivots[n];var d=this._nodes.get(s);if(!d){continue}var l;if(o.x!==0||o.y!==0||o.z!==0){l=[o.x,o.y,o.z]}var u=["OPACITY","COLOUR","TRANSLATE","SCALE","ROTATE"][t.type]||"";r.pushElementIntoMapArray(this._trackIdSequenceNodeMap,e.animationTrackRef,{sequenceId:i.sequenceId,targetId:s,type:u,pivot:l,isAbsoluteValue:true});var h={};h.times=Array.prototype.slice.call(t.times);h.values=Array.prototype.slice.call(t.values);h.id=e.animationTrackRef;h.cyclicInfo={};h.cyclicInfo.cyclicStart=t.cyclicStart;h.cyclicInfo.cyclicEnd=t.cyclicEnd;var c;if(i.type===0){if(t.dataType===0){if(t.values.length!==t.keyCount||t.times.length!==t.keyCount){continue}if(t.type===3){h.values=[];for(c=0;c<t.keyCount;c++){h.values.push(t.values[c]);h.values.push(t.values[c]);h.values.push(t.values[c])}}}else if(t.dataType===1||t.dataType===3){if(t.values.length!==3*t.keyCount||t.times.length!==t.keyCount){continue}}else if(t.dataType===4||t.dataType===5||t.dataType===6){if(t.values.length!==4*t.keyCount||t.times.length!==t.keyCount){continue}if(t.dataType===4){h.rotateType=b.AngleAxis}else if(t.dataType===6){h.rotateType=b.Euler}else{h.rotateType=b.Quaternion;for(var p=3;p<h.values.length;p=p+4){h.values[p]=-h.values[p]}}}}i.tracks.push(h)}};E.prototype.setAnimationTracks=function(e){var t=this._animations.get(e);if(t){this._animationHelper.insertTracks(t.tracks,this._trackIdSequenceNodeMap,this._nodes,this._vkScene)}};E.prototype.setAnimationPlaybacks=function(e){var t=this._viewGroups.get(e.viewGroupId);this._animationHelper.setInitialNodePositionsFromSubsequentViews(t.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromPreviousViews(t.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromCurrenetViews(t.getViews(),this._vkScene);this._animationHelper.setPlaybackStartTimes(t.getViews(),this._vkScene);this._animationHelper.buildViewsInitialState(t.getViews(),this._vkScene)};E.prototype.getSphere=function(e,t,a){var i=A.generateSphere(t,a);if(e.userData&&e.userData.nodeContentType){i.userData.nodeContentType=e.userData.nodeContentType}i.userData.skipIt=true;i.renderOrder=e.renderOrder;e.add(i)};E.prototype.getPlane=function(e,t,a){var i=A.generatePlane(t,a);if(e.userData&&e.userData.nodeContentType){i.userData.nodeContentType=e.userData.nodeContentType}i.userData.skipIt=true;i.renderOrder=e.renderOrder;e.add(i)};E.prototype.preferMeshes=function(){return true};E.prototype.setParametricContent=function(e,a,i){this._resetCurrentScene(i);var r={sphere:this.getSphere.bind(this),plane:this.getPlane.bind(this)};if(a.type in r===false){t.warning("Attempt to load unknown parametric type: "+a.type);return}var n=a.type;var s=this.getNode(e,this.sceneId);var o=a.materialID;var d=null;if(o){d=this._getMaterialRef(o)||this._createTemporaryMaterial(o);if(s.userData.parametricVisible){d.userData.parametricType=n}}r[n](s,a,d)};E.prototype.insertFillStyle=function(e){};E.prototype.insertLineStyle=function(e){};E.prototype.insertTextStyle=function(e){};E.prototype._getSavedColor=function(e,t){if(e&&e.length>2){return P({red:Math.floor(e[0]*255),green:Math.floor(e[1]*255),blue:Math.floor(e[2]*255),alpha:e.length>3?e[3]:1})}else if(t){return t}return undefined};return E});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/SphericalMapMaterial", ["../thirdparty/three"],function(e){"use strict";var t=["#ifdef USE_MAP","\tvarying vec3 vEyeDirection;","#endif","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","#ifdef USE_MAP","\tif (isOrthographic) {","\t\tvEyeDirection = vec3(-viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2]);","\t} else {","\t\tvec4 worldPosition = modelMatrix * vec4(transformed, 1.0);","\t\tvEyeDirection = worldPosition.xyz - cameraPosition;","\t}","#endif","}"].join("\n");var i=["#define RECIPROCAL_PI 0.3183098861837907","#define RECIPROCAL_PI2 0.15915494309189535","#include <map_pars_fragment>","uniform vec3 color;","uniform float opacity;","#ifdef USE_MAP","\tvarying vec3 vEyeDirection;","#endif","void main() {","#ifdef USE_MAP","#if UP_AXIS == 4","\tvec2 texCoord = vec2(atan(vEyeDirection.x, vEyeDirection.y), acos(-vEyeDirection.z / length(vEyeDirection))) * vec2(RECIPROCAL_PI2, RECIPROCAL_PI);","#else","\tvec2 texCoord = vec2(atan(vEyeDirection.z, vEyeDirection.x), acos(-vEyeDirection.y / length(vEyeDirection))) * vec2(RECIPROCAL_PI2, RECIPROCAL_PI);","#endif","\tvec4 mapColor = vec4(texture2D(map, texCoord).rgb, opacity);","\tmapColor.rgb *= color;","#else","\tdiscard;","\tvec4 mapColor = vec4(0.0);","#endif","\tgl_FragColor = mapColor;","}"].join("\n");function r(e){e=e||{};THREE.ShaderMaterial.call(this,{type:"SphericalMapMaterial",uniforms:{map:{value:e.map||null},color:{value:e.color||new THREE.Color(1,1,1)},opacity:{value:e.opacity!==undefined?e.opacity:1}},defines:{UP_AXIS:e.upAxis!==undefined?e.upAxis:2},vertexShader:t,fragmentShader:i,depthTest:false,depthWrite:false,blending:THREE.CustomBlending});Object.defineProperties(this,{map:{enumerable:true,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},color:{enumerable:true,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:true,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},upAxis:{enumerable:true,get:function(){return this.defines.UP_AXIS},set:function(e){this.defines.UP_AXIS=e;this.needsUpdate=true}}})}r.prototype=Object.assign(Object.create(THREE.ShaderMaterial.prototype),{constructor:r});r.prototype.isSphericalMapMaterial=true;r.prototype.copy=function(e){THREE.ShaderMaterial.prototype.copy.call(this,e);this.map=e.map;this.color.copy(e.color);return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Texture", ["../Texture","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.threejs.Texture",{metadata:{library:"sap.ui.vk"},constructor:function(t){if(t){var e=new THREE.TextureLoader;this._nativeTexture=e.load(t);if(!this._nativeTexture.userData){this._nativeTexture.userData={}}}}});var r=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(r.init){r.init.call(this)}};i.prototype.load=function(t){var e=new THREE.TextureLoader;this._nativeTexture=e.load(t);if(!this._nativeTexture.userData){this._nativeTexture.userData={}}return this};i.prototype.getTextureRef=function(){return this._nativeTexture};i.prototype.setTextureRef=function(t){this._nativeTexture=t;if(!this._nativeTexture.userData){this._nativeTexture.userData={}}return this};i.prototype.getId=function(){if(this._nativeTexture&&this._nativeTexture.userData&&this._nativeTexture.userData.id){return this._nativeTexture.userData.id}};i.prototype.setId=function(t){if(this._nativeTexture){if(!this._nativeTexture.userData){this._nativeTexture.userData={}}this._nativeTexture.userData.id=t}return this};i.prototype.getFilterMode=function(){if(this._nativeTexture){return this._nativeTexture.magFilter===THREE.NearestFilter?1:0}};i.prototype.setFilterMode=function(t){if(this._nativeTexture){this._nativeTexture.magFilter=t===1?THREE.NearestFilter:THREE.LinearFilter}};i.prototype.getUvRotationAngle=function(){if(this._nativeTexture){return this._nativeTexture.rotation}};i.prototype.setUvRotationAngle=function(t){if(this._nativeTexture){this._nativeTexture.rotation=t}};i.prototype.getUvHorizontalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.x}};i.prototype.setUvHorizontalOffset=function(t){if(this._nativeTexture){this._nativeTexture.offset.x=t}};i.prototype.getUvVerticalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.y}};i.prototype.setUvVerticalOffset=function(t){if(this._nativeTexture){this._nativeTexture.offset.y=t}};i.prototype.getUvHorizontalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.x}};i.prototype.setUvHorizontalScale=function(t){if(this._nativeTexture){this._nativeTexture.repeat.x=t}};i.prototype.getUvVerticalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.y}};i.prototype.setUvVerticalScale=function(t){if(this._nativeTexture){this._nativeTexture.repeat.y=t}};i.prototype.getUvHorizontalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapS===THREE.RepeatWrapping}};i.prototype.setUvHorizontalTilingEnabled=function(t){if(this._nativeTexture){this._nativeTexture.wrapS=t?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping}};i.prototype.getUvVerticalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapT===THREE.RepeatWrapping}};i.prototype.setUvVerticalTilingEnabled=function(t){if(this._nativeTexture){this._nativeTexture.wrapT=t?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ThreeExtensions", ["../abgrToColor","../ObjectType","../thirdparty/three","../NodeContentType","./ThreeUtils"],function(e,t,i,a,r){"use strict";THREE.Object3D.prototype.defaultEmissive={r:.0235,g:.0235,b:.0235};THREE.Object3D.prototype.defaultSpecular={r:.0602,g:.0602,b:.0602};THREE.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){r.computeObjectOrientedBoundingBox(this,this.userData.boundingBox=new THREE.Box3)};THREE.Object3D.prototype._vkTraverseNodeGeometry=function(e){e(this);for(var t=0,i=this.children.length;t<i;t++){var a=this.children[t];if(a.geometry!==undefined&&a.userData.skipIt){if(a.children){a._vkTraverseNodeGeometry(e)}else{e(a)}}else if(a.children){a._vkTraverseNodeGeometry(e)}}};THREE.Object3D.prototype._vkSetHighlightColor=function(e){this._vkTraverseNodeGeometry(function(t){t.userData.highlightingColor=e;t._vkUpdateMaterialColor()})};THREE.Object3D.prototype._vkSetTintColor=function(e){this._vkTraverseNodeGeometry(function(t){t.userData.tintColor=e;t._vkUpdateMaterialColor()})};THREE.Object3D.prototype._vkSetOpacity=function(e,t){this.userData.opacity=e;var i;var a;if(t){i=new Map;a=new Map;t.forEach(function(e){if(!e.node||!e.parent){return}i.set(e.node,e);if(e.parent){var t=a.get(e.parent);if(!t){t=[]}t.push(e);a.set(e.parent,t)}})}this._vkTraverseNodes(function(e){e._vkUpdateMaterialOpacity(i)},i,a)};THREE.Object3D.prototype._vkUpdateMaterialColor=function(){if(!this.material||!this.material.color){return}var t=this.userData;if(t.originalMaterial){if(t.originalMaterial.color.r===undefined){t.originalMaterial=null}else if(t.originalMaterial.map!==this.material.map||t.originalMaterial.bumpMap!==this.material.bumpMap||t.originalMaterial.alphaMap!==this.material.alphaMap||t.originalMaterial.envMap!==this.material.envMap||t.originalMaterial.emissiveMap!==this.material.emissiveMap||t.originalMaterial.aoMap!==this.material.aoMap){this.material=t.originalMaterial.clone()}else{this.material.color.copy(t.originalMaterial.color);if(this.material.emissive!==undefined){this.material.emissive.copy(t.originalMaterial.emissive)}if(this.material.specular!==undefined){this.material.specular.copy(t.originalMaterial.specular)}}}if(t.highlightColor!==undefined||t.tintColor!==undefined||t.highlightingColor!==undefined){if(!t.originalMaterial){t.originalMaterial=this.material;this.material=this.material.clone()}if(t.highlightingColor!==undefined){var i=new THREE.Color;i.fromArray(t.highlightingColor).lerp(t.originalMaterial.color,1-t.highlightingColor[3]);this.material.color.copy(i)}var a;if(t.tintColor!==undefined){a=e(t.tintColor);this.material.color.lerp(new THREE.Color(a.red/255,a.green/255,a.blue/255),a.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive)}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive)}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular)}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular)}}}if(t.highlightColor!==undefined){a=e(t.highlightColor);this.material.color.lerp(new THREE.Color(a.red/255,a.green/255,a.blue/255),a.alpha);if(this.material.emissive!==undefined&&t.highlightColor!==0){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive)}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive)}}if(this.material.specular!==undefined&&t.highligColor!==0){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular)}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular)}}}}this._vkUpdateMaterialOpacity()};THREE.Object3D.prototype._vkUpdateMaterialOpacity=function(e){if(!this.material){return}var t=this.userData;if(t.originalMaterial){this.material.opacity=t.originalMaterial.opacity;this.material.transparent=t.originalMaterial.transparent}var i=1;var a=false;var r=this;do{var o=null,n=null;if(e){n=e.get(r)}if(n&&n.opacity!=null){o=n.opacity}else if(r.userData&&r.userData.opacity!==undefined){o=r.userData.opacity}var s=1;if(n&&n.opacity!=null&&r.userData&&r.userData.offsetOpacity!=null){s=r.userData.offsetOpacity}if(o!=null){i*=o;i*=s;a=true}if(n&&n.parent){r=n.parent;continue}r=r.parent}while(r);if(a||this.renderOrder>0){if(!t.originalMaterial){t.originalMaterial=this.material;this.material=this.material.clone()}if(this.renderOrder>0){this.material.depthTest=false;this.material.transparent=true}if(this.material.opacity){this.material.opacity*=i;this.material.transparent=t.originalMaterial.transparent||this.material.opacity<.99}}};THREE.Object3D.prototype._vkGetTotalOpacity=function(e){var t;if(e){t=new Map;e.forEach(function(e){if(!e.node||!e.parent){return}t.set(e.node,e)})}var i=1;var a=this;do{var r=null,o=null;if(t){o=t.get(a)}if(o&&o.opacity!=null){r=o.opacity}else if(a.userData&&a.userData.opacity!==undefined){r=a.userData.opacity}var n=1;if(o&&o.opacity!=null&&a.userData&&a.userData.offsetOpacity!=null){n=a.userData.offsetOpacity}if(r!=null){i*=r;i*=n}if(o&&o.parent){a=o.parent;continue}a=a.parent}while(a);return i};THREE.Object3D.prototype._vkTraverseMeshNodes=function(e){if(this._vkUpdate!==undefined||this.isDetailView){return}e(this);var t=this.children;for(var i=0,a=t.length;i<a;i++){t[i]._vkTraverseMeshNodes(e)}};THREE.Object3D.prototype._vkTraverseNodes=function(e,t,i){e(this);var a;if(i){a=i.get(this)}var r;if(a){for(r=0;r<a.length;r++){a[r].node._vkTraverseNodes(e,t,i)}}var o=this.children;if(o){for(r=0;r<o.length;r++){var n=o[r];if(t){var s=t.get(n);if(s){continue}}n._vkTraverseNodes(e,t,i)}}};function o(e,t){var i=e.min,a=e.max,r=t.elements,o=(i.x+a.x)*.5,n=(i.y+a.y)*.5,s=(i.z+a.z)*.5,l=a.x-o,h=a.y-n,p=a.z-s;var u=r[0]*o+r[4]*n+r[8]*s+r[12];var c=r[1]*o+r[5]*n+r[9]*s+r[13];var f=r[2]*o+r[6]*n+r[10]*s+r[14];var d=Math.abs(r[0]*l)+Math.abs(r[4]*h)+Math.abs(r[8]*p);var m=Math.abs(r[1]*l)+Math.abs(r[5]*h)+Math.abs(r[9]*p);var v=Math.abs(r[2]*l)+Math.abs(r[6]*h)+Math.abs(r[10]*p);i.set(u-d,c-m,f-v);a.set(u+d,c+m,f+v)}THREE.Object3D.prototype._expandBoundingBox=function(e,t,i,a){var r=new THREE.Box3;function n(i){var a=i.geometry;if(a!==undefined){if(!a.boundingBox){a.computeBoundingBox()}if(!a.boundingBox.isEmpty()){r.copy(a.boundingBox);o(r,i.matrixWorld);if(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.min.z)&&isFinite(r.max.x)&&isFinite(r.max.y)&&isFinite(r.max.z)){e.min.min(r.min);e.max.max(r.max)}}}var n=i.userData.boundingBox;if(n!==undefined&&n.min&&n.max&&!n.isEmpty()&&!t){r.copy(n);o(r,i.matrixWorld);e.min.min(r.min);e.max.max(r.max)}}function s(e){if(e._vkUpdate!==undefined&&(i||a&&e.userData.is2D)){return}if(!t||e.visible){n(e)}var r=e.children;for(var o=0,l=r.length;o<l;o++){s(r[o])}}s(this);return e};THREE.Object3D.prototype._vkPersistentId=function(){var e=this;do{if(e.userData.treeNode&&e.userData.treeNode.sid){return e.userData.treeNode.sid}e=e.parent}while(e);return null};THREE.Object3D.prototype._vkSetNodeContentType=function(e){this.userData.nodeContentType=e;if(e===a.Reference){this.visible=false;this.userData.skipIt=true}else if(e===a.Background){this.userData.renderStage=-1}else if(e===a.Symbol){this.userData.renderStage=1;this.updateMatrix();this.updateMatrixWorld(true);this.userData.direction=(new THREE.Vector3).setFromMatrixColumn(this.matrixWorld,2).normalize()}};THREE.Object3D.prototype._vkGetNodeContentType=function(){return this.userData.nodeContentType};THREE.Camera.prototype._vkZoomTo=function(e,t){t=t||0;var i=new THREE.Vector3;e.getSize(i);if(i.lengthSq()===0){return this}var a=e.min,r=e.max;var o=[new THREE.Vector3(a.x,a.y,a.z),new THREE.Vector3(r.x,r.y,r.z),new THREE.Vector3(a.x,a.y,r.z),new THREE.Vector3(a.x,r.y,r.z),new THREE.Vector3(r.x,a.y,r.z),new THREE.Vector3(r.x,r.y,a.z),new THREE.Vector3(a.x,r.y,a.z),new THREE.Vector3(r.x,a.y,a.z)];var n=new THREE.Matrix4,s=new THREE.Vector3,l=new THREE.Box2;function h(e){o.forEach(function(t){s=t.project(e);l.expandByPoint(new THREE.Vector2(s.x,s.y))})}var p=this.view;if(p&&p.enabled){h(this);var u=p.offsetX+p.width*(.5+.25*(l.min.x+l.max.x));var c=p.offsetY+p.height*(.5-.25*(l.min.y+l.max.y));var f=Math.max(l.max.x-l.min.x,l.max.y-l.min.y)*.5*(1+t);p.width*=f;p.height*=f;p.offsetX=u-p.width*.5;p.offsetY=c-p.height*.5;return this}function d(e){n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var t in o){s.copy(o[t]).applyMatrix4(n);if(s.x<-1||s.x>1||s.y<-1||s.y>1){return false}}return true}var m=new THREE.Vector3;e.getCenter(m);var v=new THREE.Vector3;this.getWorldDirection(v);v.multiplyScalar(i.length());this.position.copy(m).sub(v);this.updateMatrixWorld(true);if(this.isPerspectiveCamera){while(!d(this)){this.position.sub(v);this.updateMatrixWorld(true)}var y=10;var g=this.position.clone();var E=m.clone();for(var x=0;x<y;x++){this.position.copy(g).add(E).multiplyScalar(.5);this.updateMatrixWorld(true);if(d(this)){g.copy(this.position)}else{E.copy(this.position)}}this.position.copy(g).sub(m).multiplyScalar(t).add(g);this.updateMatrixWorld(true)}else if(this.isOrthographicCamera){h(this);this.zoom/=Math.max(l.max.x-l.min.x,l.max.y-l.min.y)*.5*(1+t);this.updateProjectionMatrix()}return this};THREE.Mesh.prototype._vkClone=function(){var e=new THREE.Mesh;r.disposeMaterial(e.material);e.copy(this);return e}});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ThreeUtils", ["../thirdparty/three","sap/base/Log","../ObjectType"],function(e,i,a){"use strict";var t={};t._disposeMaterial=function(e){if(e.map){e.map.dispose()}if(e.lightMap){e.lightMap.dispose()}if(e.bumpMap){e.bumpMap.dispose()}if(e.normalMap){e.normalMap.dispose()}if(e.specularMap){e.specularMap.dispose()}if(e.envMap){e.envMap.dispose()}if(e.alphaMap){e.alphaMap.dispose()}if(e.emissiveMap){e.emissiveMap.dispose()}if(e.aoMap){e.aoMap.dispose()}e.dispose()};t.disposeMaterial=function(i){if(i){if(i instanceof e.MeshFaceMaterial){i.materials.forEach(function(e){t._disposeMaterial(e)})}else{t._disposeMaterial(i)}}};t.disposeObject=function(i){if(i instanceof e.Mesh||i instanceof e.Line||i instanceof e.Box3Helper){if(i.geometry){i.geometry.dispose()}if(i.material){t._disposeMaterial(i.material)}}};t.disposeGeometry=function(i){if(i instanceof e.Mesh||i instanceof e.Line||i instanceof e.Box3Helper){if(i.geometry){i.geometry.dispose()}}};t.getAllTHREENodes=function(a,r,o){if(!a){return}if(!r||!o){i.error("getAllTHREENodes input parameters - all3DNodes and/or allGroupNodes are undefined.");return}a.forEach(function(i){if(i instanceof e.Mesh){r.push(i)}else if(i instanceof e.Light){r.push(i)}else if(i instanceof e.Camera){r.push(i)}else if(i instanceof e.Box3Helper){r.push(i)}else if(i instanceof e.Group){o.push(i)}if(i.children&&i.children.length>0){t.getAllTHREENodes(i.children,r,o)}})};var r=new e.Vector3;var o=function(e,i){i.makeEmpty();e.updateMatrixWorld(true);e.traverse(function(e){if(e.userData.objectType===a.Hotspot||e.userData.objectType===a.PMI){return}var t;var o;var s=e.geometry;if(s!=null){if(s.isGeometry){var n=s.vertices;for(t=0,o=n.length;t<o;t++){r.copy(n[t]);r.applyMatrix4(e.matrixWorld);i.expandByPoint(r)}}else if(s.isBufferGeometry){var p=s.attributes.position;if(p!=null){for(t=0,o=p.count;t<o;t++){r.fromBufferAttribute(p,t).applyMatrix4(e.matrixWorld);i.expandByPoint(r)}}}}});return i};t.computeObjectOrientedBoundingBox=function(e,i){var a=e.parent;var t=e.matrix.clone();var r=e.matrixAutoUpdate;e.parent=null;e.matrix.identity();e.matrixAutoUpdate=false;o(e,i);e.matrixAutoUpdate=r;e.matrix.copy(t);e.parent=a;e.updateMatrixWorld(true);return i};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Thrustline", ["../thirdparty/three","sap/ui/base/ManagedObject","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../LeaderLineMarkStyle"],function(e,t,r,a,s,i){"use strict";var n=t.extend("sap.ui.vk.threejs.Thrustline",{metadata:{library:"sap.ui.vk",properties:{node:{type:"object"},renderOrder:{type:"int",defaultValue:0},depthTest:{type:"boolean",defaultValue:true},principleAxis:{type:"object",defaultValue:new THREE.Vector3(0,0,0)},material:{type:"object"},items:{type:"object[]"},segments:{type:"object[]"}}}});n.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._needUpdateMeshes=false};n.prototype.setNode=function(e){if(e instanceof THREE.Object3D){this.setProperty("node",e,true);this._needUpdateMeshes=true}return this};n.prototype.setRenderOrder=function(e){this.setProperty("renderOrder",e,true);this._needUpdateMeshes=true;return this};n.prototype.setDepthTest=function(e){this.setProperty("depthTest",e,true);this._needUpdateMeshes=true;return this};n.prototype.setMaterial=function(e){if(e instanceof THREE.Material){this.setProperty("material",e,true);this._needUpdateMeshes=true}return this};n.prototype.setItems=function(e){this.setProperty("items",e,true);this._needUpdateMeshes=true;return this};n.prototype.setSegments=function(e){this.setProperty("segments",e,true);this._needUpdateMeshes=true;return this};n.prototype._updateMeshes=function(e){var t=this.getNode();var i=this.getMaterial();var n=this.getDepthTest();var o=this.getRenderOrder();var p=i&&i.userData.lineStyle?i.userData.lineStyle:{};var l=p.width;var d=p.dashPatternScale;if(p.widthCoordinateSpace===3){l=l?l*e.y:1;d=d?d*e.y:1}l=l||1;p.haloWidth=p.haloWidth||0;p.endCapStyle=p.endCapStyle||0;this.getSegments().forEach(function(e){if(e.polylineMesh){t.remove(e.polylineMesh);e.polylineMesh=null}if(e.haloMesh){t.remove(e.haloMesh);e.haloMesh=null}var h=[];for(var u=0,y=e.ratios.length;u<y;u++){h.push(new THREE.Vector3)}var c=new r;c.setVertices(h);var f=p.endCapStyle||h.length>2?1:0;var v=(f&&p.endCapStyle===0?1:0)|(f&&p.endCapStyle===0?2:0);if(p.haloWidth>0){var m=new a({color:16777215,lineColor:16777215,linewidth:l*(p.haloWidth*2+1),dashCapStyle:p.endCapStyle,segmentCapStyle:f,trimStyle:v,transparent:true,depthTest:n});var M=new s(c,m);M.matrixAutoUpdate=false;M.renderOrder=o;M.userData.skipIt=true;e.haloMesh=M;t.add(M)}var E=new a({color:16777215,lineColor:i.color,linewidth:l,dashCapStyle:p.endCapStyle,segmentCapStyle:f,trimStyle:v,dashPattern:p.dashPattern||[],dashScale:d||1,transparent:true,depthTest:n,polygonOffset:true,polygonOffsetFactor:-4});var g=new s(c,E);g.matrixAutoUpdate=false;g.renderOrder=o;g.userData.skipIt=true;e.polylineMesh=g;t.add(g)})};var o=new THREE.Matrix4,p=new THREE.Matrix4,l=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Vector3,u=new THREE.Vector3;n.prototype._update=function(e,t,r){var a=this.getNode();if(!a||!a.visible){return}if(this._needUpdateMeshes){this._needUpdateMeshes=false;this._updateMeshes(r)}o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);p.copy(o);var s=t instanceof THREE.PerspectiveCamera?t.near:undefined;var i=this.getItems();l.copy(this.getPrincipleAxis()).normalize();this.getSegments().forEach(function(e){var t=e.polylineMesh;if(t){var a=t.geometry;var n=i[e.startItemIndex];var o=(new THREE.Vector3).copy(n.boundPoints[e.startBoundIndex]).applyMatrix4(n.target.matrixWorld);var y=i[e.endItemIndex];var c=(new THREE.Vector3).copy(y.boundPoints[e.endBoundIndex]).applyMatrix4(y.target.matrixWorld);d.copy(c).sub(o);h.copy(l).multiplyScalar(d.dot(l));u.copy(d).sub(h);var f=a.vertices;var v=[];for(var m=0,M=e.ratios.length;m<M;m++){v.push(m);var E=e.ratios[m];var g=f[m];g.copy(o);d.copy(h).multiplyScalar(E.x);g.add(d);d.copy(u).multiplyScalar(E.y);g.add(d)}a._updateVertices(v);t.material.resolution.copy(r);t.computeLineDistances(p,r,s)}var S=e.haloMesh;if(S){S.material.resolution.copy(r);S.computeLineDistances(p,r,s)}})};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/UsageCounter", ["../thirdparty/three"],function(e){"use strict";var r=function(){};r.increaseMaterialUsed=function(e){if(e&&e.userData&&e.userData.materialUsed!==undefined){e.userData.materialUsed++;return true}return false};r.decreaseMaterialUsed=function(e){if(e&&e.userData&&e.userData.materialUsed!==undefined){e.userData.materialUsed--;return true}return false};r.increaseGeometryUsed=function(e){if(e&&e.userData&&e.userData.geometryUsed!==undefined){e.userData.geometryUsed++;return true}return false};r.decreaseGeometryUsed=function(e){if(e&&e.userData&&e.userData.geometryUsed!==undefined){e.userData.geometryUsed--;return true}return false};return r});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ViewStateManager", ["../Core","../ViewStateManagerBase","../thirdparty/three","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","../ObjectType","../RotationType","./NodesTransitionHelper","./OutlineRenderer","./HighlightPlayer","../HighlightDisplayState","../Highlight","../AnimationTrackType","../AnimationTrackValueType","../AnimationMath","../NodeContentType","./ThreeUtils","sap/ui/core/Core"],function(t,e,i,r,n,a,o,s,l,u,c,h,f,d,p,y,v,g,_,m,A){"use strict";var w;var C=e.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var b=C.getMetadata().getParent().getClass().prototype;C.prototype.init=function(){if(b.init){b.init.call(this)}this._nodeHierarchy=null;this._nodeStates=new Map;this._selectedNodes=new Set;this._outlineRenderer=new h(1);this._outlinedNodes=new Set;this.setOutlineColor("rgba(255, 0, 255, 1.0)");this.setOutlineWidth(1);this._visibilityTracker=new w;this._showSelectionBoundingBox=true;this._boundingBoxesScene=new i.Scene;this._selectionColor=new i.Color(12632064);this.setHighlightColor("rgba(255, 0, 0, 1.0)");this._joints=[];this._nodesTransitionHelper=new c;this._nodesTransitionHelper.setViewStateManager(this);this._highlightPlayer=new f;this._highlightPlayer.setViewStateManager(this);this._transitionPlayer=new f;this._transitionPlayer.setViewStateManager(this);t.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this)};C.prototype._clearBoundingBoxScene=function(){var t=[];var e=[];m.getAllTHREENodes([this._boundingBoxesScene],t,e);t.forEach(function(t){m.disposeObject(t);t.parent.remove(t)});e.forEach(function(t){t.parent.remove(t)})};C.prototype.exit=function(){t.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this);if(this._nodesTransitionHelper){this._nodesTransitionHelper.destroy()}if(this._outlineRenderer){this._outlineRenderer.dispose();this._outlineRenderer=null}if(this._boundingBoxesScene){this._clearBoundingBoxScene();this._boundingBoxesScene.dispose();this._boundingBoxesScene=null}};C.prototype._setContent=function(t){if(t===this._scene){return this}var e=null;if(t&&t instanceof s){e=t}this._setScene(e);if(e){var i=e.getInitialView();if(i){this._currentView=i;this._resetNodesMaterialAndOpacityByCurrentView(this._currentView)}}return this};C.prototype._setScene=function(t){if(this._boundingBoxesScene){this._clearBoundingBoxScene()}this._boundingBoxesScene=new i.Scene;this._setNodeHierarchy(t?t.getDefaultNodeHierarchy():null);if(t){t.setViewStateManager(this)}this._scene=t;if(this._scene){var e=this._scene.getInitialView();if(e){this.activateView(e)}}return this};C.prototype._setNodeHierarchy=function(t){var e=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._nodeStates.clear();this._selectedNodes.clear();this._outlinedNodes.clear();this._visibilityTracker.clear()}if(t){this._nodeHierarchy=t;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var i=this;var r=t.findNodesByName();r.forEach(function(t){i._initialState[t.visible?"visible":"hidden"].push(t)});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden})}if(t!==e){this.fireNodeHierarchyReplaced({oldNodeHierarchy:e,newNodeHierarchy:t})}return this};C.prototype._getJointByChildNode=function(t){var e;if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===t){e=this._jointCollection[i];break}}}return e};C.prototype._handleNodeReplaced=function(t){var e=t.getParameter("ReplacedNodeRef");var i=t.getParameter("ReplacementNodeRef");if(this.getSelectionState(e)){this.setSelectionState(i,true);this.setSelectionState(e,false)}};C.prototype._handleNodeUpdated=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionState(e,false);this.setSelectionState(e,true)}};C.prototype._handleNodeRemoving=function(t){var e=t.getParameter("nodeRef");if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===e){this._jointCollection[i].node=null;break}if(this._jointCollection[i].parent===e){this._jointCollection[i].parent=null;break}}}if(this.getSelectionState(e)){this.setSelectionState(e,false,true,true)}};C.prototype._renderOutline=function(t,e,r){var n=a(this._outlineColorABGR);var o=new i.Color(n.red/255,n.green/255,n.blue/255);this._outlineRenderer.render(t,e,r,Array.from(this._outlinedNodes),o,this._jointCollection)};C.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};C.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};C.prototype.getCurrentView=function(){var t=A.byId(this.getViewManager());if(!t){return null}var e=t.getActiveView();return e};C.prototype.resetNodeProperty=function(t,e){var r=this.getCurrentView();if(!r){return}var n=r.getNodeInfos();if(n){var a=[];a.push(t);if(this._jointCollection&&this._jointCollection.length>0){for(var o=0;o<this._jointCollection.length;o++){var s=this._jointCollection[o];if(!s.node||!s.parent){continue}var l=s.parent;if(l!==t){break}a.push(s.node)}}n.forEach(function(r){if(!a.includes(r.target)){return}if(!e||e!==y.Opacity){var o={nodeRefs:[],positions:[]};var s;var l;var u;if(r.transform){var c=new i.Vector3;var h=new i.Quaternion;var f=new i.Vector3;var d=x(r.transform);d.decompose(c,h,f);s=c.toArray();l=h.toArray();u=f.toArray()}else if(r[y.Scale]&&r[y.Rotate]&&r[y.Translate]){s=r[y.Translate].slice();l=r[y.Rotate].slice();u=r[y.Scale].slice()}if(s){o.nodeRefs.push(r.target);o.positions.push({translation:s,quaternion:l,scale:u});this.setTransformation(o.nodeRefs,o.positions)}}else{t._vkSetOpacity(r.opacity,this._jointCollection);var p={changed:t,opacity:n.opacity};this.fireOpacityChanged(p)}}.bind(this))}};C.prototype.getVisibilityComplete=function(){var t=this.getNodeHierarchy(),e=t.findNodesByName(),i=[],r=[];e.forEach(function(e){var n=t.createNodeProxy(e);var a=n.getVeId();t.destroyNodeProxy(n);if(a){if(this.getVisibilityState(e)){i.push(a)}else{r.push(a)}}},this);return{visible:i,hidden:r}};C.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear()};C.prototype.getVisibilityState=function(t){if(Array.isArray(t)){return t.map(function(t){return t?t.visible:false})}return t?t.visible:false};C.prototype.setVisibilityState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}var n=Array.isArray(e);var a=[];var o=t;if(i){o=[];t.forEach(function(t,i){var r=this._collectNodesRecursively(t);o=o.concat(r);var s=a.length;a.length=s+r.length;a.fill(n?e[i]:e,s)},this)}else if(!n){a.length=o.length;a.fill(e)}else{a=e}var s=[];var l=new Set;var u=o.filter(function(t,e){if(t==null||t.userData.skipIt&&t.visible||l.has(t)){return false}l.add(t);var i=t?t.visible!=a[e]:false;if(i){s.push(a[e])}return i},this);if(u.length>0){var c={visible:[],hidden:[]};u.forEach(function(t,e){t.visible=s[e];c[t.visible?"visible":"hidden"].push(t);if(r&&t.visible){var i=t.parent;while(i){i.visible=true;i=i.parent}}},this);if(this.getShouldTrackVisibilityChanges()){u.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged(c)}return this};C.prototype.enumerateSelection=function(t){this._selectedNodes.forEach(t);return this};C.prototype.enumerateOutlinedNodes=function(t){this._outlinedNodes.forEach(t);return this};C.prototype.getSelectionState=function(t){var e=this._selectedNodes;function i(t){return e.has(t)}return Array.isArray(t)?t.map(i):i(t)};C.prototype._getSelectionComplete=function(){var t=this.getNodeHierarchy(),e=[],i=[];function r(e){var i=t.createNodeProxy(e);var r=i.getVeId();t.destroyNodeProxy(i);return r}this._selectedNodes.forEach(function(t){var i=r(t);if(i){e.push(i)}});this._outlinedNodes.forEach(function(t){var e=r(t);if(e){i.push(e)}});return{selected:e,outlined:i}};C.prototype._isAChild=function(t,e){var i=t.parent;while(i){if(e.has(i)){return true}i=i.parent}return false};C.prototype._AddBoundingBox=function(t){if(t.userData.boundingBox===undefined){t.userData.boundingBox=new i.Box3;t._vkCalculateObjectOrientedBoundingBox()}if(!t.userData.boundingBox.isEmpty()&&this._boundingBoxesScene&&t.userData.boxHelper===undefined){var e=new i.Box3Helper(t.userData.boundingBox,16776960);e.material.color=this._selectionColor;this._boundingBoxesScene.add(e);e.parent=t;t.userData.boxHelper=e}};C.prototype._RemoveBoundingBox=function(t){if(t.userData.boundingBox!==undefined){delete t.userData.boundingBox}if(t.userData.boxHelper!==undefined){this._boundingBoxesScene.remove(t.userData.boxHelper);m.disposeObject(t.userData.boxHelper);delete t.userData.boxHelper}};C.prototype._updateBoundingBoxesIfNeeded=function(){var t=new Set;this._selectedNodes.forEach(function(e){var i=e.parent;while(i){if(this._selectedNodes.has(i)){t.add(i)}i=i.parent}}.bind(this));t.forEach(function(t){t._vkCalculateObjectOrientedBoundingBox()})};C.prototype._updateBoundingBoxes=function(){this._selectedNodes.forEach(function(t){if(t.userData.boundingBox){t._vkCalculateObjectOrientedBoundingBox()}})};C.prototype.setShowSelectionBoundingBox=function(t){this._showSelectionBoundingBox=t;if(this._showSelectionBoundingBox){this._selectedNodes.forEach(function(t){this._AddBoundingBox(t)}.bind(this))}else{this._selectedNodes.forEach(function(t){this._RemoveBoundingBox(t)}.bind(this))}this.fireSelectionChanged({selected:this._selectedNodes,unselected:[]})};C.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox};C.prototype._isAncestorSelected=function(t){t=t.parent;while(t){if(this._selectedNodes.has(t)){return true}t=t.parent}return false};C.prototype._updateHighlightColor=function(t,e){var i=e||this._selectedNodes.has(t);var r=t._vkGetNodeContentType();if(r===_.Background||r===_.Symbol){return}else{t.userData.highlightColor=i?this._highlightColorABGR:undefined;t._vkUpdateMaterialColor();var n=t.children;for(var a=0,o=n.length;a<o;a++){var s=n[a].userData;if(s&&s.objectType===l.Hotspot){continue}this._updateHighlightColor(n[a],i)}}};C.prototype.setSelectionState=function(t,e,i,r){if(!t){return this}if(!Array.isArray(t)){t=[t]}t=(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t).filter(function(t,e,i){return i.indexOf(t)===e});if(this.getRecursiveSelection()&&!e){t=this._nodeHierarchy._appendAncestors(t)}var n=t.filter(function(t){return this._selectedNodes.has(t)!==e},this);if(n.length>0){n.forEach(function(t){if(t){this._selectedNodes[e?"add":"delete"](t);if(this._showSelectionBoundingBox){this[e?"_AddBoundingBox":"_RemoveBoundingBox"](t)}}},this);n.forEach(function(t){if(t){this._updateHighlightColor(t,e||this._isAncestorSelected(t))}},this);if(!r){this.fireSelectionChanged({selected:e?n:[],unselected:e?[]:n})}}return this};C.prototype.setSelectionStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e;if(this.getRecursiveSelection()){e=this._nodeHierarchy._appendAncestors(e,t)}var n=t.filter(function(t){return this._selectedNodes.has(t)===false},this);var a=e.filter(function(t){return this._selectedNodes.has(t)===true},this);if(n.length>0||a.length>0){n.forEach(function(t){this._selectedNodes.add(t);this._updateHighlightColor(t,true);if(this._showSelectionBoundingBox){this._AddBoundingBox(t)}},this);a.forEach(function(t){this._selectedNodes.delete(t);if(this._showSelectionBoundingBox){this._RemoveBoundingBox(t)}},this);a.forEach(function(t){this._updateHighlightColor(t,this._isAncestorSelected(t))},this);if(!r){this.fireSelectionChanged({selected:n,unselected:a})}}return this};C.prototype.setOutlineColor=function(t){switch(typeof t){case"number":this._outlineColorABGR=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){this._outlineColorABGR=o(r(t))}break;default:return this}this.fireOutlineColorChanged({outlineColor:n(a(this._outlineColorABGR)),outlineColorABGR:this._outlineColorABGR});return this};C.prototype.getOutlineColor=function(t){return t?this._outlineColorABGR:n(a(this._outlineColorABGR))};C.prototype.getOutliningState=function(t){var e=this._outlinedNodes;function i(t){return e.has(t)}return Array.isArray(t)?t.map(i):i(t)};C.prototype.setOutliningStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveOutlining()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveOutlining()?this._collectNodesRecursively(e):e;if(this.getRecursiveOutlining()){e=this._nodeHierarchy._appendAncestors(e,t)}var n=t.filter(function(t){return this._outlinedNodes.has(t)===false},this);var a=e.filter(function(t){return this._outlinedNodes.has(t)===true},this);if(n.length>0||a.length>0){n.forEach(function(t){this._outlinedNodes.add(t)},this);a.forEach(function(t){this._outlinedNodes.delete(t)},this);if(!r){this.fireOutliningChanged({outlined:n,unoutlined:a})}}return this};C.prototype.setOutlineWidth=function(t){this._outlineWidth=t;this._outlineRenderer.setOutlineWidth(t);this.fireOutlineWidthChanged({width:t});return this};C.prototype.getOutlineWidth=function(){return this._outlineWidth};C.prototype._collectNodesRecursively=function(t){var e=[];var i=this._nodeHierarchy;(Array.isArray(t)?t:[t]).forEach(function t(r){e.push(r);i.enumerateChildren(r,t,false,true)});return e};C.prototype._getOpacity=function(t){return t.userData.opacity!==undefined?t.userData.opacity:null};C.prototype.getOpacity=function(t){if(Array.isArray(t)){return t.map(this._getOpacity,this)}else{return this._getOpacity(t)}};C.prototype.setOpacity=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);if(e==null){e=undefined}else if(r){e.forEach(function(t,i){if(t==null){e[i]=undefined}})}var n=[];var a=t;if(!r){n.length=a.length;n.fill(e)}else{n=e}var o=[];var s=new Set;var l=a.filter(function(t,e){if(s.has(t)){return false}s.add(t);var i=t?t.userData.opacity!==n[e]:false;if(i){o.push(n[e])}return i},this);if(l.length>0){l.forEach(function(t,e){t._vkSetOpacity(o[e],this._jointCollection)},this);var u={changed:l,opacity:r?o:o[0]};this.fireOpacityChanged(u)}return this};C.prototype._getTintColorABGR=function(t){return t.userData.tintColor!==undefined?t.userData.tintColor:null};C.prototype._getTintColor=function(t){return t.userData.tintColor!==undefined?n(a(t.userData.tintColor)):null};C.prototype.getTintColor=function(t,e){var i=e?"_getTintColorABGR":"_getTintColor";if(Array.isArray(t)){return t.map(this[i],this)}else{return this[i](t)}};C.prototype.setTintColor=function(t,e,i){if(!Array.isArray(t)){t=[t]}var n=function(t){var e=null;switch(typeof t){case"number":e=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){e=o(r(t))}break;default:e=undefined;break}return e};var a=Array.isArray(e);var s=[];var l=t;if(i){l=[];t.forEach(function(t,i){var r=this._collectNodesRecursively(t);l=l.concat(r);var n=s.length;s.length=n+r.length;s.fill(a?e[i]:e,n)},this)}else if(!a){s.length=l.length;s.fill(e)}else{s=e}var u=[];var c=new Set;var h=l.filter(function(t,e){if(c.has(t)){return false}c.add(t);var i=t?t.userData.tintColor!==n(s[e]):false;if(i){u.push(s[e])}return i},this);if(h.length>0){var f=[];h.forEach(function(t,e){var i=n(u[e]);t._vkSetTintColor(i);f.push(i)},this);var d={changed:h,tintColor:a?u:u[0],tintColorABGR:a?f:f[0]};this.fireTintColorChanged(d)}return this};C.prototype.setHighlightColor=function(t){switch(typeof t){case"number":this._highlightColorABGR=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){this._highlightColorABGR=o(r(t))}break;default:return this}if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(t){this._updateHighlightColor(t,true)},this)}this.fireHighlightColorChanged({highlightColor:n(a(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this};C.prototype.getHighlightColor=function(t){return t?this._highlightColorABGR:n(a(this._highlightColorABGR))};C.prototype.getRestTransformationUsingJoint=function(t){var e=this._getJointByChildNode(t);if(e&&e.translation&&e.scale&&e.quaternion){return e}else{return this.getRestTransformation(t)}};C.prototype.getRelativeTransformation=function(t){var e=function(t){var e=this.getRestTransformation(t);var r=[t.position.x-e.translation[0],t.position.y-e.translation[1],t.position.z-e.translation[2]];var n=(new i.Quaternion).fromArray(e.quaternion).inverse().premultiply(t.quaternion).toArray();var a=[t.scale.x/e.scale[0],t.scale.y/e.scale[1],t.scale.z/e.scale[2]];return{translation:r,quaternion:n,scale:a}}.bind(this);if(!Array.isArray(t)){return e(t)}var r=[];t.forEach(function(t){r.push(e(t))});return r};C.prototype.getTransformationWorld=function(t){var e=function(t){var e=new i.Vector3;var r=new i.Vector3;var n=new i.Quaternion;t.updateMatrixWorld();t.matrixWorld.decompose(e,n,r);return{translation:e.toArray(),quaternion:n.toArray(),scale:r.toArray()}};if(!Array.isArray(t)){return e(t)}var r=[];t.forEach(function(t){r.push(e(t))});return r};C.prototype.getTransformation=function(t){var e=function(t){return{translation:this.getTranslation(t),quaternion:this.getRotation(t,u.Quaternion),scale:this.getScale(t)}}.bind(this);if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};C.prototype.getTranslation=function(t){var e=function(t){return t.position.toArray()};if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};C.prototype.getScale=function(t){var e=function(t){return t.scale.toArray()};if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};C.prototype._convertQuaternionToAngleAxis=function(t){if(t.w>1){t.normalize()}if(t.w>.9999&&t.x<1e-4&&t.y<1e-4&&t.z<1e-4){t.w=1;t.x=0;t.y=0;t.z=0}var e=2*Math.acos(t.w);var i;var r;var n;var a=Math.sqrt(1-t.w*t.w);if(a<1e-4){i=1;r=0;n=0}else{i=t.x/a;r=t.y/a;n=t.z/a}return[i,r,n,e]};C.prototype.getRotation=function(t,e){var r=function(t){var r=t.quaternion;var n;switch(e){case u.AngleAxis:n=this._convertQuaternionToAngleAxis(r);break;case u.Euler:var a=new i.Euler;a.setFromQuaternion(r);n=a.toArray();break;default:n=r.toArray()}return n};if(!Array.isArray(t)){return r(t)}var n=[];t.forEach(function(t){n.push(r(t))});return n};C.prototype.setTransformation=function(t,e){var r=Array.isArray(t);if(!Array.isArray(t)){t=[t]}var n={changed:[],transformation:[]};var a=function(t){return{position:t.position.toArray(),quaternion:t.quaternion.toArray(),scale:t.scale.toArray()}};if(!e){t.forEach(function(t){if(t.userData.position&&t.userData.quaternion&&t.userData.scale){t.position=t.userData.position;t.quaternion=t.userData.quaternion;t.scale=t.userData.scale;t.updateMatrix();delete t.userData.position;delete t.userData.quaternion;delete t.userData.scale}n.changed.push(t);n.transformation.push(a(t))},this)}else{if(!Array.isArray(e)){e=[e]}t.forEach(function(t,r){var o=t.userData;if(!o){return}if(!o.position){o.position=t.position.clone()}if(!o.quaternion){o.quaternion=t.quaternion.clone()}if(!o.scale){o.scale=t.scale.clone()}var s=e[r];if(s.transform){var l=x(s.transform);l.decompose(t.position,t.quaternion,t.scale)}else{t.position.fromArray(s.translation);t.scale.fromArray(s.scale);if(s.quaternion){t.quaternion.fromArray(s.quaternion)}else if(s.angleAxis){var u=new i.Vector3(s.angleAxis[0],s.angleAxis[1],s.angleAxis[2]);t.quaternion.setFromAxisAngle(u,s.angleAxis[3])}else if(s.euler){var c=new i.Euler;c.fromArray(s.euler[0],s.euler[1],s.euler[2],s.euler[3]);t.quaternion.setFromEuler(c)}}t.updateMatrix();n.changed.push(t);n.transformation.push(a(t))},this)}if(!r){n.changed=n.changed[0];n.transformation=n.transformation[0]}this.fireTransformationChanged(n);return this};C.prototype.getJoints=function(){return this._jointCollection};C.prototype.setJoints=function(t,e){this._jointCollection=[];this._playbackAssociatedWithJoints=null;if(!t){return this}var i=new Set;var r=new Map;t.forEach(function(t){if(!t.node||!t.parent){return}i.add(t.node);r.set(t.node,t)});while(i.size>0){var n=i.values().next().value;i.delete(n);var a=r.get(n);var o=[a];var s=[];var l=a.parent;while(l){a=r.get(l);if(a!==undefined){if(i.delete(l)){o.push(a)}if(s.length>0){a.nodesToUpdate=a.nodesToUpdate||[];while(s.length>0){var u=s.pop();if(a.nodesToUpdate.indexOf(u)>=0){break}a.nodesToUpdate.push(u)}}s.length=0;l=a.parent}else{s.push(l);l=l.parent}}while(o.length>0){this._jointCollection.push(o.pop())}}if(this._jointCollection&&this._jointCollection.length>0){this._playbackAssociatedWithJoints=e;this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}t.translation=null;t.scale=null;t.quaternion=null;t.opacity=null;if(t.node.userData){t.node.userData.offsetTranslation=null;t.node.userData.offsetQuaternion=null;t.node.userData.offsetScale=null;t.node.userData.originalRotationType=null;t.node.userData.offsetOpacity=null}});this._jointCollection.forEach(function(t){this._updateJointNode(t,this._playbackAssociatedWithJoints)}.bind(this))}return this};C.prototype._updateJointNode=function(t,e){if(!t.node||!t.parent){return}if(t.translation&&t.quaternion&&t.scale&&t.opacity){return}var r=new Map;if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}r.set(t.node,t)})}var n,a,o,s,l,u;var c=t.node;var h=new i.Matrix4;var f,d=1;while(c){u=this.getRestOpacity(c);l=this.getRestTransformation(c);if(!l){c=c.parent;continue}n=new i.Vector3(l.translation[0],l.translation[1],l.translation[2]);a=new i.Vector3(l.scale[0],l.scale[1],l.scale[2]);o=new i.Quaternion(l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]);f=u;if(e){var p=this._getEndPropertyInPreviousPlayback(c,y.Translate,e,true);if(p){n.x+=p[0];n.y+=p[1];n.z+=p[2]}var v=this._getEndPropertyInPreviousPlayback(c,y.Scale,e,true);if(v){a.x*=v[0];a.y*=v[1];a.z*=v[2]}var g=this._getEndPropertyInPreviousPlayback(c,y.Rotate,e,true);if(g){var _=new i.Quaternion(g[0],g[1],g[2],g[3]);o=_.multiply(o)}var m=this._getEndPropertyInPreviousPlayback(c,y.Opacity,e,true);if(m!=null){f*=m}}s=(new i.Matrix4).compose(n,o,a);h.premultiply(s);d*=f;c=c.parent}var A=t.parent;var w=new i.Matrix4;var C=1;while(A){var b=r.get(A);if(b){if(!b.translation){this._updateJointNode(b)}n=new i.Vector3(b.translation[0],b.translation[1],b.translation[2]);a=new i.Vector3(b.scale[0],b.scale[1],b.scale[2]);o=new i.Quaternion(b.quaternion[0],b.quaternion[1],b.quaternion[2],b.quaternion[3]);f=b.opacity;A=b.parent}else{u=this.getRestOpacity(A);l=this.getRestTransformation(A);if(!l){A=A.parent;continue}n=new i.Vector3(l.translation[0],l.translation[1],l.translation[2]);a=new i.Vector3(l.scale[0],l.scale[1],l.scale[2]);o=new i.Quaternion(l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]);f=u;if(e){var S=this._getEndPropertyInPreviousPlayback(A,y.Translate,e,true);if(S){n.x+=S[0];n.y+=S[1];n.z+=S[2]}var x=this._getEndPropertyInPreviousPlayback(A,y.Scale,e,true);if(x){a.x*=x[0];a.y*=x[1];a.z*=x[2]}var T=this._getEndPropertyInPreviousPlayback(A,y.Rotate,e,true);if(T){var R=new i.Quaternion(T[0],T[1],T[2],T[3]);o=R.multiply(o)}var N=this._getEndPropertyInPreviousPlayback(A,y.Opacity,e,true);if(N!=null){f*=N}}A=A.parent}s=(new i.Matrix4).compose(n,o,a);w.premultiply(s);C*=f}var k=w.getInverse(w).multiply(h);k.decompose(n,o,a);t.translation=n.toArray();t.quaternion=o.toArray();t.scale=a.toArray();var V=function(t,e){if(t===e){return 1}else if(Math.abs(e)<1e-4){return 1}return t/e};t.opacity=V(d,C)};C.prototype._propagateOpacityToJointChildren=function(t,e){if(!t||!e||t.length!==e.length){return this}if(!this._jointCollection||!this._jointCollection.length){return this}var i=new Map;this._jointCollection.forEach(function(t){var e=i.get(t.parent);if(!e){e=[];i.set(t.parent,e)}e.push(t)});var r=function(t,e){if(t.opacity!=null&&t.node&&t.node.userData){t.node.userData.opacity=t.opacity*e;if(t.node.userData.offsetOpacity!=null){t.node.userData.opacity*=t.node.userData.offsetOpacity}}};t.forEach(function(t,n){var a=i.get(t);if(a){a.forEach(function(t){r(t,e[n])})}});return this};C.prototype._updateMaterialInNode=function(t){var e=t.target;for(var i=0,r=e.children.length;i<r;i++){var n=e.children[i];if(n.userData.animatedColor){n._vkUpdateMaterialColor()}}var a=t.materialId;if(e.userData.materialId!==a){e.userData.materialId=a;this._scene._setNodeMaterial(e,a)}};C.prototype.getSymbolNodes=function(t){var e=this.getCurrentView()||this._scene.getViews()[0];var i=e?e.getNodeInfos().reduce(function(e,i){if(i.target._vkGetNodeContentType()===_.Symbol&&i.target.parent){if(!t||t===i.target.userData.treeNode.sid){e.push(i.target)}}return e},[]):[];return i};var S={sphere:"360Image",plane:"2DImage"};C.prototype._getBackgroundNodeInfos=function(){var t=null,e=[];function i(e){if(e.visible){if(e._vkGetNodeContentType()===_.Background&&S[e.name]){t=e;return}var r=e.children;for(var n=0,a=r.length;n<a&&t===null;n++){i(r[n])}}}i(this._scene.getSceneRef());if(t){e=t.parent.children.filter(function(t){return t._vkGetNodeContentType()===_.Background})}return{current:t,all:e}};C.prototype.getBackgroundImageType=function(){var t=this._getBackgroundNodeInfos().current;return t?S[t.name]:null};C.prototype.setBackgroundImageType=function(t){var e=this._getBackgroundNodeInfos();var i=e.all.find(function(e){return t===S[e.name]});if(i&&!this.getVisibilityState(i)){if(e.current){e.current.visible=false}i.visible=true;this.setVisibilityState(e.all,false,false);this.setVisibilityState(i,true,false)}return i};function x(t){return(new i.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],0,0,0,1)}C.prototype._resetNodesStatusByCurrentView=function(t,e,r){var n=this.getNodeHierarchy();if(n){var a;if(t){a=t.getPlaybacks()}var o=t.getNodeInfos();if(o){this._nodesTransitionHelper.clear();var s={nodeRefs:[],positions:[]};var l=new i.Vector3;var u=new i.Quaternion;var c=new i.Vector3;o.forEach(function(t){if(t.target===null){return}if(t.transform){var e=x(t.transform);if(!g.equalMatrices(e,t.target.matrix,1e-6)){if((!a||!a.length)&&r){var i=n.createNodeProxy(t.target);this._nodesTransitionHelper.setNodeForDisplay(i,e)}else{e.decompose(l,u,c);s.nodeRefs.push(t.target);s.positions.push({translation:l.toArray(),quaternion:u.toArray(),scale:c.toArray()})}}}else if(t[y.Scale]&&t[y.Rotate]&&t[y.Translate]){s.nodeRefs.push(t.target);s.positions.push({translation:t[y.Translate].slice(),quaternion:t[y.Rotate].slice(),scale:t[y.Scale].slice()})}}.bind(this));if(t.userData&&t.userData.nodeStartDataByAnimation){t.userData.nodeStartDataByAnimation.forEach(function(t,e){if(t[y.Translate]&&t[y.Rotate]&&t[y.Scale]){s.nodeRefs.push(e);s.positions.push({translation:t[y.Translate].slice(),quaternion:t[y.Rotate].slice(),scale:t[y.Scale].slice()})}},this)}if(s.nodeRefs.length){this.setTransformation(s.nodeRefs,s.positions)}if(e){var h=[];var f=[];o.forEach(function(t){if(!t.target.userData.skipIt){(t.visible?h:f).push(t.target)}});this.setVisibilityState(n.getChildren()[0].children,false,true);if(this.getSymbolNodes().length){this.getSymbolNodes().forEach(function(t){t.traverse(function(t){t.visible=true})})}this.setVisibilityState(h,true,false);this.setVisibilityState(f,false,false);this._startViewChangeNodeTransition()}}}};C.prototype._startViewChangeNodeTransition=function(){this._nodesTransitionHelper.startDisplay(500);var t=true;this._nodesTransitionHelper.attachEventOnce("displayed",function(){t=false});var e=function(){if(t){this._nodesTransitionHelper.displayNodesMoving();window.requestAnimationFrame(e)}}.bind(this);window.requestAnimationFrame(e)};C.prototype._resetNodesMaterialAndOpacityByCurrentView=function(t){if(!t){return}var e=t.getNodeInfos();if(e){e.forEach(function(t){if(!t.target){return}this._updateMaterialInNode(t)}.bind(this));e.forEach(function(t){if(!t.target||!t.target.userData){return}t.target.userData.opacity=t.opacity});var i=this._scene.getSceneRef();i._vkSetOpacity(undefined,this._jointCollection)}this._selectedNodes.forEach(function(t){this._updateHighlightColor(t)}.bind(this))};C.prototype._onActivateView=function(t,e,i){var r=this.getViewManager();if(!r||i.source.getId()!==r){return}this.activateView(i.view,false,i.playViewGroup,i.notAnimateCameraChange)};C.prototype.activateView=function(e,i,r,n){this.fireViewStateApplying({view:e});this.setJoints(undefined);this._resetNodesMaterialAndOpacityByCurrentView(e);this._prepareTransition(e);this._resetNodesStatusByCurrentView(e,true,true);this._highlightPlayer.reset(e,this._scene);this.fireViewStateApplied({view:e,ignoreAnimationPosition:i,notAnimateCameraChange:n,playViewGroup:r});t.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:e,ignoreAnimationPosition:i,notAnimateCameraChange:n,playViewGroup:r});return this};C.prototype.setHighlightDisplayState=function(t){if(t===d.playing){this._highlightPlayer.start(Date.now())}else if(t===d.stopped){this._highlightPlayer.stop()}else if(t===d.pausing){this._highlightPlayer.pause(Date.now())}this.fireHighlightColorChanged({highlightColor:n(a(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this};C.prototype._startHighlight=function(){this._highlightPlayer.start(Date.now());return this};C.prototype._playHighlight=function(){return this._highlightPlayer.play(Date.now())};C.prototype._prepareTransition=function(t){this._transitionPlayer.reset();this._transitionPlayer.fadeInNodes=[];this._transitionPlayer.fadeOutNodes=[];this._fadeInBackground=null;this._fadeOutBackground=null;var e=t.getNodeInfos();if(!e){return}var i=new Set;var r=new Set;e.forEach(function(t){(t.visible?i:r).add(t.target)});var n=this._transitionPlayer.fadeInNodes;var a=this._transitionPlayer.fadeOutNodes;var o=this._nodeHierarchy;var s=function(t,e,r){if(!t.userData.skipIt){e=e&&i.has(t);r=r&&t.visible}if(t.geometry&&e!==r){if(t.parent&&t.parent.userData.symbolContent){t.renderOrder=2}(e?n:a).push(t)}if(t._vkGetNodeContentType()===_.Background){if(e){this._fadeInBackground=t}else if(r){this._fadeOutBackground=t}}t.children.forEach(function(t){s(t,e,r)})}.bind(this);o.getChildren()[0].children.forEach(function(t){s(t,true,true)});if(this._fadeInBackground){this._fadeInBackground.traverse(function(t){if(t.material){t.renderOrder=-2}})}if(this._fadeOutBackground){this._fadeOutBackground.traverse(function(t){if(t.material){t.renderOrder=1}})}};C.prototype._startTransition=function(t){var e=this._transitionPlayer.fadeInNodes;var i=this._transitionPlayer.fadeOutNodes;if(e&&e.length){var r=new p("FadeIn",{duration:t/500,opacities:[0,1],cycles:1});this._transitionPlayer.addHighlights(r,e)}if(i&&i.length){var n=new p("FadeOut",{duration:t/500,opacities:[1,0],cycles:1,fadeOut:true});this._transitionPlayer.addHighlights(n,i)}if(e&&e.length||i&&i.length){this._transitionPlayer.start(Date.now());this._transitionPlayer.play(Date.now());return t}return 0};C.prototype._playTransition=function(){return this._transitionPlayer.play(Date.now())};C.prototype.updateNodesRestTransformation=function(t){for(var e=0;e<t.length;e++){this.updateRestTransformation(t[e],true);if(this._playbackAssociatedWithJoints&&e===t.length-1){var i=this._playbackAssociatedWithJoints.getSequence();if(i){i._fireSequenceChanged()}}}return this};C.prototype.updateRestTransformation=function(t,e){var i=this.getCurrentView();if(!i){return this}var r=i.getNodeInfos();if(r){r.forEach(function(e){if(e.target!==t){return}t.updateMatrix();var i=t.matrix.elements;var r=[i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]];e.transform=r})}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.translation=null;e.scale=null;e.quaternion=null;if(e.node.userData){e.node.userData.offsetTranslation=null;e.node.userData.offsetQuaternion=null;e.node.userData.offsetScale=null;e.node.userData.originalRotationType=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestTransformation(e.node)}}.bind(this));this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints&&!e){var n=this._playbackAssociatedWithJoints.getSequence();if(n){n._fireSequenceChanged()}}}return this};C.prototype.restoreRestTransformation=function(t){var e=this.getCurrentView();if(!e){return this}var i=e.getNodeInfos();if(i){i.forEach(function(e){if(e.target!==t){return}if(e.transform){var i=x(e.transform);i.decompose(t.position,t.quaternion,t.scale)}else if(e[y.Scale]&&e[y.Rotate]&&e[y.Translate]){t.position.set(e[y.Translate][0],e[y.Translate][1],e[y.Translate][2]);t.quaternion.set(e[y.Rotate][0],e[y.Rotate][1],e[y.Rotate][2],e[y.Rotate][3]);t.scale.set(e[y.Scale][0],e[y.Scale][1],e[y.Scale][2])}t.updateMatrix()})}var r={changed:[t],transformation:[{position:t.position.toArray(),quaternion:t.quaternion.toArray(),scale:t.scale.toArray()}]};this.fireTransformationChanged(r);return this};C.prototype.setRestTransformation=function(t,e,r,n){var a=this.getCurrentView();if(!a){return this}var o=a.getNodeInfos();if(o){o.forEach(function(a){if(a.target!==t){return}if(!e||!r||!n){if(a.transform){var o=new i.Vector3;var s=new i.Quaternion;var l=new i.Vector3;var u=x(a.transform);u.decompose(o,s,l);if(!e){e=[o.x,o.y,o.z]}if(!n){n=[l.x,l.y,l.z]}if(!r){r=[s.x,s.y,s.z,s.w]}}else if(a[y.Scale]&&a[y.Rotate]&&a[y.Translate]){if(!e){e=a[y.Translate].slice()}if(!n){n=a[y.Scale].slice()}if(!r){r=a[y.Rotate].slice()}}}var c=new i.Vector3(e[0],e[1],e[2]);var h=new i.Quaternion(r[0],r[1],r[2],r[3]);var f=new i.Vector3(n[0],n[1],n[2]);var d=new i.Matrix4;d.compose(c,h,f);var p=d.elements;a.transform=[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14]]})}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.translation=null;e.scale=null;e.quaternion=null;if(e.node.userData){e.node.userData.offsetTranslation=null;e.node.userData.offsetQuaternion=null;e.node.userData.offsetScale=null;e.node.userData.originalRotationType=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestTransformation(e.node)}},this);this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var s=this._playbackAssociatedWithJoints.getSequence();if(s){s._fireSequenceChanged()}}}return this};C.prototype.getRestOpacity=function(t){var e;var i=this.getCurrentView();if(i){e=i.getNodeInfos()}var r=1;if(e&&e.length){for(var n=0;n<e.length;n++){var a=e[n];if(a.target!==t){continue}if(a.opacity!==undefined&&a.opacity!==null){r=a.opacity}break}}return r};C.prototype.setRestOpacity=function(t,e){var i;var r=this.getCurrentView();if(r){i=r.getNodeInfos()}if(i){i.forEach(function(i){if(i.target!==t){return}i.opacity=e})}return this};C.prototype.restoreRestOpacity=function(t){var e;var i=this.getCurrentView();if(i){e=i.getNodeInfos()}if(e){e.forEach(function(e){if(e.target!==t){return}var i=1;if(e.opacity!==undefined){i=e.opacity}this.setOpacity(t,i)}.bind(this))}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.opacity=null;if(e.node.userData){e.node.userData.offsetOpacity=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestOpacity(e.node)}},this);this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var r=this._playbackAssociatedWithJoints.getSequence();if(r){r._fireSequenceChanged()}}}return this};C.prototype.updateRestOpacity=function(t){var e;var i=this.getCurrentView();if(i){e=i.getNodeInfos()}if(e){e.forEach(function(e){if(e.target!==t){return}if(t.userData&&t.userData.opacity!==undefined&&t.userData.opacity!==null){e.opacity=t.userData.opacity}else{delete e.opacity}})}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.opacity=null;if(e.node.userData){e.node.userData.offsetOpacity=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var r=this._playbackAssociatedWithJoints.getSequence();if(r){r._fireSequenceChanged()}}}return this};C.prototype.getRestTransformationWorld=function(t){var e;var r=this.getCurrentView();if(r){e=r.getNodeInfos()}var n;if(e){var a=new i.Matrix4;while(t){for(var o=0;o<e.length;o++){var s=e[o];if(s.target!==t){continue}var l;if(s.transform){l=x(s.transform)}else if(s[y.Scale]&&s[y.Rotate]&&s[y.Translate]){var u=new i.Vector3(s[y.Translate][0],s[y.Translate][1],s[y.Translate][2]);var c=new i.Quaternion(s[y.Rotate][0],s[y.Rotate][1],s[y.Rotate][2],s[y.Rotate][3]);var h=new i.Vector3(s[y.Scale][0],s[y.Scale][1],s[y.Scale][2]);l=(new i.Matrix4).compose(u,c,h)}if(l){a.premultiply(l)}break}t=t.parent}var f=new i.Vector3;var d=new i.Quaternion;var p=new i.Vector3;a.decompose(f,d,p);n={};n.translation=f.toArray();n.quaternion=d.toArray();n.scale=p.toArray()}if(!n){n=this.getTransformationWorld(t)}return n};C.prototype.getRestTransformation=function(t){var e;var r=this.getCurrentView();if(r){e=r.getNodeInfos()}var n;if(e){e.forEach(function(e){if(e.target!==t){return}if(e.transform){var r=new i.Vector3;var a=new i.Quaternion;var o=new i.Vector3;var s=x(e.transform);s.decompose(r,a,o);n={};n.translation=r.toArray();n.quaternion=a.toArray();n.scale=o.toArray()}else if(e[y.Scale]&&e[y.Rotate]&&e[y.Translate]){n={};n.translation=e[y.Translate].slice();n.quaternion=e[y.Rotate].slice();n.scale=e[y.Scale].slice()}})}if(!n&&t){n={};n.translation=t.userData.position?t.userData.position.toArray():t.position.toArray();n.quaternion=t.userData.quaternion?t.userData.quaternion.toArray():t.quaternion.toArray();n.scale=t.userData.scale?t.userData.scale.toArray():t.scale.toArray();n.matrix=t.matrix.clone()}return n};C.prototype._addToTransformation=function(t,e,r,n,a,o){var s={};var l;if(e){s.translation=[];for(l=0;l<3;l++){s.translation.push(e[l]+t.translation[l])}}else{s.translation=t.translation}if(n){s.scale=[];for(l=0;l<3;l++){s.scale.push(n[l]*t.scale[l])}}else{s.scale=t.scale}if(r){var c=new i.Quaternion(t.quaternion[0],t.quaternion[1],t.quaternion[2],t.quaternion[3]);var h=new i.Quaternion(r[0],r[1],r[2],r[3]);if(a===u.Euler){var f=o?o[3]:6;var d=g.threeQuatToNeutralEuler(c,f);var p=o?o:g.threeQuatToNeutralEuler(h,f);d[0]+=p[0];d[1]+=p[1];d[2]+=p[2];s.quaternion=g.glMatrixQuatToNeutral(g.neutralEulerToGlMatrixQuat(d))}else{var y=(new i.Matrix4).makeRotationFromQuaternion(c);var v=(new i.Matrix4).makeRotationFromQuaternion(h);y.premultiply(v);c.setFromRotationMatrix(y);s.quaternion=[c.x,c.y,c.z,c.w]}}else{s.quaternion=t.quaternion}return s};C.prototype.setInterpolatedRelativeValues=function(t,e){if(!t.userData){t.userData={}}if(e.rtranslate){t.userData.offsetTranslation=e.rtranslate}else{t.userData.offsetTranslation=null}if(e.rscale){t.userData.offsetScale=e.rscale}else{t.userData.offsetScale=null}if(e.rrotate){t.userData.offsetQuaternion=e.rrotate;t.userData.originalRotationType=e.originalRotationType}else{t.userData.offsetQuaternion=null;t.userData.originalRotationType=null}if(e.Euler){t.userData.Euler=e.Euler}else{t.userData.Euler=null}if(e.ropacity!=null){t.userData.offsetOpacity=e.ropacity}else{t.userData.offsetOpacity=null}return this};C.prototype._setJointNodeMatrix=function(){if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}var e=t.node;if(e.userData.skipUpdateJointNode){return}var r={};r.translation=t.translation.slice();r.scale=t.scale.slice();r.quaternion=t.quaternion.slice();var n=this._addToTransformation(r,e.userData.offsetTranslation,e.userData.offsetQuaternion,e.userData.offsetScale,e.userData.originalRotationType,e.userData.Euler);e.position.fromArray(n.translation);e.scale.fromArray(n.scale);e.quaternion.fromArray(n.quaternion);e.updateMatrix();var a=e.quaternion.clone();var o=new i.Matrix4;if(t.parent){t.parent.updateMatrixWorld();o=t.parent.matrixWorld.clone();e.matrixWorld.multiplyMatrices(t.parent.matrixWorld,e.matrix)}else{e.matrixWorld.copy(e.matrix)}var s=new i.Matrix4;if(e.parent){e.parent.updateWorldMatrix(true,false);s.copy(e.parent.matrixWorld);e.matrix.getInverse(e.parent.matrixWorld).multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale);var l=[e.scale.x,e.scale.y,e.scale.z];this._adjustQuaternionAndScale(o,s,a,e.quaternion,n.scale,l);e.scale.x=l[0];e.scale.y=l[1];e.scale.z=l[2];if(t.nodesToUpdate){t.nodesToUpdate.forEach(function(t){if(t.matrixAutoUpdate){t.updateMatrix()}t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix)})}}.bind(this))}};C.prototype._getEndPropertyInLastPlayback=function(t,e){var i;var r=this.getCurrentView();if(!r){return i}var n=r.getPlaybacks();if(!n||!n.length){return i}for(var a=n.length-1;a>=0;a--){var o=n[a];var s=o.getSequence();if(s._convertedFromAbsolute){return i}i=o.getNodeBoundaryProperty(t,e,true);if(i){break}}return i};C.prototype._getEndPropertyInPreviousPlayback=function(t,e,i,r){var n;var a=this._getJointByChildNode(t);if(a&&!r){return n}var o=i.getSequence();if(o&&o._convertedFromAbsolute){return n}var s=this.getCurrentView();if(!s){return n}var l=s.getPlaybacks();for(var u=1;u<l.length;u++){var c=l[u];if(c!==i){continue}for(var h=u-1;h>=0;h--){var f=l[h];n=f.getNodeBoundaryProperty(t,e,true);if(n){break}}}return n};C.prototype._convertTracksToRelative=function(t,e){if(e&&t._conversionDoneForReversed||!e&&t._conversionDone){return this}t._convertedFromAbsolute=false;var r=this.getCurrentView();if(!r){return this}var n=t.getNodeAnimation();if(!n||!n.length){return this}var a=r.getNodeInfos();if(a){a.forEach(function(e){var r;for(var a=0;a<n.length;a++){if(e.target===n[a].nodeRef){r=n[a];break}}if(!r){return}var o=[0,0,0];var s=[1,1,1];var l=new i.Quaternion;var u=new i.Vector3;var c=new i.Vector3;if(e.transform){var h=x(e.transform);h.decompose(u,l,c);o=u.toArray();s=c.toArray()}else if(e[y.Scale]&&e[y.Rotate]&&e[y.Translate]){o=e[y.Translate].slice();l=new i.Quaternion(e[y.Rotate][0],e[y.Rotate][1],e[y.Rotate][2],e[y.Rotate][3]);s=e[y.Scale].slice()}else{e.target.matrix.decompose(u,l,c);o=u.toArray();s=c.toArray()}var f,d,p,_;var m=r[y.Translate];if(m&&m.getIsAbsoluteValue()){d=m.getKeysCount();for(f=0;f<d;f++){p=m.getKey(f);_=[p.value[0]-o[0],p.value[1]-o[1],p.value[2]-o[2]];m.updateKey(f,_,true)}m.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var A=r[y.Scale];if(A&&A.getIsAbsoluteValue()){d=A.getKeysCount();for(f=0;f<d;f++){p=A.getKey(f);_=[p.value[0]/s[0],p.value[1]/s[1],p.value[2]/s[2]];A.updateKey(f,_,true)}A.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var w=r[y.Opacity];if(w&&w.getIsAbsoluteValue()){var C=this.getRestOpacity(e.target);if(!C){C=1}d=w.getKeysCount();for(f=0;f<d;f++){p=w.getKey(f);_=p.value/C;w.updateKey(f,_,true)}w.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var b=r[y.Rotate];if(b&&b.getIsAbsoluteValue()){var S;var T=(new i.Matrix4).makeRotationFromQuaternion(l);var R=(new i.Matrix4).getInverse(T);var N=new i.Matrix4;var k=new i.Matrix4;d=b.getKeysCount();var V=b.getKeysType();for(f=0;f<d;f++){p=b.getKey(f);if(V===v.Quaternion){S=new i.Quaternion(p.value[0],p.value[1],p.value[2],p.value[3]);N.makeRotationFromQuaternion(S);k.multiplyMatrices(N,R);S.setFromRotationMatrix(k);_=S.toArray();b.updateKey(f,_,true)}else if(V===v.Euler){var B=p.value;var D=g.threeQuatToNeutralEuler(l,B[3]);_=[B[0]-D[0]+g.getModulatedAngularValue(B[0]),B[1]-D[1]+g.getModulatedAngularValue(B[1]),B[2]-D[2]+g.getModulatedAngularValue(B[2]),B[3]];b.updateKey(f,_,true)}else if(f===0){var E=new i.Vector3(p.value[0],p.value[1],p.value[2]);N.makeRotationAxis(E,p.value[3]);k.multiplyMatrices(N,R);S=(new i.Quaternion).setFromRotationMatrix(k);_=this._convertQuaternionToAngleAxis(S);b.updateKey(f,_,true);break}}b.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}}.bind(this))}if(!e){t._conversionDone=true;t._conversionDoneForReversed=false}else{t._conversionDone=false;t._conversionDoneForReversed=true}return this};C.prototype._getTrackKeys=function(t){var e=[];var i=t.getKeysCount();for(var r=0;r<i;r++){var n=t.getKey(r);var a;if(Array.isArray(n.value)){a=n.value.slice()}else{a=n.value}e.push({time:n.time,value:a})}return e};C.prototype._setJointNodeOffsets=function(t,e){var r=this._getJointByChildNode(t);if(r){var n=new i.Matrix4;if(t.parent){n=t.parent.matrixWorld.clone()}var a=new i.Matrix4;t.updateMatrixWorld();var o=new i.Matrix4;if(r.parent){r.parent.updateMatrixWorld();o=r.parent.matrixWorld.clone();a.getInverse(r.parent.matrixWorld).multiply(t.matrixWorld)}else{a.copy(t.matrixWorld)}var s=new i.Vector3;var l=new i.Vector3;var u=new i.Quaternion;a.decompose(s,u,l);if(e===y.Translate){var c=s.toArray();t.userData.offsetTranslation=[c[0]-r.translation[0],c[1]-r.translation[1],c[2]-r.translation[2]]}else if(e===y.Scale){var h=l.toArray();this._adjustQuaternionAndScale(n,o,t.quaternion,u,t.scale.toArray(),h);t.userData.offsetScale=[h[0]/r.scale[0],h[1]/r.scale[1],h[2]/r.scale[2]]}else{this._adjustQuaternionAndScale(n,o,t.quaternion,u,t.scale.toArray(),l.toArray());var f=new i.Quaternion(r.quaternion[0],r.quaternion[1],r.quaternion[2],r.quaternion[3]);var d=(new i.Matrix4).makeRotationFromQuaternion(f);var p=(new i.Matrix4).getInverse(d);var v=(new i.Matrix4).makeRotationFromQuaternion(u);var g=(new i.Matrix4).multiplyMatrices(v,p);var _=(new i.Quaternion).setFromRotationMatrix(g);t.userData.offsetQuaternion=_.toArray()}}return this};C.prototype.setTranslationKey=function(t,e,r,n){var a=r.getSequence();if(!a){return null}var o;var s=new i.Vector3;t.matrix.decompose(s,new i.Quaternion,new i.Vector3);var l=this._getJointByChildNode(t);if(l){o=l.translation.slice();t.updateMatrixWorld();var u=new i.Matrix4;if(l.parent){l.parent.updateMatrixWorld();u.getInverse(l.parent.matrixWorld).multiply(t.matrixWorld)}else{u.matrix.copy(t.matrixWorld)}u.decompose(s,new i.Quaternion,new i.Vector3)}else{var c=this.getRestTransformation(t);o=c.translation}var h=s.toArray();var f=[h[0]-o[0],h[1]-o[1],h[2]-o[2]];var d=this._getEndPropertyInPreviousPlayback(t,y.Translate,r);if(d){f[0]-=d[0];f[1]-=d[1];f[2]-=d[2]}var p=a.getNodeAnimation(t,y.Translate);var g;if(!p){p=this._scene.createTrack(null,{trackValueType:v.Vector3,isAbsoluteValue:false});a.setNodeAnimation(t,y.Translate,p,true)}else{g=this._getTrackKeys(p)}p.insertKey(e,f,n);var _=this._getTrackKeys(p);return{KeyValue:f,absoluteValue:h,offset:d,PreviousTrack:g,CurrentTrack:_}};C.prototype._adjustQuaternionAndScale=function(t,e,r,n,a,o){function s(t,e,i,r){var n=Math.abs(t.dot(e));var a=Math.abs(t.dot(i));var o=Math.abs(t.dot(r));if(n>=a&&n>=o){return 0}else if(a>=n&&a>=o){return 1}else{return 2}}if(a[0]>0&&a[1]>0&&a[2]>0){return}var l=t.clone().multiply((new i.Matrix4).makeRotationFromQuaternion(r));var u=(new i.Matrix4).makeRotationFromQuaternion(n);var c=e.clone().multiply(u);var h=new i.Vector3;var f=new i.Vector3;var d=new i.Vector3;l.extractBasis(h,f,d);var p=[h,f,d];var y=new i.Vector3;var v=new i.Vector3;var g=new i.Vector3;c.extractBasis(y,v,g);var _=[1,1,1];for(var m=0;m<3;m++){var A=s(p[m],y,v,g);if(a[m]*o[A]<0){_[A]=-1;o[A]=-o[A]}}u.scale(new i.Vector3(_[0],_[1],_[2]));var w=(new i.Quaternion).setFromRotationMatrix(u);n.x=w.x;n.y=w.y;n.z=w.z;n.w=w.w};C.prototype.setScaleKey=function(t,e,r,n){var a=r.getSequence();if(!a){return null}var o;var s=t.scale.toArray();var l=t.quaternion.clone();var u=this._getJointByChildNode(t);if(u){var c=new i.Matrix4;if(t.parent){c=t.parent.matrixWorld.clone()}o=u.scale.slice();t.updateMatrixWorld();var h=new i.Matrix4;var f=new i.Matrix4;if(u.parent){u.parent.updateMatrixWorld();f=u.parent.matrixWorld.clone();h.getInverse(u.parent.matrixWorld).multiply(t.matrixWorld)}else{h.copy(t.matrixWorld)}var d=new i.Quaternion;var p=new i.Vector3;h.decompose(new i.Vector3,d,p);var g=p.toArray();this._adjustQuaternionAndScale(c,f,l,d,s,g);s=g}else{var _=this.getRestTransformation(t);o=_.scale}var m=[s[0]/o[0],s[1]/o[1],s[2]/o[2]];var A=this._getEndPropertyInPreviousPlayback(t,y.Scale,r);if(A){m[0]/=A[0];m[1]/=A[1];m[2]/=A[2]}var w=a.getNodeAnimation(t,y.Scale);var C;if(!w){w=this._scene.createTrack(null,{trackValueType:v.Vector3,isAbsoluteValue:false});a.setNodeAnimation(t,y.Scale,w,true)}else{C=this._getTrackKeys(w)}w.insertKey(e,m,n);var b=this._getTrackKeys(w);return{KeyValue:m,absoluteValue:s,offset:A,PreviousTrack:C,CurrentTrack:b}};C.prototype.setRotationKey=function(t,e,r,n,a){var o=n.getSequence();if(!o){return null}var s=36;var l=[r[0],r[1],r[2],s];var u=o.getNodeAnimation(t,y.Rotate);if(u&&u.getKeysType()!==v.Euler){return null}var c;if(!u){u=this._scene.createTrack(null,{trackValueType:v.Euler,isAbsoluteValue:false});o.setNodeAnimation(t,y.Rotate,u,true)}else{c=this._getTrackKeys(u)}u.insertKey(e,l,a);var h=this._getTrackKeys(u);var f=new i.Quaternion;var d=new i.Euler(r[0],r[1],r[2]);f.setFromEuler(d);var p=this._getEndPropertyInPreviousPlayback(t,y.Rotate,n);if(p){var g=new i.Quaternion(p[0],p[1],p[2],p[3]);f.multiply(g)}var _=this._getJointByChildNode(t);var m=new i.Quaternion;if(_){m.fromArray(_.quaternion)}else{var A=this.getRestTransformation(t);m.fromArray(A.quaternion)}f.multiply(m);return{KeyValue:l,absoluteValue:f.toArray(),offset:p,PreviousTrack:c,CurrentTrack:h}};C.prototype.setAxisAngleRotationKey=function(t,e,i,r,n){var a=r.getSequence();if(!a){return null}var o=a.getNodeAnimation(t,y.Rotate);if(o&&o.getKeysType()!==v.AngleAxis){if(!o.setKeysType(v.AngleAxis)){return null}}var s=[i[0],i[1],i[2],i[3]];var l;if(!o){o=this._scene.createTrack(null,{trackValueType:v.AngleAxis,isAbsoluteValue:false});a.setNodeAnimation(t,y.Rotate,o,true)}else{l=this._getTrackKeys(o)}o.insertKey(e,s,n);var u=this._getTrackKeys(o);return{KeyValue:s,PreviousTrack:l,CurrentTrack:u}};C.prototype.getTotalOpacity=function(t){return t._vkGetTotalOpacity(this._jointCollection)};C.prototype.setTotalOpacity=function(t,e){var i=1;var r=this._getJointByChildNode(t);if(r&&r.parent){i=r.parent._vkGetTotalOpacity(this._jointCollection)}else if(t.parent){i=t.parent._vkGetTotalOpacity(this._jointCollection)}if(!t.userData){t.userData={}}var n=this.getOpacity(t);if(i!==0){n=e/i}else{e=0}t._vkSetOpacity(n,this._jointCollection);var a={changed:t,opacity:n};this.fireOpacityChanged(a);return{opacity:n,totalOpacity:e}};C.prototype.setOpacityKey=function(t,e,i,r){var n=i.getSequence();if(!n){return null}var a=1;if(t.userData&&t.userData.opacity!==undefined&&t.userData.opacity!==null){a=t.userData.opacity}var o=this.getRestOpacity(t);if(!o&&n._convertedFromAbsolute){o=1}a/=o;var s=this._getEndPropertyInPreviousPlayback(t,y.Opacity,i);if(s){a/=s}var l=n.getNodeAnimation(t,y.Opacity);var u;if(!l){l=this._scene.createTrack(null,{trackValueType:v.Opacity});n.setNodeAnimation(t,y.Opacity,l,true)}else{u=this._getTrackKeys(l)}l.insertKey(e,a,r);var c=this._getTrackKeys(l);return{KeyValue:a,totalOpacity:this.getTotalOpacity(t),PreviousTrack:u,CurrentTrack:c}};w=function(){this._visibilityChanges=new Set};w.prototype.getInfo=function(t){var e=[];this._visibilityChanges.forEach(function(i){var r=t.createNodeProxy(i);var n=r.getVeId();t.destroyNodeProxy(r);if(n){e.push(n)}else{e.push(t.getScene().nodeRefToPersistentId(i))}});return e};w.prototype.clear=function(){this._visibilityChanges.clear()};w.prototype.trackNodeRef=function(t){if(this._visibilityChanges.has(t)){this._visibilityChanges.delete(t)}else{this._visibilityChanges.add(t)}};return C});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Viewport", ["../Core","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../thirdparty/three","../ViewStateManager","./ViewportGestureHandler","./OrthographicCamera","./PerspectiveCamera","./NodesTransitionHelper","../Messages","sap/ui/base/ManagedObjectObserver","./ViewportRenderer","../CameraProjectionType","../CameraFOVBindingType","../VisibilityMode","../ZoomTo","../SelectionMode","../RenderMode","../getResourceBundle","../cssColorToColor","../ViewStateManager","./ViewStateManager","./v2/ViewStateManager","./HitTester","./Scene","./ContentDeliveryService","../SafeArea","../Annotation","../measurements/Surface","../NodeContentType","sap/base/Log","sap/ui/core/Core","../findIndexInArray"],function(e,t,i,r,a,n,o,s,h,l,d,c,u,g,f,p,v,_,m,y,w,C,R,S,E,b,T,k,x,M,V,H,B,A,L){"use strict";var O=t.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{position:"float[]",quaternion:"float[]",zoom:"float"},enableEventBubbling:true},frameRenderingFinished:{}}}});var N=O.getMetadata().getParent().getClass().prototype;THREE.PropertyBinding.prototype.GetterByBindingType[0]=function(e,t){e[t]=this.targetObject[this.propertyName]};O.prototype.init=function(){if(N.init){N.init.call(this)}this._measurementSurface=new V;this._renderer=null;this._imageCanvas=null;this._canvas=null;this._registryEntry=null;this._width=1;this._height=1;this._resizeListenerId=null;this._handleResize=this._handleResize.bind(this);this._renderLoopRequestId=0;this._renderLoop=this._renderLoop.bind(this);this._shouldRenderFrame=true;this._clippingPlanes=[];this._hitTester=new b;this._scene=null;this._camera=new l;this._upAxis=2;var t=new THREE.Vector4;var i=new THREE.Vector4;this._updateColor(t,this.getBackgroundColorTop());this._updateColor(i,this.getBackgroundColorBottom());this._checkBackgroundColor();this._backgroundMaterial=new THREE.ShaderMaterial({uniforms:{topColor:{value:t},bottomColor:{value:i}},vertexShader:["varying float vPos;","void main() {","\tgl_Position = vec4(position, 1.0);","\tvPos = position.y * -0.5 + 0.5;","}"].join("\n"),fragmentShader:["uniform vec4 topColor;","uniform vec4 bottomColor;","varying float vPos;","void main() {","\tgl_FragColor = mix(topColor, bottomColor, vPos);","}"].join("\n"),side:THREE.DoubleSide,depthTest:false,depthWrite:false,blending:THREE.NoBlending});var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(-1,1,0),new THREE.Vector3(1,1,0),new THREE.Vector3(-1,-1,0),new THREE.Vector3(1,-1,0));r.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));this._backgroundCamera=new THREE.Camera;this._backgroundScene=new THREE.Scene;this._backgroundScene.add(new THREE.Mesh(r,this._backgroundMaterial));this._underlayGroup=new THREE.Group;this._overlayGroup=new THREE.Group;this._xrayColor1=new THREE.Vector4(0,.75,1,.45);this._xrayColor2=new THREE.Vector4(0,0,1,0);this._xrayMaterial=new THREE.ShaderMaterial({uniforms:{color1:{value:this._xrayColor1},color2:{value:this._xrayColor2}},vertexShader:["#include <clipping_planes_pars_vertex>","varying vec3 vNormal;","void main() {","#include <begin_vertex>","#include <project_vertex>","#include <clipping_planes_vertex>","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","\tvNormal = normalize( transformedNormal );","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","uniform vec4 color1;","uniform vec4 color2;","varying vec3 vNormal;","void main() {","#include <clipping_planes_fragment>","\tgl_FragColor = mix(color1, color2, abs(normalize(vNormal).z));","}"].join("\n"),side:THREE.DoubleSide,depthWrite:false,depthFunc:THREE.LessDepth,blending:THREE.NormalBlending,clipping:true,transparent:true});this._viewportGestureHandler=new s(this);this._loco=new a(this);this._loco.addHandler(this._viewportGestureHandler,-1);this._zoomedObject=null;this._cdsLoader=null;this.attachCameraChanged(function(e){this.setShouldRenderFrame()});this._sceneObserver=new u(this.setShouldRenderFrame.bind(this));this._currentViewIndex=0;this._currentView=null;e.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);A.attachLocalizationChanged(this._onLocalizationChanged,this)};O.prototype.cameraUpdateCompleted=function(e){this.fireViewFinished({viewIndex:this._currentViewIndex})};O.prototype.exit=function(){A.detachLocalizationChanged(this._onLocalizationChanged,this);e.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._measurementSurface.destroy();this._measurementSurface=null;this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}this._stopRenderLoop();var t=this.getTools();for(var r=0;r<t.length;r++){var a=A.byId(t[r]);if(a){a.setActive(false)}}this._setContent(null);this.setCamera(null);this._backgroundCamera=null;this._backgroundMaterial=null;this._backgroundScene=null;this._loco=null;this._viewportGestureHandler=null;this._eyePointLight=null;this._hitTester=null;this._imageCanvas=null;if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this)}if(N.exit){N.exit.call(this)}};O.prototype._onLocalizationChanged=function(e){var t=this._measurementSurface;if(t&&t.getMeasurements().length>0){t.update(this,this.getCamera())}};O.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachVisibilityChanged(this._onVisibilityChanged,this);e.attachOpacityChanged(this.setShouldRenderFrame,this);e.attachTintColorChanged(this.setShouldRenderFrame,this);e.attachHighlightColorChanged(this.setShouldRenderFrame,this);e.attachTransformationChanged(this.setShouldRenderFrame,this);e.attachOutlineColorChanged(this.setShouldRenderFrame,this);e.attachOutlineWidthChanged(this.setShouldRenderFrame,this);e.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.attachSelectionChanged(this._onOutliningOrSelectionChanged,this)};O.prototype.onUnsetViewStateManager=function(e){e.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);e.detachVisibilityChanged(this._onVisibilityChanged,this);e.detachOpacityChanged(this.setShouldRenderFrame,this);e.detachTintColorChanged(this.setShouldRenderFrame,this);e.detachHighlightColorChanged(this.setShouldRenderFrame,this);e.detachTransformationChanged(this.setShouldRenderFrame,this);e.detachOutlineColorChanged(this.setShouldRenderFrame,this);e.detachOutlineWidthChanged(this.setShouldRenderFrame,this);this._viewStateManager=null};O.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}return this};O.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0}return this};O.prototype.setBackgroundColorTop=function(e){N.setBackgroundColorTop.call(this,e);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.topColor.value,e);this._checkBackgroundColor()}return this};O.prototype.setBackgroundColorBottom=function(e){N.setBackgroundColorBottom.call(this,e);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.bottomColor.value,e);this._checkBackgroundColor()}return this};O.prototype.setClippingPlanes=function(e){this._clippingPlanes=e;return this};O.prototype.onBeforeRendering=function(){if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}this._stopRenderLoop()};O.prototype.onAfterRendering=function(){var e=this.getDomRef();if(this._canvas){e.append(this._canvas)}e.append(this._measurementSurface.getDomRef());this._resizeListenerId=i.register(this,this._handleResize);this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}});this._startRenderLoop()};O.prototype._handleResize=function(e){if(!this._camera||!this._renderer){return false}if(this.getSafeArea()){this.getSafeArea().resize()}var t=e.size.width;var i=e.size.height;this._width=t;this._height=i;if(this._camera){this._camera.update(t,i)}var r=this._canvas;var a=this._renderer.domElement;if(r!==a){var n=window.devicePixelRatio;r.width=Math.floor(t*n);r.height=Math.floor(i*n);r.style.width=t+"px";r.style.height=i+"px"}J(this._registryEntry);var o=this._measurementSurface.getDomRef();o.style.width=t+"px";o.style.height=i+"px";this.fireResize({size:{width:t,height:i}});this.setShouldRenderFrame();return true};O.prototype.setScene=function(e){if(this._scene){var t=this._scene.getDefaultNodeHierarchy();t.detachChanged(this._clearAnnotations,this);t.detachNodeCreated(this._nodeCreatedHandler,this);q(this,this._scene)}this._scene=e;this._homeCamera=null;this._currentViewIndex=0;this._currentView=null;this._sceneObserver.disconnect();var i=this._getNativeScene();if(i){this._sceneObserver.observe(this._scene,{properties:["doubleSided"]});var r;for(var a=0;a<i.children.length;a++){r=i.children[a];if(r.private&&r.name==="DefaultLights"&&r.children.length){if(r.children[0]instanceof THREE.PointLight){this._eyePointLight=r.children[0]}}}}if(this._scene){this._scene.getDefaultNodeHierarchy().attachChanged(this._clearAnnotations,this);this._scene.getDefaultNodeHierarchy().attachNodeCreated(this._nodeCreatedHandler,this)}if(this._scene){var n=this._scene.getInitialView();if(n&&this._getViewStateManagerThreeJS()){this.activateView(n,false,true)}}this._clearAnnotations(true);this.setShouldRenderFrame();return this};O.prototype.getScene=function(){return this._scene};O.prototype._getNativeScene=function(){return this._scene?this._scene.getSceneRef():null};O.prototype._getNativeCamera=function(){return this._camera?this._camera.getCameraRef():null};O.prototype._clearAnnotations=function(e){if(e){this.destroyAnnotations()}else{this.getAnnotations().forEach(function(e){if(e.autoGenerated){this.removeAnnotation(e)}},this)}this._annotationsLoaded=false};O.prototype._nodeCreatedHandler=function(e){var t=e.getParameter("nodeRef");if(t._vkGetNodeContentType()==H.Annotation){var i=this.getCurrentView();if(i){i.getNodeInfos().push({target:t,visible:true})}}};O.prototype.setCamera=function(e){if(N.setCamera){N.setCamera.call(this,e)}var t=this.getCamera();if(t&&this._renderer){t.update(this._width,this._height);if(!this._homeCamera&&t.getCameraRef()){this._homeCamera=t.getCameraRef().clone()}}this.setShouldRenderFrame();return this};O.prototype.getRenderer=function(){return this._renderer};O.prototype._getViewStateManagerThreeJS=function(){if(this._viewStateManager){if(this._viewStateManager instanceof S){return this._viewStateManager}if(this._viewStateManager instanceof R&&this._viewStateManager._implementation instanceof S){return this._viewStateManager._implementation}}return null};O.prototype._updateColor=function(e,t){var i=C(t);e.color=new THREE.Color(i.red/255,i.green/255,i.blue/255);e.alpha=i.alpha;e.x=e.color.r*e.alpha;e.y=e.color.g*e.alpha;e.z=e.color.b*e.alpha;e.w=e.alpha};O.prototype._checkBackgroundColor=function(){var e=this.getBackgroundColorTop();if(e===this.getBackgroundColorBottom()){if(this._backgroundColor===null){this._backgroundColor=new THREE.Vector4}this._updateColor(this._backgroundColor,e)}else{this._backgroundColor=null}this.setShouldRenderFrame()};O.prototype._handleCdsSceneUpdate=function(){this.setShouldRenderFrame()};O.prototype._handleLoadingFinished=function(){this._clearAnnotations();this.getAnnotations();this.setShouldRenderFrame()};O.prototype.setShouldRenderFrame=function(){this._shouldRenderFrame=true;return this};O.prototype.shouldRenderFrame=function(){return this._shouldRenderFrame};O.prototype.setRenderMode=function(e){this.setProperty("renderMode",e,true);if(this._scene){switch(e){case y.LineIllustration:case y.ShadedIllustration:case y.SolidOutline:this._scene._createOutlineGeometry(e);break;default:this._scene._hideOutlineGeometry();break}}this.setShouldRenderFrame();return this};O.prototype.hitTest=function(e,t,i){var r=this._getNativeScene();var a=this._getNativeCamera();if(!a||!r){return null}var n=this._getViewStateManagerThreeJS();if(n&&n.applyNodeStates){n.applyNodeStates()}try{var o=this._canvas;return this._hitTester.hitTest(e-o.clientLeft,t-o.clientTop,o.clientWidth,o.clientHeight,this._renderer,r,a,this._clippingPlanes,i)}finally{if(n&&n.revertNodeStates){n.revertNodeStates()}}};O.prototype._isRedlineActivated=function(){var e=this._getNativeCamera();return e?e.userData.isRedlineActivated:false};var P={sphere:"spherical",plane:"planar"};O.prototype._onVisibilityChanged=function(e){function t(e){return e.visible&&e._vkGetNodeContentType()===H.Background&&P[e.name]!==undefined}function i(e){var r=e.find(t);for(var a=0;!r&&a<e.length;a++){r=i(e[a].children)}return r}var r=e.getParameter("visible");var a=r&&i(r);if(a!=null){this._backgroundNode=a}else if(this._backgroundNode!=null){var n=e.getParameter("hidden");if(this._backgroundNode===(n&&n.find(t))){this._backgroundNode=null}}this.setShouldRenderFrame()};O.prototype.getBackgroundProjection=function(){return P[this._backgroundNode&&this._backgroundNode.name]};O.prototype._isPanoramicActivated=function(){return this.getBackgroundProjection()==="spherical"};O.prototype._isPlanarActivated=function(){return this.getBackgroundProjection()==="planar"};O.prototype.tap=function(e,t,i){if(!i){if(this._viewStateManager){var r=this.hitTest(e,t);var a=r&&r.object;this.tapObject(a);if(a!==null){this.fireNodeClicked({nodeRef:a,x:e,y:t},true,true)}}}else if(!this.getFreezeCamera()){var n=this.hitTest(e,t);if(n&&(this._zoomedObject===null||this._zoomedObject!==n.object)){this._zoomedObject=n.object;this._viewportGestureHandler.zoomObject(this._zoomedObject,true)}else{this._viewportGestureHandler.zoomObject(this._zoomedObject,false);this._zoomedObject=null}}return this};O.prototype.tapObject=function(e){var t={picked:e?[e]:[]};this.fireNodesPicked(t);if(e&&e._vkGetNodeContentType()===H.Background){this.exclusiveSelectionHandler([]);return this}if(this.getSelectionMode()===m.Exclusive){this.exclusiveSelectionHandler(t.picked)}else if(this.getSelectionMode()===m.Sticky){this.stickySelectionHandler(t.picked)}return this};var F={x:-2,y:-2};var I=2;var z=5;O.prototype.onkeydown=function(e){if(!e.isMarked()){var t;switch(e.keyCode){case r.ARROW_LEFT:case r.ARROW_RIGHT:case r.ARROW_UP:case r.ARROW_DOWN:if(e.ctrlKey||e.altKey||e.metaKey){break}var i={x:0,y:0};switch(e.keyCode){case r.ARROW_LEFT:i.x=-1;break;case r.ARROW_RIGHT:i.x=+1;break;case r.ARROW_UP:i.y=-1;break;case r.ARROW_DOWN:i.y=+1;break;default:break}t=this._viewportGestureHandler._cameraController;t.beginGesture(F.x,F.y);if(e.shiftKey){t.pan(z*i.x,z*i.y)}else{t.rotate(I*i.x,I*i.y,true)}t.endGesture();this.setShouldRenderFrame();e.preventDefault();e.stopPropagation();break;case 189:case r.PLUS:case r.NUMPAD_MINUS:case r.NUMPAD_PLUS:t=this._viewportGestureHandler._cameraController;t.beginGesture(this.$().width()/2,this.$().height()/2);t.zoom(e.keyCode===r.PLUS||e.keyCode===r.NUMPAD_PLUS?1.02:.98);t.endGesture();this.setShouldRenderFrame();e.preventDefault();e.stopPropagation();break;default:break}}};O.prototype._onOutliningOrSelectionChanged=function(e){var t=this.getTools();for(var i=0;i<t.length;i++){var r=A.byId(t[i]);var a=r.getGizmoForContainer(this);if(a&&a.handleSelectionChanged){a.handleSelectionChanged(e)}}this.setShouldRenderFrame()};O.prototype.setSelectionRect=function(e){this.setShouldRenderFrame();if(!e){this._selectionRect=null;return}var t=e.x1/this._width*2-1;var i=e.y1/this._height*-2+1;var r=e.x2/this._width*2-1;var a=e.y2/this._height*-2+1;if(!this._selectionRect){var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(t,a,-1),new THREE.Vector3(r,a,-1),new THREE.Vector3(r,i,-1),new THREE.Vector3(t,i,-1));this._selectionRect=new THREE.LineLoop(n,new THREE.LineBasicMaterial({color:12632064,linewidth:window.devicePixelRatio}))}else{var o=this._selectionRect.geometry.vertices;o[0].set(t,a,-1);o[1].set(r,a,-1);o[2].set(r,i,-1);o[3].set(t,i,-1);this._selectionRect.geometry.verticesNeedUpdate=true}};O.prototype._renderLoop=function(){if(!this._renderer||!this.getDomRef()){this._renderLoopRequestId=0;return}if(this._viewportGestureHandler){this._viewportGestureHandler.animateCameraUpdate()}if(this.getCamera()){if(this.getCamera().getIsModified()){this.getCamera().setIsModified(false);this._shouldRenderFrame=true}}var e=this._getViewStateManagerThreeJS();if(e){this._shouldRenderFrame|=e._playTransition();this._shouldRenderFrame|=e._playHighlight()}if(this._shouldRenderFrame&&this.getAutoStartRendering()){this._shouldRenderFrame=false;if(e){e._setJointNodeMatrix()}this.render();var t=this.getAnnotations();if(t){t.forEach(function(e){e.update()})}this._measurementSurface.update(this,this.getCamera())}this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)};function G(e,t,i,r){var a=new THREE.Vector2(r._width,r._height);var n=r.getBackgroundProjection();i.children.forEach(function(i){if(i.userData._vkDynamicObjects){i.userData._vkDynamicObjects.forEach(function(i){if(i.parent){i._vkUpdate(e,t,a,n)}})}})}function D(e,t,i,r,a){i.children.forEach(function(n){if(n.userData._vkDetailViews){n.userData._vkDetailViews.sort(function(e,t){return e.renderOrder-t.renderOrder});n.userData._vkDetailViews.forEach(function(n){if(n.node.visible){n.detailView._render(e,t,i,r,a)}})}})}O.prototype._updateWorldMatrixRecursive=function(e,t){if(e.visible===false){return}if(e.userData.renderStage){(e.userData.renderStage<0?this._underlayGroup:this._overlayGroup).children.push(e)}e.matrixAutoUpdate=false;if(e.matrixWorldNeedsUpdate||t){if(e.parent===null){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix)}e.matrixWorldNeedsUpdate=true;t=true}var i=e.children;for(var r=0,a=i.length;r<a;r++){this._updateWorldMatrixRecursive(i[r],t)}};function j(e,t){e.children.forEach(function(e){e.visible=t})}O.prototype.render=function(){var e=this._renderer;if(!e){return}var t=this._getViewStateManagerThreeJS();if(t&&t.applyNodeStates){t.applyNodeStates()}try{e.setViewport(0,0,this._canvas.width/window.devicePixelRatio,this._canvas.height/window.devicePixelRatio);var i=this._getNativeScene();var r=this._getNativeCamera();if(!i||!r){return}if(this._eyePointLight){this._eyePointLight.position.copy(r.position);this._eyePointLight.updateMatrix()}this._underlayGroup.children.length=0;this._overlayGroup.children.length=0;this._updateWorldMatrixRecursive(i,false);i.autoUpdate=false;var a=this.getTools();var n,o,s,h;if(this._camera.getUsingDefaultClipPlanes()||r.isOrthographicCamera&&r.zoom<=0){h=this._scene._computeBoundingBox(true,false,true);if(t){t._selectedNodes.forEach(function(e){e._expandBoundingBox(h,false,false,false)})}if(!h.isEmpty()){if(r.isOrthographicCamera&&r.zoom<=0){this._camera.adjustZoom(h)}if(this._camera.getUsingDefaultClipPlanes()){for(n=0;n<a.length;n++){o=A.byId(a[n]);s=o.getGizmoForContainer(this);if(s&&s.expandBoundingBox){s.expandBoundingBox(h)}}this._camera.adjustClipPlanes(h)}}}G(e,r,i,this);e.autoClear=false;if(this._backgroundColor!==null){e.setClearColor(this._backgroundColor.color,this._backgroundColor.alpha);e.clear(true,true,false)}else{e.render(this._backgroundScene,this._backgroundCamera);e.clearDepth()}if(this._underlayGroup.children.length>0){e.render(this._underlayGroup,r);e.clearDepth();j(this._underlayGroup,false)}j(this._overlayGroup,false);e.clippingPlanes=this._clippingPlanes;switch(this.getRenderMode()){case y.XRay:if(t){var l=i.children[i.children.length-1].clone();t._selectedNodes.forEach(function(t){if(t.visible){t.add(l);e.render(t,r);t.remove(l)}})}i.overrideMaterial=this._xrayMaterial;break;case y.LineIllustration:case y.ShadedIllustration:case y.SolidOutline:this._scene._outlineMaterial.linewidth=this._renderer.getPixelRatio();break;default:break}e.render(i,r);e.clippingPlanes=[];i.overrideMaterial=null;if(this._overlayGroup.children.length>0){j(this._overlayGroup,true);e.clearDepth();e.render(this._overlayGroup,r)}j(this._underlayGroup,true);D(e,r,i,h,this._eyePointLight);if(this.getShowSelectionBoundingBoxes()&&t){var d=t._boundingBoxesScene;if(d){t._updateBoundingBoxes();e.render(d,r)}}if(t){t._renderOutline(e,i,r)}for(n=0;n<a.length;n++){o=A.byId(a[n]);s=o.getGizmoForContainer(this);if(s&&s.render){s.render(this)}}if(this._selectionRect){e.render(this._selectionRect,this._backgroundCamera)}var c=this._registryEntry.webGLRenderer.domElement;var u=this._canvas;if(u!==c){var g=u.getContext("2d");var f=u.width;var p=u.height;g.drawImage(c,0,c.height-p,f,p,0,0,f,p)}}finally{if(t&&t.revertNodeStates){t.revertNodeStates()}}this.fireFrameRenderingFinished()};O.prototype.getImage=function(e,t,i,r,a){var n=this._getNativeScene();if(!n){return null}e=Math.min(e||16,2048);t=Math.min(t||16,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var o=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});o.setSize(e,t);var s=this.getBackgroundColorTop();var d=this.getBackgroundColorBottom();if(i&&!r){o.setClearColor(i,1)}else if(!i&&r){o.setClearColor(r,1)}else{if(i&&r){this.setBackgroundColorTop(i);this.setBackgroundColorBottom(r)}o.render(this._backgroundScene,this._backgroundCamera);o.autoClear=false}document.body.appendChild(o.domElement);var c=this.getCamera();var u=c instanceof l?new l:new h;u.getCameraRef().copy(c.getCameraRef());u.update(e,t);if(this._eyePointLight){this._eyePointLight.position.copy(u.getCameraRef().position);this._eyePointLight.updateMatrix();this._eyePointLight.updateMatrixWorld(true)}var g=[];var f=this._getViewStateManagerThreeJS();if(!a){if(f!==null){f.enumerateSelection(function(e){g.push(e)});f.setSelectionState(g,false,false,true)}}o.render(n,u.getCameraRef());var p=o.getContext().canvas.toDataURL();if(f!==null&&g.length>0){f.setSelectionState(g,true,false,true)}document.body.removeChild(o.domElement);o.dispose();if(d&&i){this.setBackgroundColorBottom(d)}if(s&&r){this.setBackgroundColorTop(s)}return p};O.prototype.getMaterialImage=function(e,t,i,r,a,n){t=THREE.Math.clamp(t||256,8,2048);i=THREE.Math.clamp(i||256,8,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var o=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});o.setSize(t,i);var s=this.getBackgroundColorTop();var l=this.getBackgroundColorBottom();if(r&&!a){o.setClearColor(r,1)}else if(!r&&a){o.setClearColor(a,1)}else if(r&&a){this.setBackgroundColorTop(r);this.setBackgroundColorBottom(a);o.render(this._backgroundScene,this._backgroundCamera);o.autoClear=false}else{o.setClearColor("#000000",0)}document.body.appendChild(o.domElement);var d=new h;var c=d.getCameraRef();d.update(t,i);var u=new THREE.SphereGeometry(1,64,32);var g=new THREE.Mesh(u);var f=new THREE.Box3;g._expandBoundingBox(f,false,false,false);c._vkZoomTo(f,n);d.adjustClipPlanes(f);var p=new THREE.PointLight;p.position.copy(c.position);p.position.y=-1;p.updateMatrix();p.updateMatrixWorld(true);g.add(p);var v=Array.isArray(e)?e:[e];var _=[];for(var m in v){g.material=v[m];o.render(g,c);_.push(o.getContext().canvas.toDataURL())}g.remove(p);document.body.removeChild(o.domElement);o.dispose();if(l&&r){this.setBackgroundColorBottom(l)}if(s&&a){this.setBackgroundColorTop(s)}return Array.isArray(e)?_:_[0]};O.prototype.getObjectImage=function(e,t,i,r,a,n,o){return this.getObjectImageEx(e,t,i,r,a,{quaternion:n,margin:o,includeOverlay:true})};O.prototype.getObjectImageEx=function(e,t,i,r,a,n){var o=this._getNativeScene();if(!o){return null}n=n||{};t=THREE.Math.clamp(t||256,8,2048);i=THREE.Math.clamp(i||256,8,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var s=new THREE.WebGLRenderer({canvas:this._imageCanvas,preserveDrawingBuffer:true,antialias:true,alpha:true});s.setSize(t,i);var d=this.getBackgroundColorTop();var c=this.getBackgroundColorBottom();if(r&&!a){s.setClearColor(r,1)}else if(!r&&a){s.setClearColor(a,1)}else{if(r&&a){this.setBackgroundColorTop(r);this.setBackgroundColorBottom(a)}s.render(this._backgroundScene,this._backgroundCamera);s.autoClear=false}document.body.appendChild(s.domElement);var u=this._getViewStateManagerThreeJS();if(u&&u.applyNodeStates){u.applyNodeStates()}try{if(e==null){e=o.children.slice().filter(function(e){return e.name!=="DefaultLights"})}else if(!Array.isArray(e)){e=[e]}var g=this.getCamera();var f=g instanceof l?new l:new h;var p=f.getCameraRef();p.copy(g.getCameraRef());if(n.quaternion&&!n.useViewportCamera){p.quaternion.copy(n.quaternion);p.updateMatrixWorld();p.up.setFromMatrixColumn(p.matrixWorld,1).normalize()}f.update(t,i);if(!n.useViewportCamera){e[0].getWorldPosition(p.position);p.position.sub(p.getWorldDirection(new THREE.Vector3).multiplyScalar(1e3))}p.updateMatrixWorld();p.updateProjectionMatrix();var v=new THREE.Vector2;s.getSize(v);var _=[];e.forEach(function(e){e.traverseVisible(function(e){if(e._vkUpdate){e._vkUpdate(s,p,v);if(e._vkGetNodeContentType()===H.Symbol){e._vkSetOpacity(1)}}if(!n.includeOverlay&&e.userData.renderStage>0||!n.includeUnderlay&&e.userData.renderStage<0){_.push(e);e.visible=false}})});var m=new THREE.Scene;m.children=e;var y=new THREE.Box3;m._expandBoundingBox(y,false,false,false);if(!n.useViewportCamera){p._vkZoomTo(y,n.margin)}f.adjustClipPlanes(y);var w=o.children[o.children.length-1].clone();var C=w.children[0];C.position.copy(p.position);C.updateMatrix();C.updateMatrixWorld(true);m.add(w);var R=[];if(u!=null){u.enumerateSelection(function(e){R.push(e)});u.setSelectionState(R,false,false,true)}s.render(m,p);if(u!=null&&R.length>0){u.setSelectionState(R,true,false,true)}if(_.length>0){_.forEach(function(e){e.visible=true})}m.remove(w);m.children=[]}finally{if(u&&u.revertNodeStates){u.revertNodeStates()}}var S=s.getContext().canvas.toDataURL(n.type,n.encoderOptions);document.body.removeChild(s.domElement);s.dispose();if(c&&r){this.setBackgroundColorBottom(c)}if(d&&a){this.setBackgroundColorTop(d)}return S};O.prototype._setContent=function(e){N._setContent.apply(this,arguments);var t=null;var i;var r;if(this._scene){q(this,this._scene)}if(e){t=e;if(!(t instanceof T)){t=null}i=e.camera;if(i instanceof h){r=t._computeBoundingBox(true,true);var a=new THREE.Vector3;r.getCenter(a);var n=i.getTargetDirection();var o=i.getPosition();var s=[a.x-o[0],a.y-o[1],a.z-o[2]];var d=s[0]*n[0]+s[1]*n[1]+s[2]*n[2];if(d<0){var c=r.getSize().length()/2;c-=d;o[0]-=n[0]*c;o[1]-=n[1]*c;o[2]-=n[2]*c;i.setPosition(o)}}else if(!(i instanceof l)){i=new l;if(e.builders&&e.builders.length>0){r=t._computeBoundingBox(true,true);if(!r.isEmpty()){i.setFov(14.27);var u;if(e.upAxis===4){u=new THREE.Euler(THREE.Math.degToRad(90-30),0,THREE.Math.degToRad(55-90),"ZXY")}else{u=new THREE.Euler(THREE.Math.degToRad(-30),THREE.Math.degToRad(55-90),0,"YXZ")}this.setCamera(i);this._viewportGestureHandler.zoomTo(r,(new THREE.Quaternion).setFromEuler(u),0,0,null,false)}}}var g;if(e.loaders){for(g=0;g<e.loaders.length;g++){if(e.loaders[g]instanceof k){this._cdsLoader=e.loaders[g];this._cdsLoader.getSceneBuilder()._fireSceneUpdated=this.setShouldRenderFrame.bind(this);this._cdsLoader.attachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.attachLoadingFinished(this._handleLoadingFinished,this);this._cdsLoader.attachInitialViewCompleted(this.setShouldRenderFrame,this);break}}}if(e.builders){for(g=0;g<e.builders.length;g++){e.builders[g]._fireSceneUpdated=this.setShouldRenderFrame.bind(this);e.builders[g]._fireLoadingFinished=function(e){this.setRenderMode(this.getRenderMode())}.bind(this)}}}else if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.detachLoadingFinished(this._handleLoadingFinished,this);this._cdsLoader.detachInitialViewCompleted(this.setShouldRenderFrame,this);this._cdsLoader=null}if(t){U(this,t)}this.setScene(t);if(i){this.setCamera(i)}if(e){if(e.backgroundTopColor!==undefined){this.setBackgroundColorTop(new THREE.Color(e.backgroundTopColor).getStyle())}if(e.backgroundBottomColor!==undefined){this.setBackgroundColorBottom(new THREE.Color(e.backgroundBottomColor).getStyle())}if(e.renderMode!==undefined){this.setRenderMode(e.renderMode)}this._upAxis=e.upAxis||2}if(this._measurementSurface!=null){this._measurementSurface.setScale(1)}return this};O.prototype.getCurrentView=function(){return this._currentView};O.prototype._onViewStateApplied=function(e,t,i){if(i.source!=this._getViewStateManagerThreeJS()||!this._scene){return}this._ignoreAnimationPosition=i.ignoreAnimationPosition;this.activateView(i.view,i.playViewGroup,i.notAnimateCameraChange)};O.prototype._activateSingleView=function(t,i,r){var a=this._scene.getViewGroups();var n=this;if(a){a.forEach(function(e){e.getViews().forEach(function(i){if(i===t){n._currentViewIndex=e.getViews().indexOf(i)}})})}this.fireViewActivated({viewIndex:this._currentViewIndex,view:t});e.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:t,viewIndex:this._currentViewIndex});this._currentView=t;var o=t.getTopColor();if(o!=null){if(Array.isArray(o)&&o.length>2){this.setBackgroundColorTop(new THREE.Color(o[0],o[1],o[2]).getStyle())}else{this.setBackgroundColorTop(new THREE.Color(o).getStyle())}}var s=t.getBottomColor();if(s!=null){if(Array.isArray(s)&&s.length>2){this.setBackgroundColorBottom(new THREE.Color(s[0],s[1],s[2]).getStyle())}else{this.setBackgroundColorBottom(new THREE.Color(s).getStyle())}}if(t.renderMode!==undefined){this.setRenderMode(t.renderMode)}var h=t.getCamera();var l=this._getNativeScene();if(h){var d=h.getCameraRef();if(d.type==="OrthographicCamera"&&l){var c=h.getPosition();var u=this.getScene();if(u){var g=new THREE.Box3;if(l){l._expandBoundingBox(g,true,true)}var f=new THREE.Vector3;g.getCenter(f);var p=h.getTargetDirection();var v=[f.x-c[0],f.y-c[1],f.z-c[2]];var _=v[0]*p[0]+v[1]*p[1]+v[2]*p[2];if(_<0){var m=g.getSize().length()/2;m-=_;c[0]-=p[0]*m;c[1]-=p[1]*m;c[2]-=p[2]*m}}h.setPosition(c)}}var y=this._getViewStateManagerThreeJS();var w=t.flyToTime!=null?t.flyToTime:2e3;var C;if(y&&y._fadeOutBackground&&y._fadeInBackground&&y._fadeOutBackground!==y._fadeInBackground&&y._fadeOutBackground.name==="sphere"){C="zoomIn";h=h||this.getCamera()}var R=0;if(h){var S=i&&!t.hasAnimation();R=this._viewportGestureHandler.activateCamera(h.getCameraRef(),r?0:w,S,C)}else{this.cameraUpdateCompleted()}var E=0;if(!r){E=y._startTransition(R>0?R:w,t)}if(this.getSafeArea()){this.getSafeArea().resize()}setTimeout(function(){if(y){y.fireReadyForAnimation({view:t,ignoreAnimationPosition:this._ignoreAnimationPosition});e.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:y,view:t,ignoreAnimationPosition:this._ignoreAnimationPosition});y._startHighlight()}}.bind(this),Math.max(E,R)+100)};O.prototype.resetCurrentView=function(){if(!this._currentView){return this}this._getViewStateManagerThreeJS()._resetNodesMaterialAndOpacityByCurrentView(this._currentView);this._getViewStateManagerThreeJS()._resetNodesStatusByCurrentView(this._currentView,true,true);this.setShouldRenderFrame();return this};O.prototype.activateView=function(e,t,i){if(this._isRedlineActivated()){B.error("activateView() method is disabled when Redlining is activated");return this}this._clearAnnotations();this._activateSingleView(e,t,i);return this};O.prototype.zoomTo=function(e,t,i,r){var a=this._getNativeScene();var n=this._getNativeCamera();if(!n||!a){return this}r=r||0;var o=new THREE.Box3;var s=null;var h=null;(Array.isArray(e)?e:[e]).forEach(function(e){switch(e){case _.All:a._expandBoundingBox(o,false,true);break;case _.Visible:a._expandBoundingBox(o,true,true);break;case _.Selected:var i=this._getViewStateManagerThreeJS();if(i){i.enumerateSelection(function(e){e._expandBoundingBox(o,false,true)})}break;case _.Node:if(!t){return this}h=t;if(Array.isArray(t)){t.forEach(function(e){e._expandBoundingBox(o,false,true)})}else{t._expandBoundingBox(o,false,true)}break;case _.Restore:B.error(w().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case _.NodeSetIsolation:B.error(w().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case _.RestoreRemoveIsolation:B.error(w().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case _.ViewLeft:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case _.ViewRight:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case _.ViewTop:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case _.ViewBottom:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;case _.ViewBack:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case _.ViewFront:s=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;default:break}}.bind(this));if(!o.isEmpty()){this._viewportGestureHandler.zoomTo(o,s,r,i*1e3,h,h!==null)}return this};O.prototype.pan=function(e,t){this._viewportGestureHandler._cameraController.pan(e,t)};O.prototype.rotate=function(e,t,i){this._viewportGestureHandler._cameraController.rotate(e,t,i)};O.prototype.zoom=function(e){this._viewportGestureHandler._cameraController.zoom(e)};O.prototype.getViewInfo=function(e){var t={};if(e==null){e={}}if(e.camera==null){e.camera=true}var i=this._getNativeCamera();if(e.camera&&i){var r=i.rotation.clone();r.reorder("YXZ");t.camera={rotation:{yaw:THREE.Math.radToDeg(r.y),pitch:THREE.Math.radToDeg(r.x),roll:THREE.Math.radToDeg(r.z)},position:{x:i.position.x,y:i.position.y,z:i.position.z},projectionType:i.isOrthographicCamera?f.Orthographic:f.Perspective,bindingType:p.Vertical};var a=i.view;if(a&&a.enabled){t.camera.view={fullWidth:a.fullWidth,fullHeight:a.fullHeight,offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}}if(t.camera.projectionType===f.Perspective){t.camera.fieldOfView=i.fov}else if(t.camera.projectionType===f.Orthographic){t.camera.zoomFactor=i.zoom}if(e.camera.matrices){t.camera.matrices={view:i.matrixWorldInverse.elements.slice(),projection:i.projectionMatrix.elements.slice()}}}if(e.visibility&&this._viewStateManager){var n=e.visibility.mode==null?v.Complete:e.visibility.mode;t.visibility={mode:n};if(n===v.Complete){var o=this._viewStateManager.getVisibilityComplete();t.visibility.visible=o.visible;t.visibility.hidden=o.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){t.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{B.warning(w().getText(c.VIT32.summary),c.VIT32.code,"sap.ui.vk.threejs.Viewport")}}var s=this._getViewStateManagerThreeJS();if(e.selection&&s){t.selection=s._getSelectionComplete()}return t};O.prototype.setViewInfo=function(e,t){var i=this._getNativeCamera();if(e.camera&&i){var r=e.camera;var a=r.projectionType===f.Orthographic?new THREE.OrthographicCamera:new THREE.PerspectiveCamera;a.userData=i.userData;a.aspect=i.aspect;a.position.copy(r.position);var n=r.rotation;a.quaternion.setFromEuler(new THREE.Euler(THREE.Math.degToRad(n.pitch),THREE.Math.degToRad(n.yaw),THREE.Math.degToRad(n.roll),"YXZ"));a.fov=r.fieldOfView||a.fov;a.zoom=r.zoomFactor||a.zoom;a.updateMatrix();a.up.setFromMatrixColumn(a.matrix,1).normalize();if(i.view&&i.view.enabled){var o=r.view||i.view;a.setViewOffset(o.fullWidth,o.fullHeight,o.offsetX,o.offsetY,o.width,o.height);if(i.isPerspectiveCamera){a.aspect=o.fullWidth/o.fullHeight;a.zoom=Math.min(a.aspect,1)}}this._viewportGestureHandler.activateCamera(a,(t||0)*1e3)}var s=new Map;if(e.visibility||e.selection){var h=this._viewStateManager.getNodeHierarchy();if(h){var l=h.findNodesByName();l.forEach(function(e){var t=h.createNodeProxy(e);var i=t.getVeId();h.destroyNodeProxy(t);if(i){s.set(i,e)}})}}if(e.visibility){switch(e.visibility.mode){case v.Complete:var d=e.visibility.visible,u=e.visibility.hidden;d.forEach(function(e){this._viewStateManager.setVisibilityState(s.get(e),true,false)},this);u.forEach(function(e){this._viewStateManager.setVisibilityState(s.get(e),false,false)},this);break;case v.Differences:this._viewStateManager.resetVisibility();e.visibility.changes.forEach(function(e){var t=s.get(e);if(t){this._viewStateManager.setVisibilityState(t,!this._viewStateManager.getVisibilityState(t),false)}},this);break;default:B.error(w().getText(c.VIT28.summary),c.VIT28.code,"sap.ui.vk.threejs.Viewport");break}}var g=this._getViewStateManagerThreeJS();var p=e.selection;if(p&&g){var _=g._getSelectionComplete();if(Array.isArray(p.selected)){var m=[];var y=[];p.selected.forEach(function(e){var t=s.get(e);if(t){m.push(t)}});_.selected.forEach(function(e){var t=s.get(e);if(t&&p.selected.indexOf(e)<0){y.push(t)}});g.setSelectionStates(m,y,false,false)}if(Array.isArray(p.outlined)){var C=[];var R=[];p.outlined.forEach(function(e){var t=s.get(e);if(t){C.push(t)}});_.outlined.forEach(function(e){var t=s.get(e);if(t&&p.outlined.indexOf(e)<0){R.push(t)}});g.setOutliningStates(C,R,false,false)}}this.setShouldRenderFrame();return this};O.prototype.queueCommand=function(e){if(this instanceof O){e()}return this};O.prototype.getOutputSize=function(){var e=this.getDomRef().getBoundingClientRect();var t=e.width;var i=e.height;var r;r=Math.min(t,i);return{left:(t-r)/2,top:(i-r)/2,sideLength:r}};O.prototype.projectToScreen=function(e,t,i,r){var a=this.getDomRef().getBoundingClientRect();var n=a.width/2;var o=a.height/2;var s=new THREE.Vector3(e,t,i).project(r.getCameraRef());return{x:n+s.x*n,y:o-s.y*o,depth:s.z}};O.prototype.getAnnotations=function(){if(this.getScene()==null||this._annotationsLoaded){return this.getAggregation("annotations")||[]}if(this.getScene().annotations){var e=[];var t=this.getCurrentView();if(t){t.getNodeInfos().forEach(function(t){if(t.target._vkGetNodeContentType()===H.Annotation){e.push(t)}})}this.getScene().annotations.forEach(function(i){var r=null;if(t){for(var a=0;a<e.length;a++){var n=e[a];if(n.target._vkPersistentId()===i.node._vkPersistentId()&&(n.annotationId===i.annotation.id||n.annotationId===undefined)){i.node.visible=n.visible;r=M.createAnnotation(i,this);r.autoGenerated=true;this.addAnnotation(r);break}}}else{r=M.createAnnotation(i,this);r.autoGenerated=true;this.addAnnotation(r)}if(r){var o=this._viewStateManager.getVisibilityState(i.node);r.setDisplay(o)}}.bind(this));var i=this.getAggregation("annotations")||[];var r=0;i.forEach(function(e){if(e.getAnimate()&&e.getAnimationDelay()===-1){e.setAnimationDelay(r++)}})}this._annotationsLoaded=true;return this.getAggregation("annotations")||[]};O.prototype.setBackgroundNode=function(e){var t=this._viewStateManager.getNodeHierarchy();var i;var r=t.findNodesByName().reduce(function(e,t){if(t._vkGetNodeContentType()===H.Background){if(this._viewStateManager.getVisibilityState(t)){i=t}e.push(t)}return e}.bind(this),[]);if(!e){this._viewStateManager.setVisibilityState(r,true,false);this._viewStateManager.setVisibilityState(i,false,false);this._viewportGestureHandler.setView(null,1e3)}else{var a=e.parametricContent;var n=a.materialId;var o=e.sceneId;var s=t.createNode(i&&i.parent,a.type,null,H.Background,{parametricContent:a});this._viewStateManager.setVisibilityState(r,false,false);r.push(s);if(this._cdsLoader){this._cdsLoader.assignMaterialToNodes(o,n,s.children)}var h=a.type==="plane"?(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),0):null;this._viewportGestureHandler.setView(h,1e3)}return r};O.prototype.normalizeRectangle=function(e,t,i,r){var a=this.getSafeArea().getDomRef();if(a==null){a=this.getDomRef()}var n=window.getComputedStyle(a);var o=parseFloat(n.width);var s=parseFloat(n.left);var h=(e-s)/o-.5;var l=parseFloat(n.height);var d=parseFloat(n.top);var c=(t-d)/l-.5;return{x:h,y:c,width:i/o,height:r/l}};O.prototype.deNormalizeRectangle=function(e,t,i,r){var a=this.getSafeArea().getDomRef();if(a==null){a=this.getDomRef()}var n=window.getComputedStyle(a);var o=parseFloat(n.width);var s=parseFloat(n.left);var h=o/2;var l=s+h;var d=Math.abs(e)*2;if(e<0){d=1-d;d*=h;d+=s}else if(e>0){d*=h;d+=l}else{d=l}var c=Math.abs(i)*2*h;var u=parseFloat(n.height);var g=parseFloat(n.top);var f=u/2;var p=g+f;var v=Math.abs(t)*2;if(t<0){v=1-v;v*=f;v+=g}else if(t>0){v*=f;v+=p}else{v=p}var _=Math.abs(r)*2*f;return{x:d,y:v,width:c,height:_}};var W=[];function U(e,t){var i=L(W,function(e){return e.scene===t});if(i<0){var r=new THREE.WebGLRenderer({antialias:true,alpha:true});r.setPixelRatio(window.devicePixelRatio);r.setSize(1,1);r.shadowMap.enabled=true;e._registryEntry={scene:t,webGLRenderer:r,viewports:[e]};W.push(e._registryEntry);e._renderer=r;e._canvas=r.domElement;e.invalidate()}else{var a=W[i];var n=a.viewports;var o=n.indexOf(e);if(o<0){if(n.length==1){var s=n[0];s._canvas=document.createElement("canvas");s.invalidate()}n.push(e);e._registryEntry=a;e._renderer=a.webGLRenderer;e._canvas=document.createElement("canvas");e.invalidate()}}}function q(e,t){var i=L(W,function(e){return e.scene===t});if(i<0){return}var r=W[i];var a=r.viewports;var n=a.indexOf(e);if(n<0){return}a.splice(n,1);if(a.length==1){var o=a[0];o._canvas=r.webGLRenderer.domElement;o.invalidate()}else if(a.length===0){r.webGLRenderer.renderLists.dispose();r.webGLRenderer.dispose();W.splice(i,1)}e._registryEntry=null;e._canvas=null;e._renderer=null;e.invalidate()}function J(e){var t=0;var i=0;e.viewports.forEach(function(e){t=Math.max(t,e._width);i=Math.max(i,e._height)});e.webGLRenderer.setSize(t,i,true)}O.prototype.getMeasurementSurface=function(){return this._measurementSurface};return O});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ViewportGestureHandler", ["sap/base/Log","sap/ui/base/EventProvider","./PerspectiveCamera","./OrthographicCamera","../thirdparty/three","../getResourceBundle","../NodeContentType"],function(e,t,a,i,r,o,n){"use strict";var s=t.extend("sap.ui.vk.threejs.ViewportGestureHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._matProj=null;this._viewport=t;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var a=function(t){var a=t;var i=new THREE.Vector3;var r=new THREE.Vector2;var s=.001;var h=-Math.PI/2+s;var m=Math.PI/2-s;this.isTurnTableMode=true;this._timeIntervalForCameraAnimation=500;this._startTimeForCameraAnimation=0;this._newCamera=null;this._oldCamera=null;this._animationType=null;this._zoomedNodeRef=null;this._isZoomIn=true;this.beginGesture=function(e,t){var o=a.getScene();if(o==null){return}var n=o.getSceneRef();var s=a.getCamera().getCameraRef();var h=a.getRenderer().getSize(new THREE.Vector2);r.x=e/h.width*2-1;r.y=t/h.height*-2+1;a._gesturePoint={x:e,y:t};var m=s.userData.isRedlineActivated?null:a.hitTest(e,t,n,s);if(m){i.copy(m.point)}else{var l=new THREE.Box3;n._expandBoundingBox(l,true,true);if(!l.isEmpty()){l.getCenter(i)}else{i.setScalar(0)}}};this.endGesture=function(){};this.pan=function(e,t){if(a.getFreezeCamera()||a.getCamera()===null||e===0&&t===0){return}if(a._redlineHandler){a._redlineHandler.pan(e,t)}else if(a._isPanoramicActivated()){this.rotate(e,t);return}var r=a.getCamera().getCameraRef();var o=a.getRenderer().getSize(new THREE.Vector2);if(r.view&&r.view.enabled){r.view.offsetX-=e*r.view.width/r.view.fullWidth;r.view.offsetY-=t*r.view.height/r.view.fullHeight;r.updateProjectionMatrix()}else{var n=i.clone().project(r);n.x-=e*2/o.width;n.y+=t*2/o.height;n.unproject(r).sub(i);r.position.add(n);r.updateMatrixWorld()}a.fireCameraChanged({position:r.position.toArray()})};var l=[new THREE.Vector3(+1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,+1,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,+1),new THREE.Vector3(0,0,-1)];this.rotate=function(e,t,r){if(a.getFreezeCamera()||a.getCamera()===null||e===0&&t===0){return}if(a._redlineHandler||a._isPlanarActivated()){this.pan(e,t);return}if(r!==undefined){this.isTurnTableMode=r}var o=a.getCamera().getCameraRef();var n=-.01;if(a._isPanoramicActivated()){var s=a.getRenderer().getSize(new THREE.Vector2);n=2/(s.x*o.projectionMatrix.elements[0]);i.copy(o.position)}var d=e*n,v=t*n;var p=o.position.clone().sub(i);var c=new THREE.Vector3,_=(new THREE.Vector3).setFromMatrixColumn(o.matrixWorld,1).normalize(),u=(new THREE.Vector3).setFromMatrixColumn(o.matrixWorld,0).normalize();o.getWorldDirection(c);c.normalize();var f=new THREE.Quaternion,C=new THREE.Quaternion;if(this.isTurnTableMode){var g=l[a._upAxis]||l[2];u.crossVectors(c,g).normalize();_.crossVectors(u,c);var w=Math.atan2(c.y,Math.sqrt(c.x*c.x+c.z*c.z));f.setFromAxisAngle(g,d);C.setFromAxisAngle(u,THREE.Math.clamp(v,h-w,m-w))}else{f.setFromAxisAngle(_,d);C.setFromAxisAngle(u,v)}f.multiply(C);p.applyQuaternion(f);c.applyQuaternion(f);_.applyQuaternion(f);p.add(i);if(!o.userData.rotate){o.position.copy(p)}o.up.copy(_);o.lookAt(p.add(c));o.updateMatrixWorld();a.fireCameraChanged({position:o.position.toArray(),quaternion:o.quaternion.toArray()})};this.zoom=function(t){if(t===0||t===1||a.getFreezeCamera()||a.getCamera()===null||a.getScene()===null){return}var n=a.getCamera().getCameraRef();var s=new THREE.Vector3;if(!n.userData.isRedlineActivated){var h=100;var m=new THREE.Box3;var l=new THREE.Vector3;var d=!a.getBackgroundProjection();a.getScene().getSceneRef()._expandBoundingBox(m,true,d);m.applyMatrix4(n.matrixWorldInverse);m.min.z=Math.max(m.min.z,n.near);m.max.z=Math.max(m.max.z,n.near);m.applyMatrix4(n.projectionMatrix);m.getSize(l);var v=a.getRenderer().getSize(new THREE.Vector2);var p=l.x*v.width*.5;var c=l.y*v.height*.5;if(p<h&&c<h&&t<1){return}}var _=a._redlineHandler;if(_){t=Math.min(Math.max(_._zoomFactor*t,1/8),32)/_._zoomFactor;_._zoomFactor*=t;_.zoom(t)}if(n.view&&n.view.enabled){var u=a.getDomRef();var f=a._gesturePoint.x/u.clientWidth;var C=a._gesturePoint.y/u.clientHeight;var g=1/t;n.view.offsetX+=f*n.view.width;n.view.offsetY+=C*n.view.height;n.view.width*=g;n.view.height*=g;n.view.offsetX-=f*n.view.width;n.view.offsetY-=C*n.view.height}else if(n.isPerspectiveCamera){if(a._isPanoramicActivated()){n.fov=Math.min(Math.max(5,n.fov/Math.pow(t,.5)),90)}else{s.set(r.x,r.y,1).unproject(n);s.sub(new THREE.Vector3(r.x,r.y,-1).unproject(n));var w=i.clone().sub(n.position).length()*(1-1/t);s.setLength(w);n.position.add(s)}}else if(n.isOrthographicCamera){s.set(r.x,r.y,1).unproject(n);s.sub(new THREE.Vector3(0,0,1).unproject(n));s.multiplyScalar(1-1/t);n.zoom*=t;n.position.add(s)}else{e.error(o().getText("VIEWPORTGESTUREHANDLER_MSG_UNSUPPORTEDCAMERATYPE"))}n.updateProjectionMatrix();n.updateMatrixWorld();var E={position:n.position.toArray()};if(n.isOrthographicCamera){E.zoom=n.zoom}a.fireCameraChanged(E)};this.animateCameraUpdate=function(){if(this._newCamera===null||this._oldCamera===null){return}if(a.getCamera()==null){this._newCamera=null;this._oldCamera=null;return}function e(e,t,a){a=THREE.Math.clamp((a-e)/(t-e),0,1);return a*a*a*(a*(a*6-15)+10)}var t=Math.min((Date.now()-this._startTimeForCameraAnimation)/this._timeIntervalForCameraAnimation,1);t=e(0,1,t);var i=a.getCamera().getCameraRef();if(i.view&&i.view.enabled){var r=i.view.width;var o=i.view.height;var n=i.view.offsetX+i.view.width*.5;var s=i.view.offsetY+i.view.height*.5;i.view.offsetX=THREE.Math.lerp(this._oldCamera.view.offsetX,this._newCamera.view.offsetX,t);i.view.offsetY=THREE.Math.lerp(this._oldCamera.view.offsetY,this._newCamera.view.offsetY,t);i.view.width=THREE.Math.lerp(this._oldCamera.view.width,this._newCamera.view.width,t);i.view.height=THREE.Math.lerp(this._oldCamera.view.height,this._newCamera.view.height,t);var h=i.view.offsetX+i.view.width*.5;var m=i.view.offsetY+i.view.height*.5;var l=a._redlineHandler;if(l){var d=r/i.view.width;var v=(n-h)*i.view.fullWidth/r;var p=(s-m)*i.view.fullHeight/o;l._zoomFactor*=d;l.pan(v,p);l.zoom(d,i.view.fullWidth*.5,i.view.fullHeight*.5)}}if(i.isOrthographicCamera&&this._newCamera.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){i.left=THREE.Math.lerp(this._oldCamera.left,this._newCamera.left,t);i.right=THREE.Math.lerp(this._oldCamera.right,this._newCamera.right,t);i.top=THREE.Math.lerp(this._oldCamera.top,this._newCamera.top,t);i.bottom=THREE.Math.lerp(this._oldCamera.bottom,this._newCamera.bottom,t);if(this._transitionEffect==="zoomIn"){var c=Math.max(this._oldCamera.zoom,this._newCamera.zoom)*5;i.zoom=t<.5?THREE.Math.lerp(this._oldCamera.zoom,c,t*2):THREE.Math.lerp(c,this._newCamera.zoom,(t-.5)*2)}else{i.zoom=THREE.Math.lerp(this._oldCamera.zoom,this._newCamera.zoom,t)}}if(i.isPerspectiveCamera&&this._newCamera.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(this._transitionEffect==="zoomIn"){var _=Math.min(this._oldCamera.fov,this._newCamera.fov)*.1;i.fov=t<.5?THREE.Math.lerp(this._oldCamera.fov,_,t*2):THREE.Math.lerp(_,this._newCamera.fov,(t-.5)*2)}else{i.fov=THREE.Math.lerp(this._oldCamera.fov,this._newCamera.fov,t)}}i.far=THREE.Math.lerp(this._oldCamera.far,this._newCamera.far,t);i.near=THREE.Math.lerp(this._oldCamera.near,this._newCamera.near,t);i.updateProjectionMatrix();i.position.lerpVectors(this._oldCamera.position,this._newCamera.position,t);i.scale.lerpVectors(this._oldCamera.scale,this._newCamera.scale,t);i.up.lerpVectors(this._oldCamera.up,this._newCamera.up,t);var u=this._oldCamera.getWorldDirection(new THREE.Vector3);var f=this._newCamera.getWorldDirection(new THREE.Vector3);var C=(new THREE.Vector3).lerpVectors(u,f,t);i.lookAt(C.add(i.position));if(t===1){this._newCamera=null;this._oldCamera=null;if(this._animationType==="zooming"&&this._zoomedNodeRef){a.fireNodeZoomed({zoomed:this._zoomedNodeRef,isZoomIn:this._isZoomIn})}a.cameraUpdateCompleted({position:i.position.toArray(),quaternion:i.quaternion.toArray()})}a.fireCameraChanged({position:i.position.toArray(),quaternion:i.quaternion.toArray()})};this.startCameraAnimation=function(e,t){this._startTimeForCameraAnimation=Date.now();this._timeIntervalForCameraAnimation=e!==undefined?e:500;this._transitionEffect=t};this.lookAtObject=function(e,t){if(e._vkGetNodeContentType()!==n.Background){this.prepareForCameraUpdateAnimation();var i=a.getCamera().getCameraRef();this._newCamera=i.clone();this._newCamera.lookAt(e.getWorldPosition(new THREE.Vector3));this._newCamera.up.set(0,1,0);this._newCamera.updateMatrixWorld();this.startCameraAnimation(t)}};this.zoomObject=function(e,t,i){if(a.getScene()==null){return}var r=new THREE.Box3;(t&&e?e:a.getScene().getSceneRef())._expandBoundingBox(r,true,true);if(e&&(e._vkGetNodeContentType()===n.Background||e._vkGetNodeContentType()===n.Symbol)){r.setFromObject(e)}var o=e&&e._vkGetNodeContentType()===n.Symbol?10:0;this.zoomBox(r,o,i,e,t)};this.zoomBox=function(e,t,i,r,o){this._zoomedNodeRef=r;this._isZoomIn=o;this._animationType="zooming";this._newCamera=a.getCamera().getCameraRef().clone();this._newCamera._vkZoomTo(e,t);this.startCameraAnimation(i)};this.prepareForCameraUpdateAnimation=function(){this._oldCamera=a.getCamera().getCameraRef().clone()};this.startAnimatingCameraUpdate=function(e,t,i){var r=a.getCamera().getCameraRef();if(!this._oldCamera){return 0}var o=!!i;var n=1e-4;if(r.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){if(Math.abs(r.left-this._oldCamera.left)>n||Math.abs(r.right-this._oldCamera.right)>n||Math.abs(r.top-this._oldCamera.top)>n||Math.abs(r.bottom-this._oldCamera.bottom)>n||Math.abs(r.zoom-this._oldCamera.zoom)>n){o=true}}else if(r.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(Math.abs(r.fov-this._oldCamera.fov)>n||Math.abs(r.aspect-this._oldCamera.aspect)>n){o=true}}if(!o){if(Math.abs(r.position.x-this._oldCamera.position.x)>n||Math.abs(r.position.y-this._oldCamera.position.y)>n||Math.abs(r.position.z-this._oldCamera.position.z)>n||Math.abs(r.scale.x-this._oldCamera.scale.x)>n||Math.abs(r.scale.y-this._oldCamera.scale.y)>n||Math.abs(r.scale.z-this._oldCamera.scale.z)>n||Math.abs(r.quaternion.x-this._oldCamera.quaternion.x)>n||Math.abs(r.quaternion.y-this._oldCamera.quaternion.y)>n||Math.abs(r.quaternion.z-this._oldCamera.quaternion.z)>n||Math.abs(r.quaternion.w-this._oldCamera.quaternion.w)>n){o=true}}if(!o){if(!t){a.cameraUpdateCompleted({position:r.position.toArray(),quaternion:r.quaternion.toArray()});return 0}else{e=500}}this._newCamera=a.getCamera().getCameraRef().clone();this.startCameraAnimation(e,i);return e}};this._cameraController=new a(t)}});s.prototype._activateRedline=function(){var e=this._viewport.getCamera().getCameraRef();e.userData.isRedlineActivated=true;var t=this._viewport.getDomRef();e.setViewOffset(t.clientWidth,t.clientHeight,0,0,t.clientWidth,t.clientHeight)};s.prototype._deactivateRedline=function(){var e=this._viewport&&this._viewport.getCamera();if(e){var t=e.getCameraRef();t.userData.isRedlineActivated=false;t.clearViewOffset()}};s.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false};s.prototype._getOffset=function(e){var t=e.getBoundingClientRect();var a={x:t.left+window.pageXOffset,y:t.top+window.pageYOffset};return a};s.prototype._inside=function(e){if(this._rect===null||true){var t=this._viewport.getIdForLabel();var a=document.getElementById(t);if(!a){return false}var i=this._getOffset(a);this._rect={x:i.x,y:i.y,w:a.offsetWidth,h:a.offsetHeight}}return e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h};s.prototype._onresize=function(e){this._gesture=false;this._rect=null};s.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._gesture=true;var a=t.x-this._rect.x,i=t.y-this._rect.y;this._evt.x=a;this._evt.y=i;this._evt.d=t.d;this._evt.initd=t.d;this._evt.avgd=t.d;this._evt.avgx=0;this._evt.avgy=0;e.debug("Loco: beginGesture: "+a+", "+i);this._cameraController.beginGesture(a,i);t.handled=true;if(document.activeElement){try{document.activeElement.blur()}catch(e){}}var r=document.getElementById(this._viewport.getIdForLabel());r.focus()}this._nomenu=false};s.prototype.move=function(t){if(this._gesture){var a=t.x-this._rect.x,i=t.y-this._rect.y;var r=a-this._evt.x;var o=i-this._evt.y;var n=t.d-this._evt.d;this._evt.x=a;this._evt.y=i;this._evt.d=t.d;this._evt.avgx=this._evt.avgx*.99+r*.01;this._evt.avgy=this._evt.avgy*.99+o*.01;var s=1;if(this._evt.initd>0){s=1+n*(1/this._evt.initd)}else if(t.n===2){if(t.points[0].y>t.points[1].y){s=1-n*.005;if(s<.333){s=.333}}else{s=1+n*.005;if(s>3){s=3}}}if(this._evt.initd>0){var h=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);e.debug("AvgDist: "+h);if(Math.abs(t.d-this._evt.avgd)/this._evt.avgd<h/10){s=1}}s=THREE.Math.clamp(s,.88,1.12);this._evt.avgd=this._evt.avgd*.97+t.d*.03;switch(t.n){case 1:e.debug("Loco: Rotate: "+r+", "+o);this._cameraController.rotate(r,o);break;case 2:e.debug("Loco: Pan: "+r+", "+o);if(s!=0&&s!=1){e.debug("Loco: Zoom: "+s)}this._cameraController.pan(r,o);if(r<10&&o<10&&s!=0&&s!=1){this._cameraController.zoom(s)}break;default:break}this._nomenu=true;t.handled=true}};s.prototype.endGesture=function(t){if(this._gesture){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: endGesture: "+a+", "+i);this._cameraController.endGesture();this._gesture=false;t.handled=true}};s.prototype.click=function(t){if(this._inside(t)&&t.buttons<=1){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: click: "+a+", "+i);if(this._viewport){this._viewport.tap(a,i,false)}t.handled=true}};s.prototype.doubleClick=function(t){if(this._inside(t)&&t.buttons<=1){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: doubleClick: "+a+", "+i);if(this._viewport){this._viewport.tap(a,i,true)}t.handled=true}};s.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons===5){this._nomenu=false;e.handled=true}};s.prototype.keyEventHandler=function(e){};s.prototype.getViewport=function(){return this._viewport};s.prototype.activateCamera=function(e,t,r,o){var n=0;this._cameraController.prepareForCameraUpdateAnimation();if(this._viewport.getCamera().getCameraRef().isPerspectiveCamera!=e.isPerspectiveCamera){var s=e.isPerspectiveCamera?new a:new i;s.getCameraRef().copy(e);this._viewport.setCamera(s)}else{this._viewport.getCamera().getCameraRef().copy(e)}var h=this._viewport.getRenderer().getSize(new THREE.Vector2);this._viewport.getCamera().update(h.width,h.height);if(t>0){n=this._cameraController.startAnimatingCameraUpdate(t,r,o)}else{this._viewport.cameraUpdateCompleted({position:e.position.toArray(),quaternion:e.quaternion.toArray()})}return n};s.prototype.setView=function(t,i){var r=this._viewport.getCamera().getCameraRef();if(r.userData.isRedlineActivated){e.error("setView() method is disabled when Redlining is activated");return this}this._cameraController.prepareForCameraUpdateAnimation();if(t){r.quaternion.copy(t);r.updateMatrixWorld();r.up.setFromMatrixColumn(r.matrixWorld,1).normalize();this._cameraController.zoomObject(null,false,i)}else{r.copy(this._viewport._homeCamera?this._viewport._homeCamera:(new a).getCameraRef());var o=this._viewport.getRenderer().getSize(new THREE.Vector2);this._viewport.getCamera().update(o.width,o.height);this._cameraController.startAnimatingCameraUpdate(i)}return this};s.prototype.zoomTo=function(t,a,i,r,o,n){if(this._viewport._isPanoramicActivated()||this._viewport._isPlanarActivated()){e.error("zoomTo() method is disabled in navigation scene");return this}var s=this._viewport.getCamera().getCameraRef();this._cameraController.prepareForCameraUpdateAnimation();if(a){s.quaternion.copy(a);s.updateMatrixWorld();s.up.setFromMatrixColumn(s.matrixWorld,1).normalize()}this._cameraController.zoomBox(t,i,r,o,n);return this};s.prototype.zoomObject=function(e,t,a){if(this._viewport._isPanoramicActivated()){this._cameraController.lookAtObject(e,a)}else{this._cameraController.prepareForCameraUpdateAnimation();this._cameraController.zoomObject(e,t,a)}return this};s.prototype.animateCameraUpdate=function(){this._cameraController.animateCameraUpdate()};s.prototype.prepareForCameraUpdateAnimation=function(){this._cameraController.prepareForCameraUpdateAnimation()};s.prototype.startAnimatingCameraUpdate=function(e){this._cameraController.startAnimatingCameraUpdate(e)};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure");e.style("width",t.getWidth());e.style("height",t.getHeight());e.openEnd();if(t.getSafeArea()){e.renderControl(t.getSafeArea())}t.renderTools(e);t.renderContent(e);var n=t.getAnnotations();if(n&&n.length>0){e.openStart("div");e.class("sapUiVizKitAnnotationContainer");e.openEnd();n.forEach(function(t){e.renderControl(t)});e.close("div")}e.close("div")};return e},true);
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/v2/ViewStateManager", ["../ViewStateManager","../../thirdparty/three","../../cssColorToColor","../../colorToCSSColor","../../abgrToColor","../../colorToABGR","../ThreeUtils"],function(e,t,i,r,o,n,s){"use strict";var a=new t.Color(12632064);var l;var h=e.extend("sap.ui.vk.threejs.v2.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var c=h.getMetadata().getParent().getClass().prototype;h.prototype.init=function(){if(c.init){c.init.call(this)}this._nodeHierarchy=null;this._nodeStates=new Map;this._selectedNodes=new Set;this._outlinedNodes=new Set;this.setOutlineColor("rgba(255, 0, 255, 1.0)");this.setOutlineWidth(1);this._materialCache=new l;this._showSelectionBoundingBox=true;this._boundingBoxesScene=new t.Scene};h.prototype.exit=function(){this._clearNodeStates();this._selectedNodes.clear();this._outlinedNodes.clear();if(this._boundingBoxesScene){this._clearBoundingBoxScene();this._boundingBoxesScene.dispose();this._boundingBoxesScene=null}this._nodeHierarchy=null;if(c.exit){c.exit.call(this)}};h.prototype._clearBoundingBoxScene=function(){var e=[];var t=[];s.getAllTHREENodes([this._boundingBoxesScene],e,t);e.forEach(function(e){s.disposeObject(e);e.parent.remove(e)});t.forEach(function(e){e.parent.remove(e)})};h.prototype._clearNodeStates=function(){var e=this._nodeStates;e.forEach(function(e,t){if(e.material!=null){s.disposeMaterial(e.material)}if(e.boundingBoxNode){s.disposeObject(e.boundingBoxNode)}},this);e.clear()};h.prototype._setScene=function(e){this._clearNodeStates();if(this._boundingBoxesScene){this._clearBoundingBoxScene()}this._boundingBoxesScene=new t.Scene;this._setNodeHierarchy(e?e.getDefaultNodeHierarchy():null);if(e){e.setViewStateManager(this)}this._scene=e;if(this._scene){var i=this._scene.getInitialView();if(i){this.activateView(i)}}return this};h.prototype._setNodeHierarchy=function(e){var t=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.detachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._nodeHierarchy=null;this._clearNodeStates();this._selectedNodes.clear();this._outlinedNodes.clear();this._visibilityTracker.clear()}if(e){this._nodeHierarchy=e;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);var i=[];var r=[];e.getSceneRef().traverse(function(e){(e.visible?i:r).push(e)});this.fireVisibilityChanged({visible:i,hidden:r})}if(e!==t){this.fireNodeHierarchyReplaced({oldNodeHierarchy:t,newNodeHierarchy:e})}return this};h.prototype._handleNodeReplaced=function(e){var t=e.getParameter("ReplacedNodeRef");var i=e.getParameter("ReplacementNodeRef");if(this.getSelectionState(t)){this.setSelectionState(i,true);this.setSelectionState(t,false)}};h.prototype._handleNodeUpdated=function(e){var t=e.getParameter("nodeRef");if(this.getSelectionState(t)){this.setSelectionState(t,false);this.setSelectionState(t,true)}};h.prototype._handleNodeRemoving=function(e){var t=e.getParameter("nodeRef");if(this.getSelectionState(t)){this.setSelectionState(t,false,true,true)}};h.prototype._renderOutline=function(e,t,i){};h.prototype.resetNodeProperty=function(e,t){};h.prototype.resetVisibility=function(){var e=[];var t=[];this._nodeStates.forEach(function(i,r){var o=i.visible;if(o===true){t.push(r)}else if(o===false){e.push(r)}i.visible=null});this._deleteUnusedNodeStates();this._visibilityTracker.clear();this.fireVisibilityChanged({visible:e,hidden:t})};h.prototype.getVisibilityState=function(e){if(Array.isArray(e)){var t=[];this._nodeStates.forEach(function(e,i){t.push(f(i,e))});return t}else{var i=this._getNodeState(e,false);return f(e,i)}};h.prototype.setVisibilityState=function(e,t,i,r){if(!Array.isArray(e)){e=[e]}var o=Array.isArray(t);var n=[];var s=e;if(i){s=[];e.forEach(function(e,i){var r=this._collectNodesRecursively(e);s=s.concat(r);var a=n.length;n.length+=r.length;n.fill(o?t[i]:t,a)},this)}else if(!o){n.length=s.length;n.fill(t)}else{n=t}if(r){var a=[];s.forEach(function(e,t){var i=n[t];if(i){for(var r=e;r&&!r.isScene;r=r.parent){a.push(r)}}});s=s.concat(a);var l=n.length;n.length+=a.length;n.fill(true,l)}var h=[];var c=new Set;var u=s.filter(function(e,t){if(c.has(e)){return false}c.add(e);var i=this._getNodeState(e,false);var r=f(e,i);var o=n[t];var s=r!==o;if(s){h.push(o)}return s},this);if(u.length>0){this._applyVisibilityNodeState(u,h);this._deleteUnusedNodeStates();var d={visible:[],hidden:[]};u.forEach(function(e,t){d[h[t]?"visible":"hidden"].push(e)});if(this.getShouldTrackVisibilityChanges()){u.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged(d)}return this};h.prototype.enumerateSelection=function(e){this._selectedNodes.forEach(e);return this};h.prototype.enumerateOutlinedNodes=function(e){this._outlinedNodes.forEach(e);return this};h.prototype.getSelectionState=function(e){var t=this._selectedNodes.has.bind(this._selectedNodes);return Array.isArray(e)?e.map(t):t(e)};h.prototype._addBoundingBox=function(e){var i=this._getNodeState(e,true);if(i.boundingBoxNode==null){var r=new t.Box3;s.computeObjectOrientedBoundingBox(e,r);var o=new t.Box3Helper(r,a);this._boundingBoxesScene.add(o);o.parent=e;i.boundingBoxNode=o}else{}return this};h.prototype._removeBoundingBox=function(e){var t=this._getNodeState(e,false);if(t!=null&&t.boundingBoxNode!=null){this._boundingBoxesScene.remove(t.boundingBoxNode);s.disposeObject(t.boundingBoxNode);t.boundingBoxNode=null}else{}return this};h.prototype._updateBoundingBoxes=function(){var e=this._nodeStates;this._selectedNodes.forEach(function(t){var i=e.get(t);if(i!=null&&i.boundingBoxNode!=null){s.computeObjectOrientedBoundingBox(t,i.boundingBoxNode.box)}else{}});return this};h.prototype.setShowSelectionBoundingBox=function(e){this._showSelectionBoundingBox=e;this._selectedNodes.forEach(e?this._addBoundingBox:this._removeBoundingBox,this);this.fireSelectionChanged({selected:this._selectedNodes,unselected:[]});return this};h.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox};h.prototype.setSelectionState=function(e,t,i,r){if(!e){return this}if(!Array.isArray(e)){e=[e]}e=(i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e).filter(function(e,t,i){return i.indexOf(e)===t});if(this.getRecursiveSelection()&&!t){e=this._nodeHierarchy._appendAncestors(e)}var o=this._selectedNodes;var n=e.filter(function(e){return o.has(e)!==t},this);if(n.length>0){this._applySelectionNodeState(n,t);if(!t){this._deleteUnusedNodeStates()}this._updateNodeStateMaterials();if(!r){this.fireSelectionChanged({selected:t?n:[],unselected:t?[]:n})}}return this};h.prototype.setSelectionStates=function(e,t,i,r){if(!Array.isArray(e)){e=[e]}if(!Array.isArray(t)){t=[t]}e=i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e;t=i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t;if(this.getRecursiveSelection()){t=this._nodeHierarchy._appendAncestors(t,e)}var o=e.filter(function(e){return this._selectedNodes.has(e)===false},this);var n=t.filter(function(e){return this._selectedNodes.has(e)===true},this);if(o.length>0||n.length>0){this._applySelectionNodeState(o,true);this._applySelectionNodeState(n,false);if(n.length>0){this._deleteUnusedNodeStates()}this._updateNodeStateMaterials();if(!r){this.fireSelectionChanged({selected:o,unselected:n})}}return this};h.prototype.setOutlineColor=function(e){switch(typeof e){case"number":this._outlineColorABGR=e;break;case"string":if(sap.ui.core.CSSColor.isValid(e)){this._outlineColorABGR=n(i(e))}break;default:return this}this.fireOutlineColorChanged({outlineColor:r(o(this._outlineColorABGR)),outlineColorABGR:this._outlineColorABGR});return this};h.prototype.getOutlineColor=function(e){return e?this._outlineColorABGR:r(o(this._outlineColorABGR))};h.prototype.getOutliningState=function(e){var t=this._outlinedNodes;function i(e){return t.has(e)}return Array.isArray(e)?e.map(i):i(e)};h.prototype.setOutliningStates=function(e,t,i,r){if(!Array.isArray(e)){e=[e]}if(!Array.isArray(t)){t=[t]}e=i||this.getRecursiveOutlining()?this._collectNodesRecursively(e):e;t=i||this.getRecursiveOutlining()?this._collectNodesRecursively(t):t;if(this.getRecursiveOutlining()){t=this._nodeHierarchy._appendAncestors(t,e)}var o=e.filter(function(e){return this._outlinedNodes.has(e)===false},this);var n=t.filter(function(e){return this._outlinedNodes.has(e)===true},this);if(o.length>0||n.length>0){o.forEach(function(e){this._outlinedNodes.add(e)},this);n.forEach(function(e){this._outlinedNodes.delete(e)},this);if(!r){this.fireOutliningChanged({outlined:o,unoutlined:n})}}return this};h.prototype.setOutlineWidth=function(e){this._outlineWidth=e;this.fireOutlineWidthChanged({width:e});return this};h.prototype.getOutlineWidth=function(){return this._outlineWidth};h.prototype._getOpacity=function(e){var t=this._getNodeState(e,false);return t!=null?t._opacity:null};h.prototype.getOpacity=function(e){if(Array.isArray(e)){return e.map(this._getOpacity,this)}else{return this._getOpacity(e)}};h.prototype.setOpacity=function(e,t,i){if(!Array.isArray(e)){e=[e]}var r=Array.isArray(t);var o=[];var n=e;if(i){n=[];e.forEach(function(e,i){var s=this._collectNodesRecursively(e);n=n.concat(s);var a=o.length;o.length+=s.length;o.fill(r?t[i]:t,a)},this)}else if(!r){o.length=n.length;o.fill(t)}else{o=t}var s=[];var a=new Set;var l=n.filter(function(e,t){if(a.has(e)){return false}a.add(e);var i=this._getNodeState(e,false);var r=o[t];var n=i==null&&r!=null||i!=null&&i.opacity!==r;if(n){s.push(r)}return n},this);if(l.length>0){this._applyOpacityNodeState(l,s);this._deleteUnusedNodeStates();this._updateNodeStateMaterials();var h={changed:l,opacity:r?s:s[0]};this.fireOpacityChanged(h)}return this};h.prototype._getTintColorABGR=function(e){var t=this._getNodeState(e,false);return t&&t.tintColor};h.prototype._getTintColor=function(e){var t=this._getTintColorABGR(e);return t!=null?r(o(t)):null};h.prototype.getTintColor=function(e,t){var i=t?this._getTintColorABGR:this._getTintColor;if(Array.isArray(e)){return e.map(i,this)}else{return i.call(this,e)}};function u(e){switch(typeof e){case"number":return e;case"string":return sap.ui.core.CSSColor.isValid(e)?n(i(e)):null;default:return null}}h.prototype.setTintColor=function(e,t,i){if(!Array.isArray(e)){e=[e]}var r=Array.isArray(t);var o=[];var n=e;if(i){n=[];e.forEach(function(e,i){var s=this._collectNodesRecursively(e);n=n.concat(s);var a=o.length;o.length+=s.length;o.fill(r?t[i]:t,a)},this)}else if(!r){o.length=n.length;o.fill(t)}else{o=t}var s=[];var a=[];var l=new Set;var h=n.filter(function(e,t){if(l.has(e)){return false}l.add(e);var i=this._getNodeState(e,false);var r=o[t];var n=u(o[t]);var h=i==null&&r!=null||i!=null&&i.tintColor!==n;if(h){s.push(r);a.push(n)}return h},this);if(h.length>0){this._applyTintColorNodeState(h,a);this._deleteUnusedNodeStates();this._updateNodeStateMaterials();var c={changed:h,tintColor:r?s:s[0],tintColorABGR:r?a:a[0]};this.fireTintColorChanged(c)}return this};h.prototype.setHighlightColor=function(e){switch(typeof e){case"number":this._highlightColorABGR=e;break;case"string":if(sap.ui.core.CSSColor.isValid(e)){this._highlightColorABGR=n(i(e))}break;default:return this}if(this._selectedNodes.size>0){this._nodeStates.forEach(function(e){if(e.selected||e.ancestorSelected){e.needsMaterialUpdate=true}})}this.fireHighlightColorChanged({highlightColor:r(o(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this};h.prototype._getNodeState=function(e,t){var i=this._nodeStates;var r=i.get(e);if(r==null&&t){r={visible:null,originalVisible:null,selected:false,ancestorSelected:false,tintColor:null,ancestorTintColor:null,opacity:null,ancestorOverridesOpacity:false,boundingBoxNode:null,material:null,originalMaterial:null,needsMaterialUpdate:false};i.set(e,r)}return r};h.prototype._deleteUnusedNodeStates=function(){var e=this._materialCache;this._nodeStates.forEach(function(t,i,r){if(t.visible==null&&!t.selected&&!t.ancestorSelected&&t.tintColor==null&&t.ancestorTintColor==null&&t.opacity==null&&!t.ancestorOverridesOpacity){r.delete(i);if(t.material!=null){e.releaseMaterial(t.material)}}});return this};h.prototype._applyVisibilityNodeState=function(e,t){e.forEach(function(e,i){var r=t[i];var o=e.visible;var n=r!==o;var s=this._getNodeState(e,n);if(s){if(n){s.visible=r}else{s.visible=null}}},this)};h.prototype._applySelectionNodeState=function(e,t){if(t){e.forEach(function(e){this._selectedNodes.add(e);if(this._showSelectionBoundingBox){this._addBoundingBox(e)}var t=this._getNodeState(e,true);var i=d(t);t.selected=true;if(d(t)!==i){t.needsMaterialUpdate=true}if(!t.ancestorSelected){e.children.forEach(this._setAncestorSelectedRecursively.bind(this,true),this)}},this)}else{e.forEach(function(e){this._selectedNodes.delete(e);if(this._showSelectionBoundingBox){this._removeBoundingBox(e)}var t=this._getNodeState(e,false);if(t!=null){var i=d(t);t.selected=false;if(d(t)!==i){t.needsMaterialUpdate=true}if(!t.ancestorSelected){e.children.forEach(this._setAncestorSelectedRecursively.bind(this,false),this)}}},this)}return this};h.prototype._setAncestorSelectedRecursively=function(e,t){var i=this._getNodeState(t,e);if(i!=null&&i.ancestorSelected!==e){var r=d(i);i.ancestorSelected=e;if(d(i)!==r){i.needsMaterialUpdate=true}if(!i.selected){t.children.forEach(this._setAncestorSelectedRecursively.bind(this,e),this)}}return this};h.prototype._applyTintColorNodeState=function(e,t){e.forEach(function(e,i){var r=t[i];var o=this._getNodeState(e,r!=null);if(o!=null){o.tintColor=r;o.needsMaterialUpdate=true;e.children.forEach(this._setAncestorTintColorRecursively.bind(this,r!=null?r:o.ancestorTintColor),this)}},this);return this};h.prototype._setAncestorTintColorRecursively=function(e,t){var i=this._getNodeState(t,e!=null);if(i!=null&&i.ancestorTintColor!==e){var r=p(i);i.ancestorTintColor=e;if(p(i)!==r){i.needsMaterialUpdate=true}if(i.tintColor==null){t.children.forEach(this._setAncestorTintColorRecursively.bind(this,e),this)}}return this};h.prototype._applyOpacityNodeState=function(e,t){e.forEach(function(e,i){var r=t[i];var o=this._getNodeState(e,r!=null);if(o!=null){o.opacity=r;o.needsMaterialUpdate=true;e.children.forEach(this._setAncestorOverridesOpacityRecursively.bind(this,r!=null),this)}},this);return this};h.prototype._setAncestorOverridesOpacityRecursively=function(e,t){var i=this._getNodeState(t,e);if(i!=null){i.ancestorOverridesOpacity=e;i.needsMaterialUpdate=true;t.children.forEach(this._setAncestorOverridesOpacityRecursively.bind(this,i.opacity!=null||e),this)}return this};h.prototype._computeWorldOpacity=function(e,t){if(t==null){t=this._getNodeState(e,false)}var i=t&&t.opacity;if(i==null){var r=e.userData;i=r&&r.opacity;if(i==null){i=1}}var o=e.parent;if(o==null){return i}else{return i*this._computeWorldOpacity(o)}};h.prototype._updateNodeStateMaterials=function(){var e=this._materialCache;var i=this.getHighlightColor(true);var r=o(i);var n=new t.Color(r.red/255,r.green/255,r.blue/255);this._nodeStates.forEach(function(s,a){if(s.needsMaterialUpdate&&a.material!=null){if(s.material==null){s.material=e.cloneMaterial(a.material)}else{s.material.color.copy(a.material.color)}var l=s.material;var h;var c=p(s);if(c!=null){h=o(c);l.color.lerp(new t.Color(h.red/255,h.green/255,h.blue/255),h.alpha);if(l.emissive!=null){if(l.userData.defaultHighlightingEmissive){l.emissive.copy(l.userData.defaultHighlightingEmissive)}else{l.emissive.copy(t.Object3D.prototype.defaultEmissive)}}if(l.specular!=null){if(l.userData.defaultHighlightingSpecular){l.specular.copy(l.userData.defaultHighlightingSpecular)}else{l.specular.copy(t.Object3D.prototype.defaultSpecular)}}}if(s.selected||s.ancestorSelected){l.color.lerp(n,r.alpha);if(l.emissive!=null&&i!==0){if(l.userData.defaultHighlightingEmissive){l.emissive.copy(l.userData.defaultHighlightingEmissive)}else{l.emissive.copy(t.Object3D.prototype.defaultEmissive)}}if(l.specular!=null&&i!==0){if(l.userData.defaultHighlightingSpecular){l.specular.copy(l.userData.defaultHighlightingSpecular)}else{l.specular.copy(t.Object3D.prototype.defaultSpecular)}}}var u=this._computeWorldOpacity(a,s);l.opacity=u;l.transparent=u<1}s.needsMaterialUpdate=false},this);return this};h.prototype.applyNodeStates=function(){this._nodeStates.forEach(function(e,t){if(e.material!=null){e.originalMaterial=t.material;t.material=e.material}if(e.visible!=null){e.originalVisible=t.visible;t.visible=e.visible}})};h.prototype.revertNodeStates=function(){this._nodeStates.forEach(function(e,t){if(e.originalMaterial){t.material=e.originalMaterial;e.originalMaterial=null}if(e.originalVisible!=null){t.visible=e.originalVisible;e.originalVisible=null}})};function d(e){return e!=null&&(e.selected||e.ancestorSelected)}function f(e,t){var i=t&&t.visible;return i!=null?i:e.visible}function p(e){return e.tintColor||e.ancestorTintColor}l=function(){};l.prototype.cloneMaterial=function(e,t){return e.clone()};l.prototype.releaseMaterial=function(e){s.disposeMaterial(e);return this};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointTool", ["../thirdparty/three","./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(t,e,i,o,r){"use strict";var n=e.extend("sap.ui.vk.tools.AnchorPointTool",{metadata:{library:"sap.ui.vk",properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:r.All},allowContextMenu:{type:"boolean",defaultValue:true},position:{type:"any",defaultValue:null},quaternion:{type:"any",defaultValue:null}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},constructor:function(t,o){e.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null}});n.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);var t=new o;this.setAggregation("gizmo",t);this.setProperty("position",t._gizmo.position);this.setProperty("quaternion",t._gizmo.quaternion)};n.prototype.setViewport=function(t){if(this._viewport!==t){this._deactivateScreenAlignment()}e.prototype.setViewport.call(this,t);if(t){this.getGizmo()._initAnchorPoint(t)}};n.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();this._deactivateScreenAlignment()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};n.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.setAllowOperation=function(t){this.setProperty("allowOperation",t,true);if(this._gizmo){this._gizmo._updateHandlesVisibility()}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.move=function(t,e,i){if(this._gizmo){this._gizmo.move(t,e,i)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.rotate=function(t,e,i){if(this._gizmo){this._gizmo.rotate(t,e,i)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.moveTo=function(t,e){var i=Array.isArray(t)?t:[t];var o=new THREE.Vector3;if(t instanceof THREE.Matrix4){t.decompose(o,new THREE.Quaternion,new THREE.Vector3)}else if(e){var r=0;var n=new THREE.Vector3;i.forEach(function(t){t.updateWorldMatrix(false,false);o.add(n.setFromMatrixPosition(t.matrixWorld));r++});o.multiplyScalar(1/r)}else{var a=new THREE.Box3;i.forEach(function(t){a.expandByObject(t)});a.getCenter(o)}this.getGizmo().setPosition(o);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignTo=function(t){this._deactivateScreenAlignment();var e=new THREE.Quaternion;if(t instanceof THREE.Matrix4){t.decompose(new THREE.Vector3,e,new THREE.Vector3)}else if(t){t.updateWorldMatrix(false,false);t.matrixWorld.decompose(new THREE.Vector3,e,new THREE.Vector3)}this.getGizmo().setQuaternion(e);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignToWorld=function(){this._deactivateScreenAlignment();this.getGizmo().setQuaternion(new THREE.Quaternion);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignToScreen=function(){if(this._viewport){this._activateScreenAlignment();this.alignToScreenCallback();this._viewport.setShouldRenderFrame()}return this};n.prototype._activateScreenAlignment=function(){if(!this.alignToScreenCallback){this.alignToScreenCallback=function(){var t=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(t.quaternion)}.bind(this);this._viewport.attachCameraChanged(this.alignToScreenCallback)}};n.prototype._deactivateScreenAlignment=function(){if(this.alignToScreenCallback&&this._viewport){this._viewport.detachCameraChanged(this.alignToScreenCallback);this.alignToScreenCallback=null}};n.prototype.setPosition=function(){throw new Error("The AnchorPointTool position is read-only")};n.prototype.setQuaternion=function(){throw new Error("The AnchorPointTool quaternion is read-only")};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolGizmo", ["../getResourceBundle","../thirdparty/three","./Gizmo","./AnchorPointToolGizmoRenderer","./CoordinateSystem","./AxisColours","./AnchorPointToolOperation","sap/base/assert"],function(t,e,i,o,r,a,s,n){"use strict";var h=i.extend("sap.ui.vk.tools.AnchorPointToolGizmo",{metadata:{library:"sap.ui.vk"}});h.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(null,84);this._gizmoIndex=-1;this._handleIndex=-1;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene;var t=new THREE.DirectionalLight(16777215,.5);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new THREE.AmbientLight(16777215,.5));this._touchAreas=new THREE.Group;this._gizmo=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;this._moveDelta=new THREE.Vector3;this._rotationDelta=new THREE.Vector3;function e(t,e,i){var o=96,r=1,a=24,s=4,n=48;t.multiplyScalar(1/o);var h=new THREE.CylinderBufferGeometry(r,r,o-a,4);var l=(new THREE.Matrix4).makeBasis(new THREE.Vector3(t.y,t.z,t.x),t,new THREE.Vector3(t.z,t.x,t.y));l.setPosition(t.clone().multiplyScalar((o-a)*.5));h.applyMatrix4(l);var d=new THREE.MeshLambertMaterial({color:e,transparent:true});var u=new THREE.Mesh(h,d);u.matrixAutoUpdate=false;u.userData.color=e;var _=new THREE.CylinderBufferGeometry(0,s,a,12,1);l.setPosition(t.clone().multiplyScalar(o-a*.5));_.applyMatrix4(l);var c=new THREE.Mesh(_,d);c.matrixAutoUpdate=false;u.add(c);var m=new THREE.CylinderGeometry(n*.5,n*.5,n,12,1);m.applyMatrix4(l);var p=new THREE.CylinderGeometry(n*.5,n*.2,n,12,1);l.setPosition(t.clone().multiplyScalar(o*.5));m.merge(p,l);i.add(new THREE.Mesh(m,d));return u}function o(t,e,i){var o=new Float32Array(9);o[t]=o[e+6]=1;o[t+3]=o[e+3]=.5;var r=(new THREE.Vector3).setComponent(t,.333);var a=(new THREE.Vector3).setComponent(e,.333);var s=new THREE.Geometry;s.vertices.push(new THREE.Vector3,r,a,r.clone().add(a));s.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var n=new THREE.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:THREE.DoubleSide});var h=new THREE.Mesh(s,n);h.matrixAutoUpdate=false;h.userData.colors=o;var l=new THREE.BufferGeometry;var d=new Float32Array(9);d[t]=d[t+3]=d[e+3]=d[e+6]=.333;l.setAttribute("position",new THREE.Float32BufferAttribute(d,3));l.setAttribute("color",new THREE.Float32BufferAttribute(o,3));var u=new THREE.Line(l,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));u.matrixAutoUpdate=false;h.add(u);var _=new THREE.Geometry;_.vertices.push(new THREE.Vector3,r,a,r.clone().add(a));_.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));i.add(new THREE.Mesh(_,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return h}function r(t,e,i,o){var r=new THREE.TorusBufferGeometry(i,1/96,4,o,Math.PI/2);if(t===0){r.rotateY(Math.PI/-2)}else if(t===1){r.rotateX(Math.PI/2)}var a=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:e,transparent:true}));a.matrixAutoUpdate=false;a.userData.color=e;return a}function s(t,e,i){var o=new THREE.TorusBufferGeometry(e,16/96,4,i,Math.PI/2);if(t===0){o.rotateY(Math.PI/-2)}else if(t===1){o.rotateX(Math.PI/2)}return new THREE.Mesh(o,new THREE.MeshBasicMaterial({opacity:.2,transparent:true}))}this._gizmo.add(e(new THREE.Vector3(1,0,0),a.x,this._touchAreas));this._gizmo.add(e(new THREE.Vector3(0,1,0),a.y,this._touchAreas));this._gizmo.add(e(new THREE.Vector3(0,0,1),a.z,this._touchAreas));this._gizmo.add(o(1,2,this._touchAreas));this._gizmo.add(o(2,0,this._touchAreas));this._gizmo.add(o(0,1,this._touchAreas));for(var n=0;n<3;n++){this._gizmo.add(r(n,a[["x","y","z"][n]],1,32));this._touchAreas.add(s(n,1,24))}var h=new THREE.MeshBasicMaterial({color:33023,opacity:.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry,h);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var l=new THREE.Geometry;l.vertices.push(new THREE.Vector3,new THREE.Vector3);this._line=new THREE.LineSegments(l,new THREE.LineBasicMaterial);this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line)};h.prototype.hasDomElement=function(){return true};h.prototype._updateHandlesVisibility=function(){var t=this._tool.getAllowOperation();var e=t!==s.Rotate;var i=t!==s.Move;var o;for(o=0;o<3;o++){this._touchAreas.children[o].visible=e}for(o=3;o<6;o++){this._gizmo.children[o].visible=this._touchAreas.children[o].visible=e}for(o=6;o<9;o++){this._gizmo.children[o].visible=this._touchAreas.children[o].visible=i}};h.prototype._initAnchorPoint=function(t){t._anchorPoint=this._gizmo};h.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._updateHandlesVisibility();this._initAnchorPoint(t)};h.prototype.hide=function(){this._viewport=null;this._tool=null};h.prototype.setPosition=function(t){this._gizmo.position.copy(t);this._gizmo.updateMatrixWorld()};h.prototype.setQuaternion=function(t){this._gizmo.quaternion.copy(t);this._gizmo.updateMatrixWorld()};h.prototype.getGizmoCount=function(){return 1};h.prototype.getTouchObject=function(t){this._touchAreas.position.copy(this._gizmo.position);this._touchAreas.quaternion.copy(this._gizmo.quaternion);this._touchAreas.scale.copy(this._gizmo.scale);this._touchAreas.updateMatrixWorld(true);return this._touchAreas};var l=[1,2,4,6,5,3,1,2,4];h.prototype.highlightHandle=function(t,e){var i;for(i=0;i<3;i++){var o=this._gizmo.children[i];var r=l[t]&1<<i;var a=r?16776960:o.userData.color;o.material.color.setHex(a);o.children[0].material.color.setHex(a);this._axisTitles.children[i].material.color.setHex(a)}for(i=3;i<6;i++){var n=this._gizmo.children[i];n.material.visible=i===t;var h=n.children[0].geometry.attributes.color;h.copyArray(i===t?[1,1,0,1,1,0,1,1,0]:n.userData.colors);h.needsUpdate=true;n.children[0].material.opacity=i===t||e&&t===-1?1:.35;n.children[0].visible=i===t||e}for(i=6;i<9;i++){var d=this._gizmo.children[i];d.visible=this._tool.getAllowOperation()!==s.Move&&(i===t||e);d.material.color.setHex(i===t?16776960:d.userData.color);d.material.opacity=i===t||e&&t===-1?1:.35}};h.prototype.selectHandle=function(e){this._handleIndex=e;if(e>=0&&e<3){this._units.setText(t().getText("TOOL_UNITS_MM"))}else if(e>=6&&e<9){this._units.setText(String.fromCharCode(176))}this._editingForm.rerender();this._viewport.setShouldRenderFrame()};h.prototype.beginGesture=function(){this._isMoved=false;this._isRotated=false;this._originPosition=(new THREE.Vector3).setFromMatrixPosition(this._gizmo.matrixWorld);this._originQuaternion=this._gizmo.quaternion.clone()};h.prototype.endGesture=function(){if(this._isMoved){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z})}if(this._isRotated){this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z})}this._line.visible=false;this._arcMesh.visible=false};h.prototype._setOffset=function(t,e){if(this._tool.fireEvent("moving",{x:t.x,y:t.y,z:t.z},true)){this._move(t);var i=(new THREE.Matrix4).getInverse(this._gizmo.matrixWorld);var o=(new THREE.Vector3).setFromMatrixScale(this._gizmo.matrixWorld);var r=this._gizmo.position.clone().applyMatrix4(i);t.copy(this._originPosition).applyMatrix4(i).sub(r).multiply(o);this._line.geometry.vertices[0].copy(t);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();t.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));t.multiplyScalar(1/Math.max(t.x,t.y,t.z));this._line.material.color.setRGB(t.x,t.y,t.z);this._line.visible=true}};h.prototype._move=function(t){if(this._tool.getAllowOperation()===s.Rotate){return this}this._isMoved=true;this._moveDelta.copy(t);this._gizmo.position.copy(this._originPosition).add(t);this._viewport.setShouldRenderFrame()};h.prototype.move=function(t,e,i){this.beginGesture();this._move(new THREE.Vector3(t,e,i||0))};h.prototype._setRotationAxisAngle=function(t,e,i){var o=(i-e)%(Math.PI*2);var r=[0,0,0];r[t]=o;r=(new THREE.Euler).fromArray(r);if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(r.x),y:THREE.Math.radToDeg(r.y),z:THREE.Math.radToDeg(r.z)},true)){this._rotate(r);var a=[0,0,0];var s=new THREE.Vector3;var n=(t+1)%3,h=(t+2)%3;var l,d=Math.max(Math.ceil(Math.abs(o)*64/Math.PI),1);for(l=0;l<=d;l++){var u=e-o*(l/d);s.set(0,0,0).setComponent(n,Math.cos(u)).setComponent(h,Math.sin(u));a.push(s.x,s.y,s.z)}var _=[];for(l=0;l<d;l++){_.push(0,l+1,l+2)}var c=new THREE.BufferGeometry;c.setIndex(_);c.setAttribute("position",new THREE.Float32BufferAttribute(a,3));this._arcMesh.geometry=c;this._arcMesh.visible=true}};h.prototype._rotate=function(t){if(this._tool.getAllowOperation()===s.Move){return this}this._tool._deactivateScreenAlignment();this._isRotated=true;this._rotationDelta.set(THREE.Math.radToDeg(t.x),THREE.Math.radToDeg(t.y),THREE.Math.radToDeg(t.z));var e=(new THREE.Quaternion).setFromEuler(t);this._gizmo.quaternion.copy(this._originQuaternion).multiply(e);this._viewport.setShouldRenderFrame()};h.prototype.rotate=function(t,e,i){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(t||0),THREE.Math.degToRad(e||0),THREE.Math.degToRad(i||0)))};h.prototype._getValueLocaleOptions=function(){return this._handleIndex>=0&&this._handleIndex<3?{useGrouping:false}:{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};h.prototype.getValue=function(){if(this._handleIndex>=0&&this._handleIndex<3){var t=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.dot(this._gizmo.position)}if(this._handleIndex>=6&&this._handleIndex<9){return THREE.Math.radToDeg(this._gizmo.rotation.reorder("YXZ")[["x","y","z"][this._handleIndex-6]])}return 0};h.prototype.setValue=function(t){if(this._handleIndex>=0&&this._handleIndex<3){var e=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize().multiplyScalar(t-this.getValue());this.beginGesture();this._move(e);this.endGesture()}else if(this._handleIndex>=6&&this._handleIndex<9){var i=this._gizmo.rotation.clone();i[["x","y","z"][this._handleIndex-6]]=THREE.Math.degToRad(t);var o=(new THREE.Quaternion).setFromEuler(i);var r=this._gizmo.quaternion.clone().inverse().multiply(o);i.setFromQuaternion(r);this.beginGesture();this._rotate(i);this.endGesture()}};h.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};h.prototype._updateGizmoTransformation=function(t,e){this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);var i=this._getGizmoScale(this._gizmo.position);this._gizmo.scale.setScalar(this._gizmoSize*i);this._gizmo.updateMatrixWorld(true);this._updateAxisTitles(this._axisTitles,this._gizmo,e,this._gizmoSize+18,i);this._line.scale.setScalar(1/(this._gizmoSize*i))};h.prototype._getEditingFormPosition=function(){var t=this._getGizmoScale(this._gizmo.position);var e=new THREE.Vector3;if(this._handleIndex>=0&&this._handleIndex<3){e.setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex>=6&&this._handleIndex<9){var i=this._handleIndex%3;var o=this._extractBasis(this._gizmo.matrixWorld);e.copy(o[(i+1)%3]).add(o[(i+2)%3]).normalize()}return e.clone().multiplyScalar((this._gizmoSize+18)*t).add(this._gizmo.position).applyMatrix4(this._matViewProj)};h.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();t.clearDepth();this._updateGizmoTransformation(0,e);t.render(this._sceneGizmo,e);this._updateEditingForm(this._handleIndex>=0&&this._handleIndex<3||this._handleIndex>=6&&this._handleIndex<9,this._handleIndex%3)};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three"],function(t,e,i,s,n){"use strict";var r=t.extend("sap.ui.vk.tools.AnchorPointToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3;this._gizmoOrigin=new THREE.Vector3;this._gizmoScale=1;this._matrixOrigin=new THREE.Matrix4;this._rotationOrigin=new THREE.Matrix4;this._mouse=new THREE.Vector2;this._mouseOrigin=new THREE.Vector2}});r.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};r.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var r=this._gizmo.getTouchObject(s);var a=this._rayCaster.intersectObject(r,true);if(a.length>0){this._handleIndex=r.children.indexOf(a[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(r.matrixWorld);this._matrixOrigin.copy(r.matrixWorld);this._gizmoScale=r.scale.x;this._rotationOrigin.extractRotation(r.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex-3).normalize()}else if(this._handleIndex<9){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex-6).normalize()}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};r.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};r.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex);t.handled|=this._handleIndex>=0}};var a=new THREE.Vector3;r.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();a.copy(t.origin).sub(this._gizmoOrigin);return e.dot(a)/e.dot(this._handleAxis)};r.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;a.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(a)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(a)};r.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};r.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset()}else if(this._handleIndex<9){this._axis1=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new THREE.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new THREE.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}var i=this._axis1.clone();var s=2;for(var n=0;n<3;n++){var r=(new THREE.Vector3).setComponent(n,1);var a=this._rotationAxis.dot(r);if(s>a){s=a;i.copy(r)}}i.sub(this._rotationAxis.clone().multiplyScalar(i.dot(this._rotationAxis))).normalize();this._levelAngle=Math.atan2(i.dot(this._axis2),i.dot(this._axis1));this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0}}}};r.prototype._setOffset=function(t){if(this._tool.getEnableStepping()){var e=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*.1;var i=(new THREE.Matrix4).getInverse(this._rotationOrigin);var s=this._gizmoOrigin.clone().applyMatrix4(i);var n=this._gizmoOrigin.clone().add(t).applyMatrix4(i);for(var r=0;r<3;r++){var o=n.getComponent(r);if(Math.abs(o-s.getComponent(r))>e*1e-5){var h=Math.round(o/e)*e;a.setFromMatrixColumn(this._rotationOrigin,r).multiplyScalar(h-o);t.add(a)}}}this._gizmo._setOffset(t,this._gizmoIndex)};r.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin))}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin))}}else if(this._handleIndex<9){var e=this._startAngle;var i=this._getMouseAngle()-e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*i<0){i+=Math.PI*2*Math.sign(this._prevDeltaAngle)}}i=i%(Math.PI*2);var s=e+i;if(this._tool.getEnableStepping()){var n=THREE.Math.degToRad(5);var r=s-e-this._levelAngle;s+=Math.round(r/n)*n-r}this._prevDeltaAngle=s-e;if(isFinite(e)&&isFinite(s)){this._gizmo._setRotationAxisAngle(this._handleIndex-6,e,s)}}}};r.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};function o(t){var e=[];if(t){t.enumerateSelection(function(t){e.push(t)})}return e}r.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var n=this.getViewport();var r=new e({items:[new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_WORLD_ORIGIN")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTION_CENTER")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SCENE_CENTER")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTED_OBJECTS_ORIGIN")})],itemSelected:function(t){var e=t.getParameters("item").item;var i=t.getSource().indexOfItem(e);var s=new THREE.Vector3;switch(i){default:case 0:break;case 1:this._tool.moveTo(o(n._viewStateManager),false);return;case 2:var r=n.getScene()?n.getScene().getSceneRef():null;if(r){var a=new THREE.Box3;r._expandBoundingBox(a,null,true);a.getCenter(s)}break;case 3:this._tool.moveTo(o(n._viewStateManager),true);return}this._gizmo.setPosition(s);n.setShouldRenderFrame()}.bind(this)});r.openAsContextMenu(t.event,n)}}};r.prototype.getViewport=function(){return this._tool._viewport};r.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};r.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolOperation", [],function(){"use strict";var e={All:"All",Rotate:"Rotate",Move:"Move"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AngleMeasurementTool", ["./Tool","./MeasurementToolHandler","./AngleMeasurementToolGizmo"],function(t,i,e){"use strict";var s=t.extend("sap.ui.vk.tools.AngleMeasurementTool",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._viewport=null;this._handler=new i(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new e)};s.prototype.exit=function(){o.exit.apply(this,arguments)};s.prototype.setActive=function(t,i,e){o.setActive.call(this,t,i,e);if(this._viewport){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitAngleCursor")}else{this._viewport.removeStyleClass("sapUiVizKitAngleCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AngleMeasurementToolGizmo", ["../measurements/Angle","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,i){"use strict";var s=i.extend("sap.ui.vk.tools.AngleMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"}});var a=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(a.init){a.init.call(this)}this._thirdFeature=null};s.prototype._updateCurrentFeature=function(e,i,s,a,u,n){var h=e==null?null:this._getMeshAnalyzer(e);var c=this._computeSphereRadius(i,s);var _=false;var o=false;var l=this._firstFeature&&this._firstFeature.isEdge;if(h!=null&&(a||u||n)){var f=h.intersectSphere(i,c,a,u,n,false,false);if(this._is2D){if(!l&&f.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],f.vertexId,h)){this._currentFeature.setValue(f.vertex);return true}}else if(f.edge!=null){if(this._state===r.SearchingSecondFeature&&this._firstFeature.getFeatureId()===f.edgeId&&this._firstFeature.getContext()===h){_=true}else if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],f.edgeId,h)){this._currentFeature.setValue(f.edge);return true}}else if(l){_=true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(i);return true}}else{if(f.vertexId!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],f.vertexId,h)){this._currentFeature.setValue(h.getVertex(f.vertexId));return true}}else if(f.edgeId!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],f.edgeId,h)){this._currentFeature.setValue(h.buildEdgePath(f.edgeId,true));return true}}else if(f.faceId!=null){if(this._state===r.SearchingSecondFeature&&this._firstFeature.getFeatureId()===f.faceId&&this._firstFeature.getContext()===h){_=true}else if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],f.faceId,h)){var F=h.buildFace(f.faceId);if(this._state===r.SearchingSecondFeature&&!t.intersectPlanes(this._firstFeature.getValue().planeEquation,F.planeEquation)){_=true}else{this._currentFeature.setValue(F);return true}}o=true}else{_=true}}}else if(l){_=true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(i);return true}if(_&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return o};s.prototype._trimByContour=function(e,r,i,s){var a=[r[0],r[1],r[2],i[0],i[1],i[2]];var u,n=null;var h,c,_;var o=e.edges;var l=e.vertices;for(var f=0,F=o.length;f<F;f+=2){h=3*o[f];c=3*o[f+1];_=t.intersectLines(a,[l[h],l[h+1],l[h+2],l[c],l[c+1],l[c+2]]);u=_&&_[1]>=0&&_[1]<=1?_[0]:null;if(u){if(n){if(u<n[0]){n[0]=u}if(u>n[1]){n[1]=u}}else{n=[u,u]}}}var v=null;if(n&&s){if(s>n[0]&&s<n[1]){v=s}else if(n[1]>0&&n[1]<1){v=n[1]}}else if(n&&n[1]>0&&n[1]<1){v=n[1]}else if(s&&s>0&&s<1){v=s}return v?t.pointOnLine(a,v):i};s.prototype._updateFace2FaceMeasurement=function(e){var r=this._firstFeature.getValue();var i=this._currentFeature.getValue();var s=t.intersectPlanes(r.planeEquation,i.planeEquation);var a,u,n,h,c,_;var o,l,f;var F=r.vertices;for(var v=0,d=F.length;v<d;v+=3){a=[F[v],F[v+1],F[v+2]];u=t.projectPointToLine(s,a);o=t.computePointToPointDistance2(a,t.pointOnLine(s,u));if(v===0){n=u;h=u;c=a;_=a;l=a;f=o}if(u<n){n=u;c=a}if(u>h){h=u;_=a}if(o>f){f=o;l=a}}var g=t.projectPointToLine(s,e);var p=t.pointOnLine(s,g);if(g<=n){this._currentMeasurement.setPoint1(c);this._currentMeasurement.setPoint2(t.pointOnLine(s,n))}else if(g>=h){this._currentMeasurement.setPoint1(_);this._currentMeasurement.setPoint2(t.pointOnLine(s,h))}else{var m=t.pointOnLine(s,t.projectPointToLine(s,l));var P=t.pointMinusPoint(m,p);a=t.pointMinusPoint(l,P);var S=t.computePointToPointDistance(p,a);var M=t.computePointToPointDistance(p,e);this._currentMeasurement.setPoint1(this._trimByContour(r,p,a,S>0?M/S:1));this._currentMeasurement.setPoint2(p)}this._currentMeasurement.setPoint3(p);this._currentMeasurement.setPoint4(e);this._currentMeasurement.computeAngle();var x=Math.acos(t.dotProduct(r.planeEquation,i.planeEquation));var C=Math.PI-x;var I=this._currentMeasurement.getAngle();this._currentMeasurement.setAngle(Math.abs(x-I)<Math.abs(C-I)?x:C)};s.prototype._updateMeasurement=function(e){if(this._state===r.DefiningAngle){var t=this._viewport;var i=t.getCamera();var s=e.getPoints();var a=t.projectToScreen(s[0],s[1],s[2],i);var u=t.projectToScreen(s[3],s[4],s[5],i);var n=t.projectToScreen(s[6],s[7],s[8],i);var h=t.projectToScreen(s[9],s[10],s[11],i);var c=t.projectToScreen(s[12],s[13],s[14],i);var _=t.projectToScreen(s[15],s[16],s[17],i);var o=n.x-h.x;var l=n.y-h.y;var f=this._hoverPoint.screenPoint;e.setAngleRadius([a.x-o,a.y-l,0],[u.x-o,u.y-l,0],[h.x,h.y,0],[c.x,c.y,0],[_.x,_.y,0],[f[0],f[1],0]);return}var F=this._hoverPoint.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var v=this._currentFeature.getValue();F[0]=v[0];F[1]=v[1];F[2]=v[2]}if(this._state===r.SearchingSecondFeature){if(this._currentFeature&&this._currentFeature.isEdge){var d=this._currentFeature.getValue();e.setPoint3(d);e.setPoint4([d[3],d[4],d[5]]);e.computeAngle()}else if(this._firstFeature.isVertex){e.setPoint2(F);e.setPoint3(F);e.setPoint4(F);e.computeAngle()}else if(this._currentFeature&&this._currentFeature.isFace){this._updateFace2FaceMeasurement(F);e.setState(1)}}else if(this._state===r.SearchingThirdFeature){e.setPoint4(F);e.setState(1);e.computeAngle()}};s.prototype.setHoverPoint=function(e){var t=this._hoverPoint&&this._hoverPoint.nodeRef;var i=e&&e.nodeRef;if(i!=t){var s=this._vsm;if(s!=null){var a=i!=null?[i]:[];var u=t!=null?[t]:[];s.setOutliningStates(a,u,false,true)}}this._hoverPoint=e;var n=this._state===r.DefiningAngle;var h=this._state===r.SearchingSecondFeature||this._state===r.SearchingThirdFeature||this._state===r.DefiningAngle?this._currentMeasurement:null;if(!n&&(!e||e.worldPoint==null)){if(h){h.setVisible(n);this._surface.update(this._viewport,this._viewport.getCamera())}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var c=this._settings;var _=!e.shiftKey&&c.featureFace&&!this._is2D;var o=!e.shiftKey&&c.featureEdge;var l=!e.shiftKey&&c.featureVertex;if(this._firstFeature){_=this._firstFeature.isFace;o=this._firstFeature.isEdge;l=this._firstFeature.isVertex}if(n){_=false;o=false;l=false}var f=true;if((i||this._is2D)&&!n){f=this._updateCurrentFeature(i,this._hoverPoint.worldPoint,this._viewport,_,o,l)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(h&&f){this._updateMeasurement(h);h.setVisible(n||this._currentFeature!=null)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};s.prototype.fixPoint=function(t){this.setHoverPoint(t);var i=this._vsm;var s=this._hoverPoint&&this._hoverPoint.nodeRef;var a=this._state;switch(a){case r.SearchingFirstFeature:if(!t.worldPoint){break}this._firstFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=r.SearchingSecondFeature;var u=t.worldPoint.slice();var n=t.worldPoint.slice();if(this._firstFeature&&this._firstFeature.isVertex){var h=this._firstFeature.getValue();u[0]=h[0];u[1]=h[1];u[2]=h[2]}var c=0;if(this._firstFeature&&this._firstFeature.isEdge){var _=this._firstFeature.getValue();u[0]=_[0];u[1]=_[1];u[2]=_[2];n[0]=_[3];n[1]=_[4];n[2]=_[5];c=1}var o=new e({point1:u,point2:n,point3:n,point4:n,state:c});this._surface.beginMeasurementConstruction(o);this._currentMeasurement=o;break;case r.SearchingSecondFeature:if(!this._currentMeasurement.getVisible()||!this._currentMeasurement.isEdge1Defined()){break}this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._secondFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(2);this._state=this._currentMeasurement.getState()===1?r.DefiningAngle:r.SearchingThirdFeature;break;case r.SearchingThirdFeature:if(!this._currentMeasurement.isEdge2Defined()){break}this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._thirdFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(3);this._state=r.DefiningAngle;break;case r.DefiningAngle:if(!this._currentMeasurement.isEdge2Defined()){break}this._currentMeasurement.setState(2);this._currentMeasurement.setFeatures(this._thirdFeature!=null?[this._firstFeature,this._secondFeature,this._thirdFeature]:[this._firstFeature,this._secondFeature]);this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._state=r.SearchingFirstFeature;if(this._currentFeature){this._surface.removeFeature(this._currentFeature)}this._surface.removeFeature(this._thirdFeature);this._surface.removeFeature(this._secondFeature);this._surface.removeFeature(this._firstFeature);this._currentFeature=null;this._firstFeature=null;this._secondFeature=null;this._thirdFeature=null;this.setCurrentFeatureIndex(0);var l=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(l);break;default:break}return this};s.prototype.escapePressed=function(){switch(this._state){case r.DefiningAngle:this._state=r.SearchingThirdFeature;this._currentMeasurement.setRadiusScale(1);if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(this._thirdFeature){this._surface.removeFeature(this._thirdFeature);this._thirdFeature=null;this.setCurrentFeatureIndex(2)}if(!this._firstFeature.isVertex){this._state=r.SearchingSecondFeature;this._surface.removeFeature(this._secondFeature);this._secondFeature=null;this.setCurrentFeatureIndex(1);this._currentMeasurement.setVisible(false)}break;case r.SearchingThirdFeature:this._state=r.SearchingSecondFeature;this._currentMeasurement.setState(0);this._surface.removeFeature(this._secondFeature);this._secondFeature=null;this.setCurrentFeatureIndex(1);if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}break;case r.SearchingSecondFeature:this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._firstFeature);this._firstFeature=null;if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this.setCurrentFeatureIndex(0);this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;break;case r.SearchingFirstFeature:var e=this._vsm;var t=this._hoverPoint&&this._hoverPoint.nodeRef;if(t!=null&&e!=null){e.setOutliningStates([],[t],false,true)}if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this._state=r.Off;this._tool.setActive(false,this._viewport);break;default:break}if(this._currentMeasurement){this._updateMeasurement(this._currentMeasurement)}if(this._state!==r.Off){this._surface.update(this._viewport,this._viewport.getCamera())}};s.prototype.is2D=function(){return this._is2D};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AreaMeasurementTool", ["./Tool","./MeasurementToolHandler","./AreaMeasurementToolGizmo"],function(t,i,e){"use strict";var s=t.extend("sap.ui.vk.tools.AreaMeasurementTool",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._viewport=null;this._handler=new i(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new e)};s.prototype.exit=function(){o.exit.apply(this,arguments)};s.prototype.setActive=function(t,i,e){o.setActive.call(this,t,i,e);if(this._viewport){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitAreaCursor")}else{this._viewport.removeStyleClass("sapUiVizKitAreaCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AreaMeasurementToolGizmo", ["../measurements/Area","../measurements/Face","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,s,u){"use strict";var i=u.extend("sap.ui.vk.tools.AreaMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"}});var n=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(n.init){n.init.call(this)}this._pointsCountPerClick=null};i.prototype.beginMeasurementConstruction=function(e){this._surface.beginMeasurementConstruction(e);this._currentMeasurement=e;this._pointsCountPerClick=[]};i.prototype.cancelMeasurementConstruction=function(){this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;this._pointsCountPerClick=null};i.prototype.endMeasurementConstruction=function(){var e=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(e);this._pointsCountPerClick=null};i.prototype.updateContour=function(e,t){var r=e.length/3;if(this._pointsCountPerClick.length>0){var s=this._pointsCountPerClick[this._pointsCountPerClick.length-1];if(s===1&&r===1){this._currentMeasurement.replaceLastPoint(e)}else{this._currentMeasurement.replaceLastPoints(s,e,t);this._pointsCountPerClick[this._pointsCountPerClick.length-1]=r}}else{this._currentMeasurement.replaceLastPoints(0,e,t);this._pointsCountPerClick.push(r)}};i.prototype._finishArea=function(e){if(this._currentMeasurement.hasSelfIntersections()){return}var t=this._vsm;var r=this._hoverPoint&&this._hoverPoint.nodeRef;this._currentMeasurement.finalize();this._surface.update(this._viewport,this._viewport.getCamera());if(r!=null&&t!=null){t.setOutliningStates([],[r],false,true)}this._state=s.SearchingFirstFeature;if(e){this._currentMeasurement.setFeatures(this._vertexFeatures);for(var u=0,i=this._vertexFeatures.length;u<i;++u){this._surface.removeFeature(this._vertexFeatures[u])}}else if(this._currentFeature){this._currentMeasurement.setFeatures([this._currentFeature]);this._surface.removeFeature(this._currentFeature)}this._currentFeature=null;this.setCurrentFeatureIndex(0);this.endMeasurementConstruction()};i.prototype._updateCurrentFeature=function(t,u,i,n,a){var h=t==null?null:this._getMeshAnalyzer(t);var c=this._computeSphereRadius(u,i);var o=false;var _=false;var l=this._currentMeasurement?this._currentMeasurement.getPoints():null;var F=this._is2D;if(F&&l&&l.length>9&&!r.isClosedContour(l)&&r.computePointToPointDistance(u,l)<c){this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(l.slice(0,3));return true}if(h!=null){var f=h.intersectSphere(u,c,!F,F,F,n,a);if(F){if(!f.contour&&this._currentMeasurement&&this._state===s.SearchingFirstFeature){this.cancelMeasurementConstruction()}if(f.contour&&this._state===s.SearchingFirstFeature){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],f.contourId,h)){this._currentFeature.setValue({vertices:f.contour});return true}_=true}else if(f.curvedEdge!=null){if(!this._currentMeasurement){var v=new e({});this.beginMeasurementConstruction(v)}var p=f.curvedEdge;var d=p.length-3;var C=[p[0],p[1],p[2]];var m=[p[d],p[d+1],p[d+2]];var g=r.computePointToPointDistance2(u,C)>r.computePointToPointDistance2(u,m);this.updateContour(p,g);if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],f.curvedEdgeId+":"+(g?"r":"l"),h)){this._currentFeature.setValue(g?C:m);return true}}else if(f.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],f.vertexId,h)){this._currentFeature.setValue(f.vertex);return true}}else if(f.edge!=null){this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],f.edgeId,h);var P=f.edge;this._currentFeature.setValue(r.projectPointToEdge([P[0],P[1],P[2]],[P[3],P[4],P[5]],u));return true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(u);return true}}else{if(f.faceId!=null){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],f.faceId,h)){this._currentFeature.setValue(h.buildFace(f.faceId));return true}_=true}else{o=true}}}else if(F){if(this._currentMeasurement&&this._state===s.SearchingFirstFeature){this.cancelMeasurementConstruction()}this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(u);return true}if(o&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return _};i.prototype.setHoverPoint=function(t){var r=this._hoverPoint&&this._hoverPoint.nodeRef;var s=t&&t.nodeRef;if(s!=r){var u=this._vsm;if(u!=null){var i=s!=null?[s]:[];var n=r!=null?[r]:[];u.setOutliningStates(i,n,false,true)}}this._hoverPoint=t;if(!t||t.worldPoint==null){if(this._currentMeasurement){this.cancelMeasurementConstruction()}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var a=true;if(s||this._is2D){var h=this._settings;var c=!t.shiftKey&&h.featureEdge;var o=!t.shiftKey&&h.featureFace;a=this._updateCurrentFeature(s,this._hoverPoint.worldPoint,this._viewport,o,c)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}var _=this._currentMeasurement;if(this._currentFeature&&this._currentFeature.isFace){if(!_){_=new e({});this.beginMeasurementConstruction(_)}_.setFromFace(this._currentFeature)}else if(_&&a){var l=this._hoverPoint.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var F=this._currentFeature.getValue();l[0]=F[0];l[1]=F[1];l[2]=F[2]}this.updateContour(l,false)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};i.prototype.fixPoint=function(t){this.setHoverPoint(t);var u=this._vsm;var i=this._hoverPoint&&this._hoverPoint.nodeRef;var n=this._state;switch(n){case s.SearchingFirstFeature:if(!t.worldPoint){break}if(this._currentMeasurement){var a=this._currentMeasurement.getPoints();if(!a||!a.length||r.isClosedContour(a)){this._finishArea(false);this._surface.update(this._viewport,this._viewport.getCamera())}else{this._currentMeasurement.duplicateLastPoint();this._pointsCountPerClick.push(1);this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=s.SearchingSecondFeature}break}var h=t.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var c=this._currentFeature.getValue();h[0]=c[0];h[1]=c[1];h[2]=c[2]}var o=new e({points:h});o.duplicateLastPoint();this.beginMeasurementConstruction(o);this._pointsCountPerClick.push(1,1);this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=s.SearchingSecondFeature;break;case s.SearchingSecondFeature:var _=this._currentMeasurement.getPoints();if(this._currentMeasurement.getArea()&&_.length>9&&r.computePointToPointDistance2(_,_,_.length-3)===0){this._finishArea(true);break}if(!this._currentMeasurement.hasSelfIntersectionsLastEdge()){this._currentMeasurement.duplicateLastPoint();this._pointsCountPerClick.push(1);if(i!=null&&u!=null){u.setOutliningStates([],[i],false,true)}var l=this._currentFeature;var F=l.getContext();var f=l.getFeatureId();var v=l.getValue();this.setCurrentFeatureIndex(this._currentFeatureIndex+1);l=this._vertexFeatures[this._currentFeatureIndex];l.setContext(F);l.setFeatureId(f);l.setValue(v);this._surface.addFeature(l);this._currentFeature=l;this._state=s.SearchingSecondFeature;this._surface.update(this._viewport,this._viewport.getCamera())}break;default:break}return this};i.prototype.escapePressed=function(){switch(this._state){case s.SearchingSecondFeature:if(this._currentFeatureIndex>=2){var e=this._pointsCountPerClick.pop();var t=this._pointsCountPerClick.pop();this._pointsCountPerClick.push(e);this._currentMeasurement.deletePredLastPoints(t);this._surface.removeFeature(this._vertexFeatures[this._currentFeatureIndex-1]);this._vertexFeatures[this._currentFeatureIndex-1].setContext(this._currentFeature.getContext());this._vertexFeatures[this._currentFeatureIndex-1].setFeatureId(this._currentFeature.getFeatureId());this._vertexFeatures[this._currentFeatureIndex-1].setValue(this._currentFeature.getValue());this._surface.removeFeature(this._currentFeature);this._currentFeature=null;this.setCurrentFeatureIndex(this._currentFeatureIndex-1);this._currentFeature=this._vertexFeatures[this._currentFeatureIndex];this._surface.addFeature(this._currentFeature)}else{this._state=s.SearchingFirstFeature;if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this.setCurrentFeatureIndex(0);this.cancelMeasurementConstruction()}this._surface.update(this._viewport,this._viewport.getCamera());break;case s.SearchingFirstFeature:var r=this._vsm;var u=this._hoverPoint&&this._hoverPoint.nodeRef;if(u!=null&&r!=null){r.setOutliningStates([],[u],false,true)}if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this._state=s.Off;this._tool.setActive(false,this._viewport);break;default:break}};i.prototype.doubleClick=function(e){this.setHoverPoint(e);var t=this._state===s.SearchingSecondFeature?this._currentMeasurement:null;if(t&&t.getArea()){this._finishArea(true);return true}return false};i.prototype.is2D=function(){return this._is2D};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationTool", ["./Tool","../thirdparty/three","./AxisAngleRotationToolHandler","./AxisAngleRotationToolGizmo","./Detector","./ToolNodeSet"],function(t,e,o,i,s,r){"use strict";var n=t.extend("sap.ui.vk.tools.AxisAngleRotationTool",{metadata:{library:"sap.ui.vk",properties:{enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:r.Highlight}},events:{rotating:{parameters:{nodesProperties:"object[]"}},rotated:{parameters:{nodesProperties:"object[]"}}}},constructor:function(e,i){t.apply(this,arguments);this._viewport=null;this._handler=new o(this);this._gizmo=null;this._detector=new s}});n.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new i)};n.prototype.setActive=function(e,o,i){t.prototype.setActive.call(this,e,o,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};n.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.setEnableSnapping=function(t){this.setProperty("enableSnapping",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.getDetector=function(){return this._detector};n.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};n.prototype.rotateBy=function(t){this.getGizmo().rotateBy(t);return this};n.prototype.setAxis=function(t){this.getGizmo().setAxis(t);return this};n.prototype.getValues=function(){return this.getGizmo().getValues()};n.prototype.setValues=function(t){this.getGizmo().setValues(t);return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationToolGizmo", ["sap/base/Log","../thirdparty/three","./Gizmo","./AxisAngleRotationToolGizmoRenderer","./AxisColours","../AnimationTrackType","sap/base/assert"],function(e,t,i,a,o,r,n){"use strict";var s=i.extend("sap.ui.vk.tools.AxisAngleRotationToolGizmo",{metadata:{library:"sap.ui.vk"}});var l=[16711808,o.y,o.z];var h=Math.PI*2,u=Math.PI/2,d=13;var p=THREE.Math.degToRad,c=THREE.Math.radToDeg;s.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3;this._rotationDelta=new THREE.Vector3;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene;var e=new THREE.DirectionalLight(16777215,.5);e.position.set(1,3,2);this._sceneGizmo.add(e);this._sceneGizmo.add(new THREE.AmbientLight(16777215,.5));this._gizmo=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._touchAreas=new THREE.Group;this._nodes=[];this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;function t(e,t,i){var a=new THREE.TorusBufferGeometry(t,16/96,4,i,e===2?Math.PI:h);if(e===0){a.rotateY(u)}else if(e===1){a.rotateX(u)}else{a.rotateZ(-u)}return new THREE.Mesh(a,new THREE.MeshBasicMaterial({opacity:.2,transparent:true}))}var a;for(a=0;a<3;a++){this._touchAreas.add(t(a,1,24))}for(a=0;a<3;a++){var o=new THREE.Mesh(new THREE.IcosahedronBufferGeometry(.25,0),new THREE.MeshBasicMaterial({opacity:.2,transparent:true}));o.position.setComponent(a,1.6);this._touchAreas.add(o)}};s.prototype._createGizmoObject=function(){var e=new THREE.Group;var t=e.userData;function i(e,t,i,a){var o=new THREE.TorusBufferGeometry(i,1/96,4,a,e===2?Math.PI:h);if(e===0){o.rotateY(u)}else if(e===1){o.rotateX(u)}else{o.rotateZ(-u)}var r=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:t,transparent:true}));r.matrixAutoUpdate=false;r.userData.color=t;return r}function a(e,t){var i=96*3,a=2,o=12*3,r=2*3;e.multiplyScalar(1/i);var n=new THREE.MeshLambertMaterial({color:t});var s=new THREE.CylinderBufferGeometry(a,a,i-o,4);var l=(new THREE.Matrix4).makeBasis(new THREE.Vector3(e.y,e.z,e.x),e,new THREE.Vector3(e.z,e.x,e.y));l.setPosition(e.clone().multiplyScalar((i-o)*.5));s.applyMatrix4(l);var h=new THREE.Mesh(s,n);h.matrixAutoUpdate=false;h.userData.color=t;var u=new THREE.CylinderBufferGeometry(0,r,o,12,1);l.setPosition(e.clone().multiplyScalar(i-o*.5));u.applyMatrix4(l);var d=new THREE.Mesh(u,n);d.matrixAutoUpdate=false;h.add(d);return h}var o;for(o=0;o<3;o++){e.add(i(o,l[o],1,128))}t.axisArrow=a(new THREE.Vector3(3,0,0),l[0]);e.add(t.axisArrow);var r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.Float32BufferAttribute(new Float32Array([0,0,0,3,0,0]),3));t.arrowProjection=new THREE.Line(r,new THREE.LineDashedMaterial({color:l[0],transparent:true,scale:10,dashSize:1,gapSize:1}));t.arrowProjection.computeLineDistances();e.add(t.arrowProjection);e.add(new THREE.AxesHelper(1.5));t.arcMeshes=[];for(o=0;o<3;o++){var n=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,opacity:.5,transparent:true,side:THREE.DoubleSide,depthWrite:false}));n.visible=false;t.arcMeshes.push(n);e.add(n)}t.valueLabels=[];for(o=0;o<3;o++){var s=this._createTextMesh("",64,32,d,16777215,false);s.renderOrder=10;s.material.depthTest=false;s.visible=false;t.valueLabels.push(s);e.add(s)}var p=t.axisTitles=this._createAxisTitles();p.scale.setScalar(1/this._gizmoSize);var c=this._gizmoSize*1.6;p.children[0].position.x=c;p.children[1].position.y=c;p.children[2].position.z=c;e.add(p);return e};s.prototype.hasDomElement=function(){return true};s.prototype.resetValues=function(){this._value.setScalar(0)};s.prototype.show=function(e,t){this._viewport=e;this._tool=t;this.handleSelectionChanged();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true)};s.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};s.prototype.getGizmoCount=function(){return this._nodes.length};s.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}var t=this._gizmo.children[e];m(this._touchAreas.children[2],t.children[2]);m(this._touchAreas.children[0],t.children[0]);this._updateGizmoObjectTransformation(this._touchAreas,e);return this._touchAreas};s.prototype.highlightHandle=function(e,t,i){for(var a=0,o=this._gizmo.children.length;a<o;a++){var r=this._gizmo.children[a];var n=r.userData;for(var s=0;s<3;s++){var l=r.children[s];var h=s===e&&a===t?16776960:l.userData.color;l.material.color.setHex(h);l.material.opacity=e===-1||s===e?1:.35;l.material.visible=i||s===e;var u=n.axisTitles.children[s];u.material.color.setHex(a===t&&s===e-3?16776960:l.userData.color);u.material.opacity=i?1:.35;n.arcMeshes[s].material.visible=i||s===e||s===2&&e===1}}};s.prototype._snapToAxis=function(e){var t=-this._value.y,i=-this._value.z;switch(e){case 0:t+=90;break;case 1:i+=90;break;default:break}this.beginGesture();this._rotate(new THREE.Euler(0,p(t),p(i)));this.endGesture()};s.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(e>=3&&e<6){this._snapToAxis(e-3)}this._updateEditValue();this._viewport.setShouldRenderFrame()};function m(e,t){e.quaternion.copy(t.quaternion);e.position.copy(t.position);e.updateMatrix();e.updateMatrixWorld(true)}function f(e){return c(Math.atan2(e[0],e[2]))}function v(e){return c(Math.atan2(e[1],Math.sqrt(e[0]*e[0]+e[2]*e[2])))}function _(e,t){e=p(e);t=p(t);var i=Math.sin(e),a=Math.cos(e);var o=Math.sin(t),r=Math.cos(t);return[i*r,o,a*r]}function g(e,t,i,a){if(e.userData.angle1===i&&e.userData.angle2===a){return}e.userData.angle1=i;e.userData.angle2=a;var o=(new THREE.Color).setHex(l[t]);var r=[0,0,0];var n=[o.r,o.g,o.b];var s=new THREE.Vector3;var u=(t+1)%3,d=(t+2)%3;var p=a-i;var c,m=Math.min(Math.max(Math.ceil(Math.abs(p)*64/Math.PI),1),1e4);var f=Math.min(h/Math.abs(p),1);var v=THREE.Math.lerp;for(c=0;c<=m;c++){var _=1-c/m;var g=i+p*_;var E=v(f,1,_);s.set(0,0,0).setComponent(u,Math.cos(g)*E).setComponent(d,Math.sin(g)*E);r.push(s.x,s.y,s.z);var x=v(1,.5,_);n.push(o.r*x,o.g*x,o.b*x)}var y=[];for(c=0;c<m;c++){y.push(0,c+1,c+2)}var z=new THREE.BufferGeometry;z.setIndex(y);z.setAttribute("position",new THREE.Float32BufferAttribute(r,3));e.geometry=z;e.geometry.setAttribute("color",new THREE.Float32BufferAttribute(n,3));e.visible=p!==0}s.prototype._updateGizmoObject=function(e,t,i,a){var o=this._gizmo.children[e];var r=new THREE.Euler(0,p(i-90),0,"YZX");var n=o.children[2];n.quaternion.setFromEuler(r);n.updateMatrix();r.z=p(a);var s=o.children[0];s.quaternion.setFromEuler(r);s.updateMatrix();s.position.setFromMatrixColumn(s.matrix,0).multiplyScalar(2);s.updateMatrix();var l=o.userData;var h=l.axisArrow;h.quaternion.copy(s.quaternion);h.updateMatrix();var u=l.arrowProjection;var d=Math.cos(r.z);u.quaternion.copy(n.quaternion);u.scale.setScalar(d);u.updateMatrix();u.material.scale=d*10;var c=l.arcMeshes;g(c[0],0,0,p(t));m(c[0],o.children[0]);g(c[1],1,0,p(i));m(c[1],o.children[1]);g(c[2],2,0,p(a));m(c[2],o.children[2]);var f=l.valueLabels;x(f[0],t);x(f[1],i);x(f[2],a)};s.prototype.beginGesture=function(){this._rotationDelta.setScalar(0);this._nodes.forEach(function(e){e.beginAngle=e.angle;e.beginAzimuth=e.azimuth;e.beginElevation=e.elevation})};s.prototype._getNodesProperties=function(){return this.getValues()};s.prototype.endGesture=function(){this._nodes.forEach(function(e){delete e.beginAngle;delete e.beginAzimuth;delete e.beginElevation});var e=this._getNodesProperties();this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:e})};function E(e,t){var i=window.devicePixelRatio;var a=e.width;var o=e.height;var r=a*.5;var n=o*.5;var s=Math.min(d*.85*i,r-1);var l=e.getContext("2d");l.font="Bold "+d*i+"px Arial";var h=l.measureText(t);var p=Math.min(h.width*.5-s*.5,r-s-1);l.clearRect(0,0,a,o);l.beginPath();l.arc(r-p,n,s,u,u*3,false);l.lineTo(r+p,n-s);l.arc(r+p,n,s,-u,u,false);l.lineTo(r-p,n+s);l.closePath();l.globalAlpha=.75;l.fillStyle="#fff";l.fill();l.globalAlpha=1;l.lineWidth=i;l.strokeStyle="#000";l.stroke();l.fillStyle="#000";l.textAlign="center";if(sap.ui.Device.browser.chrome||sap.ui.Device.browser.firefox){l.textBaseline="top";l.fillText(t,r,n-h.actualBoundingBoxDescent*.5)}else{l.textBaseline="middle";l.fillText(t,r,n)}}function x(e,t){e.visible=t!==0;if(e.visible&&e.userData.value!==t){e.userData.value=t;var i=t.toLocaleString("fullwide",{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:1})+"";var a=e.material.map;E(a.image,i);a.needsUpdate=true}}s.prototype._updateEditValue=function(){var e=this._nodes[this._gizmoIndex];if(e){this._value.set(e.angle,e.azimuth,e.elevation)}};var y=new THREE.Vector3;var z=new THREE.Quaternion;s.prototype._updateNodeRotation=function(e){y.fromArray(_(e.azimuth,e.elevation));z.setFromAxisAngle(y,p(e.angle));e.node.quaternion.multiplyQuaternions(z,e.quaternion);e.node.updateMatrix();if(e.node.userData){delete e.node.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(e.node,r.Rotate)};s.prototype._rotate=function(e){this._rotationDelta.set(c(e.x),c(e.y),c(e.z));this._nodes.forEach(function(e){e.angle=e.beginAngle+this._rotationDelta.x;e.azimuth=(e.beginAzimuth+this._rotationDelta.y)%360;e.elevation=THREE.Math.clamp(e.beginElevation+this._rotationDelta.z,-90,90);if(e.azimuth>180){e.azimuth-=360}if(e.azimuth<-180){e.azimuth+=360}this._updateNodeRotation(e)},this);this._updateEditValue();this._viewport.setShouldRenderFrame()};s.prototype._setRotationAxisAngle=function(e,t,i){var a=i-t;if(e!==0){a%=h}var o=new THREE.Euler;o[["x","y","z"][e]]=a;var r=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:c(o.x),y:c(o.y),z:c(o.z),nodesProperties:r},true)){this._rotate(o)}};s.prototype.rotate=function(e,t,i){this.beginGesture();this._rotate(new THREE.Euler(p(e||0),p(t||0),p(i||0)))};s.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};s.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};s.prototype.setValue=function(e){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var t=new THREE.Euler;t[["x","y","z"][this._handleIndex]]=p(e-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(t);this.endGesture()}};s.prototype.rotateBy=function(e){this.beginGesture();this._rotate(new THREE.Euler(p(e),0,0));this.endGesture()};s.prototype.setAxis=function(e){this.beginGesture();var t=0;var i=0;if(Array.isArray(e)){t=f(e);i=v(e)}else{if("azimuth"in e){t=e.azimuth}if("elevation"in e){i=e.elevation}}this._nodes.forEach(function(e){e.azimuth=t;e.elevation=i;this._updateNodeRotation(e)},this);this._updateEditValue();this._viewport.setShouldRenderFrame();this.endGesture()};s.prototype.getValues=function(){var e=[];this._nodes.forEach(function(t){e.push({node:t.node,angle:t.angle,azimuth:t.azimuth,elevation:t.elevation,axis:_(t.azimuth,t.elevation)})});return e};s.prototype._getNodeInfoByNode=function(e){var t=this._nodes;for(var i=0,a=t.length;i<a;i++){if(t[i].node===e){return t[i]}}return null};s.prototype.setValues=function(e){e.forEach(function(e){var t=this._getNodeInfoByNode(e.node);if(t){t.angle=e.angle;if(e.axis){t.azimuth=f(e.axis);t.elevation=v(e.axis)}else{t.azimuth=e.azimuth;t.elevation=e.elevation}t.quaternion=t.node.quaternion.clone();y.fromArray(_(t.azimuth,t.elevation));z.setFromAxisAngle(y,-p(t.angle));t.quaternion.premultiply(z);this._updateNodeRotation(t)}},this);this._updateEditValue();this._viewport.setShouldRenderFrame()};s.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};s.prototype._updateSelection=function(e){i.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(e)}};s.prototype.handleSelectionChanged=function(e){this._nodes.length=0;this._gizmoIndex=this._handleIndex=-1;if(this._viewport){this._updateSelection(this._viewport._viewStateManager);this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true);this._nodes.forEach(function(e){e.quaternion=e.node.quaternion.clone();e.angle=0;e.azimuth=0;e.elevation=0});var t=this._nodes.length;var i=this._gizmo;while(i.children.length>t){i.remove(i.children[i.children.length-1])}while(i.children.length<t){i.add(this._createGizmoObject())}}};s.prototype._getObjectSize=function(e){var t=new THREE.Box3;this._nodes[e].node._expandBoundingBox(t,true,false);if(t.isEmpty()){return 0}var i=new THREE.Vector3;t.getSize(i);return i.length()};s.prototype._updateGizmoObjectTransformation=function(e,t){var i=this._nodes[t].node;var a=this._getEffectiveParent(i);e.position.setFromMatrixPosition(i.matrixWorld);if(a){e.quaternion.setFromRotationMatrix(a.matrixWorld)}else{e.quaternion.set(0,0,0,1)}var o=this._getGizmoScale(e.position);e.scale.setScalar(this._gizmoSize*o);e.updateMatrix();e.updateMatrixWorld(true);return o};s.prototype._getValuePosition=function(e,t,i,a){i=p(i);a=p(a);var o=new THREE.Euler(0,0,0,"YZX");if(t===0){o.set(0,i,a)}else if(t===1){o.set(0,i*.5,0)}else{o.set(0,i,a*.5)}o.y-=u;e.set(t===0?3.25:1.25,0,0).applyEuler(o)};var w=new THREE.Vector3;s.prototype._updateGizmoTransformation=function(e,t){var i=this._gizmo.children[e];var a=this._nodes[e];var o=this._updateGizmoObjectTransformation(i,e);i.userData.axisTitles.children.forEach(function(e){e.quaternion.copy(i.quaternion).inverse().multiply(t.quaternion)});for(var r=0;r<3;r++){var n=i.userData.valueLabels[r];this._getValuePosition(n.position,r,a.azimuth,a.elevation);n.quaternion.copy(i.quaternion).inverse().multiply(t.quaternion);w.copy(n.position).applyMatrix4(i.matrixWorld);n.scale.setScalar(this._getGizmoScale(w)/(o*this._gizmoSize))}};s.prototype._getEditingFormPosition=function(){var e=this._gizmo.children[this._gizmoIndex];var t=this._nodes[this._gizmoIndex];this._updateGizmoObjectTransformation(e,this._gizmoIndex);this._getValuePosition(w,this._handleIndex,t.azimuth,t.elevation);return w.applyMatrix4(e.matrixWorld).applyMatrix4(this._matViewProj)};s.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,a=this.getGizmoCount();i<a;i++){var o=this._nodes[i];this._updateGizmoObject(i,o.angle,o.azimuth,o.elevation);this._updateGizmoTransformation(i,t)}e.render(this._sceneGizmo,t);this._updateEditValue()}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex,["","",""][this._handleIndex])};s.prototype._getOffsetForRestTransformation=function(e){};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,o){"use strict";var r=t.extend("sap.ui.vk.tools.AxisAngleRotationToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=12;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._rayCaster.linePrecision=.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new THREE.Matrix4;this._mouse=new THREE.Vector2;this._mouseOrigin=new THREE.Vector2}});r.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};r.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var o=this._gizmo.getTouchObject(s);var r=this._rayCaster.intersectObject(o,true);if(r.length>0){this._handleIndex=o.children.indexOf(r[0].object);if(this._handleIndex>=0&&this._handleIndex<6){this._gizmoIndex=s;this._matrixOrigin.copy(r[0].object.matrixWorld);this._objectSize=this._gizmo._getObjectSize(s)/this._gizmo._getGizmoScale(o.position)}}}}this._gizmo.highlightHandle(this._handleIndex,this._gizmoIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};r.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};r.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};r.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};r.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0&&this._handleIndex<3){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new THREE.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new THREE.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}this._startAngle=THREE.Math.degToRad(this._gizmo.getValue());this._prevAngle=this._getMouseAngle();this._deltaAngle=0}}};r.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._getMouseAngle();var i=e-this._prevAngle;this._prevAngle=e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}this._deltaAngle+=i;var s=this._startAngle;var n=s+this._deltaAngle;if(this._tool.getEnableStepping()){var o=5;if(this._objectSize>0){var r=[.1,1,5,15];var a=[2e3,1e3,300,0];for(var h=0;h<4;h++){if(this._objectSize>=a[h]){o=r[h];break}}}o=THREE.Math.degToRad(o);n=Math.round(n/o)*o}if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"rotate",handleIndex:this._handleIndex,angle1:s,angle2:n})}if(isFinite(s)&&isFinite(n)){this._gizmo._setRotationAxisAngle(this._handleIndex,s,n)}}};r.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};r.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true}}};r.prototype.getViewport=function(){return this._tool._viewport};r.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};r.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisColours", [],function(){"use strict";var e={x:16720418,y:42821,z:4754167};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CalibrateDistanceMeasurementTool", ["sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","./CalibrateDistanceMeasurementToolHandler","./Tool","../getResourceBundle","../measurements/Settings","../measurements/Utils"],function(e,t,i,s,a,r,n,o,l){"use strict";var u=r.extend("sap.ui.vk.tools.CalibrateDistanceMeasurementTool",{metadata:{library:"sap.ui.vk"}});var h=u.getMetadata().getParent().getClass().prototype;u.prototype.init=function(){if(h.init){h.init.call(this)}this._viewport=null;this._handler=new a(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};u.prototype.setActive=function(e,t,i){h.setActive.call(this,e,t,i);if(this._viewport){if(e){this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitCalibrateDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitCalibrateDistanceCursor");this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};u.prototype.highlightMeasurement=function(e){var t=this._highlightedMeasurementDomRef;if(e===t){return null}var i=this._viewport.getMeasurementSurface();if(t!=null){i.highlightMeasurement(t._measurement,false)}if(e!=null){if(e._measurement.isDistance){i.highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}else{e=null}}this._highlightedMeasurementDomRef=e;return this};u.prototype.calibrateMeasurement=function(a){var r=a._measurement;if(!r.isDistance){return this}var u=this._viewport;var h=u.getMeasurementSurface();var c=o.load();var d=l.getUnitFactor(c.units);var m=h.getScale();var p=r.getDistance();var v=p*d*m;var g={label:n().getText("MEASUREMENTS_CALIBRATION_DISTANCE_LABEL",[l.translateUnits(o.load().units)]),distance:v};var f=new i(g);var _=this;var M=this.getId()+"-calibration-dialog";var C;t.load({name:"sap.ui.vk.measurements.Calibration",id:M,controller:{onResetPressed:function(e){f.setProperty("/distance",p*d)},onOkPressed:function(){if(g.distance<=0){e.error(n().getText("MEASUREMENTS_CALIBRATION_DISTANCE_ERROR_MESSAGE"),{onClose:function(){t.byId(M,"distance").focus()}});return}if(g.distance!==v){h.setScale(g.distance/d/p);h.update(u,u.getCamera())}C.close();_.setActive(false,u)},onCancelPressed:function(){C.close()},onAfterClose:function(){C.destroy();C=null}}}).then(function(e){C=e;C.setModel(f);C.setModel(new s({bundle:n()}),"i18n");C.open()});return this};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CalibrateDistanceMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.CalibrateDistanceMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var i=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(i.hitTest(o,n))}else{e.highlightMeasurement(null)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){t.handled=true;var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var o=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(i,o);if(n){e.calibrateMeasurement(n)}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool;e.setActive(false,e._viewport);t.handled=true}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var i=this._getOffset(r);var o=this._rect={x:i.x,y:i.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=o.x&&t.x<=o.x+o.w&&t.y>=o.y&&t.y<=o.y+o.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CoordinateSystem", [],function(){"use strict";var e={Local:"Local",World:"World",Screen:"Screen",Parent:"Parent",Custom:"Custom"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseTool", ["sap/base/Log","../library","./Tool","./CreateEllipseToolHandler","./CreateEllipseToolGizmo","../svg/Ellipse"],function(t,e,i,o,s,r){"use strict";var n=i.extend("sap.ui.vk.tools.CreateEllipseTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(t,e){if(n._instance){return n._instance}i.apply(this,arguments);this._viewport=null;this._handler=new o(this);n._instance=this}});n.prototype.init=function(){if(i.prototype.init){i.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,e,o){i.prototype.setActive.call(this,t,e,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};n.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Ellipse"],function(t,i,e){"use strict";var a=t.extend("sap.ui.vk.tools.CreateEllipseToolGizmo",{metadata:{library:"sap.ui.vk"}});a.prototype.hasDomElement=function(){return false};a.prototype.show=function(t,i){this._viewport=t;this._tool=i;this.updateParentNode()};a.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null};a.prototype._calculateNodeMatrix=function(t,e,a,r){var o=i._multiplyMatrices(this._invParentMatrix,[t,e,-e,t,a,r]);var s=o[0]*o[3]-o[1]*o[2];if(s<0){o[2]*=-1;o[3]*=-1}if(o[3]<0){o[0]*=-1;o[1]*=-1;o[2]*=-1;o[3]*=-1}return o};a.prototype._startAdding=function(t){this._invParentMatrix=i._invertMatrix(this._root._matrixWorld());this._startPos=t;var a=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minRadius=Math.max(a.x2-a.x1,a.y2-a.y1)*.5;this._activeElement=new e({subelement:true,major:this._minRadius,minor:this._minRadius,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var r=new i({name:"Ellipse",matrix:this._calculateNodeMatrix(1,0,t.x,t.y)});r.add(this._activeElement);this._root.add(r)};a.prototype._update=function(t,i){var e=this._startPos;var a=this._activeElement;if(a){var r=t.x-e.x;var o=t.y-e.y;var s=Math.sqrt(r*r+o*o);var n=this._tool.getUniformMode()^i;if(s===0||n){r=1;o=0}else{r/=s;o/=s}var l=Math.max(s*.5,this._minRadius);var _=n?l:l*.5;a.rx=Math.max(l,this._minRadius);a.ry=Math.max(_,this._minRadius);a.parent.setMatrix(this._calculateNodeMatrix(r,o,(t.x+e.x)*.5,(t.y+e.y)*.5));a.invalidate()}};a.prototype._stopAdding=function(){var t=this._activeElement;this._activeElement=null;this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)})};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreateEllipseToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});i.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};i.prototype.hover=function(t){};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(t.buttons===1){this._gesture=true;t.handled=true;e._startAdding(this._getPosition(t))}}};i.prototype.move=function(t){if(this._gesture){t.handled=true;this._tool.getGizmo()._update(this._getPosition(t),t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._tool.getGizmo()._stopAdding(this._getPosition(t))}};i.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateParametricGizmo", ["./Gizmo","../svg/HotspotHelper"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreateParametricGizmo",{metadata:{library:"sap.ui.vk"}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._activeElement=null};i.prototype.updateParentNode=function(){if(!this._tool||!this._viewport){return}var t=this._tool.getParentNode();if(!t){t=this._viewport._scene.getRootElement();while(t.userData.skipIt&&t.children.length>0){t=t.children[0]}}this._root=t};i.prototype._createRequest=function(t){return(new e).createRequest(t,this._viewport)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathTool", ["../library","./Tool","./CreatePathToolHandler","./CreatePathToolGizmo"],function(t,e,i,o){"use strict";var s=e.extend("sap.ui.vk.tools.CreatePathTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},closePath:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"},closed:"boolean"}}}},constructor:function(t,o){if(s._instance){return s._instance}e.apply(this,arguments);this._viewport=null;this._handler=new i(this);s._instance=this}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new o)};s.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};s.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};s.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};s.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Path","sap/ui/events/KeyCodes"],function(t,e,i,s){"use strict";var o=t.extend("sap.ui.vk.tools.CreatePathToolGizmo",{metadata:{library:"sap.ui.vk"}});o.prototype.hasDomElement=function(){return false};o.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._activeElement=null;this.updateParentNode();this._onKeyPressListener=this._onKeyPress.bind(this);document.addEventListener("keydown",this._onKeyPressListener)};o.prototype.hide=function(){document.removeEventListener("keydown",this._onKeyPressListener);if(this._gizmo){this._gizmo.parent.remove(this._gizmo);this._gizmo=null}if(this._activeElement){this._finishPath(false)}this._viewport=null;this._tool=null;this._root=null};var n=4;var l=16;o.prototype._getDistance=function(t,e){return Math.sqrt(t*t+e*e)*this._viewport._camera.zoom};o.prototype._getGizmoSegments=function(t){var e=5/this._viewport._camera.zoom;return[{type:"move",points:[t.x-e,t.y]},{type:"line",points:[t.x+e,t.y]},{type:"move",points:[t.x,t.y-e]},{type:"line",points:[t.x,t.y+e]}]};o.prototype._addPoint=function(t,s,o){var h=this._activeElement;if(!h){this._activeElement=h=new i({subelement:true,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:null,segments:[{type:"move",points:[t.x,t.y]}]});if(h.stroke[3]===0){h.stroke.set([1,0,0,.5]);h.strokeDashArray=[5,5]}if(this._tool.getClosePath()){h.segments.push({type:"close"});h.setFillStyle(this._tool._fillStyle)}this._pointCount=2;this._canClosePath=false;this._gizmo=new i({subelement:true,lineStyle:{colour:"#000",width:2},segments:this._getGizmoSegments(t)});var a=new e({name:"Path"});a.add(h);a.add(this._gizmo);this._root.add(a)}else{var r=h.segments[0].points;if(this._pointCount>=r.length){r.push(t.x,t.y)}else{r[r.length-2]=t.x;r[r.length-1]=t.y}h.invalidate();if(s){if(o&&this._checkClosure(t)){return}if(this._getDistance(t.x-r[this._pointCount-2],t.y-r[this._pointCount-1])>=n){this._canClosePath=this._canClosePath||this._getDistance(t.x-r[0],t.y-r[1])>=l;this._pointCount=r.length;if(this._gizmo){this._gizmo.segments=this._getGizmoSegments(t);this._gizmo.invalidate()}}}}};o.prototype._checkClosure=function(t){var e=this._activeElement;if(e){var i=e.segments[0].points;if(this._getDistance(t.x-i[0],t.y-i[1])<l){if(this._canClosePath&&this._pointCount>=6){this._finishPath(true);return true}}}return false};o.prototype._finishPath=function(t){if(this._gizmo){this._gizmo.parent.remove(this._gizmo);this._gizmo=null}var e=this._activeElement;if(e){if(this._pointCount<4){e.parent.remove(e);this._activeElement=null;this._tool.fireCompleted({})}else{var i=e.segments[0].points;i.length=this._pointCount;e.setLineStyle(this._tool._lineStyle);if(t&&e.segments.length===1){e.segments.push({type:"close"});e.setFillStyle(this._tool._fillStyle)}e.invalidate();this._tool.fireCompleted({node:e.parent,request:this._createRequest(e.parent),closed:t})}this._activeElement=null}};o.prototype._onKeyPress=function(t){switch(t.keyCode){case s.ESCAPE:case s.ENTER:if(this._activeElement){this._finishPath(false)}break;default:break}};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreatePathToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null;this._gesture=false}});i.prototype._getPosition=function(t){var i=this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y);var o=e._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return e._transformPoint(i.x,i.y,o)};i.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&e._activeElement){t.handled=true;this._tool.getGizmo()._addPoint(this._getPosition(t),false)}};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&t.buttons===1&&this._inside(t)){t.handled=true;this._gesture=true;e._addPoint(this._getPosition(t),true,true)}};i.prototype.move=function(t){var e=this._tool.getGizmo();if(e&&this._gesture&&this._inside(t)){t.handled=true;this._tool.getGizmo()._addPoint(this._getPosition(t),true)}};i.prototype.endGesture=function(t){var e=this._tool.getGizmo();if(e&&this._gesture&&this._inside(t)){this._gesture=false;t.handled=true;this._tool.getGizmo()._checkClosure(this._getPosition(t))}};i.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};i.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true;e._finishPath(false)}};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleTool", ["../library","./Tool","./CreateRectangleToolHandler","./CreateRectangleToolGizmo"],function(t,e,i,o){"use strict";var s=e.extend("sap.ui.vk.tools.CreateRectangleTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(t,o){if(s._instance){return s._instance}e.apply(this,arguments);this._viewport=null;this._handler=new i(this);s._instance=this}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new o)};s.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};s.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};s.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};s.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Rectangle"],function(t,e,i){"use strict";var a=t.extend("sap.ui.vk.tools.CreateRectangleToolGizmo",{metadata:{library:"sap.ui.vk"}});a.prototype.hasDomElement=function(){return false};a.prototype.show=function(t,e){this._viewport=t;this._tool=e;this.updateParentNode()};a.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null};a.prototype._startAdding=function(t){this._startPos=t;var a=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minWidth=a.x2-a.x1;this._minHeight=a.y2-a.y1;this._activeElement=new i({subelement:true,width:this._minWidth,height:this._minHeight,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var o=new e({name:"Rectangle",matrix:[1,0,0,1,t.x,t.y]});o.add(this._activeElement);this._root.add(o)};a.prototype._update=function(t,e){var i=this._startPos;var a=this._activeElement;if(a){var o=Math.min(i.x,t.x);var n=Math.min(i.y,t.y);var s=Math.max(Math.abs(i.x-t.x),this._minWidth);var r=Math.max(Math.abs(i.y-t.y),this._minHeight);if(this._tool.getUniformMode()^e){if(s<r){s=r;if(t.x<i.x){o=i.x-s}}else{r=s;if(t.y<i.y){n=i.y-r}}}a.parent.setMatrix([1,0,0,1,o,n]);a.width=s;a.height=r;a.invalidate()}};a.prototype._stopAdding=function(){var t=this._activeElement;this._activeElement=null;this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)})};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.CreateRectangleToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){var o=this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y);var i=e._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return e._transformPoint(o.x,o.y,i)};o.prototype.hover=function(t){};o.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(t.buttons===1){this._gesture=true;t.handled=true;e._startAdding(this._getPosition(t))}}};o.prototype.move=function(t){if(this._gesture){t.handled=true;this._tool.getGizmo()._update(this._getPosition(t),t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._tool.getGizmo()._stopAdding(this._getPosition(t))}};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextTool", ["./Tool","./CreateTextToolHandler","./CreateTextToolGizmo"],function(t,e,i){"use strict";var o=t.extend("sap.ui.vk.tools.CreateTextTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},fontSize:{type:"string",defaultValue:"14"},fontFace:{type:"string",defaultValue:"Verdana,Arial,Helvetica,sans-serif"}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(i,s){if(o._instance){return o._instance}t.apply(this,arguments);this._viewport=null;this._handler=new e(this);o._instance=this}});o.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new i)};o.prototype.setActive=function(e,i,o){t.prototype.setActive.call(this,e,i,o);var s=this._viewport;if(s){if(e){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};o.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};o.prototype._editText=function(t){if(this._gizmo){this._gizmo._editText(t)}};o.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};o.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Text","sap/ui/richtexteditor/RichTextEditor"],function(t,e,o,i){"use strict";var r=t.extend("sap.ui.vk.tools.CreateTextToolGizmo",{metadata:{library:"sap.ui.vk"}});r.prototype.hasDomElement=function(){return true};r.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._editForm=null;this.updateParentNode()};r.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;if(this._editForm){this._editForm.close();this._editForm=null}};r.prototype._createText=function(t,i){if(this._editForm){return}var r=1/this._viewport._camera.zoom;var n=e._multiplyMatrices(e._invertMatrix(this._root._matrixWorld()),[r,0,0,r,t.x,t.y]);var s=[1,0,0,n[3]<0?-1:1,0,0];if(n[3]<0){n[2]*=-1;n[3]*=-1}var a=new o({subelement:true,text:i,style:{size:this._tool.getFontSize(),fontFace:this._tool.getFontFace()},matrix:s,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var l=new e({name:"Text",matrix:n});l.add(a);this._root.add(l);this._editText(a)};r.prototype._editText=function(t){var o=this.getDomRef();if(!o){this._editElementWhenReady=t;return}var r=e._transformPoint(t.x,t.y,t._matrixWorld());var n=this._viewport._camera._worldToScreen(r.x,r.y);o.style.left=n.x+"px";o.style.top=n.y+"px";var s=this._editForm=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.PreferredLeftOrFlip,content:new sap.m.VBox({items:[new i({width:"500px",height:"200px",wrapping:false,customToolbar:true,showGroupUndo:true,showGroupFont:true,showGroupTextAlign:false,value:t.getHtmlTextContent(),change:function(e){t.setHtmlTextContent(this.getValue())},customButtons:[new sap.m.Button({text:"OK",press:function(){s.close()}})]}).addStyleClass("sapUiSizeCompact"),new sap.m.Button({text:"OK",press:function(){s.close()}})]})});s.attachAfterClose(function(){this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)});this._editForm=null}.bind(this));s.openBy(this)};r.prototype.onAfterRendering=function(){if(this._editElementWhenReady){this._editText(this._editElementWhenReady);this._editElementWhenReady=null}};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextToolGizmoRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.style("position","absolute");e.style("pointer-events","none");e.openEnd();e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.CreateTextToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};o.prototype.hover=function(t){};o.prototype.beginGesture=function(t){};o.prototype.move=function(t){};o.prototype.endGesture=function(t){};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){this._tool.getGizmo()._createText(this._getPosition(t),"Text");t.handled=true}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionTool", ["./Tool","./CrossSectionToolHandler","./CrossSectionToolGizmo"],function(t,i,o){"use strict";var e=t.extend("sap.ui.vk.tools.CrossSectionTool",{metadata:{library:"sap.ui.vk",properties:{showEditingUI:{type:"boolean",defaultValue:false}}},constructor:function(o,s){if(e._instance){return e._instance}t.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null;e._instance=this}});e.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new o)};e.prototype.setActive=function(i,o,e){t.prototype.setActive.call(this,i,o,e);if(this._viewport){if(i){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};e.prototype.setAxis=function(t){if(this._gizmo){this._gizmo.setAxis(t)}return this};e.prototype.setFlip=function(t){if(this._gizmo){this._gizmo.setFlip(t)}return this};e.prototype.getFlip=function(){return this._gizmo?this._gizmo._flip:undefined};e.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};e.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};e.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;delete e._instance};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionToolGizmo", ["../getResourceBundle","../thirdparty/three","./Gizmo","./AxisColours","../threejs/ThreeUtils","sap/base/assert"],function(t,e,i,o,r,s){"use strict";var n=i.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk"}});n.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(t().getText("TOOL_UNITS_MM"),84);this._handleIndex=-1;this._viewport=null;this._tool=null;this._position=new THREE.Vector3(0,0,0);this._plane=new THREE.Plane(new THREE.Vector3(0,0,1),0);this._flip=false;this._matViewProj=new THREE.Matrix4;this._gizmoSize=144;this._firstShowPress=true;this.setAxis(0)};n.prototype.hasDomElement=function(){return true};n.prototype.show=function(t,e){this._viewport=t;this._tool=e;if(this._firstShowPress){var i=t._scene?t._scene._computeBoundingBox(true,true):new THREE.Box3;i.getCenter(this._position);this._firstShowPress=false}this._plane.constant=-this._plane.normal.dot(this._position);t.setClippingPlanes([this._plane])};n.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null}this._handleIndex=-1;this._tool=null;this._updateEditingForm(false,-1)};n.prototype._getOffset=function(){return this._position.getComponent(this._axis)};n.prototype.getAxis=function(){return this._axis};n.prototype.setAxis=function(t){this._handleIndex=-1;this._axis=t;var e=(new THREE.Vector3).setComponent(t,1);this._plane.normal.set(0,0,0).setComponent(t,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);var i=new THREE.BufferGeometry;var r=new Array(15);var s=new THREE.Vector3(e.y,e.z,e.x),n=new THREE.Vector3(e.z,e.x,e.y),a=new THREE.Vector3;a.sub(s).sub(n).multiplyScalar(.5).toArray(r,0);a.toArray(r,12);a.add(s).toArray(r,3);a.add(n).toArray(r,6);a.sub(s).toArray(r,9);i.setAttribute("position",new THREE.Float32BufferAttribute(r,3));this._gizmoPlane=new THREE.Line(i,new THREE.LineBasicMaterial({color:4210752,transparent:true,linewidth:window.devicePixelRatio}));var h=144,p=window.devicePixelRatio*.5,l=32,_=6,u=48;e=this._plane.normal.clone().multiplyScalar(1/h);var m=0;switch(t){case 0:m=o.x;break;case 1:m=o.y;break;case 2:m=o.z;break;default:break}var c=new THREE.CylinderBufferGeometry(p,p,h-l,4);var d=(new THREE.Matrix4).makeBasis(new THREE.Vector3(e.y,e.z,e.x),e,new THREE.Vector3(e.z,e.x,e.y));d.setPosition(e.clone().multiplyScalar((h-l)*.5));c.applyMatrix4(d);this._gizmoArrow=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:m}));this._gizmoArrow.userData.color=m;var w=new THREE.CylinderBufferGeometry(0,_,l,12,1);d.setPosition(e.clone().multiplyScalar(h-l*.5));w.applyMatrix4(d);var g=new THREE.Mesh(w,new THREE.MeshBasicMaterial({color:m}));g.matrixAutoUpdate=false;this._gizmoArrow.add(g);var x=new THREE.CylinderGeometry(u*.5,u*.5,h,12,1);d.setPosition(e.clone().multiplyScalar(h*.5));x.applyMatrix4(d);this._touchMesh=new THREE.Mesh(x,new THREE.MeshBasicMaterial({visible:false,side:THREE.DoubleSide}));this._gizmoArrow.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.setFlip=function(t){this._flip=!!t;var e=this._handleIndex;this.setAxis(this._axis);this._handleIndex=e;return this};n.prototype.getTouchObject=function(){return this._touchMesh};var a=new THREE.Vector3;n.prototype._getDelta=function(){var t=this._viewport._scene._computeBoundingBox(true,true);t.getSize(a);return Math.max(a.x,a.y,a.z)};n.prototype._setOffset=function(t){var e=this._viewport._scene._computeBoundingBox(true,true);t=THREE.Math.clamp(t,e.min.getComponent(this._axis),e.max.getComponent(this._axis));this._position.setComponent(this._axis,t);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame()};n.prototype.getValue=function(){return this._position.getComponent(this._handleIndex)};n.prototype.setValue=function(t){if(this._handleIndex>=0){this._position.setComponent(this._handleIndex,t);this._plane.constant=t;this._viewport.setShouldRenderFrame()}};n.prototype.highlightArrowHandle=function(t){var e=t?16776960:this._gizmoArrow.userData.color;this._gizmoArrow.material.color.setHex(e);this._gizmoArrow.children[0].material.color.setHex(e)};n.prototype.selectHandle=function(t){this._handleIndex=t;this._viewport.setShouldRenderFrame()};n.prototype._adjustBoundingBox=function(t){t.getSize(a);var e=Math.max(a.x,a.y,a.z)*.2;t.expandByScalar(e)};n.prototype._updateGizmo=function(t){var e=this._axis;var i=THREE.Math.clamp(this._position.getComponent(e),t.min.getComponent(e),t.max.getComponent(e));this._position.setComponent(e,i);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(t);t.getCenter(this._gizmoPlane.position);this._gizmoPlane.position.setComponent(e,i);t.getSize(this._gizmoPlane.scale);this._gizmoPlane.updateMatrixWorld(true);var o=this._viewport.getCamera().getCameraRef();this._gizmoArrow.position.copy(this._gizmoPlane.position);this._matViewProj.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse);this._gizmoArrow.scale.setScalar(this._gizmoSize*this._getGizmoScale(this._gizmoArrow.position));this._gizmoArrow.updateMatrixWorld(true)};n.prototype.expandBoundingBox=function(t){if(this._viewport){var e=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(e);t.min.min(e.min);t.max.max(e.max);t.expandByPoint(this._plane.normal.clone().multiply(this._gizmoArrow.scale).add(this._gizmoArrow.position))}};n.prototype._getEditingFormPosition=function(){return this._plane.normal.clone().applyMatrix4(this._gizmoArrow.matrixWorld).applyMatrix4(this._matViewProj)};n.prototype.render=function(){s(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var t=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(t);var e=this._viewport.getRenderer(),i=this._viewport.getCamera().getCameraRef();e.render(this._gizmoPlane,i);e.clearDepth();e.render(this._gizmoArrow,i);this._gizmo=this._gizmoArrow;this._updateEditingForm(this._handleIndex>=0,this._handleIndex)};n.prototype.exit=function(){if(this._gizmoArrow){r.disposeObject(this._gizmoArrow);this._gizmoArrow=null}if(this._gizmoPlane){r.disposeObject(this._gizmoPlane);this._gizmoPlane=null}if(this._touchMesh){r.disposeObject(this._touchMesh);this._touchMesh=null}i.prototype.exit.call(this)};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.CrossSectionToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=20;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new THREE.Vector2;this._rayCaster=new THREE.Raycaster;this._rayCaster.linePrecision=0;this._gizmoAxis=new THREE.Vector3;this._dragOrigin=new THREE.Vector2;this._dragOffset=0;this._dragDelta=0}});e.prototype._updateRayCaster=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};e.prototype._updateArrowHandle=function(t){var e=this._gizmo.getTouchObject();var i=-1;if(t.n===1){this._updateRayCaster(t);var s=this._rayCaster.intersectObject(e,true);i=s.length>0?this._gizmo.getAxis():-1}if(i!==this._axisIndex){this._axisIndex=i;this._gizmo.highlightArrowHandle(i>=0);if(i>=0){this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1)}this.getViewport().setShouldRenderFrame()}};e.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);t.handled|=this._axisIndex>=0}};e.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);t.handled|=this._axisIndex>=0}};e.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);if(this._axisIndex>=0){this._gesture=true;t.handled=true;this._dragOrigin.set(t.x,t.y);this._dragOffset=this._gizmo._getOffset();this._dragDelta=this._gizmo._getDelta()/500}}};e.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateRayCaster(t);var e=this._gizmoAxis.clone().applyQuaternion(this.getViewport().getCamera().getCameraRef().quaternion.clone().inverse());e.z=0;e.normalize();if(e.x===0&&e.y===0){e.y=1}this._gizmo._setOffset(this._dragOffset+((t.x-this._dragOrigin.x)*e.x-(t.y-this._dragOrigin.y)*e.y)*this._dragDelta)}};e.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateArrowHandle(t)}};e.prototype.getViewport=function(){return this._tool._viewport};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};e.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DeleteMeasurementTool", ["./DeleteMeasurementToolHandler","./Tool"],function(e,t){"use strict";var i=t.extend("sap.ui.vk.tools.DeleteMeasurementTool",{metadata:{library:"sap.ui.vk"}});var r=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(r.init){r.init.call(this)}this._viewport=null;this._handler=new e(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};i.prototype.setActive=function(e,t,i){r.setActive.call(this,e,t,i);if(this._viewport){if(e){this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitDeleteDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitDeleteDistanceCursor");this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};i.prototype.highlightMeasurement=function(e,t){var i=this._highlightedMeasurementDomRef;if(e===i){return null}if(i!=null){this._viewport.getMeasurementSurface().highlightMeasurement(i._measurement,false)}if(e!=null){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}this._highlightedMeasurementDomRef=e;return this};i.prototype.removeMeasurement=function(e){var t=this._viewport.getMeasurementSurface();var i=e._measurement;t.removeMeasurement(i);if(t.getMeasurements().length===0){this.setActive(false,this._viewport)}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DeleteMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.DeleteMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var o=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(o.hitTest(i,n),o)}else{e.highlightMeasurement(null,o)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){t.handled=true;var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var i=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(o,i);if(n){e.removeMeasurement(n)}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool;e.setActive(false,e._viewport);t.handled=true}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var o=this._getOffset(r);var i=this._rect={x:o.x,y:o.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=i.x&&t.x<=i.x+i.w&&t.y>=i.y&&t.y<=i.y+i.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/Detector", [],function(){"use strict";var e=function(){this._verticesMap=new Map;this._objArr=[];this._collidedUuids=new Set;this._sourceObjects=null;this._targetObjects=[];this._srcBoxHelper=null;this._sourceBox=new THREE.Box3;this._originPos=new THREE.Vector3;this._targetBoxHelper=[];this._targetBoxes=[];this._detectDistance=20;this._direction=new THREE.Vector3;this._isReady=false;this._finalDistance=null;this._finalSnaps=[];this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;this._detectType={move:this.detectMove.bind(this),scale:this.detectScale.bind(this),rotate:this.detectRotate.bind(this)}};e.prototype.isReady=function(){if(this._isReady&&this._sourceObjects){return true}else{return false}};e.prototype.setMoved=function(e){this._isMoved=e;this._intersectDistance=Number.NEGATIVE_INFINITY};e.prototype.getObjArray=function(){return this._objArr};e.prototype.addObjFromScene=function(e){var t=e._scene.getSceneRef();var i=e._viewStateManager;this._objArr.length=0;this._verticesMap.clear();t.traverse(function(e){if(e.isMesh){if(!this._objArr.find(function(t){return t.uuid===e.uuid})){this._objArr.push(e);var t=this.getVertices(e.geometry);this._verticesMap.set(e.uuid,t)}}}.bind(this));this.setSource(i,e);this._isReady=true};e.prototype.setSource=function(e,t){var i=[];e.enumerateSelection(function(e){i.push(e)});if(i.length>0){var s=i.pop();if(this._isReady){e.setSelectionStates(s,i,false,true)}if(s.children.length===0){this._isGroup=false;this._sourceObjects=s}else{this._isGroup=true;var o=[];s.traverse(function(e){if(e.type==="Mesh"){o.push(e)}});this._sourceObjects=o[0]}this._srcBoxHelper=new THREE.BoxHelper(this._sourceObjects);this._srcBoxHelper.update();this._sourceBox.setFromObject(this._srcBoxHelper);this._sourceSize=this._sourceBox.getSize();this._calculateInitialDetectDistance(t)}else{this._isReady=false;this._sourceObjects=null;this._sourceBox=new THREE.Box3}this.setTarget()};e.prototype._calculateInitialDetectDistance=function(e){if(e){var t=new THREE.Vector3;var i=new THREE.Vector3;var s=e.getRenderer().getSize(new THREE.Vector2);t.set(0/s.x*2-1,-(0/s.y)*2+1,.5);var o=e.getCamera().getCameraRef();t.unproject(o);t.sub(o.position).normalize();var r=-o.position.z/t.z;i.copy(o.position).add(t.multiplyScalar(r));var n=new THREE.Vector3;t.set(s.x/s.x*2-1,-(0/s.y)*2+1,.5);t.unproject(o);t.sub(o.position).normalize();r=-o.position.z/t.z;n.copy(o.position).add(t.multiplyScalar(r));var c=i.distanceTo(n);this._detectDistance=Math.abs(c)*.05}};e.prototype.setTarget=function(){this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._collidedUuids.clear();this._isMoved=false;if(this._sourceObjects){this._sourceObjects.geometry.computeBoundingSphere();this._originPos=new THREE.Vector3;this._targetObjects=this._objArr.filter(function(e){return e.uuid!==this._sourceObjects.uuid}.bind(this));this._targetBoxes.length=0;this._targetBoxHelper.length=0;this._targetObjects.forEach(function(e){var t=new THREE.BoxHelper(e);this._targetBoxHelper.push(t);t.update();var i=new THREE.Box3;i.setFromObject(e);this._targetBoxes.push(i)}.bind(this))}else{this._targetObjects.length=0;this._targetBoxes.length=0;this._targetBoxHelper.length=0}};e.prototype.updateTargetBox=function(){this._targetBoxHelper.forEach(function(e,t){e.update();this._targetBoxes[t].setFromObject(e)}.bind(this))};e.prototype.getVertices=function(e){var t,i,s=[];if(e.isGeometry){s=e.vertices}else if(e.isBufferGeometry){var o=e.attributes.position;if(o!==undefined){var r=new THREE.Vector3;s=[];var n={};var c="";for(t=0,i=o.count;t<i;t++){r.fromBufferAttribute(o,t);c=JSON.stringify(r);if(!n[c]){s.push(r.clone());n[c]=true}}}}return s};e.prototype.findClosestVertex=function(e,t,i){var s=this._verticesMap.get(i.uuid);if(s.length===0){return null}var o,r=null,n=i.worldToLocal(e.clone());for(var c=0,a=s.length;c<a;c++){o=s[c].distanceTo(n);if(o>t){continue}t=o;r=s[c]}if(r===null){return null}return i.localToWorld(r.clone())};e.prototype.findClosestSnap=function(e,t,i){var s=2;var o;while(!o){o=this.findClosestVertex(e,t,i);t*=s}return o};e.prototype.intersectDetect=function(e){var t=new Map;var i=this._sourceBox.clone().expandByScalar(this._detectDistance);e.forEach(function(e){var s=this._targetObjects.findIndex(function(t){return t.uuid===e.object.uuid});if(!this._collidedUuids.has(e.object.uuid)&&s!==-1&&this._targetBoxes&&this._targetBoxes[s].intersectsBox(i)){var o=this.findClosestSnap(this._originPos,this._detectDistance,this._targetObjects[s]);t.set(o,this._targetObjects[s]);if(this._targetBoxes[s].intersectsBox(this._sourceBox)&&this._intersectDistance<this._finalDistance){if(this.detectCollisionGJK(this._sourceObjects,this._targetObjects[s])){this._collidedUuid=e.object.uuid;this._intersectDistance=this._finalDistance}}}}.bind(this));return t};e.prototype.getFinalSnaps=function(e){var t=[];if(e.length>0){var i=this.intersectDetect(e);if(i.size!==0){var s=Array.from(i.keys());var o=s[0];var r=o.distanceTo(this._originPos);for(var n=1;n<s.length;++n){var c=s[n];var a=c.distanceTo(this._originPos);if(a<r){o=c;r=a}}var l=i.get(o);var h=this._originPos.distanceTo(o);var u,_;u=this.findClosestSnap(o,h,this._sourceObjects);var d=u.distanceTo(o);_=this.findClosestSnap(u,d,l);t=[u,_]}}return t};e.prototype.snapMove=function(){var e=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){e.gizmo._tool._handler._gesture=false;e.gizmo._moveDelta.add(this._direction.clone().multiplyScalar(.1));e.gizmo._move(e.gizmo._moveDelta)}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;e.viewport.setShouldRenderFrame()}this.detect()}};e.prototype.snapScale=function(){var e=this._op;if(!e.gizmo._scaleDelta.equals(new THREE.Vector3(1,1,1))&&this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){e.gizmo._tool._handler._gesture=false;var t=e.gizmo._scaleDelta.toArray();t.forEach(function(t,i){if(t>1){e.gizmo._scaleDelta.setComponent(i,t*1.01)}});e.gizmo._scale(e.gizmo._scaleDelta)}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;e.viewport.setShouldRenderFrame()}this.detect()}else if(Math.abs(this._finalDistance-this._intersectDistance)<=.1){this._collidedUuids.add(this._collidedUuid)}};e.prototype.snapRotate=function(){var e=this._op;if(this._finalSnaps.length===2&&this._sourceObjects&&Math.abs(this._finalDistance-this._intersectDistance)>.1){if(!this._collidedUuid&&this._finalDistance>=this._intersectDistance){e.gizmo._tool._handler._gesture=false;e.angle2+=.02*(e.angle2-e.angle1)/Math.abs(e.angle2-e.angle1);e.gizmo._setRotationAxisAngle(e.handleIndex,e.angle1,e.angle2)}else{this._intersectDistance=Number.NEGATIVE_INFINITY;this._collidedUuid=null;this._isMoved=false;e.viewport.setShouldRenderFrame()}this.detect()}};e.prototype._calculateDetectDistance=function(){var e=this._sourceSize;var t="";var i=0;if(Math.abs(this._direction.x)===1){t="x"}else if(Math.abs(this._direction.y)===1){t="y"}else if(Math.abs(this._direction.z)===1){t="z"}var s=e[t]/2;if(s){i=this._detectDistance+s}return i};e.prototype.detectMove=function(){this._direction.copy(this._op.gizmo._moveDelta).normalize();var e=this._calculateDetectDistance();var i=new THREE.Raycaster(this._originPos,this._direction,0,e);this._snapAction=t(this.snapMove,1e3/60).bind(this);return i.intersectObjects(this._targetObjects,false)};e.prototype.detectScale=function(){if(this._op.gizmo._scaleDelta.toArray().find(function(e){return e<=1})){this._op.gizmo._tool._handler._gesture=true;this._collidedUuids.forEach(function(e){var t=this._targetObjects.find(function(t){return t.uuid===e});if(t&&!this.detectCollisionGJK(this._sourceObjects,t)){this._collidedUuids.delete(e)}}.bind(this))}this._gizmoPos=new THREE.Vector3;this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var e=new THREE.Vector3;this._sourceObjects.getWorldPosition(e);var i=0,s=0;s=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;i=new THREE.Sphere(e,s+this._detectDistance);var o=[];this._targetBoxes.forEach(function(e,t){if(e.intersectsSphere(i)){o.push({object:this._targetObjects[t]})}}.bind(this));this._snapAction=t(this.snapScale,1e3/60).bind(this);return o};e.prototype.detectRotate=function(){this._gizmoPos=new THREE.Vector3;this._op.gizmo._gizmo.getWorldPosition(this._gizmoPos);var e=new THREE.Vector3;var i=new THREE.Vector3;var s=new THREE.Raycaster(this._originPos,this._direction,0,this._detectDistance);this._sourceObjects.getWorldPosition(i);this._radius=this._gizmoPos.distanceTo(i);var o=this._op.handleIndex;this._axis=(new THREE.Vector3).setFromMatrixColumn(this._op.gizmo._matOrigin,o).normalize();this._axis.transformDirection(this._op.gizmo._gizmo.matrixWorld);if(this._radius>.01){e.subVectors(i,this._gizmoPos).normalize();this._detectDistance=this._radius;this._direction.crossVectors(e,this._axis).normalize()}else if(this._finalSnaps.length===2){e.subVectors(this._finalSnaps[0],this._gizmoPos).normalize();this._direction.crossVectors(e,this._axis).normalize()}if(this._op.gizmo._rotationDelta.getComponent(o)>0){this._direction.negate()}var r=new THREE.Plane(this._axis);var n=[],c=[];var a=0,l=0;if(this._radius<.01){l=this._sourceObjects.geometry.boundingSphere.clone().applyMatrix4(this._sourceObjects.matrixWorld).radius;a=new THREE.Sphere(this._gizmoPos,l);this._targetBoxes.forEach(function(e,t){if(e.intersectsSphere(a)&&e.intersectsPlane(r)){n.push({object:this._targetObjects[t]})}}.bind(this))}else{a=new THREE.Sphere(this._gizmoPos,this._radius);this._targetBoxes.forEach(function(e,t){if(e.intersectsSphere(a)&&e.intersectsPlane(r)){c.push(this._targetObjects[t])}}.bind(this));n=s.intersectObjects(c,false)}this._snapAction=t(this.snapRotate,1e3/60).bind(this);return n};e.prototype.detect=function(e){var t=this._op=e||this._op;if(!this.isReady()||!this._verticesMap.has(this._sourceObjects.uuid)){this.addObjFromScene(t.viewport)}else{this._srcBoxHelper.update();this._sourceBox.setFromObject(this._sourceObjects);this._sourceBox.getCenter(this._originPos);this.updateTargetBox();var i=this._detectType[t.detectType]();this._finalSnaps=this.getFinalSnaps(i);if(this._finalSnaps.length===2){var s=new THREE.Vector3;s.subVectors(this._finalSnaps[1],this._finalSnaps[0]);this._finalDistance=s.length();if(this._finalDistance){this._snapAction()}}}};function t(e,t){var i;return function(){var s=this,o=arguments;clearTimeout(i);i=setTimeout(function(){i=null;e.apply(s,o)},t)}}e.prototype.detectCollisionGJK=function(e,t){var i=64;var s=this;function o(e,t){var o=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];var r=2;var n=s._direction;o[1]=_(e,t,n);if(o[1].dot(n)<0){return false}n=o[1].clone().negate();o[0]=_(e,t,n);if(o[0].dot(n)<0){return false}var c=o[1].clone().sub(o[0]);var a=o[0].clone().negate();n=c.clone().cross(a).cross(c);var l=function(e,t,i,s,c,a,l){if(i.clone().cross(a).dot(t)>0){o[1]=o[0];o[0]=e.clone();n=i.clone().cross(t).cross(i);r=2}else{o[2]=o[1];o[1]=o[0];o[0]=e.clone();n=a.clone()}};var h=function(e,t,i,s,c,a,h){if(a.clone().cross(s).dot(t)>0){o[0]=e.clone();n=s.clone().cross(t).cross(s);r=2}else{l(e,t,i,s,c,a,h)}};var u=function(e,t,i,s,r,n,c){if(n.clone().cross(s).dot(t)>0){o[0]=o[1];o[1]=o[2].clone();i=s;s=r.clone();n=c.clone();h(e,t,i,s,r,n,c)}else{l(e,t,i,s,r,n,c)}};function _(e,t,i){var s=i.clone().normalize();var o=d(e,s);var r=d(t,s.negate());return o.clone().sub(r)}function d(e,t){var i=s._verticesMap.get(e.uuid);var o=e.localToWorld(i[0].clone());var r=o.dot(t);for(var n=1;n<i.length;++n){var c=e.localToWorld(i[n].clone());var a=c.dot(t);if(a>r){o=c;r=a}}return o}for(var f=0;f<i;++f){var p=_(e,t,n);if(p.dot(n)<0){return false}var g,v,b,m,E;if(r===2){g=p.clone().negate();v=o[0].clone().sub(p);b=o[1].clone().sub(p);E=v.clone().cross(b);var T=v.clone().cross(E);if(T.dot(g)>0){o[1]=o[0];o[0]=p.clone();n=v.clone().cross(g).cross(v);continue}var x=E.clone().cross(b);if(x.dot(g)>0){o[0]=p.clone();n=b.clone().cross(g).cross(b);continue}if(E.dot(g)>0){o[2]=o[1];o[1]=o[0];o[0]=p.clone();n=E.clone()}else{o[2]=o[0];o[0]=p.clone();n=E.clone().negate()}r=3;continue}g=p.clone().negate();v=o[0].clone().sub(p);b=o[1].clone().sub(p);m=o[2].clone().sub(p);E=v.clone().cross(b);var y=b.clone().cross(m);var j=m.clone().cross(v);var D=1;var z=2;var S=4;var R=(E.dot(g)>0?D:0)|(y.dot(g)>0?z:0)|(j.dot(g)>0?S:0);if(R===0){return true}if(R===D){h(p,g,v,b,m,E,y)}else if(R===z){o[0]=o[1];o[1]=o[2].clone();v=b;b=m.clone();E=y.clone();h(p,g,v,b,m,E,y)}else if(R===S){o[1]=o[0];o[0]=o[2].clone();b=v;v=m.clone();E=j.clone();h(p,g,v,b,m,E,y)}else if(R===D||z){u(p,g,v,b,m,E,y)}else if(R===z||S){c=o[0];o[0]=o[1];o[1]=o[2];o[2]=c;c=v;v=b;b=m;m=c;E=y;y=j.clone();u(p,g,v,b,m,E,y)}else if(R===S||D){c=o[1];o[1]=o[0];o[0]=o[2];o[2]=c;c=b;b=v;v=m;m=c;y=E;E=j.clone();u(p,g,v,b,m,E,y)}else{return true}}return true}var r=performance.now();var n=o(e,t);if(n){console.log("Collide (ms): ",performance.now()-r);return true}else{console.log("Not Collide (ms): ",performance.now()-r);return false}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DistanceMeasurementTool", ["sap/ui/core/Fragment","sap/ui/core/IconPool","sap/ui/core/format/NumberFormat","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","./Tool","./MeasurementToolHandler","./DistanceMeasurementToolGizmo","../measurements/Settings","../getResourceBundle"],function(e,t,i,o,s,a,n,r,l,u){"use strict";var c="vk-icons";var d="vk-icons";t.addIcon("measurement-vertex",c,d,"e965");t.addIcon("measurement-edge",c,d,"e964");t.addIcon("measurement-face",c,d,"e963");t.addIcon("fill-color",c,d,"e92f");var m=a.extend("sap.ui.vk.tools.DistanceMeasurementTool",{metadata:{library:"sap.ui.vk"}});var p=m.getMetadata().getParent().getClass().prototype;m.prototype.init=function(){if(p.init){p.init.call(this)}this._viewport=null;this._handler=new n(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new r)};m.prototype.exit=function(){p.exit.apply(this,arguments)};m.prototype.setActive=function(e,t,i){p.setActive.call(this,e,t,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitDistanceCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};m.prototype.showSettingsDialog=function(t){var a=l.load();var n=t.getCamera();var r=t.getMeasurementSurface();var c;e.load({name:"sap.ui.vk.measurements.Settings",id:this.getId()+"-settings-dialog",controller:{formatPrecision:function(e){var t=i.getFloatInstance({minFractionDigits:e,maxFractionDigits:e});return t.format(Math.pow(10,-e))},onClosePressed:function(e){c.close()},onAfterClose:function(e){c.destroy();c=null},onChange:function(e){l.save(a);r.updateSettings(a);r.update(t,n)}}}).then(function(e){c=e;c.setModel(new s({bundle:u()}),"i18n");c.setModel(new o(a),"settings");c.setModel(new o({is2D:t.getScene().getMetadata().getName()==="sap.ui.vk.svg.Scene"}),"extra");c.open()})};return m});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DistanceMeasurementToolGizmo", ["../measurements/Distance","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,s){"use strict";var i=s.extend("sap.ui.vk.tools.DistanceMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"}});var u=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(u.init){u.init.call(this)}};i.prototype._updateCurrentFeature=function(e,t,r,s,i,u){var a=e==null?null:this._getMeshAnalyzer(e);var n=this._computeSphereRadius(t,r);var h=false;if(a!=null&&(s||i||u)){var l=a.intersectSphere(t,n,s,i,u,false,false);if(this._is2D){if(l.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.vertexId,a)){this._currentFeature.setValue(l.vertex);return true}}else if(l.edge!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],l.edgeId,a)){this._currentFeature.setValue(l.edge);return true}}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,a);this._currentFeature.setValue(t);return true}}else{if(l.vertexId!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.vertexId,a)){this._currentFeature.setValue(a.getVertex(l.vertexId));return true}}else if(l.edgeId!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],l.edgeId,a)){this._currentFeature.setValue(a.buildEdgePath(l.edgeId,true));return true}}else if(l.faceId!=null){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],l.faceId,a)){this._currentFeature.setValue(a.buildFace(l.faceId));return true}}else{h=true}}}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,a);this._currentFeature.setValue(t);return true}if(h&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return false};i.prototype._updateMeasurement=function(e){var r=this._firstFeature;var s=this._currentFeature;var i=r&&(r.isEdge||r.isFace);var u=s&&(s.isEdge||s.isFace);var a=this._hoverPoint.worldPoint;var n=null;if(s&&s.isVertex){a=s.getValue()}if(i&&u){var h;if(r.isEdge){if(s.isEdge){h=t.findClosestPointEdgeToEdge(s.getValue(),r.getValue())}else{h=t.findClosestPointFaceToEdge(s.getValue(),r.getValue())}n=[h[3],h[4],h[5]];a[0]=h[0];a[1]=h[1];a[2]=h[2]}else{if(s.isEdge){h=t.findClosestPointFaceToEdge(r.getValue(),s.getValue())}else{h=t.findClosestPointFaceToFace(r.getValue(),s.getValue())}n=[h[0],h[1],h[2]];a[0]=h[3];a[1]=h[4];a[2]=h[5]}}else if(i){if(r.isEdge){n=t.findClosestPointEdgeToPoint(r.getValue(),a)}else{n=t.findClosestPointFaceToPoint(r.getValue(),a)}}else if(u){var l=e.getPoint1();if(s.isEdge){a=t.findClosestPointEdgeToPoint(s.getValue(),l)}else{a=t.findClosestPointFaceToPoint(s.getValue(),l)}}if(n){e.setPoint1(n)}e.setPoint2(a)};i.prototype.setHoverPoint=function(e){var t=this._hoverPoint&&this._hoverPoint.nodeRef;var s=e&&e.nodeRef;if(s!=t){var i=this._vsm;if(i!=null){var u=s!=null?[s]:[];var a=t!=null?[t]:[];i.setOutliningStates(u,a,false,true)}}this._hoverPoint=e;var n=this._state===r.SearchingSecondFeature?this._currentMeasurement:null;if(!e||e.worldPoint==null){if(n){n.setVisible(false);this._surface.update(this._viewport,this._viewport.getCamera())}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var h=this._settings;var l=!e.shiftKey&&h.featureFace&&!this._is2D;var o=!e.shiftKey&&h.featureEdge;var c=!e.shiftKey&&h.featureVertex;var _=true;if(s||this._is2D){_=this._updateCurrentFeature(s,this._hoverPoint.worldPoint,this._viewport,l,o,c)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(n&&_){this._updateMeasurement(n);n.setVisible(true)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};i.prototype.fixPoint=function(t){var s=this._state;switch(s){case r.SearchingFirstFeature:this._firstFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=r.SearchingSecondFeature;var i=t.worldPoint.slice();if(this._firstFeature&&this._firstFeature.isVertex){var u=this._firstFeature.getValue();i[0]=u[0];i[1]=u[1];i[2]=u[2]}var a=new e({point1:i,point2:i});this._surface.beginMeasurementConstruction(a);this._currentMeasurement=a;break;case r.SearchingSecondFeature:if(this._currentMeasurement.getDistance()<1e-5){break}this._currentMeasurement.setShowArrows(true);this._currentMeasurement.setFeatures([this._firstFeature,this._currentFeature]);this._surface.update(this._viewport,this._viewport.getCamera());this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._currentFeature);this._surface.removeFeature(this._firstFeature);this._currentFeature=null;this._firstFeature=null;this.setCurrentFeatureIndex(0);var n=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(n);break;default:break}return this};i.prototype.escapePressed=function(){switch(this._state){case r.SearchingSecondFeature:this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._firstFeature);if(this._currentFeature){this._surface.removeFeature(this._currentFeature)}this._firstFeature=this._currentFeature=null;this.setCurrentFeatureIndex(0);this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;break;case r.SearchingFirstFeature:if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature)}this._firstFeature=this._currentFeature=null;this.setCurrentFeatureIndex(0);this._state=r.Off;this._tool.setActive(false,this._viewport);break;default:break}};i.prototype.is2D=function(){return this._is2D};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementTool", ["sap/base/Log","../library","./Tool","./DuplicateSvgElementToolHandler","./DuplicateSvgElementToolGizmo"],function(t,i,e,o,s){"use strict";var n=e.extend("sap.ui.vk.tools.DuplicateSvgElementTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},nodeList:{type:"any[]",defaultValue:[]}},events:{nodesCreated:{parameters:{x:"float",y:"float",nodes:"any[]",request:"object"}}}},constructor:function(t,i){if(n._instance){return n._instance}e.apply(this,arguments);this._viewport=null;this._handler=new o(this);n._instance=this}});n.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementToolGizmo", ["./CreateParametricGizmo","../svg/Element","./ToolNodeSet"],function(t,i,o){"use strict";var e=t.extend("sap.ui.vk.tools.DuplicateSvgElementToolGizmo",{metadata:{library:"sap.ui.vk"}});e.prototype.hasDomElement=function(){return false};var r=30;var s=30;e.prototype.show=function(t,i){this._viewport=t;this._tool=i;this._updateNodeList()};e.prototype.hide=function(){this._clearNodeList();this._viewport=null;this._tool=null};e.prototype._clearNodeList=function(){if(this._nodes&&this._nodes.length>0){this._nodes.forEach(function(t){var i=t.node;i.parent.remove(i)})}this._nodes=[]};e.prototype._updateNodeList=function(){this._clearNodeList();this._origin=null;var t=this._tool.getNodeList();if(Array.isArray(t)&&t.length>0){this.updateParentNode();this._parentMatrixWorldInv=i._invertMatrix(this._root._matrixWorld());var o=t[0]._getBBox(t[0]._matrixWorld());this._origin=o?{x:o.x+o.width*.5,y:o.y+o.height*.5}:{x:0,y:0};var e=this._viewport._camera._transformRect({x1:0,y1:0,x2:r,y2:s});this._createNodes({x:this._origin.x+e.x2-e.x1,y:this._origin.y+e.x2-e.x1})}};e.prototype._createNodes=function(t){var o=[1,0,0,1,t.x-this._origin.x,t.y-this._origin.y];this._nodes=[];this._tool.getNodeList().forEach(function(t){var e=t.clone();e.userData.duplicatedFrom=t.sid;var r=t._matrixWorld();e.matrix.set(i._multiplyMatrices(this._parentMatrixWorldInv,i._multiplyMatrices(o,r)));this._root.add(e);this._nodes.push({node:e,matrixWorld:t._matrixWorld()})}.bind(this))};e.prototype._move=function(t){if(this._nodes&&this._nodes.length>0){var o=[1,0,0,1,t.x-this._origin.x,t.y-this._origin.y];var e=this._parentMatrixWorldInv;this._nodes.forEach(function(t){var r=i._multiplyMatrices(e,i._multiplyMatrices(o,t.matrixWorld));t.node.setMatrix(r)})}};e.prototype._complete=function(t){this._move(t);if(this._nodes&&this._nodes.length>0){var i=this._nodes.map(function(t){return t.node});this._tool.fireNodesCreated({x:t.x-this._origin.x,y:t.y-this._origin.y,nodes:i,request:this._createRequest(i)});this._createNodes(t)}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.DuplicateSvgElementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};o.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){e._move(this._getPosition(t))}};o.prototype.beginGesture=function(t){};o.prototype.move=function(t){};o.prototype.endGesture=function(t){};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true;e._complete(this._getPosition(t))}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeAxis", [],function(){"use strict";var e={X:"X",Y:"Y",Z:"Z"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeDirection", [],function(){"use strict";var e={Positive:"Positive",Negative:"Negative"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeItemGroup", ["sap/ui/core/Element"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.ExplodeItemGroup",{metadata:{library:"sap.ui.vk",properties:{name:{type:"string"},magnitudeAdjustmentMultiplier:{type:"float",defaultValue:0}},aggregations:{items:{type:"sap.ui.vk.NodeProxy",multiple:true}}}});e.prototype.init=function(){this._magnitude=0;this._offset=0;this._deltaOffset=0;this._center=new THREE.Vector3};e.prototype.getBoundingBox=function(){var t=new THREE.Box3;this.getItems().forEach(function(e){e.getNodeRef()._expandBoundingBox(t,false,true,true)});return t};e.prototype.getMagnitude=function(){return this._magnitude*(this._offset+this._deltaOffset*this.getMagnitudeAdjustmentMultiplier())};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeTool", ["./Tool","./ExplodeAxis","./ExplodeDirection","./ExplodeItemGroup","./ExplodeType","./ExplodeToolHandler","./ExplodeToolGizmo","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../OrthographicCamera","sap/ui/base/ManagedObjectObserver","../getResourceBundle","../TransformationMatrix"],function(e,t,i,o,a,r,s,n,p,l,u,d,c,m){"use strict";var h=e.extend("sap.ui.vk.tools.ExplodeTool",{metadata:{library:"sap.ui.vk",properties:{type:{type:"sap.ui.vk.tools.ExplodeType",defaultValue:a.Linear},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float",defaultValue:0},anchor:{type:"float[]",defaultValue:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},aggregations:{items:{type:"sap.ui.vk.tools.ExplodeItemGroup",multiple:true}},associations:{selectedItem:{type:"sap.ui.vk.tools.ExplodeItemGroup",multiple:false}},events:{axisSelected:{parameters:{axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"}}},magnitudeChanging:{parameters:{type:{type:"sap.ui.vk.tools.ExplodeType"},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float"}}},magnitudeChanged:{parameters:{type:{type:"sap.ui.vk.tools.ExplodeType"},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float"}}},itemSequenceChangePressed:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},moveUp:{type:"boolean"}}},itemPositionAdjusting:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},magnitudeAdjustmentMultiplier:{type:"float"}}},itemPositionAdjusted:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},magnitudeAdjustmentMultiplier:{type:"float"}}}}},constructor:function(t,i){e.apply(this,arguments);this._viewport=null;this._handler=new r(this);this._gizmo=null}});h.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new s);this._groupObserver=new d(this._onGroupChanged.bind(this));this._groupsObserver=new d(this._onGroupsChanged.bind(this));this._groupsObserver.observe(this,{aggregations:["items"]})};h.prototype.destroy=function(){h._cleanAssociatedLoaders();this._groupsObserver.disconnect();this._groupsObserver=null;this._groupObserver.disconnect();this._groupObserver=null};h.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};h.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};h.prototype.setType=function(e){this.setProperty("type",e,true);if(this._gizmo){this._gizmo._recalculateOffsets()}};h.prototype.setAxis=function(e){this.setProperty("axis",e,true);if(this._gizmo){this._gizmo._updateAxis()}};h.prototype.setDirection=function(e){this.setProperty("direction",e,true);if(this._gizmo){this._gizmo._updateAxis()}};h.prototype.setAnchor=function(e){this.setProperty("anchor",e,true);if(this._gizmo){this._gizmo._updateAxis()}};h.prototype.pickAnchorFromNodesList=function(e){var t=null;var i=-1;var o=new THREE.Vector3;(Array.isArray(e)?e:[e]).forEach(function(e){var a=new THREE.Box3;e._expandBoundingBox(a,false,true,true);var r=a.getSize(new THREE.Vector3).manhattanLength();if(i<r){i=r;t=e;a.getCenter(o)}});if(t!==null){this.setAnchor(t.matrixWorld.clone().setPosition(o).elements)}return t};h.prototype.setMagnitude=function(e){e=Math.max(e,0);this.setProperty("magnitude",e,true);if(this._gizmo){this._gizmo._setMagnitude(e)}};h.prototype.setSelectedItem=function(e){this.setAssociation("selectedItem",e);if(this._gizmo){this._gizmo._handleSelectedItemChanged()}};h.prototype._onGroupsChanged=function(e){this._groupObserver.disconnect();this.getItems().forEach(function(e){this._groupObserver.observe(e,{aggregations:["items"]})}.bind(this));if(this._gizmo){this._gizmo._handleGroupsChanged(e)}};h.prototype._onGroupChanged=function(e){if(this._gizmo){this._gizmo._handleGroupsChanged(e)}};h.prototype.reset=function(){this.getItems().forEach(function(e){e.setMagnitudeAdjustmentMultiplier(0)});this.setMagnitude(0);this.setType(a.Linear);this.setAxis(undefined);this.setDirection(undefined)};h.prototype._activateView=function(e){var t=this._viewport.getScene();var i=t.getViewStateManager();var o=t.getViews()[e];i.activateView(o);var a=this._viewport._viewStateManager.getAnimationPlayer();if(a){setTimeout(function(){a.play()},100)}};h.prototype._createView=function(e,t,i,o,a,r,s){var n=this._viewport.getScene();var p=n.getViewStateManager();var l=n.createView({name:t});var d=[];if(e){var c=e.getNodeInfos();c.forEach(function(e){var t={target:e.target,transform:e.transform?e.transform.slice():null,meshId:e.meshId,materialId:e.materialId,visible:e.visible,opacity:e.opacity};d.push(t)})}else{var m=p.getNodeHierarchy();var h=function(e){if(e.visible){d.push({target:e,visible:e.visible})}m.enumerateChildren(e,h,false,true)};m.enumerateChildren(null,h,false,true)}l.setNodeInfos(d);var g={name:t,nodes:[]};if(e){g.sourceId=e.getViewId();g.exclude="PLAYBACK";var v=this._viewport.getCamera();var f={origin:v.getPosition(),target:v.getTargetDirection(),up:v.getUpDirection(),ortho:v instanceof u};if(f.ortho){f.zoom=v.getZoomFactor()}else{f.fov=v.getFov()/180*Math.PI}g.camera=f;var y=this._viewport._viewStateManager.getAnimationPlayer();if(y){g.time=y.getTime()}}d=[];o.forEach(function(e){var t=e.node;var i=a.get(t);g.nodes.push({sid:n.nodeRefToPersistentId(t),transform:i.localMatrix});d.push({target:t,transform:i.localMatrix})});l.updateNodeInfos(d);var E=n.findViewGroupByView(e);g.groupIds=E?[E.getViewGroupId()]:[r];if(s!==null){g.sequence=s}if(i){i.push(g)}return l};h.prototype.generateRequestData=function(e,t){var i=e?e.viewPrefix:null;var o=[];var r=1;var s=this._viewport.getScene();var u=this._viewport.getCurrentView();var d=new Map;var h=new Map;var g=[];var v=[];var f=[];var y=[];var E=null;var x=[];var _=null;var w=this.getType();if(t){if(Array.isArray(t.views)){var T=t.views.findIndex(function(e){return e.id===u.getViewId()});if(T>=0){E=t.views[T].sequence+1}x=t.views.slice(T+1)}_=t.id}var P=new Map;if(e&&e.animation&&e.animation.enabled){this.getItems().forEach(function(e){e.getItems().forEach(function(e){var t=e.getNodeRef();t.updateMatrixWorld();var i=(new THREE.Vector3).setFromMatrixPosition(t.matrixWorld);h.set(t.uuid,i);var o=new THREE.Matrix4;o.getInverse(t.parent.matrixWorld).multiply(t.matrixWorld);var a=new THREE.Vector3;var r=new THREE.Quaternion;var s=new THREE.Vector3;o.decompose(a,r,s);P.set(t,{localMatrix:m.convertTo4x3(o.elements),position:a,worldPosition:i})})});this._gizmo._nodes.forEach(function(e){var t=e.node;t.matrix.elements[12]=e.local.x;t.matrix.elements[13]=e.local.y;t.matrix.elements[14]=e.local.z;t.position.setFromMatrixPosition(t.matrix);t.updateMatrixWorld(true);d.set(t,[e.local.x,e.local.y,e.local.z]);var i=(new THREE.Vector3).setFromMatrixPosition(t.matrixWorld);var o=new THREE.Matrix4;o.getInverse(t.parent.matrixWorld).multiply(t.matrixWorld);var a=new THREE.Vector3;var r=new THREE.Quaternion;var s=new THREE.Vector3;o.decompose(a,r,s);var n=P.get(t);n.originalPosition=a;n.originalWorldPosition=i})}var I=new Set;var V=this._createView(u,i?i:c().getText("EXPLODETOOL_VIEW"),o,I,P,_,E);var A=o[o.length-1];if(e&&e.animation&&e.animation.enabled){if(!e.animation.separateAnimations){e.animation.separateViews=false}var k=e.animation.sequencePrefix;var O=1;var b=new Map;var z=null;var M=[];var R=[];var L="";this.getItems().forEach(function(t){f.push({name:t.getName()?t.getName():c().getText("EXPLODETOOL_GROUP_NODE",O),contentType:"REFERENCE",transform:[1,0,0,0,1,0,0,0,1,0,0,0]});A=o[o.length-1];if(e.animation.separateAnimations||e.animation.separateViews||O==1){if(M.length>0){v.push({name:L,endTime:r,joints:R,nodes:M});M=[];R=[]}if(e.animation.separateViews){L=c().getText("EXPLODETOOL_SEQUENCE_NAME",[A.name,1])}else{L=c().getText("EXPLODETOOL_SEQUENCE_NAME",[A.name,O])}L=k?c().getText("EXPLODETOOL_PREFIX_n",[k,O]):L;z=s.createSequence(V.getId()+"_seq"+O,{name:L,duration:r});var d=new n({sequence:z});V.addPlayback(d);V.resetPlaybacksStartTimes();if(!A.playbacks){A.playbacks=[]}A.playbacks.push({start:e.animation.separateViews?0:(O-1)*r,sequence:v.length})}var m=s.createTrack(null,{trackValueType:l.Vector3,isAbsoluteValue:false});this._gizmo._nodes.forEach(function(e){if(e.group==t){var i=e.node;var o=s.nodeRefToPersistentId(i);R.push(y.length);y.push({parent:O-1,childSid:o});var n=h.get(i.uuid);if(w===a.Radial||m.getKeysCount()==0){if(w===a.Radial&&m.getKeysCount()>0){m=s.createTrack(null,{trackValueType:l.Vector3,isAbsoluteValue:false})}var u=P.get(i);var d=[u.worldPosition.x-u.originalWorldPosition.x,u.worldPosition.y-u.originalWorldPosition.y,u.worldPosition.z-u.originalWorldPosition.z];m.insertKey(0,[0,0,0]);m.insertKey(r,d);g.push({time:[0,r],vector3:[0,0,0,d[0],d[1],d[2]]})}if(w===a.Radial){M.push({sid:o,rtranslate:{track:g.length-1}})}z.setNodeAnimation(i,p.Translate,m);b.set(i,[n.x,n.y,n.z]);I.add(e)}});if(w===a.Linear){M.push({node:O-1,rtranslate:{track:g.length-1}})}O++;if(e.animation.separateViews&&O<=this.getItems().length){V=this._createView(u,i?c().getText("EXPLODETOOL_PREFIX_n",[i,O]):c().getText("EXPLODETOOL_VIEW_n",O),o,I,P,_,E?++E:E)}}.bind(this));if(M.length>0){v.push({name:L,endTime:r,joints:R,nodes:M})}}else{var C=[];A.nodes=[];this.getItems().forEach(function(e){e.getItems().forEach(function(e){var t=e.getNodeRef();var i=t.matrix.elements;var o=[i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10],i[12],i[13],i[14]];C.push({target:t,transform:o});A.nodes.push({sid:s.nodeRefToPersistentId(t),transform:o})})});V.updateNodeInfos(C)}var D=function(){var e={data:{views:o}};x.forEach(function(t){e.data.views.push({id:t.id,sequence:++E})});if(v.length>0){e.data.tree={nodes:f};e.data.animation={sequences:v,tracks:g,joints:y}}return e};return D()};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeToolGizmo", ["../getResourceBundle","../thirdparty/three","./Gizmo","./AxisColours","./ExplodeAxis","./ExplodeDirection","./ExplodeType","../AnimationTrackType","sap/base/assert","sap/base/Log","sap/ui/core/Core"],function(t,e,i,o,r,s,a,n,h,u,d){"use strict";var l=i.extend("sap.ui.vk.tools.ExplodeToolGizmo",{metadata:{library:"sap.ui.vk"}});var c=96;var p=48;var _={PositiveX:0,PositiveY:1,PositiveZ:2,NegativeX:3,NegativeY:4,NegativeZ:5,ResetAdjustment:6,AdjustUp:7,AdjustDown:8,MoveUp:9,MoveDown:10};l.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(t().getText("TOOL_UNITS_MM"),84);this._moveDelta=new THREE.Vector3;this._anchorPosition=new THREE.Vector3;this._axisDirection=new THREE.Vector3;this._axisColor=0;this._magnitude=0;this._viewport=null;this._tool=null;this._groups=[];this._nodes=[];this._groupsMap=new Map;this._sceneGizmo=new THREE.Scene;var e=new THREE.AmbientLight(16777215,.5);e.layers.enableAll();this._sceneGizmo.add(e);var r=new THREE.DirectionalLight(16777215,.5);r.position.set(1,3,2);r.layers.enableAll();this._sceneGizmo.add(r);this._gizmo=new THREE.Group;this._touchAreas=new THREE.Group;this._touchAreas2=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._matViewProj=new THREE.Matrix4;var s=new THREE.MeshLambertMaterial({color:33023,transparent:true,opacity:.2});function a(t,e,i,o){var r=1,a=4,n=24;var h=new THREE.MeshLambertMaterial({color:i});var u=new THREE.CylinderBufferGeometry(r,r,t-n,4);var d=new THREE.Vector3(e.y,e.z,e.x);var l=new THREE.Vector3(e.z,e.x,e.y);var c=e.x<0||e.y<0||e.z<0?(new THREE.Matrix4).makeBasis(l,e,d):(new THREE.Matrix4).makeBasis(d,e,l);c.setPosition(e.clone().multiplyScalar((t-n)*.5));u.applyMatrix4(c);var _=new THREE.Mesh(u,h);_.matrixAutoUpdate=false;_.userData.color=i;var m=new THREE.CylinderBufferGeometry(0,a,n,12,1);c.setPosition(e.clone().multiplyScalar(t-n*.5));m.applyMatrix4(c);var g=new THREE.Mesh(m,h);g.matrixAutoUpdate=false;_.add(g);if(o){var f=new THREE.CylinderGeometry(p*.5,p*.5,t-p+n*.5,12,1);c.setPosition(e.clone().multiplyScalar(p+f.parameters.height*.5));f.applyMatrix4(c);var E=new THREE.CylinderGeometry(p*.5,0,p,12,1);c.setPosition(e.clone().multiplyScalar(p*.5));f.merge(E,c);o.add(new THREE.Mesh(f,s))}return _}this._gizmo.add(a(c,new THREE.Vector3(1,0,0),o.x,this._touchAreas));this._gizmo.add(a(c,new THREE.Vector3(0,1,0),o.y,this._touchAreas));this._gizmo.add(a(c,new THREE.Vector3(0,0,1),o.z,this._touchAreas));this._gizmo.add(a(c,new THREE.Vector3(-1,0,0),o.x,this._touchAreas));this._gizmo.add(a(c,new THREE.Vector3(0,-1,0),o.y,this._touchAreas));this._gizmo.add(a(c,new THREE.Vector3(0,0,-1),o.z,this._touchAreas));this._axisTitles=this._createAxisTitles(undefined,undefined,false,true);this._sceneGizmo.add(this._axisTitles);var n=32;var h=n*1.75;this._groupGizmo=new THREE.Group;this._sceneGizmo.add(this._groupGizmo);var u=new THREE.Mesh(new THREE.IcosahedronBufferGeometry(8,1),new THREE.MeshLambertMaterial);this._groupGizmo.add(u);this._groupGizmo.add(a(n*1.5,new THREE.Vector3(0,1,0),16777215));this._groupGizmo.add(a(n*1.5,new THREE.Vector3(0,-1,0),16777215));var d=16;var l=new THREE.CylinderGeometry(0,6,d,16).applyMatrix4((new THREE.Matrix4).setPosition(0,h+d*.5,0));l.merge(new THREE.CylinderGeometry(0,6,d,16),(new THREE.Matrix4).setPosition(0,h+d*1.5,0));this._groupGizmo.add(new THREE.Mesh((new THREE.BufferGeometry).fromGeometry(l),new THREE.MeshLambertMaterial));this._groupGizmo.add(new THREE.Mesh((new THREE.BufferGeometry).fromGeometry(l.rotateX(Math.PI)),new THREE.MeshLambertMaterial));this._groupGizmo.add(new THREE.Mesh(new THREE.CylinderGeometry(16,16,n*6,12,1),new THREE.MeshBasicMaterial({color:16777215,transparent:true,opacity:.5,side:THREE.BackSide})));function _(t,e,i){var o=new THREE.IcosahedronGeometry(p*.5,1);o.applyMatrix4((new THREE.Matrix4).setPosition(0,(t+e)*.5,0));i.add(new THREE.Mesh(o,s))}_(n*-.5,n*.5,this._touchAreas2);_(n*.5,n*1.5,this._touchAreas2);_(n*-1.5,n*-.5,this._touchAreas2);_(h,h+n,this._touchAreas2);_(-h-n,-h,this._touchAreas2);function m(t){t.traverse(function(t){t.layers.enableAll()})}function g(t){t.children.forEach(function(t,e){t.traverse(function(t){t.layers.enable(Math.min(e,6)+1)})})}g(this._gizmo);g(this._axisTitles);g(this._touchAreas);m(this._groupGizmo);m(this._touchAreas2)};l.prototype.hasDomElement=function(){return false};l.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes.length=0;this._handleGroupsChanged()};l.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._updateEditingForm(false)};l.prototype.getGizmoCount=function(){if(!this._groups.length){return 0}return this._getActiveAxisIndex()>=0&&this._magnitude>0&&this._getSelectedItem()?2:1};l.prototype.getTouchObject=function(t){if(t===0){this._updateGizmoObjectTransformation(this._touchAreas);return this._touchAreas}else{this._updateGroupGizmoTransformation(this._touchAreas2);return this._touchAreas2}};l.prototype._handleGroupsChanged=function(t){this._setMagnitude(0);var e=this._groupsMap;e.clear();this._groups=this._tool.getItems().slice();var i=this._nodes=[];this._groups.forEach(function(t){var o=t.getItems();for(var r=0;r<o.length;r++){var s=o[r].getNodeRef();e.set(s,t);var a=new THREE.Box3;s._expandBoundingBox(a,false,true,true);i.push({node:s,center:a.getCenter(new THREE.Vector3),group:t,local:(new THREE.Vector3).setFromMatrixPosition(s.matrix),origin:(new THREE.Vector3).setFromMatrixPosition(s.matrixWorld),matParentInv:s.parent?(new THREE.Matrix4).getInverse(s.parent.matrixWorld):new THREE.Matrix4})}});this._calculateGroupOffsets();this._setMagnitude(this._tool.getMagnitude())};l.prototype._getSelectedItem=function(){return d.byId(this._tool.getSelectedItem())};l.prototype._handleSelectedItemChanged=function(){var t=this._viewport._viewStateManager;var e=new Set;var i=this._getSelectedItem();if(i){i.getItems().forEach(function(t){e.add(t.getNodeRef())})}var o=[];t.enumerateOutlinedNodes(function(t){if(!e.has(t)){o.push(t)}});t.setOutliningStates(Array.from(e),o,false)};l.prototype.highlightHandle=function(t,e){this._handleIndex=t;this._gizmo.children.forEach(function(e,i){var o=t===i;var r=o?16776960:e.userData.color;e.material.color.setHex(r);this._axisTitles.children[i].material.color.setHex(r)}.bind(this));for(var i=0;i<5;i++){this._groupGizmo.children[i].material.color.setHex(i+6===t?16776960:this._axisColor)}};l.prototype._calculateGroupOffsets=function(){var t=this._axisDirection;if(this._tool.getType()===a.Linear){var e=new THREE.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));var i=new THREE.Vector3;var o=0,r=0;this._groups.forEach(function(t,s){var a=t.getBoundingBox();a.getCenter(t._center);a.getSize(i);o=e.dot(i);if(s>0){r+=o*.5}t._offset=r;t._deltaOffset=o*.5;r+=o*.5});r+=o*.5;var s=r>0?1/r:1;this._groups.forEach(function(t){t._offset=1-t._offset*s;t._deltaOffset*=s})}else{var n=1/this._groups.length;this._groups.forEach(function(t,e){var i=t.getBoundingBox();i.getCenter(t._center);t._offset=1-e*n;t._deltaOffset=n*.5;var o=-1;var r=new THREE.Vector3;var s=t.getItems();for(var a=0;a<s.length;a++){var h=s[a].getNodeRef();var u=new THREE.Box3;h._expandBoundingBox(u,false,true,true);var d=u.getSize(new THREE.Vector3).manhattanLength();if(o<d){o=d;u.getCenter(r)}}})}};l.prototype._getActiveAxisIndex=function(){var t=this._tool.getAxis();var e=this._tool.getDirection();var i=t&&e?[r.X,r.Y,r.Z].indexOf(t):-1;if(i>=0&&e===s.Negative){i+=3}return i};l.prototype._recalculateOffsets=function(){this._setMagnitude(0);this._calculateGroupOffsets();this._setMagnitude(this._tool.getMagnitude());this._viewport.setShouldRenderFrame()};l.prototype._updateAxis=function(){var t=this._getActiveAxisIndex();if(t>=0){this._updateGizmoObjectTransformation(this._gizmo);this._axisDirection.setFromMatrixColumn(this._gizmo.matrixWorld,t%3).normalize().multiplyScalar(t<3?1:-1);this._anchorPosition.setFromMatrixPosition(this._gizmo.matrixWorld);this._axisColor=this._gizmo.children[t].userData.color;for(var e=0;e<5;e++){this._groupGizmo.children[e].material.color.setHex(this._axisColor)}this._recalculateOffsets()}else{this._setMagnitude(0);this._viewport.setShouldRenderFrame()}};l.prototype._moveSelectedGroup=function(t){var e=this._tool;var i=this._getSelectedItem();var o=e.getItems();var r=o.indexOf(i);if(r>=0&&r+t>=0&&r+t<o.length){e.removeItem(i);e.insertItem(i,r+t);e.fireItemSequenceChangePressed({item:i,moveUp:t<0})}};l.prototype._setMagnitudeAdjustmentMultiplier=function(t,e){var i=this._getSelectedItem();if(i){i.setMagnitudeAdjustmentMultiplier(t);this._updatePositions();this._tool[e?"fireItemPositionAdjusted":"fireItemPositionAdjusting"]({item:i,magnitudeAdjustmentMultiplier:i.getMagnitudeAdjustmentMultiplier()})}};l.prototype._beginGesture=function(){this._moveDelta.setScalar(0);this._beginMagnitude=this._magnitude;var t=this._tool;switch(this._handleIndex){case _.ResetAdjustment:this._setMagnitudeAdjustmentMultiplier(0,true);break;case _.AdjustUp:case _.AdjustDown:var e=this._getSelectedItem();this._magnitudeAdjustmentMultiplier=e?e.getMagnitudeAdjustmentMultiplier():0;break;case _.MoveUp:this._moveSelectedGroup(-1);break;case _.MoveDown:this._moveSelectedGroup(+1);break;default:if(this._handleIndex<6&&(!t.getAxis()||!t.getDirection())){t.setAxis([r.X,r.Y,r.Z][this._handleIndex%3]);t.setDirection(this._handleIndex<3?s.Positive:s.Negative);t.fireAxisSelected({axis:t.getAxis(),direction:t.getDirection()})}break}};l.prototype._setMagnitude=function(t){this._magnitude=t;this._groups.forEach(function(e){e._magnitude=t});this._updatePositions()};l.prototype._setOffset=function(t){var e=this._tool;if(this._handleIndex<6){e.setMagnitude(this._beginMagnitude+t);e.fireMagnitudeChanging({type:e.getType(),axis:e.getAxis(),direction:e.getDirection(),magnitude:e.getMagnitude()})}else if(this._handleIndex===_.AdjustUp||this._handleIndex===_.AdjustDown){var i=this._magnitude>0?this._getSelectedItem():null;if(i){this._setMagnitudeAdjustmentMultiplier(this._magnitudeAdjustmentMultiplier+t/(this._magnitude*i._deltaOffset))}}};l.prototype._updatePositions=function(){var t=this._tool.getType()===a.Linear;var e=new THREE.Vector3;var i=new THREE.Vector3;var o=new THREE.Vector3;this._nodes.forEach(function(r){var s=r.node;if(t){i.copy(this._axisDirection)}else{i.copy(r.center).sub(this._anchorPosition);o.copy(this._axisDirection).multiplyScalar(i.dot(o));i.sub(o).normalize()}i.multiplyScalar(r.group.getMagnitude());e.copy(r.origin).add(i);s.matrixWorld.setPosition(e);s.matrix.multiplyMatrices(r.matParentInv,s.matrixWorld);s.position.setFromMatrixPosition(s.matrix);s.updateMatrixWorld(true);if(s.parent!==this._getEffectiveParent(s)){this._viewport._viewStateManager._setJointNodeOffsets(s,n.Translate)}}.bind(this));this._viewport.setShouldRenderFrame()};l.prototype._endGesture=function(){var t=this._tool;if(this._handleIndex<6){t.fireMagnitudeChanged({type:t.getType(),axis:t.getAxis(),direction:t.getDirection(),magnitude:t.getMagnitude()})}else if(this._handleIndex===_.AdjustUp||this._handleIndex===_.AdjustDown){var e=this._magnitude>0?this._getSelectedItem():null;if(e){t.fireItemPositionAdjusted({item:e,magnitudeAdjustmentMultiplier:e.getMagnitudeAdjustmentMultiplier()})}}};l.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};l.prototype._updateGizmoObjectTransformation=function(t){t.matrix.fromArray(this._tool.getAnchor());t.matrix.decompose(t.position,t.quaternion,t.scale);var e=this._getGizmoScale(t.position);t.scale.setScalar(e);t.matrixAutoUpdate=true;t.updateMatrixWorld(true);return e};l.prototype._updateGroupGizmoTransformation=function(t){var e=this._getActiveAxisIndex();var i=e>=0&&this._magnitude>0?this._getSelectedItem():null;t.visible=!!i;if(i){if(this._tool.getType()===a.Linear){t.position.copy(this._axisDirection).multiplyScalar(i.getMagnitude()).add(i._center)}else{t.position.copy(i._center)}t.quaternion.setFromUnitVectors(new THREE.Vector3(0,1,0),this._axisDirection);t.scale.setScalar(this._getGizmoScale(t.position));t.updateMatrix();t.updateMatrixWorld()}};l.prototype._updateGizmoTransformation=function(t,e){this._updateGizmoObjectTransformation(this._gizmo)};l.prototype._getCameraLayersMask=function(){var t=0|0;var e=this._getActiveAxisIndex();t=1<<e+1;if(e>=0&&this._magnitude>0&&this._getSelectedItem()){t|=1<<7}return t};l.prototype.render=function(){h(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._tool&&this._groups.length>0){var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);t.clearDepth();var i=this._updateGizmoObjectTransformation(this._gizmo);this._updateAxisTitles(this._axisTitles,this._gizmo,e,c+18,i);this._updateGroupGizmoTransformation(this._groupGizmo);var o=e.layers.mask;e.layers.mask=this._getCameraLayersMask();t.render(this._sceneGizmo,e);e.layers.mask=o}};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeToolHandler", ["sap/ui/base/EventProvider","./ExplodeToolGizmo","../thirdparty/three"],function(t,e,i){"use strict";var s=t.extend("sap.ui.vk.tools.ExplodeToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=13;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._handleIndex=-1;this._handleAxis=new THREE.Vector3;this._gizmoOrigin=new THREE.Vector3;this._mouse=new THREE.Vector2}});s.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());this._rayCaster.far=Infinity};s.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){this._rayCaster.layers.mask=this._gizmo._getCameraLayersMask();for(var s=0,r=this._gizmo.getGizmoCount();s<r;s++){var n=this._gizmo.getTouchObject(s);var o=this._rayCaster.intersectObject(n,true);if(o.length>0){this._handleIndex=n.children.indexOf(o[0].object);if(this._handleIndex>=0){this._rayCaster.far=o[0].distance;this._gizmoOrigin.setFromMatrixPosition(n.matrixWorld);if(s===0){this._handleAxis.setFromMatrixColumn(n.matrixWorld,this._handleIndex%3).normalize().multiplyScalar(this._handleIndex<3?1:-1)}else{this._handleAxis.copy(this._gizmo._axisDirection);this._handleIndex+=6}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};s.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};s.prototype.click=function(t){if(this._inside(t)&&!this._gesture){if(this._handleIndex<0){var e=this.getViewport().hitTest(t.x-this._rect.x,t.y-this._rect.y);if(!e){this._tool.setSelectedItem(null);return}var i=e.object;var s=this._tool.getGizmo()._groupsMap;var r=null;while(i){r=s.get(i);if(r){this._tool.setSelectedItem(r);t.handled=true;break}i=i.parent}}else{t.handled=this._handleIndex>=0}}};var r=new THREE.Vector3;s.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();r.copy(t.origin).sub(this._gizmoOrigin);return e.dot(r)/e.dot(this._handleAxis)};s.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;r.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(r)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(r)};s.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){this._gesture=true;t.handled=true;this._gizmo._beginGesture(this._handleIndex);this._dragOrigin=this._getAxisOffset()}}};s.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._getAxisOffset()-this._dragOrigin;if(isFinite(e)){this._gizmo._setOffset(e)}}};s.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo._endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};s.prototype.contextMenu=function(t){};s.prototype.getViewport=function(){return this._tool._viewport};s.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};s.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeType", [],function(){"use strict";var a={Linear:"Linear",Radial:"Radial"};return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/Gizmo", ["../library","sap/m/library","sap/m/Input","sap/m/Label","sap/ui/core/library","sap/ui/core/Control","./CoordinateSystem","./AxisColours","./ToolNodeSet","../thirdparty/three","./GizmoPlacementMode","../AnimationTrackType"],function(t,e,i,a,n,o,r,s,l,p,u,h){"use strict";var c=e.InputType;var f=o.extend("sap.ui.vk.tools.Gizmo",{metadata:{library:"sap.ui.vk"},renderer:{render:function(t,e){}}});f.prototype.hasDomElement=function(){return true};f.prototype._drawText=function(t,e,i,a){var n=window.devicePixelRatio;var o=t.width;var r=t.height;var s=o*.5;var l=r*.5;var p=t.getContext("2d");p.clearRect(0,0,o,r);p.font="Bold "+i*n+"px Arial";p.textAlign="center";p.textBaseline="middle";p.fillStyle="#000";p.globalAlpha=.5;p.filter="blur(3px)";p.fillText(e,s+1,l+1);p.fillStyle="#fff";p.globalAlpha=1;p.filter="blur(0px)";p.fillText(e,s,l);if(a){p.beginPath();p.arc(s,l,s-n,0,2*Math.PI,false);p.closePath();p.lineWidth=n*2;p.strokeStyle="#fff";p.stroke()}};f.prototype._createTextMesh=function(t,e,i,a,n,o){var r=window.devicePixelRatio;var s=document.createElement("canvas");s.width=e*r;s.height=i*r;this._drawText(s,t,a,o);var l=new THREE.Texture(s);l.needsUpdate=true;var p=new THREE.MeshBasicMaterial({map:l,color:n,transparent:true,alphaTest:.05,premultipliedAlpha:true,side:THREE.DoubleSide});var u=new THREE.Mesh(new THREE.PlaneGeometry(e,i),p);u.userData.color=n;return u};f.prototype._createAxisTitles=function(t,e,i,a){t=t||32;e=e||20;var n=new THREE.Group;n.add(this._createTextMesh("X",t,t,e,s.x,i));n.add(this._createTextMesh("Y",t,t,e,s.y,i));n.add(this._createTextMesh("Z",t,t,e,s.z,i));if(a){n.add(this._createTextMesh("-X",t,t,e,s.x,i));n.add(this._createTextMesh("-Y",t,t,e,s.y,i));n.add(this._createTextMesh("-Z",t,t,e,s.z,i))}return n};f.prototype._extractBasis=function(t){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];t.extractBasis(e[0],e[1],e[2]);e[0].normalize();e[1].normalize();e[2].normalize();return e};f.prototype._updateAxisTitles=function(t,e,i,a,n){var o=this._extractBasis(e.matrixWorld);t.children.forEach(function(t,e){var n=a.constructor===THREE.Vector3?a.getComponent(e%3):a;t.position.copy(o[e%3]).multiplyScalar(n*(e<3?1:-1));t.quaternion.copy(i.quaternion)});t.position.copy(e.position);t.scale.setScalar(n)};f.prototype._updateSelection=function(t){if(t===null){return false}var e=[];if(this._tool){if(this._tool.getNodeSet()===l.Highlight){t.enumerateSelection(function(t){e.push({node:t})})}else{t.enumerateOutlinedNodes(function(t){e.push({node:t})})}}if(this._nodes.length===e.length&&this._nodes.every(function(t,i){return e[i].node===t.node})){return false}this._cleanTempData();this._nodes=e;e.forEach(function(t){t.ignore=false;var i=t.node.parent;while(i&&!t.ignore){for(var a=0,n=e.length;a<n;a++){if(e[a].node===i){t.ignore=true;break}}i=i.parent}this._getOffsetForRestTransformation(t.node)}.bind(this));return true};f.prototype.setPlacementMode=function(t){this._placementMode=t};f.prototype._getAnchorPoint=function(){return this._viewport?this._viewport._anchorPoint:null};f.prototype._getSelectionCenter=function(t){if(this._nodes.length===1){var e=this._nodes[0].node;t.setFromMatrixPosition(e.matrixWorld);var i;if(this._nodeUserDataMap){i=this._nodeUserDataMap.get(e)}if(this._placementMode===u.Rest&&i&&i.offsetWTranslation){t.x+=i.offsetWTranslation[0];t.y+=i.offsetWTranslation[1];t.z+=i.offsetWTranslation[2]}}else{t.setScalar(0);if(this._nodes.length>0){var a=new THREE.Vector3;this._nodes.forEach(function(e){var i=e.node;if(i.userData.boundingBox){i.userData.boundingBox.getCenter(a);t.add(a.applyMatrix4(i.matrixWorld))}else{t.add(a.setFromMatrixPosition(i.matrixWorld))}});t.multiplyScalar(1/this._nodes.length)}}};f.prototype._getGizmoScale=function(t){var e=this._viewport.getRenderer();var i=this._viewport.getCamera().getCameraRef();var a=new THREE.Vector4;a.copy(t).applyMatrix4(this._matViewProj);return a.w*2/(e.getSize(new THREE.Vector2).x*i.projectionMatrix.elements[0])};f.prototype._getEffectiveParent=function(t){if(this._viewport._viewStateManager){var e=this._viewport._viewStateManager.getJoints();if(e){for(var i=0;i<e.length;i++){var a=e[i];if(!a.node||!a.parent){continue}if(a.node===t){return a.parent}}}}return t.parent};f.prototype._cleanTempData=function(){this._nodes.forEach(function(t){var e=t.node;if(e.userData){delete e.userData.skipUpdateJointNode}});if(this._nodeUserDataMap){this._nodeUserDataMap.clear()}this._sequence=null};f.prototype._prepareForCreatingKey=function(t){this._playback=t};f.prototype._getOffsetForRestTransformation=function(t){if(this._viewport._viewStateManager){if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map}var e=this._nodeUserDataMap.get(t);if(!e){e={};this._nodeUserDataMap.set(t,e)}var i=this._viewport._viewStateManager.getTransformation(t);var a=this._viewport._viewStateManager.getRestTransformation(t);var n=this._viewport._viewStateManager.getRestTransformationWorld(t);var o=this._viewport._viewStateManager.getTransformationWorld(t);if(!a||!n){return}var r=new THREE.Vector3(a.translation[0],a.translation[1],a.translation[2]);var s=new THREE.Vector3(a.scale[0],a.scale[1],a.scale[2]);e.quatRest=new THREE.Quaternion(a.quaternion[0],a.quaternion[1],a.quaternion[2],a.quaternion[3]);e.matRest=(new THREE.Matrix4).compose(r,e.quatRest,s);e.matRestInv=(new THREE.Matrix4).getInverse(e.matRest);e.initialTranslation=i.translation.slice();e.initialScale=i.scale.slice();e.initialQuaternion=new THREE.Quaternion(i.quaternion[0],i.quaternion[1],i.quaternion[2],i.quaternion[3]);e.matInitial=t.matrix.clone();e.matInitialInv=(new THREE.Matrix4).getInverse(t.matrix);e.quatInitialDiff=e.initialQuaternion.clone().multiply(e.quatRest.clone().inverse());e.quatInitialDiffInv=e.quatInitialDiff.clone().inverse();e.matInitialDiff=t.matrix.clone().multiply(e.matRestInv);e.offsetWTranslation=[n.translation[0]-o.translation[0],n.translation[1]-o.translation[1],n.translation[2]-o.translation[2]];var l=new THREE.Vector3;var p=new THREE.Box3;p.expandByObject(t);p.getCenter(l);e.offsetWTranslationCenter=[n.translation[0]+l.x-2*o.translation[0],n.translation[1]+l.y-2*o.translation[1],n.translation[2]+l.z-2*o.translation[2]];var u=[0,0,0];var c=this._viewport._viewStateManager.getAnimationPlayer();if(c){var f=c.getAnimatedProperty(t,h.Rotate);if(f.offsetToPrevious){u=f.offsetToPrevious}}e.euler=new THREE.Euler(0,0,0);e.startEuler=new THREE.Euler(0,0,0);e.eulerInParentCoors=new THREE.Euler(u[0],u[1],u[2]);e.startEulerInParentCoors=new THREE.Euler(u[0],u[1],u[2])}};f.prototype._updateGizmoObjectTransformation=function(t,e,i){var a=this._viewport.getCamera().getCameraRef();var n=this._getAnchorPoint();var o,s,l;if(n&&this._coordinateSystem===r.Custom){t.position.copy(n.position);t.quaternion.copy(n.quaternion)}else if(this._coordinateSystem===r.Local||this._coordinateSystem===r.Parent){l=this._nodes[e].node;var p=this._getEffectiveParent(l);if(this._coordinateSystem===r.Parent&&p){s=p.matrixWorld}o=l.matrixWorld.clone();if(s){s.decompose(t.position,t.quaternion,t.scale);t.position.setFromMatrixPosition(o)}else{o.decompose(t.position,t.quaternion,t.scale)}var h;if(this._nodeUserDataMap){h=this._nodeUserDataMap.get(l)}if(this._placementMode===u.Rest&&h&&h.offsetWTranslation){if(i){t.position.x+=h.offsetWTranslationCenter[0];t.position.y+=h.offsetWTranslationCenter[1];t.position.z+=h.offsetWTranslationCenter[2]}else{t.position.x+=h.offsetWTranslation[0];t.position.y+=h.offsetWTranslation[1];t.position.z+=h.offsetWTranslation[2]}o.setPosition(t.position)}}else if(this._nodes.length>0){this._getSelectionCenter(t.position);if(this._coordinateSystem===r.Screen){t.quaternion.copy(a.quaternion)}else{t.quaternion.set(0,0,0,1)}}var c=this._getGizmoScale(t.position);t.scale.setScalar(this._gizmoSize*c);if(o){var f=this._extractBasis(s?s:o);t.matrix.makeBasis(f[0],f[1],f[2]);t.matrix.scale(t.scale);t.matrix.copyPosition(o);t.matrixAutoUpdate=false}else{t.matrixAutoUpdate=true}t.updateMatrixWorld(true);return c};f.prototype._expandBoundingBox=function(t,e,i){var a=this.getGizmoCount();if(a>0){this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var n=0;n<a;n++){this._updateGizmoTransformation(n,e);this._sceneGizmo._expandBoundingBox(t,i,false)}}};f.prototype._createEditingForm=function(t,e){this._label=new sap.m.Label({}).addStyleClass("sapUiVkTransformationToolEditLabel");this._units=new sap.m.Label({text:t}).addStyleClass("sapUiVkTransformationToolEditUnits");this._input=new i({width:e+"px",type:c.Number,maxLength:10,textAlign:n.TextAlign.Right,change:function(t){this.setValue(t.getParameter("value"))}.bind(this)});this._editingForm=new sap.m.HBox({items:[this._label,this._input,this._units]}).addStyleClass("sapUiSizeCompact");this._editingForm.onkeydown=this._editingForm.ontap=this._editingForm.ontouchstart=function(t){t.setMarked()}};f.prototype._getValueLocaleOptions=function(){return{useGrouping:false}};f.prototype._updateEditingForm=function(t,e,i){var a=this.getDomRef();if(a){if(t&&this._tool&&this._tool.getShowEditingUI()){this._label.setText(i||["X","Y","Z"][e]);this._label.rerender();var n=this._label.getDomRef();if(n){n.style.color=new THREE.Color(s[["x","y","z"][e]]).getStyle()}this._input.setValue(this.getValue().toLocaleString("fullwide",this._getValueLocaleOptions()));var o=this._getEditingFormPosition();var r=this._gizmo.position.clone().applyMatrix4(this._matViewProj).sub(o);var l=this._viewport.getDomRef().getBoundingClientRect();var p=a.getBoundingClientRect();var u=r.x>-1e-4;var h=u?p.width:-p.width;var c=p.height*.5;var f=THREE.Math.clamp(l.width*(o.x*.5+.5)+(u?-20:20),Math.max(h,0),l.width+Math.min(h,0));var d=THREE.Math.clamp(l.height*(o.y*-.5+.5),c,l.height-c);a.style.left=Math.round(f)+"px";a.style.top=Math.round(d)+"px";a.style.transform="translate("+(u?"-100%":"0%")+", -50%)";a.style.display="block"}else{a.style.display="none"}}};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/GizmoPlacementMode", [],function(){"use strict";var e={Default:"Default",ObjectCenter:"ObjectCenter",OnScreen:"OnScreen",Rest:"Rest"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HighlightMeasurementTool", ["./HighlightMeasurementToolHandler","./Tool"],function(e,t){"use strict";var i=t.extend("sap.ui.vk.tools.HighlightMeasurementTool",{metadata:{library:"sap.ui.vk"}});var s=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(s.init){s.init.call(this)}this._viewport=null;this._handler=new e(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};i.prototype.setActive=function(e,t,i){s.setActive.call(this,e,t,i);if(this._viewport){if(e){this._selection=[];this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitHighlightDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitHighlightDistanceCursor");this.clearSelection();this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};i.prototype.highlightMeasurement=function(e){var t=this._highlightedMeasurementDomRef;if(e===t){return null}if(t!=null&&this._selection.indexOf(t)<0){this._viewport.getMeasurementSurface().highlightMeasurement(t._measurement,false)}if(e!=null&&this._selection.indexOf(e)<0){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}this._highlightedMeasurementDomRef=e;return this};i.prototype.selectMeasurement=function(e){var t=this._selection.indexOf(e);if(t<0){this._selection.push(e);if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}}else{this._selection.splice(t,1);if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,false)}}return this};i.prototype.clearSelection=function(){this._selection.forEach(function(e){if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,false)}},this);this._selection.length=0};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HighlightMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.HighlightMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var i=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(i.hitTest(o,n),i)}else{e.highlightMeasurement(null,i)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var o=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(i,o);if(n){t.handled=true;e.selectMeasurement(n)}else{e.clearSelection()}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var i=this._getOffset(r);var o=this._rect={x:i.x,y:i.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=o.x&&t.x<=o.x+o.w&&t.y>=o.y&&t.y<=o.y+o.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestClickType", [],function(){"use strict";var e={Single:"Single",Double:"Double",Context:"Context"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestIdMode", [],function(){"use strict";var e={ThreeJS:"ThreeJS",VEsID:"VEsID",Callback:"Callback"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestTool", ["./Tool","./HitTestToolHandler","./HitTestIdMode"],function(e,t,i){"use strict";var r=e.extend("sap.ui.vk.tools.HitTestTool",{metadata:{library:"sap.ui.vk",properties:{IdMode:{type:"sap.ui.vk.tools.HitTestIdMode",defaultValue:i.ThreeJS}},events:{hit:{parameters:{id:"any",object:"any",point:"any",clickType:"sap.ui.vk.tools.HitTestClickType"}}}},constructor:function(i,s){if(r._instance){return r._instance}e.apply(this,arguments);this.setToolid("63150593-75f6-c330-2a7a-c1f85d36b2b9");this._viewport=null;this._handler=new t(this);this._loco=null;r._instance=this}});r.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"])};r.prototype.setActive=function(t,i,r){e.prototype.setActive.call(this,t,i,r);if(this._viewport){if(t){this._prepare()}else{this._removeLocoHandler()}}return this};r.prototype._prepare=function(){if(!this._addLocoHandler()){return false}var e=false;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;e=true}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&(this._viewport._scene&&this._viewport._scene.getSceneRef())){e=true}return e};r.prototype.queueCommand=function(e){if(this._prepare()){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(e,this._dvlRendererId)}}return this};r.prototype.hitTest=function(e,t,r,s,o){if(this._prepare()){var n=null;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return null}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(!r||!s){n=null}else if(this._viewport._renderer){var a=this._viewport._renderer.domElement;var p=new THREE.Vector2((e-a.offsetLeft)/a.clientWidth*2-1,(a.offsetTop-t)/a.clientHeight*2+1);var l=new THREE.Raycaster;l.setFromCamera(p,s.getCameraRef());var d=l.intersectObjects(r.getSceneRef().children,true);if(d&&d.length){for(var h in d){var c=d[h];var v=c.object;var u=v.parent;while(u){if(u.userData.closed){v=u}u=u.parent}while(v.parent&&v.userData.skipIt){v=v.parent}if(v.visible&&!v.isBillboard&&!v.isDetailView){c.object=v;n=c;break}}}}}var f=null;if(n){var _;switch(this.getIdMode()){case i.VEsID:_=this._viewport._scene.nodeRefToPersistentId(n.object);break;case i.ThreeJS:_=n.object.id;break;default:_=n.object.id;break}f={id:_,object:n.object,point:n.point,clickType:o};this.fireHit(f)}return f}};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestToolHandler", ["sap/ui/base/EventProvider","./HitTestClickType"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.HitTestToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._gesture=false;this._nomenu=false}});i.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype.beginGesture=function(t){t.handled=false};i.prototype.move=function(t){t.handled=false};i.prototype.endGesture=function(t){t.handled=false};i.prototype._executeHittest=function(t,e){if(this._inside(t)&&!this._gesture){this._gesture=false;var i=t.x-this._rect.x,o=t.y-this._rect.y;this._gizmo=this._tool.getGizmo();if(this._gizmo){this._gizmo.show(this._tool._viewport);this._gizmo.moveGizmo(i,o)}var s=this._tool._viewport.getScene();var r=this._tool._viewport.getCamera();this._tool.hitTest(i,o,s,r,e);if(this._gizmo){this._gizmo.hide()}}};i.prototype.click=function(t){this._executeHittest(t,e.Single);t.handled=true};i.prototype.doubleClick=function(t){this._executeHittest(t,e.Double);t.handled=false};i.prototype.contextMenu=function(t){this._executeHittest(t,e.Context);t.handled=false};i.prototype.getViewport=function(){return this._tool._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolGizmo", ["sap/ui/core/Core","sap/base/Log","../measurements/Edge","../measurements/Face","../measurements/Vertex","../measurements/MeshAnalyzer","../measurements/MeshAnalyzer2D","../measurements/Settings","./MeasurementToolState","./Gizmo"],function(e,t,r,a,s,i,n,u,o,h){"use strict";var l=h.extend("sap.ui.vk.tools.MeasurementToolGizmo",{metadata:{library:"sap.ui.vk"}});var _=l.getMetadata().getParent().getClass().prototype;l.prototype.hasDomElement=function(){return false};l.prototype.init=function(){if(_.init){_.init.call(this)}this._viewport=null;this._surface=null;this._tool=null;this._vsm=null;this._settings=null;this._state=o.Off;this._hoverPoint=null;this._currentFeature=null;this._currentFeatureIndex=0;this._firstFeature=null;this._secondFeature=null;this._vertexFeatures=[new s];this._edgeFeatures=[new r];this._faceFeatures=[new a];this._currentMeasurement=null;this._meshAnalyzerMap=new Map;this._is2D=false};l.prototype.setCurrentFeatureIndex=function(e){if(e<1&&this._firstFeature){t.error("setCurrentFeatureIndex: first feature not null with index="+e)}if(e<2&&this._secondFeature){t.error("setCurrentFeatureIndex: second feature not null with index="+e)}var i=e-this._currentFeatureIndex;if(i===1){this._currentFeatureIndex++;this._vertexFeatures.push(new s);this._edgeFeatures.push(new r);this._faceFeatures.push(new a)}else if(i===-1){this._currentFeatureIndex--;this._vertexFeatures.pop();this._edgeFeatures.pop();this._faceFeatures.pop()}else if(e===0){this._currentFeatureIndex=0;this._vertexFeatures.splice(1);this._edgeFeatures.splice(1);this._faceFeatures.splice(1)}else if(i!==0){t.error("setCurrentFeatureIndex: "+this._currentFeatureIndex+" => "+e)}};l.prototype._createMeshAnalyzer=function(e){var t=null;var r=0;var a=0;var s=function(e){if(e.geometry&&e.geometry.isBufferGeometry){var a=e.geometry.getAttribute("position");var i=e.geometry.getIndex();if(a&&i){if(t){for(var n=0;n<i.count;n+=3){var u=(new THREE.Vector3).fromArray(a.array,i.array[n]*3);var o=(new THREE.Vector3).fromArray(a.array,i.array[n+1]*3);var h=(new THREE.Vector3).fromArray(a.array,i.array[n+2]*3);u.applyMatrix4(e.matrixWorld);o.applyMatrix4(e.matrixWorld);h.applyMatrix4(e.matrixWorld);t.addTriangle([u.x,u.y,u.z],[o.x,o.y,o.z],[h.x,h.y,h.z])}}else{r+=i.count}}}e.children.forEach(s)};for(var n=0;n<2;++n){s(e);if(n===0){t=new i(r/3,a)}}t.finishMeshBuilding();return t};l.prototype._createMeshAnalyzer2D=function(e){return new n(e,this._viewport.getCamera()._getViewBox())};l.prototype._getMeshAnalyzer=function(e){var t=this._meshAnalyzerMap.get(e);if(t!=null){return t}var r=this._is2D?this._createMeshAnalyzer2D(e):this._createMeshAnalyzer(e);this._meshAnalyzerMap.set(e,r);return r};l.prototype.show=function(t,r){this._viewport=t;this._surface=t.getMeasurementSurface();this._tool=r;this._vsm=e.byId(t.getViewStateManager());this._is2D=t.getScene().getMetadata().getName()==="sap.ui.vk.svg.Scene";this._settings=u.load();this._state=o.SearchingFirstFeature;this.setCurrentFeatureIndex(0)};l.prototype.hide=function(){if(this._surface!=null){var e=this._surface;for(var t=0,r=this._faceFeatures.length;t<r;++t){e.removeFeature(this._faceFeatures[t])}for(var a=0,s=this._edgeFeatures.length;a<s;++a){e.removeFeature(this._edgeFeatures[a])}for(var i=0,n=this._vertexFeatures.length;i<n;++i){e.removeFeature(this._vertexFeatures[i])}if(this._currentMeasurement!=null){e.removeMeasurement(this._currentMeasurement);this._currentMeasurement=null}}var u=this._vsm;var h=this._hoverPoint&&this._hoverPoint.nodeRef;if(h!=null&&u!=null){u.setOutliningStates([],[h],false,true)}this._viewport=null;this._surface=null;this._tool=null;this._vsm=null;this._settings=null;this._state=o.Off;this._currentFeature=null;this._firstFeature=null;this._secondFeature=null;this.setCurrentFeatureIndex(0);this._hoverPoint=null};l.prototype._computeSphereRadius=function(e,t){var r=this._is2D?5:3;if(this._is2D){var a=t._camera._worldToScreen(e[0],e[1]);var s=t._camera._screenToWorld(a.x+r,a.y);r=Math.abs(e[0]-s.x)}else{var i=t.getDomRef().getBoundingClientRect();var n=i.width*.5;var u=i.height*.5;var o=t.getCamera().getCameraRef();var h=(new THREE.Vector3).fromArray(e);var l=h.clone();l.project(o);var _=r/n;var c=r/u;r=0;for(var f=0;f<4;++f){var v=f%2?-1:1;var p=new THREE.Vector3(l.x+v*(f<2?_:0),l.y+v*(f>=2?c:0),l.z);p.unproject(o);var m=p.distanceTo(h);if(m>r){r=m}}}return r};l.prototype._replaceCurrentFeature=function(e,t,r){var a=false;if(e!==this._currentFeature){this._surface.removeFeature(this._currentFeature);this._surface.addFeature(e);this._currentFeature=e;a=true}else if(r!==e.getContext()||t!==e.getFeatureId()){a=true}if(a){e.setContext(r);e.setFeatureId(t)}return a};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.MeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(e){t.call(this);this._priority=0;this._tool=e;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype._processMouseEvent=function(t,e){var o=null;if(t&&this._inside(e)&&this.getViewport().getScene()){var i=e.x-this._rect.x;var n=e.y-this._rect.y;var r=this._tool._viewport;if(t.is2D()){var s=r.hitTest(i,n,true,true);var l=r._camera._screenToWorld(i,n);o={screenPoint:[i,n],worldPoint:[l.x,l.y,0],nodeRef:s,shiftKey:e.event.shiftKey}}else{var u=r.hitTest(i,n);if(u!=null&&u.object!=null){o={screenPoint:[i,n],worldPoint:u.point.toArray(),nodeRef:u.object,shiftKey:e.event.shiftKey}}else{o={screenPoint:[i,n],worldPoint:null,nodeRef:null,shiftKey:e.event.shiftKey}}}}return o};e.prototype.hover=function(t){var e=this._tool.getGizmo();e.setHoverPoint(this._processMouseEvent(e,t))};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){t.handled=true;var e=this._tool.getGizmo();e.fixPoint(this._processMouseEvent(e,t))};e.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&e.doubleClick&&e.doubleClick(this._processMouseEvent(e,t))){t.handled=true}};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool.getGizmo();if(e){e.escapePressed();t.handled=true}}};e.prototype.getViewport=function(){return this._tool._viewport};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);var n=this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=n.x&&t.x<=n.x+n.w&&t.y>=n.y&&t.y<=n.y+n.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolState", [],function(){"use strict";var e={Off:"Off",SearchingFirstFeature:"SearchingFirstFeature",SearchingSecondFeature:"SearchingSecondFeature",SearchingThirdFeature:"SearchingThirdFeature",DefiningAngle:"DefiningAngle"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveTool", ["./Tool","./CoordinateSystem","./GizmoPlacementMode","./MoveToolHandler","./MoveToolGizmo","./Detector","./ToolNodeSet"],function(e,t,o,i,s,r,n){"use strict";var a=e.extend("sap.ui.vk.tools.MoveTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:t.World},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:o.Default},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:n.Highlight}},events:{moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(t,o){e.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null;this._detector=new r}});a.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new s)};a.prototype.setActive=function(t,o,i){e.prototype.setActive.call(this,t,o,i);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setPlacementMode(this.getPlacementMode());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};a.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};a.prototype.setPlacementMode=function(e){var t=this.getPlacementMode();if(t!==e){this.setProperty("placementMode",e,true);this.getGizmo().setPlacementMode(e);if(this._viewport){this._viewport.setShouldRenderFrame()}this.firePlacementModeChanged({placementMode:e})}return this};a.prototype.setCoordinateSystem=function(e){var t=this.getCoordinateSystem();if(t!==e){this.setProperty("coordinateSystem",e,true);this.getGizmo().setCoordinateSystem(e);if(this._viewport){this._viewport.setShouldRenderFrame()}this.fireCoordinateSystemChanged({coordinateSystem:e})}return this};a.prototype.setShowEditingUI=function(e){this.setProperty("showEditingUI",e,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.setEnableSnapping=function(e){this.setProperty("enableSnapping",e,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.setNodeSet=function(e){this.setProperty("nodeSet",e,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};a.prototype.getDetector=function(){return this._detector};a.prototype.move=function(e,t,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}if(this._gizmo){this._gizmo.move(e,t,o)}if(s){this.setCoordinateSystem(s)}if(this._gizmo){this._gizmo.endGesture()}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.prepareForCreatingTranslateKey=function(e){if(this._gizmo){this._gizmo._prepareForCreatingKey(e);return this._gizmo._getNodesProperties()}return null};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveToolGizmo", ["../getResourceBundle","../thirdparty/three","./Gizmo","./MoveToolGizmoRenderer","./CoordinateSystem","./GizmoPlacementMode","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(e,t,i,r,o,a,n,s,l,d){"use strict";var h=i.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk"}});h.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(e().getText("TOOL_UNITS_MM"),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3;this._moveDelta=new THREE.Vector3;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene;var t=new THREE.DirectionalLight(16777215,.5);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new THREE.AmbientLight(16777215,.5));this._gizmo=new THREE.Group;this._touchAreas=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._coordinateSystem=o.World;this._placementMode=a.Default;this._nodes=[];this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;function r(e,t,i){var r=96,o=1,a=24,n=4,s=48;e.multiplyScalar(1/r);var l=new THREE.MeshLambertMaterial({color:t,transparent:true});var d=new THREE.CylinderBufferGeometry(o,o,r-a,4);var h=(new THREE.Matrix4).makeBasis(new THREE.Vector3(e.y,e.z,e.x),e,new THREE.Vector3(e.z,e.x,e.y));h.setPosition(e.clone().multiplyScalar((r-a)*.5));d.applyMatrix4(h);var c=new THREE.Mesh(d,l);c.matrixAutoUpdate=false;c.userData.color=t;var m=new THREE.CylinderBufferGeometry(0,n,a,12,1);h.setPosition(e.clone().multiplyScalar(r-a*.5));m.applyMatrix4(h);var u=new THREE.Mesh(m,l);u.matrixAutoUpdate=false;c.add(u);var p=new THREE.CylinderGeometry(s*.5,s*.5,s,12,1);p.applyMatrix4(h);var f=new THREE.CylinderGeometry(s*.5,s*.2,s,12,1);h.setPosition(e.clone().multiplyScalar(r*.5));p.merge(f,h);i.add(new THREE.Mesh(p,l));return c}function s(e,t,i){var r=new Float32Array(9);r[e]=r[t+6]=1;r[e+3]=r[t+3]=.5;var o=(new THREE.Vector3).setComponent(e,.333);var a=(new THREE.Vector3).setComponent(t,.333);var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3,o,a,o.clone().add(a));n.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var s=new THREE.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:THREE.DoubleSide});var l=new THREE.Mesh(n,s);l.matrixAutoUpdate=false;l.userData.colors=r;var d=new THREE.BufferGeometry;var h=new Float32Array(9);h[e]=h[e+3]=h[t+3]=h[t+6]=.333;d.setAttribute("position",new THREE.Float32BufferAttribute(h,3));d.setAttribute("color",new THREE.Float32BufferAttribute(r,3));var c=new THREE.Line(d,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));c.matrixAutoUpdate=false;l.add(c);var m=new THREE.Geometry;m.vertices.push(new THREE.Vector3,o,a,o.clone().add(a));m.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));i.add(new THREE.Mesh(m,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return l}this._gizmo.add(r(new THREE.Vector3(1,0,0),n.x,this._touchAreas));this._gizmo.add(r(new THREE.Vector3(0,1,0),n.y,this._touchAreas));this._gizmo.add(r(new THREE.Vector3(0,0,1),n.z,this._touchAreas));this._gizmo.add(s(1,2,this._touchAreas));this._gizmo.add(s(2,0,this._touchAreas));this._gizmo.add(s(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var l=new THREE.Geometry;l.vertices.push(new THREE.Vector3,new THREE.Vector3);this._line=new THREE.LineSegments(l,new THREE.LineBasicMaterial);this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line)};h.prototype.hasDomElement=function(){return true};h.prototype.resetValues=function(){this._value.setScalar(0)};h.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;var t=e===o.Screen;var i=this._gizmo.children,r=this._touchAreas.children;i[2].visible=i[3].visible=i[4].visible=!t;r[2].visible=r[3].visible=r[4].visible=!t;this._axisTitles.children[2].visible=!t;this._gizmoIndex=this._handleIndex=-1};h.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._updateSelection(e._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:i},true)};h.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};h.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};h.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e,true);return this._touchAreas};var c=[1,2,4,6,5,3];h.prototype.highlightHandle=function(e,t){var i;for(i=0;i<3;i++){var r=this._gizmo.children[i];var o=c[e]&1<<i;var a=o?16776960:r.userData.color;r.material.color.setHex(a);r.material.opacity=o||t?1:.35;r.children[0].material.color.setHex(a);r.children[0].material.opacity=o||t?1:.35;var n=this._axisTitles.children[i];n.material.color.setHex(a);n.material.opacity=o||t?1:.35}for(i=3;i<6;i++){var s=this._gizmo.children[i];s.material.visible=i===e;var l=s.children[0].geometry.attributes.color;l.copyArray(i===e?[1,1,0,1,1,0,1,1,0]:s.userData.colors);l.needsUpdate=true;s.children[0].material.opacity=i===e||t?1:.35}};h.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame()};h.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._moveDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(e){var t=e.node;e.matOrigin=t.matrixWorld.clone();e.originLocal=t.position.clone();e.origin=(new THREE.Vector3).setFromMatrixPosition(t.matrixWorld);if(t.parent){e.matParentInv=(new THREE.Matrix4).getInverse(t.parent.matrixWorld)}else{e.matParentInv=new THREE.Matrix4}})};h.prototype._printEventInfo=function(e,t,i,r,o){d.debug(e+" is fired:"+" x = "+t+"; y = "+i+"; z = "+r);o.forEach(function(e){d.debug("Node: "+e.node.name);if(e.offsetToRest){d.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+" ] ")}else{d.debug("offsetToRest: null")}if(e.offsetToPrevious){d.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{d.debug("offsetToPrevious: null")}if(e.absolute){d.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+" ] ")}else{d.debug("absolute: null")}if(e.world){d.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+" ] ")}else{d.debug("world: null")}if(e.restDifference){d.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+" ] ")}else{d.debug("restDifference: null")}if(e.restDifferenceInCoordinates){d.debug("restDifferenceInCoordinates: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+" ] ")}else{d.debug("restDifferenceInCoordinates: null")}})};h.prototype._getOffsetToRestInCoordinateSystem=function(e,t,i){if(i===o.World){return t.toArray()}else if(i===o.Custom){var r=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var a=(new THREE.Matrix4).getInverse(r);return t.clone().applyMatrix4(a).toArray()}else if(i===o.Local){var n=(new THREE.Matrix4).extractRotation(e.matrixWorld);var s=(new THREE.Matrix4).getInverse(n);return t.clone().applyMatrix4(s).toArray()}else if(i===o.Screen){var l=this._viewport.getRenderer().getSize(new THREE.Vector2);var d=this._viewport.getCamera().getCameraRef();var h=(new THREE.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var c=(new THREE.Matrix3).setFromMatrix4(d.matrixWorld);var m=(new THREE.Matrix3).getInverse(c);var u=t.clone().applyMatrix3(m);var p=2*h.w/(d.projectionMatrix.elements[0]*l.width);var f=2*h.w/(d.projectionMatrix.elements[5]*l.height);return[u.x/p,u.y/f,0]}};h.prototype._getNodesProperties=function(){var e=[];this._nodes.forEach(function(t){var i=t.node;var r={};r.node=i;var a=this._getEffectiveParent(i);var n=new THREE.Matrix4;if(a===i.parent){var l=this._viewport._viewStateManager.getRelativeTransformation(i);r.offsetToRestInParent=l.translation.slice();if(i.parent){n=(new THREE.Matrix4).extractRotation(i.parent.matrixWorld)}r.offsetToPreviousInParent=r.offsetToRestInParent.slice();var d;if(this._playback){d=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(i,s.Translate,this._playback);if(d){r.offsetToPreviousInParent[0]-=d[0];r.offsetToPreviousInParent[1]-=d[1];r.offsetToPreviousInParent[2]-=d[2]}}var h=this._viewport._viewStateManager.getRestTransformation(i);var c=[h.translation[0],h.translation[1],h.translation[2]];if(d){c[0]+=d[0];c[1]+=d[1];c[2]+=d[2]}var m=new THREE.Quaternion;var u=new THREE.Vector3;var p=new THREE.Vector3;i.matrix.decompose(p,m,u);var f=(new THREE.Matrix4).makeTranslation(-c[0],-c[1],-c[2]);var _=(new THREE.Matrix4).makeTranslation(-h.translation[0],-h.translation[1],-h.translation[2]);if(u.x===0||u.y===0||u.z===0){u.x=1;u.y=1;u.z=1}var v=(new THREE.Matrix4).makeScale(1/u.x,1/u.y,1/u.z);var E=(new THREE.Matrix4).makeRotationFromQuaternion(m.inverse());var g=v.clone().multiply(E).multiply(f).multiply(i.matrix);g.decompose(p,m,u);r.offsetToPrevious=p.toArray();var x=v.multiply(E).multiply(_).multiply(i.matrix);x.decompose(p,m,u);r.offsetToRest=p.toArray()}else{if(i.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(i,s.Translate)}if(i.userData&&i.userData.offsetTranslation){r.offsetToRestInParent=i.userData.offsetTranslation.slice()}else{r.offsetToRestInParent=[0,0,0]}r.offsetToPreviousInParent=r.offsetToRestInParent.slice();if(i.userData.skipUpdateJointNode){i.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();i.userData.skipUpdateJointNode=true}var y=this._viewport._viewStateManager.getRestTransformationUsingJoint(i);var w=new THREE.Vector3;var T=new THREE.Vector3(y.scale[0],y.scale[1],y.scale[2]);var R=new THREE.Quaternion(y.quaternion[0],y.quaternion[1],y.quaternion[2],y.quaternion[3]);if(i.userData.offsetScale){T.x*=i.userData.offsetScale[0];T.y*=i.userData.offsetScale[1];T.z*=i.userData.offsetScale[2]}if(i.userData.offsetQuaternion){var z=new THREE.Quaternion(i.userData.offsetQuaternion[0],i.userData.offsetQuaternion[1],i.userData.offsetQuaternion[2],i.userData.offsetQuaternion[3]);R.multiply(z)}var M=(new THREE.Matrix4).makeRotationFromQuaternion(R);var H=(new THREE.Matrix4).makeTranslation(y.translation[0],y.translation[1],y.translation[2]);var S=a.matrixWorld.clone().multiply(H).multiply(M).scale(T);var b=(new THREE.Matrix4).getInverse(S).multiply(i.matrixWorld);b.decompose(w,R,T);r.offsetToPrevious=w.toArray();r.offsetToRest=w.toArray()}var P=this._viewport._viewStateManager.getTransformation(i);r.absolute=[P.translation[0],P.translation[1],P.translation[2]];var I=this._viewport._viewStateManager.getTransformationWorld(i);r.world=I.translation;var D;if(this._nodeUserDataMap){D=this._nodeUserDataMap.get(i)}if(D&&D.initialTranslation){r.restDifference=[P.translation[0]-D.initialTranslation[0],P.translation[1]-D.initialTranslation[1],P.translation[2]-D.initialTranslation[2]];if(this._coordinateSystem===o.Parent){r.restDifferenceInCoordinates=r.restDifference.slice()}else{var V=new THREE.Vector3(r.restDifference[0],r.restDifference[1],r.restDifference[2]).applyMatrix4(n);r.restDifferenceInCoordinates=this._getOffsetToRestInCoordinateSystem(i,V,this._coordinateSystem)}}e.push(r)}.bind(this));return e};h.prototype.endGesture=function(){this._line.visible=false;var e=this._getNodesProperties();var t=this._moveDelta.clone();if(this._coordinateSystem===o.Custom){var i=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var r=(new THREE.Matrix4).getInverse(i);t.applyMatrix4(r)}delete this._beginValue;this._nodes.forEach(function(e){var t=e.node;if(t.userData){delete t.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(t,s.Translate)}.bind(this));this._tool.fireMoved({x:t.x,y:t.y,z:t.z,nodesProperties:e});this._printEventInfo("Event 'moved'",t.x,t.y,t.z,e)};h.prototype._setOffset=function(e,t){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){var i=this._nodes[t];var r=i.node;var a=this._getEffectiveParent(r);if(this._coordinateSystem===o.Parent&&a){r=a}var n=(new THREE.Matrix4).getInverse(r.matrixWorld);var s=(new THREE.Vector3).setFromMatrixScale(r.matrixWorld);var l=i.origin.clone().applyMatrix4(n);e=i.origin.clone().add(e).applyMatrix4(n).sub(l).multiply(s)}else if(this._coordinateSystem===o.Screen){var d=this._viewport.getRenderer().getSize(new THREE.Vector2);var h=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var c=this._gizmo.position.clone().add(e).applyMatrix4(this._matViewProj);e.set(Math.round((c.x-h.x)*.5*d.width),Math.round((c.y-h.y)*.5*d.height),0)}var m=this._getNodesProperties();var u=e.clone();if(this._coordinateSystem===o.Custom){var p=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);var f=(new THREE.Matrix4).getInverse(p);u.applyMatrix4(f)}if(this._tool.fireEvent("moving",{x:u.x,y:u.y,z:u.z,nodesProperties:m},true)){this._printEventInfo("Event 'moving'",u.x,u.y,u.z,m);this._move(e);if(this._coordinateSystem===o.Screen){e.set((new THREE.Vector3).setFromMatrixColumn(this._matOrigin,0).normalize().dot(e),(new THREE.Vector3).setFromMatrixColumn(this._matOrigin,1).normalize().dot(e),0)}else if(this._coordinateSystem===o.Custom){var _=this._getAnchorPoint();if(_){var v=(new THREE.Matrix4).getInverse(_.matrixWorld);var E=(new THREE.Vector3).setFromMatrixScale(_.matrixWorld);var g=_.position.clone().applyMatrix4(v);e.copy(_.position.clone().add(e).applyMatrix4(v).sub(g).multiply(E))}}this._line.geometry.vertices[0].setScalar(0).sub(e);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();e.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));e.multiplyScalar(1/Math.max(e.x,e.y,e.z));this._line.material.color.setRGB(e.x,e.y,e.z);this._line.visible=true}};h.prototype._move=function(e){this._value.addVectors(this._beginValue,e);this._moveDelta.copy(e);this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){this._nodes.forEach(function(t){var i=t.node;var r=this._getEffectiveParent(i);var a=null;if(this._coordinateSystem===o.Parent&&r){a=this._extractBasis(r.matrixWorld)}else{a=this._extractBasis(i.matrixWorld)}var n=t.origin.clone();n.add(a[0].multiplyScalar(e.x)).add(a[1].multiplyScalar(e.y)).add(a[2].multiplyScalar(e.z));i.matrixWorld.setPosition(n);i.matrix.multiplyMatrices(t.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.matrixWorldNeedsUpdate=true}.bind(this))}else{if(this._coordinateSystem===o.Screen){var t=this._viewport.getRenderer().getSize(new THREE.Vector2);var i=this._viewport.getCamera().getCameraRef();var r=(new THREE.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var a=e.x*2*r.w/(i.projectionMatrix.elements[0]*t.width);var n=e.y*2*r.w/(i.projectionMatrix.elements[5]*t.height);e.setFromMatrixColumn(i.matrixWorld,0).multiplyScalar(a);e.add((new THREE.Vector3).setFromMatrixColumn(i.matrixWorld,1).multiplyScalar(n))}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(e);if(this._coordinateSystem===o.Custom){var s=this._getAnchorPoint();if(s){s.position.copy(this._gizmo.position)}}this._nodes.forEach(function(t){if(!t.ignore){var i=t.node;i.matrixWorld.setPosition(t.origin.clone().add(e));i.matrix.multiplyMatrices(t.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.matrixWorldNeedsUpdate=true}})}this._viewport.setShouldRenderFrame()};h.prototype.move=function(e,t,i){this.beginGesture();if(this._coordinateSystem===o.Custom){var r=new THREE.Vector3(e,t,i);var a=(new THREE.Matrix4).extractRotation(this._gizmo.matrixWorld);r.applyMatrix4(a);e=r.x;t=r.y;i=r.z}this._move(new THREE.Vector3(e,t,i||0))};h.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};h.prototype.setValue=function(e){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){this.beginGesture();this._move((new THREE.Vector3).setComponent(this._handleIndex,e-this._value.getComponent(this._handleIndex)));this.endGesture()}};h.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};h.prototype._updateSelection=function(e){i.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(e,this._viewport)}};h.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var t=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:t},true);this._gizmoIndex=this._handleIndex=-1}};h.prototype._getSelectionCenter=function(e){i.prototype._getSelectionCenter.apply(this,arguments);var t=this;function r(e,t,i,r){var o=i/2;var a=r/2;e.project(t);e.x=e.x*o+o;e.y=-(e.y*a)+a;return e}function o(e,t,i,r){var o=i/2;var a=r/2;e.x=(e.x-o)/o;e.y=-(e.y-a)/a;e.unproject(t);return e}function n(e,i,r){var a=new THREE.Vector3(t._gizmoSize,t._gizmoSize,0);var n=new THREE.Vector3(i-t._gizmoSize,t._gizmoSize,0);var s=new THREE.Vector3(i-t._gizmoSize,r-t._gizmoSize,0);var l=new THREE.Vector3(t._gizmoSize,r-t._gizmoSize,0);var d=[o(a,e,i,r),o(n,e,i,r),o(s,e,i,r),o(l,e,i,r)];return d[0].add(d[1]).add(d[2]).add(d[3]).multiplyScalar(.25)}if(this._placementMode===a.OnScreen){var s=this._viewport.getDomRef().getBoundingClientRect();var l=s.width;var d=s.height;var h=this._viewport.getCamera().getCameraRef();var c=r(e.clone(),h,l,d);var m=c.clone();var u=[m.x<this._gizmoSize&&m.setX(t._gizmoSize)||m.x>l-this._gizmoSize&&m.setX(l-t._gizmoSize),m.y<this._gizmoSize&&m.setY(t._gizmoSize)||m.y>d-this._gizmoSize&&m.setY(d-t._gizmoSize)].some(function(e){return e!==false})&&e.copy(o(m,h,l,d));return c.z>1&&e.copy(n(h,l,d))||u||e}else if(this._placementMode===a.ObjectCenter&&this._nodes.length===1){var p=new THREE.Vector3;if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(p)}else{var f=new THREE.Box3;f.expandByObject(this._nodes[0].node);f.getCenter(p)}e.copy(p.applyMatrix4(this._nodes[0].node.matrixWorld))}};h.prototype._updateGizmoTransformation=function(e,t){var i=this._updateGizmoObjectTransformation(this._gizmo,e,true);this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize+18,i);this._line.scale.setScalar(1/(this._gizmoSize*i))};h.prototype._getEditingFormPosition=function(){var e=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex,true);var t=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.clone().multiplyScalar((this._gizmoSize+18)*e).add(this._gizmo.position).applyMatrix4(this._matViewProj)};h.prototype.render=function(){l(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,r=this.getGizmoCount();i<r;i++){this._updateGizmoTransformation(i,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,r){"use strict";var o=t.extend("sap.ui.vk.tools.MoveToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=13;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3;this._gizmoOrigin=new THREE.Vector3;this._gizmoScale=1;this._objectSpace=new THREE.Matrix4;this._mouse=new THREE.Vector2}});o.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var o=this._gizmo.getTouchObject(s);var h=this._rayCaster.intersectObject(o,true);if(h.length>0){this._handleIndex=o.children.indexOf(h[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(o.matrixWorld);this._gizmoScale=o.scale.x;this._objectSpace.extractRotation(o.matrixWorld);if(this._gizmo._coordinateSystem!==r.World){this._objectSpace.copyPosition(o.matrixWorld)}if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(o.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(o.matrixWorld,this._handleIndex-3).normalize()}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};o.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};o.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};var h=new THREE.Vector3;o.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();h.copy(t.origin).sub(this._gizmoOrigin);return e.dot(h)/e.dot(this._handleAxis)};o.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;h.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(h)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(h)};o.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){this._gesture=true;t.handled=true;this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset()}}}};o.prototype._setOffset=function(t){if(this._tool.getEnableStepping()){var e=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*.1;var i=(new THREE.Matrix4).getInverse(this._objectSpace);var s=this._gizmoOrigin.clone().applyMatrix4(i);var n=this._gizmoOrigin.clone().add(t).applyMatrix4(i);for(var r=0;r<3;r++){var o=n.getComponent(r);if(Math.abs(o-s.getComponent(r))>e*1e-5){var a=Math.round(o/e)*e;h.setFromMatrixColumn(this._objectSpace,r).multiplyScalar(a-o);t.add(h)}}}if(isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){this._gizmo._setOffset(t,this._gizmoIndex)}};o.prototype.move=function(t){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"move"})}t.handled=true;this._updateMouse(t);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin))}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin))}}}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var n=new e({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:r.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:r.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_PARENT"),key:r.Parent}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:r.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:r.Custom})],itemSelected:function(t){var e=t.getParameters("item").item;this._tool.setCoordinateSystem(e.getKey())}.bind(this)});n.openAsContextMenu(t.event,this.getViewport())}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};o.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiManipulationTool", ["./Tool","../thirdparty/three","./PoiToolHandler","./PoiToolGizmo","../threejs/PoiHelper","./ToolNodeSet","../NodeContentType"],function(t,e,i,o,s,n,a){"use strict";var r=t.extend("sap.ui.vk.tools.PoiManipulationTool",{metadata:{library:"sap.ui.vk",properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:n.Highlight}},aggregations:{buttons:{type:"sap.m.Button",multiple:true}},events:{editing:{parameters:{nodeRef:"any"}},removing:{parameters:{nodeRef:"any"}},moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}}}},constructor:function(e,n){t.apply(this,arguments);this._viewport=null;this._poiHelper=new s;this.setAggregation("gizmo",new o);this._handler=new i(this);this._buttonPosition=new THREE.Vector2;this._selectedPoi=new Set}});r.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._editButton=new sap.m.Button({icon:"sap-icon://edit",type:sap.m.ButtonType.Neutral,press:function(t){this.fireEditing({nodeRef:this._selectedPoi.values().next().value})}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonEdit");this._deleteButton=new sap.m.Button({icon:"sap-icon://delete",type:sap.m.ButtonType.Neutral,press:function(t){this.fireRemoving({nodeRef:this._selectedPoi.values().next().value})}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonDelete");this.addAggregation("buttons",this._editButton);this.addAggregation("buttons",this._deleteButton);this.setButtonsVisibility(false);this.attachMoved(function(t){var e=t.getParameter("nodesProperties");for(var i=0;i<e.length;++i){var o=e[i].node;if(this._gizmo&&this._gizmo.getIgnoreNonPoiNode()&&o._vkGetNodeContentType()!==a.Symbol){continue}this._poiHelper.adjustPoi(this._viewport,o)}});this.setFootprint(["sap.ui.vk.threejs.Viewport"])};r.prototype.getSelectedPois=function(){var t=[];if(this._viewport){var e=this._viewport._viewStateManager;e.getSymbolNodes().forEach(function(i){if(e.getSelectionState(i)){t.push(i)}})}return t};r.prototype._updateSelectedPoi=function(){if(this._viewport&&this._viewport._viewStateManager){var t=this._viewport._viewStateManager;var e=t.getSymbolNodes();this._selectedPoi.forEach(function(t){if(!e.includes(t)){this._selectedPoi.delete(t)}}.bind(this));e.forEach(function(e){if(t.getSelectionState(e)){this._selectedPoi.add(e)}else{this._selectedPoi.delete(e)}}.bind(this))}return this};r.prototype._updateButtonPosition=function(t){var e=this._poiHelper.getPoiRect(this._viewport,t);if(e){var i=new THREE.Box3;i.expandByObject(t);var o=new THREE.Vector3;i.getCenter(o);var s=this._viewport.projectToScreen(o.x,o.y,o.z,this._viewport.getCamera());var n=s.x+e.width/2;var a=s.y-e.height/2;this._buttonPosition.set(n,a);return true}return false};r.prototype.handlePoiSelectionChange=function(){this._updateSelectedPoi()};r.prototype.setActive=function(e,i){t.prototype.setActive.call(this,e,i);if(this._viewport){this.updateButtons();if(e){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._gizmo.rerender();this._addLocoHandler();this._viewport._viewStateManager.attachSelectionChanged(this.handlePoiSelectionChange,this)}else{this._removeLocoHandler();if(this._viewport._viewStateManager){this._viewport._viewStateManager.detachSelectionChanged(this.handlePoiSelectionChange,this)}if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};r.prototype.updateButtons=function(){this._updateSelectedPoi();var t=this.getButtons();var e;t.forEach(function(t){if(t.getVisible()){t.rerender();if(t.getDomRef()){e=t.getDomRef().parentElement}}});if(e){if(this._selectedPoi.size&&this._updateButtonPosition(this._selectedPoi.values().next().value)){e.style.display="block";e.style.left=this._buttonPosition.x+"px";e.style.top=this._buttonPosition.y+"px"}else{e.style.display="none"}}};r.prototype.setButtonsVisibility=function(t){this.getButtons().forEach(function(e){if(e.getVisible()!==t){e.setVisible(t)}})};r.prototype.addButtons=function(t){if(!Array.isArray(t)){t=[t]}t.forEach(function(t){this.addAggregation("buttons",t)},this)};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolGizmo", ["../thirdparty/three","./Gizmo","./PoiToolGizmoRenderer","./GizmoPlacementMode","../NodeContentType","sap/base/assert"],function(t,e,o,i,n,r){"use strict";var s=e.extend("sap.ui.vk.tools.PoiToolGizmo",{metadata:{library:"sap.ui.vk"}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._placementMode=i.ObjectCenter;this._nodes=[];this._poiIndex=-1;this._moveDelta=new THREE.Vector3;this._ignoreNonPoiNode=false};s.prototype.hasDomElement=function(){return true};s.prototype.setIgnoreNonPoiNode=function(t){this._ignoreNonPoiNode=t};s.prototype.getIgnoreNonPoiNode=function(){return this._ignoreNonPoiNode};s.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes.length=0;this._updateSelection(t._viewStateManager);var o=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:o},true)};s.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._poiIndex=-1};s.prototype.getPOICount=function(){return this._nodes.length};s.prototype.getPOI=function(t){return t<this._nodes.length?this._nodes[t].node:null};s.prototype.selectPOI=function(t){this._poiIndex=t;this._viewport.setShouldRenderFrame()};s.prototype.beginGesture=function(){this._moveDelta.setScalar(0);this._nodes.forEach(function(t){var e=t.node;if(this._ignoreNonPoiNode&&e._vkGetNodeContentType()!==n.Symbol){return}t.origin=(new THREE.Vector3).setFromMatrixPosition(e.matrixWorld);t.matParentInv=new THREE.Matrix4;if(e.parent){t.matParentInv.getInverse(e.parent.matrixWorld)}},this)};s.prototype._getNodesProperties=function(){var t=[];this._nodes.forEach(function(e){t.push({node:e.node})});return t};s.prototype.endGesture=function(){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z,nodesProperties:this._getNodesProperties()})};s.prototype._setOffset=function(t){if(this._tool.fireEvent("moving",{x:t.x,y:t.y,z:t.z,nodesProperties:this._getNodesProperties()},true)){this._move(t)}};s.prototype._move=function(t){this._moveDelta.copy(t);var e=this._viewport._isPanoramicActivated();var o=(new THREE.Vector3).setFromMatrixPosition(this._viewport.getCamera().getCameraRef().matrixWorld);this._nodes.forEach(function(i){var r=i.node;if(this._ignoreNonPoiNode&&r._vkGetNodeContentType()!==n.Symbol){return}if(!i.origin){i.origin=(new THREE.Vector3).setFromMatrixPosition(r.matrixWorld)}var s=i.origin.clone();if(e){var a=s.distanceTo(o);s.add(t).sub(o).setLength(a).add(o)}else{s.add(t)}r.matrixWorld.setPosition(s);r.matrix.multiplyMatrices(i.matParentInv,r.matrixWorld);r.position.setFromMatrixPosition(r.matrix);r.matrixWorldNeedsUpdate=true},this);this._viewport.setShouldRenderFrame()};s.prototype.move=function(t,e,o){this.beginGesture();this._move(new THREE.Vector3(t,e,o||0))};s.prototype.handleSelectionChanged=function(t){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var e=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:e},true);this._poiIndex=-1}};s.prototype._getSelectionCenter=function(t){e.prototype._getSelectionCenter.apply(this,arguments);var o=new THREE.Vector3;if(this._nodes[0].node.userData.boundingBox){this._nodes[0].node.userData.boundingBox.getCenter(o)}else{var i=new THREE.Box3;i.expandByObject(this._nodes[0].node);i.getCenter(o)}t.copy(o.applyMatrix4(this._nodes[0].node.matrixWorld))};s.prototype._updatePoiButtons=function(){this._tool.updateButtons()};s.prototype.render=function(){r(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");this._updatePoiButtons()};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolGizmoRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,n){t.openStart("div",n);t.openEnd();var e=n._tool;var o=e&&e.getButtons&&e.getButtons();if(o&&o.length){t.openStart("div");t.class("sapUiVizKitPoiButtonsContainer");t.openEnd();for(var r=0;r<o.length;++r){t.renderControl(o[r])}t.close("div")}t.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolHandler", ["sap/ui/base/EventProvider","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.PoiToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._poiIndex=-1;this._mouse=new THREE.Vector2}});i.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1};i.prototype._updateActivePOI=function(t){this._poiIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){var e=this._tool._viewport.getDomRef().getBoundingClientRect();var i=this._tool._viewport.hitTest(t.x-e.left,t.y-e.top);if(i&&i.object){this._poiZ=(new THREE.Vector3).setFromMatrixPosition(i.object.matrixWorld).project(this.getViewport().getCamera().getCameraRef()).z;for(var s=0,o=this._gizmo.getPOICount();s<o;s++){if(this._gizmo.getPOI(s)===i.object){this._poiIndex=s;break}}}}};i.prototype._getDragPosition=function(){return new THREE.Vector3(this._mouse.x,this._mouse.y,this._poiZ).unproject(this.getViewport().getCamera().getCameraRef())};i.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateActivePOI(t,true);this._gizmo.selectPOI(this._poiIndex);t.handled|=this._poiIndex>=0}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateActivePOI(t);if(this._poiIndex>=0){this._gesture=true;t.handled=true;this._gizmo.selectPOI(this._poiIndex);this._gizmo.beginGesture();this._dragOrigin=this._getDragPosition()}}};i.prototype._setOffset=function(t){if(isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){this._gizmo._setOffset(t,this._poiIndex)}};i.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getDragPosition().sub(this._dragOrigin))}}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateActivePOI(t);this.getViewport().setShouldRenderFrame()}};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PredefinedView", [],function(){"use strict";var t={Initial:"Initial",Front:"Front",Back:"Back",Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom"};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RectSelectTool", ["./Tool","./RectSelectToolHandler","../SelectionDisplayMode","../Loco"],function(e,t,i,r){"use strict";var a=e.extend("sap.ui.vk.tools.RectSelectTool",{metadata:{library:"sap.ui.vk",properties:{subtractMode:{type:"boolean",defaultValue:false}}},constructor:function(i,r){if(a._instance){return a._instance}e.apply(this,arguments);this._viewport=null;this._handler=new t(this);this._loco=null;a._instance=this}});a.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};a.prototype.setActive=function(t,i,r){e.prototype.setActive.call(this,t,i,r);if(this._viewport){if(t){if(this._prepare()){this._handler.activate(this._viewport)}}else{this._handler.deactivate()}}return this};a.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return true}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&this._viewport._scene&&this._viewport._scene.getSceneRef()){return true}else if(this.isViewportType("sap.ui.vk.svg.Viewport")&&this._viewport._scene){return true}else{return false}};a.prototype.queueCommand=function(e){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.svg.Viewport")){e()}}return this};function s(e,t,i){var r=e.elements;var a=r[15]===1;var s=2/r[0];var n=2/r[5];var o,p;if(a){o=-r[12]*s;p=-r[13]*n}else{o=r[8]*s;p=r[9]*n}var l=(s+o)*.5;var u=o-l;var c=(n+p)*.5;var v=p-c;var f=THREE.Math.lerp(u,l,Math.min(t.x1,t.x2)/i.width);var h=THREE.Math.lerp(u,l,Math.max(t.x1,t.x2)/i.width);var d=THREE.Math.lerp(c,v,Math.min(t.y1,t.y2)/i.height);var g=THREE.Math.lerp(c,v,Math.max(t.y1,t.y2)/i.height);r[0]=2/(h-f);r[5]=2/(d-g);if(a){r[12]=-(h+f)/(h-f);r[13]=-(d+g)/(d-g)}else{r[8]=(h+f)/(h-f);r[9]=(d+g)/(d-g)}}a.prototype.select=function(e,t,i,r,a,s){if(!this._prepare()){return[]}return this._select(e,t,i,r,this._viewport,a,s)};a.prototype._select=function(e,t,r,a,n,o,p){var l=[];var u=n.getMetadata().getName();if(u==="sap.ui.vk.svg.Viewport"){if(e===r||t===a){return l}l=n._select({x1:e,y1:t,x2:r,y2:a});if(l.length>0){n.fireNodesPicked({picked:l});if(n.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){n._viewStateManager.setOutliningStates([],l)}else{n._viewStateManager.setOutliningStates(l,[])}}else if(this.getSubtractMode()){n._viewStateManager.setSelectionStates([],l)}else{n._viewStateManager.setSelectionStates(l,[])}}return l}if(u==="sap.ui.vk.dvl.Viewport"){l=n.rectSelect(e,t,r,a);if(l.length>0){var c={picked:l};n.fireNodesPicked(c);if(n.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){n._viewStateManager.setOutliningStates([],l)}else{n._viewStateManager.setOutliningStates(l,[])}}else if(this.getSubtractMode()){n._viewStateManager.setSelectionStates([],l)}else{n._viewStateManager.setSelectionStates(l,[])}}return l}if(u!=="sap.ui.vk.threejs.Viewport"){return l}var v=o?o.getSceneRef():undefined;var f=p?p.getCameraRef():undefined;var h=n._getViewStateManagerThreeJS();if(!f||!v||!h||e===r||t===a){return l}var d={x1:e,y1:t,x2:r,y2:a};var g=f.projectionMatrix.clone();s(g,d,n._renderer.getSize(new THREE.Vector2));var S=(new THREE.Matrix4).multiplyMatrices(g,f.matrixWorldInverse);var w=(new THREE.Frustum).setFromProjectionMatrix(S);var y=new THREE.Vector3;function _(e){var t=e.geometry;if(t!==undefined&&w.intersectsObject(e)){var i,r=0;if(t.isGeometry){var a=t.vertices;for(i=0,r=a.length;i<r;i++){y.copy(a[i]).applyMatrix4(e.matrixWorld);if(!w.containsPoint(y)){break}}}else if(t.isBufferGeometry){var s=t.attributes.position;if(s!==undefined){for(i=0,r=s.count;i<r;i++){y.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld);if(!w.containsPoint(y)){break}}}}return r>0&&i===r}return false}function M(e,t,i){if(!e.visible){return}var r=i||e.userData.skipIt?t:{totalCount:0,passedCount:0};if(r&&e.geometry!==undefined){r.totalCount++;if(_(e)){r.passedCount++}}var a=e.children;for(var s=0,n=a.length;s<n;s++){M(a[s],r,i||e.userData.closed)}if(r!==t&&r.passedCount>0&&r.totalCount===r.passedCount){l.push(e)}}M(v);if(l.length>0){var k={picked:l};n.fireNodesPicked(k);if(n.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){h.setOutliningStates([],l)}else{h.setOutliningStates(l,[])}}else if(this.getSubtractMode()){h.setSelectionStates([],l)}else{h.setSelectionStates(l,[])}}return l};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RectSelectToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.RectSelectToolHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},constructor:function(t){this._tool=t;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false};e.prototype.activate=function(t){this._deactivate=false;if(t._loco){this._viewport=t;t._loco.addHandler(this,1)}};e.prototype.deactivate=function(){if(this._gesture){this._deactivate=true}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};if(document.activeElement){try{document.activeElement.blur()}catch(t){}}i.focus();return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};e.prototype.beginGesture=function(t){if(t.n===1&&this._inside(t)&&!this._gesture){this._gesture=true;t.handled=true;var e=t.x-this._rect.x,i=t.y-this._rect.y;this._selectionRect={x1:e,y1:i,x2:e,y2:i};return}};e.prototype.move=function(t){if(this._gesture){t.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=t.x-this._rect.x;this._selectionRect.y2=t.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect)}}}};e.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;if(this._selectionRect){if(this._viewport){var e=t.x-this._rect.x,i=t.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.svg.Viewport")||this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,null,null)}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,this._viewport.getScene(),this._viewport.getCamera())}}this._viewport.setSelectionRect(null);this._selectionRect=null}if(this._deactivate){this.deactivate()}}};e.prototype.getViewport=function(){return this._viewport};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineTool", ["sap/base/Log","../library","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(e,t,i,n,r,o,a,l,s,p,d){"use strict";var m=i.extend("sap.ui.vk.tools.RedlineTool",{metadata:{library:"sap.ui.vk",properties:{editable:{type:"boolean",defaultValue:true}},events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}},elementHovered:{parameters:{elementId:"string"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},constructor:function(e,t){if(m._instance){return m._instance}i.apply(this,arguments);this._viewport=null;this._handler=new n(this);m._instance=this}});m.prototype.init=function(){if(i.prototype.init){i.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport"]);this.setAggregation("gizmo",new r)};m.prototype.exit=function(){m._instance=null};m.prototype.setActive=function(e,n,r){i.prototype.setActive.call(this,e,n,r);var o=this._viewport;if(o){if(e){if(o._activateRedline){o._activateRedline()}else if(o instanceof t.threejs.Viewport){o._viewportGestureHandler._activateRedline()}o._redlineHandler=this._handler;this._handler._zoomFactor=1;this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show()}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}delete o._redlineHandler;if(o._deactivateRedline){o._deactivateRedline()}else if(o instanceof t.threejs.Viewport&&o._viewportGestureHandler){o._viewportGestureHandler._deactivateRedline()}}}return this};var u={rectangle:a,ellipse:l,freehand:s,line:p,text:d};var c={rect:a,ellipse:l,path:s,line:p,text:d};m.prototype.startAdding=function(e){this.getGizmo()._startAdding(e);return this};m.prototype.stopAdding=function(){this.getGizmo()._stopAdding(false);return this};m.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(e){return e.exportJSON()})};m.prototype.importJSON=function(t){var i=this.getGizmo();t=Array.isArray(t)?t:[t];t.forEach(function(t){var n=u[t.type];if(n){i.addRedlineElement((new n).importJSON(t))}else{e.warning("Unsupported JSON element type "+t.type)}});i.rerender();return this};m.prototype.exportSVG=function(){var e=document.createElementNS(o.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(t){e.appendChild(t.exportSVG())});return e};m.prototype.importSVG=function(t){var i=this.getGizmo();t.childNodes.forEach(function(t){if(t.getAttribute){var n=c[t.tagName];if(n){i.addRedlineElement((new n).importSVG(t))}else{e.warning("Unsupported SVG element type "+n)}}});i.rerender();return this};m.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.NativeViewport")){e()}}return this};m.prototype.onElementClicked=function(e){this.fireElementClicked({elementId:e.getParameter("elementId")})};return m});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolGizmo", ["./Gizmo","./RedlineToolGizmoRenderer"],function(e,t){"use strict";var i=e.extend("sap.ui.vk.tools.RedlineToolGizmo",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"},activeElement:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});i.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._activeElement=null;this._virtualLeft=0;this._virtualTop=0;this._virtualSideLength=1};i.prototype.show=function(){this.getParent()._viewport.attachEvent("resize",null,this._onResize,this);this.addStyleClass("sapUiVizkitRedlineInteractionMode")};i.prototype.hide=function(){this.getParent()._viewport.detachEvent("resize",this._onResize,this);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode")};i.prototype._startAdding=function(e){this._activeElement=null;this.setAggregation("activeElement",e);this.removeStyleClass("sapUiVizkitRedlineInteractionMode");this.addStyleClass("sapUiVizkitRedlineDesignMode")};i.prototype._stopAdding=function(e){var t=e?this._activeElement:null;this._activeElement=null;this.setAggregation("activeElement",null);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.addStyleClass("sapUiVizkitRedlineInteractionMode");if(t){this.addRedlineElement(t);if(this.getParent().getEditable()&&t instanceof sap.ui.vk.RedlineElementText){this._createdTextElement=t;this.editTextElement(t,true)}else{this.getParent().fireElementCreated({element:t})}}};i.prototype._toVirtualSpace=function(e,t){if(arguments.length===1){return e/this._virtualSideLength}else{return{x:(e-this._virtualLeft)/this._virtualSideLength,y:(t-this._virtualTop)/this._virtualSideLength}}};i.prototype._toPixelSpace=function(e,t){if(arguments.length===1){return e*this._virtualSideLength}else{return{x:e*this._virtualSideLength+this._virtualLeft,y:t*this._virtualSideLength+this._virtualTop}}};i.prototype._onResize=function(){if(this.getDomRef()){this.rerender()}};i.prototype._getPanningRatio=function(){var e=this.getDomRef().getBoundingClientRect(),t=e.height,i=e.width;if(this._virtualLeft===0&&(t<i&&this._virtualTop<0||t>i&&this._virtualTop>0)){return t/i}return 1};i.prototype.editTextElement=function(e,t){if(!this.getParent().getEditable()){return}var i=this._textEditingElement&&this._textEditingElement.getDomRef();if(i){i.childNodes[0].blur()}i=e.getDomRef();if(i){e._nextElementSibling=i.nextElementSibling;i.parentNode.appendChild(i);i.childNodes[0].focus();if(t){i.childNodes[0].select()}}};i.prototype.onBeforeRendering=function(){var e=this.getParent()._viewport;if(e&&e.getDomRef()){var t=e.getOutputSize();this._virtualLeft=t.left;this._virtualTop=t.top;this._virtualSideLength=t.sideLength}};i.prototype.onAfterRendering=function(){var e=this;function t(t){var i=t.getDomRef();var n=i&&i.childNodes[0];if(!n){return}n.onfocus=function(i){e._textEditingElement=t;this.style.background="#0004";this.style.backdropFilter="blur(8px)";this.style.resize="both";this.style.overflow="auto"};n.onblur=function(n){e._textEditingElement=null;this.style.background="none";this.style.backdropFilter=null;this.style.resize="none";this.style.overflow="hidden";this.scrollTop=0;t.setWidth(parseFloat(this.style.width));var s=parseFloat(this.style.height);this.style.height="1px";s=Math.max(s,this.scrollHeight);this.style.height=s+"px";t.setHeight(s);if(i===t.getDomRef()){i.parentNode.insertBefore(i,t._nextElementSibling)}delete t._nextElementSibling;if(e._createdTextElement===t){e._createdTextElement=null;e.getParent().fireElementCreated({element:t})}};n.onchange=function(e){t.setText(this.value)};n.addEventListener("keypress",function(e){e.stopPropagation()})}this.getRedlineElements().forEach(function(e){if(e instanceof sap.ui.vk.RedlineElementText){t(e)}});if(this._activeElement instanceof sap.ui.vk.RedlineElementText&&this._activeElement.getDomRef()){t(this._activeElement)}};i.prototype.onkeydown=function(e){if(this._textEditingElement){e.setMarked(true);e.stopPropagation()}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolGizmoRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("svg",r);e.class("sapUiVizkitRedlineTool");e.openEnd();var t=[];var o=[];var a=["rgba(255,0,0,1)"];var n=["255001"];var l=r.getRedlineElements();for(var i=0;i<l.length;i++){var s=l[i];var p=s.getHaloColor();if(!t.includes(p)){t.push(p);var d=s._colorToArray(p);o.push(d)}var f=s.getStrokeColor();var c=s._colorToArray(f).join("");if(!n.includes(c)){n.push(c);a.push(f)}}var u;if(r.getParent()._haloColor){u=r.getParent()._haloColor.replace(/[^\d,.]/g,"").split(",")}else{u=[255,0,0,1]}if(!u[3]){u.push(1)}var g=u.join("");e.openStart("defs");e.openEnd();e.openStart("filter");e.attr("id","halo"+g);e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","3");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feColorMatrix");e.attr("result","color");e.attr("type","matrix");e.attr("values","0 0 0 0 "+u[0]/255+" 0 0 0 0 "+u[1]/255+" 0 0 0 0 "+u[2]/255+" 0 0 0 "+u[3]+" 0");e.openEnd();e.close("feColorMatrix");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","color");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter");for(var v=0;v<o.length;v++){var S=o[v];var E=S.join("");e.openStart("filter");e.attr("id","halo"+E);e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","3");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feColorMatrix");e.attr("result","color");e.attr("type","matrix");e.attr("values","0 0 0 0 "+S[0]/255+" 0 0 0 0 "+S[1]/255+" 0 0 0 0 "+S[2]/255+" 0 0 0 "+S[3]+" 0");e.openEnd();e.close("feColorMatrix");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","color");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter")}for(var M=0;M<n.length;M++){e.openStart("marker");e.attr("id","endArrowHead"+n[M]);e.attr("markerWidth","10");e.attr("markerHeight","7");e.attr("refX","0");e.attr("refY","3.5");e.attr("orient","auto");e.openEnd();e.openStart("polygon");e.attr("points","0 0, 10 3.5, 0 7");e.attr("fill",a[M]);e.openEnd();e.close("polygon");e.close("marker")}e.close("defs");l.forEach(function(r){if(!r.getSuppress()){r.render(e)}});if(r._activeElement){r._activeElement.render(e)}e.close("svg")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolHandler", ["sap/ui/base/EventProvider","sap/ui/core/Core"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.RedlineToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._zoomFactor=1}});i.prototype.destroy=function(){this._tool=null;this._rect=null};i.prototype.init=function(){this._previousHoverTarget=null};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(e._textEditingElement){t.handled=true;var i=this.hitTest(t.x,t.y);if(i!==e._textEditingElement){var n=e._textEditingElement.getDomRef();if(n){n.childNodes[0].blur()}return}t.passEvent=true;if(i===e._textEditingElement){return}}this._gesture=true;e._activeElement=t.buttons===1&&e.getAggregation("activeElement")||null;if(e._activeElement){t.handled=true;var r=e.getDomRef().getBoundingClientRect(),o=e._toVirtualSpace(t.x-r.left-window.pageXOffset,t.y-r.top-window.pageYOffset);e._activeElement.setOriginX(o.x);e._activeElement.setOriginY(o.y);e.rerender()}else{this._pivotPoint=e._toVirtualSpace(t.x-this._rect.x,t.y-this._rect.y)}}};i.prototype.move=function(t){var e=this._tool.getGizmo();if(e&&this._gesture){if(e._textEditingElement){t.handled=true;t.passEvent=true}else if(e._activeElement){t.handled=true;var i=e.getDomRef().getBoundingClientRect(),n=t.x-i.left-window.pageXOffset,r=t.y-i.top-window.pageYOffset;e._activeElement.edit(n,r,t.event&&t.event.shiftKey)}}};i.prototype.endGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){this._gesture=false;if(e._textEditingElement){t.handled=true;t.passEvent=true}else if(e._activeElement){t.handled=true;e._stopAdding(true)}}};i.prototype.pan=function(t,e){var i=this._tool.getGizmo();if(i&&(t||e)){i.getRedlineElements().forEach(function(n){n.setOriginX(n.getOriginX()+i._toVirtualSpace(t));n.setOriginY(n.getOriginY()+i._toVirtualSpace(e))});i.rerender()}};i.prototype.zoom=function(t,e,i){var n=this._tool.getGizmo();if(n&&t!==1){var r=1-t,o=e!==undefined&&i!==undefined?n._toVirtualSpace(e,i):this._pivotPoint;n.getRedlineElements().forEach(function(e){e.applyZoom(t);var i=e.getOriginX(),n=e.getOriginY();i+=(o.x-i)*r;n+=(o.y-n)*r;e.setOriginX(i);e.setOriginY(n)});n.rerender()}};i.prototype.hitTest=function(t,i){var n;var r=6;var o=6;var s=function(t,i){var n=document.elementFromPoint(t,i);if(n){var r=e.byId(n.id||n.parentNode.id);if(r instanceof sap.ui.vk.RedlineElement){return r}}};n=s(t,i);if(!n){for(var l=i-o;l<i+o;l++){for(var a=t-r;a<t+r;a++){n=s(a,l);if(n){return n}}}}return n?n:null};i.prototype.click=function(t){var e=this.hitTest(t.x,t.y);if(e){this._tool.fireElementClicked({elementId:e.getElementId()})}};i.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&this._tool.getEditable()){var i=this.hitTest(t.x,t.y);if(i instanceof sap.ui.vk.RedlineElementText){e.editTextElement(i);t.handled=true}}};i.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&e._textEditingElement){t.passEvent=true;return}var i=this.hitTest(t.x,t.y);if(i&&i.getElementId()!=this._previousHoverTarget){this._previousHoverTarget=i.getElementId();this._tool.fireElementHovered({elementId:i.getElementId()})}else if(!i&&i!=this._previousHoverTarget){this._previousHoverTarget=i;this._tool.fireElementHovered({elementId:null})}};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var n=this._getOffset(i);this._rect={x:n.x,y:n.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotatableAxis", [],function(){"use strict";var e={All:"All",X:"X",Y:"Y",Z:"Z"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateOrbitTool", ["./Tool","../helpers/RotateOrbitHelperDvl","../helpers/RotateOrbitHelperThree"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.tools.RotateOrbitTool",{metadata:{library:"sap.ui.vk",events:{rotate:{parameters:{dx:"int",dy:"int"}}}},constructor:function(e,i){if(r._instance){return r._instance}t.apply(this,arguments);this.setToolid("1a1fced1-9b42-d7f3-5fdf-8d338b3591a6");this._viewport=null;this._rotateOrbitHelper=null;r._instance=this}});r.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"])};r.prototype.setActive=function(e,i,r){t.prototype.setActive.call(this,e,i,r);if(this._viewport){if(e){if(this._prepare()){this._rotateOrbitHelper.activateOrbitMode()}}else if(this._rotateOrbitHelper){this._rotateOrbitHelper.deactivateOrbitMode();this._rotateOrbitHelper=null}}return this};r.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateOrbitHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateOrbitHelper=new e(this,this._dvl)}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateOrbitHelper==null){this._rotateOrbitHelper=new i(this)}}else{return false}return true};r.prototype.rotate=function(t,e){if(this._prepare()){this._rotateOrbitHelper.rotate(t,e)}};r.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._rotateOrbitHelper=null;delete r._instance};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateTool", ["./Tool","../thirdparty/three","./RotatableAxis","./CoordinateSystem","./RotateToolHandler","./RotateToolGizmo","./GizmoPlacementMode","./Detector","./ToolNodeSet"],function(t,e,o,i,s,r,a,n,h){"use strict";var p=t.extend("sap.ui.vk.tools.RotateTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:i.World},axis:{type:"sap.ui.vk.tools.RotatableAxis",defaultValue:o.All},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:h.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:a.Default}},events:{rotating:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},rotated:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},axisChanged:{parameters:{axis:"sap.ui.vk.tools.RotatableAxis"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(e,o){t.apply(this,arguments);this._viewport=null;this._handler=new s(this);this._gizmo=null;this._detector=new n}});p.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new r)};p.prototype.setActive=function(e,o,i){t.prototype.setActive.call(this,e,o,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();this._gizmo.setAxis(this.getAxis());this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};p.prototype.setPlacementMode=function(t){var e=this.getPlacementMode();if(e!==t){this.setProperty("placementMode",t,true);this.getGizmo().setPlacementMode(t);if(this._viewport){this._viewport.setShouldRenderFrame()}this.firePlacementModeChanged({placementMode:t})}return this};p.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};p.prototype.setAxis=function(t){var e=this.getAxis();if(e!==t){this.setProperty("axis",t,true);this.getGizmo().setAxis(t);if(this._viewport){this._viewport.setShouldRenderFrame()}this.fireAxisChanged({axis:t})}return this};p.prototype.setCoordinateSystem=function(t){var e=this.getCoordinateSystem();if(e!==t){this.setProperty("coordinateSystem",t,true);this.getGizmo().setCoordinateSystem(t);if(this._viewport){this._viewport.setShouldRenderFrame()}this.fireCoordinateSystemChanged({coordinateSystem:t})}return this};p.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};p.prototype.setEnableSnapping=function(t){this.setProperty("enableSnapping",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};p.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame()}return this};p.prototype.getDetector=function(){return this._detector};p.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};p.prototype.rotate=function(t,e,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}if(this._gizmo){this._gizmo.rotate(t,e,o)}if(s){this.setCoordinateSystem(s)}if(this._gizmo){this._gizmo.endGesture()}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};p.prototype.prepareForCreatingRotationKey=function(t,e,o){if(this._gizmo){this._gizmo._prepareForCreatingRotationKey(t,e,o);return this._gizmo._getNodesProperties()}return null};p.prototype.rotateRestPosition=function(t,e,o){if(this._gizmo){this._gizmo.rotateRestPosition(t,e,o)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};p.prototype.rotateFromRestPosition=function(t,e,o){if(this._gizmo){this._gizmo.rotateFromRestPosition(t,e,o)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateToolGizmo", ["../thirdparty/three","./Gizmo","./RotateToolGizmoRenderer","./RotatableAxis","./CoordinateSystem","./AxisColours","../AnimationTrackType","../AnimationTrackValueType","./GizmoPlacementMode","sap/base/assert","sap/base/Log"],function(e,t,r,i,o,a,n,s,l,u,h){"use strict";var d=t.extend("sap.ui.vk.tools.RotateToolGizmo",{metadata:{library:"sap.ui.vk"}});d.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new THREE.Vector3;this._rotationDelta=new THREE.Vector3;this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene;this._gizmo=new THREE.Group;this._touchAreas=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._axis=i.All;this._coordinateSystem=o.World;this._nodes=[];this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;function e(e,t,r,i){var o=new THREE.TorusBufferGeometry(r,1/96,4,i);if(e===0){o.rotateY(Math.PI/2)}else if(e===1){o.rotateX(Math.PI/2)}var a=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:t,transparent:true}));a.matrixAutoUpdate=false;a.userData.color=t;return a}function r(e,t,r){var i=new THREE.TorusBufferGeometry(t,16/96,4,r);if(e===0){i.rotateY(Math.PI/2)}else if(e===1){i.rotateX(Math.PI/2)}return new THREE.Mesh(i,new THREE.MeshBasicMaterial({opacity:.2,transparent:true}))}for(var n=0;n<3;n++){this._gizmo.add(e(n,a[["x","y","z"][n]],1,128));this._touchAreas.add(r(n,1,24))}this._gizmo.add(new THREE.AxesHelper(.75));var s=new THREE.MeshBasicMaterial({color:33023,opacity:.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry,s);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles)};d.prototype.hasDomElement=function(){return true};d.prototype.setAxis=function(e){this._axis=e;var t=[i.All,i.X,i.Y,i.Z];if(this._coordinateSystem!==o.Screen){for(var r=0;r<3;r++){if(e!==i.All&&t[r+1]!==e){this._gizmo.children[r].visible=this._touchAreas.children[r].visible=false}else{this._gizmo.children[r].visible=this._touchAreas.children[r].visible=true}}}};d.prototype.resetValues=function(){this._value.setScalar(0)};d.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;var t=e===o.Screen;if(t){this._gizmo.children[0].visible=this._gizmo.children[1].visible=false;this._touchAreas.children[0].visible=this._touchAreas.children[1].visible=false;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=true}else{this._gizmo.children[0].visible=this._touchAreas.children[0].visible=this._axis===i.All||this._axis===i.X;this._gizmo.children[1].visible=this._touchAreas.children[1].visible=this._axis===i.All||this._axis===i.Y;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=this._axis===i.All||this._axis===i.Z}this._axisTitles.visible=!t;this._gizmoIndex=this._handleIndex=-1};d.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._updateSelection(e._viewStateManager);var r=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:r},true)};d.prototype._prepareForCreatingRotationKey=function(e,t,r){this._nodes.forEach(function(i){var o=i.node;var a=[0,0,0];e.setTime(t,r);var s=e.getAnimatedProperty(o,n.Rotate);if(s.offsetToPrevious){a=s.offsetToPrevious}if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map}var l=this._nodeUserDataMap.get(o);if(!l){l={};this._nodeUserDataMap.set(o,l)}l.eulerInParentCoors=new THREE.Euler(a[0],a[1],a[2]);l.startEulerInParentCoors=new THREE.Euler(a[0],a[1],a[2])}.bind(this));var i=e.getCurrentPlayback();if(i){this._prepareForCreatingKey(i)}};d.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};d.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};d.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e);return this._touchAreas};d.prototype.highlightHandle=function(e,t){for(var r=0;r<3;r++){var i=this._gizmo.children[r];var o=r===e?16776960:i.userData.color;i.material.color.setHex(o);i.material.opacity=e===-1||r===e?1:.35;i.material.visible=t||r===e;var a=this._axisTitles.children[r];a.material.color.setHex(o);a.material.opacity=e===-1||r===e?1:.35;a.material.visible=t||r===e}};d.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame()};d.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._rotationDelta.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(e){e.node.parent.updateMatrixWorld(true);e.matOrigin=e.node.matrixWorld.clone();e.matLocalOrigin=e.node.matrix.clone();if(e.node.parent){e.matParentInv=(new THREE.Matrix4).getInverse(e.node.parent.matrixWorld)}else{e.matParentInv=new THREE.Matrix4}e.quaternion=e.node.quaternion.clone()})};d.prototype._printEventInfo=function(e,t,r,i,o){h.debug(e+" is fired:"+" x = "+t+"; y = "+r+"; z = "+i);o.forEach(function(e){h.debug("Node: "+e.node.name);if(e.offsetToRest){h.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+", "+e.offsetToRest[3]+" ] ")}else{h.debug("offsetToRest: null")}if(e.offsetToRestInCoordinates){h.debug("offsetToRestInCoordinates: [ "+e.offsetToRestInCoordinates[0]+", "+e.offsetToRestInCoordinates[1]+", "+e.offsetToRestInCoordinates[2]+" ] ")}else{h.debug("offsetToRestInCoordinates: null")}if(e.offsetToPrevious){h.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{h.debug("offsetToPrevious: null")}if(e.absolute){h.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+", "+e.absolute[3]+" ] ")}else{h.debug("absolute: null")}if(e.world){h.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+", "+e.world[3]+" ] ")}else{h.debug("world: null")}if(e.restDifference){h.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+", "+e.restDifference[3]+" ] ")}else{h.debug("restDifference: null")}if(e.restDifferenceInCoordinates){h.debug("restDifference: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+", "+e.restDifferenceInCoordinates[3]+" ] ")}else{h.debug("restDifference: null")}})};d.prototype._getNodesProperties=function(){var e=[];this._nodes.forEach(function(t){var r=t.node;var i={};i.node=r;var o;if(this._nodeUserDataMap){o=this._nodeUserDataMap.get(r)}if(o&&o.eulerInParentCoors){var a=new THREE.Euler(o.eulerInParentCoors.x,o.eulerInParentCoors.y,o.eulerInParentCoors.z);var s=(new THREE.Quaternion).setFromEuler(a);if(this._playback){var l=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(r,n.Rotate,this._playback);if(l){var u=new THREE.Quaternion(l[0],l[1],l[2],l[3]);s.multiply(u)}}i.offsetToRest=[s.x,s.y,s.z,s.w];i.offsetToPrevious=[o.eulerInParentCoors.x,o.eulerInParentCoors.y,o.eulerInParentCoors.z]}else{i.offsetToRest=null;i.offsetToPrevious=null}var h=this._viewport._viewStateManager.getTransformation(r);i.absolute=[h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]];var d=this._viewport._viewStateManager.getTransformationWorld(r);var f=new THREE.Quaternion(d.quaternion[0],d.quaternion[1],d.quaternion[2],d.quaternion[3]);var _=(new THREE.Euler).setFromQuaternion(f);i.world=[_.x,_.y,_.z];if(o&&o.quatInitialDiffInv){var p=new THREE.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);p.multiply(o.quatInitialDiffInv);i.restDifference=[p.x,p.y,p.z,p.w]}else{i.restDifference=null}if(o.euler){i.restDifferenceInCoordinates=[o.euler.x,o.euler.y,o.euler.z]}else{i.restDifferenceInCoordinates=null}i.offsetToRestInCoordinates=null;e.push(i)}.bind(this));return e};d.prototype.endGesture=function(){this._arcMesh.visible=false;var e=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(e){var t=e.node;var r;if(this._nodeUserDataMap){r=this._nodeUserDataMap.get(t)}if(r&&r.euler){r.startEuler.x=r.euler.x;r.startEuler.y=r.euler.y;r.startEuler.z=r.euler.z;r.startEulerInParentCoors.x=r.eulerInParentCoors.x;r.startEulerInParentCoors.y=r.eulerInParentCoors.y;r.startEulerInParentCoors.z=r.eulerInParentCoors.z}if(this._coordinateSystem!==o.Custom){delete t.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(t,n.Rotate)}.bind(this));this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:e});this._printEventInfo("Event 'rotated'",this._rotationDelta.x,this._rotationDelta.y,this._rotationDelta.z,e)};var f=function(e,t){if(Math.abs(e-t)<1e-6){return e}if(e>t){while(e>t){t+=2*Math.PI}if(t-e<=Math.PI){return t}else{return t-2*Math.PI}}else{while(e<t){t-=2*Math.PI}if(e-t<=Math.PI){return t}else{return t+2*Math.PI}}};d.prototype.rotateFromRestPosition=function(e,t,r){if(this._coordinateSystem!==o.Parent){return}this.beginGesture();this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});e=THREE.Math.degToRad(e);t=THREE.Math.degToRad(t);r=THREE.Math.degToRad(r);for(var i=0,a=this._nodes.length;i<a;i++){var s=this._nodes[i];if(!s.ignore){var l=s.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(l)}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(e-u.eulerInParentCoors.x),THREE.Math.radToDeg(t-u.eulerInParentCoors.y),THREE.Math.radToDeg(r-u.eulerInParentCoors.z));u.eulerInParentCoors.x=e;u.eulerInParentCoors.y=t;u.eulerInParentCoors.z=r;var h=new THREE.Euler(u.eulerInParentCoors.x,u.eulerInParentCoors.y,u.eulerInParentCoors.z);var d=(new THREE.Quaternion).setFromEuler(h);var f=this._viewport._viewStateManager.getRestTransformationUsingJoint(l);var _=new THREE.Quaternion(f.quaternion[0],f.quaternion[1],f.quaternion[2],f.quaternion[3]);if(this._playback){var p=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(l,n.Rotate,this._playback);if(p){var E=new THREE.Quaternion(p[0],p[1],p[2],p[3]);d.multiply(E)}}var c=this._getEffectiveParent(l);if(c!==l.parent){this._viewport._viewStateManager._setJointNodeOffsets(l,n.Rotate);l.userData.offsetQuaternion=[d.x,d.y,d.z,d.w];l.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();l.userData.skipUpdateJointNode=true}else{l.quaternion.copy(d.multiply(_))}l.updateMatrix();u.euler.x=u.eulerInParentCoors.x-u.startEulerInParentCoors.x+u.startEuler.x;u.euler.y=u.eulerInParentCoors.y-u.startEulerInParentCoors.y+u.startEuler.y;u.euler.z=u.eulerInParentCoors.z-u.startEulerInParentCoors.z+u.startEuler.z}}}this.endGesture()};d.prototype.rotateRestPosition=function(e,t,r){this.beginGesture();this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});e=THREE.Math.degToRad(e);t=THREE.Math.degToRad(t);r=THREE.Math.degToRad(r);for(var i=0,a=this._nodes.length;i<a;i++){var n=this._nodes[i];if(!n.ignore){var s=n.node;var l;if(this._nodeUserDataMap){l=this._nodeUserDataMap.get(s)}if(l&&l.euler&&l.eulerInParentCoors){this._rotationDelta.set(THREE.Math.radToDeg(e-l.euler.x),THREE.Math.radToDeg(t-l.euler.y),THREE.Math.radToDeg(r-l.euler.z));l.euler.x=e;l.euler.y=t;l.euler.z=r;var u=new THREE.Euler(l.euler.x,l.euler.y,l.euler.z);var h=(new THREE.Quaternion).setFromEuler(u);var d=new THREE.Matrix4;var _=new THREE.Matrix4;if(this._coordinateSystem===o.Local){d=s.parent.matrixWorld.clone().multiply(l.matRest);_=l.matRestInv.clone().multiply(n.matParentInv)}else if(this._gizmo&&this._coordinateSystem!==o.Parent){d=this._gizmo.matrixWorld.clone();_=_.getInverse(d)}var p=(new THREE.Matrix4).makeRotationFromQuaternion(h);var E=p;if(this._coordinateSystem!==o.Parent){E=n.matParentInv.clone().multiply(d).multiply(p).multiply(_).multiply(s.parent.matrixWorld)}var c=(new THREE.Matrix4).makeRotationFromQuaternion(l.quatInitialDiff).multiply(E);var m=(new THREE.Euler).setFromRotationMatrix(c);if(Math.abs(m.x)<1e-6){m.x=0}if(Math.abs(m.y)<1e-6){m.y=0}if(Math.abs(m.z)<1e-6){m.z=0}l.eulerInParentCoors.x=f(l.eulerInParentCoors.x,m.x);l.eulerInParentCoors.y=f(l.eulerInParentCoors.y,m.y);l.eulerInParentCoors.z=f(l.eulerInParentCoors.z,m.z);s.matrix=l.matInitialDiff.clone().multiply(E.multiply(l.matRest));s.matrix.decompose(s.position,s.quaternion,s.scale);s.updateMatrix()}}}this.endGesture()};d.prototype._updateEulerForCreatingAnimationKey=function(e){for(var t=0,r=this._nodes.length;t<r;t++){var i=this._nodes[t];if(!i.ignore){var a=i.node;var s;if(this._nodeUserDataMap){s=this._nodeUserDataMap.get(a)}if(s&&s.euler){s.euler.x=s.startEuler.x+e[0];s.euler.y=s.startEuler.y+e[1];s.euler.z=s.startEuler.z+e[2];var l=false;if(Math.abs(s.euler.x)<1e-6&&(Math.abs(s.euler.y)<1e-6||Math.abs(s.euler.z)<1e-6)||Math.abs(s.euler.y)<1e-6&&Math.abs(s.euler.z)<1e-6){l=true}if(l&&this._coordinateSystem===o.Parent){s.eulerInParentCoors.x=s.startEulerInParentCoors.x+e[0];s.eulerInParentCoors.y=s.startEulerInParentCoors.y+e[1];s.eulerInParentCoors.z=s.startEulerInParentCoors.z+e[2];continue}var u=this._viewport._viewStateManager.getRelativeTransformation(a);var h;var d=this._getEffectiveParent(a);if(d!==a.parent&&this._coordinateSystem!==o.Custom){this._viewport._viewStateManager._setJointNodeOffsets(a,n.Rotate);h=new THREE.Quaternion(a.userData.offsetQuaternion[0],a.userData.offsetQuaternion[1],a.userData.offsetQuaternion[2],a.userData.offsetQuaternion[3]);a.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();a.userData.skipUpdateJointNode=true}else{h=new THREE.Quaternion(u.quaternion[0],u.quaternion[1],u.quaternion[2],u.quaternion[3])}var _=(new THREE.Matrix4).makeRotationFromQuaternion(h);if(this._playback){var p=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(a,n.Rotate,this._playback);if(p){var E=new THREE.Quaternion(p[0],p[1],p[2],p[3]);var c=(new THREE.Matrix4).makeRotationFromQuaternion(E);_.multiply((new THREE.Matrix4).getInverse(c))}}var m=(new THREE.Euler).setFromRotationMatrix(_);if(Math.abs(m.x)<1e-5){m.x=0}if(Math.abs(m.y)<1e-5){m.y=0}if(Math.abs(m.z)<1e-5){m.z=0}s.eulerInParentCoors.x=f(s.eulerInParentCoors.x,m.x);s.eulerInParentCoors.y=f(s.eulerInParentCoors.y,m.y);s.eulerInParentCoors.z=f(s.eulerInParentCoors.z,m.z);if(l){continue}var v=new THREE.Matrix4;var g=new THREE.Matrix4;if(this._coordinateSystem===o.Local){v=a.parent.matrixWorld.clone().multiply(s.matRest);g=s.matRestInv.clone().multiply(i.matParentInv)}else if(this._gizmo&&this._coordinateSystem!==o.Parent){v=this._gizmo.matrixWorld.clone();g=g.getInverse(v)}var y=new THREE.Quaternion(u.quaternion[0],u.quaternion[1],u.quaternion[2],u.quaternion[3]);y.multiply(s.quatInitialDiffInv);var x=(new THREE.Matrix4).makeRotationFromQuaternion(y);var T=x;if(this._coordinateSystem!==o.Parent){T=g.clone().multiply(a.parent.matrixWorld).multiply(x).multiply(i.matParentInv).multiply(v)}m=(new THREE.Euler).setFromRotationMatrix(T);if(Math.abs(m.x)<1e-6){m.x=0}if(Math.abs(m.y)<1e-6){m.y=0}if(Math.abs(m.z)<1e-6){m.z=0}s.euler.x=f(s.euler.x,m.x);s.euler.y=f(s.euler.y,m.y);s.euler.z=f(s.euler.z,m.z)}}}};d.prototype._rotate=function(e){this._rotationDelta.set(THREE.Math.radToDeg(e.x),THREE.Math.radToDeg(e.y),THREE.Math.radToDeg(e.z));this._value.addVectors(this._beginValue,this._rotationDelta);this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});var t=new THREE.Quaternion;if(this._coordinateSystem===o.Local){t.setFromEuler(e);this._nodes.forEach(function(e){var r=e.node;r.quaternion.copy(e.quaternion).multiply(t);r.updateMatrix()});e=e.toArray();this._updateEulerForCreatingAnimationKey(e)}else{e=e.toArray();for(var r=0;r<3;r++){var i=e[r];if(i){var a=e[3].charCodeAt(r)-88;if(a>=0&&a<3){var n=(new THREE.Vector3).setFromMatrixColumn(this._matOrigin,a).normalize();var s=(new THREE.Matrix4).makeRotationAxis(n,i);var l=(new THREE.Vector3).setFromMatrixPosition(this._matOrigin);s.setPosition(l.sub(l.clone().applyMatrix4(s)));for(var u=0,h=this._nodes.length;u<h;u++){var d=this._nodes[u];if(!d.ignore){var f=d.node;if(this._coordinateSystem!==o.Parent){f.position.setFromMatrixPosition(d.matOrigin).applyMatrix4(s).applyMatrix4(d.matParentInv)}var _=(new THREE.Vector3).setFromMatrixScale(d.matOrigin);var p=n.clone().transformDirection((new THREE.Matrix4).getInverse(d.matOrigin)).multiply(_).normalize();t.setFromAxisAngle(p,i);f.quaternion.copy(d.quaternion).multiply(t);f.updateMatrix()}}}}}this._updateEulerForCreatingAnimationKey(e)}this._viewport.setShouldRenderFrame()};d.prototype._setRotationAxisAngle=function(e,t,r){var i=(r-t)%(Math.PI*2);var a=new THREE.Euler;a[["x","y","z"][e]]=i;var n=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(a.x),y:THREE.Math.radToDeg(a.y),z:THREE.Math.radToDeg(a.z),nodesProperties:n},true)){this._printEventInfo("Event 'rotating'",THREE.Math.radToDeg(a.x),THREE.Math.radToDeg(a.y),THREE.Math.radToDeg(a.z),n);this._rotate(a);var s=[0,0,0];var l=new THREE.Vector3;var u=(e+1)%3,h=(e+2)%3;var d,f=Math.max(Math.ceil(Math.abs(i)*64/Math.PI),1);i*=this._coordinateSystem===o.Local?-1:1;for(d=0;d<=f;d++){var _=t+i*(d/f);l.set(0,0,0).setComponent(u,Math.cos(_)).setComponent(h,Math.sin(_));s.push(l.x,l.y,l.z)}var p=[];for(d=0;d<f;d++){p.push(0,d+1,d+2)}var E=new THREE.BufferGeometry;E.setIndex(p);E.setAttribute("position",new THREE.Float32BufferAttribute(s,3));this._arcMesh.geometry=E;this._arcMesh.visible=true}};d.prototype.rotate=function(e,t,r){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(e||0),THREE.Math.degToRad(t||0),THREE.Math.degToRad(r||0)))};d.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};d.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};d.prototype.setValue=function(e){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var t=new THREE.Euler;t[["x","y","z"][this._handleIndex]]=THREE.Math.degToRad(e-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(t);this.endGesture()}};d.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};d.prototype._updateSelection=function(e){t.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(e)}};d.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var t=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:t},true);this._gizmoIndex=this._handleIndex=-1}};d.prototype._getLevelingQuaternion=function(e,t){e.set(0,0,0,1);switch(this._coordinateSystem){case o.Local:e.setFromRotationMatrix(this._nodes[t].node.parent.matrixWorld);break;case o.Screen:e.copy(this._viewport.getCamera().getCameraRef().quaternion);break;case o.Custom:var r=this._getAnchorPoint();if(r){e.copy(r.quaternion)}break;default:break}};d.prototype._getObjectSize=function(e){var t=new THREE.Box3;if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(t,true,false)}else if(this._coordinateSystem===o.Local){this._nodes[0].node._expandBoundingBox(t,true,false)}if(t.isEmpty()){return 0}var r=new THREE.Vector3;t.getSize(r);return r.length()};d.prototype._updateGizmoTransformation=function(e,t){var r=this._updateGizmoObjectTransformation(this._gizmo,e);this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize-12,r)};d.prototype._getEditingFormPosition=function(){var e=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var t=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.clone().multiplyScalar((this._gizmoSize-12)*e).add(this._gizmo.position).applyMatrix4(this._matViewProj)};d.prototype.render=function(){u(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var r=0,i=this.getGizmoCount();r<i;r++){this._updateGizmoTransformation(r,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,o){"use strict";var r=t.extend("sap.ui.vk.tools.RotateToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=12;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._rayCaster.linePrecision=.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new THREE.Matrix4;this._levelingQuaternion=new THREE.Quaternion;this._mouse=new THREE.Vector2;this._mouseOrigin=new THREE.Vector2}});r.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};r.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var o=this._gizmo.getTouchObject(s);var r=this._rayCaster.intersectObject(o,true);if(r.length>0){this._handleIndex=o.children.indexOf(r[0].object);if(this._handleIndex>=0&&this._handleIndex<3){this._gizmoIndex=s;this._matrixOrigin.copy(o.matrixWorld);this._gizmo._getLevelingQuaternion(this._levelingQuaternion,s);this._objectSize=this._gizmo._getObjectSize(s)/this._gizmo._getGizmoScale(o.position)}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};r.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};r.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};r.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};r.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0&&this._handleIndex<3){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new THREE.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new THREE.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new THREE.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0}}};r.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._startAngle;var i=this._getMouseAngle()-e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*i<0){i+=Math.PI*2*Math.sign(this._prevDeltaAngle)}}i=i%(Math.PI*2);var s=e+i;if(this._tool.getEnableStepping()){var n=5;if(this._objectSize>0){var o=[.1,1,5,15];var r=[2e3,1e3,300,0];for(var a=0;a<4;a++){if(this._objectSize>=r[a]){n=o[a];break}}}n=THREE.Math.degToRad(n);var h=s-e;s+=Math.round(h/n)*n-h}this._prevDeltaAngle=s-e;if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"rotate",handleIndex:this._handleIndex,angle1:e,angle2:s})}if(isFinite(e)&&isFinite(s)){this._gizmo._setRotationAxisAngle(this._handleIndex,e,s)}}};r.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};r.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var n=new e({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:o.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:o.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:o.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:o.Custom})],itemSelected:function(t){var e=t.getParameters("item").item;this._tool.setCoordinateSystem(e.getKey())}.bind(this)});n.openAsContextMenu(t.event,this.getViewport())}}};r.prototype.getViewport=function(){return this._tool._viewport};r.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};r.prototype._inside=function(t){if(this._rect===null||true){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateTurntableTool", ["./Tool","../helpers/RotateTurntableHelperDvl","../helpers/RotateTurntableHelperThree"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.tools.RotateTurntableTool",{metadata:{library:"sap.ui.vk",events:{rotate:{parameters:{dx:"int",dy:"int"}}}},constructor:function(e,r){if(i._instance){return i._instance}t.apply(this,arguments);this.setToolid("f271c082-676c-adc6-167f-0d5ce602aa45");this._viewport=null;this._rotateTurntableHelper=null;i._instance=this}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"])};i.prototype.setActive=function(e,r,i){t.prototype.setActive.call(this,e,r,i);if(this._viewport){if(e){if(this._prepare()){this._rotateTurntableHelper.activateTurntableMode()}}else if(this._rotateTurntableHelper){this._rotateTurntableHelper.deactivateTurntableMode();this._rotateTurntableHelper=null}}return this};i.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateTurntableHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateTurntableHelper=new e(this,this._dvl)}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateTurntableHelper==null){this._rotateTurntableHelper=new r(this)}}else{return false}return true};i.prototype.rotate=function(t,e){if(this._prepare()){this._rotateTurntableHelper.rotate(t,e)}};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._rotateTurntableHelper=null};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleTool", ["./Tool","./CoordinateSystem","./ScaleToolHandler","./ScaleToolGizmo","./Detector","./ToolNodeSet","./GizmoPlacementMode"],function(e,t,o,i,s,r,n){"use strict";var a=e.extend("sap.ui.vk.tools.ScaleTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:t.World},nonUniformScaleEnabled:{type:"boolean",defaultValue:false},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:r.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:n.Default}},events:{scaling:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},scaled:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(t,i){e.apply(this,arguments);this._viewport=null;this._handler=new o(this);this._gizmo=null;this._detector=new s}});a.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new i)};a.prototype.setActive=function(t,o,i){e.prototype.setActive.call(this,t,o,i);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setNonUniformScaleEnabled(this.getNonUniformScaleEnabled());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};a.prototype.setPlacementMode=function(e){var t=this.getPlacementMode();if(t!==e){this.setProperty("placementMode",e,true);this.getGizmo().setPlacementMode(e);if(this._viewport){this._viewport.setShouldRenderFrame()}this.firePlacementModeChanged({placementMode:e})}return this};a.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};a.prototype.setCoordinateSystem=function(e){var t=this.getCoordinateSystem();if(t!==e){this.setProperty("coordinateSystem",e,true);this.getGizmo().setCoordinateSystem(e);if(this._viewport){this._viewport.setShouldRenderFrame()}this.fireCoordinateSystemChanged({coordinateSystem:e})}return this};a.prototype.setNonUniformScaleEnabled=function(e){this.setProperty("nonUniformScaleEnabled",e,true);this.getGizmo().setNonUniformScaleEnabled(e);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.setShowEditingUI=function(e){this.setProperty("showEditingUI",e,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.setEnableSnapping=function(e){this.setProperty("enableSnapping",e,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.resetValues=function(){this.getGizmo().resetValues();if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.getDetector=function(){return this._detector};a.prototype.setNodeSet=function(e){this.setProperty("nodeSet",e,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};a.prototype.scale=function(e,t,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}if(this._gizmo){this._gizmo.scale(e,t,o)}if(s){this.setCoordinateSystem(s)}if(this._gizmo){this._gizmo.endGesture()}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};a.prototype.prepareForCreatingScaleKey=function(e){if(this._gizmo){this._gizmo._prepareForCreatingKey(e);return this._gizmo._getNodesProperties()}return null};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleToolGizmo", ["../thirdparty/three","./Gizmo","./ScaleToolGizmoRenderer","./CoordinateSystem","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(e,t,i,o,r,a,n,s){"use strict";var l=t.extend("sap.ui.vk.tools.ScaleToolGizmo",{metadata:{library:"sap.ui.vk"}});l.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._createEditingForm(null,64);this._gizmoIndex=-1;this._handleIndex=-1;this._value=(new THREE.Vector3).setScalar(1);this._scaleDelta=(new THREE.Vector3).setScalar(1);this._viewport=null;this._tool=null;this._nonUniformScaleEnabled=false;this._sceneGizmo=new THREE.Scene;var e=new THREE.DirectionalLight(16777215,.5);e.position.set(1,3,2);this._sceneGizmo.add(e);this._sceneGizmo.add(new THREE.AmbientLight(16777215,.5));this._gizmo=new THREE.Group;this._touchAreas=new THREE.Group;this._sceneGizmo.add(this._gizmo);this._coordinateSystem=o.World;this._nodes=[];this._matViewProj=new THREE.Matrix4;this._gizmoSize=96;var i=96,a=16/i,n=48/i;function s(e,t,o){var r=(new THREE.Matrix4).makeBasis(new THREE.Vector3(e.y,e.z,e.x),e,new THREE.Vector3(e.z,e.x,e.y));var s=new THREE.BoxBufferGeometry(a,a,a);s.applyMatrix4(r);var l=new THREE.MeshLambertMaterial({color:t,transparent:true});var c=new THREE.Mesh(s,l);c.userData.color=t;if(e){c.position.copy(e);var h=1/i;var d=new THREE.CylinderBufferGeometry(h,h,1,4);r.setPosition(e.clone().multiplyScalar(-.5));d.applyMatrix4(r);var u=new THREE.Mesh(d,l);u.renderOrder=1;c.add(u);r.setPosition(e)}var f=new THREE.BoxBufferGeometry(n,n,n);f.applyMatrix4(r);o.add(new THREE.Mesh(f,l));return c}function l(e,t,i){var o=new THREE.BufferGeometry;var r=new Float32Array(6);r[e]=r[t+3]=.7;o.setAttribute("position",new THREE.Float32BufferAttribute(r,3));var a=new Float32Array(6);a[e]=a[t+3]=1;o.setAttribute("color",new THREE.Float32BufferAttribute(a,3));var n=new THREE.Line(o,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));n.userData.colors=a;var s=new THREE.Geometry;var l=(new THREE.Vector3).setComponent(e,.7);var c=(new THREE.Vector3).setComponent(t,.7);s.vertices.push(new THREE.Vector3,l,c);s.faces.push(new THREE.Face3(0,1,2));var h=new THREE.Mesh(s,new THREE.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,side:THREE.DoubleSide,visible:false}));h.renderOrder=1;n.add(h);i.add(h.clone());return n}this._gizmo.add(s(new THREE.Vector3(1,0,0),r.x,this._touchAreas));this._gizmo.add(s(new THREE.Vector3(0,1,0),r.y,this._touchAreas));this._gizmo.add(s(new THREE.Vector3(0,0,1),r.z,this._touchAreas));this._gizmo.add(l(1,2,this._touchAreas));this._gizmo.add(l(2,0,this._touchAreas));this._gizmo.add(l(0,1,this._touchAreas));a-=.1/i;var c=new THREE.MeshLambertMaterial({color:12632256,transparent:true});this._gizmo.add(new THREE.Mesh(new THREE.BoxBufferGeometry(a,a,a),c));this._touchAreas.add(new THREE.Mesh(new THREE.BoxBufferGeometry(n,n,n),new THREE.MeshBasicMaterial));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);this._updateGizmoPartVisibility()};l.prototype.hasDomElement=function(){return true};l.prototype._updateGizmoPartVisibility=function(){var e=this._coordinateSystem===o.Screen;var t=this._gizmo.children,i=this._touchAreas.children;t[2].visible=i[2].visible=!e;t[3].visible=t[4].visible=i[3].visible=i[4].visible=!e&&this._nonUniformScaleEnabled;t[5].visible=i[5].visible=this._nonUniformScaleEnabled;this._axisTitles.children[2].visible=!e};l.prototype.resetValues=function(){this._value.setScalar(1)};l.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;this._gizmoIndex=this._handleIndex=-1;this._updateGizmoPartVisibility()};l.prototype.setNonUniformScaleEnabled=function(e){this._nonUniformScaleEnabled=!!e;this._updateGizmoPartVisibility()};l.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._sequence=null;this._updateSelection(e._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:i},true)};l.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._sequence=null;this._updateEditingForm(false)};l.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};l.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e);return this._touchAreas};var c=[1,2,4,6,5,3];l.prototype.highlightHandle=function(e,t){var i=e===6||e>=0&&!this._nonUniformScaleEnabled;var o,r;for(o=0;o<3;o++){r=this._gizmo.children[o];var a=i||c[e]&1<<o;var n=a?16776960:r.userData.color;r.material.color.setHex(n);r.children[0].material.color.setHex(n);r.children[0].material.opacity=r.material.opacity=a||t?1:.35;var s=this._axisTitles.children[o];s.material.color.setHex(n);s.material.opacity=a||t?1:.35}for(o=3;o<6;o++){r=this._gizmo.children[o];var l=r.geometry.attributes.color;l.copyArray(i||o===e?[1,1,0,1,1,0]:r.userData.colors);l.needsUpdate=true;r.material.opacity=t||o===e?1:.35;r.children[0].material.visible=o===e}r=this._gizmo.children[6];r.material.color.setHex(i?16776960:12632256);r.material.opacity=i||t?1:.35};l.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame()};l.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._scaleDelta.setScalar(1);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(e){e.scaleOrigin=e.node.scale.clone();e.matOrigin=e.node.matrixWorld.clone();if(e.node.parent){e.matParentInv=(new THREE.Matrix4).getInverse(e.node.parent.matrixWorld)}else{e.matParentInv=new THREE.Matrix4}})};l.prototype._prepareForCreatingScaleKey=function(e){this._sequence=e};l.prototype._printEventInfo=function(e,t,i,o,r){s.debug(e+" is fired:"+" x = "+t+"; y = "+i+"; z = "+o);r.forEach(function(e){s.debug("Node: "+e.node.name);if(e.offsetToRest){s.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+" ] ")}else{s.debug("offsetToRest: null")}if(e.offsetToPrevious){s.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{s.debug("offsetToPrevious: null")}if(e.absolute){s.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+" ] ")}else{s.debug("absolute: null")}if(e.world){s.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+" ] ")}else{s.debug("world: null")}if(e.restDifference){s.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+" ] ")}else{s.debug("restDifference: null")}if(e.restDifferenceInCoordinates){s.debug("restDifferenceInCoordinates: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+" ] ")}else{s.debug("restDifferenceInCoordinates: null")}})};l.prototype._getNodesProperties=function(){var e=[];this._nodes.forEach(function(t){var i=t.node;var r={};r.node=i;var n=this._viewport._viewStateManager.getRelativeTransformation(i);r.offsetToRest=[n.scale[0],n.scale[1],n.scale[2]];r.offsetToPrevious=r.offsetToRest.slice();var s=this._getEffectiveParent(i);if(s!==i.parent){if(i.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(i,a.Scale)}if(i.userData&&i.userData.offsetScale){r.offsetToRest=i.userData.offsetScale.slice()}else{r.offsetToRest=[1,1,1]}r.offsetToPrevious=r.offsetToRest.slice();if(i.userData.skipUpdateJointNode){i.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();i.userData.skipUpdateJointNode=true}}if(this._playback){var l=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(i,a.Scale,this._playback);if(l){r.offsetToPrevious[0]/=l[0];r.offsetToPrevious[1]/=l[1];r.offsetToPrevious[2]/=l[2]}}var c=this._viewport._viewStateManager.getTransformation(i);r.absolute=[c.scale[0],c.scale[1],c.scale[2]];var h=this._viewport._viewStateManager.getTransformationWorld(i);r.world=h.scale;var d;if(this._nodeUserDataMap){d=this._nodeUserDataMap.get(i)}if(!t.matParentInv){t.matParentInv=(new THREE.Matrix4).getInverse(i.parent.matrixWorld)}var u=new THREE.Matrix4;if(this._gizmo){u=this._gizmo.matrixWorld.clone()}var f=new THREE.Vector3;var _,p,m;if(d&&d.initialScale){r.restDifference=[c.scale[0]/d.initialScale[0],c.scale[1]/d.initialScale[1],c.scale[2]/d.initialScale[2]];m=new THREE.Vector3(r.restDifference[0],r.restDifference[1],r.restDifference[2]);var E=new THREE.Quaternion(c.quaternion[0],c.quaternion[1],c.quaternion[2],c.quaternion[3]);var v=(new THREE.Matrix4).makeRotationFromQuaternion(E);var g=(new THREE.Matrix4).makeRotationFromQuaternion(d.initialQuaternion);var w=new THREE.Vector3;var x=new THREE.Vector3;var y=new THREE.Vector3;v.extractBasis(w,x,y);var T=new THREE.Vector3;var R=new THREE.Vector3;var z=new THREE.Vector3;g.extractBasis(T,R,z);if(w.dot(T)<0){r.restDifference[0]=-r.restDifference[0]}if(x.dot(R)<0){r.restDifference[1]=-r.restDifference[1]}if(y.dot(z)<0){r.restDifference[2]=-r.restDifference[2]}_=i.parent.matrixWorld.clone().scale(m).multiply(t.matParentInv);_.decompose(new THREE.Vector3,new THREE.Quaternion,f);if(this._coordinateSystem===o.World){r.restDifferenceInCoordinates=[f.x,f.y,f.z]}else{p=(new THREE.Matrix4).getInverse(u).multiply(_).multiply(u);p.decompose(new THREE.Vector3,new THREE.Quaternion,f);r.restDifferenceInCoordinates=[f.x,f.y,f.z]}var b=this._alignAxesBetweenGizmoAndNodeCoordinates(i);for(var H=0;H<3;H++){if(r.restDifference[H]>0){r.restDifferenceInCoordinates[b[H]]=Math.abs(r.restDifferenceInCoordinates[b[H]])}else{r.restDifferenceInCoordinates[b[H]]=-Math.abs(r.restDifferenceInCoordinates[b[H]])}}}e.push(r)}.bind(this));return e};l.prototype.endGesture=function(){var e=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(e){var t=e.node;if(t.userData){delete t.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(t,a.Scale)}.bind(this));this._tool.fireScaled({x:this._scaleDelta.x,y:this._scaleDelta.y,z:this._scaleDelta.z,nodesProperties:e});this._printEventInfo("Event 'scaled'",this._scaleDelta.x,this._scaleDelta.y,this._scaleDelta.z,e)};l.prototype._alignAxesBetweenGizmoAndNodeCoordinates=function(e,t){function i(e,t,i,o){var r=Math.abs(e.dot(t));var a=Math.abs(e.dot(i));var n=Math.abs(e.dot(o));if(r>=a&&r>=n){return 0}else if(a>=r&&a>=n){return 1}else{return 2}}var o=e.parent.matrixWorld.clone().multiply((new THREE.Matrix4).makeRotationFromQuaternion(e.quaternion.clone()));var r=new THREE.Vector3;var a=new THREE.Vector3;var n=new THREE.Vector3;o.extractBasis(r,a,n);r.normalize();a.normalize();n.normalize();var s=new THREE.Matrix4;if(this._gizmo){s=this._gizmo.matrixWorld.clone()}var l=new THREE.Vector3;var c=new THREE.Vector3;var h=new THREE.Vector3;s.extractBasis(l,c,h);l.normalize();c.normalize();h.normalize();var d=[];var u;if(t){u=i(l,r,a,n);d.push(u);u=i(c,r,a,n);d.push(u);u=i(h,r,a,n);d.push(u)}else{u=i(r,l,c,h);d.push(u);u=i(a,l,c,h);d.push(u);u=i(n,l,c,h);d.push(u)}return d};l.prototype._scale=function(e){function t(e,t,i,o){if(t===0){if(o&&i.x>0||!o&&i.x<0){e.x=Math.abs(e.x)}else{e.x=-Math.abs(e.x)}}else if(t===1){if(o&&i.y>0||!o&&i.y<0){e.y=Math.abs(e.y)}else{e.y=-Math.abs(e.y)}}else if(t===2){if(o&&i.z>0||!o&&i.z<0){e.z=Math.abs(e.z)}else{e.z=-Math.abs(e.z)}}}if(!this._beginValue){this._beginValue=this._value.clone()}this._value.multiplyVectors(this._beginValue,e);this._scaleDelta.copy(e);this._nodes.forEach(function(e){var t=e.node;if(!t.userData){t.userData={}}t.userData.skipUpdateJointNode=true});if(this._coordinateSystem===o.Local){this._nodes.forEach(function(t){t.node.scale.copy(t.scaleOrigin).multiply(e);t.node.updateMatrix()})}else{var i=this._matOrigin.clone().scale(e).multiply((new THREE.Matrix4).getInverse(this._matOrigin));this._nodes.forEach(function(r){if(!r.ignore){var a=r.node;a.matrixWorld.multiplyMatrices(i,r.matOrigin);a.matrix.multiplyMatrices(r.matParentInv,a.matrixWorld);if(this._coordinateSystem===o.Parent){var n=a.matrix.clone();n.elements[12]=0;n.elements[13]=0;n.elements[14]=0;var s=(new THREE.Matrix4).makeRotationFromQuaternion(a.quaternion.clone().inverse()).multiply(a.matrix);var l=s.elements;a.scale.x=l[0];a.scale.y=l[5];a.scale.z=l[10];a.updateMatrix()}else{a.matrix.decompose(a.position,new THREE.Quaternion,a.scale);var c=this._alignAxesBetweenGizmoAndNodeCoordinates(a,true);t(a.scale,c[0],r.scaleOrigin,e.x>0);t(a.scale,c[1],r.scaleOrigin,e.y>0);t(a.scale,c[2],r.scaleOrigin,e.z>0);a.updateMatrix()}}}.bind(this))}this._viewport.setShouldRenderFrame()};l.prototype.scale=function(e,t,i){this.beginGesture();this._scale(new THREE.Vector3(e,t,i))};l.prototype._setScale=function(e){var t=this._getNodesProperties();if(this._tool.fireEvent("scaling",{x:e.x,y:e.y,z:e.z,nodesProperties:t},true)){this._printEventInfo("Event 'scaling'",e.x,e.y,e.z,t);this._scale(e)}};l.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):1};l.prototype.setValue=function(e){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var t=e/this._value.getComponent(this._handleIndex);var i=new THREE.Vector3(1,1,1);if(this._nonUniformScaleEnabled){i.setComponent(this._handleIndex,t)}else{i.setScalar(t)}this.beginGesture();this._scale(i);this.endGesture()}};l.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};l.prototype._updateSelection=function(e){t.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._tool.getDetector().setSource(e)}};l.prototype.handleSelectionChanged=function(e){this._sequence=null;if(this._viewport){this._updateSelection(this._viewport._viewStateManager);this._gizmoIndex=this._handleIndex=-1;var t=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:t},true)}};l.prototype._getObjectScale=function(e){if(this._nodes.length===1){return this._nodes[0].node.scale}else if(this._coordinateSystem===o.Local){return this._nodes[e].node.scale}return new THREE.Vector3(1,1,1)};l.prototype._getObjectSize=function(e){var t=new THREE.Box3;if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(t,true,false)}else if(this._coordinateSystem===o.Local){this._nodes[0].node._expandBoundingBox(t,true,false)}if(t.isEmpty()){return 0}var i=new THREE.Vector3;t.getSize(i);return i.length()};l.prototype._updateGizmoTransformation=function(e,t){var i=this._updateGizmoObjectTransformation(this._gizmo,e);this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize+30,i)};l.prototype._getEditingFormPosition=function(){var e=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var t=(new THREE.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.clone().multiplyScalar((this._gizmoSize+18)*e).add(this._gizmo.position).applyMatrix4(this._matViewProj)};l.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,o=this.getGizmoCount();i<o;i++){this._updateGizmoTransformation(i,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleToolGizmoRenderer", [],function(){"use strict";var n={apiVersion:2};n.render=function(n,r){n.openStart("div",r);n.class("sapUiVkTransformationToolEdit");n.openEnd();n.renderControl(r._editingForm);n.close("div")};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(e,t,i,s,n,r){"use strict";var o=e.extend("sap.ui.vk.tools.ScaleToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(e){this._priority=11;this._tool=e;this._gizmo=e.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3;this._handleDirection=new THREE.Vector3;this._gizmoOrigin=new THREE.Vector3;this._mouse=new THREE.Vector2;this._mouseOrigin=new THREE.Vector2;this._originScale=1;this._objectSize=1}});o.prototype._updateMouse=function(e){var t=this.getViewport().getRenderer().getSize(new THREE.Vector2);this._mouse.x=(e.x-this._rect.x)/t.width*2-1;this._mouse.y=(e.y-this._rect.y)/t.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(e,t){var i=this._handleIndex;this._handleIndex=-1;if(e.n===1||e.event&&e.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var r=this._gizmo.getTouchObject(s);var o=this._rayCaster.intersectObjects(r.children,false);if(o.length>0){this._handleIndex=r.children.indexOf(o[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(r.matrixWorld);this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex%3).normalize();this._originScale=this._gizmo._getObjectScale(s).x;this._objectSize=this._gizmo._getObjectSize(s)/r.scale.x||1;var h=(new THREE.Vector3).setFromMatrixColumn(r.matrixWorld,(this._handleIndex+1)%3).normalize();var a=(new THREE.Vector3).setFromMatrixColumn(r.matrixWorld,(this._handleIndex+2)%3).normalize();this._handleDirection.addVectors(h,a).normalize()}}}}this._gizmo.highlightHandle(this._handleIndex,t||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};o.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0}};o.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0}};o.prototype._getAxisOffset=function(){var e=this._rayCaster.ray;var t=this._handleAxis.clone().cross(e.direction).cross(e.direction).normalize();var i=e.origin.clone().sub(this._gizmoOrigin);return t.dot(i)/t.dot(this._handleAxis)};o.prototype._getPlaneOffset=function(){var e=this._rayCaster.ray;var t=this._gizmoOrigin.clone().sub(e.origin);var i=this._handleAxis.dot(t)/this._handleAxis.dot(e.direction);return e.direction.clone().multiplyScalar(i).sub(t)};o.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._mouseOrigin.set(e.x,e.y);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._handleDirection.dot(this._getPlaneOffset())}}}};o.prototype.move=function(e){if(this._gesture){if(this._tool.getEnableSnapping()){this._tool.getDetector().detect({viewport:this._tool._viewport,gizmo:this._gizmo,detectType:"scale"})}e.handled=true;this._updateMouse(e);var t=(new THREE.Vector3).setScalar(1);if(this._handleIndex<3){if(this._tool.getNonUniformScaleEnabled()){t.setComponent(this._handleIndex,this._getAxisOffset()/this._dragOrigin)}else{t.setScalar(this._getAxisOffset()/this._dragOrigin)}}else if(this._handleIndex<6){t.setScalar(this._handleDirection.dot(this._getPlaneOffset())/this._dragOrigin).setComponent(this._handleIndex-3,1)}else{var i=(this._mouseOrigin.y-e.y)/60;t.setScalar(i>=0?1+i:1/(1-i))}if(t.x&&t.y&&t.z&&isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._originScale/this._objectSize)))/this._originScale;if(s>0&&isFinite(s)){t.setScalar(Math.max(Math.round(t.x/s),1)*s)}}this._gizmo._setScale(t)}}};o.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var n=new t({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:r.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:r.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:r.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:r.Custom})],itemSelected:function(e){var t=e.getParameters("item").item;this._tool.setCoordinateSystem(t.getKey())}.bind(this)});n.openAsContextMenu(e.event,this.getViewport())}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(e){var t=e.getBoundingClientRect();var i={x:t.left+window.pageXOffset,y:t.top+window.pageYOffset};return i};o.prototype._inside=function(e){if(this._rect===null||true){var t=this._tool._viewport.getIdForLabel();var i=document.getElementById(t);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight}}return e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/SceneOrientationTool", ["./Tool","./SceneOrientationToolGizmo"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.SceneOrientationTool",{metadata:{library:"sap.ui.vk",properties:{enablePredefinedViews:{type:"boolean",defaultValue:true},enableInitialView:{type:"boolean",defaultValue:true}}},constructor:function(e,o){if(i._instance){return i._instance}t.apply(this,arguments);this._viewport=null;this._menu=null;i._instance=this}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new e)};i.prototype.setActive=function(e,i,o){t.prototype.setActive.call(this,e,i,o);this.getGizmo()._viewport=this._viewport;return this};i.prototype.setView=function(t,e){this.getGizmo().setView(t,e);return this};i.prototype.setEnableInitialView=function(t){this.setProperty("enableInitialView",t);this.getGizmo().setEnableInitialView(t)};i.prototype.queueCommand=function(t){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(t,this._dvlRendererId)}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}return this};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;delete i._instance};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/SceneOrientationToolGizmo", ["./Gizmo","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","../thirdparty/three","./SceneOrientationToolGizmoRenderer","../getResourceBundle","./PredefinedView","./AxisColours"],function(e,t,i,a,n,r,s,o,l){"use strict";sap.ui.require("sap.m.Menu");var E=e.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk"}});function c(e,t){var i=64,a=.5,n=15,r=3,s=29,o=30;e.multiplyScalar(1/80);var l=new THREE.Vector3(e.y,e.z,e.x),E=new THREE.Vector3(e.z,e.x,e.y);var c=new THREE.MeshLambertMaterial({color:t}),p=new THREE.MeshBasicMaterial({color:16777215,transparent:true,opacity:.8}),d=new THREE.MeshBasicMaterial({color:0,transparent:true,opacity:.8});var h=new THREE.CylinderBufferGeometry(a,a,i-n,4);var u=(new THREE.Matrix4).makeBasis(l,e,E).setPosition(e.clone().multiplyScalar((i-n)*.5));h.applyMatrix4(u);var m=new THREE.Mesh(h,c);var T=new THREE.CylinderBufferGeometry(0,r,n,12,1);u.setPosition(e.clone().multiplyScalar(i-n*.5));T.applyMatrix4(u);m.add(new THREE.Mesh(T,c));var w=new THREE.CylinderBufferGeometry(a,a,s,4);u.makeBasis(e,E,l).setPosition(E.clone().multiplyScalar(.5).add(e).multiplyScalar(s));w.applyMatrix4(u);m.add(new THREE.Mesh(w,p));w=new THREE.CylinderBufferGeometry(a,a,s,4);u.setPosition(E.clone().multiplyScalar(.5).add(e).add(l).multiplyScalar(s));w.applyMatrix4(u);m.add(new THREE.Mesh(w,p));w=new THREE.CylinderBufferGeometry(a,a,s,4);u.makeBasis(E,l,e).setPosition(l.clone().multiplyScalar(.5).add(e).multiplyScalar(s));w.applyMatrix4(u);m.add(new THREE.Mesh(w,p));w=new THREE.CylinderBufferGeometry(a,a,o,4);u.makeBasis(e,E,l).setPosition(E.clone().multiplyScalar(.5).add(e).multiplyScalar(o));w.applyMatrix4(u);m.add(new THREE.Mesh(w,d));w=new THREE.CylinderBufferGeometry(a,a,o,4);u.setPosition(E.clone().multiplyScalar(.5).add(e).add(l).multiplyScalar(o));w.applyMatrix4(u);m.add(new THREE.Mesh(w,d));w=new THREE.CylinderBufferGeometry(a,a,o,4);u.makeBasis(E,l,e).setPosition(l.clone().multiplyScalar(.5).add(e).multiplyScalar(o));w.applyMatrix4(u);m.add(new THREE.Mesh(w,d));return m}E.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._enableInitialView=true;this._viewport=null;this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new THREE.OrthographicCamera(-1,1,1,-1,.1,100);this._scene=new THREE.Scene;var n=new THREE.DirectionalLight(16777215,.5);n.position.set(1,3,2);this._scene.add(n);this._scene.add(new THREE.AmbientLight(16777215,.5));this._scene.add(c(new THREE.Vector3(1,0,0),l.x));this._scene.add(c(new THREE.Vector3(0,1,0),l.y));this._scene.add(c(new THREE.Vector3(0,0,1),l.z));this._scene.traverse(function(e){e.matrixAutoUpdate=false});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);var r=[o.Initial,o.Front,o.Back,o.Left,o.Right,o.Top,o.Bottom];this._menu=new i({items:[new a({text:s().getText("PREDEFINED_VIEW_INITIAL")}),new a({text:s().getText("PREDEFINED_VIEW_FRONT")}),new a({text:s().getText("PREDEFINED_VIEW_BACK")}),new a({text:s().getText("PREDEFINED_VIEW_LEFT")}),new a({text:s().getText("PREDEFINED_VIEW_RIGHT")}),new a({text:s().getText("PREDEFINED_VIEW_TOP")}),new a({text:s().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(e){var t=e.getParameters("item").item;var i=e.getSource().indexOfItem(t);this.setView(r[i],1e3)},this);this._button=new t({icon:"sap-icon://vk-icons/predefined-views",tooltip:s().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:this._menu}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton").addStyleClass("sapUiSizeCompact")};E.prototype.setView=function(e,t){var i;switch(e){case o.Initial:i=null;break;case o.Front:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;case o.Back:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case o.Left:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case o.Right:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case o.Top:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case o.Bottom:i=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;default:return this}this._viewport._viewportGestureHandler.setView(i,t||0);return this};E.prototype.setEnableInitialView=function(e){this._enableInitialView=e;var t=this._menu.getItems();t[0].setVisible(e);t[1].setStartsSection(e)};E.prototype.render=function(e){this._viewport=e;this._camera.quaternion.copy(e.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var t=this._renderer.getSize(new THREE.Vector2).x;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,t*.45,2/t);this._renderer.render(this._scene,this._camera)};E.prototype.onBeforeRendering=function(){};E.prototype.onAfterRendering=function(){var e=this.getDomRef();this._renderer.setSize(e.clientWidth,e.clientHeight);e.appendChild(this._renderer.domElement)};E.prototype.exit=function(){if(this._axisTitles){if(this._scene){this._scene.remove(this._axisTitles)}this._axisTitles=null}if(this._camera){if(this._scene){this._scene.remove(this._camera)}this._camera=null}if(this._scene){this._scene.dispose();this._scene=null}e.prototype.exit.call(this)};return E});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/SceneOrientationToolGizmoRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.class("sapUiVizKitSceneOrientationGizmo");e.openEnd();if(n.getParent().getEnablePredefinedViews()){e.renderControl(n._button)}e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/Tool", ["sap/ui/core/Element","sap/base/Log"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.Tool",{metadata:{library:"sap.ui.vk",properties:{targetViewportType:"any",toolid:"string",active:{type:"boolean",defaultValue:false},footprint:{type:"string[]"}},associations:{gizmoContainer:{type:"sap.ui.core.Control",multiple:false}},aggregations:{gizmo:{type:"sap.ui.vk.tools.Gizmo",multiple:false}},events:{enabled:{parameters:{enabled:"boolean",reason:"string"}}}},constructor:function(e,i){this._viewport=null;this._handler=null;t.apply(this,arguments)}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}};i.prototype.getViewport=function(){return this._viewport};i.prototype.setViewport=function(t){var e=t&&t.getMetadata().getName();this._viewport=e!=null&&this.getFootprint().indexOf(e)>=0?t:null};i.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true}return false};i.prototype.getViewportImplementation=function(t){var e=t;if(t&&typeof t.getImplementation==="function"){e=t.getImplementation()||t}return e};i.prototype.setActive=function(t,i,o){if(t===this.getProperty("active")){return}var r=this.getViewportImplementation(i)||this._viewport;var n=r&&r.getMetadata().getName();var a;if(this.getFootprint().indexOf(n)>=0){this._viewport=r;this.setProperty("active",t,true);if(this.getGizmo()){o=o||r;this.setAssociation("gizmoContainer",o);if(o.getDomRef()){o.invalidate()}}this._viewport.setShouldRenderFrame();a=t?"":"Disabled by application logic"}else{this._viewport=null;this.setProperty("active",false,true);a="Tool does not support Viewport type: "+n;e.warning(a)}this.fireEnabled({enabled:this.getActive(),reason:a})};i.prototype.getGizmoForContainer=function(t){var e=this.getGizmo();if(t.getId()===this.getGizmoContainer()&&e&&this.getActive()){return e}};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._handler=null};i.prototype._addLocoHandler=function(){if(!this._viewport||!this._viewport._loco){return false}this._viewport._loco.addHandler(this._handler,this._handler._priority);return true};i.prototype._removeLocoHandler=function(t){if(this._viewport&&this._viewport._loco){this._viewport._loco.removeHandler(this._handler)}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ToolNodeSet", [],function(){"use strict";var i={Highlight:"Highlight",Outline:"Outline"};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipTool", ["./Tool","./TooltipToolHandler","./TooltipToolGizmo"],function(t,i,e){"use strict";var o=t.extend("sap.ui.vk.tools.TooltipTool",{metadata:{library:"sap.ui.vk",properties:{followCursor:{type:"boolean",defaultValue:true},animate:{type:"boolean",defaultValue:false},offsetX:{type:"float",defaultValue:10},offsetY:{type:"float",defaultValue:15}},events:{hover:{parameters:{x:"int",y:"int",nodeRef:"any"}}}},constructor:function(e,s){if(o._instance){return o._instance}t.apply(this,arguments);this._viewport=null;this._handler=new i(this);o._instance=this}});o.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new e)};o.prototype.setAnimate=function(t){this.setProperty("animate",t);var i=this.getGizmo();i.rerender()};o.prototype.setActive=function(i,e,o){t.prototype.setActive.call(this,i,e,o);if(this._viewport){if(i){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};o.prototype.setTitle=function(t){if(this._gizmo){this._gizmo.setTitle(t)}return this};o.prototype.queueCommand=function(t){if(this._addLocoHandler()){var i=this.getFootprint();for(var e=0;e<i.length;e++){if(this.isViewportType(i[e])){t();break}}}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipToolGizmo", ["./Gizmo","./TooltipToolGizmoRenderer"],function(t,o){"use strict";var e=t.extend("sap.ui.vk.tools.TooltipToolGizmo",{metadata:{library:"sap.ui.vk"}});e.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._previousNodeRef=null};e.prototype.show=function(t,o){this._viewport=t;this._tool=o;var e=this.getDomRef();if(e){e.style.display="none"}};e.prototype.hide=function(){this._tool=null;var t=this.getDomRef();if(t){t.style.display="none"}};e.prototype.setTitle=function(t){var o=this.getDomRef();if(o){o.style.display=t?"block":"none";o.innerText=t}};e.prototype.update=function(t,o,e,i,n){if(!this._tool.getFollowCursor()){if(n===this._previousNodeRef){return}else{this._previousNodeRef=n}}if(this._tool.fireEvent("hover",{x:t,y:o,nodeRef:n},true)){var r=this.getDomRef();if(r){var s=r.offsetParent;while(s){e-=s.offsetLeft||0;i-=s.offsetTop||0;s=s.offsetParent}e+=this._tool.getOffsetX();i+=this._tool.getOffsetY();r.style.left=Math.round(e)+"px";r.style.top=Math.round(i)+"px";var f=this._viewport.getDomRef().getBoundingClientRect();var l=r.getBoundingClientRect();if(l.right>f.right){r.style.left=Math.round(e+f.right-l.right)+"px"}if(l.bottom>f.bottom){r.style.top=Math.round(i+f.bottom-l.bottom)+"px"}}}};e.prototype.onBeforeRendering=function(){};e.prototype.onAfterRendering=function(){};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipToolGizmoRenderer", [],function(){"use strict";var i={apiVersion:2};i.render=function(i,t){i.openStart("div",t);i.class("sapUiVizKitTooltip");if(t.getParent().getAnimate()){i.class("sapUiVizKitTooltipAnimation")}i.openEnd();i.close("div")};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.TooltipToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)&&this.getViewport().getScene()){var o=this._tool._viewport.hitTest(t.x-this._rect.x,t.y-this._rect.y);if(o&&o.object){o=o.object}e.update(t.x-this._rect.x,t.y-this._rect.y,t.x,t.y,o);t.handled=o!=null}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype.getViewport=function(){return this._tool._viewport};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementTool", ["sap/base/Log","../library","./Tool","./TransformSvgElementToolHandler","./TransformSvgElementToolGizmo","./ToolNodeSet","../svg/Rectangle"],function(t,e,o,i,s,a,r){"use strict";var n=o.extend("sap.ui.vk.tools.TransformSvgElementTool",{metadata:{library:"sap.ui.vk",properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:a.Highlight},uniformScaleEnabled:{type:"boolean",defaultValue:false}},events:{moving:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},moved:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},rotating:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},rotated:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},scaling:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},scaled:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}}}},constructor:function(t,e){if(n._instance){return n._instance}o.apply(this,arguments);this._viewport=null;this._handler=new i(this);n._instance=this}});n.prototype.init=function(){if(o.prototype.init){o.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,e,i){o.prototype.setActive.call(this,t,e,i);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolGizmo", ["./Gizmo","./TransformSvgElementToolGizmoRenderer","../svg/Element","./ToolNodeSet"],function(t,e,r,i){"use strict";var a=t.extend("sap.ui.vk.tools.TransformSvgElementToolGizmo",{metadata:{library:"sap.ui.vk"}});a.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes=[];this._cursor=null;this.handleSelectionChanged();t.attachCameraChanged(this._handleChanged,this);if(t._viewStateManager){t._viewStateManager.attachTransformationChanged(this._handleChanged,this)}};a.prototype.hide=function(){if(this._cursor){this._viewport.removeStyleClass(this._cursor);this._cursor=null}if(this._viewport._viewStateManager){this._viewport._viewStateManager.detachTransformationChanged(this._handleChanged,this)}this._viewport.detachCameraChanged(this._handleChanged,this);this._viewport=null;this._tool=null;this._nodes=[]};a.prototype._handleChanged=function(){if(this.getDomRef()){this.rerender()}};a.prototype._getHandleLocalPositions=function(t,e){var r=t.bbox;var i=r.x;var a=r.x+r.width;var n=(i+a)*.5;var o=r.y+r.height*.5;var s=r.height*.5*t.ySign;var h=o-s;var l=o+s;var v=h-48*t.ySign/(this._viewport._camera.zoom*Math.sqrt(e[2]*e[2]+e[3]*e[3]));return[n,h,a,h,a,o,a,l,n,l,i,l,i,o,i,h,n,v,n,o]};a.prototype._selectHandle=function(t,e){this._gizmoIndex=t;this._handleIndex=e;var r=null;if(t>=0){if(e>=0){if(e<8){var i=this._nodes[t];var a=i.node._matrixWorld();var n=Math.round(Math.atan2(a[2],a[3])*4/Math.PI);r=["NSResize","NESWResize","EWResize","NWSEResize"][(16-n+e*i.xSign*i.ySign)%4]}else{r="Rotate"}}else{r="Move"}r="sapUiVkTransformationToolCursor"+r}if(this._cursor!=r){if(this._cursor){this._viewport.removeStyleClass(this._cursor)}if(r){this._viewport.addStyleClass(r)}this._cursor=r}};function n(t){return{x:t[4],y:t[5]}}function o(t){return{x:Math.sqrt(t[0]*t[0]+t[1]*t[1]),y:Math.sqrt(t[2]*t[2]+t[3]*t[3])}}function s(t){return Math.atan2(t[0],t[1])}function h(t){if(t<-Math.PI){return t+Math.PI*2}else if(t>Math.PI){return t-Math.PI*2}return t}function l(t){var e=null;while(t.parent){e=t;t=t.parent}return e&&e.matrix[3]<0?-1:1}function v(t,e,r,i){return t*r+e*i}function d(t){return t[0]*t[3]-t[1]*t[2]}a.prototype.handleSelectionChanged=function(){var t=this._viewport?this._viewport._viewStateManager:null;if(t===null){return}var e=[];if(this._tool){t[this._tool.getNodeSet()===i.Highlight?"enumerateSelection":"enumerateOutlinedNodes"](function(t){var i=t._matrixWorld();var a=d(i)<0?-1:1;if(t.parent){i=r._multiplyMatrices(r._invertMatrix(t.parent._matrixWorld()),i)}e.push({node:t,bbox:t._getBBox(),position:n(i),scale:o(i),angle:s(i),xSign:a,ySign:l(t)})})}if(this._nodes.length===e.length&&this._nodes.every(function(t,r){return e[r].node===t.node})){return}this._nodes=e;if(this.getDomRef()){this.rerender()}};a.prototype._beginGesture=function(){this._nodes.forEach(function(t){var e=t.node;t.beginWorldMatrix=e._matrixWorld();t.bbox=e._getBBox()});this._eventParameters=null};function _(t,e,r,i,a,n){var o=v(t,e,r+a,i+n);var s=v(t,e,r,i);return s!==0?o/s:1}a.prototype._update=function(t,e,i){var a=this._handleIndex;var l=a>=0&&a<8?(a+4)%8:9;var u=1,f=1,c=1,g=0;var p=[];var x;var m={nodesProperties:p};if(a<0){x="moving";m.x=t;m.y=e}else{var y=this._nodes[this._gizmoIndex];var M=y.beginWorldMatrix;var S=this._getHandleLocalPositions(y,M);if(a<8){x="scaling";var w=S[l*2];var C=S[l*2+1];var P=S[a*2];var b=S[a*2+1];var E=v(P-w,b-C,M[0],M[2]);var W=v(P-w,b-C,M[1],M[3]);u=a===0||a===4?1:_(M[0],M[1],E,W,t,e);f=a===2||a===6?1:_(M[2],M[3],E,W,t,e);if(this._tool.getUniformScaleEnabled()^i){if(a===0||a===4){u=f}else if(a===2||a===6){f=u}else{u=f=Math.max(u,f)}}m.x=u;m.y=f}else{x="rotating";var z=r._transformPoint(S[18],S[19],M);var I=r._transformPoint(S[16],S[17],M);var T=Math.atan2(I.x-z.x,I.y-z.y);var R=Math.atan2(I.x-z.x+t,I.y-z.y+e);var N=h(R-T);m.angle=N;c=Math.cos(N);g=Math.sin(N)}}this._nodes.forEach(function(i){var v=i.node;var _=i.beginWorldMatrix.slice();var x={node:v};if(a<0){_[4]+=t;_[5]+=e}else{var m=this._getHandleLocalPositions(i,_);if(a<8){var y=m[l*2];var M=m[l*2+1];_[4]+=y*_[0]+M*_[2];_[5]+=y*_[1]+M*_[3];_[0]*=u;_[1]*=u;_[2]*=f;_[3]*=f;_[4]-=y*_[0]+M*_[2];_[5]-=y*_[1]+M*_[3]}else{var S=r._transformPoint(m[18],m[19],_);var w=new Float32Array([c,-g,g,c,S.x-(S.x*c+S.y*g),S.y-(S.x*-g+S.y*c)]);_=r._multiplyMatrices(w,_)}}i.xSign=d(_)<0?-1:1;if(v.parent){_=r._multiplyMatrices(r._invertMatrix(v.parent._matrixWorld()),_)}if(a<0){var C=n(_);x.x=C.x-i.position.x;x.y=C.y-i.position.y}else if(a<8){var P=o(_);x.x=P.x/i.scale.x;x.y=P.y/i.scale.y}else{x.angle=h(s(_)-i.angle)}v.setMatrix(_);p.push(x)}.bind(this));this.rerender();this._eventParameters=m;this._tool.fireEvent(x,m,true)};a.prototype._endGesture=function(){if(this._eventParameters){var t=this._handleIndex;var e;if(t<0){e="moved"}else if(t<8){e="scaled"}else{e="rotated"}this._tool.fireEvent(e,this._eventParameters,true)}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolGizmoRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,r){if(!r._viewport){return}var e=r._viewport._getViewBox();t.openStart("svg",r);t.attr("xmlns","http://www.w3.org/2000/svg");t.attr("width","100%");t.attr("height","100%");t.attr("viewBox",e.join(" "));t.style("position","absolute");t.style("pointer-events","none");t.openEnd();t.openStart("defs");t.openEnd();t.openStart("filter");t.attr("id","shadow-effect");t.openEnd();t.openStart("feDropShadow");t.attr("dx","0");t.attr("dy","0");t.attr("stdDeviation","2");t.attr("flood-color","#000");t.openEnd();t.close("feDropShadow");t.close("filter");t.close("defs");var a=1/r._viewport._camera.zoom;function o(r,e,a,o){t.openStart("rect");t.attr("fill","#fff");t.attr("stroke","#000");t.attr("stroke-width",1);t.attr("vector-effect","non-scaling-stroke");t.attr("filter","url(#shadow-effect)");var n=Math.abs(8*a);var i=Math.abs(8*o);t.attr("x",r-n*.5);t.attr("y",e-i*.5);t.attr("width",n);t.attr("height",i);t.openEnd();t.close("rect")}r._nodes.forEach(function(e){var n=e.node;var i=e.bbox;if(i){var s=n._matrixWorld();var c=r._getHandleLocalPositions(e,s);var l=a*e.xSign*e.ySign/Math.sqrt(s[0]*s[0]+s[1]*s[1]);var f=a*e.ySign/Math.sqrt(s[2]*s[2]+s[3]*s[3]);t.openStart("g");t.attr("transform","matrix("+s.join(",")+")");t.openEnd();t.openStart("rect");t.attr("fill","none");t.attr("stroke","#fff");t.attr("vector-effect","non-scaling-stroke");t.attr("x",i.x);t.attr("y",i.y);t.attr("width",i.width);t.attr("height",i.height);t.openEnd();t.close("rect");t.openStart("rect");t.attr("fill","none");t.attr("stroke","#000");t.attr("stroke-dasharray","5 5");t.attr("vector-effect","non-scaling-stroke");t.attr("x",i.x);t.attr("y",i.y);t.attr("width",i.width);t.attr("height",i.height);t.openEnd();t.close("rect");t.openStart("line");t.attr("stroke","#fff");t.attr("vector-effect","non-scaling-stroke");t.attr("x1",c[0]);t.attr("y1",c[1]);t.attr("x2",c[16]);t.attr("y2",c[17]);t.openEnd();t.close("line");t.openStart("line");t.attr("stroke","#000");t.attr("stroke-dasharray","5 5");t.attr("vector-effect","non-scaling-stroke");t.attr("x1",c[0]);t.attr("y1",c[1]);t.attr("x2",c[16]);t.attr("y2",c[17]);t.openEnd();t.close("line");t.openStart("g");t.attr("transform","matrix("+l+",0,0,"+f+","+(c[16]-8*l)+","+(c[17]-8*f)+")");t.openEnd();t.openStart("circle");t.attr("fill","#fff");t.attr("stroke","#000");t.attr("cx","8");t.attr("cy","8");t.attr("r","7.5");t.openEnd();t.close("circle");t.openStart("path");t.attr("fill","#000");t.attr("d","M8,12.94A4.84,4.84,0,1,1,8,3.27h2.84v1H8a3.84,3.84,0,1,0,3.84,3.84h1A4.84,4.84,0,0,1,8,12.94Z");t.openEnd();t.close("path");t.openStart("path");t.attr("fill","#000");t.attr("d","M9.89,5.59a.5.5,0,0,1-.34-.88l1.09-1L9.56,2.83a.51.51,0,0,1-.05-.71.49.49,0,0,1,.7-.05l1.51,1.31a.48.48,0,0,1,.17.37.49.49,0,0,1-.16.38L10.22,5.46A.5.5,0,0,1,9.89,5.59Z");t.openEnd();t.close("path");t.openStart("circle");t.attr("fill","#000");t.attr("cx","8");t.attr("cy","8");t.attr("r","0.83");t.openEnd();t.close("circle");t.close("g");for(var p=0;p<8;p++){o(c[p*2],c[p*2+1],l,f)}t.close("g")}});t.close("svg")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.TransformSvgElementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null}});i.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};i.prototype._getGizmoHandle=function(t){var i=this._tool._viewport;if(!i||!this._gizmo||!this._inside(t)){return null}if(t.scroll!==undefined){return null}var o=i._camera;var n=this._gizmo._nodes;if(!o||!n||n.length===0){return null}var r=t.x-this._rect.x;var s=t.y-this._rect.y;var a=this._getPosition(t);var h=12;var _=-1;for(var l=0;l<n.length;l++){var d=n[l];var u=d.node;var c=u._getBBox();if(!c){continue}var f=u._matrixWorld();var v=this._gizmo._getHandleLocalPositions(d,f);var g=[0,4,2,6,8,1,3,5,7];for(var p=0;p<9;p++){var y=g[p];var m=e._transformPoint(v[y*2],v[y*2+1],f);var x=o._worldToScreen(m.x,m.y);if(r>=x.x-h&&r<=x.x+h&&s>=x.y-h&&s<=x.y+h){return{gizmoIndex:l,handleIndex:y,angle:Math.atan2(f[2],f[3])}}}if(_<0){var z=h/(o.zoom*Math.sqrt(f[0]*f[0]+f[1]*f[1]));var w=h/(o.zoom*Math.sqrt(f[2]*f[2]+f[3]*f[3]));var P=e._transformPoint(a.x,a.y,e._invertMatrix(f));if(P.x>=c.x-z&&P.x<=c.x+c.width+z&&P.y>=c.y-w&&P.y<=c.y+c.height+w){_=l}}}return _<0?null:{gizmoIndex:_,handleIndex:-1}};i.prototype.hover=function(t){if(this._gizmo){var e=this._getGizmoHandle(t);if(e){this._gizmo._selectHandle(e.gizmoIndex,e.handleIndex)}else{this._gizmo._selectHandle(-1,-1)}}};i.prototype.beginGesture=function(t){this._handle=t.buttons===1&&this._getGizmoHandle(t)||null;if(this._handle){t.handled=true;this._gizmo._selectHandle(this._handle.gizmoIndex,this._handle.handleIndex);this._startPos=this._getPosition(t);this._gizmo._beginGesture()}};i.prototype.move=function(t){if(this._handle&&this._inside(t)){t.handled=true;var e=this._getPosition(t);this._gizmo._update(e.x-this._startPos.x,e.y-this._startPos.y,t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};i.prototype.endGesture=function(t){if(this._handle){this._handle=null;t.handled=true;this._gizmo._endGesture()}};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/CallbackHandler", [],function(){"use strict";var t=function(){this.callbacks=[]};t.prototype.attach=function(t){this.callbacks.push(t)};t.prototype.detach=function(t){var c=this.callbacks.indexOf(t);if(c!==-1){this.callbacks.splice(c,1);return true}return false};t.prototype.execute=function(t){for(var c=0;c<this.callbacks.length;c++){this.callbacks[c](t)}};t.prototype.detachAll=function(){this.callbacks=[]};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/Command", [],function(){"use strict";var e={addClientLog:"addClientLog",getAnnotation:"getAnnotation",getDynamicView:"getDynamicView",getGeometry:"getGeometry",getHighlightStyle:"getHighlightStyle",getImage:"getImage",getImageDetails:"getImageDetails",getMaterial:"getMaterial",getMesh:"getMesh",getParametric:"getParametric",getGeomMesh:"getGeomMesh",getScene:"getScene",getSequence:"getSequence",getTrack:"getTrack",getTree:"getTree",getView:"getView",getViewAnimations:"getViewAnimations",getViewGroups:"getViewGroups",notifyError:"notifyError",notifyFinishedTree:"notifyFinishedTree",notifyFinishedView:"notifyFinishedView",requestScene:"requestScene",setAnnotation:"setAnnotation",setCamera:"setCamera",setGeometry:"setGeometry",setHighlightStyle:"setHighlightStyle",setImage:"setImage",setMaterial:"setMaterial",setMesh:"setMesh",setLineStyle:"setLineStyle",setFillStyle:"setFillStyle",setTextStyle:"setTextStyle",setParametric:"setParametric",setScene:"setScene",setPlayback:"setPlayback",setSequence:"setSequence",setStreamingToken:"setStreamingToken",setTrack:"setTrack",setTree:"setTree",setTreeNode:"setTreeNode",setView:"setView",setViewGroup:"setViewGroup",setViewNode:"setViewNode",timestamp:"timestamp",performanceTiming:"performanceTiming",suppressSendRequests:"suppressSendRequests",unsuppressSendRequests:"unsuppressSendRequests",setMaxActiveRequests:"setMaxActiveRequests"};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/GeometryFactory", ["./IndexCompressor"],function(r){"use strict";var a=1;var e=2;var t=4;var u=0;var o=3;var n=function(){};n.getGeometryInfo=function(u,o){var n=new DataView(o.buffer,o.byteOffset,o.byteLength);var s=0;var l=(u.flags&e)>0;var C=(u.flags&t)>0;var p=(u.flags&a)>0;var y=false;var m=[];var d=[];var h=[];var g=[];var c=[-.5,-.5,-.5,.5,.5,.5];var B=new r(o,o.length);B.setCurByte(s);if(!B.ReadCommand()){throw"buffer over flow"}var F=B.rvalue;var O;if(F){O=i(B,u.pointCount,F,c,m);if(O.isOk){m=O.array;y=true}else{return false}}var k=1;if(l){if(!B.ReadCommand()){return false}k=B.rvalue;if(k){O=f(B,u.pointCount,k);if(O.isOk){d=O.array}else{return false}}}var R=1;var w=false;if(C){if(!B.ReadCommand()){return false}R=B.rvalue;if(R){O=v(B,u.pointCount,R);if(O.isOk){w=true;h=O.array}else{return false}}}if(!F||!k||!R||w){if(w){s=B.getCurByte();var M=n.getFloat32(s,true);var b=n.getFloat32(s+4,true);B.moveCurByte(8);if(M!==0||b!==1){var I=b-M;for(var P=0;P<u.pointCount*2;P++){h[P]=h[P]*I+M}}}var A;if(!F){s=B.getCurByte();for(A=0;A<u.pointCount;A++){m.push(n.getFloat32(s+A*4,true));m.push(n.getFloat32(s+(A+u.pointCount)*4,true));m.push(n.getFloat32(s+(A+u.pointCount*2)*4,true))}B.moveCurByte(u.pointCount*3*4)}if(!k){s=B.getCurByte();for(A=0;A<u.pointCount;A++){d.push(n.getFloat32(s+A*4,true));d.push(n.getFloat32(s+(A+u.pointCount*1)*4,true));d.push(n.getFloat32(s+(A+u.pointCount*2)*4,true))}B.moveCurByte(u.pointCount*3*4)}if(!R){if(C){s=B.getCurByte();for(A=0;A<u.pointCount;A++){h.push(n.getFloat32(s+A*4,true));h.push(n.getFloat32(s+(A+u.pointCount*1)*4,true))}B.moveCurByte(u.pointCount*2*4)}}}var D=B.getCurByte();B.Reset();B.setCurByte(D);var x=[0,0,0];var z=p?2:3;for(var G=0;G<u.elementCount;G++){for(var L=0;L<z;L++){if(!B.ReadCommand(x[L])){throw"UIC1 Decompression error!!!"}else{g.push(B.rvalue);x[L]=B.rvalue}}}return{id:u.id,isPolyline:p,isPositionQuantized:y,data:{indices:g,points:m,normals:d,uvs:h}}};function i(r,a,e,t){var n={array:new Array(a*3),isOk:false};for(var i=0;i<3;i++){var f=t[u+i];var v=(t[o+i]-f)/e;for(var s=0;s<a;s++){if(!r.ReadCommand()){return n}n.array[s*3+i]=v*r.rvalue+f}}n.isOk=true;return n}function f(r,a,e){var t={array:[],isOk:false};var u=[];var o;for(o=0;o<a;o++){if(!r.ReadCommand()){return t}u.push(r.rvalue)}var n=2*Math.PI/e;var i;var f;var v;for(o=0;o<a;o++){if(!r.ReadCommand()){return t}i=n*u[o];f=n*r.rvalue;v=Math.sin(f);t.array.push(v*Math.cos(i));t.array.push(v*Math.sin(i));t.array.push(Math.cos(f))}t.isOk=true;return t}function v(r,a,e){var t={array:new Array(a*2),isOk:false};var u=1/e;for(var o=0;o<2;o++){for(var n=0;n<a;n++){if(!r.ReadCommand()){return false}t.array[n*2+o]=u*r.rvalue}}t.isOk=true;return t}return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/IndexCompressor", [],function(){"use strict";var a=function(a,r){var e=32;var s=16;var v=13;var t=14;var i=0;var u=1;var l=3;var c=4;var n=5;var h=6;var f=7;var b=8;var k=9;var o=10;var d=11;var y=12;var w=15;var C=0;var m=1;var B=2;var R=3;var A=4;var g=5;var p=6;var j=7;var q=8;var x=9;var z=10;var D=11;var E=12;var F=13;var G=4294967295;var H=0;this.rvalue=0;var I=0;var J=a;var K=r;var L=0;var M=new Array(e);var N=new Array(s);var O=e-1;var P=s-1;var Q=false;this.Reset=function(){H=0;this.rvalue=0;I=0;L=0;var a;for(a=0;a<e;a++){M[a]=e-a-1}for(a=0;a<s;a++){N[a]=1}O=e-1;P=s-1};this.Reset();function S(a){return M[O>=a?O-a:e+O-a]}function T(a){return N[P>=a?P-a:s+P-a]}function U(a){O++;if(O>=e){O=0}M[O]=a}function V(a){P++;if(P>=s){P=0}N[P]=a}function W(){if(L<K){return J[L++]}Q=true;return 0}function X(){return W()+W()*256}function Y(){return W()+W()*256+W()*65536+W()*16777216}this.ReadCommand=function(a){if(a===undefined){a=G}Q=false;var r=this.rvalue;if(H){H--;this.rvalue=S(I)}else{var e=W();if(Q){e=u}var s=e>>>4;switch(e&15){case i:this.rvalue=S(s);break;case n:this.rvalue=S(16+s);break;case v:this.rvalue=S(s>>>2);I=s&3;H=1;break;case t:this.rvalue=S(0);I=0;H=s+2;break;case h:this.rvalue+=T(s);break;case u:if(e&16){this.rvalue+=(e>>>5)+1}else{this.rvalue-=(e>>>5)+1}break;case l:this.rvalue=a+(s+1);break;case c:this.rvalue=a-(s+1);break;case f:this.rvalue=a+(s+17);break;case b:this.rvalue=a-(s+17);break;case k:this.rvalue+=s+(W()<<4)+3;break;case o:this.rvalue-=s+(W()<<4)+3;break;case d:this.rvalue=s+(W()<<4);break;case y:var J=X();this.rvalue=s+(J<<4);break;case w:switch(e>>>4){case C:case m:case B:case R:case A:this.rvalue=e>>>4;break;case g:this.rvalue=255;break;case p:this.rvalue=65280;break;case j:this.rvalue=16711680;break;case q:this.rvalue=4278190080;break;case x:this.rvalue=16777215;break;case z:this.rvalue=4294967295;break;case F:I=0;H=X()+36;break;case D:{var K=W();this.rvalue=(X()<<8)+K}break;case E:this.rvalue=Y();break;default:return false}break;default:return false}}if(this.rvalue>4294967295){this.rvalue=this.rvalue-4294967295-1}U(this.rvalue);var L;if(this.rvalue!=r){if(this.rvalue>r){L=this.rvalue-r;if(L<2147483647){V(L)}}else{L=r-this.rvalue;if(L<2147483647){V(-L)}}}if(Q){H=0;this.rvalue=0;return false}return true};this.getCurByte=function(){return L};this.setCurByte=function(a){L=a};this.moveCurByte=function(a){L=L+a}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/ProgressCounter", [],function(){"use strict";function t(){this._count=0;this._total=0;var t;this.setOnValueChanged=function(n){t=n};this.callOnValueChanged=function(){if(t){t()}}}var n=t.prototype;Object.defineProperty(n,"count",{get:function(){return this._count},set:function(t){if(t!==this._count){this._count=t;this.callOnValueChanged()}}});Object.defineProperty(n,"total",{get:function(){return this._total},set:function(t){if(t!==this._total){this._total=t;this.callOnValueChanged()}}});var e=function(){var n;function e(){if(n){n(this)}}this.mesh=new t;this.geometry=new t;this.mesh.setOnValueChanged(e);this.geometry.setOnValueChanged(e);this.setOnProgressChanged=function(t){n=t}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/RequestQueue", ["./TotaraUtils","./Command","../IncludeUsageIdType","sap/base/Log"],function(t,e,i,s){"use strict";function h(t){this.getBatchSize=t;this.globalList=new Set;this.requestedList=[];this.waitingList=new Map}h.prototype.push=function(t,e){if(!this.globalList.has(t)){this.globalList.add(t);this.requestedList.push(e||t);this.waitingList.set(t,e)}};h.prototype.setBatchSizeInfo=function(t){this.batchSizeInfo=t};h.prototype.fetchBatch=function(){var t=this.getBatchSize?this.getBatchSize:1;if(typeof this.getBatchSize==="function"){t=this.getBatchSize()}var e=0;var i=[];for(var s=0;s<t&&this.requestedList.length>0;s++){var h=this.requestedList.pop();var n=h.id?h.id:h;e+=n.toString().length+(s==0||!this.batchSizeInfo?0:this.batchSizeInfo.separatorLength);if(this.batchSizeInfo&&e>this.batchSizeInfo.maxBatchStringLength){this.requestedList.push(n);break}i.push(n)}return i};h.prototype.pop=function(t){var e=this.requestedList.indexOf(t);if(e>-1){this.requestedList.splice(e,1)}return this.waitingList.delete(t)};h.prototype.isReady=function(t){return this.globalList.has(t)&&!this.waitingList.has(t)};h.prototype.clear=function(t){this.globalList.clear();this.requestedList=[];this.waitingList.clear()};h.prototype.isEmpty=function(){return this.requestedList.length===0};h.prototype.isWaiting=function(){return this.waitingList.size>0};h.prototype.isInitialViewCompleted=function(){var t=this.requestedList.filter(function(t){return t.isInitial});var e=[];this.waitingList.forEach(function(t,i){if(t&&t.isInitial){e.push(i)}});return t.length===0&&e.length===0};function n(t,e){h.call(this,t);this.getMaxBatchDataSize=e;this.priorityMap=new Map}n.prototype=Object.create(h.prototype);n.prototype.constructor=n;n.prototype.push=function(t,e,i,s){if(!this.globalList.has(t)){i=i||1;this.globalList.add(t);this.requestedList.push(s||t);this.waitingList.set(t,s);this.priorityMap.set(t,{p:e,s:i})}};n.prototype.clear=function(){h.prototype.clear.call(this);this.priorityMap.clear()};n.prototype.setBatchSizeInfo=function(t){this.batchSizeInfo=t};n.prototype.fetchBatch=function(){var t=this.priorityMap;this.requestedList.sort(function(e,i){return t.get(e.id?e.id:e).p-t.get(i.id?i.id:i).p});var e=[];var i=0;var s=this.getBatchSize?this.getBatchSize():1;var h=0;var n=this.getMaxBatchDataSize?this.getMaxBatchDataSize():1024*1024;var a=n>>1;for(var r=0;r<s&&this.requestedList.length>0;r++){var o=this.requestedList.pop();var c=o.id?o.id:o;h+=c.toString().length+(r==0||!this.batchSizeInfo?0:this.batchSizeInfo.separatorLength);var p=t.get(c).s;if(this.batchSizeInfo&&h>this.batchSizeInfo.maxBatchStringLength||i>a&&i+p>n){this.requestedList.push(c);break}i+=p;t.delete(c);e.push(c)}return e};var a=function(e,i){this.context=e;this.sceneId=i;this.token=e.token||t.generateToken();var s=e.loader;this.meshes=new h(s.getMeshesBatchSize.bind(s));this.materials=new h(s.getMaterialsBatchSize.bind(s));this.textures=new h;this.geometries=new n(s.getGeometriesBatchSize.bind(s),s.getGeometriesMaxBatchDataSize.bind(s));this.geomMeshes=new n(s.getGeomMeshesBatchSize.bind(s),s.getGeomMeshesMaxBatchDataSize.bind(s));this.annotations=new h(s.getAnnotationsBatchSize.bind(s));this.parametric=new h(s.getParametricsBatchSize.bind(s));this.views=new h;this.thumbnails=new h;this.tracks=new h(s.getTracksBatchSize.bind(s));this.sequences=new h(s.getSequencesBatchSize.bind(s));this.highlights=new h};a.prototype.isEmpty=function(){return this.meshes.isEmpty()&&this.annotations.isEmpty()&&this.parametric.isEmpty()&&this.materials.isEmpty()&&this.textures.isEmpty()&&this.geometries.isEmpty()&&this.geomMeshes.isEmpty()&&this.views.isEmpty()&&this.thumbnails.isEmpty()&&this.tracks.isEmpty()&&this.sequences.isEmpty()&&this.highlights.isEmpty()};a.prototype.isWaitingForContent=function(){return this.meshes.isWaiting()||this.textures.isWaiting()||this.materials.isWaiting()||this.geometries.isWaiting()||this.geomMeshes.isWaiting()||this.annotations.isWaiting()||this.parametric.isWaiting()||this.views.isWaiting()||this.thumbnails.isWaiting()||this.tracks.isWaiting()||this.sequences.isWaiting()||this.highlights.isWaiting()};a.prototype.clearContent=function(){this.meshes.clear();this.annotations.clear();this.parametric.clear();this.materials.clear();this.textures.clear();this.geometries.clear();this.geomMeshes.clear();this.views.clear();this.thumbnails.clear();this.tracks.clear();this.sequences.clear();this.highlights.clear()};a.prototype.createGetContentCommand=function(e,i,s){var h={sceneId:this.sceneId,ids:i.map(function(t){return parseInt(t,10)}),token:this.token};return t.createRequestCommand(e,s?Object.assign(h,s):h)};a.prototype.generateRequestCommand=function(){var i;var h=null;if(!this.meshes.isEmpty()){i=this.meshes.fetchBatch();throw new Error("Command "+e.getMesh+" is not implemented")}else if(!this.annotations.isEmpty()){i=this.annotations.fetchBatch();h={method:e.getAnnotation,parameters:{sceneId:this.sceneId,annotationIds:i}}}else if(!this.parametric.isEmpty()){i=this.parametric.fetchBatch();throw new Error("Command "+e.getParametric+" is not implemented")}else if(!this.materials.isEmpty()){i=this.materials.fetchBatch();h={method:e.getMaterial,parameters:{sceneId:this.sceneId,materialIds:i}}}else if(!this.geometries.isEmpty()){i=this.geometries.fetchBatch();throw new Error("Command "+e.getGeometry+" is not implemented")}else if(!this.geomMeshes.isEmpty()){i=this.geomMeshes.fetchBatch();var n=i.map(function(t){return t.id?t.id:t});h=this.createGetContentCommand(e.getGeomMesh,n);h.sceneId=this.sceneId;h.meshIds=n}else if(!this.textures.isEmpty()){i=this.textures.requestedList.splice(0,1);s.info("Requesting texture: "+i[0].imageId);h=this.createGetContentCommand(e.getImage,[i[0].imageId]);h.sceneId=this.sceneId;h=Object.assign(h,i[0])}else if(!this.sequences.isEmpty()){i=this.sequences.fetchBatch();throw new Error("Command "+e.getSequence+" is not implemented")}else if(!this.tracks.isEmpty()){i=this.tracks.fetchBatch();throw new Error("Command "+e.getTrack+" is not implemented")}else if(!this.views.isEmpty()){i=this.views.requestedList.splice(0,1);h={method:e.getView,parameters:{sceneId:this.sceneId,viewId:i[0].viewId,query:t.configureSceneViewQuery(this.context)}}}else if(!this.highlights.isEmpty()){i=this.highlights.requestedList.splice(0,1);throw new Error("Command "+e.getHighlightStyle+" is not implemented")}else if(!this.thumbnails.isEmpty()){i=this.thumbnails.requestedList.splice(0,1);h=this.createGetContentCommand(e.getImage,[i[0].imageId]);h.sceneId=this.sceneId;h=Object.assign(h,i[0])}return h};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/SceneContext", ["sap/base/Log","./CallbackHandler","./TotaraUtils","./GeometryFactory","./ProgressCounter","./RequestQueue","../getResourceBundle","../AnimationRotateType"],function(e,i,t,s,r,a,n,o){"use strict";var h=function(e,t,s){this.root=null;this.onActiveCameraCallbacks=new i;this.onInitialSceneFinishedCallbacks=new i;this.onPartialRetrievalFinishedCallbacks=new i;this.onSceneCompletedCallbacks=new i;this.onSetPlaybackCallbacks=new i;this.onViewFinishedCallbacks=new i;this.onViewGroupFinishedCallbacks=new i;this.onContentChangesProgressCallbacks=new i;this.onInitialViewCompletedCallbacks=new i;Object.assign(this,t);this.sceneId=e;this.loader=s;this.sceneBuilder=s.sceneBuilder;this.requestQueue=new a(this,e);this.phase=h.Phase.Started;this.retrievalType=h.RetrievalType.Initial;this.rootNodeId=null;this.meshNodes=new Map;this.parametricNodeMap=new Map;this.annotationNodeMap=new Map;this.leaderLineMaterialIdMap=new Map;this.imageNoteMaterialIdMap=new Map;this.thumbnailViewMap=new Map;this.viewThumbnailMap=new Map;this.viewAnimatedThumbnailMap=new Map;this.progressCount=new r;this.treeNodes=[];this.viewIdTreeNodesMap=new Map;this.viewIdBoxMap=new Map;this.nodeSidsForPartialTree=new Set;this.replacedNodes=new Map;this.updatedNodes=new Set;this.currentViewId=null;this.initialViewId=null;this.initialViewDecided=false;this.initialViewFired=false;this.eventObject={};this.eventObject.percentage=0;this.loadingGeometry=0};h.Phase={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};h.RetrievalType={Initial:0,Partial:1};h.ProgressPhase={FinishedTree:n().getText("SCENE_CONTEXT_FINISHED_TREE"),FinishedMeshes:n().getText("SCENE_CONTEXT_FINISHED_MESHES"),FinishedMaterials:n().getText("SCENE_CONTEXT_FINISHED_MATERIALS"),FinishedGeomMeshes:n().getText("SCENE_CONTEXT_FINISHED_GEOMETRIES"),LoadingGeomMeshes:n().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),FinishedTextures:n().getText("SCENE_CONTEXT_FINISHED_TEXTURES")};h.prototype.setOnProgressChanged=function(e){this.progressCount.setOnProgressChanged(e)};h.prototype.isLoadingFinished=function(){if(!this.requestQueue.isEmpty()||this.requestQueue.isWaitingForContent()||this.thumbnailViewMap.size>0||this.viewThumbnailMap.size>0||this.viewAnimatedThumbnailMap.size>0||this.meshNodes.size>0||this.annotationNodeMap.size>0||this.parametricNodeMap.size>0||this.leaderLineMaterialIdMap.size>0||this.imageNoteMaterialIdMap.size>0||this.viewIdTreeNodesMap.size>0||this.nodeSidsForPartialTree.size>0){return false}return true};h.prototype.isSceneCompleted=function(){return!this.requestQueue.meshes.isWaiting()&&!this.requestQueue.annotations.isWaiting()&&!this.requestQueue.materials.isWaiting()&&!this.requestQueue.parametric.isWaiting()&&!this.requestQueue.geomMeshes.isWaiting()&&!this.requestQueue.geometries.isWaiting()&&!this.requestQueue.textures.isWaiting()};h.prototype.isInitialViewCompleted=function(){var i=this.requestQueue.textures.isInitialViewCompleted();var t=this.requestQueue.meshes.isInitialViewCompleted();var s=this.requestQueue.geomMeshes.isInitialViewCompleted();e.info("IsInitialViewCompleted:");e.info("textures: "+i);e.info("meshes: "+t);e.info("geoMeshes: "+s);return i&&t&&s};h.prototype._checkSceneCompletion=function(){if(!this.initialViewFired&&this.isInitialViewCompleted()){e.info("initialView completed.");this.initialViewFired=true;this.onInitialViewCompletedCallbacks.execute()}if(this.isSceneCompleted()){if(this.eventObject.percentage<100){this.eventObject.percentage=100;this.onContentChangesProgressCallbacks.execute(this.eventObject)}this.onSceneCompletedCallbacks.execute();e.info("Scene completed.");t.mark("sceneCompleted");this.logPerformance("sceneCompleted")}};h.prototype._fireProgress=function(e){switch(e){case h.ProgressPhase.FinishedTree:this.eventObject.percentage+=10;this.eventObject.phase=h.ProgressPhase.FinishedTree;this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case h.ProgressPhase.FinishedMeshes:if(!this.requestQueue.meshes.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=h.ProgressPhase.FinishedMeshes;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;case h.ProgressPhase.FinishedMaterials:if(!this.requestQueue.materials.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=h.ProgressPhase.FinishedMaterials;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;case h.ProgressPhase.LoadingGeomMeshes:this.eventObject.percentage+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.eventObject.percentage>100){this.eventObject.percentage=100}this.loadingGeometry+=61*(1/this.requestQueue.geomMeshes.globalList.size);if(this.loadingGeometry>=60){this.eventObject.phase=h.ProgressPhase.FinishedGeomMeshes}else{this.eventObject.phase=h.ProgressPhase.LoadingGeomMeshes}this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case h.ProgressPhase.FinishedTextures:if(!this.requestQueue.textures.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=h.ProgressPhase.FinishedTextures;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;default:}};h.prototype.dispose=function(){this.sceneId=null;this.progressCount=null;this.requestQueue=null;this.suppressedBoundingBoxListMap=null;this.treeNodes=null;this.nodeSidsForPartialTree=null;this.meshNodes=null;this.annotationNodeMap=null;this.parametricNodeMap=null;this.leaderLineMaterialIdMap=null;this.imageNoteMaterialIdMap=null;this.thumbnailViewMap=null;this.viewThumbnailMap=null;this.viewAnimatedThumbnailMap=null;this.replacedNodes=null;this.updatedNodes=null;this.viewIdTreeNodesMap=null;this.viewIdBoxMap=null;this.onActiveCameraCallbacks=null;this.onInitialSceneFinishedCallbacks=null;this.onPartialRetrievalFinishedCallbacks=null;this.onSceneCompletedCallbacks=null;this.onViewFinishedCallbacks=null;this.onSetPlaybackCallbacks=null;this.onContentChangesProgressCallbacks=null;this.onInitialViewCompletedCallbacks=null};h.prototype.logPerformance=function(e){if(this.progressLogger&&this.token){this.progressLogger.logPerformance(e,this.token)}};h.prototype.setCameraSingle=function(e){this.sceneBuilder.createCamera(e,this.sceneId);return this.sceneBuilder.getCamera(e.id)};h.prototype.getPartialTreeNodes=function(e){var i=[];var t=[];var s,r,a;if(e&&e.length){for(s=0;s<e.length;s++){a=e[s];if(a==null){continue}if(a&&a.children){if(a.entityId!=null&&a.children.length===1){var n=e[a.children[0]];if(n.entityId==null){n.visualisable=false}}if(a.children){for(r=0;r<a.children.length;r++){var o=a.children[r];e[o].parentNode=a;if(a.renderOrder){e[o].renderOrder=a.renderOrder}}}}}for(s=0;s<e.length;s++){a=e[s];if(a==null){continue}if(a.parent){i.push(a)}else if(!a.parentNode){i.push(a);if(this.rootNodeId){a.parent=this.rootNodeId}}if(this.nodeSidsForPartialTree.has(a.sid)){t.push(a)}}}this.nodeSidsForPartialTree.clear();if(!t.length){return i}i=[];for(r=0;r<t.length;r++){var h=t[r];var d=h.parentNode;while(d){if(this.sceneBuilder.getNode(d.sid,this.sceneId)){h.parent=d.sid;i.push(h);break}else{h=d;d=d.parentNode}}}return i.length?i:t};h.prototype.buildTree=function(e){var i={};if(!this.treeNodes||!this.treeNodes.length){i.error="no tree information";return i}var t=this.treeNodes;var s=this.getPartialTreeNodes(t);this.replacedNodes.clear();var r=[];var a;var n;for(a=0;a<s.length;a++){n=s[a].parent;if(this.sceneBuilder.getNode(n,this.sceneId)){this.buildNode(s[a],n,true,e)}else{r.push(s[a])}}for(a=0;a<r.length;a++){n=r[a].parent;if(this.sceneBuilder.getNode(n,this.sceneId)){this.buildNode(s[a],n,true,e)}else{i.error=(i.error||"")+"parent ${parentSid} does not exist in the scene. \n"}}if(this.retrievalType===h.RetrievalType.Partial){this.sceneBuilder.updateViewsForReplacedNodes(this.treeNodes)}this.treeNodes=[];this.progressCount.mesh.total=this.requestQueue.meshes.globalList.size;return i};h.prototype.buildNode=function(e,i,s,r){if(!e||!i){this.loader.reportError(this,"SceneContext - buildNode - invalid args");return null}var a=this.sceneBuilder.getNode(e.sid,this.sceneId);if(a){this.sceneBuilder.remove(e.sid,this.sceneId)}if(e.suppressed===true){return null}if(!e.sid){this.loader.reportError(this,"sid is missing in treeNode");return null}e.parentId=i;this.sceneBuilder.createNode(e,this.sceneId);var n=e.parametricId;var o=e.meshId;if(n&&o){if(this.sceneBuilder.preferMeshes()){n=null}else{o=null}}if(n){if(this.parametricNodeMap.get(n)==null){this.parametricNodeMap.set(n,[e.sid]);this.requestQueue.parametric.push(n)}else{this.parametricNodeMap.get(n).push(e.sid)}}else if(o&&!this.sceneBuilder.hasMesh(o)){t.pushElementIntoMapArray(this.meshNodes,o,e.sid);if(this.loader.getSkipLowLODRendering()){this.requestQueue.geomMeshes.push(o,null,null,{id:o,isInitial:r})}else{this.requestQueue.meshes.push(o,{id:o,isInitial:r})}}if(e.annotationId&&!this.sceneBuilder.hasAnnotation(e.annotationId)){if(this.annotationNodeMap.get(e.annotationId)==null){this.annotationNodeMap.set(e.annotationId,[e.sid]);this.requestQueue.annotations.push(e.annotationId)}else{this.annotationNodeMap.get(e.annotationId).push(e.sid)}}var h=this.sceneBuilder.getNode(e.sid,this.sceneId);if(a&&h){this.replacedNodes.set(a,h)}if(s&&e.children){for(var d=0;d<e.children.length;d++){this.buildNode(this.treeNodes[e.children[d]],e.sid,s,r)}}return h};h.prototype.setTree=function(e){if(e.sid){var i=this.sceneBuilder.getNode(e.sid,this.sceneId);if(!i||i!==this.root){var s=this.root;s.userData.treeNode={sid:e.sid,name:this.root.name?this.root.name:"root"};s.userData.skipIt=!this.root.name;this.sceneBuilder.setRootNode(s,e.sid,this.sceneId,this.vkScene);this.rootNodeId=e.sid}}if(e.camera){e.camera.id="initial";var r=this.setCameraSingle(e.camera);if(r){this.onActiveCameraCallbacks.execute(r)}}t.measure("setTreeMeasure-"+this.sceneId,"setTree-"+this.sceneId)};h.prototype.setTreeNode=function(e){if(!Array.isArray(e.nodes)){return{error:"setTreeNode error: nodes are not properly defined"}}this.treeNodes=this.treeNodes.concat(e.nodes);return{}};h.prototype.suppressSendRequests=function(){this.loader.setSuppressSendRequests(true)};h.prototype.unsuppressSendRequests=function(){this.loader.setSuppressSendRequests(false);this.loader.sendRequest(this.requestQueue)};h.prototype.notifyFinishedTree=function(e,i){this.buildTree(i);this.phase=h.Phase.FinishedHierarchy;this._fireProgress(h.ProgressPhase.FinishedTree);if(this.retrievalType===h.RetrievalType.Initial){this.onInitialSceneFinishedCallbacks.execute(this.initialView)}else if(this.retrievalType===h.RetrievalType.Partial){this.onPartialRetrievalFinishedCallbacks.execute()}this._checkSceneCompletion()};h.prototype.setViewGroup=function(e){this.sceneBuilder.insertViewGroup(e,this.sceneId);if(!Array.isArray(e.views)){return}var i=e.id;var s,r;if(!this.currentViewGroupId){if(this.currentViewId){for(s=0;s<e.views.length;s++){r=e.views[s];if(r.id===this.currentViewId){this.currentViewGroupId=i;break}}}else{this.currentViewGroupId=i}}if(this.currentViewGroupId!==i){return}if(!this.currentViewId){this.currentViewId=e.views[0].id}for(s=0;s<e.views.length;s++){r=e.views[s];var a=this.sceneBuilder.getView(r.id,this.sceneId);for(var n=0;n<2;n++){var o=["thumbnailId","animatedThumbnailId"][n];var h=r[o];if(h!==undefined){r[o]=h=h.toString();if(this.sceneBuilder.hasImage(h)){this.sceneBuilder.setViewThumbnail(h,r.id,this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute()}else{this.thumbnailViewMap.set(h,r.id);this.requestQueue.thumbnails.push(h,{imageId:h,viewId:r.id})}if(!a){this[["viewThumbnailMap","viewAnimatedThumbnailMap"][n]].set(r.id,h)}}}if(a){a.userData.viewInfo.thumbnailId=r.thumbnailId;a.userData.viewInfo.animatedThumbnailId=r.animatedThumbnailId;continue}this.requestQueue.views.push(r.id,{viewId:r.id,viewGroupId:i})}if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute()}}t.measure("setViewGroupMeasure-"+i,"setViewGroup-"+i)};h.prototype.setView=function(e){var i=e.viewId;this.viewIdBoxMap.set(i!==undefined?i:"default",e.box);if(!i){this.setTree(e);this.initialViewDecided=true;return}if(!this.initialViewId&&!this.initialViewDecided){this.initialViewId=i;this.currentViewId=i;this.initialViewDecided=true}var s;if(this.initialViewId===i){if(e.camera){s=e.camera.id}this.setTree(e)}var r=this.viewThumbnailMap.get(i);if(r){this.viewThumbnailMap.delete(i);e.thumbnailId=r}var a=this.viewAnimatedThumbnailMap.get(i);if(a){this.viewAnimatedThumbnailMap.delete(i);e.animatedThumbnailId=a}this.sceneBuilder.insertView(e,this.sceneId);var n=this.sceneBuilder.getView(e.viewId,e.sceneId);if(n&&this.initialViewId===e.viewId){this.initialView=n}var o=[];this.viewIdTreeNodesMap.set(i,o);this.viewIdBoxMap.set(i,e.box);if(e.camera){if(s){e.camera.id=s}this.setCameraSingle(e.camera);this.sceneBuilder.setViewCamera(e.camera.id,i,this.sceneId)}this.logPerformance("setView");t.measure("setViewMeasure-"+i,"setView-"+i)};h.prototype.setViewNode=function(e,i,t){var s={context:this};if(!e.viewId){this.setTreeNode(e,t);return s}if(this.initialViewId===e.viewId){this.setTreeNode(e,t)}var r=this.sceneBuilder.getView(e.viewId,e.sceneId);if(!r){s.error="setViewNode error: setViewNode - no setView was in the chain";return s}if(this.initialViewId===e.viewId){this.initialView=r}var a=this.viewIdTreeNodesMap.get(e.viewId);a=a.concat(e.nodes);this.viewIdTreeNodesMap.set(e.viewId,a);return s};h.prototype.notifyFinishedView=function(e){var i=e.viewId;if(!i){return this.notifyFinishedTree(e)}this.requestQueue.views.pop(i);if(this.initialViewId===i){this.notifyFinishedTree(e,true);this.initialViewId=null}var t=this.sceneBuilder.getView(i,this.sceneId);if(!t){return{error:"notifyFinishedView error: setViewNode - no setView was in the chain"}}if(t.activeCameraId!==undefined){t.setCamera(this.sceneBuilder.getCamera(t.activeCameraId))}this.updatedNodes.clear();var s=this.buildView(i);this.sceneBuilder.setViewNodeInfos(s.nodeInfos,i,this.sceneId);t.updatedNodes=Array.from(this.updatedNodes);if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();if(this.requestQueue.sequences.isEmpty()){this.onViewGroupFinishedCallbacks.execute()}}this.onViewFinishedCallbacks.execute(t);this.logPerformance("notifyFinishedView")};h.prototype.buildView=function(e){var i={};this.treeNodes=this.viewIdTreeNodesMap.get(e);var t=this.getPartialTreeNodes(this.treeNodes);var s=[];for(var r=0;r<t.length;r++){var a=t[r].parent;this.processNodeRecursively(e,t[r],s,a,true)}i.nodeInfos=s;this.treeNodes=[];this.viewIdTreeNodesMap.delete(e);return i};h.prototype.processNodeRecursively=function(e,i,s,r,a){var n=this.sceneBuilder.getNode(i.sid,this.sceneId);if(!n||i.annotationId&&n.userData&&n.userData.treeNode&&i.annotationId!==n.userData.treeNode.annotationId){n=this.buildNode(i,r,false);if(!n){return}n.visible=false}if(i.materialId){this._checkIfNeededAndOrderMaterial(i.materialId,true)}var o=i.visible!==undefined?i.visible:a;s.push({target:n,visible:o,materialId:i.materialId,opacity:i.opacity,meshId:i.meshId,annotationId:i.annotationId,transform:Array.isArray(i.transform)?t.arrayToColumnMajorMatrixArray16(i.transform):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]});var h=this.treeNodes;var d=this.sceneBuilder.getChildNodeIds(i.sid,this.sceneId);var l=i.children?i.children.map(function(e){return h[e].sid}):[];var u;var c;for(c=0;c<d.length;c++){u=d[c];for(var p=0;p<l.length;p++){if(u===l[p]){d[c]=undefined;break}}}for(c=0;c<d.length;c++){var f=d[c];if(f!==undefined){var g=this.sceneBuilder.getNode(f,this.sceneId);var m=false;s.push({target:g,visible:m})}}if(i.children){for(c=0;c<i.children.length;c++){this.processNodeRecursively(e,h[i.children[c]],s,i.sid,o)}}if(i.highlightStyleId){this.sceneBuilder.recordHighlightedNodeInView(i.highlightStyleId,i.sid,e,this.sceneId);if(!this.sceneBuilder.highlightStyleExists(i.highlightStyleId)){this.requestQueue.highlights.push(i.highlightStyleId)}}};h.prototype.setAnnotationSingle=function(e){var i=this.annotationNodeMap.get(e.id)||[];if(!i.length){i.push("")}this.annotationNodeMap.delete(e.id);for(var s=0;s<i.length;s++){var r=JSON.parse(JSON.stringify(e));var a=i[s];if(a){r.nodeId=a}if(r.detailView||r.cutaway){this.sceneBuilder.createDetailView(r,this.sceneId)}else if(r.labelMaterialId||r.label&&r.label.materialId){var n=r.labelMaterialId||r.label.materialId;if(this.sceneBuilder.checkMaterialExists(n,false)){this.sceneBuilder.createImageNote(r,this.sceneId);this.loader.onAnnotationFinishedCallbacks.execute(r.id)}else{this.requestQueue.materials.push(n);t.pushElementIntoMapArray(this.imageNoteMaterialIdMap,n,r)}}else{this.sceneBuilder.createAnnotation(r,this.sceneId);var o=r.leaderLines;if(o){for(var h=0,d=o.length;h<d;h++){var l=o[h];l.annotationId=r.id;if(this.sceneBuilder.checkMaterialExists(l.materialId,false)){this.sceneBuilder.insertLeaderLine(l,this.sceneId)}else{this.requestQueue.materials.push(l.materialId);t.pushElementIntoMapArray(this.leaderLineMaterialIdMap,l.materialId,l)}}}}}this.requestQueue.annotations.pop(e.id)};h.prototype.setCamera=function(e){if(!Array.isArray(e.cameras)){return{error:"setCamera error: cameras are not properly defined"}}e.cameras.forEach(this.setCameraSingle.bind(this))};h.prototype.setMeshSingle=function(e){var i=e.id;var t,s,r;if(this.loader.getSkipLowLODRendering()){if(this.requestQueue.geomMeshes.pop(i)){if(this.meshNodes.get(i)){this.meshNodes.delete(i)}if(Array.isArray(e.submeshes)){for(t=0;t<e.submeshes.length;t++){s=e.submeshes[t];s.meshId=i;this._checkIfNeededAndOrderMaterial(s.materialId,true);r=this.viewIdBoxMap.has(this.currentViewId)?this.viewIdBoxMap.get(this.currentViewId):this.viewIdBoxMap.get("default");this.sceneBuilder.insertSubmesh(s,r)}}this.progressCount.mesh.count++;this._fireProgress(h.ProgressPhase.LoadingGeomMeshes)}return}if(this.requestQueue.meshes.pop(i)){var a=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];if(Array.isArray(e.submeshes)){for(t=0;t<e.submeshes.length;t++){s=e.submeshes[t];s.meshId=i;this._checkIfNeededAndOrderMaterial(s.materialId,true);r=this.viewIdBoxMap.has(this.currentViewId)?this.viewIdBoxMap.get(this.currentViewId):this.viewIdBoxMap.get("default");this.sceneBuilder.insertSubmesh(s,r);var n=s.lods;if(Array.isArray(n)){for(var o=0;o<n.length;o++){var d=n[o].boundingBox;if(Array.isArray(d)&&d.length===6){for(var l=0;l<6;++l){a[l]=l<3?Math.min(a[l],d[l]):Math.max(a[l],d[l])}}}}}}var u={x:0,y:0,z:0};if(a[3]>=a[0]&&a[4]>=a[1]&&a[5]>=a[2]){u.x=a[3]-a[0];u.y=a[4]-a[1];u.z=a[5]-a[2]}var c=0;var p=this.meshNodes.get(i);if(p){this.meshNodes.delete(i);p.forEach(function(e){var i=this.sceneBuilder.getNode(e,this.sceneId);c+=i&&i.matrixWorld?i.matrixWorld.getMaxScaleOnAxis():1}.bind(this))}this.requestQueue.geomMeshes.push(i,(u.x*u.y+u.y*u.z+u.z*u.x)*c,e.geometrySize||0);this.progressCount.mesh.count++;if(!this.requestQueue.meshes.isWaiting()){this.phase=h.Phase.FinishedMesh;this.logPerformance("meshFinished");this.progressCount.geometry.total=this.requestQueue.geometries.globalList.size;this._fireProgress(h.ProgressPhase.FinishedMeshes)}}else{this.requestQueue.geomMeshes.pop(i.toString());this._fireProgress(h.ProgressPhase.LoadingGeomMeshes)}};h.prototype.setMesh=function(e,i){if(!Array.isArray(e.meshes)){return{error:"setMesh error: meshes are not properly defined"}}if(this.loader.getSkipLowLODRendering()){e.meshes.forEach(this.setMeshSingle.bind(this))}if(i){var s=new DataView(i.buffer,i.byteOffset,i.byteLength);var r=s.getUint16(2,true),a=0;while(r-- >0&&a<i.byteLength){var n={sceneId:this.sceneId,id:s.getUint32(a+4,true).toString(),box:[s.getFloat32(a+14,true),s.getFloat32(a+18,true),s.getFloat32(a+22,true),s.getFloat32(a+26,true),s.getFloat32(a+30,true),s.getFloat32(a+34,true)]};var o=s.getUint16(a+12,true);a+=38;if(o!==3){n.flags=s.getUint16(a,true);n.quality=s.getFloat32(a+4,true);n.pointCount=s.getUint16(a+8,true);n.elementCount=s.getUint16(a+10,true);a+=14}var h=s.getUint32(a,true);var d=i.subarray(a+4,a+4+h);a+=h;this.setGeometry(n,d)}}if(!this.loader.getSkipLowLODRendering()){e.meshes.forEach(this.setMeshSingle.bind(this))}t.measure("setMeshMeasure-"+this.sceneId,"setMesh-"+this.sceneId);this._checkSceneCompletion()};h.prototype.setMaterialSingle=function(e,i){var t=e.id;this.requestQueue.materials.pop(t);var s;var r=this.sceneBuilder.createMaterial(e);for(s=0;s<r.length;s++){var a=r[s].imageId;this.requestQueue.textures.push(a,{imageId:a,materialId:t,isInitial:i})}var n=this.leaderLineMaterialIdMap.get(t);if(n){this.leaderLineMaterialIdMap.delete(t);for(s=0;s<n.length;s++){this.sceneBuilder.insertLeaderLine(n[s],this.sceneId)}}var o=this.imageNoteMaterialIdMap.get(t);if(o){this.imageNoteMaterialIdMap.delete(t);for(s=0;s<o.length;s++){this.sceneBuilder.createImageNote(o[s],this.sceneId)}}this.loader.onMaterialFinishedCallbacks.execute(t)};h.prototype.setMaterial=function(e,i,s){if(!Array.isArray(e.materials)){return{error:"setMaterial error: materials are not properly defined"}}e.materials.forEach(function(e){this.setMaterialSingle(e,s)}.bind(this));t.measure("setMaterialMeasure-"+this.sceneId,"setMaterial-"+this.sceneId);this._fireProgress(h.ProgressPhase.FinishedMaterials);this._checkSceneCompletion()};h.prototype.setGeometry=function(e,i){var r=e.id;this.requestQueue.geometries.pop(r);if(e.data&&!i){i=t.base64ToUint8Array(e.data)}if(!i||i.length===0){return{error:"setGeometry error: no data for geometry "+r}}var a=s.getGeometryInfo(e,i);if(!a){return{error:"setGeometry error: failed to parse geometry "+r+" data"}}this.sceneBuilder.setGeometry(a);this.loader.onSetGeometryCallbacks.execute({id:r});if(!this.requestQueue.geometries.isWaiting()){this.phase=h.Phase.FinishedGeometry;this.logPerformance("geometryFinished")}this.progressCount.geometry.count++;t.measure("setGeometryMeasure-"+r,"setGeometry-"+r);this._checkSceneCompletion()};h.prototype.setImage=function(i,s){var r=i.id;if(!s){return{error:"setImage error: no image content for "+r}}i.binaryData=s;this.sceneBuilder.createImage(i);if(this.requestQueue.textures.pop(r)){e.info("Received texture image id: "+r);this.loader.onImageFinishedCallbacks.execute({id:r});this._fireProgress(h.ProgressPhase.FinishedTextures);this._checkSceneCompletion()}else if(this.requestQueue.thumbnails.pop(r)){var a=this.thumbnailViewMap.get(r);if(a){this.thumbnailViewMap.delete(r);this.sceneBuilder.setViewThumbnail(r,a,this.sceneId,i.tileWidth);this.loader.onViewGroupUpdatedCallbacks.execute()}}t.measure("setImageMeasure-"+r,"setImage-"+r)};h.prototype.setAnnotation=function(e){if(!Array.isArray(e.annotations)){return{error:"setAnnotation error: annotations are not properly defined"}}e.annotations.forEach(this.setAnnotationSingle,this);this._checkSceneCompletion()};h.prototype.setHighlightStyle=function(e){e.id=e.id.toString();this.sceneBuilder.insertHighlightStyle(e);this.requestQueue.highlights.pop(e.id)};h.prototype.setLineStyle=function(e){e.lineStyles.forEach(function(e){this.sceneBuilder.insertLineStyle(e)},this)};h.prototype.setFillStyle=function(e){e.fillStyles.forEach(function(e){this.sceneBuilder.insertFillStyle(e)},this)};h.prototype.setTextStyle=function(e){e.textStyles.forEach(function(e){this.sceneBuilder.insertTextStyle(e)},this)};h.prototype._checkIfNeededAndOrderMaterial=function(e,i,t){if(e&&this.sceneBuilder.materialNeeded(t)&&this.sceneBuilder.checkMaterialExists(e,i)===false){this.requestQueue.materials.push(e)}};h.prototype.setParametric=function(e){for(var i=0;i<e.parametrics.length;i++){var t=e.parametrics[i];var s=t.id.toString();var r=this.parametricNodeMap.get(s);this.requestQueue.parametric.pop(s);this.parametricNodeMap.delete(s);for(var a=0;r&&a<r.length;a++){if(t.shapes!=null){for(var n=0;n<t.shapes.length;n++){this._checkIfNeededAndOrderMaterial(t.shapes[n].materialID,false,t)}}else{this._checkIfNeededAndOrderMaterial(t.materialID,false,t)}this.sceneBuilder.setParametricContent(r[a],t,this.sceneId)}}this._checkSceneCompletion()};h.prototype.setPlayback=function(e){if(!Array.isArray(e.playbacks)){return{error:"setPlayback error: playbacks are not properly defined"}}var i=this.sceneBuilder.getView(e.viewId,this.sceneId);var t=false;var s,r;if(this.playbackIds){for(s=0;s<e.playbacks.length;s++){r=e.playbacks[s];for(var a=0;a<this.playbackIds.length;a++){if(r.id===this.playbackIds[a]){r.notLoading=false;break}}if(r.notLoading===undefined){r.notLoading=true}}delete this.playbackIds;t=true;if(!i.sortPlaybacks(true)){i.resetPlaybacksStartTimes(true)}}if(Array.isArray(e.joints)){this.sceneBuilder.insertJoints(e.joints,this.sceneId)}for(s=0;s<e.playbacks.length;s++){r=e.playbacks[s];if(r.notLoading){continue}if(r.id==null){r.id=e.viewId+"-playback";r.sequence.id=e.viewId+"-cont";r.sequenceId=r.sequence.id;this.setSequence({sequences:[r.sequence]})}this.sceneBuilder.insertPlayback(r,e.viewId,this.sceneId);if(r.sequenceId){var n=this.sceneBuilder.getSequence(r.sequenceId);if(n){continue}else{this.requestQueue.sequences.push(r.sequenceId)}}}if(!this.requestQueue.sequences.isEmpty()){this.loader.hasAnimation=true}else{this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.hasAnimation=false;if(t){this.onSetPlaybackCallbacks.execute(i)}}};h.prototype.setSequenceSingle=function(e,i){var t=e.id;this.requestQueue.sequences.pop(t);function s(e){for(var i in e){if(e.hasOwnProperty(i)){return false}}return true}if(e.nodes){var r=[];for(var a=0;a<e.nodes.length;a++){var n=e.nodes[a];var o=n.rrotate||n.rotate;if(o){var h={};if(o.trackId){h.trackId=o.trackId}else if(i&&o.track!==undefined){h.trackId=i[o.track].id}if(h.trackId){if(!i){this.requestQueue.tracks.push(h.trackId)}}h.sid=n.sid;h.binding="ROTATE";if(o.pivot){h.pivot=o.pivot}if(n.rotate){h.isAbsoluteValue=true}if(s(o)){h.empty=true}r.push(h)}var d=n.rtranslate||n.translate;if(d){var l={};if(d.trackId){l.trackId=d.trackId}else if(i&&d.track!==undefined){l.trackId=i[d.track].id}if(l.trackId){if(!i){this.requestQueue.tracks.push(l.trackId)}}l.sid=n.sid;l.binding="TRANSLATE";if(d.pivot){l.pivot=d.pivot}if(n.translate){l.isAbsoluteValue=true}if(s(d)){l.empty=true}r.push(l)}var u=n.rscale||n.scale;if(u){var c={};if(u.trackId){c.trackId=u.trackId}else if(i&&u.track!==undefined){c.trackId=i[u.track].id}if(c.trackId){if(!i){this.requestQueue.tracks.push(c.trackId)}}c.sid=n.sid;c.binding="SCALE";if(u.pivot){c.pivot=u.pivot}if(n.scale){c.isAbsoluteValue=true}if(s(u)){c.empty=true}r.push(c)}if(n.opacity!==undefined||n.ropacity!==undefined){var p;if(n.opacity){p=n.opacity}else{p=n.ropacity}var f={};if(p.trackId){f.trackId=p.trackId}else if(i&&p.track!==undefined){f.trackId=i[p.track].id}if(f.trackId){if(!i){this.requestQueue.tracks.push(f.trackId)}}f.sid=n.sid;f.binding="OPACITY";if(n.opacity){f.isAbsoluteValue=true}if(s(p)){f.empty=true}r.push(f)}}e.nodes=r}this.sceneBuilder.insertSequence(e,this.sceneId)};h.prototype.setSequence=function(e){if(!Array.isArray(e.sequences)){return{error:"setSequence error: sequences are not properly defined"}}if(Array.isArray(e.joints)){this.sceneBuilder.insertJoints(e.joints,this.sceneId)}for(var i=0;i<e.sequences.length;i++){this.setSequenceSingle(e.sequences[i],e.tracks)}if(e.tracks){this.setTrack(e)}if(this.requestQueue.tracks.isEmpty()){this.loader.hasAnimation=false;this.loader.onSetSequenceCallbacks.execute();if(!this.requestQueue.views.isWaiting()){this.onViewGroupFinishedCallbacks.execute()}}};h.prototype.setTrack=function(e){if(!Array.isArray(e.tracks)){return{error:"setTrack error: tracks are not properly defined"}}var i=[];for(var t=0;t<e.tracks.length;t++){var s=e.tracks[t];this.requestQueue.tracks.pop(s.id);s.times=s.time;if(s.vector3){s.values=s.vector3}else if(s.quaternion){s.values=s.quaternion;s.rotateType=o.Quaternion}else if(s.angleAxis){s.values=s.angleAxis;s.rotateType=o.AngleAxis}else if(s.euler){s.values=s.euler;s.rotateType=o.Euler}else if(s.scalar){s.values=s.scalar}s.cyclicInfo={};s.cyclicInfo.cyclicStart=s.cyclicStart;s.cyclicInfo.cyclicEnd=s.cyclicEnd;i.push(s)}this.sceneBuilder.insertTracks(i);if(!this.requestQueue.tracks.isWaiting()){this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();this.loader.onSetTrackCallbacks.execute();if(!this.requestQueue.views.isWaiting()&&!this.requestQueue.sequences.isWaiting()){this.onViewGroupFinishedCallbacks.execute()}}};h.prototype.notifyError=function(e){if(!e.error){e.error="Unknown error"}return e};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/TotaraLoader", ["sap/base/Log","./SceneContext","./CallbackHandler","./Command","./TotaraUtils","../IncludeUsageIdType","../helpers/WorkerScriptLoader"],function(e,t,i,n,a,s,r){"use strict";var o=a.mark;var c=function(){this._performanceTimingMsg=[];this._isPostable=true;this._suppressSendRequests=false;this._loadingFinishedSent=false;this.currentSceneInfo={};this.contextMap=new Map;this.tokenContextMap=new Map;this._skipLowLODRendering=true;this._maxUrlLength=2048;this._maxActiveRequests=4;this._meshesBatchSize=1024;this._materialsBatchSize=128;this._geometriesBatchSize=1024;this._geometriesMaxBatchDataSize=10*1024*1024;this._geomMeshesBatchSize=1024;this._parametricsBatchSize=1024;this._geomMeshesMaxBatchDataSize=10*1024*1024;this._annotationsBatchSize=128;this._tracksBatchSize=128;this._sequencesBatchSize=128;this._voxelThreshold=.03;this.onErrorCallbacks=new i;this.onImageFinishedCallbacks=new i;this.onImageDetailsFinishedCallbacks=new i;this.onMaterialFinishedCallbacks=new i;this.onAnnotationFinishedCallbacks=new i;this.onSetGeometryCallbacks=new i;this.onSetSequenceCallbacks=new i;this.onSetTrackCallbacks=new i;this.onViewGroupUpdatedCallbacks=new i;this.onLoadingFinishedCallbacks=new i};c.prototype.running=function(){return this._worker!==null&&this._worker!==undefined};c.prototype.run=function(){if(!this._worker){this._worker=r.loadScript("sap/ui/vk/totara/TotaraLoaderWorker.js");var e=this;this._worker.onmessage=function(t){var i=t.data;i.jsonContent=i.jsonContent||{};if(i.jsonString){var n=JSON.parse(i.jsonString);delete i.jsonString;i.jsonContent=Object.assign(n,i.jsonContent)}var a=e.processCommand(i.name,i.jsonContent,i.binaryContent,i.isInitial);if(a){e.sendRequest(a.requestQueue)}};this._worker.onerror=function(e){}}return Promise.resolve("TotaraLoader is ready")};c.prototype.getUrl=function(){return this._url};c.prototype.setUrl=function(e){this._url=e;if(!this._url.endsWith("/")){this._url+="/"}return this};c.prototype.getCorrelationId=function(){return this._correlationId};c.prototype.setCorrelationId=function(e){this._correlationId=e;return this};c.prototype.getSkipLowLODRendering=function(){return this._skipLowLODRendering};c.prototype.setSkipLowLODRendering=function(e){this._skipLowLODRendering=e;return this};c.prototype.getMaxUrlLength=function(){return this._maxUrlLength};c.prototype.setMaxUrlLength=function(e){this._maxUrlLength=e;return this};c.prototype.getMaxActiveRequests=function(){return this._maxActiveRequests};c.prototype.setMaxActiveRequests=function(e){this._maxActiveRequests=e;this.postMessage({method:n.setMaxActiveRequests,maxActiveRequests:e})};c.prototype.getMeshesBatchSize=function(){return this._meshesBatchSize};c.prototype.setMeshesBatchSize=function(e){this._meshesBatchSize=e;return this};c.prototype.getMaterialsBatchSize=function(){return this._materialsBatchSize};c.prototype.setMaterialsBatchSize=function(e){this._materialsBatchSize=e;return this};c.prototype.getGeometriesBatchSize=function(){return this._geometriesBatchSize};c.prototype.setGeometriesBatchSize=function(e){this._geometriesBatchSize=e;return this};c.prototype.getGeometriesMaxBatchDataSize=function(){return this._geometriesMaxBatchDataSize};c.prototype.setGeometriesMaxBatchDataSize=function(e){this._geometriesMaxBatchDataSize=e;return this};c.prototype.getGeomMeshesBatchSize=function(){return this._geomMeshesBatchSize};c.prototype.setGeomMeshesBatchSize=function(e){this._geomMeshesBatchSize=e;return this};c.prototype.getParametricsBatchSize=function(){return this._parametricsBatchSize};c.prototype.setParametricsBatchSize=function(e){this._parametricsBatchSize=e;return this};c.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._geomMeshesMaxBatchDataSize};c.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._geomMeshesMaxBatchDataSize=e;return this};c.prototype.getAnnotationsBatchSize=function(){return this._annotationsBatchSize};c.prototype.setAnnotationsBatchSize=function(e){this._annotationsBatchSize=e;return this};c.prototype.getTracksBatchSize=function(){return this._tracksBatchSize};c.prototype.setTracksBatchSize=function(e){this._tracksBatchSize=e;return this};c.prototype.getSequencesBatchSize=function(){return this._sequencesBatchSize};c.prototype.setSequencesBatchSize=function(e){this._sequencesBatchSize=e;return this};c.prototype.getVoxelThreshold=function(){return this._voxelThreshold};c.prototype.setVoxelThreshold=function(e){this._voxelThreshold=e;if(this.sceneBuilder){this.sceneBuilder.setVoxelThreshold(e)}return this};c.prototype.setSceneBuilder=function(e){this.sceneBuilder=e;this.sceneBuilder.setVoxelThreshold(this.getVoxelThreshold())};c.prototype.removeContext=function(e){this.contextMap.delete(e);return this};c.prototype.dispose=function(){this.contextMap.forEach(function(e){e.dispose()});this.contextMap.clear();this.tokenContextMap.clear();this.postMessage({method:"close"});this._worker=undefined;this.currentSceneInfo=null;if(this.sceneBuilder){this.sceneBuilder.cleanup();this.sceneBuilder=null}this.onErrorCallbacks=null;this.onMaterialFinishedCallbacks=null;this.onImageFinishedCallbacks=null;this.onImageDetailsFinishedCallbacks=null;this.onSetGeometryCallbacks=null;this.onSetTrackCallbacks=null;this.onSetSequenceCallbacks=null;this.onAnnotationFinishedCallbacks=null};c.prototype.cleanup=function(){this.currentSceneInfo={};this.contextMap.clear();this.tokenContextMap.clear();this.sceneBuilder.cleanup()};c.prototype.getSceneBuilder=function(){return this.sceneBuilder};c.prototype.getContext=function(e){return this.contextMap.get(e)};c.prototype.createContext=function(e,i){var n=new t(e,i,this);this.contextMap.set(e,n);this.tokenContextMap.set(n.requestQueue.token,n);if(n.onActiveCamera){n.onActiveCameraCallbacks.attach(n.onActiveCamera);delete n.onActiveCamera}if(n.onInitialSceneFinished){n.onInitialSceneFinishedCallbacks.attach(n.onInitialSceneFinished);delete n.onInitialSceneFinished}if(n.onPartialRetrievalFinished){n.onPartialRetrievalFinishedCallbacks.attach(n.onPartialRetrievalFinished);delete n.onPartialRetrievalFinished}if(n.onViewFinished){n.onViewFinishedCallbacks.attach(n.onViewFinished);delete n.onViewFinished}if(n.onSceneCompleted){n.onSceneCompletedCallbacks.attach(n.onSceneCompleted);delete n.onSceneCompleted}if(n.onProgressChanged){n.setOnProgressChanged(n.onProgressChanged);delete n.onProgressChanged}if(n.onLoadingFinished){this.onLoadingFinishedCallbacks.detachAll();this.onLoadingFinishedCallbacks.attach(n.onLoadingFinished);delete n.onLoadingFinished}if(n.onContentChangesProgress){n.onContentChangesProgressCallbacks.attach(n.onContentChangesProgress);delete n.onContentChangesProgress}if(n.onInitialViewCompleted){n.onInitialViewCompletedCallbacks.attach(n.onInitialViewCompleted);delete n.onInitialViewCompleted}return n};c.prototype.isLoadingFinished=function(){var e=this.contextMap.values();var t=e.next();while(!t.done){if(!t.value.isLoadingFinished()){return false}t=e.next()}return true};c.prototype.decrementResourceCountersForDeletedTreeNode=function(e,t){if(e){this.sceneBuilder.decrementResourceCountersForDeletedTreeNode(t,e.sceneId)}};function l(e,t){if(e.progressLogger){e.progressLogger.logPerformance(t,e.token)}}c.prototype.request=function(e,i,s){if(!i.root){throw"Context must include root where loaded objects are attached to"}var r=this.createContext(e,i);r.token=r.requestQueue.token;this.currentSceneInfo.id=e;r.retrievalType=t.RetrievalType.Initial;r.authorizationHandler=s;r.initialRequestTime=Date.now();if(r.enableLogger){a.createLogger(e,r,this)}var c;if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){c=Math.min(2*1024,this.getMaxUrlLength())}else if(sap.ui.Device.browser.mobile){c=Math.min(8*1024,this.getMaxUrlLength())}else{c=Math.min(64*1024,this.getMaxUrlLength())}var h=d(this.getUrl()+"streaming-http",this.getUrl(),e,this.getCorrelationId(),c);var u=r.requestQueue;u.meshes.setBatchSizeInfo(h[n.getMesh]);u.materials.setBatchSizeInfo(h[n.getMaterial]);u.geometries.setBatchSizeInfo(h[n.getGeometry]);u.geomMeshes.setBatchSizeInfo(h[n.getGeomMesh]);u.annotations.setBatchSizeInfo(h[n.getAnnotation]);u.tracks.setBatchSizeInfo(h[n.getTrack]);u.sequences.setBatchSizeInfo(h[n.getSequence]);u.parametric.setBatchSizeInfo(h[n.getParametric]);var p=this;(s&&s(this.getUrl())||Promise.resolve()).then(function(t){l(r,"modelRequested");o("modelRequested");p.postMessage({method:"useAccessTokenResponse",accessTokenResponse:t});p.postMessage({method:"initializeConnection",url:p.getUrl(),cid:p.getCorrelationId(),maxActiveRequests:p.getMaxActiveRequests()});p.postMessage({method:n.getScene,sceneId:e})})};c.prototype.postMessage=function(e){if(this._worker){this._worker.postMessage(e)}};c.prototype.processSetSceneCommand=function(e){var t=this.getContext(e.veid);if(t){t.defaultViewId=e.defaultViewId;t.defaultViewGroupId=e.defaultViewGroupId;t.sceneThumbnailId=e.imageId;t.dimension=e.dimension;t.defaultRootEntityId=e.defaultRootEntityId;if(t.defaultViewGroupId){t.currentViewGroupId=t.defaultViewGroupId}var i;if(t.activateView){i=t.activateView}else if(t.defaultViewId){i=t.defaultViewId}if(i){t.initialViewId=t.currentViewId=i;t.initialViewDecided=true}this.postMessage({method:n.getView,parameters:{sceneId:t.sceneId,viewId:i,query:a.configureSceneViewQuery(t)},pushViewGroups:t.pushViewGroups,isInitial:true})}};c.prototype.update=function(e,i,s){this.currentSceneInfo.id=e;var r=this.getContext(e);if(!r){return Promise.reject("no context for ${sceneVeId}")}var o=this;return new Promise(function(c,h){r.nodeSidsForPartialTree=new Set(i);r.retrievalType=t.RetrievalType.Partial;var u=function(){r.onPartialRetrievalFinishedCallbacks.detach(u);l(r,"updateFinished(mesh)");var t=[];var n=[];r.replacedNodes.forEach(function(e,i){n.push(e);t.push(i)});var a=t;var s=n;c({sceneVeId:e,sids:i,replacedNodeRefs:a,replacementNodeRefs:s})};r.onPartialRetrievalFinishedCallbacks.attach(u);l(r,"updateRequested");o.postMessage({method:n.getView,parameters:{sceneId:e,viewId:s,query:Object.assign(a.configureSceneViewQuery(r),{breadcrumbs:true}),sids:i},isPartialTree:true})})};c.prototype.requestViewGroup=function(e,t,i){if(!t){return Promise.reject("invalid arg: viewGroupId undefined")}var n=this.getContext(e);if(!n){return Promise.reject("no context for ${sceneVeId}")}if(i!==undefined){n.includeAnimation=i}var a=this;var s=new Promise(function(i,s){var r=a.sceneBuilder.getViewGroup(t,e);if(r&&r.length){i(r);return}var o=function(){n.onViewGroupFinishedCallbacks.detach(o);l(n,"onViewGroupFinished");var r=a.sceneBuilder.getViewGroup(t,e);if(r&&r.length){i(r)}else{s("no view ground data")}};n.onViewGroupFinishedCallbacks.attach(o);n.currentViewGroupId=t;a.postMessage({method:"getViewGroups",parameters:{sceneId:e,viewGroupId:t}})});return s};c.prototype.requestView=function(e,t,i,s,r){this.currentSceneInfo.id=e;if(t!=="static"){return Promise.reject("invalid arg: supported type - static")}if(!i){return Promise.reject("invalid arg: viewId undefined")}var o=this.getContext(e);if(!o){return Promise.reject("no context for ${sceneVeId}")}o.currentViewId=i;var c;var h;if(s&&s.length>0){h=n.getViewAnimations;c={$expand:[]};o.playbackIds=s}else{h=n.getView;c=a.configureSceneViewQuery(o)}this.hasAnimation=false;var u=this;var d=new Promise(function(e,t){o.onSetPlaybackCallbacks.detachAll();var n=function(i){o.onSetPlaybackCallbacks.detach(n);l(o,"onSetPlayback");if(i){e(i)}else{t("no view data")}};o.onSetPlaybackCallbacks.attach(n);o.onViewFinishedCallbacks.detachAll();var a=function(i){o.onViewFinishedCallbacks.detach(a);l(o,"onViewFinished");if(!u.hasAnimation){if(i){e(i)}else{t("no view data")}}else{o.currentView=i}};o.onViewFinishedCallbacks.attach(a);u.onSetSequenceCallbacks.detachAll();var s=function(){u.onSetSequenceCallbacks.detach(s);l(o,"onSetSequence");if(o.currentView){e(o.currentView)}};u.onSetSequenceCallbacks.attach(s);u.onSetTrackCallbacks.detachAll();var r=function(t){u.onSetTrackCallbacks.detach(r);l(o,"onSetTrack");if(o.currentView){e(o.currentView)}};u.onSetTrackCallbacks.attach(r);l(o,"viewRequested");u.postMessage({method:h,parameters:{sceneId:o.sceneId,viewId:i,query:c}})});return d};c.prototype.requestMaterial=function(e,t){if(!t){return Promise.reject("invalid arg: requestedMaterial undefined")}var i=this.getContext(e);if(!i){return Promise.reject("no context for ${sceneVeId}")}var n=this;var a=new Promise(function(e,a){var s="";if(typeof t=="string"){s=t}else if(typeof t=="object"){if(typeof t.getMaterialRef==="function"){e(t.getMaterialRef());return}else if(t.id){s=t.id}else if(t.veId){s=t.veId}else{a("invalid arg: invalid requestedMaterial object");return}}else{a("invalid arg: requestedMaterial must be an object or a string");return}var r=i.sceneBuilder.getMaterial(s);if(r){e(r);return}i.requestQueue.materials.push(s);var o=function(t){if(s!==t.materialId){return}var i=n.sceneBuilder.getMaterial(s);if(i&&!i.userData.imageIdsToAddAsTexture){n.sceneBuilder.detachImageAddedToMaterial(o);e(i)}};var c=function(t){if(s!=t){return}n.onMaterialFinishedCallbacks.detach(c);var i=n.sceneBuilder.getMaterial(s);if(!i){n.sceneBuilder.detachImageAddedToMaterial(o);a("no material data")}if(i.userData.imageIdsToAddAsTexture){return}n.sceneBuilder.detachImageAddedToMaterial(o);e(i)};n.onMaterialFinishedCallbacks.attach(c);n.sceneBuilder.attachImageAddedToMaterial(o);n.sendRequest(i.requestQueue)});return a};c.prototype.requestAnnotation=function(e,t){if(!t){return Promise.reject("invalid arg: annotationId undefined")}var i=this.getContext(e);if(!i){return Promise.reject("no context for ${sceneVeId}")}var n=this;var a=new Promise(function(e,a){var s=function(e){return i.sceneBuilder.getAnnotation?i.sceneBuilder.getAnnotation(e):null};var r=s(t);if(r){e(r);return}i.requestQueue.annotations.push(t);var o;var c;var l=function(i){n.onAnnotationFinishedCallbacks.detach(o);var a=s(t);var r=n.sceneBuilder._getMaterial(a.label.materialId);if(r&&r.userData.imageDetailsToLoad&&!r.userData.imageDetailsToLoad.size){n.onImageDetailsFinishedCallbacks.detach(l);if(r.userData.imageIdsToLoad&&r.userData.imageIdsToLoad.size){return}e(a)}};var h=function(i){n.onAnnotationFinishedCallbacks.detach(o);var a=s(t);var r=n.sceneBuilder._getMaterial(a.label.materialId);if(r&&r.userData.imageIdsToLoad&&!r.userData.imageIdsToLoad.size){n.onImageFinishedCallbacks.detach(h);if(r.userData.imageDetailsToLoad&&r.userData.imageDetailsToLoad.size){return}e(a)}};c=function(i){n.onAnnotationFinishedCallbacks.detach(o);var r=s(t);if(r.label.materialId!=i){return}n.onMaterialFinishedCallbacks.detach(c);if(!n.sceneBuilder.checkMaterialExists(i,false)){n.onImageFinishedCallbacks.detach(h);a("no material data")}var u=n.sceneBuilder._getMaterial(i);if(u.userData.imageIdsToLoad&&u.userData.imageIdsToLoad.size||u.userData.imageDetailsToLoad&&u.userData.imageDetailsToLoad.size){return}n.onImageFinishedCallbacks.detach(h);n.onImageDetailsFinishedCallbacks.detach(l);e(r)};o=function(i){if(t!==i){return}n.onAnnotationFinishedCallbacks.detach(o);var s=n.sceneBuilder.getAnnotation?n.sceneBuilder.getAnnotation(t):null;if(!s){n.onMaterialFinishedCallbacks.detach(c);n.onImageFinishedCallbacks.detach(h);n.onImageDetailsFinishedCallbacks.detach(l);a("no annotation data")}n.onMaterialFinishedCallbacks.detach(c);n.onImageFinishedCallbacks.detach(h);n.onImageDetailsFinishedCallbacks.detach(l);e(s)};n.onAnnotationFinishedCallbacks.attach(o);n.onMaterialFinishedCallbacks.attach(c);n.onImageFinishedCallbacks.attach(h);n.onImageDetailsFinishedCallbacks.attach(l);n.sendRequest(i.requestQueue)});return a};c.prototype.setSuppressSendRequests=function(e){this._suppressSendRequests=e};c.prototype.sendRequest=function(e){if(!this._worker||this._suppressSendRequests){return false}var t=false;while(!e.isEmpty()){var i=e.generateRequestCommand();this.postMessage(i);t=true}return t};c.prototype.timestamp=function(e){};c.prototype.performanceTiming=function(e){};c.prototype.checkError=function(e){if(!e){return true}var t=e.result==="failure";if(t){if(e.message){e.error=e.message;delete e.message}else{e.error="Unknown error"}}return t};c.prototype.reportError=function(e,t){this.onErrorCallbacks.execute({error:t,context:e})};c.prototype.processContextCommand=function(e,t,i,n,a){if(!e){var s=t+" error: unknown context - "+JSON.stringify(i);this.contextMap.forEach(function(e){e[t].call(e,i,n)});return{error:s}}var r;try{r=e[t].call(e,i,n,a)}catch(e){r={error:e}}return r};c.prototype.processCommand=function(t,i,a,s){if(this.checkError(i)){if(t===n.setTree){if(i.events&&i.events.length){var r=i.events[0];if(r.values&&r.values.id){this.contextMap.delete(r.values.id)}}}this.onErrorCallbacks.execute(i);return null}var o=null;if(i.sceneId!==undefined){o=this.getContext(i.sceneId)}else if(i.token!==undefined){o=this.tokenContextMap.get(i.token)}if(o){this.currentSceneInfo.id=o.sceneId}this.setPerformance(t,i,o?o.sceneId:null);var c;switch(t){case n.setScene:this.processSetSceneCommand(i);break;case n.setTree:case n.setTreeNode:case n.notifyFinishedTree:case n.setView:case n.setViewNode:case n.setViewGroup:case n.notifyFinishedView:case n.setCamera:case n.setMesh:case n.setMaterial:case n.setGeometry:case n.setImage:case n.setAnnotation:case n.setLineStyle:case n.setFillStyle:case n.setTextStyle:case n.setParametric:case n.setPlayback:case n.setHighlightStyle:case n.setSequence:case n.setTrack:case n.suppressSendRequests:case n.unsuppressSendRequests:c=this.processContextCommand(o,t,i,a,s);break;case n.notifyError:c={error:i.errorText};break;case n.timestamp:c=this.timestamp(i);break;case n.performanceTiming:c=this.performanceTiming(i);break;default:c={error:"Unknown command: "+t};break}if(this.isLoadingFinished()){if(t!==n.setScene&&t!==n.setView&&t!==n.setViewNode&&t!==n.timestamp&&t!==n.performanceTiming&&t!==n.suppressSendRequests&&t!==n.unsuppressSendRequests&&this._loadingFinishedSent===false){this.onLoadingFinishedCallbacks.execute();this._loadingFinishedSent=true;e.info("Loading is finished - all streaming requests are fulfilled.")}}else if(this._loadingFinishedSent){this._loadingFinishedSent=false}if(c&&c.error){e.error(c.error);this.onErrorCallbacks.execute(c)}return o};c.prototype.setPerformance=function(e,t,i){var a;switch(e){case n.setGeometry:a=t.id;o("setGeometry-"+a);break;case n.setImage:a=t.id;o("setImage-"+a);break;case n.setView:a=t.viewId;o("setView-"+a);break;case n.setViewGroup:a=t.id;o("setViewGroup-"+a);break;case n.setMesh:o("setMesh-"+i);break;case n.setMaterial:o("setMaterial-"+i);break;case n.setTree:o("setTree-"+i);break;case n.performanceTiming:this._isPostable=true;this.postPerformanceTiming();break;default:break}};c.prototype.postPerformanceTiming=function(e){if(e){this._performanceTimingMsg.push(e)}if(this._isPostable&&this._performanceTimingMsg.length>0){this.postMessage(this._performanceTimingMsg.shift());this._isPostable=false}};c.prototype.printLogTokens=function(){this.contextMap.forEach(function(t,i){e.info("log tokens for scene => "+i);e.info("---------------------------------------");if(t.progressLogger){t.progressLogger.getTokens().forEach(function(t){e.info(t)})}e.info("---------------------------------------")})};function h(e,t,i,n,a,s){var r;var o;switch(e){case"getGeometry":o=s-(i+"geometry?id=").length;break;case"getGeomMesh":o=s-(i+"scenes/"+n+"/meshes?ids="+r).length;break;default:r="?request="+encodeURI(e+"["+s+"]"+JSON.stringify({sceneId:n,ids:[],token:a}));o=s-(t+r).length;break}return o}function u(e){switch(e){case"getGeometry":return"&id=".length;default:return",".length}}function d(e,t,i,n,a){e=e.indexOf("?")===-1?e:e.substring(0,e.indexOf("?"));var s=["getAnnotation","getGeometry","getGeomMesh","getMaterial","getMesh","getParametric","getSequence","getTrack"];var r={};s.forEach(function(s){r[s]={maxBatchStringLength:h(s,e,t,i,n,a),separatorLength:u(s)}});return r}return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/TotaraUtils", ["./Command","../IncludeUsageIdType"],function(e,r){"use strict";var n={};n.createCommand=function(e,r){var n=JSON.stringify(r);return e+("["+n.length+"]")+n};n.createRequestCommand=function(e,r,t){return{command:n.createCommand(e,r),method:e,isInitial:t===true}};n.createRequest=function(e,r,n){return{method:e,parameters:r,isInitial:n===true}};function t(r,t,a){if(!r||!t||!a){throw"ProgressLogger: invalid args"}this.context=t;this.loader=a;var i=new Set;this.logPerformance=function(r,a){if(!r||!a){return}i.add(a);var o={name:r,timestamp:Date.now(),token:a};var u={method:e.addClientLog,url:this.loader.getUrl(),token:t.token,command:n.createCommand(e.addClientLog,o)};this.loader.postMessage(u)};this.getTokens=function(){return i};this.logPerformanceTiming=function(r,a){var o=this;r.sort(function(e,r){return e.timestamp-r.timestamp});if(!r.length){return}i.add(t.token);var u=[];while(r.length){u.push(r.splice(0,10))}u.forEach(function(r){var i={records:[],timestamp:Date.now()};r.forEach(function(e){i.records.push({name:e.name,timestamp:e.timestamp,uuid:e.uuid,duration:e.duration,value:e.value,parent_uuid:a})});var u=n.createCommand(e.performanceTiming,i);o.loader.postPerformanceTiming({method:e.performanceTiming,url:o.loader.getUrl(),token:t.token,command:u})})}}n.mark=function(e){window.performance.mark(e)};n.measure=function(e,r,n){var t=window.performance;if(performance.getEntriesByName(r).length!==0){if(!n){t.measure(e,r)}else{t.measure(e,r,n)}}t.clearMarks(r);if(n){t.clearMarks(n)}t.clearMeasures(e)};n.perfObserve=function(e){if(!window.PerformanceObserver){return}var r=[];var t;var a=performance.timing.navigationStart;var i=new window.PerformanceObserver(function(i){i.getEntries().forEach(function(e){e.uuid=n.generateToken();e.timestamp=a+e.startTime;if(e.name==="sceneMeasure"){t=e.uuid}r.push(e)});if(r.find(function(e){return e.name==="sceneCompleted"})){n.measure("sceneMeasure","modelRequested","sceneCompleted")}if(t){r=r.filter(function(e){return e instanceof PerformanceMeasure});e.progressLogger.logPerformanceTiming(r,t);t=""}});i.observe({entryTypes:["mark","measure"]})};n.createLogger=function(e,r,a){if(!r){return null}r.progressLogger=new t(e,r,a);n.perfObserve(r);return r.progressLogger};n.base64ToUint8Array=function(e){var r=atob(e);var n=r.length;var t=new Uint8Array(n);for(var a=0;a<n;a++){t[a]=r.charCodeAt(a)}return t};n.arrayToColumnMajorMatrixArray16=function(e){if(e.length===16){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}if(e.length===12){return[e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1]}if(e.length===3){return[1,0,0,e[0],0,1,0,e[1],0,0,1,e[2],0,0,0,1]}return null};n.pushElementIntoMapArray=function(e,r,n){var t=e.get(r);if(!t){t=[];e.set(r,t)}else if(t.length>0&&t[t.length-1]===n){return}t.push(n)};n.generateToken=function(){return a()};function a(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var i=["annotationId","closed","contentType","entityId","highlightStyleId","materialId","meshId","name","opacity","renderOrder","transform","visible"];var o=["annotation","bounds","highlight","nodes"];var u=["annotation","drawing","geometry","hotspot","reference","sectionplane","solid","symbol","unknown"];n.configureSceneViewQuery=function(e){var n=i.slice();var t=o.slice();var a=u.slice();if(e.includeAnimation){t.push("animation")}if(e.includeBackground){a.push("background")}if(e.includeParametric){t.push("parametric");a.push("parametric")}if(e.includeUsageId){t=t.concat(r.to$expandQueryParameter(e.includeUsageId))}if(e.pushPMI){a.push("pmi")}var s={$select:n.join(","),$expand:t.join(","),contentTypes:a.join(","),hidden:e.includeHidden};if(e.metadataFilter!=null){s.metadataFilter=e.metadataFilter}return s};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/utf8ArrayBufferToString", [],function(){"use strict";var e=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(e))))};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/uuidv4", [],function(){"use strict";var x=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(x){var r=Math.random()*16|0,n=x=="x"?r:r&3|8;return n.toString(16)})};return x},true);
sap.ui.require.preload({
	"sap/ui/vk/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ui.vk","type":"library","embeds":[],"applicationVersion":{"version":"1.108.4"},"title":"SAPUI5 Visualization Toolkit.","description":"SAPUI5 Visualization Toolkit.","ach":"CA-UI5-VTK","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb","sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.108","libs":{"sap.ui.core":{"minVersion":"1.108.25"},"sap.ui.unified":{"minVersion":"1.108.25","lazy":true},"sap.m":{"minVersion":"1.108.25","lazy":true},"sap.ui.layout":{"minVersion":"1.108.25","lazy":true},"sap.ui.vbm":{"minVersion":"1.108.4","lazy":true},"sap.ui.richtexteditor":{"minVersion":"1.108.25","lazy":true}}},"library":{"i18n":false,"content":{"controls":[],"elements":[],"types":[],"interfaces":[]}}}}',
	"sap/ui/vk/matai/MataiLoaderWorker.js":function(){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
(function(){"use strict";console.log("MataiLoaderWorker started.");function e(e){this.sceneBuilderId=e}e.prototype.setScene=function(e){e.cameraId=e.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[e]})};function t(e){var t=[];for(var s in e){var r=s.indexOf("/");if(r>=0){var i=[];var a=e[s];if(a){for(var o in a){i.push({name:o,value:a[o]})}}t.push({source:s.substr(0,r),type:s.substr(r+1),fields:i})}}return t}e.prototype.createNode=function(e){e.parentId=e.parentRef;if(e.transformType===1){e.transformType="BILLBOARD_VIEW"}else if(e.transformType===257){e.transformType="LOCK_TOVIEWPORT"}e.transform=e.matrix;e.sid=e.nodeRef;if(e.veids){e.veids=t(e.veids)}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[e]},[e.transform.buffer])};e.prototype.createMesh=function(e){var t=[e.boundingBox.buffer];if(e.transform){t.push(e.matrix.buffer)}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:e.meshRef,materialId:e.materialRef,transform:e.matrix,lods:[{id:e.meshRef,boundingBox:e.boundingBox}]}]},t)};e.prototype.setMeshGeometry=function(e){var t=[e.data.index.buffer,e.data.position.buffer];if(e.data.normal){t.push(e.data.normal.buffer)}if(e.data.uv){t.push(e.data.uv.buffer)}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:e.geometryId,isPolyline:(e.flags&1)>0,data:{indices:e.data.index,points:e.data.position,normals:e.data.normal,uvs:e.data.uv}}]},t)};e.prototype.insertMesh=function(e,t){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[e,t]})};e.prototype.createTextAnnotation=function(e){e.coordinateSpace=0;e.nodeId=e.nodeRef;e.fontFace=e.font;e.shape=e.style;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};e.prototype.createSubMesh=function(e){var t=[e.boundingBox.buffer];if(e.transform){t.push(e.matrix.buffer)}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:e.meshRef,materialId:e.materialRef,transform:e.matrix,lods:[{id:e.geometryId,flags:e.flags,pointCount:e.pointCount,elementCount:e.elementCount,boundingBox:e.boundingBox}]}]},t)};e.prototype.createSubMeshes=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setSubmeshes",args:[e]})};e.prototype.createTextNote=function(e){e.coordinateSpace=2;e.nodeId=e.nodeRef;e.id=e.nodeRef;e.sid=e.targetNodeRef;e.fontFace=e.font;e.shape=e.style;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};e.prototype.createImageNote=function(e){e.properlyAligned=true;e.nodeId=e.nodeRef;e.labelMaterialId=e.materialRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[e]})};e.prototype.insertLeaderLine=function(e){var t=[];for(var s=0;s<e.points.length;s+=3){var r=[e.points[s],e.points[s+1],e.points[s+2]];t.push(r)}e.points=t;e.annotationId=e.nodeRef;e.nodeId=e.nodeRef;e.startPointSid=e.targetNodeRef;e.materialId=e.materialRef;e.startPointHeadStyle=e.startPointStyle;e.endPointHeadStyle=e.endPointStyle;e.pointHeadConstant=e.styleConstant;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[e]})};e.prototype.setParametricContent=function(e,t){t.materialID=t.materialID||undefined;var s=[];if(t.t){s.push(t.t.buffer)}if(t.r){s.push(t.r.buffer)}if(t.s){s.push(t.s.buffer)}if(t.segments){t.segments.forEach(function(e){if(e.points){s.push(e.points.buffer)}})}var r=t.lineStyle;if(r){if(r.colour){s.push(r.colour.buffer)}}var i=t.fillStyle;if(i){if(i.colour){s.push(i.colour.buffer)}if(i.start){s.push(i.start.buffer)}if(i.end){s.push(i.end.buffer)}if(i.radii){s.push(i.radii.buffer)}if(i.gradient){s.push(i.gradient.buffer)}if(i.gradientTransform){s.push(i.gradientTransform.buffer)}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setParametricContent",args:[e,t]},s)};e.prototype.createCamera=function(e){e.ortho=e.projection==="orthographic";e.near=e.nearClip;e.far=e.farClip;e.fov=e.fov*Math.PI/180;e.zoom=e.orthoZoomFactor;e.id=e.cameraRef;var t=[e.origin.buffer,e.up.buffer,e.target.buffer];if(e.matrix){t.push(e.matrix.buffer)}e.notUseDirectionVector=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[e]},t)};e.prototype.insertCamera=function(e,t){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[e,t]})};e.prototype.createViewportGroup=function(e){e.id=e.viewportGroupRef;if(e.veids){e.veids=t(e.veids)}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[e]})};e.prototype.finalizePlaybacks=function(e){e.viewGroupId=e.viewportGroupRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[e]})};e.prototype.insertModelView=function(e){e.viewGroupId=e.viewportGroupRef;e.viewId=e.modelViewRef;e.thumbnailId=e.thumbnail;e.cameraId=e.cameraRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[e]})};e.prototype.setModelViewVisibilitySet=function(e){e.viewId=e.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[e]})};e.prototype.insertModelViewHighlight=function(e){e.viewId=e.modelViewRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[e]})};e.prototype.createThumbnail=function(e){e.imageId=e.imageRef;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[e]})};e.prototype.createDetailView=function(e){e.nodeId=e.nodeRef;e.detailViewId=e.detailViewRef;e.cameraId=e.cameraRef;e.attachment=e.attachmentPoint;var t=[e.origin.buffer,e.size.buffer];if(e.attachment){t.push(e.attachment.buffer)}if(e.visibleNodes){t.push(e.visibleNodes.buffer)}if(e.targetNodes){t.push(e.targetNodes.buffer)}e.properlyAligned=true;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[e]},t)};e.prototype.createMaterial=function(e){e.id=e.materialRef;var t=[e.ambientColour.buffer,e.diffuseColour.buffer,e.specularColour.buffer,e.emissiveColour.buffer];if(e.lineColour&&e.lineDashPattern){t.push(e.lineColour.buffer,e.lineDashPattern.buffer)}if(e.textures){for(var s=0;s<e.textures.length;s++){var r=e.textures[s];var i="texture"+r.type.charAt(0).toUpperCase()+r.type.slice(1);e[i]={imageId:r.imageRef,matrix:r.matrix,uvHorizontalScale:r.scaleX,uvVerticalScale:r.scaleY,uvHorizontalOffset:r.offsetX,uvVerticalOffset:r.offsetY,uvRotationAngle:r.angle,influence:r.amount,filterMode:r.filterMode,uvHorizontalTilingEnabled:r.repeatX,uvVerticalTilingEnabled:r.repeatY,uvClampToBordersEnabled:r.clampToBorder,inverted:r.invert,modulate:r.modulate}}}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[e]},t)};e.prototype.createImage=function(e){e.id=e.imageRef;e.binaryData=e.data;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[e]},[e.binaryData.buffer])};e.prototype.progress=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[e]})};e.prototype.insertThrustline=function(e){e.thrustlineId=e.thrustlineRef;e.materialId=e.material;self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[e]})};e.prototype.insertAnimationGroup=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[e]})};e.prototype.insertAnimation=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[e]})};e.prototype.insertAnimationTarget=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[e]})};e.prototype.insertAnimationTrack=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[e]})};e.prototype.finalizeAnimation=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[e]})};e.prototype.requestReferencedFile=function(e){self.postMessage({sceneBuilderId:this.sceneBuilderId,event:"referencedFileRequested",fileName:e.FileName,veId:e.VEID,veVersion:e.VEVersion})};var s=new Map;self.onmessage=function(t){var r;var i=0;var a=t.data.method;var o=t.data.args;switch(a){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:o.scriptDirectory}).then(function(e){console.log("MataiLoaderWorker runtime created.");self.matai=e;self.postMessage({event:"runtimeCreated"})});break;case"createContext":r=new e(o.sceneBuilderId);s.set(o.sceneBuilderId,r);i=self.matai.createContext(r,o.buffer,o.fileName,o.locale,"");self.postMessage({event:"contextCreated",sceneBuilderId:o.sceneBuilderId,result:i});break;case"destroyContext":r=s.get(o.sceneBuilderId);s.delete(o.sceneBuilderId);self.matai.destroyContext(r);break;case"loadFile":r=s.get(o.sceneBuilderId);i=self.matai.loadFile(r);self.postMessage({event:"fileLoaded",sceneBuilderId:o.sceneBuilderId,result:i});break;case"loadReferencedFile":r=s.get(o.sceneBuilderId);i=self.matai.loadReferencedFile(r,o.buffer,o.fileName,o.veId,o.veVersion);self.postMessage({event:"referencedFileLoaded",sceneBuilderId:o.sceneBuilderId,fileName:o.fileName,result:i});break;case"buildScene":r=s.get(o.sceneBuilderId);i=self.matai.buildScene(r);self.postMessage({sceneBuilderId:o.sceneBuilderId,event:"sceneBuilt",result:i});break;default:break}};console.log("MataiLoaderWorker initialized.")})();
},
	"sap/ui/vk/measurements/Calibration.fragment.xml":'<core:FragmentDefinition\n  xmlns="sap.m"\n  xmlns:core="sap.ui.core"\n  xmlns:vkm="sap.ui.vk.measurements"\n><Dialog\n    id="measurementCalibration"\n    title="{i18n>MEASUREMENTS_CALIBRATION_DIALOG_TITLE}"\n    draggable="true"\n    afterClose=".onAfterClose"\n    initialFocus="distance"\n  ><VBox fitContainer="true" renderType="Bare" class="sapUiResponsiveMargin"><Label text="{/label}" showColon="true"/><HBox fitContainer="true" renderType="Bare"><Input id="distance" type="Number" placeholder="{i18n>MEASUREMENTS_CALIBRATION_INPUT_PLACEHOLDER}" value=\'{ path: "/distance", type: "sap.ui.model.type.Float" }\'/><Button id="reset" icon="sap-icon://reset" type="Transparent" class="sapUiTinyMarginBegin" tooltip="{i18n>MEASUREMENTS_CALIBRATION_RESET_BUTTON_TOOLTIP}" press=".onResetPressed"/></HBox></VBox><beginButton><Button id="ok" text="{i18n>MEASUREMENTS_CALIBRATION_OK_BUTTON}" press=".onOkPressed"/></beginButton><endButton><Button id="cancel" text="{i18n>MEASUREMENTS_CALIBRATION_CANCEL_BUTTON}" press=".onCancelPressed"/></endButton></Dialog></core:FragmentDefinition>\n',
	"sap/ui/vk/measurements/Settings.fragment.xml":'<core:FragmentDefinition\n  xmlns="sap.m"\n  xmlns:core="sap.ui.core"\n  xmlns:vkm="sap.ui.vk.measurements"\n><Dialog\n    id="measurementSettings"\n    title="{i18n>MEASUREMENTS_SETTINGS_DIALOG_TITLE}"\n    resizable="true"\n    draggable="true"\n    contentWidth="400px"\n    afterClose=".onAfterClose"\n    initialFocus="precision"\n  ><VBox fitContainer="true" renderType="Bare" class="sapUiResponsiveMargin"><Label text="{i18n>MEASUREMENTS_SETTINGS_PRECISIONS_LABEL}" showColon="true"/><Select id="precision" selectedKey=\'{ path: "settings>/precision", type: "sap.ui.model.type.Integer" }\' change=".onChange"><core:Item key="0" text="{value: 0, formatter: \'.formatPrecision\'}"/><core:Item key="1" text="{value: 1, formatter: \'.formatPrecision\'}"/><core:Item key="2" text="{value: 2, formatter: \'.formatPrecision\'}"/><core:Item key="3" text="{value: 3, formatter: \'.formatPrecision\'}"/><core:Item key="4" text="{value: 4, formatter: \'.formatPrecision\'}"/><core:Item key="5" text="{value: 5, formatter: \'.formatPrecision\'}"/></Select><Label text="{i18n>MEASUREMENTS_SETTINGS_UNITS_LABEL}" showColon="true" class="sapUiSmallMarginTop"/><Select id="units" selectedKey="{settings>/units}" change=".onChange"><core:Item key="mm" text="{i18n>UNITS_MM}"/><core:Item key="cm" text="{i18n>UNITS_CM}"/><core:Item key="m" text="{i18n>UNITS_M}"/><core:Item key="in" text="{i18n>UNITS_IN}"/><core:Item key="ft" text="{i18n>UNITS_FT}"/></Select><Label text="{i18n>MEASUREMENTS_SETTINGS_LINE_COLOR_LABEL}" showColon="true" class="sapUiSmallMarginTop"/><RadioButtonGroup selectedIndex="{settings>/color}" select=".onChange" ><vkm:ColorRadioButton color="#0A6ED1"/><vkm:ColorRadioButton color="#107E3E"/><vkm:ColorRadioButton color="#BB0000"/><vkm:ColorRadioButton color="#925ACE"/><vkm:ColorRadioButton color="#C0399F"/></RadioButtonGroup><Label text="{i18n>MEASUREMENTS_SETTINGS_REFERENCE_FEATURES_TITLE}" showColon="true" class="sapUiSmallMarginTop"/><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-vertex"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_VERTEX}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureVertex}"/></HBox><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-edge"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_EDGE}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureEdge}"/></HBox><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-face"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_FACE}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureFace}"/></HBox><Text text="{i18n>MEASUREMENTS_SETTINGS_REFERENCE_FEATURES_FOOTNOTE}" class="sapUiSmallMarginTop"/></VBox><beginButton><Button\n        id="close"\n        text="{i18n>MEASUREMENTS_SETTINGS_CLOSE_BUTTON}"\n        press=".onClosePressed"\n      /></beginButton></Dialog></core:FragmentDefinition>\n',
	"sap/ui/vk/totara/TotaraLoaderWorker.js":function(){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
(function(){"use strict";var e={};["initializeConnection","getScene","getGeomMesh","getAnnotation","getMaterial","getImage","getView"].reverse().forEach(function(n,t){e[n]=t});var n=new Map;var t;var s;var a;var i;var r=[];var o=4;var c=0;function u(n,s,a){return new Promise(function(i,u){r.push({url:t+n,context:s,priority:e[s&&s.method]||0,responseType:a,resolve:i,reject:u});if(c<o){l()}})}function l(){if(!r.length){return}r.sort(function(e,n){return e.priority-n.priority});var e=r.pop();c++;f(encodeURI(e.url),e.responseType).then(function(n){e.resolve(n);c--;l()}).catch(function(n){x({errorText:"Could not connect to server: "+t,error:n.status,reason:n.message?n.message:n,context:e.context});if(e.reject){e.reject(n)}c--;l()})}function f(e,t){return new Promise(function(r,o){var c=new XMLHttpRequest;c.onload=function(){if(this.status>=200&&this.status<300){if(this.getAllResponseHeaders().includes("tile-width")){var e=this.getResponseHeader("tile-width");var t=new RegExp("[^/]+$");var s=this.responseURL.match(t);n.set(s[0],e)}r(this.response)}else{o({status:this.status,statusText:this.statusText})}};c.onerror=function(){o({status:this.status,statusText:this.statusText})};c.open("GET",e,true);if(a){c.setRequestHeader("Authorization",a)}if(i){c.setRequestHeader("X-TenantUuid",i)}c.setRequestHeader("X-CorrelationID",s);c.responseType=t||"arraybuffer";c.send()})}var d="TextDecoder"in self?function(){var e=new TextDecoder;return function(n,t,s){return e.decode(new DataView(n,t,s-t))}}():function(e,n,t){var s="";var a=1e3;try{while(n<t){var i=Math.min(a,t-n);var r=new Uint8Array(e,n,i);s+=String.fromCharCode.apply(null,r);n+=i}}catch(e){return""}return decodeURIComponent(escape(s))};function v(e){var n=e.split(",");if(n.length<0||n.length>2){throw"invalid content length"}var t=0;var s=0;try{t=parseInt(n[0],10);if(n.length===2){s=parseInt(n[1],10)}}catch(e){throw"invalid content length"}return{jsonContentLength:t,binaryContentLength:s}}function h(e,n){var t="[".charCodeAt(0);var s="]".charCodeAt(0);var a=[];var i=0;var r=0;var o;var c;var u;var l=new Uint8Array(e);while(r<e.byteLength){r=l.indexOf(t,i);if(r===-1){break}var f=d(e,i,r).replace(/\n|\r|\s/g,"");i=r+1;r=l.indexOf(s,i);if(r===-1){throw"No matching [] for command length. abort"}o=v(d(e,i,r));i=r+1;r=i+o.jsonContentLength;c=d(e,i,r);if(o.binaryContentLength){i=r;r=i+o.binaryContentLength;u=new Uint8Array(e,i,o.binaryContentLength)}else{u=undefined}i=r;var h={name:f,jsonString:c,isInitial:n};if(u){h.binaryContent=u}a.push(h)}return a}function p(e){var t;var s=-1;var a,i;var r=false;var o=false;var c=false;for(i=0;i<e.length;i++){t=e[i];if(t.name==="setView"){if(!r){if(!t.jsonContent.viewId){r=true}}o=true}else if(t.name==="setViewNode"){if(a===undefined){a=t.jsonContent.viewId}}else if(t.name==="setSequence"&&o){c=true}}if(a&&r){for(i=0;i<e.length;i++){t=e[i];if(t.name==="setView"){t.jsonContent={viewId:a};break}}}for(i=0;i<e.length;i++){t=e[i];if(t.name==="setPlayback"&&c){s=i;continue}if(t.name==="setImage"){var u=t.jsonContent.id;var l=u?n.get(u):null;if(l){t.jsonContent.tileWidth=l}}if(t.name==="setScene"&&e.length>1){continue}m(t)}if(s!==-1){t=e[s];m(t)}}function m(e){if(e.binaryContent){self.postMessage({name:e.name,jsonString:e.jsonString,jsonContent:e.jsonContent,binaryContent:e.binaryContent,isInitial:e.isInitial},[e.binaryContent.buffer])}else{self.postMessage({name:e.name,jsonString:e.jsonString,jsonContent:e.jsonContent,isInitial:e.isInitial})}}function I(e){var n="";for(var t in e){if(e[t]==null){continue}if(n.length!==0){n+="&"}n+=t+"="+e[t]}return n}function g(e){var n="scenes/"+e.sceneId+"?sid=1";u(n,e,"text").then(function(e){var n;try{n=JSON.parse(e)}catch(e){x({errorText:"Failed to parse JSON"});return}p([{name:"setScene",jsonContent:n.scene}])})}function y(e){var n=e.parameters.sceneId;var t=e.parameters.viewId;var s=e.parameters.sids;var a=e.isInitial;var i="scenes/"+n;if(t){i+="/views/"+t}i+="?"+I(e.parameters.query);if(s&&s.length>0){i+="&sid="+s.join("&sid=")}var r=e.isPartialTree;u(i,e,"text").then(function(s){var i;try{i=JSON.parse(s)}catch(e){x({errorText:"Failed to parse JSON"});return}var o=[];var c=t?i.views[0]:i.tree;var u=c.nodes;delete c.nodes;var l=i.highlightStyles;var f=i.annotations;var d=i.parametrics;var v=i.textStyles;var h=i.linestyles;var m=i.fillstyles;function I(e){if("style"in e&&v){e["style_id"]=v[e.style].veid}if("stroke"in e&&h){e["stroke_id"]=h[e.stroke].veid}if("fill"in e&&m){e["fill_id"]=m[e.fill].veid}}if(u){u.forEach(function(e){if("highlightStyle"in e&&l){e.highlightStyleId=l[e.highlightStyle].id}if("annotation"in e&&f){e.annotationId=f[e.annotation].id}if("parametric"in e&&d){e.parametricId=d[e.parametric].id}})}if(d){d.forEach(function(e){if("shapes"in e){e.shapes.forEach(I)}else{I(e)}})}o.push({name:"suppressSendRequests",jsonContent:{sceneId:n}});if(!r){c.sceneId=n;c.viewId=t;o.push({name:"setView",jsonContent:c,isInitial:a})}if(u){o.push({name:r?"setTreeNode":"setViewNode",jsonContent:{sceneId:n,viewId:t,nodes:u},isInitial:a})}o.push({name:r?"notifyFinishedTree":"notifyFinishedView",jsonContent:{sceneId:n,viewId:t},isInitial:a});if(l){l.forEach(function(e){e.sceneId=n;o.push({name:"setHighlightStyle",jsonContent:e,isInitial:a})})}if(v){o.push({name:"setTextStyle",jsonContent:{sceneId:n,textStyles:v},isInitial:a})}if(h){o.push({name:"setLineStyle",jsonContent:{sceneId:n,lineStyles:h},isInitial:a})}if(m){o.push({name:"setFillStyle",jsonContent:{sceneId:n,fillStyles:m},isInitial:a})}if(d){o.push({name:"setParametric",jsonContent:{sceneId:n,parametrics:i.parametrics},isInitial:a})}if(f){o.push({name:"setAnnotation",jsonContent:{sceneId:n,annotations:f},isInitial:a})}var g=i.animation;if(g&&g.sequences&&g.playbacks){var y={sceneId:n,viewId:t,tracks:g.tracks,sequences:g.sequences};if(g.joints){y.joints=g.joints}o.push({name:"setSequence",jsonContent:y,isInitial:a});g.playbacks.forEach(function(e){var n=g.sequences[e.sequence];e.sequenceId=n&&n.id});g.playbacks=g.playbacks.filter(function(e){return e.sequenceId!=null});o.push({name:"setPlayback",jsonContent:{sceneId:n,viewId:t,playbacks:g.playbacks},isInitial:a})}o.push({name:"unsuppressSendRequests",jsonContent:{sceneId:n}});p(o);if(e.pushViewGroups){C({method:"getViewGroups",parameters:{sceneId:n}})}})}function w(e){var n=e.parameters.sceneId;var t=e.parameters.viewId;var s="scenes/"+n+"/views/"+t+"/animations?"+I(e.parameters.query);u(s,e,"text").then(function(e){var s;try{s=JSON.parse(e)}catch(e){x({errorText:"Failed to parse JSON"});return}p([{name:"setPlayback",jsonContent:{sceneId:n,viewId:t,playbacks:s.playbacks}}])})}function C(e){var n=e.parameters.sceneId;var t=e.parameters.viewGroupId;var s="scenes/"+n+"/viewGroups";if(t){s+="/"+t}u(s,e,"text").then(function(e){var n;try{n=JSON.parse(e)}catch(e){x({errorText:"Failed to parse JSON"});return}p(n.groups.map(function(e){return{name:"setViewGroup",jsonContent:e}}))})}function j(e){var n=e.parameters.sceneId;var t=e.parameters.materialIds;var s=t.map(function(e){return"id="+e}).join("&");var a="scenes/"+n+"/materials?"+s;u(a,e,"text").then(function(e){var t;try{t=JSON.parse(e)}catch(e){x({errorText:"Failed to parse JSON"});return}t.sceneId=n;p([{name:"setMaterial",jsonContent:t}])})}function b(e){var n=e.parameters.sceneId;var t=e.parameters.annotationIds;var s=t.map(function(e){return"id="+e}).join("&");var a="scenes/"+n+"/annotations?"+s;u(a,e,"text").then(function(e){var t;try{t=JSON.parse(e)}catch(e){x({errorText:"Failed to parse JSON"});return}t.sceneId=n;p([{name:"setAnnotation",jsonContent:t}])})}function k(e){var n;if(e.materialId){n="scenes/"+e.sceneId+"/materials/"+e.materialId+"/images/"+e.imageId}else if(e.viewId){n="scenes/"+e.sceneId+"/views/"+e.viewId+"/images/"+e.imageId}else{return}u(n,e,"arraybuffer").then(function(n){p([{name:"setImage",jsonContent:{sceneId:e.sceneId,id:e.imageId,isInitial:e.isInitial},binaryContent:new Uint8Array(n)}])})}function S(e){var n="scenes/"+e.sceneId+"/meshes?ids="+e.meshIds.join(",");u(n,e,"arraybuffer").then(function(n){var t=h(n);t.forEach(function(n){n.jsonContent={sceneId:e.sceneId}});p(t)})}function x(e){self.postMessage({name:"notifyError",jsonContent:e})}self.onmessage=function(e){var n=e.data;switch(n.method){case"getAnnotation":{b(n);break}case"getGeomMesh":{S(n);break}case"getImage":{k(n);break}case"getMaterial":{j(n);break}case"getScene":{g(n);break}case"getView":{y(n);break}case"getViewAnimations":{w(n)}case"getViewGroups":{C(n);break}case"initializeConnection":{t=n.url;s=n.cid;o=n.maxActiveRequests;break}case"close":{self.close();break}case"useAccessTokenResponse":{if(n.accessTokenResponse){a=n.accessTokenResponse.token_type+" "+n.accessTokenResponse.access_token;i=n.accessTokenResponse.tenant_uuid}else{a=null;i=null}break}case"setMaxActiveRequests":{o=n.maxActiveRequests;break}case"addClientLog":{break}default:{console.warn("Unknown TotaraLoader command: "+n.method);break}}}})();
}
});
//# sourceMappingURL=library-preload.js.map

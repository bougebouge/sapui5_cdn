sap.ui.define(["sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/Table","sap/m/MessageBox","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool"],function(e,t,a,n,r,i,o,s,l,c,g,u,f,p,v,d,m,y,b,h,C){"use strict";var P="lib.CommonUtils";var S=sap.ui.getCore();var D=new f(P).getLogger();function A(e,t,n){var r;var s=new b(e);var f=Object.create(null);function y(e){var t;if(c.isSmartTable(e)){t=e.getCustomToolbar()}else if(c.isSmartChart(e)){t=e.getToolbar()}if(t){var a=N(t);if(a&&a.annotatedActionIds){f[e.getId()]=JSON.parse(atob(a.annotatedActionIds))}if(a&&a.deleteButtonId){f[e.getId()].push({ID:a.deleteButtonId,RecordType:"CRUDActionDelete"})}if(a&&a.multiEditButtonId){f[e.getId()].push({ID:a.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function A(e){var t=e.getId();if(!f[t]){y(e)}return f[t]||[]}function E(t){var a,n,r;a=e.getOwnerComponent().getModel().getMetaModel();n=a.getODataEntitySet(t);r=a.getODataEntityType(n.entityType);return r}function O(a){t.oApplication.attachControlToParent(a,e.getView())}function I(t,a,n){var r="";var i=e.getView();var o=t.find(function(e){var t;var o=n&&function(a){n(e,a,t);t=a};if(c.isElementVisibleOnView(e,i,o)){if(a){var s=S.byId(e);if(c.isTable(s)){r=r||e;return false}}return true}});return o||r}function T(a,n,r,i){return t.oApplication.getDialogFragmentForView(e.getView(),a,n,r,i)}function x(a,n,r,i,o){return t.oApplication.getDialogFragmentForViewAsync(e.getView(),a,n,r,i,o)}var M;function B(t,a,n){var r=e.getOwnerComponent();M=M||r.getModel("i18n").getResourceBundle();return M.getText(t,a,n)}function w(e,t,a,n){var r=a||e,i=t&&t!="|"?e+"|"+t:r;var o=B(i,n,true);if(!o&&i!=r){o=B(r,n)}return o}function R(t,a,n,r){var i=e.getOwnerComponent();var o=a.indexOf("::"+i.getEntitySet()+"--")+2;var s=a.substring(o,a.lastIndexOf("::")),s=s.replace(/--/g,"|").replace(/::/g,"|");return w(t,s,n,r)}function F(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function N(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function k(e){var a,n;var r=q(e);if(!c.isSmartTable(r)&&!c.isSmartChart(r)){r=r.getParent()}var i=t.oPresentationControlHandlerFactory.getPresentationControlHandler(r).getSelectedContexts();var o=r.getModel();G(i,o,r);a=A(r);for(var s=0;s<a.length;s++){n=a[s];V(n,o,i,r)}}function V(t,a,r,i){var o;if(t.RecordType==="CRUDActionDelete"){var s=H(a,r,i);n.getTemplatePrivateModel().setProperty("/listReport/deleteEnabled",s);o=Promise.resolve(s)}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var l=a.getMetaModel();o=U(a,l,r,t.RecordType,t.Action,i)}else if(t.RecordType==="CRUDActionMultiEdit"){n.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",r.filter(_).length>0)}var c=e.getView().byId(t.ID);if(c&&/generic\/controlProperties/.test(c.getBindingPath("enabled"))){o.then(j.bind(null,t.ID,"enabled"))}}function L(e){var a=z(e);G(t.oPresentationControlHandlerFactory.getPresentationControlHandler(a).getSelectedContexts(),e.getModel(),a)}function j(e,t,a){var r=n.getTemplatePrivateModel();var i=r.getProperty("/generic/controlProperties/"+e);if(!i){i={};i[t]=a;r.setProperty("/generic/controlProperties/"+e,i)}else{r.setProperty("/generic/controlProperties/"+e+"/"+t,a)}}function U(e,t,a,n,r,i){var o,s,l,g;var u=false;if(n==="com.sap.vocabularies.UI.v1.DataFieldForAction"){o=t.getODataFunctionImport(r);l=o&&o["sap:action-for"];if(l&&l!==""&&l!==" "){if(a.length>0){g=o["sap:applicable-path"];if(g&&g!==""&&g!==" "){for(var f=0;f<a.length;f++){if(!a[f]||a[f].isTransient()){continue}s=e.getObject(a[f].getPath());if(s&&s[g]){u=true;break}}}else{u=true}}}else{u=true}}else if(n==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(De(a).length>0){u=true}else if(c.isSmartChart(i)){return i.getChartAsync().then(function(){return i.getDrillStackFilters().length>0})}}return Promise.resolve(u)}function H(e,t,a){if(t.length===0){return false}var n=K(a);var r=n&&n.Deletable&&n.Deletable.Path;return t.some(function(t){var a=e.getObject(t.getPath()+"/DraftAdministrativeData");var n=!(a&&a.InProcessByUser&&!a.DraftIsProcessedByMe);return n&&!t.isTransient()&&!(r&&!e.getProperty(r,t))})}function K(e){var t=e.getModel()&&e.getModel().getMetaModel();var a=t&&t.getODataEntitySet(e.getEntitySet());var n=a&&a["Org.OData.Capabilities.V1.DeleteRestrictions"];return n}function _(e){var a=e.getModel();var n=a.getObject(e.getPath()+"/DraftAdministrativeData");var r=h.analyseContext(e);var i=t.oApplication.isObjectInEditMode(r.entitySet,r.key);if(!n&&!i){var o=a.getMetaModel().getODataEntitySet(h.analyseContext(e).entitySet);var s=o["Org.OData.Capabilities.V1.UpdateRestrictions"]&&o["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(s){if(s.Path){return!!a.getProperty(s.Path,e)}else if(s.Bool!=="false"){return true}}else{return true}}}function G(t,a,r){var i=J(r);var o=n.getTemplatePrivateModel();var s=o.getProperty("/generic/listCommons/breakoutActionsEnabled");if(i){var l=e.byId("template::IconTabBar");var c="";if(l){c=l.getSelectedKey()}W(s,i,t,a,c,r)}o.setProperty("/generic/listCommons/breakoutActionsEnabled",s)}function W(e,t,a,n,r,i){var o;for(var s in t){o=true;var l=t[s].id+(r&&!t[s].determining?"-"+r:"");if(i&&i.getId().indexOf("AnalyticalListPage")>-1){o=!!e[l].enabled}if(t[s].requiresSelection){if(a.length>0){if(i&&c.isSmartChart(i)){if(t[s].filter==="chart"){o=true}}else if(i&&c.isSmartTable(i)){if(t[s].filter!=="chart"){o=true}}if(t[s].applicablePath!==undefined&&t[s].applicablePath!==""){o=false;for(var g=0;g<a.length;g++){var u="";var f=t[s].applicablePath.split("/");if(f.length>1){for(var p=0;p<f.length-1;p++){u+="/"+f[p]}}var v=n.getObject(a[g].getPath()+u);var d=f[f.length-1];if(v[d]===true){o=true;break}}}}else if(c.isSmartChart(i)){if(i.getId().indexOf("AnalyticalListPage")>-1?t[s].filter==="chart":true){if(i.getDrillStackFilters().length>0){o=true}else{o=false}}}else{if(t[s].filter!=="chart"){o=false}}}e[l]={enabled:o}}}function J(e){var t=n.getControllerExtensions();var a=N(e).sectionId;if(!a){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[a]&&t.Sections[a].Actions}}function q(e){var t=e;while(t){if(t instanceof i||c.isUiTable(t)||c.isSmartTable(t)||c.isSmartChart(t)||c.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function z(e){var t=e;while(t){if(c.isSmartTable(t)||c.isSmartChart(t)||c.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function Y(a){if(!t.oApplication.checkEtags(a)){var n=e.getOwnerComponent();var r=n.getModel();var i=r.getMetaModel().getODataEntitySet(a);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&Q(r,i)){r.invalidateEntityType(i.entityType)}else{var o=function(e){return h.analyseContextPath(e,r).entitySet===a};r.invalidate(o)}var s=n.getId();var l=Object.create(null);l[s]=true;t.oApplication.refreshAllComponents(l);return true}return false}function Q(e,t){var a=new p.Model(p.Model.ReferenceByModel(e));var n=a.findQueryResultByName(t.name);var r=n&&n.getParameterization();return!!r}function X(a,r,i){var o;if(n.isDraftEnabled()){o=t.oDraftController.isActiveEntity(a)?1:6}else{var s=e.getOwnerComponent();o=s.getModel("ui").getProperty("/editable")?6:1}if(i){t.oApplication.setObjectInEditMode(true)}n.navigateAccordingToContext(a,o,r)}function Z(e){if(e instanceof l){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){o.show(B("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:B("ST_GENERIC_ERROR_TITLE")})}else{o.show(e.getErrorCode(),{title:B("ST_GENERIC_ERROR_TITLE")})}}}function $(a,n){fe(function(){r=t.oApplication.getNavigationHandler();var n={semanticObject:a.semanticObject,action:a.action};var i=r.mixAttributesAndSelectionVariant(a.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(i,n)}Ce(a);t.oApplication.navigateExternal(a.semanticObject,a.action,i.toJSONString(),null,Z)},Function.prototype,"LeaveApp")}function ee(t){var a=[],n,r,i;var o=e.getOwnerComponent();var s=o.getModel().getMetaModel();if(!t){return{}}var l=o.getAppComponent().getConfig().pages[0];if(!l){return{}}var c=function(e){i=s.getODataEntitySet(e.entitySet).entityType;r=s.getODataEntityType(i);n={};n={entitySet:e.entitySet,aKeys:s.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,a=n.aKeys.length;t<a;t++){var o=0,l=r.property.length;for(o;o<l;o++){if(n.aKeys[t].name===r.property[o].name){n.aKeys[t].type=r.property[o].type;break}}}};var g=function(e,t){if(!t.pages){return a}for(var r=0,i=t.pages.length;r<i;r++){if(!t.pages[r]){break}if(e===t.pages[r].entitySet){c(t.pages[r]);a.splice(0,0,n);break}a=g(e,t.pages[r]);if(a.length>0){c(t.pages[r]);a.splice(0,0,n)}}return a};return g(t,l)}function te(e,t){var a,n,r,i;for(r=0,i=e.length;r<i;r++){if(e[r].navigationProperty){n+="/"+e[r].navigationProperty}else{n="/"+e[r].entitySet}for(var o=0,s=e[r].aKeys.length;o<s;o++){if(o===0){n+="(";a=""}else{a=","}switch(e[r].aKeys[o].type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){n+=a+e[r].aKeys[o].name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{n+=a+e[r].aKeys[o].name+"="+"guid'"+t[e[r].aKeys[o].name]+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){n+=a+e[r].aKeys[o].name+"="+false}else{n+=a+e[r].aKeys[o].name+"="+t[e[r].aKeys[o].name]}break;default:if(typeof t[e[r].aKeys[o].name]==="string"){n+=a+e[r].aKeys[o].name+"="+"'"+t[e[r].aKeys[o].name]+"'"}else{n+=a+e[r].aKeys[o].name+"="+t[e[r].aKeys[o].name]}break}if(o===s-1){n+=")"}}}return n}function ae(e,a,n,i){var o,s,l,c,g,u,f;var p={semanticObject:"",action:""};var v=e.getParameters();r=t.oApplication.getNavigationHandler();o=r.mixAttributesAndSelectionVariant({},a);for(c in v.semanticAttributesOfSemanticObjects){for(l in v.semanticAttributesOfSemanticObjects[c]){if(!o.getSelectOption(l)){o.addParameter(l,"")}}g=o.getPropertyNames();p.semanticObject=c;u=o.getSelectOptionsPropertyNames();f=o.getParameterNames();for(var d=0,m=g.length;d<m;d++){if(u.indexOf(g[d])<0&&f.indexOf(g[d])<0){delete v.semanticAttributesOfSemanticObjects[c][g[d]];o.removeSelectOption(g[d])}}if(c===v.semanticObject){var y=v.semanticAttributesOfSemanticObjects[""];for(var b=0,m=f.length;b<m;b++){o.removeParameter(f[b]);if(!(f[b]in y)){var h=v.semanticAttributesOfSemanticObjects[v.semanticObject][f[b]];h=typeof h==="undefined"||h===null?"":String(h);o.addParameter(f[b],h)}}o=r.mixAttributesAndSelectionVariant(v.semanticAttributesOfSemanticObjects[c],o.toJSONString());o=ne(o,e.getSource(),i);n.adaptNavigationParameterExtension(o,p);s=o.toJSONString()}}delete v.semanticAttributes;r.processBeforeSmartLinkPopoverOpens(v,s)}function ne(t,a,n){var r;var i=[];var o=e.getOwnerComponent().getEntitySet();if(!c.isSemanticObjectController(a)&&!c.isSmartTable(a)){var s=q(a)&&q(a).getParent();if(c.isSmartTable(s)){a=s;r=a.getEntitySet()}else{r=o}}else{r=a.getEntitySet()}i.push(r);var l=n&&n.oMultipleViewsHandler&&n.oMultipleViewsHandler.getMode&&n.oMultipleViewsHandler.getMode()==="multi";if(r!==o&&!l){i.push(o)}i.forEach(function(e){if(a){var n=a.getModel().getMetaModel();var r=n.getODataEntityType(n.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var a=n.getODataProperty(r,e);if(a&&(a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function re(a,n){var r=function(e){for(var t=0;t<e.length;t++){n(e[t].name)}};var i=e.getView().getModel().getMetaModel();var o=i.getODataEntitySet(a,false);var s=i.getODataEntityType(o.entityType,false);r(s.key.propertyRef);var l=t.oDraftController.getDraftContext();if(l.isDraftEnabled(a)){r(l.getSemanticKey(a));n("IsActiveEntity");n("HasDraftEntity");n("HasActiveEntity")}}function ie(){return!!(n&&n.getSettings()&&n.getSettings().quickVariantSelectionX)}function oe(t,a,n,r){if(r&&n&&n.getAnalyticBindingPath&&n.getConsiderAnalyticalParameters()){try{var i=n.getAnalyticBindingPath();var o=t.getEntitySet();var s=t.getModel();var l=s.getMetaModel();var c=l.getODataEntitySet(o);var u=e.getOwnerComponent();var f=u.getAppComponent();var p=g.getParametersByEntitySet(f.getModel(),o);if(l.getODataEntityType(c.entityType)["sap:semantics"]!=="aggregate"||ie()){if(a){var v=a(c,p);i=v||i}}if(i){r(i)}}catch(e){D.warning("Mandatory parameters have no values")}}}function se(e,a,n){for(var r=0;r<a.length;r++){var i=a[r];var o=i.lastIndexOf("/");var s;if(o<0){if(t.oApplication.getNavigationProperty(e,i)){s=i}else{continue}}else{s=i.substring(0,o)}if(n.indexOf(s)===-1){n.push(s)}}}function le(t,r,i){var o=t.getParameter("bindingParams"),s=t.getSource().getId();o.parameters=o.parameters||{};o.parameters.transitionMessagesOnly=n.getNoStateMessagesForTables();var l=function(e,t,n){if(r&&r[e]){var i=true;var o=function(){var n=arguments[0];if(!(n instanceof a)){throw new m(P,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new m(P,"Extension "+e+" must be executed synchronously")}var r=Array.prototype.slice.call(arguments,1);t.apply(null,r)};r[e](o,n);i=false}};var c=function(a){if(!s||e.byId(s)===t.getSource()){o.filters.push(a)}};if(r.addTemplateSpecificFilters){r.addTemplateSpecificFilters(o.filters)}l("addExtensionFilters",c,s);var g=t.getSource();if(e.getMetadata().getName()!=="sap.suite.ui.generic.template.ObjectPage.view.Details"){oe(g,r.resolveParamaterizedEntitySet,i,r.setBindingPath)}var u=g.getEntitySet();var f=o.parameters.select&&o.parameters.select.split(",")||[];var p=o.parameters.expand&&o.parameters.expand.split(",")||[];var v=function(a,n){if(a&&(!n||e.byId(n)===t.getSource())){var r=a.split(",");r.forEach(function(e){if(e&&f.indexOf(e)===-1){f.push(e)}})}};if(r.isMandatoryFiltersRequired){re(u,v)}l("ensureExtensionFields",v,s);(r.addNecessaryFields||Function.prototype)(f,v,u);se(u,f,p);if(p.length>0){o.parameters.expand=p.join(",")}if(f.length>0){o.parameters.select=f.join(",")}}function ce(e,t,a){if(!e){return B("DRAFT_OBJECT")}else if(t){return B(a?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function ge(){return new Promise(function(e){var t;x("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return B(t,e[3])}}else{return B(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:ce},"admin").then(function(a){t=a;e(t)})})}function ue(e,a,n,r){return t.oDataLossHandler.performIfNoDataLoss(e,a,r,true,true)}function fe(e,a,r,i){r=r||"LeavePage";if(n.isDraftEnabled()){return t.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,a,r,i,false)}else{return t.oDataLossHandler.performIfNoDataLoss(e,a,r,i,false)}}function pe(e,a){a=d({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},a);var r,i;var o=new Promise(function(e,t){r=e;i=t});var s=a.busy.set?function(){t.oApplication.getBusyHelper().setBusy(o,false,{actionLabel:a.sActionLabel});return e()}:e;var l=a.mConsiderObjectsAsDeleted?function(e){t.oApplication.prepareDeletion(a.mConsiderObjectsAsDeleted);return s()}:s;var c=function(){var e;if(n.isDraftEnabled()){e=l()}else{e=a.dataloss.popup?fe(l,i,null,a.dataloss.navigation?"LeavePage":"Proceed",true):l()}if(e instanceof Promise){e.then(r,i)}else{r(e)}};t.oApplication.performAfterSideEffectExecution(c,a.busy.check&&i);return o}function ve(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var n=a.getDefaultVariantKey();return n===a.STANDARDVARIANTKEY?"":n}function de(e){var t=e.getId()+"-variant";var a=sap.ui.getCore().byId(t);var n=a.getDefaultVariantKey();return n===a.STANDARDVARIANTKEY?"":n}function me(t){var a;var r=n.getTemplatePrivateModel();var i=e.getOwnerComponent();var o,s,l,g,u,f=[],p=[],d,m,y,b,h,C,P;var S,D;o=i.getAppComponent();s=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");l=r.getProperty("/generic/supportedIntents/");if(c.isSmartChart(t)){a=t.getToolbar()}else if(c.isSmartTable(t)){a=t.getCustomToolbar()}g=a.getContent();u=g.length;for(d=0;d<u;d++){m=N(g[d]);if(m.hasOwnProperty("SemanticObject")&&m.hasOwnProperty("Action")){y=m.SemanticObject;b=m.Action;h={semanticObject:y,action:b,ui5Component:o};f.push([h]);C=v({},h);C.bLinkIsSupported=false;p.push(C)}}if(f.length>0&&s){P=s.getLinks(f);P.done(function(e){l=r.getProperty("/generic/supportedIntents/");S=e.length;for(d=0;d<S;d++){if(e[d][0].length>0){p[d].bLinkIsSupported=true}y=p[d].semanticObject;b=p[d].action;D=r.getProperty("/generic/supportedIntents/"+y);if(!D){l[y]={};l[y][b]={visible:p[d].bLinkIsSupported}}else if(!D[b]){D[b]={visible:p[d].bLinkIsSupported}}else{D[b]["visible"]=p[d].bLinkIsSupported}}r.updateBindings()})}}function ye(a,n){var r=n&&e.byId(n);var i=n&&!r?Promise.reject():new Promise(function(e,n){t.oApplication.performAfterSideEffectExecution(function(){var i=t.oApplication.getBusyHelper();if(i.isBusy()){n();return}if(r&&(!r.getVisible()||r.getEnabled&&!r.getEnabled())){n();return}var o=r?a(r):a();if(o instanceof Promise){o.then(e,n);i.setBusy(o)}else{e(o)}})});i.catch(Function.prototype);return i}function be(e,a,r,i,o){var s,l={};if(!a){s=[]}else if(Array.isArray(a)){s=a}else{s=[a]}if(r){l.urlParameters=r}if(i&&i.bInvocationGroupingChangeSet){l.operationGrouping="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"}l.triggerChanges=n.isDraftEnabled();n.executeBeforeInvokeActionFromExtensionAPI(o);var c=t.oApplicationController.invokeActions(e,s,l);if(i&&i.bSetBusy){n.getBusyHelper().setBusy(c)}c.then(n.executeAfterInvokeActionFromExtensionAPI.bind(null,o));return c}function he(e){var a=t.oApplication.getChevronNavigationRefreshBehaviour(e);if(a!==Object.create(null)){t.oViewDependencyHelper.setRefreshBehaviour(a)}}function Ce(e){var a=t.oApplication.getComponentRefreshBehaviour(e);t.oViewDependencyHelper.setRefreshBehaviour(a)}function Pe(e,t){var a=t.getModel();var n=t.getPath().split("/")[1];var r=a.oData[n];if(e){var i=r&&r[e]&&r[e].__ref;var o=a.oData[i];return o}else{return r}}function Se(t,a){if(t&&t.__metadata){var r=t.__metadata.edit_media;var i=t.__metadata.content_type;var o=r&&new URL(r);var s=o&&o.pathname;var l=C.getIconForMimeType(i);var c={url:s,fileType:i,icon:l};var g=n.getTemplatePrivateModel();var u=e.getOwnerComponent().getEntitySet();if(!g.getProperty("/generic/controlProperties/fileUploader")){g.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(a){g.setProperty("/generic/controlProperties/"+"fileUploader/"+a,c)}else{g.setProperty("/generic/controlProperties/"+"fileUploader/"+u,c)}}}function De(e){return e.filter(function(e){return!e||!e.isTransient()})}function Ae(t,a,n,r){var i=e.getOwnerComponent().getModel().getMetaModel();var o=g.getNavigationPropertyRelationship(i,t,a);var s=g.getNavigationPropertyRelationship(i,n,r);return o.relationship===s.relationship&&o.fromRole===s.toRole&&o.toRole===s.fromRole}function Ee(t){var a=t.getSource();return c.isButton(a)?a.data():sap.ui.getCore().byId(e.createId(N(a)["ActionId"])).data()}var G=u.testable(G,"fillEnabledMapForBreakoutActions");var q=u.testable(q,"getOwnerControl");var A=u.testable(A,"fnGetToolbarCustomData");var ne=u.testable(ne,"removePropertiesFromNavigationContext");return{getPositionableControlId:I,getMetaModelEntityType:E,getText:B,getSpecializedText:w,getContextText:R,getNavigationKeyProperties:ee,mergeNavigationKeyPropertiesWithValues:te,executeGlobalSideEffect:function(){if(n.isDraftEnabled()){var a=e.getView();var r=e.getOwnerComponent();var i=r.getAppComponent();var o=i.getForceGlobalRefresh();var s=r.getModel("ui");a.attachBrowserEvent("keydown",function(e){var r=e.target.type==="search";var i=e.target.type==="textarea";var l=e.target.id.indexOf("rowAction")>-1;var g=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&s.getProperty("/editable")&&!r&&!i&&!l&&!g){t.oApplication.addSideEffectPromise(new Promise(function(r,i){var s,l,g,u=false,f={draftRootContext:n.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true};l=c.getControlWithFocus();while(l){if(c.isSmartField(l)){g=l.getBindingContext&&l.getBindingContext();if(g.isTransient&&g.isTransient()){return r()}}else if(c.isOverflowToolbar(l)||c.isButton(l)||c.isLink(l)||c.isMultiInputField(l)&&(l._sTypedInValue&&l._sTypedInValue.length>0)){u=true}else if(c.isSmartForm(l)){s=l;break}else if(c.isSmartTable(l)){break}l=l.getParent()}if(u){f={}}g=g||l&&l.getBindingContext&&l.getBindingContext()||a.getBindingContext();var p=s?s.check():Promise.resolve();p.then(function(){setTimeout(function(){var a=t.oApplicationController.executeSideEffects(g,null,null,o,f);a.then(function(){r();setTimeout(function(){var t=document.getElementById(e.target.id);if(t){t.focus()}})},i)})})}))}})}},setEnabledToolbarButtons:k,setEnabledFooterButtons:L,fillEnabledMapForBreakoutActions:G,getBreakoutActions:J,getSelectionPoints:F,getDeleteRestrictions:K,getSmartTableDefaultVariant:ve,getSmartChartDefaultVariant:de,setPrivateModelControlProperty:j,removePropertiesFromNavigationContext:ne,navigateFromListItem:X,navigateExternal:$,semanticObjectLinkNavigation:ae,getCustomData:function(e){var t=e.getSource().getCustomData();var a={};for(var n=0;n<t.length;n++){a[t[n].getKey()]=t[n].getValue()}return a},getCustomDataText:function(e){return new Promise(function(t,a){e.getCustomData().forEach(function(e){var a=e.getKey();if(a==="text"){var n=e.getBinding("value");var r=!n&&e.getBindingInfo("value");if(!n&&!r){t(e.getValue());return}var i=function(e){var a=e.getSource();a.detachChange(i);t(a.getExternalValue());return};if(n){if(!n.isInitial()){t(n.getExternalValue());return}n.attachChange(i)}else{r.events={change:i};for(var o=0;o<r.parts.length;o++){r.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:le,formatDraftLockText:ce,showDraftPopover:function(e,t){ge().then(function(a){var n=a.getModel("admin");n.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));n.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));a.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(a.getBindingContext()){a.openBy(t)}else{a.getObjectBinding().attachDataReceived(function(){a.openBy(t)})}})},getContentDensityClass:function(){return t.oApplication.getContentDensityClass()},attachControlToView:O,getDialogFragment:T,getDialogFragmentAsync:x,fnProcessDataLossOrDraftDiscardConfirmation:fe,processDataLossTechnicalErrorConfirmation:ue,securedExecution:pe,getOwnerControl:q,getOwnerPresentationControl:z,refreshModel:Y,getElementCustomData:N,triggerAction:function(a,n,r,i){t.oDataLossHandler.performIfNoDataLoss(function(){t.oCRUDManager.callAction({functionImportPath:r.Action,contexts:a,sourceControlHandler:i,label:r.Label,operationGrouping:""}).then(function(a){if(a&&a.length>0){var r=a[0];if(r.response&&r.response.context&&(!r.actionContext||r.actionContext&&r.response.context.getPath()!==r.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),n))}else if(r.context&&(!r.actionContext||r.actionContext&&r.context.getPath()!==r.actionContext.getPath())){t.oApplication.getBusyHelper().getUnbusy().then(t.oViewDependencyHelper.setMeToDirty.bind(null,e.getOwnerComponent(),n))}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:me,executeIfControlReady:ye,invokeActionsForExtensionAPI:be,isContextEditable:_,setExternalChevronRefreshBehaviour:he,setComponentRefreshBehaviour:Ce,getStreamData:Pe,setStreamData:Se,getControlStateWrapper:s.getControlStateWrapper,filterActiveContexts:De,checkInverseNavigation:Ae,getCustomDataFromEvent:Ee,getControlStateWrapperById:s.getControlStateWrapperById}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,a){v(this,A(e,t,a))}})});
//# sourceMappingURL=CommonUtils.js.map
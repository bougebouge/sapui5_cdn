/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Core","sap/base/security/URLListValidator","./CollaborationHelper","sap/suite/ui/commons/collaboration/BaseHelperService","sap/ui/core/Element","sap/ui/Device"],function(e,a,t,r,s,i,n){"use strict";var o=s.extend("sap.suite.ui.commons.collaboration.TeamsHelperService");var l="db5b69c6-0430-4ae1-8d6e-a65c2220b50c";var p=e.getLogger("sap.suite.ui.commons.collaboration.TeamsHelperService");var u=a.getLibraryResourceBundle("sap.suite.ui.commons");o.prototype.getOptions=function(e){var a={isShareAsLinkEnabled:true,isShareAsTabEnabled:true};var t=e||a;var r=[];var s=[];if(n.system.desktop){if(t.isShareAsLinkEnabled){if(this._providerConfig.isShareAsLinkEnabled){r.push({text:u.getText("COLLABORATION_MSTEAMS_CHAT"),key:"COLLABORATION_MSTEAMS_CHAT",icon:"sap-icon://post",fesrStepName:"MST:ShareAsLink"})}else{p.info("Share as Chat option is not enabled in the tenant")}}else{p.info("Consumer disable Share as Chat option")}}else{p.info("Share as Chat option is not supported in Phone and Tablet")}if(t.isShareAsTabEnabled){if(this._isShareAsTabEnabled()){r.push({text:u.getText("COLLABORATION_MSTEAMS_TAB"),key:"COLLABORATION_MSTEAMS_TAB",icon:"sap-icon://image-viewer",fesrStepName:"MST:ShareAsTab"})}else{p.info("Share as Tab option is not enabled in the tenant")}}else{p.info("Consumer disable Share as Tab option")}if(r.length===1){s=r;if(s[0].key==="COLLABORATION_MSTEAMS_CHAT"){s[0].text=u.getText("COLLABORATION_MSTEAMS_CHAT_SINGLE")}else if(s[0].key==="COLLABORATION_MSTEAMS_TAB"){s[0].text=u.getText("COLLABORATION_MSTEAMS_TAB_SINGLE")}return s}if(r.length>1){s.push({type:"microsoft",text:u.getText("COLLABORATION_MSTEAMS_SHARE"),icon:"sap-icon://collaborate",subOptions:r})}return s};o.prototype.share=function(e,a){if(!a.url){p.error("url is not supplied in object so terminating Click");return}if(!t.validate(a.url)){p.error("Invalid URL supplied");return}if(e.key==="COLLABORATION_MSTEAMS_CHAT"){this._shareAsChat(a);return}if(e.key==="COLLABORATION_MSTEAMS_TAB"){this._shareAsTab(a);return}};o.prototype._shareAsChat=function(e){var a=window.open("","_blank","width=700,height=600");var t=e.appTitle;if(e.subTitle.length>0){t+=": "+e.subTitle}a.opener=null;if(e.minifyUrlForChat){r.compactHash(e.url,[]).then(function(r){var s=this._modifyUrlForNavigationContext(e,r.url);a.location="https://teams.microsoft.com/share?msgText="+encodeURIComponent(t)+"&href="+encodeURIComponent(s)}.bind(this))}else{a.location="https://teams.microsoft.com/share?msgText="+encodeURIComponent(t)+"&href="+encodeURIComponent(e.url)}};o.prototype._shareAsTab=function(e){var a=sap.ushell&&sap.ushell.Container;var t=a&&a.getService("URLParsing");var r=e.url;var s=r.indexOf("#");if(s!==-1){var i=r.substring(0,s);var n=i.indexOf("?",0);var o="appState=lean&sap-collaboration-teams=true";if(n!==-1){i=i.substring(0,n+1)+o+"&"+i.substring(n+1)}else{i+="?"+o}r=i+r.substring(s);s=r.indexOf("#");var l=t.parseShellHash(r.substring(s));l.params["sap-ushell-navmode"]="explace";l.params["sap-ushell-next-navmode"]="explace";var p=t.constructShellHash(l);r=r.substring(0,s)+"#"+p}var u={subEntityId:{url:r,appTitle:e.appTitle,subTitle:e.subTitle,mode:"tab"}};this._getApplicationID().then(function(e){var a="https://teams.microsoft.com/l/entity/"+e+"/home?&context="+encodeURIComponent(JSON.stringify(u));sap.m.URLHelper.redirect(a,true)})};o.prototype._modifyUrlForNavigationContext=function(e,a){var t=sap.ushell&&sap.ushell.Container;var r=t&&t.getService("URLParsing");var s=e.url;var i=s.indexOf("#");var n=r.parseShellHash(s.substring(i));var o=Object.keys(n.params).length;var l=new URL(a);if(o>0){if(!l.searchParams.has("sap-collaboration-teams")){l.searchParams.set("sap-collaboration-teams","true")}else{l.searchParams.delete("sap-collaboration-teams")}}return l.toString()};o.prototype._getApplicationID=function(){var e=sap.ushell&&sap.ushell.Container;var a=e&&e.getService("URLParsing");return r._getCurrentUrl().then(function(e){var t=e.split("#")[0];if(t.indexOf("?")!==-1){var r=a&&a.parseParameters(t.substring(t.indexOf("?")));if(r&&r["sap-collaboration-xx-TeamsAppId"]&&r["sap-collaboration-xx-TeamsAppId"][0]&&r["sap-collaboration-xx-TeamsAppId"][0].length>0){return Promise.resolve(r["sap-collaboration-xx-TeamsAppId"][0])}return Promise.resolve(l)}else{return Promise.resolve(l)}})};o.prototype._isShareAsTabEnabled=function(){if(window["sap-ushell-config"]&&window["sap-ushell-config"].renderers&&window["sap-ushell-config"].renderers.fiori2&&window["sap-ushell-config"].renderers.fiori2.componentData&&window["sap-ushell-config"].renderers.fiori2.componentData.config&&window["sap-ushell-config"].renderers.fiori2.componentData.config.sapHorizonEnabled){return true}return false};return o});
//# sourceMappingURL=TeamsHelperService.js.map
/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Component","sap/base/Log","./utils/Constants","./config/StartupConfig","./utils/InitDetection","./utils/Utils","./controller/PluginController","sap/base/util/ObjectPath"],function(t,e,n,i,r,o,a,s){"use strict";return t.extend("sap.feedback.ui.flpplugin.Component",{metadata:{manifest:"json",properties:{url:{name:"url",type:"string"},tenantId:{name:"tenantId",type:"string"},tenantRole:{name:"tenantRole",type:"string"},isPushEnabled:{name:"isPushEnabled",type:"boolean"},pushChannelPath:{name:"pushChannelPath",type:"string"},productName:{name:"productName",type:"string"},platformType:{name:"platformType",type:"string"},scopeSet:{name:"scopeSet",type:"string"}}},_oPluginController:null,_oStartupConfig:null,_bIsLoaded:false,init:function(){if(!this._isManuallyConfigured()){return this._prepareAndRun()}},load:function(){return new Promise(function(t,i){if(this._bIsLoaded===false){this._prepareAndRun().then(function(){t()},function(){i()})}else{e.error("Plug-in already loaded with an existing configuration.",null,n.S_PLUGIN_COMPONENT_NAME);i()}}.bind(this))},_prepareAndRun:function(){return new Promise(function(t,i){var r=this._loadStartupConfigData();if(r){this._oStartupConfig=this._createStartupConfigObject(r);this._run().then(function(){this._bIsLoaded=true;t()}.bind(this),function(){i()})}else{e.error("Config data could not be loaded correctly.",null,n.S_PLUGIN_COMPONENT_NAME);i()}}.bind(this))},_loadStartupConfigData:function(){if(this.getProperty("url")&&this.getProperty("tenantId")){var t={};t.qualtricsInternalUri=this.getProperty("url");t.tenantId=this.getProperty("tenantId");if(this.getProperty("tenantRole")){t.tenantRole=this.getProperty("tenantRole")}if(this.getProperty("isPushEnabled")){t.isPushEnabled=this.getProperty("isPushEnabled")}if(this.getProperty("pushChannelPath")){t.pushChannelPath=this.getProperty("pushChannelPath")}if(this.getProperty("productName")){t.productName=this.getProperty("productName")}if(this.getProperty("platformType")){t.platformType=this.getProperty("platformType")}if(this.getProperty("scopeSet")){t.scopeSet=this.getProperty("scopeSet")}return t}else if(this.getComponentData()&&this.getComponentData().config){var i=this.getComponentData().config;if(i&&this._isMandatoryStartupConfigValid(i)===true){return i}else{e.error("Feedback config could not be read.",null,n.S_PLUGIN_COMPONENT_NAME)}}return null},_isManuallyConfigured:function(){if(this.getProperty("url")&&this.getProperty("tenantId")){return true}return false},_createStartupConfigObject:function(t){var e=new i(t.qualtricsInternalUri,t.tenantId,n.E_DATA_FORMAT.version1);e.setTenantRole(t.tenantRole);if(t.isPushEnabled){e.setDataFormat(n.E_DATA_FORMAT.version2);e.setIsPushEnabled(t.isPushEnabled)}if(t.productName){e.setProductName(t.productName)}if(t.platformType){e.setPlatformType(t.platformType)}if(t.scopeSet){e.setScopeSet(t.scopeSet)}return e},_isMandatoryStartupConfigValid:function(t){var i=t.qualtricsInternalUri;if(o.isString(i)&&!o.stringIsEmpty(i)){var r=t.tenantId;if(o.isString(r)&&!o.stringIsEmpty(r)){return true}else{e.error("Feedback config insufficient - tenant id missing.",t,n.S_PLUGIN_COMPONENT_NAME)}}else{e.error("Feedback config insufficient - url missing.",t,n.S_PLUGIN_COMPONENT_NAME)}return false},_run:function(){return new Promise(function(t){this._validateIfInitializable(this._oStartupConfig.getQualtricsUri()).then(function(i){if(i){this._oStartupConfig.setIsLibraryLoadable(i);this._startPluginController(this._oStartupConfig).then(function(){t()},function(){e.error("Plugin Controller could not be initialized.",this._oStartupConfig,n.S_PLUGIN_COMPONENT_NAME);t()}.bind(this))}}.bind(this),function(i){if(!i){this._oStartupConfig.setIsLibraryLoadable(i);e.error("Unable to request feedback library.",this._oStartupConfig,n.S_PLUGIN_COMPONENT_NAME)}t()}.bind(this))}.bind(this))},_validateIfInitializable:function(t){var e=new r(t);return e.isUrlLoadable()},_startPluginController:function(t){return new Promise(function(i,r){if(this._isDeviceFormatSupported()){var o=this.getModel("i18n").getResourceBundle();this._oPluginController=new a(t,this._getRenderer(),o);this._oPluginController.init().then(function(){i()},function(t){e.error("Feedback plugin startup failed.",t.message,n.S_PLUGIN_COMPONENT_NAME);r()})}else{e.error("Device not supported.",this._oStartupConfig,n.S_PLUGIN_COMPONENT_NAME);r()}}.bind(this))},_isDeviceFormatSupported:function(){if(sap.ui.Device.system.phone){return false}return true},_getRenderer:function(){return new Promise(function(t,e){this._oShellContainer=s.get("sap.ushell.Container");if(!this._oShellContainer){e("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.")}else{var n=this._oShellContainer.getRenderer();if(n){t(n)}else{this._onRendererCreated=function(i){n=i.getParameter("renderer");if(n){t(n)}else{e("Illegal state: shell renderer not available after receiving 'rendererLoaded' event.")}};this._oShellContainer.attachRendererCreatedEvent(this._onRendererCreated)}}}.bind(this))}})});
//# sourceMappingURL=Component.js.map
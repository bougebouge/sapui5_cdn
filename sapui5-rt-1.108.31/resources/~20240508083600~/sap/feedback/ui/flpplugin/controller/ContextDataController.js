/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","../utils/Utils","../utils/Constants","../data/AppContextData"],function(t,e,s,n,i){"use strict";return t.extend("sap.feedback.ui.flpplugin.controller.ContextDataController",{_oStartupConfig:{},_oAppContextData:null,_oSessionData:null,_sClientAction:null,_sLastTheme:null,_iFollowUpCount:null,constructor:function(t){if(!t){throw Error("oStartupConfig is not provided!")}this._oStartupConfig=t},init:function(){this._oAppContextData=new i;this._collectSessionContextData(this._oStartupConfig.getTenantId(),this._oStartupConfig.getTenantRole(),this._oStartupConfig.getProductName(),this._oStartupConfig.getPlatformType())},updateContextData:function(t,e,s){this._resetContextData();this.setDeviceInfos();this.setClientAction(t);var n=this._oStartupConfig.getDataFormat();this._setSessionContextData(n);if(s){this._setTelemetryData(s)}else{this._clearTelemetryData()}return this._collectAppContextData(n).then(function(){this._collectPushContextData(e)}.bind(this))},setClientAction:function(t){this._sClientAction=t;this._updateClientAction()},setLastTheme:function(t){this._sLastTheme=t;this._updateLastTheme()},setFollowUpCount:function(t){this._iFollowUpCount=t;this._updateFollowUpCount()},setDeviceInfos:function(){this._updateDeviceData()},_collectPushContextData:function(t){if(s.isClientActionPushEvent(this._sClientAction)&&t){this._setPushContextData(t)}},_setPushContextData:function(t){if(!sap.qtx){sap.qtx={}}sap.qtx.push={};sap.qtx.push.type=t.getType();sap.qtx.push.areaId=t.getAreaId();sap.qtx.push.triggerName=t.getTriggerName();sap.qtx.push.shortText=t.getShortText();sap.qtx.push.payload=t.getPayloadDataString()},_collectSessionContextData:function(t,e,s,n){this._oSessionData={tenantId:t,tenantRole:e,productName:s,platformType:n}},_setSessionContextData:function(t){if(t===n.E_DATA_FORMAT.version1){if(!sap.qtxAppContext){sap.qtxAppContext={}}sap.qtxAppContext=e(sap.qtxAppContext,this._oSessionData)}else if(t===n.E_DATA_FORMAT.version2){if(!sap.qtx){sap.qtx={}}sap.qtx.session=this._oSessionData}},_setTelemetryData:function(t){this._ensureExistenceOfMetricsOnGlobalQtx();if(t){sap.qtx.metrics.push.triggered=t.getPushEventTriggeredCount();sap.qtx.metrics.push.executed=t.getPushEventExecutedCount();sap.qtx.metrics.push.snoozed=t.getPushEventSnoozedCount();sap.qtx.metrics.push.timeSinceLastPush=t.getTimeSinceLastPushEvent()}},_clearTelemetryData:function(){if(sap.qtx&&sap.qtx.metrics){sap.qtx.metrics={}}},_resetContextData:function(){sap.qtxAppContext={};if(!sap.qtx){sap.qtx={}}sap.qtx.appcontext={};sap.qtx.push={};sap.qtx.metrics={}},_collectAppContextData:function(t){return this._oAppContextData.getData(t).then(function(e){this._setAppContextData(e,t)}.bind(this))},_setAppContextData:function(t,s){if(s===n.E_DATA_FORMAT.version1){sap.qtxAppContext=e(sap.qtxAppContext,t)}else if(s===n.E_DATA_FORMAT.version2){sap.qtx.appcontext=t;this._updateClientAction()}},_ensureExistenceOfAppContextOnGlobalQtx:function(){if(!sap.qtx){sap.qtx={}}if(!sap.qtx.appcontext){sap.qtx.appcontext={}}},_ensureExistenceOfDeviceOnGlobalQtx:function(){if(!sap.qtx){sap.qtx={}}if(!sap.qtx.device){sap.qtx.device={}}},_ensureExistenceOfMetricsOnGlobalQtx:function(){if(!sap.qtx){sap.qtx={}}if(!sap.qtx.metrics){sap.qtx.metrics={}}if(!sap.qtx.metrics.push){sap.qtx.metrics.push={}}},_updateClientAction:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.clientAction=this._sClientAction},_updateLastTheme:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.previousTheme=this._sLastTheme},_updateFollowUpCount:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.followUpCount=this._iFollowUpCount},_updateDeviceData:function(){this._ensureExistenceOfDeviceOnGlobalQtx();sap.qtx.device={};sap.qtx.device.type=this._getDeviceType();sap.qtx.device.orientation=this._getScreenOrientation();sap.qtx.device.osName=sap.ui.Device.os.name;sap.qtx.device.browserName=sap.ui.Device.browser.name},_getDeviceType:function(){if(sap.ui.Device.system.tablet&&!sap.ui.Device.system.desktop){return"tablet"}else if(!sap.ui.Device.system.tablet&&sap.ui.Device.system.desktop){return"desktop"}else if(sap.ui.Device.system.combi){return"combi"}else if(sap.ui.Device.system.phone){return"phone"}else{return n.S_DEFAULT_VALUE}},_getScreenOrientation:function(){if(sap.ui.Device.orientation.landscape){return"landscape"}else if(sap.ui.Device.orientation.portrait){return"portrait"}else{return n.S_DEFAULT_VALUE}}})});
//# sourceMappingURL=ContextDataController.js.map
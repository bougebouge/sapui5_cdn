/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","../data/UserState","./Utils","./Constants"],function(e,t,a,r,i){"use strict";return e.extend("sap.feedback.ui.flpplugin.utils.Storage",{_oLocalStorage:null,init:function(){this._oLocalStorage=r.getLocalStorage();var e=this._getValueForKey(i.S_STOR_PUSH_STATE);if(this._oLocalStorage&&!e){this._upgradeAndInitNew()}},_initNew:function(){var e=new a;this.saveUserState(e);return e},_upgradeAndInitNew:function(){var e=this._initNew();this._migrateThemeData(e);this.saveUserState(e)},readUserState:function(){var e=this._getValueForKey(i.S_STOR_PUSH_STATE);if(!e){return this._initNew()}try{var r=JSON.parse(e);if(r){var s=new a;s.initFromJSON(r);return s}}catch(e){t.error("Reading user state failed.",e.message,i.S_PLUGIN_STORAGE_NAME)}return null},saveUserState:function(e){if(e){try{var a=JSON.stringify(e);this.updateValue(i.S_STOR_PUSH_STATE,a)}catch(e){t.error("Saving user state failed.",e.message,i.S_PLUGIN_STORAGE_NAME)}}},_migrateThemeData:function(e){var t=this._getValueForKey(i.S_STOR_LAST_THEME);if(t){e.setLastTheme(t);this.deleteKey(i.S_STOR_LAST_THEME)}var a=this._getValueForKey(i.S_STOR_THEME_START);if(a){var s=a;if(r.isStringValidNumber(a)){s=parseInt(a)}e.setThemeToggleStart(s);this.deleteKey(i.S_STOR_THEME_START)}if(this._getValueForKey(i.S_STOR_THEME_FOLLOWUP_OPTIN)){this.deleteKey(i.S_STOR_THEME_FOLLOWUP_OPTIN)}if(this._getValueForKey(i.S_STOR_THEME_FOLLOWUP_OPTOUT)){this.deleteKey(i.S_STOR_THEME_FOLLOWUP_OPTOUT)}},updateLastTheme:function(e){var t=this.readUserState();if(t&&t.setLastTheme){t.setLastTheme(e);this.saveUserState(t)}},getLastTheme:function(){var e=this.readUserState();return e.getLastTheme()},updateCurrentTheme:function(e){var t=this.readUserState();if(t&&t.setCurrentTheme){t.setCurrentTheme(e);this.saveUserState(t)}},setThemeToggleStart:function(e){var t=this.readUserState();if(t){t.setThemeToggleStart(e);this.saveUserState(t)}},deleteThemeToggleStart:function(){var e=this.readUserState();if(e){e.clearThemeToggleStart();this.saveUserState(e)}},deleteKey:function(e){if(this._oLocalStorage&&e){this._oLocalStorage.removeItem(e)}},updateValue:function(e,t){if(this._oLocalStorage&&e&&t){this._oLocalStorage.setItem(e,t)}},_getValueForKey:function(e){if(this._oLocalStorage&&e){return this._oLocalStorage.getItem(e)}return null},getStringForKey:function(e){return this._getValueForKey(e)},getNumberForKey:function(e){var t=this._getValueForKey(e);if(t&&r.isStringValidNumber(t)){return parseInt(t)}return null}})});
//# sourceMappingURL=Storage.js.map
/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","./SurveyFactory","./RequestHandler","../utils/Constants","./DateCalculator","../utils/Utils","../utils/ScopeCheck","../push/config/trigger/TriggerType"],function(i,t,e,r,n,a,s,o,u){"use strict";return i.extend("sap.feedback.ui.flpplugin.survey.RequestDispatcher",{_oStartupConfig:null,_oCentralConfig:null,_oContextDataController:null,_oRequestHandler:null,_oResourceBundle:null,_bInitializationErrorOccured:false,_oPresentationController:null,init:function(i,e,a,s,o){if(!i){t.error("oStartupConfig is missing during initialization!",null,n.S_PLUGIN_SURVEY_REQ_DISPATCHER);this._bInitializationErrorOccured=true}if(!e){t.error("oCentralConfig is missing during initialization!",null,n.S_PLUGIN_SURVEY_REQ_DISPATCHER);this._bInitializationErrorOccured=true}if(!a){t.error("oContextDataController is missing during initialization!",null,n.S_PLUGIN_SURVEY_REQ_DISPATCHER);this._bInitializationErrorOccured=true}if(!s){t.error("oResourceBundle is missing during initialization!",null,n.S_PLUGIN_SURVEY_REQ_DISPATCHER);this._bInitializationErrorOccured=true}if(!o){t.error("oUserStorage is missing during initialization!",null,n.S_PLUGIN_SURVEY_REQ_DISPATCHER);this._bInitializationErrorOccured=true}if(!this._bInitializationErrorOccured){this._oStartupConfig=i;this._oCentralConfig=e;this._oContextDataController=a;this._oResourceBundle=s;this._oUserStorage=o;this._oRequestHandler=new r;this._setupInitialPushDates();this._oRequestHandler.init(this._onRequestReceivedCallback.bind(this))}},handleDynamicPush:function(){if(this._canUserDigestSurvey(n.E_PUSH_SRC_TYPE.dynamic)){var i={areaId:n.S_GENERIC_TRIGGER_AREAID,triggerName:u.E_TRIGGER_TYPE.dynamic,type:n.E_PUSH_SRC_TYPE.dynamic};this._triggerPushSurvey(i,null)}},_onRequestReceivedCallback:function(i){var t=e.createValidationHandler();t.init(this._oUserStorage,this._oCentralConfig);var r=t.validate(i);if(r){var n=this._isForcePush(r.oConfig);if(this._canUserDigestSurvey(i.type)||n){this._triggerPushSurvey(i,r)}}},_canUserDigestSurvey:function(i){if(!s.isQualtricsSurveyPopupOpen()){var t=e.createBalancer();t.init(this._oUserStorage);return t.balance(i)}return false},_triggerPushSurvey:function(i,t){if(!this._PresentationController){this._PresentationController=e.createPresentationController();this._PresentationController.init(this._oContextDataController,this._oResourceBundle,this._oUserStorage,this._oCentralConfig)}this._PresentationController.surveyUser(i,t)},_isForcePush:function(i){return i.getTriggerConfig().canForcePush()&&!s.isQualtricsSurveyPopupOpen()},_setupInitialPushDates:function(){var i=this._oUserStorage.readUserState();if(i){var t=i.getDynamicPushDate();var e=i.getInAppPushDate();var r=false;if(!t&&o.isDynamicPushAvailable(this._oStartupConfig)){var n=a.calculateInitialDynamicPushDate(this._getPushConfig());i.setDynamicPushDate(n);r=true}if(!e&&o.isFeaturePushAvailable(this._oStartupConfig)){var s=a.calculateInitialInAppPushDate(this._getPushConfig());i.setInAppPushDate(s);r=true}if(r){this._oUserStorage.saveUserState(i)}}},_getPushConfig:function(){return this._oCentralConfig.getPushConfig()}})});
//# sourceMappingURL=RequestDispatcher.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/UriParameters","sap/fe/common/MessagePopover","sap/fe/core/CommonUtils","sap/fe/core/helpers/ClassSupport","sap/m/Button","sap/m/ColumnListItem","sap/m/Dialog","sap/m/FormattedText","sap/m/library","sap/ui/core/Core","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter"],function(e,t,n,r,o,i,a,s,l,g,u,c,f,d,T,v){"use strict";var p,b,h,m,_,C,I;var P=c.MessageType;var E=g.ButtonType;var y=o.event;var S=o.defineUI5Class;var x=o.aggregation;function M(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}function O(e,t,n,r){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function A(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function R(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;w(e,t)}function w(e,t){w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return w(e,t)}function B(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]});i.enumerable=!!i.enumerable;i.configurable=!!i.configurable;if("value"in i||i.initializer){i.writable=true}i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i);if(o&&i.initializer!==void 0){i.value=i.initializer?i.initializer.call(o):void 0;i.initializer=undefined}if(i.initializer===void 0){Object.defineProperty(e,t,i);i=null}return i}function L(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var G=(p=S("sap.fe.common.MessageButton"),b=x({type:"sap.fe.common.MessageFilter",multiple:true,singularName:"customFilter"}),h=y(),p(m=(_=function(o){R(g,o);function g(){var e;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}e=o.call.apply(o,[this].concat(n))||this;O(e,"customFilters",C,A(e));O(e,"messageChange",I,A(e));e.sLastActionText="";e.sGeneralGroupText="";e.sViewId="";return e}var c=g.prototype;c.init=function e(){i.prototype.init.apply(this);this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new n;this.oItemBinding=this.oMessagePopover.getBinding("items");this.oItemBinding.attachChange(this._setMessageData,this);var t=this.getId();if(t){this.oMessagePopover.addCustomData(new sap.ui.core.CustomData({key:"messageButtonId",value:t}))}this.attachModelContextChange(this._applyFiltersAndSort.bind(this));this.oMessagePopover.attachActiveTitlePress(this._activeTitlePress.bind(this))};c.handleMessagePopoverPress=function e(t){this.oMessagePopover.toggle(t.getSource())};c._applyGroupingAsync=function t(n){try{var r=this;var o=[];var i=n.getBindingContext();var a=function(e){var t=[];var n=r.oItemBinding.getContexts().map(function(e){return e.getObject()});var o=e.getBindingContext();if(o){var i=e.getContent()[0];r.getVisibleSectionsFromObjectPageLayout(i).forEach(function(e){e.getSubSections().forEach(function(e){e.findElements(true).forEach(function(r){if(r.isA("sap.ui.mdc.Table")){for(var i=0;i<n.length;i++){var a=r.getRowBinding();if(a){var s="".concat(o.getPath(),"/").concat(r.getRowBinding().getPath());if(n[i].target.indexOf(s)===0){t.push({table:r,subsection:e});break}}}}})})})}return t};var s=a.bind(r)(n);s.forEach(function(e){var t;var n=e.table,r=e.subsection;if(!n.getBindingContext()||((t=n.getBindingContext())===null||t===void 0?void 0:t.getPath())!==(i===null||i===void 0?void 0:i.getPath())){r.setBindingContext(i);if(!n.getRowBinding().isLengthFinal()){o.push(new Promise(function(e){n.getRowBinding().attachEventOnce("dataReceived",function(){e()})}))}}});var l=new Promise(function(e){setTimeout(function(){try{r._applyGrouping();e();return Promise.resolve()}catch(e){return Promise.reject(e)}},0)});var g=M(function(){return Promise.resolve(Promise.all(o)).then(function(){n.getModel().checkMessages();return Promise.resolve(l).then(function(){})})},function(){e.error("Error while grouping the messages in the messagePopOver")});return Promise.resolve(g&&g.then?g.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};c.getVisibleSectionsFromObjectPageLayout=function e(t){return t.getSections().filter(function(e){return e.getVisible()})};c._applyGrouping=function e(){this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(!this.oObjectPageLayout){return}var t=this.oMessagePopover.getItems();var n=this.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);var r=this._checkControlIdInSections(t,false);if(r){this._fnEnableBindings(n)}};c._getTableRefErrorContext=function e(t){var n=t.getModel("internal");if(!t.getBindingContext("internal").getProperty("refError")){n.setProperty("refError",{},t.getBindingContext("internal"))}var r=t.getBindingContext("internal").getPath()+"/refError/"+t.getBindingContext().getPath().replace("/","$")+"$"+t.getRowBinding().getPath().replace("/","$");var o=n.getContext(r);if(!o.getProperty("")){n.setProperty("",{},o)}return o};c._updateInternalModel=function e(t,n,r,o,i,a){var s;if(a){s={rowIndex:"CreationRow",targetColProperty:r?r:""}}else{s={rowIndex:t?n:"",targetColProperty:r?r:""}}var l=o.getModel("internal"),g=this._getTableRefErrorContext(o);var u=sap.ui.getCore().getMessageManager().getMessageModel().getData().map(function(e){return e.id});var c;if(g.getProperty()){c=Object.keys(g.getProperty()).filter(function(e){return u.indexOf(e)===-1});c.forEach(function(e){delete g.getProperty()[e]})}l.setProperty(i.getId(),Object.assign({},g.getProperty(i.getId())?g.getProperty(i.getId()):{},s),g)};c._getControlFromMessageRelatingToSubSection=function e(t,n){var r=this;var o=n.getBindingContext("message").getObject();return t.findElements(true,function(e){return r._fnFilterUponIds(o.getControlIds(),e)}).sort(function(e,t){if(e.isA("sap.ui.mdc.Table")&&!t.isA("sap.ui.mdc.Table")){return-1}return 1})};c._setGroupLabelForTransientMsg=function e(t,n){this.sLastActionText=this.sLastActionText?this.sLastActionText:u.getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_LAST_ACTION");t.setGroupName("".concat(this.sLastActionText,": ").concat(n))};c._computeMessageGroupAndSubTitle=function e(t,n,r,o,i,a){var s;this.oItemBinding.detachChange(this._setMessageData,this);var l=(s=t.getBindingContext("message"))===null||s===void 0?void 0:s.getObject();var g,c,f,d,T,v,p,b="";var h=new RegExp("^/").test(l===null||l===void 0?void 0:l.getTargets()[0]),m=u.getLibraryResourceBundle("sap.fe.core");if(h){for(d=0;d<o.length;d++){g=o[d];v=g;if(g.isA("sap.m.Table")||g.isA("sap.ui.table.Table")){f={};c=g.getParent();f.tableHeader=c.getHeader();var _=c.getRowBinding();if(_&&_.isLengthFinal()&&c.getBindingContext()){f.sTableTargetColProperty=this._getTableColProperty(c,l);var C=this._getTableColInfo(c,f.sTableTargetColProperty);f.oTableRowBindingContexts=g.isA("sap.ui.table.Table")?_.getContexts():_.getCurrentContexts();f.sTableTargetColName=C.sTableTargetColName;f.sTableTargetProperty=f.sTableTargetColProperty;f.sTableTargetColProperty=C.sTableTargetColProperty;f.oTableRowContext=f.oTableRowBindingContexts.find(function(e,t){return t&&e.getTargets()[0].indexOf(t.getPath())===0}.bind(this,l));var I=void 0;if(!f.oTableRowContext){I=l.getControlIds().find(function(e,t){return this._IsControlInTable(e,t)}.bind(this,c))}if(I){var P=u.byId(I);p=this._IsControlPartOfCreationRow(P)}b=this._getMessageSubtitle(t,f.oTableRowBindingContexts,f.oTableRowContext,f.sTableTargetColName,m,c,p);t.setSubtitle(b);t.setActiveTitle(!!f.oTableRowContext);if(f.oTableRowContext){this._formatMessageDescription(t,f.oTableRowContext,f.sTableTargetColName,m,c)}T=f.oTableRowContext&&f.oTableRowContext.getIndex();this._updateInternalModel(f.oTableRowContext,T,f.sTableTargetColProperty,c,l)}}else{t.setActiveTitle(true);var E=this._bIsOrphanElement(v,o);if(E){t.setSubtitle(b);break}}}}else{v=o[0];c=this._getMdcTable(v);if(c){f={};f.tableHeader=c.getHeader();var y=this._getTableColumnIndex(v);f.sTableTargetColProperty=y>-1?c.getColumns()[y].getDataProperty():undefined;f.sTableTargetProperty=f.sTableTargetColProperty;f.sTableTargetColName=f.sTableTargetColProperty&&y>-1?c.getColumns()[y].getHeader():undefined;p=this._getTableRow(v).isA("sap.ui.table.CreationRow");if(!p){T=this._getTableRowIndex(v);f.oTableRowBindingContexts=c.getRowBinding().getCurrentContexts();f.oTableRowContext=f.oTableRowBindingContexts[T]}b=this._getMessageSubtitle(t,f.oTableRowBindingContexts,f.oTableRowContext,f.sTableTargetColName,m,c,p,y===0&&v.getValueState()==="Error"?v:undefined);t.setSubtitle(b);t.setActiveTitle(true);this._updateInternalModel(f.oTableRowContext,T,f.sTableTargetColProperty,c,l,p)}}if(l.getPersistent()&&a){this._setGroupLabelForTransientMsg(t,a)}else{t.setGroupName(n.getTitle()+(r.getTitle()&&i?", ".concat(r.getTitle()):"")+(f?", ".concat(m.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR"),": ").concat(f.tableHeader):""));var S=this._getViewId(this.getId());var x=u.byId(S);var M=l.getTargets()[0]&&l.getTargets()[0].split("/").pop();var O=x===null||x===void 0?void 0:x.getModel("internal");if(O&&O.getProperty("/messageTargetProperty")&&M&&M===O.getProperty("/messageTargetProperty")){this.oMessagePopover.fireActiveTitlePress({item:t});O.setProperty("/messageTargetProperty",false)}}this.oItemBinding.attachChange(this._setMessageData,this);return v};c._checkControlIdInSections=function e(t,n){var r,o,i,a,s,l;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:u.getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL");var g=this.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(g){var c;var f=this._getViewId(this.getId());var d=u.byId(f);var T=d===null||d===void 0?void 0:(c=d.getBindingContext("internal"))===null||c===void 0?void 0:c.getProperty("sActionName");if(T){(d===null||d===void 0?void 0:d.getBindingContext("internal")).setProperty("sActionName",null)}for(a=t.length-1;a>=0;--a){i=t[a];var v=true;for(s=g.length-1;s>=0;--s){r=g[s];o=r.getSubSections();for(l=o.length-1;l>=0;--l){var p=o[l];var b=this._getControlFromMessageRelatingToSubSection(p,i);if(b.length>0){var h=this._computeMessageGroupAndSubTitle(i,r,p,b,o.length>1,T);if(h&&!h.isA("sap.m.Table")&&!h.isA("sap.ui.table.Table")){s=l=-1}v=false}}}if(v){var m=i.getBindingContext("message").getObject();i.setActiveTitle(false);if(m.persistent&&T){this._setGroupLabelForTransientMsg(i,T)}else{i.setGroupName(this.sGeneralGroupText)}}if(!n&&i.getGroupName()===this.sGeneralGroupText&&this._findTargetForMessage(i)){return true}}}};c._findTargetForMessage=function e(t){var n=t.getBindingContext("message")&&t.getBindingContext("message").getObject();if(n&&n.target){var r=this.oObjectPageLayout&&this.oObjectPageLayout.getModel()&&this.oObjectPageLayout.getModel().getMetaModel(),o=r&&r.getMetaPath(n.target),i=r&&r.getObject(o);if(i&&i.$kind==="Property"){return true}}};c._fnEnableBindings=function e(n){if(t.fromQuery(window.location.search).get("sap-fe-xx-lazyloadingtest")){return}for(var r=0;r<n.length;r++){var o=n[r];var i=false;var a=o.getSubSections();for(var s=0;s<a.length;s++){var l=a[s];var g=l.getBlocks();if(g){for(var u=0;u<l.getBlocks().length;u++){if(g[u].getContent&&!g[u].getContent().isA("sap.fe.macros.table.TableAPI")){i=true;break}}if(i){l.setBindingContext(undefined)}}if(l.getBindingContext()){this._findMessageGroupAfterRebinding();l.getBindingContext().getBinding().attachDataReceived(this._findMessageGroupAfterRebinding)}}}};c._findMessageGroupAfterRebinding=function e(){var t=this.oMessagePopover.getItems();this._checkControlIdInSections(t,true)};c._getViewId=function e(t){var n,r=u.byId(t);while(r){if(r instanceof f){n=r.getId();break}r=r.getParent()}return n};c._setLongtextUrlDescription=function t(n,r){this.oMessagePopover.setAsyncDescriptionHandler(function(t){var o=n;var i=t.item.getLongtextUrl();if(i){jQuery.ajax({type:"GET",url:i,success:function(e){var n=r.getHtmlText()+e;t.item.setDescription("".concat(o).concat(n));t.promise.resolve()},error:function(){t.item.setDescription(n);var r="A request has failed for long text data. URL: ".concat(i);e.error(r);t.promise.reject(r)}})}})};c._formatMessageDescription=function e(t,n,r,o,i){var a=i.getParent().getIdentifierColumn();var s="";var g=this._fetchColumnInfo(t,i);if(r){s="".concat(o.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN"),": ").concat(r)}else if(g){if(g.availability==="Hidden"){if(t.getType()==="Error"){s=a?"".concat(o.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")," ").concat(n.getValue(a))+".":"".concat(o.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR"))+"."}else{s=a?"".concat(o.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")," ").concat(n.getValue(a))+".":"".concat(o.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC"))+"."}}else{if(!this._navigationConfigured(i)){t.setActiveTitle(false)}s="".concat(o.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN"),": ").concat(g.label," (").concat(o.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION"),")")}}var u=new l({htmlText:"<html><body><strong>".concat(o.getText("T_FIELDS_AFFECTED_TITLE"),"</strong></body></html><br>")});var c;if(a){c="".concat(u.getHtmlText(),"<br>").concat(o.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR"),": ").concat(i.getHeader(),"<br>").concat(o.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW"),": ").concat(n.getValue(a),"<br>").concat(s,"<br>")}else if(s==""||!s){c=""}else{c="".concat(u.getHtmlText(),"<br>").concat(o.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR"),": ").concat(i.getHeader(),"<br>").concat(s,"<br>")}var f=new l({htmlText:"<html><body><strong>".concat(o.getText("T_DIAGNOSIS_TITLE"),"</strong></body></html><br>")});var d=t.getBindingContext("message").getObject().description;t.setDescription(null);var T="";var v="";if(t.getLongtextUrl()){v="".concat(c,"<br>");this._setLongtextUrlDescription(v,f)}else if(d){T="".concat(f.getHtmlText(),"<br>").concat(d);v="".concat(c,"<br>").concat(T);t.setDescription(v)}else{t.setDescription(c)}};c._setMessageData=function t(){var n=this;clearTimeout(this._setMessageDataTimeout);this._setMessageDataTimeout=setTimeout(function(){try{var t="",r=n.oMessagePopover.getItems(),o={Error:0,Warning:0,Success:0,Information:0},i=u.getLibraryResourceBundle("sap.fe.core"),a=r.length;var s=E.Default,l="",g="",c="";var f=function(){if(a>0){function v(){if(a>1){n.oMessagePopover.navigateBack()}}for(var f=0;f<a;f++){if(!r[f].getType()||r[f].getType()===""){++o["Information"]}else{++o[r[f].getType()]}}if(o[P.Error]>0){s=E.Negative}else if(o[P.Warning]>0){s=E.Critical}else if(o[P.Success]>0){s=E.Success}else if(o[P.Information]>0){s=E.Neutral}if(o.Error>0){n.setText(o.Error)}else{n.setText("")}if(o.Error===1){l="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR"}else if(o.Error>1){l="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_ERROR_TOOLTIP"}else if(!o.Error&&o.Warning){l="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_WARNING_TOOLTIP"}else if(!o.Error&&!o.Warning&&o.Information){l="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO"}else if(!o.Error&&!o.Warning&&!o.Information&&o.Success){l="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS"}if(l){c=i.getText(l);g=o.Error?"".concat(o.Error," ").concat(c):c;n.setTooltip(g)}n.setIcon(t);n.setType(s);n.setVisible(true);var d=u.byId(n.sViewId);var T=function(){if(d){function o(){n.fireMessageChange({iMessageLength:a})}var t=d.getController().pageReady;var r=M(function(){return Promise.resolve(t.waitPageReady()).then(function(){return Promise.resolve(n._applyGroupingAsync(d)).then(function(){})})},function(){e.error("fail grouping messages")});return r&&r.then?r.then(o):o(r)}}();return T&&T.then?T.then(v):v(T)}else{n.setVisible(false);n.fireMessageChange({iMessageLength:a})}}();return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},100)};c._bIsOrphanElement=function e(t,n){return!n.some(function(e,t){var n=e.getParent();while(n&&n!==t){n=n.getParent()}return n?true:false}.bind(this,t))};c._activeTitlePress=function t(n){try{var r=this;var o=r.getBindingContext("pageInternal");o.setProperty("errorNavigationSectionFlag",true);var i=n.getParameter("item"),a=i.getBindingContext("message").getObject(),s=new RegExp("^/").test(a.getTarget()),l=u.byId(r.sViewId);var g,c;var f=function(e,t){var n={preventScroll:true,targetInfo:e};t.focus(n)};var d=function(){if(i.getGroupName().indexOf("Table:")!==-1){var t;var n=function(){if(s){t=a.controlIds.map(function(e){var t=u.byId(e);var n=t&&t.getParent();return n&&n.isA("sap.ui.mdc.Table")&&n.getHeader()===i.getGroupName().split(", Table: ")[1]?n:null}).reduce(function(e,t){return t?t:e});var n=function(){if(t){c=i.getGroupName().split(", ")[0];var n=M(function(){return Promise.resolve(r._navigateFromMessageToSectionTableInIconTabBarMode(t,r.oObjectPageLayout,c)).then(function(){var n=r._getTableRefErrorContext(t);var o=n.getProperty(i.getBindingContext("message").getObject().getId());var s=function(e,t){try{var n=r._getMdcTableRows(e),o=r._getGridTable(e).getFirstVisibleRow();if(n.length>0&&n[0]){var i=n[t-o],s=r.getTargetCell(i,a);if(s){r.setFocusToControl(s);return Promise.resolve(undefined)}else{var g=a.getTarget().split("/").pop();if(g){l.getModel("internal").setProperty("/messageTargetProperty",g)}if(r._navigationConfigured(e)){return Promise.resolve(l.getController()._routing.navigateForwardToContext(i.getBindingContext()))}else{return Promise.resolve(false)}}}return Promise.resolve(undefined)}catch(e){return Promise.reject(e)}};var g=function(){if(t.data("tableType")==="GridTable"&&o.rowIndex!==""){var n=r._getGridTable(t).getFirstVisibleRow();var i=M(function(){return Promise.resolve(t.scrollToIndex(o.rowIndex)).then(function(){var e=r._getMdcTableRows(t);var i,l;if(e.length>0&&e[0]){i=e[0].getParent().getFirstVisibleRow();l=n-i!==0}var g;if(l){g=new Promise(function(e){u.attachEvent("UIUpdated",e)})}else{g=Promise.resolve()}return Promise.resolve(g).then(function(){setTimeout(function(){try{return Promise.resolve(s(t,o.rowIndex)).then(function(e){if(e===false){f(a,t)}})}catch(e){return Promise.reject(e)}},0)})})},function(){e.error("Error while focusing on error")});if(i&&i.then)return i.then(function(){})}else{var g=function(){if(t.data("tableType")==="ResponsiveTable"&&o){return Promise.resolve(r.focusOnMessageTargetControl(l,a,t,o.rowIndex)).then(function(e){if(e===false){f(a,t)}})}else{r.focusOnMessageTargetControl(l,a)}}();if(g&&g.then)return g.then(function(){})}}();if(g&&g.then)return g.then(function(){})})},function(){e.error("Fail to navigate to Error control")});if(n&&n.then)return n.then(function(){})}}();if(n&&n.then)return n.then(function(){})}else{g=u.byId(a.controlIds[0]);var o=u.byId(r.oObjectPageLayout.getSelectedSection());if((o===null||o===void 0?void 0:o.findElements(true).indexOf(g))===-1){c=i.getGroupName().split(", ")[0];r._navigateFromMessageToSectionInIconTabBarMode(r.oObjectPageLayout,c)}r.setFocusToControl(g)}}();if(n&&n.then)return n.then(function(){})}else{c=i.getGroupName().split(", ")[0];r._navigateFromMessageToSectionInIconTabBarMode(r.oObjectPageLayout,c);r.focusOnMessageTargetControl(l,a)}}();return Promise.resolve(d&&d.then?d.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};c.getTargetCell=function e(t,n){return n.getControlIds().length>0?n.getControlIds().map(function(e){var n=t.findElements(true,function(t){return t.getId()===e});return n.length>0?u.byId(e):null}).reduce(function(e,t){return t?t:e}):null};c.focusOnMessageTargetControl=function e(t,n,r,o){try{var i=this;var s=t.findElements(true);var l=n.getControlIds().filter(function(e){return s.some(function(t){return t.getId()===e&&t.getDomRef()})}).map(function(e){return u.byId(e)});var g=l.filter(function(e){return!e.isA("sap.m.Table")&&!e.isA("sap.ui.table.Table")});if(g.length>0){i.setFocusToControl(g[0]);return Promise.resolve(undefined)}else if(l.length>0){var c=r?r.findElements(true,function(e){return e.isA(a.getMetadata().getName())}):[];if(c.length>0&&c[0]){var f=c[o];var d=i.getTargetCell(f,n);if(d){var T=d.isA("sap.fe.macros.field.FieldAPI")?d.getContent().getContentEdit()[0]:d.getItems()[0].getContent().getContentEdit()[0];i.setFocusToControl(T);return Promise.resolve(undefined)}else{var v=n.getTarget().split("/").pop();if(v){t.getModel("internal").setProperty("/messageTargetProperty",v)}if(i._navigationConfigured(r)){return Promise.resolve(t.getController()._routing.navigateForwardToContext(f.getBindingContext()))}else{return Promise.resolve(false)}}}return Promise.resolve(undefined)}return Promise.resolve(undefined)}catch(e){return Promise.reject(e)}};c._getTableColInfo=function e(t,n){var r;var o=t.getColumns().find(function(e,t){return t.getDataProperty()===e}.bind(this,n));if(!o){var i=t.getControlDelegate().getColumnsFor(t).find(function(e){if(!!e.template&&e.propertyInfos){return e.propertyInfos[0]===n||e.propertyInfos[0].replace("Property::","")===n}else{return false}});if(i){o=i;n=o.name;r=t.getColumns().find(function(e){return n===e.getDataProperty()}).getHeader()}else{var a=t.getControlDelegate().getColumnsFor(t);o=a.find(function(e,t,n){if(n.key.indexOf("::FieldGroup::")!==-1){return n.propertyInfos.find(function(){return e.find(function(e){return e.relativePath===t})})}}.bind(this,a,n));var s=false;if(o&&o.label){s=t.getColumns().some(function(e){return e.getHeader()===o.label})}r=s&&o.label;n=s&&o.key}}else{r=o&&o.getHeader()}return{sTableTargetColName:r,sTableTargetColProperty:n}};c._getMessageRank=function e(t,n){if(n){var r,o,i,a,s,l,g,u;for(a=n.length-1;a>=0;--a){r=n[a];o=r.getSubSections();for(s=o.length-1;s>=0;--s){i=o[s];g=i.findElements(true);l=g.filter(this._fnFilterUponId.bind(this,t.getControlId()));u=a+1;if(l.length>0){t.sectionName=r.getTitle();t.subSectionName=i.getTitle();return u*10+(s+1)}}}if(!t.sectionName&&!t.subSectionName&&t.persistent){return 1}return 999}return 999};c._applyFiltersAndSort=function e(){var t=this;var n,r,o,i,a,l,g=null;var c=[];var f=function(){var e=function(e){var n=Infinity,r=u.byId(e[0]);var o=u.byId(e[0]);while(r){var i=r instanceof s?(o===null||o===void 0?void 0:o.getParent()).findElements(true).indexOf(o):Infinity;if(r instanceof s){if(n>i){n=i;t.setFocusToControl(o)}return false}r=r.getParent()}return true};return new d({path:"controlIds",test:e,caseSensitive:true})};function p(){var e=function(e){if(!e.length){return false}var t=u.byId(e[0]);while(t){if(t.getId()===b){return true}if(t instanceof s){return false}t=t.getParent()}return false};return new d({path:"controlIds",test:e,caseSensitive:true})}if(!this.sViewId){this.sViewId=this._getViewId(this.getId())}var b=this.sViewId;var h=this.getAggregation("customFilters");if(h){h.forEach(function(e){c.push(new d({path:e.getProperty("path"),operator:e.getProperty("operator"),value1:e.getProperty("value1"),value2:e.getProperty("value2")}))})}var m=this.getBindingContext();if(!m){this.setVisible(false);return}else{i=m.getPath();n=new d({filters:[new d({path:"validation",operator:T.EQ,value1:true}),p()],and:true});r=new d({filters:[n,new d({path:"target",operator:T.StartsWith,value1:i})],and:false});l=new d({filters:[f()]})}var _=new d({filters:[r,l],and:true});if(c.length>0){o=new d({filters:[c,_],and:false})}else{o=_}this.oItemBinding.filter(o);this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(this.oObjectPageLayout){a=new v("",null,null,function(e,n){if(!g){g=t.oObjectPageLayout&&t.oObjectPageLayout.getSections()}var r=t._getMessageRank(e,g);var o=t._getMessageRank(n,g);if(r<o){return-1}if(r>o){return 1}return 0});this.oItemBinding.sort(a)}};c._fnFilterUponId=function e(t,n){return t===n.getId()};c._fnFilterUponIds=function e(t,n){return t.some(function(e){if(e===n.getId()){return true}return false})};c._getSectionBySectionTitle=function e(t,n){if(n){var r=t.getSections();var o;for(var i=0;i<r.length;i++){if(r[i].getVisible()&&r[i].getTitle()===n){o=r[i];break}}return o}};c._navigateFromMessageToSectionInIconTabBarMode=function e(t,n){var r=t.getUseIconTabBar();if(r){var o=this._getSectionBySectionTitle(t,n);var i=t.getSelectedSection();if(o&&i!==o.getId()){t.setSelectedSection(o.getId())}}};c._navigateFromMessageToSectionTableInIconTabBarMode=function e(t,n,r){try{var o=this;var i=t.getRowBinding();var a=t.getBindingContext();var s=n.getBindingContext();var l=!(a===s);o._navigateFromMessageToSectionInIconTabBarMode(n,r);return Promise.resolve(new Promise(function(e){if(l){i.attachEventOnce("change",function(){e()})}else{e()}}))}catch(e){return Promise.reject(e)}};c._getMdcTable=function e(t){var n=t.getParent();while(n&&!n.isA("sap.ui.mdc.Table")){n=n.getParent()}return n&&n.isA("sap.ui.mdc.Table")?n:undefined};c._getGridTable=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Table")&&e.getParent()===t})[0]};c._getTableRow=function e(t){var n=t.getParent();while(n&&!n.isA("sap.ui.table.Row")&&!n.isA("sap.ui.table.CreationRow")&&!n.isA(a.getMetadata().getName())){n=n.getParent()}return n&&(n.isA("sap.ui.table.Row")||n.isA("sap.ui.table.CreationRow")||n.isA(a.getMetadata().getName()))?n:undefined};c._getTableRowIndex=function e(t){var n=this._getTableRow(t);var r;if(n.isA("sap.ui.table.Row")){r=n.getIndex()}else{r=n.getTable().getItems().findIndex(function(e){return e.getId()===n.getId()})}return r};c._getTableColumnIndex=function e(t){var n=function(e,t){return t.getCells().findIndex(function(t){return t.getId()===e.getId()})};var r=function(e,t){var r=e.getParent(),o=n(r,t);while(r&&o<0){r=r.getParent();o=n(r,t)}return o};var o=this._getTableRow(t);var i;i=r(t,o);if(o.isA("sap.ui.table.CreationRow")){var a=o.getCells()[i].getId(),s=o.getTable().getColumns();i=s.findIndex(function(e){if(e.getCreationTemplate()){return a.search(e.getCreationTemplate().getId())>-1?true:false}else{return false}})}return i};c._getMdcTableRows=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Row")&&e.getTable().getParent()===t})};c._getTableColProperty=function e(t,n){var r=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};return n.getTargets()[0].replace(new RegExp("".concat(r("".concat(t.getBindingContext().getPath(),"/").concat(t.getRowBinding().getPath())),"\\(.*\\)/")),"")};c._getObjectPageLayout=function e(t,n){if(n){return n}n=t;while(n&&!n.isA("sap.uxap.ObjectPageLayout")){n=n.getParent()}return n};c._getCustomColumnInfo=function e(t,n){var r=t.getColumns()[n].getDataProperty();return t.getControlDelegate().getColumnsFor(t).find(function(e){return e.name===r&&!!e.template})};c._getTableFirstColProperty=function e(t){var n=this._getCustomColumnInfo(t,0);var r;if(n){if(n.propertyInfos){r=n.propertyInfos[0].replace("Property::","")}else{r=undefined}}else{r=t.getColumns()[0].getDataProperty()}return r};c._getTableFirstColBindingContextForTextAnnotation=function e(t,n,r){var o;if(n&&r){var i=t.getModel();var a=i.getMetaModel();var s=a.getMetaPath(n.getPath());if(a.getObject("".concat(s,"/").concat(r,"@com.sap.vocabularies.Common.v1.Text/$Path"))){o=a.createBindingContext("".concat(s,"/").concat(r,"@com.sap.vocabularies.Common.v1.Text"))}}return o};c._getTableFirstColValue=function e(t,n,r,o){var i=n.getValue(t);var a;var s=i;if(r){if(t.lastIndexOf("/")>0){t=t.slice(0,t.lastIndexOf("/")+1);t=t.concat(r)}else{t=r}a=n.getValue(t);if(a){if(o){var l=o.slice(o.indexOf("/")+1);switch(l){case"TextOnly":s=a;break;case"TextFirst":s="".concat(a," (").concat(i,")");break;case"TextLast":s="".concat(i," (").concat(a,")");break;case"TextSeparate":s=i;break;default:}}else{s="".concat(a," (").concat(i,")")}}}return s};c._IsControlInTable=function e(t,n){var r=u.byId(n);if(r&&!r.isA("sap.ui.table.Table")&&!r.isA("sap.m.Table")){return t.findElements(true,function(e){return e.getId()===r})}return false};c._IsControlPartOfCreationRow=function e(t){var n=t.getParent();while(n&&!n.isA("sap.ui.table.Row")&&!n.isA("sap.ui.table.CreationRow")&&!n.isA(a.getMetadata().getName())){n=n.getParent()}return!!n&&n.isA("sap.ui.table.CreationRow")};c._fetchColumnInfo=function e(t,n){var r=t.getBindingContext("message").getObject().getTarget().split("/").pop();return n.getParent().getTableDefinition().columns.find(function(e){return e.key.split("::").pop()===r})};c._navigationConfigured=function e(t){var n=sap.ui.require("sap/ui/core/Component"),r=t&&n.getOwnerComponentFor(t)&&n.getOwnerComponentFor(t).getNavigation();var o=false,i=false;if(r&&Object.keys(r).indexOf(t.getRowBinding().sPath)!==-1){o=r[t===null||t===void 0?void 0:t.getRowBinding().sPath]&&r[t===null||t===void 0?void 0:t.getRowBinding().sPath].detail&&r[t===null||t===void 0?void 0:t.getRowBinding().sPath].detail.route?true:false}i=o&&(t===null||t===void 0?void 0:t.getRowSettings().getRowActions())&&(t===null||t===void 0?void 0:t.getRowSettings().getRowActions()[0].mProperties.type.indexOf("Navigation"))!==-1;return i};c._getMessageSubtitle=function e(t,n,o,i,a,s,l,g){var u;var c;var f=s.getParent().getIdentifierColumn();var d=this._fetchColumnInfo(t,s);if(l){u=r.getTranslatedText("T_MESSAGE_ITEM_SUBTITLE",a,[a.getText("T_MESSAGE_ITEM_SUBTITLE_CREATION_ROW_INDICATOR"),i?i:d.label])}else{var T=this._getTableFirstColBindingContextForTextAnnotation(s,o,f);var v=T?T.getObject("$Path"):undefined;var p=v&&T?T.getObject("@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember"):undefined;if(n.length>0){if(g){c=g.getValue()}else if(o&&f){c=this._getTableFirstColValue(f,o,v,p)}else{c=undefined}var b=this._determineColumnInfo(d,a);if(c&&i){u=r.getTranslatedText("T_MESSAGE_ITEM_SUBTITLE",a,[c,i])}else if(c&&b.sColumnIndicator==="Hidden"){u="".concat(a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW"),": ").concat(c,", ").concat(b.sColumnValue)}else if(c&&b.sColumnIndicator==="Unknown"){u=r.getTranslatedText("T_MESSAGE_ITEM_SUBTITLE",a,[c,b.sColumnValue])}else if(c&&b.sColumnIndicator==="undefined"){u="".concat(a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW"),": ").concat(c)}else if(!c&&i){u=a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")+": "+i}else if(!c&&b.sColumnIndicator==="Hidden"){u=b.sColumnValue}else{u=null}}else{u=null}}return u};c._determineColumnInfo=function e(t,n){var r={sColumnIndicator:String,sColumnValue:String};if(t){if(t.availability==="Hidden"){r.sColumnValue=undefined;r.sColumnIndicator="undefined"}else{r.sColumnValue="".concat(n.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")," (").concat(n.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION"),"): ").concat(t.label);r.sColumnIndicator="Hidden"}}else{r.sColumnValue=n.getText("T_MESSAGE_ITEM_SUBTITLE_INDICATOR_UNKNOWN");r.sColumnIndicator="Unknown"}return r};c.setFocusToControl=function t(n){var r=this.oMessagePopover;if(r&&n&&n.focus){var o=function(){n.focus()};if(!r.isOpen()){setTimeout(o,0)}else{var i=function(){setTimeout(o,0);r.detachEvent("afterClose",i)};r.attachEvent("afterClose",i);r.close()}}else{e.warning("FE V4 : MessageButton : element doesn't have focus method for focusing.")}};return g}(i),C=B(_.prototype,"customFilters",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),I=B(_.prototype,"messageChange",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),_))||m);return G},false);
//# sourceMappingURL=MessageButton.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/MessageStrip","sap/fe/macros/DelegateUtil","sap/m/IconTabFilter","sap/ui/core/Control","sap/ui/core/Core","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/model/json/JSONModel"],function(e,t,n,r,i,o,l,a,u,s){"use strict";var c,d,f,v,g,p,h,C,b,y,m,_,I,w,T,z,F;var S=n.property;var P=n.event;var A=n.defineUI5Class;var O=n.association;var B=n.aggregation;function D(e,t,n,r){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function E(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function K(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;M(e,t)}function M(e,t){M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return M(e,t)}function V(e,t,n,r,i){var o={};Object.keys(r).forEach(function(e){o[e]=r[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o);if(i&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(i):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function R(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var j;(function(e){e["Suspend"]="suspendBinding";e["Resume"]="resumeBinding"})(j||(j={}));var N=(c=A("sap.fe.templates.ListReport.controls.MultipleModeControl"),d=S({type:"boolean"}),f=S({type:"boolean",defaultValue:false}),v=S({type:"boolean",defaultValue:false}),g=B({type:"sap.m.IconTabBar",multiple:false,isDefault:true}),p=O({type:"sap.ui.core.Control",multiple:true}),h=O({type:"sap.fe.core.controls.FilterBar",multiple:false}),C=P(),c(b=(y=function(n){K(l,n);function l(){var e;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++){r[i]=arguments[i]}e=n.call.apply(n,[this].concat(r))||this;D(e,"showCounts",m,E(e));D(e,"freezeContent",_,E(e));D(e,"countsOutDated",I,E(e));D(e,"content",w,E(e));D(e,"innerControls",T,E(e));D(e,"filterControl",z,E(e));D(e,"select",F,E(e));return e}var c=l.prototype;c.onBeforeRendering=function e(){var t=this;this.getTabsModel();var n=this._getFilterControl();if(!n){this.setCountsOutDated(true)}var r=n===null||n===void 0?void 0:n.getParent();this.getAllInnerControls().forEach(function(e){var n;if(t.showCounts){e.attachEvent("internalDataRequested",t._refreshTabsCount.bind(t))}(n=e.suspendBinding)===null||n===void 0?void 0:n.call(e)});if(r){r.attachEvent("internalSearch",this._onSearch.bind(this));r.attachEvent("internalFilterChanged",this._onFilterChanged.bind(this))}};c.onAfterRendering=function e(){var t,n;(t=this.getSelectedInnerControl())===null||t===void 0?void 0:(n=t.resumeBinding)===null||n===void 0?void 0:n.call(t,!this.getProperty("freezeContent"))};l.render=function e(t,n){t.renderControl(n.content)};c.getTabsModel=function e(){var t="tabsInternal";var n=this.content;if(!n){return undefined}var r=n.getModel(t);if(!r){r=new s({});n.setModel(r,t)}return r};c.getSelectedInnerControl=function e(){var t,n=this;var r=(t=this.content)===null||t===void 0?void 0:t.getItems().find(function(e){return e.getKey()===n.content.getSelectedKey()});return r?this.getAllInnerControls().find(function(e){return n._getTabFromInnerControl(e)===r}):undefined};l.handleTabChange=function e(t){var n,r;var i=t.getSource();var o=i.getParent();var l=t.getParameters();o._setInnerBinding(true);var a=l===null||l===void 0?void 0:l.previousKey;var s=l===null||l===void 0?void 0:l.selectedKey;if(s&&a!==s){var c=o._getFilterControl();if(c&&!o.getProperty("freezeContent")){if(!o.getSelectedInnerControl()){o._refreshCustomView(c.getFilterConditions(),"tabChanged")}}u.add({changes:[{changeSpecificData:{changeType:"selectIconTabBarFilter",content:{selectedKey:s,previousSelectedKey:a}},selectorElement:i}]})}(n=o._getViewController())===null||n===void 0?void 0:(r=n.getExtensionAPI())===null||r===void 0?void 0:r.updateAppState();o.fireEvent("select",{iconTabBar:i,selectedKey:s,previousKey:a})};c.invalidateContent=function e(){this.setCountsOutDated(true);this.getAllInnerControls().forEach(function(e){var t;(t=e.invalidateContent)===null||t===void 0?void 0:t.call(e)})};c.setCountsOutDated=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setProperty("countsOutDated",t);if(t&&!this.getSelectedInnerControl()){this._refreshTabsCount()}};c.setFreezeContent=function e(t){this.setProperty("freezeContent",t);this._setInnerBinding()};c._updateMultiTabNotApplicableFields=function e(t){var n=this;var r=this.getTabsModel();var i=this._getFilterControl();if(r&&i){var o={};this.getAllInnerControls().forEach(function(e){var r=n._getTabFromInnerControl(e);if(r){var l;var a=r.getKey();var u=((l=e.refreshNotApplicableFields)===null||l===void 0?void 0:l.call(e,i))||[];o[a]={notApplicable:{fields:u,title:n._setTabMessageStrip({entityTypePath:i.data("entityType"),ignoredFields:u,resourceBundle:t,title:r.getText()})}}}});r.setData(o)}};c.getAllInnerControls=function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this.innerControls.reduce(function(e,r){var i=a.byId(r);if(i){e.push(i)}return e.filter(function(e){var r;return!n||((r=t._getTabFromInnerControl(e))===null||r===void 0?void 0:r.getVisible())})},[])||[]};c._getFilterControl=function e(){return a.byId(this.filterControl)};c._getTabFromInnerControl=function e(t){var n=o.getMetadata().getName();var r=t;if(r&&!r.isA(n)&&r.getParent){r=t.getParent()}return r&&r.isA(n)?r:undefined};c._getViewController=function e(){var n=t.getTargetView(this);return n&&n.getController()};c._refreshCustomView=function e(t,n){var r,i;(r=this._getViewController())===null||r===void 0?void 0:(i=r.onViewNeedsRefresh)===null||i===void 0?void 0:i.call(r,{filterConditions:t,currentTabId:this.content.getSelectedKey(),refreshCause:n})};c._refreshTabsCount=function t(){var n,r=this;var i=(n=this.content)===null||n===void 0?void 0:n.getSelectedKey();this.getAllInnerControls(true).forEach(function(t){var n=r._getTabFromInnerControl(t);if(t!==null&&t!==void 0&&t.getCounts&&(r.countsOutDated||i===(n===null||n===void 0?void 0:n.getKey()))){if(n&&n.setCount){n.setCount("...");t.getCounts().then(function(e){return n.setCount(e||"0")}).catch(function(t){e.error("Error while requesting Counts for Control",t)})}}});this.setCountsOutDated(false)};c._setInnerBinding=function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.content){this.getAllInnerControls().forEach(function(e){var r;var i=t._getTabFromInnerControl(e);var o=(i===null||i===void 0?void 0:i.getKey())===t.content.getSelectedKey();var l=o&&!t.getProperty("freezeContent")?j.Resume:j.Suspend;(r=e[l])===null||r===void 0?void 0:r.call(e,l===j.Resume?n&&o:undefined)})}};c._setTabMessageStrip=function e(t){var n="";var o=t.ignoredFields;var l=this._getFilterControl();if(l&&Array.isArray(o)&&o.length>0&&t.title){var a=r.getLabels(o,t.entityTypePath,l,t.resourceBundle);n=r.getText(a,l,t.title,i.getLocalizedText);return n}};c._onSearch=function e(t){this.setCountsOutDated(true);this.setFreezeContent(false);if(this.getSelectedInnerControl()){var n;this._updateMultiTabNotApplicableFields((n=this._getViewController())===null||n===void 0?void 0:n.oResourceBundle)}else{this._refreshCustomView(t.getParameter("conditions"),"search")}};c._onFilterChanged=function e(t){if(t.getParameter("conditionsBased")){this.setFreezeContent(true)}};return l}(l),m=V(y.prototype,"showCounts",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),_=V(y.prototype,"freezeContent",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),I=V(y.prototype,"countsOutDated",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),w=V(y.prototype,"content",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),T=V(y.prototype,"innerControls",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),z=V(y.prototype,"filterControl",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),F=V(y.prototype,"select",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),y))||b);return N},false);
//# sourceMappingURL=MultipleModeControl.js.map
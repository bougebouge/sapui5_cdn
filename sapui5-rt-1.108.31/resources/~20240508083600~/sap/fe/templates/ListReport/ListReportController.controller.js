/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/EditFlow","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/MassEdit","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/core/PageController","sap/fe/macros/chart/ChartRuntime","sap/fe/macros/chart/ChartUtils","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filter/FilterUtils","sap/fe/macros/table/TableHelper","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/RootContainer/overrides/EditFlow","sap/fe/templates/TableScroller","sap/ui/base/ManagedObject","sap/ui/core/Component","sap/ui/core/mvc/OverrideExecution","sap/ui/Device","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./ListReportTemplating","./overrides/IntentBasedNavigation","./overrides/Share","./overrides/ViewState"],function(e,t,i,r,n,a,o,s,l,u,d,g,c,f,p,h,v,b,C,y,_,m,P,w,A,B,I,S,T,V,F,x,E,M,R,D,O,L,N){"use strict";var z,k,H,U,j,K,J,q,W,X,$,G,Q,Y,Z,ee,te,ie,re,ne,ae,oe,se,le,ue,de,ge,ce,fe,pe,he;var ve=E.system;var be=p.usingExtension;var Ce=p.publicExtension;var ye=p.privateExtension;var _e=p.finalExtension;var me=p.extensible;var Pe=p.defineUI5Class;function we(e,t,i,r){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function Ae(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function Be(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Ie(e,t)}function Ie(e,t){Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return Ie(e,t)}function Se(e,t,i,r,n){var a={};Object.keys(r).forEach(function(e){a[e]=r[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function Te(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var Ve=C.TemplateContentView,Fe=C.InitialLoadMode;var xe=(z=Pe("sap.fe.templates.ListReport.ListReportController"),k=be(s.override({onAfterBinding:function(){this.getView().getController()._onAfterBinding()}})),H=be(o.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),U=be(c),j=be(a.override(O)),K=be(g.override(L)),J=be(n.override(S)),q=be(f.override(N)),W=be(l),X=be(d),$=be(u),G=Ce(),Q=_e(),Y=ye(),Z=me(x.After),ee=Ce(),te=me(x.After),ie=Ce(),re=me(x.After),z(ne=(ae=function(n){Be(a,n);function a(){var t;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++){r[a]=arguments[a]}t=n.call.apply(n,[this].concat(r))||this;we(t,"_routing",oe,Ae(t));we(t,"_intentBasedNavigation",se,Ae(t));we(t,"sideEffects",le,Ae(t));we(t,"intentBasedNavigation",ue,Ae(t));we(t,"share",de,Ae(t));we(t,"editFlow",ge,Ae(t));we(t,"viewState",ce,Ae(t));we(t,"kpiManagement",fe,Ae(t));we(t,"placeholder",pe,Ae(t));we(t,"massEdit",he,Ae(t));t.handlers={onFilterSearch:function(){this._getFilterBarControl().triggerSearch()},onFiltersChanged:function(e){var t=this._getFilterBarControl();if(t){var i=this.getView().getBindingContext("internal");this.onPendingFilters();var r=t.getAssignedFiltersText().filtersText;var n=V.bindingParser(r);if(n){var a;(a=this.getView().byId("fe::appliedFiltersText"))===null||a===void 0?void 0:a.bindText(n)}else{var o;(o=this.getView().byId("fe::appliedFiltersText"))===null||o===void 0?void 0:o.setText(r)}if(e.getParameter("conditionsBased")){i.setProperty("hasPendingFilters",true)}}},onVariantSelected:function(e){var t=this;var i=e.getSource();var r=e.getParameter("key");var n=this._getMultiModeControl();if(n&&!(i!==null&&i!==void 0&&i.getParent().isA("sap.ui.mdc.ActionToolbar"))){n===null||n===void 0?void 0:n.invalidateContent();n===null||n===void 0?void 0:n.setFreezeContent(true)}setTimeout(function(){if(t._shouldAutoTriggerSearch(i)){return t._getFilterBarControl().triggerSearch()}else if(!t._getApplyAutomaticallyOnVariant(i,r)){t.getExtensionAPI().updateAppState()}},0)},onVariantSaved:function(){var e=this;setTimeout(function(){e.getExtensionAPI().updateAppState()},1e3)},onSearch:function(){var t=this;var i=this._getFilterBarControl();var r=this.getView().getBindingContext("internal");var n=this.getChartControl();var a=A.getEditStateIsHideDraft(i.getConditions());r.setProperty("hasPendingFilters",false);r.setProperty("hideDraftInfo",a);if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(r,i)}if(n){n.getBindingContext("internal").setProperty("",{});var o=n.getBindingContext("pageInternal");var s=o.getProperty("".concat(o.getPath(),"/alpContentView"));if(s===Ve.Chart){this.hasPendingChartChanges=true}if(s===Ve.Table){this.hasPendingTableChanges=true}}M.retrieveExternalState(i).then(function(e){t.filterBarConditions=e.filter}).catch(function(t){e.error("Error while retrieving the external state",t)});if(this.getView().getViewData().liveMode===false){this.getExtensionAPI().updateAppState()}if(ve.phone){var l=this._getDynamicListReportControl();l.setHeaderExpanded(false)}},onChevronPressNavigateOutBound:function(e,t,i,r){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,i,r)},onChartSelectionChanged:function(e){var t=e.getSource().getContent(),i=this._getTable(),r=e.getParameter("data"),n=this.getView().getBindingContext("internal");if(r){_.fnUpdateChart(e);m.setChartFilters(t)}var a=n.getProperty("".concat(n.getPath(),"/alpContentView"));if(a===Ve.Chart){this.hasPendingChartChanges=true}else if(i){i.rebind();this.hasPendingChartChanges=false}},onSegmentedButtonPressed:function(e){var t=e.mParameters.key?e.mParameters.key:null;var i=this.getView().getBindingContext("internal");i.setProperty("alpContentView",t);var r=this.getChartControl();var n=this._getTable();var a={onAfterRendering:function(){var e=o.getItems();e.forEach(function(e){if(e.getKey()===t){e.focus()}});o.removeEventDelegate(a)}};var o=t===Ve.Table?this._getSegmentedButton("Table"):this._getSegmentedButton("Chart");if(o!==e.getSource()){o.addEventDelegate(a)}switch(t){case Ve.Table:this._updateTable(n);break;case Ve.Chart:this._updateChart(r);break;case Ve.Hybrid:this._updateTable(n);this._updateChart(r);break;default:break}this.getExtensionAPI().updateAppState()},onFiltersSegmentedButtonPressed:function(e){var t=e.getParameter("key")==="Compact";this._getFilterBarControl().setVisible(t);this._getVisualFilterBarControl().setVisible(!t)},onStateChange:function(){this.getExtensionAPI().updateAppState()},onDynamicPageTitleStateChanged:function(e){var t=this._getFilterBarControl();if(t&&t.getSegmentedButton()){if(e.getParameter("isExpanded")){t.getSegmentedButton().setVisible(true)}else{t.getSegmentedButton().setVisible(false)}}}};t.formatters={setALPControlMessageStrip:function(e,t,i){var r="";t=t==="true"||t===true;var n=this._getFilterBarControl();if(n&&Array.isArray(e)&&e.length>0&&t){var a=v.getLabels(e,n.data("entityType"),n,this.oResourceBundle);var o=!i.enableSearch;r=t?v.getALPText(a,n,o):v.getText(a,n,"",w.getLocalizedText);return r}}};return t}var o=a.prototype;o.getExtensionAPI=function e(){if(!this.extensionAPI){this.extensionAPI=new I(this)}return this.extensionAPI};o.onInit=function e(){y.prototype.onInit.apply(this);var t=this.getView().getBindingContext("internal");t.setProperty("hasPendingFilters",true);t.setProperty("hideDraftInfo",false);t.setProperty("uom",{});t.setProperty("scalefactor",{});t.setProperty("scalefactorNumber",{});t.setProperty("currency",{});if(this._hasMultiVisualizations()){var i=this._getDefaultPath();if(!ve.desktop&&i===Ve.Hybrid){i=Ve.Chart}t.setProperty("alpContentView",i)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad()};o.onExit=function e(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};o._onAfterBinding=function e(){var t=this;var i=this._getControls("table");if(h.isEditStateDirty()){var n,a;(n=this._getMultiModeControl())===null||n===void 0?void 0:n.invalidateContent();var o=(a=this._getTable())===null||a===void 0?void 0:a.getRowBinding();if(o){if(r.getAppComponent(this.getView())._isFclEnabled()){o.refresh()}else{if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){o.refresh();delete t.sUpdateTimer},0)}var s=function(){t._updateTableActions(i);o.detachDataReceived(s)};o.attachDataReceived(s)}}h.setEditStateProcessed()}if(!this.sUpdateTimer){this._updateTableActions(i)}this.pageReady.waitFor(this.getAppComponent().getAppStateHandler().applyAppState())};o.onBeforeRendering=function e(){y.prototype.onBeforeRendering.apply(this)};o.onAfterRendering=function t(){var i=this;this.getView().getModel("sap.fe.i18n").getResourceBundle().then(function(e){i.oResourceBundle=e;var t=i._getControls();var n=i.getView().getViewData().entitySet;var a=r.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT",i.oResourceBundle,undefined,n);t.forEach(function(e){e.setNoData(a)})}).catch(function(t){e.error("Error while retrieving the resource bundle",t)})};o.onPageReady=function e(t){if(t.forceFocus){this._setInitialFocus()}this.getAppComponent().getShellServices().setBackNavigation(undefined)};o.onViewNeedsRefresh=function e(t){};o.onPendingFilters=function e(){};o.getCurrentEntitySet=function e(){var t;return(t=this._getTable())===null||t===void 0?void 0:t.data("targetCollectionPath").slice(1)};o._updateTableActions=function e(t){var n=[];t.forEach(function(e){n=r.getIBNActions(e,n);var t=e.getBindingContext("internal"),a=JSON.parse(P.parseCustomData(w.getCustomData(e,"operationAvailableMap"))),o=e.getSelectedContexts();t.setProperty("selectedContexts",o);t.setProperty("numberOfSelectedContexts",o.length);B.handleTableDeleteEnablementForSideEffects(e,t);i.setActionEnablement(t,a,o,"table")});r.updateDataFieldForIBNButtonsVisibility(n,this.getView())};o._scrollTablesToRow=function e(t){this._getControls("table").forEach(function(e){T.scrollTableToRow(e,t)})};o._setInitialFocus=function e(){var t=this._getDynamicListReportControl(),i=t.getHeaderExpanded(),r=this._getFilterBarControl();if(r){if(i){if(!r.getShowMessages()){r.setShowMessages(true)}var n=r.getFilterItems().find(function(e){return e.getRequired()&&e.getConditions().length===0});if(n){n.focus()}else if(this._isInitLoadEnabled()){r.getFilterItems()[0].focus()}else{this.getView().byId("".concat(this._getFilterBarControlId(),"-btnSearch")).focus()}}else if(this._isInitLoadEnabled()){var a;(a=this._getTable())===null||a===void 0?void 0:a.focusRow(0)}}else{var o;(o=this._getTable())===null||o===void 0?void 0:o.focusRow(0)}};o._getPageTitleInformation=function e(){var t=this.getAppComponent().getManifestEntry("sap.app");return{title:t.title,subtitle:t.appSubTitle||"",intent:"",icon:""}};o._getFilterBarControl=function e(){return this.getView().byId(this._getFilterBarControlId())};o._getDynamicListReportControl=function e(){return this.getView().byId(this._getDynamicListReportControlId())};o._getAdaptationFilterBarControl=function e(){var t=this._getFilterBarControl().getInbuiltFilter();return t!==null&&t!==void 0&&t.getParent()?t:undefined};o._getSegmentedButton=function e(t){var i;var r=(i=t==="Chart"?this.getChartControl():this._getTable())===null||i===void 0?void 0:i.data("segmentedButtonId");return this.getView().byId(r)};o._getControlFromPageModelProperty=function e(t){var i;var r=(i=this._getPageModel())===null||i===void 0?void 0:i.getProperty(t);return r&&this.getView().byId(r)};o._getPageModel=function e(){var t=F.getOwnerComponentFor(this.getView());return t.getModel("_pageModel")};o._getDynamicListReportControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/dynamicListReportId"))||""};o._getFilterBarControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/filterBarId"))||""};o.getChartControl=function e(){return this._getControlFromPageModelProperty("/singleChartId")};o._getVisualFilterBarControl=function e(){var t=b.generate(["visualFilter",this._getFilterBarControlId()]);return t&&this.getView().byId(t)};o._getFilterBarVariantControl=function e(){return this._getControlFromPageModelProperty("/variantManagement/id")};o._getMultiModeControl=function e(){return this.getView().byId("fe::TabMultipleMode::Control")};o._getTable=function e(){if(this._isMultiMode()){var t,i;var r=(t=this._getMultiModeControl())===null||t===void 0?void 0:(i=t.getSelectedInnerControl())===null||i===void 0?void 0:i.content;return r!==null&&r!==void 0&&r.isA("sap.ui.mdc.Table")?r:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};o._getControls=function e(t){var i=this;if(this._isMultiMode()){var r=[];var n=this._getMultiModeControl().content;n.getItems().forEach(function(e){var n=i.getView().byId(e.getKey());if(n&&t){if(e.getKey().indexOf("fe::".concat(t))>-1){r.push(n)}}else if(n!==undefined&&n!==null){r.push(n)}});return r}else if(t==="Chart"){var a=this.getChartControl();return a?[a]:[]}else{var o=this._getTable();return o?[o]:[]}};o._getDefaultPath=function e(){var t;var i=D.getDefaultPath(((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/views"))||[]);switch(i){case"primary":return Ve.Chart;case"secondary":return Ve.Table;case"both":default:return Ve.Hybrid}};o._isMultiMode=function e(){var t;return!!((t=this._getPageModel())!==null&&t!==void 0&&t.getProperty("/multiViewsControl"))};o._isInitLoadEnabled=function e(){var t=this.getView().getViewData().initialLoad;return t===Fe.Enabled};o._hasMultiVisualizations=function e(){var t;return(t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/hasMultiVisualizations")};o._disableInitLoad=function e(){var t=this._getFilterBarControl();if(t){t.setSuspendSelection(true)}};o._applyAutomaticallyOnStandardVariant=function e(){return false};o._setInitLoad=function e(){if(!this._isInitLoadEnabled()){this._disableInitLoad()}var t=D.getVariantBackReference(this.getView().getViewData(),this._getPageModel());var i=t&&this.getView().byId(t);if(i){i.registerApplyAutomaticallyOnStandardVariant(this._applyAutomaticallyOnStandardVariant.bind(this))}};o._setShareModel=function e(){var i=t.get("sap.ushell.Container.getUser");var r={bookmarkTitle:document.title,bookmarkCustomUrl:function(){var e=R.getHash();return e?"#".concat(e):window.location.href},isShareInJamActive:!!i&&i().isJamActive()};var n=this.getOwnerComponent().getModel("_templPriv");n.setProperty("/listReport/share",r)};o._updateALPNotApplicableFields=function e(t,i){var r={};var n={},a=this._getControls("table"),o=this._getControls("Chart");if(!a.length||!o.length){return}o.forEach(function(e){var t=e.data("targetCollectionPath"),a=t.slice(1),o="".concat(a,"Chart");if(!r[o]){r[o]=A.getNotApplicableFilters(i,e)}n[o]=r[o]});t.setProperty("controls/ignoredFields",n)};o._isFilterBarHidden=function e(){return this.getView().getViewData().hideFilterBar};o._getApplyAutomaticallyOnVariant=function e(t,i){if(!t||!i){return false}var r=t.getVariants();var n=r.find(function(e){return e&&e.key===i});return n&&n.executeOnSelect||false};o._shouldAutoTriggerSearch=function e(t){if(this.getView().getViewData().initialLoad===Fe.Auto&&(!t||t.getStandardVariantKey()===t.getCurrentVariantKey())){var i=this._getFilterBarControl();if(i){var r=i.getConditions();for(var n in r){if(!n.startsWith("$")&&Array.isArray(r[n])&&r[n].length){var a=t.getVariants().find(function(e){return e.key===t.getCurrentVariantKey()});return a&&a.executeOnSelect}}}}return false};o._updateTable=function e(t){if(!t.isTableBound()||this.hasPendingChartChanges){t.rebind();this.hasPendingChartChanges=false}};o._updateChart=function e(t){var i=t.getControlDelegate()._getChart(t);if(!(i&&i.isBound("data"))||this.hasPendingTableChanges){t.getControlDelegate().rebind(t,i.getBindingInfo("data"));this.hasPendingTableChanges=false}};return a}(y),oe=Se(ae.prototype,"_routing",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Se(ae.prototype,"_intentBasedNavigation",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Se(ae.prototype,"sideEffects",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Se(ae.prototype,"intentBasedNavigation",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Se(ae.prototype,"share",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=Se(ae.prototype,"editFlow",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Se(ae.prototype,"viewState",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Se(ae.prototype,"kpiManagement",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Se(ae.prototype,"placeholder",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Se(ae.prototype,"massEdit",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Se(ae.prototype,"getExtensionAPI",[G,Q],Object.getOwnPropertyDescriptor(ae.prototype,"getExtensionAPI"),ae.prototype),Se(ae.prototype,"onPageReady",[Y,Z],Object.getOwnPropertyDescriptor(ae.prototype,"onPageReady"),ae.prototype),Se(ae.prototype,"onViewNeedsRefresh",[ee,te],Object.getOwnPropertyDescriptor(ae.prototype,"onViewNeedsRefresh"),ae.prototype),Se(ae.prototype,"onPendingFilters",[ie,re],Object.getOwnPropertyDescriptor(ae.prototype,"onPendingFilters"),ae.prototype),ae))||ne);return xe},false);
//# sourceMappingURL=ListReportController.controller.js.map
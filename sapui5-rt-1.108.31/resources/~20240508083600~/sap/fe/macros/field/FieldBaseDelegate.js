/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/ui/mdc/field/FieldBaseDelegate","sap/ui/mdc/odata/v4/FieldBaseDelegate","sap/ui/model/Filter"],function(e,t,r,n,a){"use strict";function o(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var a=function(){};return{s:a,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,l=false,u;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){l=true;u=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(l)throw u}}}}function i(e,t){if(!e)return;if(typeof e==="string")return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}function l(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function u(e,t){return e.Parameters.filter(function(e){if(e.LocalDataProperty){return e.LocalDataProperty.$PropertyPath===t}else{return false}})}function c(e,t,r,n,i){var l=[];var u=e.Parameters.filter(function(e){var n;return e.$Type.indexOf("In")>48||((n=e.LocalDataProperty)===null||n===void 0?void 0:n.$PropertyPath)===t&&e.ValueListProperty===r});var c=o(u),f;try{for(c.s();!(f=c.n()).done;){var s=f.value;if(s.LocalDataProperty.$PropertyPath===t){l.push(new a({path:r,operator:"EQ",value1:n}))}else if(s.$Type.indexOf("In")>48&&i!==null&&i!==void 0&&i.isActionParameterDialog){var v="APD_::".concat(s.LocalDataProperty.$PropertyPath);var d=sap.ui.getCore().byId(v);var p=d===null||d===void 0?void 0:d.getValue();if(p!=null){l.push(new a({path:s.ValueListProperty,operator:"EQ",value1:p}))}}}}catch(e){c.e(e)}finally{c.f()}return l}return Object.assign({},n,{getItemForValue:function(e,t,n){if(n.value!==""){return r.getItemForValue(e,t,n)}},getDescription:function(r,n,a){if(r!==null&&r!==void 0&&r.retrieveTextFromValueList||r!==null&&r!==void 0&&r.isFilterField){var o=n.getModel();var i=o?o.getMetaModel():t.getAppComponent(n).getModel().getMetaModel();var l=n===null||n===void 0?void 0:n.getPayload();var f=l===null||l===void 0?void 0:l.propertyPath;var s;return i.requestValueListInfo(f,true,n.getBindingContext()).then(function(e){var t=i.getObject("".concat(f,"@sapui.name"));var r=e[Object.keys(e)[0]];var n;var o=u(r,t);if(o&&o[0]){n=o[0].ValueListProperty}else{return Promise.reject("Inconsistent value help annotation for ".concat(t))}var v=r.$model;var d=v.getMetaModel().getObject("/".concat(r.CollectionPath,"/").concat(n,"@com.sap.vocabularies.Common.v1.Text"));if(d&&d.$Path){s=d.$Path;var p=c(r,t,n,a,l);var y=v.bindList("/".concat(r.CollectionPath),undefined,undefined,p,{$select:s});return y.requestContexts(0,2)}else{return Promise.reject("Text Annotation for ".concat(n,"is not defined"))}}).then(function(e){var t;return e===null||e===void 0?void 0:(t=e[0])===null||t===void 0?void 0:t.getObject(s)}).catch(function(t){var r=t.status&&t.status===404?"Metadata not found (".concat(t.status,") for value help of property ").concat(f):t.message;e.error(r)})}}})},false);
//# sourceMappingURL=FieldBaseDelegate.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/macros/ResourceModel","sap/fe/macros/situations/SituationsText","sap/m/Button","sap/m/CustomListItem","sap/m/HBox","sap/m/Label","sap/m/List","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/ResponsivePopover","sap/m/Text","sap/m/Toolbar","sap/m/VBox"],function(e,t,n,a,i,s,o,r,c,l,p,d,u,m,v){"use strict";var g={};var f=a.bindText;var h=function(e,t,n){try{function c(){e.getView().addDependent(s);s.openBy(y)}y=t.getSource();var a=y.getBindingContext(),i=a.getObject("".concat(n,"/SitnNumberOfInstances"));var s;var o=a.getModel().bindContext(n,a,{$expand:"_Instance($expand=_InstanceAttribute($expand=_InstanceAttributeValue))"}).getBoundContext();var r=function(){if(i<=1){return Promise.resolve(S(e)).then(function(e){s=e;s.setBindingContext(o);s.bindElement({path:"_Instance/0"})})}else{s=b(e,i);s.setBindingContext(o)}}();return Promise.resolve(r&&r.then?r.then(c):c(r))}catch(l){return Promise.reject(l)}};g.showPopover=h;var S=function(t,a){try{var s=[];if(a){s.push(new i({type:"Back",tooltip:n.getText("back"),press:a}).addStyleClass("sapUiNoMarginEnd"))}s.push(new p({state:"Warning",icon:"sap-icon://alert",tooltip:n.getText("situationIconTooltip")}).addStyleClass("sapUiSmallMarginBegin"));s.push(new l({titleActive:false,title:f("SituationTitle")}).addStyleClass("sapUiSmallMarginEnd"));var o={contentWidth:"25em",contentHeight:"7em",placement:"Horizontal",customHeader:new m({content:s}),busyIndicatorDelay:100,content:[new v({items:[new r({text:x("SitnInstceLastChgdAtDateTime")}),new u({text:f("SituationText")}).addStyleClass("sapUiTinyMarginTop")]})]};var c=e.getShellServices(t.getView());var g={target:{action:"displayExtended",semanticObject:"SituationInstance"}};return Promise.resolve(c.isNavigationSupported([g])).then(function(e){if(e[0].supported){o.endButton=new i({text:n.getText("showDetails"),press:function(e){var t;var n=(t=e.getSource().getBindingContext())===null||t===void 0?void 0:t.getObject("SitnInstceKey");if(n!==undefined&&n!==null&&c.crossAppNavService){g.params={SitnInstceKey:n};c.crossAppNavService.toExternal(g)}}})}return new d(o).addStyleClass("sapUiPopupWithPadding").addStyleClass("sapUiResponsivePadding--header")})}catch(e){return Promise.reject(e)}};function x(e){return{path:e,type:"sap.ui.model.odata.type.DateTimeOffset",constraints:{precision:7},formatOptions:{relative:true}}}var y;function b(e,a){var i=function(n){try{var a=n.getSource();var i=a.getBindingContext();var s=function(){if(i&&y){function a(){r.bindElement({path:i.getPath(),parameters:{$expand:"_InstanceAttribute($expand=_InstanceAttributeValue)"},events:{dataReceived:function(){t.unlock(r)}}});u.close();t.lock(r);r.openBy(y)}var n=function(){if(r===null){return Promise.resolve(S(e,m)).then(function(t){r=t;e.getView().addDependent(r)})}}();return n&&n.then?n.then(a):a(n)}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};var r=null;var u=new d({showHeader:false,contentHeight:"".concat(a*4.5,"em"),contentWidth:"25em",busyIndicatorDelay:200,placement:"Horizontal",content:[new c({items:{path:"_Instance",events:{dataReceived:function(){u.setContentHeight()}},parameters:{$orderby:"SitnInstceLastChgdAtDateTime desc",$expand:"_InstanceAttribute($expand=_InstanceAttributeValue)"},template:new s({type:"Navigation",press:i,content:[new o({items:[new p({icon:"sap-icon://alert",state:"Warning",tooltip:n.getText("situation")}).addStyleClass("sapUiTinyMarginEnd"),new l({title:f("SituationTitle"),text:x("SitnInstceLastChgdAtDateTime")})]}).addStyleClass("sapUiSmallMarginBeginEnd").addStyleClass("sapUiSmallMarginTopBottom")]}),templateShareable:false},showNoData:false})]});function m(){if(r){r.unbindObject();r.close()}if(y){u.openBy(y)}}return u}h.__functionName="rt.showPopover";return g},false);
//# sourceMappingURL=SituationsPopover.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/TemplateModel","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/MacroMetadata","sap/fe/macros/situations/SituationsIndicator.fragment"],function(e,t,i,a,n,o,r,l,s,d,p,u,c,v,f){"use strict";var m=p.isSemanticKey;var y=d.getTargetObjectPath;var g=d.getRelativePaths;var b=d.getContextRelativeTargetObjectPath;var h=d.enhanceDataModelPath;var O=l.generate;var x=o.pathInModel;var I=o.not;var T=o.ifElse;var S=o.getExpressionFromAnnotation;var E=o.formatResult;var F=o.constant;var U=o.compileExpression;var D=o.and;var P=t.Entity;var j=v.extend("sap.fe.macros.internal.Field",{name:"Field",namespace:"sap.fe.macros.internal",fragment:"sap.fe.macros.internal.Field",metadata:{stereotype:"xmlmacro",designtime:"sap/fe/macros/internal/Field.designtime",properties:{idPrefix:{type:"string"},_apiId:{type:"string"},noWrapperId:{type:"string"},vhIdPrefix:{type:"string",defaultValue:"FieldValueHelp"},_vhFlexId:{type:"string",computed:true},entitySet:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty","EntityType","Singleton"]},entityType:{type:"sap.ui.model.Context",required:false,computed:true,$kind:["EntityType"]},parentEntitySet:{type:"sap.ui.model.Context",required:false,$kind:["EntitySet","NavigationProperty","EntityType","Singleton"]},navigateAfterAction:{type:"boolean",defaultValue:true},dataField:{type:"sap.ui.model.Context",required:true,$kind:["Property"],$Type:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithAction","com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataPointType"]},semanticObjects:{type:"sap.ui.model.Context",required:false,computed:true},editMode:{type:"sap.ui.mdc.enum.EditMode"},wrap:{type:"boolean"},class:{type:"string"},ariaLabelledBy:{type:"string"},textAlign:{type:"sap.ui.core.TextAlign"},editableExpression:{type:"string",computed:true},enabledExpression:{type:"string",computed:true},collaborationEnabled:{type:"boolean",computed:true},collaborationHasActivityExpression:{type:"string",computed:true},collaborationInitialsExpression:{type:"string",computed:true},collaborationColorExpression:{type:"string",computed:true},semanticObject:{type:"string",required:false},hasSemanticObjectOnNavigation:{type:"boolean",required:false},linkUrl:{type:"string",required:false},formatOptions:{type:"object",properties:{isCurrencyAligned:{type:"boolean",defaultValue:false},containsErrorVisibility:{type:"string"},textAlignMode:{type:"string",defaultValue:"Table",allowedValues:["Table","Form"]},displayMode:{type:"string",allowedValues:["Value","Description","ValueDescription","DescriptionValue"]},fieldMode:{type:"string",allowedValues:["nowrapper",""]},measureDisplayMode:{type:"string",allowedValues:["Hidden","ReadOnly"]},textLinesEdit:{type:"number",configurable:true},textMaxLines:{type:"number",configurable:true},textMaxCharactersDisplay:{type:"number",configurable:true},textExpandBehaviorDisplay:{type:"string",allowedValues:["InPlace","Popover"]},showEmptyIndicator:{type:"boolean",defaultValue:false},semanticKeyStyle:{type:"string",defaultValue:"",allowedValues:["ObjectIdentifier","Label",""]},hasDraftIndicator:{type:"boolean",defaultValue:false},showIconUrl:{type:"boolean",defaultValue:false},ignoreNavigationAvailable:{type:"boolean",defaultValue:false},isAnalytics:{type:"boolean",defaultValue:false},retrieveTextFromValueList:{type:"boolean",defaultValue:false},compactSemanticKey:{type:"boolean",defaultValue:false},fieldGroupDraftIndicatorPropertyPath:{type:"string"},fieldGroupName:{type:"string"}}}},events:{onChange:{type:"function"}}},getOverrides:function(e,t){var i={};if(e){var a=e[t];if(a){Object.keys(a).forEach(function(e){i[e]=a[e]})}}return i},setUpDataPointType:function(e){if((e===null||e===void 0?void 0:e.term)==="com.sap.vocabularies.UI.v1.DataPoint"){e.$Type=e.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}},setUpVisibleProperties:function(e,t){e.visible=c.getVisibleExpression(t,e.formatOptions);e.displayVisible=e.formatOptions.fieldMode==="nowrapper"?e.visible:undefined},setUpParentEntitySet:function(e,t,i){var a;if(t!==null&&t!==void 0&&t.contextLocation&&i!==null&&i!==void 0&&(a=i.models)!==null&&a!==void 0&&a.metaModel){e.parentEntitySet=i.models.metaModel.createBindingContext("/".concat(t.contextLocation.startingEntitySet?t.contextLocation.startingEntitySet.name:t.startingEntitySet.name))}},create:function(e,t,a){var n;var o=i.convertMetaModelContext(e.dataField);var r=i.getInvolvedDataModelObjects(e.dataField,e.entitySet);this.setUpDataPointType(o);this.setUpVisibleProperties(e,r);this.setUpParentEntitySet(e,r,a);if(e._flexId){e._apiId=e._flexId;e._flexId=this.getContentId(e._flexId);e._vhFlexId="".concat(e._flexId,"_").concat(e.vhIdPrefix)}r=this._getTargetValueDataModelPath(o,r);this.setUpSemanticObjects(e,r);e.dataSourcePath=y(r);var l=a.models.metaModel||a.models.entitySet;e.entityType=l.createBindingContext("/".concat(r.targetEntityType.fullyQualifiedName));this.setUpEditableProperties(e,o,r,l);this.setUpFormatOptions(e,r,t,a);this.setUpDisplayStyle(e,o,r);this.setUpEditStyle(e,o,r);var d=["Avatar","AmountWithCurrency"];if(e.displayStyle&&d.indexOf(e.displayStyle)===-1&&r.targetObject){e.text=e.text||c.getTextBinding(r,e.formatOptions);this.setUpObjectIdentifierTitleAndText(e,r)}else{e.text=""}if(((n=e.dataField.getObject("@sapui.name"))===null||n===void 0?void 0:n.indexOf("com.sap.vocabularies.UI.v1.DataPoint"))>-1){var p=e.dataField.getObject();p.$Type=p.$Type||"com.sap.vocabularies.UI.v1.DataPointType";e.dataField=new s(p,e.dataField.getModel()).createBindingContext("/")}e.emptyIndicatorMode=e.formatOptions.showEmptyIndicator?"On":undefined;return e},getObjectIdentifierTitle:function(e,t){var i,a,o,r,l,s,d,p,c,v;var f=x(b(t));var m=e===null||e===void 0?void 0:e.displayMode;var y=t.targetObject.type==="PropertyPath"?t.targetObject.$target:t.targetObject;f=u.formatWithTypeInformation(y,f);var h=(i=y.annotations)===null||i===void 0?void 0:(a=i.Common)===null||a===void 0?void 0:a.Text;if(h===undefined){m="Value"}var O=g(t);var I=[];I.push(x("T_NEW_OBJECT","sap.fe.i18n"));I.push(x("T_ANNOTATION_HELPER_DEFAULT_OBJECT_PAGE_HEADER_TITLE_NO_HEADER_INFO","sap.fe.i18n"));if(!!((o=t.targetEntitySet)!==null&&o!==void 0&&(r=o.annotations)!==null&&r!==void 0&&(l=r.Common)!==null&&l!==void 0&&l.DraftRoot)||!!((s=t.targetEntitySet)!==null&&s!==void 0&&(d=s.annotations)!==null&&d!==void 0&&(p=d.Common)!==null&&p!==void 0&&p.DraftNode)){I.push(P.HasDraft);I.push(P.IsActive)}else{I.push(F(null));I.push(F(null))}switch(m){case"Value":I.push(f);I.push(F(null));break;case"Description":I.push(S(h,O));I.push(F(null));break;case"ValueDescription":I.push(f);I.push(S(h,O));break;default:if(h!==null&&h!==void 0&&(c=h.annotations)!==null&&c!==void 0&&(v=c.UI)!==null&&v!==void 0&&v.TextArrangement){I.push(S(h,O));I.push(f)}else{var T,D,j;I.push(S(h,O));if((T=t.targetObject)!==null&&T!==void 0&&(D=T.annotations)!==null&&D!==void 0&&(j=D.Common)!==null&&j!==void 0&&j.SemanticObject){I.push(f)}else{I.push(F(null))}}break}return U(E(I,n.formatOPTitle))},getObjectIdentifierText:function(e,t){var i,a,n,o;var r=x(b(t));var l=e===null||e===void 0?void 0:e.displayMode;var s=t.targetObject.type==="PropertyPath"?t.targetObject.$target:t.targetObject;var d=(i=s.annotations)===null||i===void 0?void 0:(a=i.Common)===null||a===void 0?void 0:a.Text;if(d===undefined||d!==null&&d!==void 0&&(n=d.annotations)!==null&&n!==void 0&&(o=n.UI)!==null&&o!==void 0&&o.TextArrangement){return undefined}r=u.formatWithTypeInformation(s,r);switch(l){case"ValueDescription":var p=g(t);return U(S(d,p));case"DescriptionValue":return U(r);default:return undefined}},setUpObjectIdentifierTitleAndText:function(e,t){var i;if(((i=e.formatOptions)===null||i===void 0?void 0:i.semanticKeyStyle)==="ObjectIdentifier"){var a,n,o;e.identifierTitle=this.getObjectIdentifierTitle(e.formatOptions,t);if(!((a=t.targetObject)!==null&&a!==void 0&&(n=a.annotations)!==null&&n!==void 0&&(o=n.Common)!==null&&o!==void 0&&o.SemanticObject)){e.identifierText=this.getObjectIdentifierText(e.formatOptions,t)}else{e.identifierText=undefined}}else{e.identifierTitle=undefined;e.identifierText=undefined}},getTextWithWhiteSpace:function(e,t){var i=c.getTextBinding(t,e,true);return i._type==="PathInModel"||typeof i==="string"?U(E([i],"WSR")):U(i)},_getTargetValueDataModelPath:function(e,t){var i,a;if(!(e!==null&&e!==void 0&&e.$Type)){return t}var n="";var o=t;switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":n=(i=e.Value)===null||i===void 0?void 0:i.path;break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target.$target){if(e.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){var r;n=(r=e.Target.$target.Value)===null||r===void 0?void 0:r.path}else{var l;n=(l=e.Target)===null||l===void 0?void 0:l.path}}break}if(((a=n)===null||a===void 0?void 0:a.length)>0){o=h(t,n)}return o},setUpDisplayStyle:function(e,t,i){var a,n,o,r,l,s,d,p,v,y,g,b,h,O,x,I,T,E,F,D,P;var j=i.targetObject;if(!i.targetObject){e.displayStyle="Text";return}if(j.type==="Edm.Stream"){e.displayStyle="File";return}if((a=j.annotations)!==null&&a!==void 0&&(n=a.UI)!==null&&n!==void 0&&n.IsImageURL){e.displayStyle="Avatar";return}var A=j?c.isUsedInNavigationWithQuickViewFacets(i,j):false;switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataPointType":e.displayStyle="DataPoint";return;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(((o=t.Target)===null||o===void 0?void 0:(r=o.$target)===null||r===void 0?void 0:r.$Type)==="com.sap.vocabularies.UI.v1.DataPointType"){e.displayStyle="DataPoint";return}else if(((l=t.Target)===null||l===void 0?void 0:(s=l.$target)===null||s===void 0?void 0:s.$Type)==="com.sap.vocabularies.Communication.v1.ContactType"){e.displayStyle="Contact";return}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":e.displayStyle="Button";return;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":this.setUpNavigationAvailable(e,t);e.displayStyle="Button";return;case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":e.text=this.getTextWithWhiteSpace(e.formatOptions,i);case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":e.displayStyle="Link";return}if(m(j,i)&&e.formatOptions.semanticKeyStyle){var M,V,C;e.hasQuickViewFacets=A;e.hasSituationsIndicator=f.getSituationsNavigationProperty(i.targetEntityType)!==undefined;this.setUpObjectIdentifierTitleAndText(e,i);if((M=i.targetEntitySet)!==null&&M!==void 0&&(V=M.annotations)!==null&&V!==void 0&&(C=V.Common)!==null&&C!==void 0&&C.DraftRoot){e.displayStyle="SemanticKeyWithDraftIndicator";return}e.displayStyle=e.formatOptions.semanticKeyStyle==="ObjectIdentifier"?"ObjectIdentifier":"LabelSemanticKey";return}if(t.Criticality){e.hasQuickViewFacets=A;e.linkUrl=t.Url?U(S(t.Url)):undefined;e.displayStyle="ObjectStatus";return}if((d=j.annotations)!==null&&d!==void 0&&(p=d.Measures)!==null&&p!==void 0&&p.ISOCurrency&&String(e.formatOptions.isCurrencyAligned)==="true"){if(e.formatOptions.measureDisplayMode==="Hidden"){e.displayStyle="Text";return}e.valueAsStringBindingExpression=c.getValueBinding(i,e.formatOptions,true,true,undefined,true);e.unitBindingExpression=U(u.getBindingForUnitOrCurrency(i));e.displayStyle="AmountWithCurrency";return}if((v=j.annotations)!==null&&v!==void 0&&(y=v.Communication)!==null&&y!==void 0&&y.IsEmailAddress||(g=j.annotations)!==null&&g!==void 0&&(b=g.Communication)!==null&&b!==void 0&&b.IsPhoneNumber){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="Link";return}if((h=j.annotations)!==null&&h!==void 0&&(O=h.UI)!==null&&O!==void 0&&O.MultiLineText){e.displayStyle="ExpandableText";return}if(A){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.hasQuickViewFacets=true;e.displayStyle="LinkWithQuickViewForm";return}if(e.semanticObject&&!(j!==null&&j!==void 0&&(x=j.annotations)!==null&&x!==void 0&&(I=x.Communication)!==null&&I!==void 0&&I.IsEmailAddress||j!==null&&j!==void 0&&(T=j.annotations)!==null&&T!==void 0&&(E=T.Communication)!==null&&E!==void 0&&E.IsPhoneNumber)){e.hasQuickViewFacets=A;e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="LinkWithQuickViewForm";return}var W=(F=j.annotations)===null||F===void 0?void 0:F.Common;var N=i===null||i===void 0?void 0:(D=i.navigationProperties[0])===null||D===void 0?void 0:(P=D.annotations)===null||P===void 0?void 0:P.Common;for(var L in W){if(L.indexOf("SemanticObject")===0){e.hasQuickViewFacets=A;e.displayStyle="LinkWrapper";return}}for(var k in N){if(k.indexOf("SemanticObject")===0){e.hasQuickViewFacets=A;e.displayStyle="LinkWrapper";return}}if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="Link";return}e.displayStyle="Text"},setUpEditStyle:function(e,t,i){c.setEditStyleProperties(e,t,i)},setUpEditableProperties:function(t,i,n,o){var l,s,d;var p=n!==null&&n!==void 0&&(l=n.targetObject)!==null&&l!==void 0&&l.Value?n.targetObject.Value:n===null||n===void 0?void 0:n.targetObject;if(t.editMode!==undefined&&t.editMode!==null){t.editModeAsObject=t.editMode}else{var c=t.formatOptions.measureDisplayMode?t.formatOptions.measureDisplayMode==="ReadOnly":false;t.editModeAsObject=u.getEditMode(p,n,c,true,i);t.editMode=U(t.editModeAsObject)}var v=u.getEditableExpressionAsObject(p,i,n);var f=e.getRequiredPropertiesFromInsertRestrictions((s=t.entitySet)===null||s===void 0?void 0:s.getPath().replaceAll("/$NavigationPropertyBinding/","/"),o);var m=e.getRequiredPropertiesFromUpdateRestrictions((d=t.entitySet)===null||d===void 0?void 0:d.getPath().replaceAll("/$NavigationPropertyBinding/","/"),o);var y={requiredPropertiesFromInsertRestrictions:f,requiredPropertiesFromUpdateRestrictions:m};if(r.isCollaborationDraftSupported(o)){t.collaborationEnabled=true;var g=u.getCollaborationExpression(n,a.hasCollaborationActivity);t.collaborationHasActivityExpression=U(g);t.collaborationInitialsExpression=U(u.getCollaborationExpression(n,a.getCollaborationActivityInitials));t.collaborationColorExpression=U(u.getCollaborationExpression(n,a.getCollaborationActivityColor));t.editableExpression=U(D(v,I(g)));t.editMode=U(T(g,F("ReadOnly"),t.editModeAsObject))}else{t.editableExpression=U(v)}t.enabledExpression=u.getEnabledExpression(p,i,false,n);t.requiredExpression=u.getRequiredExpression(p,i,false,false,y,n)},setUpFormatOptions:function(e,t,i,a){var n;var o=this.getOverrides(i,e.dataField.getPath());if(!e.formatOptions.displayMode){e.formatOptions.displayMode=u.getDisplayMode(t)}e.formatOptions.textLinesEdit=o.textLinesEdit||o.formatOptions&&o.formatOptions.textLinesEdit||e.formatOptions.textLinesEdit||4;e.formatOptions.textMaxLines=o.textMaxLines||o.formatOptions&&o.formatOptions.textMaxLines||e.formatOptions.textMaxLines;if((n=a.models.viewData)!==null&&n!==void 0&&n.getProperty("/retrieveTextFromValueList")){e.formatOptions.retrieveTextFromValueList=c.isRetrieveTextFromValueListEnabled(t.targetObject,e.formatOptions);if(e.formatOptions.retrieveTextFromValueList){var r,l,s;var d=!!(t!==null&&t!==void 0&&(r=t.targetEntityType)!==null&&r!==void 0&&(l=r.annotations)!==null&&l!==void 0&&(s=l.UI)!==null&&s!==void 0&&s.TextArrangement);e.formatOptions.displayMode=d?e.formatOptions.displayMode:"DescriptionValue"}}if(e.formatOptions.fieldMode==="nowrapper"&&e.editMode==="Display"){if(e._flexId){e.noWrapperId=e._flexId}else{e.noWrapperId=e.idPrefix?O([e.idPrefix,"Field-content"]):undefined}}},setUpSemanticObjects:function(e,t){var i,a;var n=[];n=c.getSemanticObjectExpressionToResolve(t===null||t===void 0?void 0:(i=t.targetObject)===null||i===void 0?void 0:(a=i.annotations)===null||a===void 0?void 0:a.Common);if(!!e.semanticObject&&typeof e.semanticObject==="string"&&e.semanticObject[0]==="{"){n.push({key:e.semanticObject.substr(1,e.semanticObject.length-2),value:e.semanticObject})}e.semanticObjects=c.getSemanticObjects(n);if(!e.semanticObject&&t.navigationProperties.length>0){t.navigationProperties.forEach(function(t){var i,a;if(t!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(a=i.Common)!==null&&a!==void 0&&a.SemanticObject){e.semanticObject=t.annotations.Common.SemanticObject;e.hasSemanticObjectOnNavigation=true}})}},setUpNavigationAvailable:function(e,t){e.navigationAvailable=true;if((t===null||t===void 0?void 0:t.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&t.NavigationAvailable!==undefined&&String(e.formatOptions.ignoreNavigationAvailable)!=="true"){e.navigationAvailable=U(S(t.NavigationAvailable))}}});return j},false);
//# sourceMappingURL=Field.metadata.js.map
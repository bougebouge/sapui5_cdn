/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/ModelHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/ODataMetaModelUtil","sap/m/table/Util","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/Item","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/Device","sap/ui/dom/units/Rem","sap/ui/mdc/field/InParameter","sap/ui/mdc/field/OutParameter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/json/JSONModel"],function(e,t,a,r,n,o,i,l,s,c,u,d,f,g,p,v,m,h,P,y,b,I,V){"use strict";var M=v.system;var C=l.getTypeConfig;var L=l.getDisplayMode;var O=i.getAssociatedUnitProperty;var T=i.getAssociatedTimezoneProperty;var F=i.getAssociatedTextProperty;var x=i.getAssociatedCurrencyProperty;var H=e.Level;function $(e,t){return j(e)||U(e,t)||D(e,t)||S()}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){if(!e)return;if(typeof e==="string")return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return A(e,t)}function A(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++){r[a]=e[a]}return r}function U(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,o,i,l=[],s=!0,c=!1;try{if(o=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;s=!1}else for(;!(s=(r=o.call(a)).done)&&(l.push(r.value),l.length!==t);s=!0){}}catch(e){c=!0,n=e}finally{try{if(!s&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(c)throw n}}return l}}function j(e){if(Array.isArray(e))return e}var B={};var W=[];var E=[];function _(e){return e.Parameters.some(function(e){return e["@com.sap.vocabularies.UI.v1.Importance"]&&e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"})}function N(e,t){var a=t["@com.sap.vocabularies.Common.v1.ValueList"]&&t["@com.sap.vocabularies.Common.v1.ValueList"].SearchSupported,r=e.valueListInfo.$model.getMetaModel().getObject("/".concat(e.valueListInfo.CollectionPath,"@"))||{},n=r["@Org.OData.Capabilities.V1.SearchRestrictions"]&&r["@Org.OData.Capabilities.V1.SearchRestrictions"].Searchable;if(n===undefined&&a===false||n===true&&a===false||n===false){return false}return true}function w(e){return W.find(function(t){return t.sVHId===e})}function R(e){return E.find(function(t){return t.sVHId===e})}function k(e,t){var r=a.computeDisplayMode(e,undefined);var n=e&&e["@com.sap.vocabularies.Common.v1.Text"];var o=n&&e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"];if(t){return n&&typeof n!=="string"&&n.$Path?r:"Value"}else{return o?r:"Value"}}function q(e,t){var a=t.find(function(t){return e.ValueListProperty===t.textColumnName});if(e.ValueListProperty===(a===null||a===void 0?void 0:a.textColumnName)&&!a.keyColumnHidden&&a.keyColumnDisplayFormat!=="Value"){return true}return undefined}function K(e){var t;var a=e.$model.getMetaModel();var r=a.getObject("/".concat(e.CollectionPath,"@"))||{};var n=r["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var o=s.getSortRestrictionsInfo(n);var i=e.Parameters.find(function(t){return(t.$Type=="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||t.$Type=="com.sap.vocabularies.Common.v1.ValueListParameterOut"||t.$Type=="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly")&&!(a.getObject("/".concat(e.CollectionPath,"/").concat(t.ValueListProperty,"@com.sap.vocabularies.UI.v1.Hidden"))===true)});if(i){if(a.getObject("/".concat(e.CollectionPath,"/").concat(i.ValueListProperty,"@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember"))==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){t=a.getObject("/".concat(e.CollectionPath,"/").concat(i.ValueListProperty,"@com.sap.vocabularies.Common.v1.Text/$Path"))}else{t=i.ValueListProperty}}if(t&&(!o[t]||o[t].sortable)){return t}else{return undefined}}function G(e){var t=e.getModel("viewData");if(t){var a=t.getData();if(a){var r=a.columns;if(r){return r.reduce(function(e,t){if(t.path&&t.path.indexOf("/")===-1){e=e?"".concat(e,",").concat(t.path):t.path}return e},undefined)}}}return undefined}function Q(e,t,a){var r=a.split("/");var n,o="";while(r.length){var i=r.shift();n=n?"".concat(n,"/").concat(i):i;var l=e.getObject("".concat(t,"/").concat(n));if(l&&l.$kind==="NavigationProperty"&&l.$isCollection){i+="*"}o=o?"".concat(o,"/").concat(i):i}return o}function X(e,t){var r=[],n=e.getObject("".concat(t,"/@com.sap.vocabularies.UI.v1.SelectionFields"));if(n){n.forEach(function(n){var o="".concat(t,"/").concat(n.$PropertyPath),i=Q(e,t,n.$PropertyPath),l=e.getObject("".concat(o,"@")),s={path:i,label:l["@com.sap.vocabularies.Common.v1.Label"]||o,sortable:true,filterable:a.isPropertyFilterable(e,t,n.$PropertyPath,false),$Type:e.getObject(o).$Type};r.push(s)})}return r}var z={ALLFRAGMENTS:undefined,logFragment:undefined,initializeCachedValueHelp:function(){W.forEach(function(e){if(!e.oVHFilterBar.isDestroyed()){e.oVHFilterBar.destroy()}if(!e.oVHDialogTable.isDestroyed()){e.oVHDialogTable.destroy()}});W=[];E=[]},getColumnVisibilityInfo:function(e,t,a,r){var n=e.$model.getMetaModel();var o=[];var i={isDialogTable:r,columnInfos:o};e.Parameters.forEach(function(t){var r=n.getObject("/".concat(e.CollectionPath,"/").concat(t.ValueListProperty,"@"));var o=r&&r["@com.sap.vocabularies.Common.v1.Text"];var l={};if(o){l={keyColumnHidden:r["@com.sap.vocabularies.UI.v1.Hidden"]?true:false,keyColumnDisplayFormat:o&&k(r,a),textColumnName:o&&o.$Path,columnName:t.ValueListProperty,hasHiddenAnnotation:r&&r["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}else if(r&&r["@com.sap.vocabularies.UI.v1.Hidden"]){l={columnName:t.ValueListProperty,hasHiddenAnnotation:r&&r["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}i.columnInfos.push(l)});return i},getColumnVisibility:function(e,t,a){var r=a&&!!a.valueHelpWithFixedValues,n=a.columnInfo,o=!q(t,n.columnInfos),i=n.isDialogTable;if(r||!r&&i||!r&&!_(e)){var l=n.columnInfos.find(function(e){return t.ValueListProperty===e.columnName&&e.hasHiddenAnnotation===true});return!l?o:false}else if(!r&&_(e)){return t&&t["@com.sap.vocabularies.UI.v1.Importance"]&&t["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"?true:false}return true},getSortConditionsFromPresentationVariant:function(e,t){var a=e.PresentationVariantQualifier===""?"":"#".concat(e.PresentationVariantQualifier),r="/".concat(e.CollectionPath,"/@com.sap.vocabularies.UI.v1.PresentationVariant").concat(a);var n=e.$model.getMetaModel().getObject(r);if(n&&n.SortOrder){var o={sorters:[]};if(t){n.SortOrder.forEach(function(e){var t={};t.path=e.Property.$PropertyPath;if(e.Descending){t.descending=true}else{t.ascending=true}o.sorters.push(t)});return"sorter: ".concat(JSON.stringify(o.sorters))}else{n.SortOrder.forEach(function(e){var t={};t.name=e.Property.$PropertyPath;if(e.Descending){t.descending=true}else{t.ascending=true}o.sorters.push(t)});return JSON.stringify(o)}}return undefined},hasImportance:function(e){return _(e.getObject())?"Importance/High":"None"},getMinScreenWidth:function(e){return _(e)?"{= ${_VHUI>/minScreenWidth}}":"416px"},getTableItemsParameters:function(e,t,a,r){var n="";var o=e.Parameters.some(function(e){return a||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"});if(t){n=", parameters: {$$groupId: '"+t+"'"}var i=G(this);if(i){if(n.length>0){n=n+", '"+i+"'"}else{n=", parameters: {$select: '"+i+"'"}}if(n.length>0){n=n+" }"}var l=r?"":", length: 10",s=z.getSortConditionsFromPresentationVariant(e,a),c=s?", "+s+"}":"}";return"{path: '/"+e.CollectionPath+"'"+n+", suspended : "+o+l+c},getTableDelegate:function(e){var t=K(e);if(t){t="'".concat(t,"'")}return"{name: 'sap/fe/macros/internal/valuehelp/TableDelegate', payload: {collectionName: '"+e.CollectionPath+"'"+(t?", defaultSortPropertyName: "+t:"")+"}}"},getPropertyPath:function(e){return!e.UnboundAction?"".concat(e.EntityTypePath,"/").concat(e.Action,"/").concat(e.Property):"/".concat(e.Action.substring(e.Action.lastIndexOf(".")+1),"/").concat(e.Property)},getWaitForPromise:function(){return B},getValueListCollectionEntitySet:function(e){var t=e.getObject();return t.$model.getMetaModel().createBindingContext("/".concat(t.CollectionPath))},getValueListProperty:function(e){var t=e.getModel();var a=t.getObject("/");return a.$model.getMetaModel().createBindingContext("/".concat(a.CollectionPath,"/").concat(e.getObject()))},getValueListInfoWithUseCaseSensitive:function(t){var a=t.valueListInfo.CollectionPath,r=t.valueListInfo.$model.getMetaModel();return Promise.all([r.requestObject("/".concat(a,"@Org.OData.Capabilities.V1.FilterFunctions")),r.requestObject("/@Org.OData.Capabilities.V1.FilterFunctions")]).then(function(e){var a=$(e,2),r=a[0],n=a[1];var o=r||n;t.useCaseSensitive=o?o.indexOf("tolower")===-1:true;return t}).catch(function(t){e.error("error trying to get the value help entitySet capabilities");throw t})},getValueListInfo:function(t,a,r,n,o){var i,l,s,c="";var u=a.getObject("".concat(r,"@sapui.name")),d=[],g=[];return a.requestValueListInfo(r,true,t.getBindingContext()).then(function(e){var a=t.getInParameters().length+t.getOutParameters().length===0,p=t.getModel("_VHUI"),v=t.data("valuelistForValidation"),m=p.getProperty("/isSuggestion"),y=p.getProperty("/hasValueListRelevantQualifiers"),b=t.getAggregation("collectiveSearchItems")||[],I=Object.keys(e),V=I.indexOf(""),M=t.getModel().getMetaModel().getObject("".concat(r,"@"))["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"];var C,L=I[0];if(V&&V>0){I.unshift(I[V]);I.splice(V+1,1)}if(L===undefined){return t.getModel("_VHUI").setProperty("/noValidValueHelp",true)}if(y||I.length>1||b.length>1){if(M){C=e[""].$qualifier===""?"".concat(t.getId(),"::non-qualifier"):"".concat(t.getId(),"::qualifier::").concat(e[""].$qualifier);p.setProperty("/valueHelpId",C);e=e[""]}else if(m&&I.indexOf(v)>-1){C=v===""?"".concat(t.getId(),"::non-qualifier"):"".concat(t.getId(),"::qualifier::").concat(v);p.setProperty("/valueHelpId",C);p.setProperty("/collectiveSearchKey",v);e=e[v];t.setProperty("validateInput",true)}else{b.forEach(function(e){if(!I.includes(e.getKey())){t.removeAggregation("collectiveSearchItems",e)}});if(I.length===1){t.removeAllAggregation("collectiveSearchItems");o.collectiveSearchKey=undefined}else{I.forEach(function(a){if(b.filter(function(e){return e.getKey()===a}).length===0){t.addAggregation("collectiveSearchItems",new f({key:a,text:e[a].Label,enabled:true}))}})}if(o&&o.collectiveSearchKey!==undefined){L=o.collectiveSearchKey}else if(o&&o.collectiveSearchKey===undefined){L=I[0];o.collectiveSearchKey=I[0]}C=L===""?"".concat(t.getId(),"::non-qualifier"):"".concat(t.getId(),"::qualifier::").concat(L);t.getModel("_VHUI").setProperty("/valueHelpId",C);t.getModel("_VHUI").setProperty("/collectiveSearchKey",L);e=e[L];if(!t.getParent().isA("sap.ui.mdc.FilterBar")&&m&&v!==L){t.setProperty("validateInput",false)}}}else{e=e[L]}var O="";var T=z.considerInOutParameter(t,r);if(t.data("useMultiValueField")==="true"&&t.getBindingContext()&&t.getBindingContext().getPath()){var F=t.getBindingContext().getPath().split("/");var x=r.split("/");if(x.length-F.length>1){var H=[];for(var $=F.length;$<x.length-1;$++){H.push(x[$])}O="".concat(H.join("/"),"/")}}var S=e.$model.getMetaModel(),D="/".concat(e.CollectionPath),A=X(S,D),U=z.getParentFilterFieldNames(t);e.Parameters.forEach(function(r){s="/".concat(e.CollectionPath,"/").concat(r.ValueListProperty);var o=e.$model.getMetaModel().getObject(s),f=e.$model.getMetaModel().getObject("".concat(s,"@"))||{};if(o){if(!i&&r.$Type.indexOf("Out")>48&&r.LocalDataProperty.$PropertyPath===u){c=s;i=r.ValueListProperty;l=f["@com.sap.vocabularies.Common.v1.Text"]&&f["@com.sap.vocabularies.Common.v1.Text"].$Path}if(T){if(a&&r.$Type!=="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"&&r.$Type!=="com.sap.vocabularies.Common.v1.ValueListParameterConstant"&&r.LocalDataProperty&&r.LocalDataProperty.$PropertyPath!==u){var p="";if(n&&n.length>0){if(t.getParent().isA("sap.ui.mdc.Table")&&t.getBindingContext()&&r.$Type.indexOf("In")>48){var v=r.LocalDataProperty.$PropertyPath.split("/");if(v.length>1){var m=v[0];var y=t.getModel().getMetaModel().getMetaContext(t.getBindingContext().getPath());var b=t.getParent().getRowBinding().getPath();if(y.getObject("".concat(b,"/$Partner"))===m){p="{"+r.LocalDataProperty.$PropertyPath.replace(m+"/","")+"}"}}}if(!p){p="{"+n+">/conditions/"+r.LocalDataProperty.$PropertyPath+"}"}}else{p="{"+O+r.LocalDataProperty.$PropertyPath+"}"}if(r.$Type.indexOf("Out")>48){if(!U||U.indexOf(r.LocalDataProperty.$PropertyPath)>-1){g.push(new P({value:p,helpPath:r.ValueListProperty}))}}if(r.$Type.indexOf("In")>48){d.push(new h({value:p,helpPath:r.ValueListProperty,initialValueFilterEmpty:r.InitialValueIsSignificant}))}}}if(r.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterConstant"){d.push(new h({value:r.Constant,helpPath:r.ValueListProperty}))}var I=r.ValueListProperty,V=o.$Type;var M=f["@com.sap.vocabularies.Common.v1.Label"]||I;if(f["@com.sap.vocabularies.Common.v1.Text"]&&f["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]&&f["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"].$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){I=f["@com.sap.vocabularies.Common.v1.Text"].$Path;var C="/".concat(e.CollectionPath,"/").concat(I);V=e.$model.getMetaModel().getObject(C).$Type}var L=A.findIndex(function(e){return e.path===I})===-1;if(L){var F={path:I,label:M,sortable:true,filterable:!f["@com.sap.vocabularies.UI.v1.HiddenFilter"],$Type:V};A.push(F)}}});if(l&&A.findIndex(function(e){return e.path===l})===-1){var j={path:l,label:l,sortable:false,filterable:false,$Type:"Edm.String"};A.push(j)}return{keyValue:i,descriptionValue:l,fieldPropertyPath:c,inParameters:d,outParameters:g,valueListInfo:e,columnDefs:A}}).catch(function(a){var n=a.status&&a.status===404?"Metadata not found (".concat(a.status,") for value help of property ").concat(r):a.message;e.error(n);t.destroyContent()})},considerInOutParameter:function(e,t){var a=e.getBindingContext(),r=e.getModel().getMetaModel();if(!a){var n=t;var o=r.getObject(n);var i=null;while(n.length>0){var l;i=Array.isArray(o)?o[0]:o;if(((l=i)===null||l===void 0?void 0:l.$kind)==="Action"){return true}else if(i.$kind==="NavigationProperty"){return false}n=n.substring(0,n.lastIndexOf("/"));o=r.getObject(n)}}return true},getParentFilterFieldNames:function(e){var t;if(e.getParent().isA("sap.ui.mdc.filterbar.vh.FilterBar")||e.getParent().isA("sap.fe.core.controls.FilterBar")){var a=e.getParent();var r=a.getFilterItems();t=r.map(function(e){return e.getFieldPath()})}return t},_templateFragment:function(t,a,r,n,o){var i=p.loadTemplate(t,"fragment"),l=a.valueListInfo,s=new V(l),c=l.$model.getMetaModel(),u=new V(Object.assign({converterType:"ListReport",columns:a.columnDefs||null},o));return Promise.resolve(g.process(i,{name:t},{bindingContexts:{valueList:s.createBindingContext("/"),contextPath:c.createBindingContext("/".concat(l.CollectionPath,"/")),source:r.createBindingContext("/")},models:{valueList:s,contextPath:c,source:r,metaModel:c,viewData:u}})).then(function(a){var r={path:n,fragmentName:t,fragment:a};if(e.getLevel()===H.DEBUG){z.ALLFRAGMENTS=z.ALLFRAGMENTS||[];z.ALLFRAGMENTS.push(r)}if(z.logFragment){setTimeout(function(){z.logFragment(r)},0)}return d.load({definition:a})})},createValueHelpDialog:function(t,a,r,n,o,i){var l=this;var s=a.getMetadata().getName(),c=a.getDialogContent&&a.getDialogContent(),u=c&&c.getId(),d=a.getModel("_VHUI").getProperty("/valueHelpId");var f=a.getModel().getMetaModel().getObject("".concat(t,"@"));if((!r||d!==undefined)&&s.indexOf("FieldValueHelp")>-1){a.setTitle(o.valueListInfo.Label);a.setKeyPath(o.keyValue);a.setDescriptionPath(o.descriptionValue);a.setFilterFields(N(o,f)?"$search":"")}var g=true;var p=false;var v=z.getColumnVisibilityInfo(o.valueListInfo,t,p,g);var m=new V({id:d||a.getId(),groupId:a.data("requestGroupId")||undefined,bSuggestion:i,columnInfo:v,valueHelpWithFixedValues:p,isFieldValueHelp:true});r=r||z._templateFragment("sap.fe.macros.internal.valuehelp.ValueListDialogTable",o,m,t,{enableAutoColumnWidth:!M.phone});n=n||z._templateFragment("sap.fe.macros.internal.valuehelp.ValueListFilterBar",o,m,t);return Promise.all([r,n]).then(function(r){var n=a.getModel("_VHUI").getProperty("/valueHelpId"),i=r[0],s=r[1];if(i){i.setModel(o.valueListInfo.$model);e.info("Value List - Dialog Table - XML content created [".concat(t,"]"),i.getMetadata().getName(),"MDC Templating")}if(s){s.setModel(o.valueListInfo.$model);e.info("Value List- Filterbar - XML content created [".concat(t,"]"),s.getMetadata().getName(),"MDC Templating")}if(s&&s!==a.getFilterBar()||s&&n!==undefined){a.setFilterBar(s)}else{a.addDependent(s)}if(i!==c.getTable()||n!==undefined){c.setTable(i);if(s){i.setFilter(s.getId())}i.initialized();delete B[u]}var d=l.getTableWidth(i,l._getWidthInRem(a._getField()));a.getModel("_VHUI").setProperty("/tableWidth",d);i.setWidth("100%");if(n!==undefined){var f=w(n);if(!f){W.push({sVHId:n,oVHDialogTable:i,oVHFilterBar:s})}else if(f&&f.oVHFilterBar===false){W[W.indexOf(f)].oVHFilterBar=s}}if(!i.isTableBound()&&z.fetchValuesOnInitialLoad(o.valueListInfo)){i.rebind()}})},createValueHelpSuggest:function(t,a,i,l,s){var c=this;var d=a.getSuggestContent&&a.getSuggestContent(),f=d&&d.getId(),g=a.getMetadata().getName(),p=a.getModel("_VHUI").getProperty("/valueHelpId");var v=a.getModel().getMetaModel().getObject("".concat(t,"@"));if((!i||p!==undefined)&&g.indexOf("FieldValueHelp")>-1){a.setTitle(l.valueListInfo.Label);a.setKeyPath(l.keyValue);a.setDescriptionPath(l.descriptionValue);a.setFilterFields(N(l,v)?"$search":"")}var m=a.getModel().getMetaModel().getObject("".concat(t,"@"))["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"];var h=false;var P=z.getColumnVisibilityInfo(l.valueListInfo,t,m,h);var M=new V({id:p||a.getId(),groupId:a.data("requestGroupId")||undefined,bSuggestion:s,propertyPath:t,columnInfo:P,valueHelpWithFixedValues:m});i=i||z._templateFragment("sap.fe.macros.internal.valuehelp.ValueListTable",l,M,t);return Promise.all([i]).then(function(i){var s;var g=i[0];if(g){g.setModel(l.valueListInfo.$model);var v=g.getBinding("items");v.attachEventOnce("dataRequested",function(){r.lock(g)});v.attachEvent("dataReceived",function(e){var t=a.getParent().getId();var o=u.getMessageManager();if(r.isLocked(g)){r.unlock(g)}if(e.getParameter("error")){var i=e.getParameter("error").error.message;var l=function(e){if(t.indexOf("APD_::")===0&&i===e.message){e.target=t;a._oConditions.$search=undefined}return e};setTimeout(function(){n.getMessages().forEach(function(e){l(e)})},0)}else{o.getMessageModel().getData().forEach(function(e){if(e.target.includes(t)&&e.controlIds.length===0){e.target=""}})}});if(o.isDraftSupported(v.getModel().getMetaModel(),v.getPath())){v.filter(new y("IsActiveEntity",b.EQ,true),I.Control)}e.info("Value List- suggest Table XML content created [".concat(t,"]"),g.getMetadata().getName(),"MDC Templating")}if(g!==d.getTable()||p!==undefined){d.setTable(g);g.attachEventOnce("updateFinished",function(){d.invalidate(g)});delete B[f]}var m=a.data("sourcePath")!==a.data("originalPropertyPath");var h=a._getField();if(h.isA("sap.ui.mdc.FilterField")||h.isA("sap.ui.mdc.Field")||h.isA("sap.ui.mdc.MultiValueField")){s=c.getTableWidth(g,c._getWidthInRem(h,m));a.getModel("_VHUI").setProperty("/tableWidth",s);g.setWidth(s)}else{a.getModel("_VHUI").setProperty("/tableWidth",undefined)}if(p!==undefined){var P=R(p);if(!P){E.push({sVHId:p,oVHSuggestTable:g})}}})},_getWidthInRem:function(e,t){var a=e.$().width();if(t&&a){a=.3*a}var r=a?parseFloat(m.fromPx(a)):0;return isNaN(r)?0:r},getTableWidth:function(e,t){var a;var r=e.getColumns(),n=r&&r.filter(function(e){return e&&e.getVisible&&e.getVisible()})||[],o=n.reduce(function(e,t){a=t.getWidth();if(a&&a.endsWith("px")){a=m.fromPx(a)}var r=parseFloat(a);return e+(isNaN(r)?9:r)},n.length);return"".concat(Math.max(o,t),"em")},createVHUIModel:function(e,t,a){var r=t.getModel(),n=r.getMetaModel();var o=t.getModel("_VHUI");if(!o){o=new V({});t.setModel(o,"_VHUI");o.setProperty("/hasValueListRelevantQualifiers",!!n.getObject("".concat(e,"@"))["@com.sap.vocabularies.Common.v1.ValueListRelevantQualifiers"])}o.setProperty("/isSuggestion",a);o.setProperty("/minScreenWidth",!a?"418px":undefined);return o},showValueListInfo:function(t,r,n,o,i){var l=r.getModel(),s=l?l.getMetaModel():a.getAppComponent(r).getModel().getMetaModel(),c=r.getDialogContent&&r.getDialogContent(),u=r.getSuggestContent&&r.getSuggestContent();var d,f,g,p,v;if(n){d=u&&u.getId();p=u&&u.getTable&&u.getTable();v=p}else{f=c&&c.getTable&&c.getTable();g=r&&r.getFilterBar&&r.getFilterBar();d=c&&c.getId();v=f&&g}var m=z.createVHUIModel(t,r,n);var h=r.getModel("_VHUI").getProperty("/valueHelpId");if(f){f.setWidth("100%")}if(p){var P=m.getProperty("/tableWidth");if(!P){var y=r.data("sourcePath")!==r.data("originalPropertyPath");P=this.getTableWidth(p,this._getWidthInRem(r._getField(),y));r.getModel("_VHUI").setProperty("/tableWidth",P);p.setWidth(P)}}if(h!==undefined&&r.getBindingContext()||r.getModel("_VHUI").getProperty("/collectiveSearchKey")!==undefined&&r.getModel("_VHUI").getProperty("/collectiveSearchKey")!==i.collectiveSearchKey){f=undefined;g=undefined;p=undefined;v=undefined;delete B[d]}if(!n&&!g&&r.getDependents().length>0){var b=r.getDependents()[0];if(b.isA("sap.ui.mdc.filterbar.vh.FilterBar")){g=b}}if(B[d]||v){return B["promise".concat(d)]}else{if(n&&!p||!n&&!f){B[d]=true}var I=z.getValueListInfo(r,s,t,o,i).then(z.getValueListInfoWithUseCaseSensitive).then(function(a){var o=r.getModel("_VHUI").getProperty("/valueHelpId");if(r.getModel("_VHUI").getProperty("/noValidValueHelp")){e.error("Context dependent value help not found");return r.close()}var i=a&&a.inParameters,l=a&&a.outParameters;if(r.getOutParameters().length!==l.length){l.forEach(function(e){r.addOutParameter(e)})}if(r.getInParameters().length!==i.length){i.forEach(function(e){r.addInParameter(e)})}r.setCaseSensitive(a.useCaseSensitive);if(n){var s=R(o);var c=s?s.oVHSuggestTable:undefined;return a&&z.createValueHelpSuggest(t,r,c,a,n)}else{var u=w(o);if(u){f=u.oVHDialogTable;g=u.oVHFilterBar}return a&&z.createValueHelpDialog(t,r,f,g,a,n)}}).catch(function(a){var n=a.status&&a.status===404?"Metadata not found (".concat(a.status,") for value help of property ").concat(t):a.message;e.error(n);r.destroyContent()});B["promise".concat(d)]=I;return I}},setValueListFilterFields:function(e,t,a,r){var n=t.getModel(),o=n.getMetaModel();if(t.getBindingContext()&&t.getModel().getMetaModel().getObject("".concat(e,"@"))["@com.sap.vocabularies.Common.v1.ValueListRelevantQualifiers"]){return}return z.getValueListInfo(t,o,e,r).then(function(a){var r=t.getModel().getMetaModel().getObject("".concat(e,"@"));if(a){t.setFilterFields(N(a,r)?"$search":"")}})},getColumnWidth:function(a){var r,n,o,i,l;var s=a.targetObject;var u=[s];var d=F(s)||x(s)||O(s)||T(s),f=(r=s.annotations)===null||r===void 0?void 0:(n=r.Common)===null||n===void 0?void 0:n.Text,g=f===null||f===void 0?void 0:(o=f.annotations)===null||o===void 0?void 0:(i=o.UI)===null||i===void 0?void 0:(l=i.TextArrangement)===null||l===void 0?void 0:l.toString(),p=g&&L(a);if(d){if(p==="Description"){u=[d]}else if(!f||p&&p!=="Value"){u.push(d)}}var v=0;u.forEach(function(e){var a=C(e,undefined);var r=t.get(a.type);var n=new r(a.formatOptions,a.constraints);var o=n?c.calcColumnWidth(n):null;v+=o?parseFloat(o.replace("rem","")):0});if(!v){e.error("Cannot compute the column width for property: ".concat(s.name))}return v<=20?v.toString()+"rem":"20rem"},fetchValuesOnInitialLoad:function(e){if(e.FetchValues&&e.FetchValues==2){return false}return true},getOutParameterPaths:function(e){var t="";e.forEach(function(e){if(e.$Type.endsWith("Out")){t+="{".concat(e.ValueListProperty,"}")}});return t}};return z},false);
//# sourceMappingURL=ValueListHelper.js.map
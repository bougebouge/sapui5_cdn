/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/MacroMetadata"],function(t,e,a,r,n,o,i){"use strict";var l=o.getVisibleExpression;var s=o.getValueBinding;var c=n.getDisplayMode;var u=a.or;var p=a.not;var f=a.isConstant;var v=a.ifElse;var d=a.getExpressionFromAnnotation;var y=a.constant;var g=a.compileExpression;var m=a.and;var h=t.UI;function b(t,e){var a=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=P(t))||e&&t&&typeof t.length==="number"){if(a)t=a;var r=0;var n=function(){};return{s:n,n:function(){if(r>=t.length)return{done:true};return{done:false,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,i=false,l;return{s:function(){a=a.call(t)},n:function(){var t=a.next();o=t.done;return t},e:function(t){i=true;l=t},f:function(){try{if(!o&&a.return!=null)a.return()}finally{if(i)throw l}}}}function P(t,e){if(!t)return;if(typeof t==="string")return x(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor)a=t.constructor.name;if(a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return x(t,e)}function x(t,e){if(e==null||e>t.length)e=t.length;for(var a=0,r=new Array(e);a<e;a++){r[a]=t[a]}return r}var M=i.extend("sap.fe.macros.internal.CollectionField",{name:"CollectionField",namespace:"sap.fe.macros.internal",fragment:"sap.fe.macros.internal.CollectionField",metadata:{stereotype:"xmlmacro",properties:{idPrefix:{type:"string"},vhIdPrefix:{type:"string",defaultValue:"FieldValueHelp"},_vhFlexId:{type:"string",computed:true},metaPath:{type:"sap.ui.model.Context",required:true,$kind:["Property"]},ariaLabelledBy:{type:"string"},formatOptions:{type:"object",properties:{showEmptyIndicator:{type:"boolean",defaultValue:false},displayOnly:{type:"boolean",defaultValue:false}}},contextPath:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty"]}}},create:function(t){var a=e.getInvolvedDataModelObjects(t.metaPath,t.contextPath);var n=e.convertMetaModelContext(t.metaPath);var o=n.Value.path;t.visible=l(a,t.formatOptions);if(o&&o.length>0){a=r.enhanceDataModelPath(a,o)}var i=r.isPathInsertable(a);var s=r.isPathDeletable(a,{ignoreTargetCollection:true,authorizeUnresolvable:true});var d=r.isPathDeletable(a);var b=v(s._type==="Unresolvable",u(p(f(d)),d),d);t.editMode=t.formatOptions.displayOnly==="true"?"Display":g(v(m(i,b,h.IsEditable),y("Editable"),y("Display")));t.displayMode=c(a);var P=M._getMultiInputSettings(a,t.formatOptions);t.text=P.text;t.collection=t.editMode==="Display"?P.collectionBindingDisplay:P.collectionBindingEdit;t.key=P.key;return t},_getMultiInputSettings:function(t,e){var a,n;var o=M._getPathStructure(t),i=o.collectionPath,l=o.itemDataModelObjectPath;var c="{path:'".concat(i,"', templateShareable: false}");var u="{path:'".concat(i,"', parameters: {$$ownRequest : true}, templateShareable: false}");var p=t.targetObject.type==="PropertyPath"?t.targetObject.$target:t.targetObject;var f=(a=p.annotations)===null||a===void 0?void 0:(n=a.Common)===null||n===void 0?void 0:n.Text;var v=r.getRelativePaths(t);var y=f?g(d(f,v)):s(l,e,true);return{text:y,collectionBindingDisplay:c,collectionBindingEdit:u,key:s(l,e,true)}},_getPathStructure:function(t){var e,a;var r="";var n=(e=t.contextLocation)!==null&&e!==void 0&&e.targetEntitySet?t.contextLocation.targetEntitySet:t.startingEntitySet;var o=[];var i=((a=t.contextLocation)===null||a===void 0?void 0:a.navigationProperties)||[];var l=b(t.navigationProperties),s;try{var c=function(){var e;var a=s.value;if(!t.contextLocation||!((e=t.contextLocation)!==null&&e!==void 0&&e.navigationProperties.some(function(t){return t.fullyQualifiedName===a.fullyQualifiedName}))){o.push(a.name);i.push(a)}if(n&&n.navigationPropertyBinding.hasOwnProperty(a.name)){n=n.navigationPropertyBinding[a.name];if(a.isCollection){return"break"}}};for(l.s();!(s=l.n()).done;){var u=c();if(u==="break")break}}catch(t){l.e(t)}finally{l.f()}r="".concat(o.join("/"));var p=Object.assign({},t);if(p.contextLocation){p.contextLocation.navigationProperties=i}return{collectionPath:r,itemDataModelObjectPath:p}}});return M},false);
//# sourceMappingURL=CollectionField.metadata.js.map
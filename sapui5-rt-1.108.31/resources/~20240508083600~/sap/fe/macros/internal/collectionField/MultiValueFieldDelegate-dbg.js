/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils", "sap/ui/mdc/field/MultiValueFieldDelegate"], function (CommonUtils, MdcMultiValueFieldDelegate) {
  "use strict";

  var MultiValueFieldDelegate = Object.assign({}, MdcMultiValueFieldDelegate);
  MultiValueFieldDelegate.updateItems = function (oPayload, aConditions, oControl) {
    var oListBinding = oControl.getBinding("items");
    if (oListBinding.isA("sap.ui.model.odata.v4.ODataListBinding")) {
      var oBindingInfo = oControl.getBindingInfo("items");
      // check if conditions are added, removed or changed
      var oTemplate = oBindingInfo.template;
      var oKeyBindingInfo = oTemplate.getBindingInfo("key");
      var oDescriptionBindingInfo = oTemplate.getBindingInfo("description");
      var sKeyPath = oKeyBindingInfo && oKeyBindingInfo.parts[0].path;
      var sDescriptionPath = oDescriptionBindingInfo && oDescriptionBindingInfo.parts && oDescriptionBindingInfo.parts[0] && oDescriptionBindingInfo.parts[0].path;
      var aContexts = oListBinding.getCurrentContexts();
      var aDataToAdd = [];
      var oController = CommonUtils.getTargetView(oControl).getController();

      // Contexts to delete
      var aNewKeys = aConditions.map(function (oCondition) {
        return oCondition.values[0];
      });
      var aOldKeys = aContexts.map(function (oContext) {
        return oContext.getProperty(sKeyPath);
      });
      var aModificationPromises = [];
      for (var i = 0; i < aContexts.length; i++) {
        var oDeleteContext = aContexts[i];
        if (!aNewKeys.includes(oDeleteContext.getProperty(sKeyPath))) {
          aModificationPromises.push(oController.editFlow.deleteMultipleDocuments([oDeleteContext], {
            controlId: oControl.getId(),
            noDialog: true
          }));
        }
      }
      // data to add
      aConditions.forEach(function (oCondition) {
        if (!aOldKeys.includes(oCondition.values[0])) {
          var oItem = {};
          if (sKeyPath && sKeyPath.indexOf("/") === -1) {
            // we do not manage to create on a sub entity of the 1:n navigation
            oItem[sKeyPath] = oCondition.values[0];
            if (sDescriptionPath && sDescriptionPath.indexOf("/") === -1 && sDescriptionPath !== sKeyPath) {
              oItem[sDescriptionPath] = oCondition.values[1];
            }
            aDataToAdd.push(oItem);
          }
        }
      });
      if (aDataToAdd.length) {
        aModificationPromises.push(oController._editFlow.createMultipleDocuments(oListBinding, aDataToAdd, true));
      }
      return Promise.all(aModificationPromises);
    }
  };
  return MultiValueFieldDelegate;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aVZhbHVlRmllbGREZWxlZ2F0ZSIsIk9iamVjdCIsImFzc2lnbiIsIk1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlIiwidXBkYXRlSXRlbXMiLCJvUGF5bG9hZCIsImFDb25kaXRpb25zIiwib0NvbnRyb2wiLCJvTGlzdEJpbmRpbmciLCJnZXRCaW5kaW5nIiwiaXNBIiwib0JpbmRpbmdJbmZvIiwiZ2V0QmluZGluZ0luZm8iLCJvVGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsIm9LZXlCaW5kaW5nSW5mbyIsIm9EZXNjcmlwdGlvbkJpbmRpbmdJbmZvIiwic0tleVBhdGgiLCJwYXJ0cyIsInBhdGgiLCJzRGVzY3JpcHRpb25QYXRoIiwiYUNvbnRleHRzIiwiZ2V0Q3VycmVudENvbnRleHRzIiwiYURhdGFUb0FkZCIsIm9Db250cm9sbGVyIiwiQ29tbW9uVXRpbHMiLCJnZXRUYXJnZXRWaWV3IiwiZ2V0Q29udHJvbGxlciIsImFOZXdLZXlzIiwibWFwIiwib0NvbmRpdGlvbiIsInZhbHVlcyIsImFPbGRLZXlzIiwib0NvbnRleHQiLCJnZXRQcm9wZXJ0eSIsImFNb2RpZmljYXRpb25Qcm9taXNlcyIsImkiLCJsZW5ndGgiLCJvRGVsZXRlQ29udGV4dCIsImluY2x1ZGVzIiwicHVzaCIsImVkaXRGbG93IiwiZGVsZXRlTXVsdGlwbGVEb2N1bWVudHMiLCJjb250cm9sSWQiLCJnZXRJZCIsIm5vRGlhbG9nIiwiZm9yRWFjaCIsIm9JdGVtIiwiaW5kZXhPZiIsIl9lZGl0RmxvdyIsImNyZWF0ZU11bHRpcGxlRG9jdW1lbnRzIiwiUHJvbWlzZSIsImFsbCJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiTXVsdGlWYWx1ZUZpZWxkRGVsZWdhdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbW1vblV0aWxzIGZyb20gXCJzYXAvZmUvY29yZS9Db21tb25VdGlsc1wiO1xuaW1wb3J0IE1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlIGZyb20gXCJzYXAvdWkvbWRjL2ZpZWxkL011bHRpVmFsdWVGaWVsZERlbGVnYXRlXCI7XG5jb25zdCBNdWx0aVZhbHVlRmllbGREZWxlZ2F0ZSA9IE9iamVjdC5hc3NpZ24oe30sIE1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlKTtcbk11bHRpVmFsdWVGaWVsZERlbGVnYXRlLnVwZGF0ZUl0ZW1zID0gZnVuY3Rpb24gKG9QYXlsb2FkOiBhbnksIGFDb25kaXRpb25zOiBhbnksIG9Db250cm9sOiBhbnkpIHtcblx0Y29uc3Qgb0xpc3RCaW5kaW5nID0gb0NvbnRyb2wuZ2V0QmluZGluZyhcIml0ZW1zXCIpO1xuXHRpZiAob0xpc3RCaW5kaW5nLmlzQShcInNhcC51aS5tb2RlbC5vZGF0YS52NC5PRGF0YUxpc3RCaW5kaW5nXCIpKSB7XG5cdFx0Y29uc3Qgb0JpbmRpbmdJbmZvID0gb0NvbnRyb2wuZ2V0QmluZGluZ0luZm8oXCJpdGVtc1wiKTtcblx0XHQvLyBjaGVjayBpZiBjb25kaXRpb25zIGFyZSBhZGRlZCwgcmVtb3ZlZCBvciBjaGFuZ2VkXG5cdFx0Y29uc3Qgb1RlbXBsYXRlID0gb0JpbmRpbmdJbmZvLnRlbXBsYXRlO1xuXHRcdGNvbnN0IG9LZXlCaW5kaW5nSW5mbyA9IG9UZW1wbGF0ZS5nZXRCaW5kaW5nSW5mbyhcImtleVwiKTtcblx0XHRjb25zdCBvRGVzY3JpcHRpb25CaW5kaW5nSW5mbyA9IG9UZW1wbGF0ZS5nZXRCaW5kaW5nSW5mbyhcImRlc2NyaXB0aW9uXCIpO1xuXHRcdGNvbnN0IHNLZXlQYXRoID0gb0tleUJpbmRpbmdJbmZvICYmIG9LZXlCaW5kaW5nSW5mby5wYXJ0c1swXS5wYXRoO1xuXHRcdGNvbnN0IHNEZXNjcmlwdGlvblBhdGggPVxuXHRcdFx0b0Rlc2NyaXB0aW9uQmluZGluZ0luZm8gJiZcblx0XHRcdG9EZXNjcmlwdGlvbkJpbmRpbmdJbmZvLnBhcnRzICYmXG5cdFx0XHRvRGVzY3JpcHRpb25CaW5kaW5nSW5mby5wYXJ0c1swXSAmJlxuXHRcdFx0b0Rlc2NyaXB0aW9uQmluZGluZ0luZm8ucGFydHNbMF0ucGF0aDtcblx0XHRjb25zdCBhQ29udGV4dHMgPSBvTGlzdEJpbmRpbmcuZ2V0Q3VycmVudENvbnRleHRzKCk7XG5cdFx0Y29uc3QgYURhdGFUb0FkZDogYW55W10gPSBbXTtcblx0XHRjb25zdCBvQ29udHJvbGxlciA9IENvbW1vblV0aWxzLmdldFRhcmdldFZpZXcob0NvbnRyb2wpLmdldENvbnRyb2xsZXIoKTtcblxuXHRcdC8vIENvbnRleHRzIHRvIGRlbGV0ZVxuXHRcdGNvbnN0IGFOZXdLZXlzID0gYUNvbmRpdGlvbnMubWFwKGZ1bmN0aW9uIChvQ29uZGl0aW9uOiBhbnkpIHtcblx0XHRcdHJldHVybiBvQ29uZGl0aW9uLnZhbHVlc1swXTtcblx0XHR9KTtcblx0XHRjb25zdCBhT2xkS2V5cyA9IGFDb250ZXh0cy5tYXAoZnVuY3Rpb24gKG9Db250ZXh0OiBhbnkpIHtcblx0XHRcdHJldHVybiBvQ29udGV4dC5nZXRQcm9wZXJ0eShzS2V5UGF0aCk7XG5cdFx0fSk7XG5cdFx0Y29uc3QgYU1vZGlmaWNhdGlvblByb21pc2VzID0gW107XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhQ29udGV4dHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNvbnN0IG9EZWxldGVDb250ZXh0ID0gYUNvbnRleHRzW2ldO1xuXHRcdFx0aWYgKCFhTmV3S2V5cy5pbmNsdWRlcyhvRGVsZXRlQ29udGV4dC5nZXRQcm9wZXJ0eShzS2V5UGF0aCkpKSB7XG5cdFx0XHRcdGFNb2RpZmljYXRpb25Qcm9taXNlcy5wdXNoKFxuXHRcdFx0XHRcdG9Db250cm9sbGVyLmVkaXRGbG93LmRlbGV0ZU11bHRpcGxlRG9jdW1lbnRzKFtvRGVsZXRlQ29udGV4dF0sIHsgY29udHJvbElkOiBvQ29udHJvbC5nZXRJZCgpLCBub0RpYWxvZzogdHJ1ZSB9KVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBkYXRhIHRvIGFkZFxuXHRcdGFDb25kaXRpb25zLmZvckVhY2goKG9Db25kaXRpb246IGFueSkgPT4ge1xuXHRcdFx0aWYgKCFhT2xkS2V5cy5pbmNsdWRlcyhvQ29uZGl0aW9uLnZhbHVlc1swXSkpIHtcblx0XHRcdFx0Y29uc3Qgb0l0ZW06IGFueSA9IHt9O1xuXHRcdFx0XHRpZiAoc0tleVBhdGggJiYgc0tleVBhdGguaW5kZXhPZihcIi9cIikgPT09IC0xKSB7XG5cdFx0XHRcdFx0Ly8gd2UgZG8gbm90IG1hbmFnZSB0byBjcmVhdGUgb24gYSBzdWIgZW50aXR5IG9mIHRoZSAxOm4gbmF2aWdhdGlvblxuXHRcdFx0XHRcdG9JdGVtW3NLZXlQYXRoXSA9IG9Db25kaXRpb24udmFsdWVzWzBdO1xuXG5cdFx0XHRcdFx0aWYgKHNEZXNjcmlwdGlvblBhdGggJiYgc0Rlc2NyaXB0aW9uUGF0aC5pbmRleE9mKFwiL1wiKSA9PT0gLTEgJiYgc0Rlc2NyaXB0aW9uUGF0aCAhPT0gc0tleVBhdGgpIHtcblx0XHRcdFx0XHRcdG9JdGVtW3NEZXNjcmlwdGlvblBhdGhdID0gb0NvbmRpdGlvbi52YWx1ZXNbMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGFEYXRhVG9BZGQucHVzaChvSXRlbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoYURhdGFUb0FkZC5sZW5ndGgpIHtcblx0XHRcdGFNb2RpZmljYXRpb25Qcm9taXNlcy5wdXNoKG9Db250cm9sbGVyLl9lZGl0Rmxvdy5jcmVhdGVNdWx0aXBsZURvY3VtZW50cyhvTGlzdEJpbmRpbmcsIGFEYXRhVG9BZGQsIHRydWUpKTtcblx0XHR9XG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKGFNb2RpZmljYXRpb25Qcm9taXNlcyk7XG5cdH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IE11bHRpVmFsdWVGaWVsZERlbGVnYXRlO1xuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFBQTtBQUFBOzs7O0VBRUEsSUFBTUEsdUJBQXVCLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFQywwQkFBMEIsQ0FBQztF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
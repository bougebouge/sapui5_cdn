/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/macros/CommonHelper","sap/m/library","sap/ui/core/format/DateFormat"],function(a,e,t,r){"use strict";var i=t.ValueColor;var n={yyyy:new RegExp("[1-9][0-9]{3,}|0[0-9]{3}"),Q:new RegExp("[1-4]"),MM:new RegExp("0[1-9]|1[0-2]"),ww:new RegExp("0[1-9]|[1-4][0-9]|5[0-3]"),yyyyMMdd:new RegExp("([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])"),yyyyMM:new RegExp("([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])")};var o={getThresholdColor:function(a,e){var t=e.context;var r=t.getPath();var n=i.Neutral;if(r.indexOf("DeviationRange")>-1){n=i.Error}else if(r.indexOf("ToleranceRange")>-1){n=i.Critical}return n},getMeasurePropertyPaths:function(t,r,i){var n=[];if(!r){a.warning("FE:Macro:MicroChart : Couldn't find annotations for the DataPoint.");return}t.Measures.forEach(function(o,u){var s=e.getMeasureAttributeIndex(u,t),l=s>-1&&t.MeasureAttributes&&t.MeasureAttributes[s],c=l&&r&&r[l.DataPoint.$AnnotationPath];if(c&&c.Value&&c.Value.$Path){n.push(c.Value.$Path)}else{a.warning("FE:Macro:MicroChart : Couldn't find DataPoint(Value) measure for the measureAttribute ".concat(i," MicroChart."))}});return n.join(",")},getHiddenPathExpression:function(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++){e[t]=arguments[t]}if(!e[0]&&!e[1]){return true}else if(e[0]===true||e[1]===true){return false}else{var r=[];[].forEach.call(e,function(a){if(a&&a.$Path){r.push("%{"+a.$Path+"}")}});return"{= "+r.join(" || ")+" === true ? false : true }"}},isNotAlwaysHidden:function(a,e,t,r,i){if(r===true){this.logError(a,e)}if(i===true){this.logError(a,t)}if(r===undefined&&i===undefined){return true}else{return(!r||r.$Path)&&r!==undefined||(!i||i.$Path)&&i!==undefined?true:false}},logError:function(e,t){a.error("Measure Property ".concat(t.$Path," is hidden for the ").concat(e," Micro Chart"))},formatDecimal:function(a,e,t){var r=[],i=["style: 'short'"];var n;if(typeof t==="number"){n=t}else{n=e&&e.$Scale||1}var o;if(a){if(e.$Nullable!=undefined){r.push("nullable: "+e.$Nullable)}if(e.$Precision!=undefined){i.push("precision: "+(e.$Precision?e.$Precision:"1"))}r.push("scale: "+(n==="variable"?"'"+n+"'":n));o="{ path: '"+a+"'"+", type: 'sap.ui.model.odata.type.Decimal', constraints: { "+r.join(",")+" }, formatOptions: { "+i.join(",")+" } }"}return o},getSelectParameters:function(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++){e[t]=arguments[t]}var r=[],i=e[1],n=[];if(e[0]){n.push("$$groupId : '"+e[0]+"'")}if(e[2]){r.push(e[2])}else if(i){for(var o in i){if(!i[o].$EnumMember&&i[o].$Path){r.push(i[o].$Path)}}}for(var u=3;u<e.length;u++){if(e[u]){r.push(e[u])}}if(r.length){n.push("$select : '"+r.join(",")+"'")}return n.join(",")},getDataPointQualifiersForMeasures:function(e,t,r){var i=[],n=e.MeasureAttributes,o=function(e){var o=e.$PropertyPath;var u;n.forEach(function(a){if(t&&(a&&a.Measure&&a.Measure.$PropertyPath)===o&&a.DataPoint&&a.DataPoint.$AnnotationPath){var e=a.DataPoint.$AnnotationPath;if(t[e]){u=e.indexOf("#")?e.split("#")[1]:"";i.push(u)}}});if(u===undefined){a.warning("FE:Macro:MicroChart : Couldn't find DataPoint(Value) measure for the measureAttribute for ".concat(r," MicroChart."))}};if(!t){a.warning("FE:Macro:MicroChart : Couldn't find annotations for the DataPoint ".concat(r," MicroChart."))}e.Measures.forEach(o);return i.join(",")},logWarning:function(e,t){for(var r in t){var i=t[r];if(!i){a.warning("".concat(r," parameter is missing for the ").concat(e," Micro Chart"))}}},getDisplayValueForMicroChart:function(a,e,t,r){var i=a.ValueFormat&&a.ValueFormat.NumberOfFractionalDigits;var n;if(e){n=o.formatDecimal(e["$Path"],t,i)}else{n=o.formatDecimal(a.Value["$Path"],r,i)}return n},shouldMicroChartRender:function(a,e,t,r,i){var n=["Area","Column","Comparison"],u=e&&e.Value,s=t&&t["com.sap.vocabularies.UI.v1.Hidden"],l=r&&r.Dimensions&&r.Dimensions[0],c=n.indexOf(a)>-1?u&&l:u;if(a==="Harvey"){var f=e&&e.MaximumValue,h=i&&i["com.sap.vocabularies.UI.v1.Hidden"];return u&&f&&o.isNotAlwaysHidden("Bullet",u,f,s,h)}return c&&o.isNotAlwaysHidden(a,u,undefined,s)},getdataPointQualifiersForMicroChart:function(a){if(a.indexOf("com.sap.vocabularies.UI.v1.DataPoint")===-1){return undefined}if(a.indexOf("#")>-1){return a.split("#")[1]}return""},getcolorPaletteForMicroChart:function(a){return a.Criticality?undefined:"sapUiChartPaletteQualitativeHue1, sapUiChartPaletteQualitativeHue2, sapUiChartPaletteQualitativeHue3,          sapUiChartPaletteQualitativeHue4, sapUiChartPaletteQualitativeHue5, sapUiChartPaletteQualitativeHue6, sapUiChartPaletteQualitativeHue7,          sapUiChartPaletteQualitativeHue8, sapUiChartPaletteQualitativeHue9, sapUiChartPaletteQualitativeHue10, sapUiChartPaletteQualitativeHue11"},getMeasureScaleForMicroChart:function(a){if(a.ValueFormat&&a.ValueFormat.NumberOfFractionalDigits){return a.ValueFormat.NumberOfFractionalDigits}if(a.Value&&a.Value["$Path"]&&a.Value["$Path"]["$Scale"]){return a.Value["$Path"]["$Scale"]}return 1},getBindingExpressionForMicrochart:function(a,e,t,r,i,n){var u=r["$isCollection"]||r["$kind"]==="EntitySet";var s=u?"":i;var l=o.getUOMPathForMicrochart(e);var c="";switch(a){case"Radial":l="";break;case"Harvey":c=n.Criticality?n.Criticality["$Path"]:"";break}var f=o.getSelectParameters(t.batchGroupId,"",c,l),h="{ path: '".concat(s,"'")+", parameters : {".concat(f,"} }");return h},getUOMPathForMicrochart:function(a,e){var t;if(e&&!a){t=e["@Org.OData.Measures.V1.ISOCurrency"]&&e["@Org.OData.Measures.V1.ISOCurrency"].$Path||e["@Org.OData.Measures.V1.Unit"]&&e["@Org.OData.Measures.V1.Unit"].$Path}return t?t:undefined},getAggregationForMicrochart:function(a,e,t,r,i,n,u){var s=e["$kind"]==="EntitySet"?"/":"";s=s+r;var l="";var c="";var f=t.Criticality?t.Criticality["$Path"]:"";var h=o.getUOMPathForMicrochart(false,n);var m="";var d="";if(i&&i.$PropertyPath&&i.$PropertyPath["@com.sap.vocabularies.Common.v1.Text"]){d=i.$PropertyPath["@com.sap.vocabularies.Common.v1.Text"].$Path}else{d=i.$PropertyPath}switch(a){case"Points":c=t&&t.CriticalityCalculation;m=t&&t.TargetValue&&t.TargetValue["$Path"];f="";break;case"Columns":c=t&&t.CriticalityCalculation;break;case"LinePoints":f="";break;case"Bars":d="";break}var p=o.getSelectParameters(l,c,f,h,m,d,u),v="{path:'".concat(s,"'")+", parameters : {".concat(p,"} }");return v},getCurrencyOrUnit:function(a){if(a["@Org.OData.Measures.V1.ISOCurrency"]){return a["@Org.OData.Measures.V1.ISOCurrency"].$Path||a["@Org.OData.Measures.V1.ISOCurrency"]}else if(a["@Org.OData.Measures.V1.Unit"]){return a["@Org.OData.Measures.V1.Unit"].$Path||a["@Org.OData.Measures.V1.Unit"]}else{return""}},getCalendarPattern:function(a){return a["@com.sap.vocabularies.Common.v1.IsCalendarYear"]&&"yyyy"||a["@com.sap.vocabularies.Common.v1.IsCalendarQuarter"]&&"Q"||a["@com.sap.vocabularies.Common.v1.IsCalendarMonth"]&&"MM"||a["@com.sap.vocabularies.Common.v1.IsCalendarWeek"]&&"ww"||a["@com.sap.vocabularies.Common.v1.IsCalendarDate"]&&"yyyyMMdd"||a["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&"yyyyMM"},formatDimension:function(e,t,i){var n=r.getDateInstance({pattern:t}).parse(e,false,true);if(n instanceof Date){return parseFloat(n.getTime())}else{a.warning("Date value could not be determined for "+i)}return 0},formatDateDimension:function(a){return o.formatDimension(a,"yyyy-MM-dd","")},formatStringDimension:function(e,t,r){var i=e&&e.toString().match(n[t]);if(i&&i.length){return o.formatDimension(i[0],t,r)}else{a.warning("Pattern not supported for "+r)}return 0},getX:function(a,e,t){if(e==="Edm.Date"){return"{parts: [{path: '"+a+"', type: 'sap.ui.model.odata.type.String'}, {value: '"+a+"'}], formatter: 'MICROCHARTR.formatStringDimension'}"}else if(e==="Edm.String"){var r=t&&o.getCalendarPattern(t);if(r){return"{parts: [{path: '"+a+"', type: 'sap.ui.model.odata.type.String'}, {value: '"+r+"'}, {value: '"+a+"'}], formatter: 'MICROCHARTR.formatStringDimension'}"}}}};return o},false);
//# sourceMappingURL=MicroChartHelper.js.map
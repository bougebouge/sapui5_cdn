/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ClassSupport","sap/fe/macros/library","sap/m/FlexBox","sap/m/Label","sap/m/library","sap/suite/ui/microchart/AreaMicroChart","sap/suite/ui/microchart/ColumnMicroChart","sap/suite/ui/microchart/ComparisonMicroChart","sap/suite/ui/microchart/LineMicroChart","sap/ui/core/Control","sap/ui/core/format/NumberFormat","sap/ui/model/odata/v4/ODataListBinding","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/model/type/Date"],function(e,t,i,r,a,n,o,l,u,s,c,f,g,h,p){"use strict";var d,b,m,y,v,C,L,P,w,_,A,T,O,V,D,x,R,z,N,B,M,E,I,F,j,S,H,U,$,k,Y,G,q,X,Q;var J=t.property;var K=t.event;var W=t.defineUI5Class;var Z=t.aggregation;function ee(e,t,i,r){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function te(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function ie(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;re(e,t)}function re(e,t){re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return re(e,t)}function ae(e,t,i,r,a){var n={};Object.keys(r).forEach(function(e){n[e]=r[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n);if(a&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(a):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function ne(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var oe=i.NavigationType;var le=n.ValueColor;var ue=(d=W("sap.fe.macros.microchart.MicroChartContainer"),b=J({type:"boolean",defaultValue:false}),m=J({type:"string",defaultValue:undefined}),y=J({type:"string[]",defaultValue:[]}),v=J({type:"string",defaultValue:undefined}),C=J({type:"string[]",defaultValue:[]}),L=J({type:"int",defaultValue:undefined}),P=J({type:"int",defaultValue:1}),w=J({type:"int",defaultValue:undefined}),_=J({type:"string",defaultValue:""}),A=J({type:"string",defaultValue:""}),T=J({type:"sap.fe.macros.NavigationType",defaultValue:"None"}),O=J({type:"string",defaultValue:""}),V=K(),D=Z({type:"sap.ui.core.Control",multiple:false,isDefault:true}),x=Z({type:"sap.m.Label",multiple:false}),R=Z({type:"sap.ui.core.Control",multiple:true}),d(z=(N=function(t){ie(i,t);function i(){var e;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++){r[a]=arguments[a]}e=t.call.apply(t,[this].concat(r))||this;ee(e,"showOnlyChart",B,te(e));ee(e,"uomPath",M,te(e));ee(e,"measures",E,te(e));ee(e,"dimension",I,te(e));ee(e,"dataPointQualifiers",F,te(e));ee(e,"measurePrecision",j,te(e));ee(e,"measureScale",S,te(e));ee(e,"dimensionPrecision",H,te(e));ee(e,"chartTitle",U,te(e));ee(e,"chartDescription",$,te(e));ee(e,"navigationType",k,te(e));ee(e,"calendarPattern",Y,te(e));ee(e,"onTitlePressed",G,te(e));ee(e,"microChart",q,te(e));ee(e,"_uomLabel",X,te(e));ee(e,"microChartTitle",Q,te(e));return e}i.render=function e(t,i){t.openStart("div",i);t.openEnd();if(!i.showOnlyChart){var n=i.microChartTitle;if(n){n.forEach(function(e){t.openStart("div");t.openEnd();t.renderControl(e);t.close("div")})}t.openStart("div");t.openEnd();var o=new a({text:i.chartDescription});t.renderControl(o);t.close("div")}var l=i.microChart;if(l){l.addStyleClass("sapUiTinyMarginTopBottom");t.renderControl(l);if(!i.showOnlyChart&&i.uomPath){var u=i._checkIfChartRequiresRuntimeLabels()?undefined:{text:{path:i.uomPath}},s=new a(u),c=new r({alignItems:"Start",justifyContent:"End",items:[s]});t.renderControl(c);i.setAggregation("_uomLabel",s)}}t.close("div")};var n=i.prototype;n.onBeforeRendering=function e(){var t=this._getListBindingForRuntimeLabels();if(t){t.detachEvent("change",this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=undefined}};n.onAfterRendering=function e(){var t=this._getListBindingForRuntimeLabels();if(!this._checkIfChartRequiresRuntimeLabels()){return}if(t){t.attachEvent("change",this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=t}};n.setShowOnlyChart=function e(t){if(!t&&this._olistBinding){this._setChartLabels()}this.setProperty("showOnlyChart",t,false)};n._checkIfChartRequiresRuntimeLabels=function e(){var t=this.microChart;return Boolean(t instanceof o||t instanceof l||t instanceof s||t instanceof u)};n._checkForChartLabelAggregations=function e(){var t=this.microChart;return Boolean(t instanceof o&&t.getAggregation("firstYLabel")&&t.getAggregation("lastYLabel")&&t.getAggregation("firstXLabel")&&t.getAggregation("lastXLabel")||t instanceof l&&t.getAggregation("leftTopLabel")&&t.getAggregation("rightTopLabel")&&t.getAggregation("leftBottomLabel")&&t.getAggregation("rightBottomLabel")||t instanceof s)};n._getListBindingForRuntimeLabels=function e(){var t=this.microChart;var i;if(t instanceof o){var r=t.getChart();i=r&&t.getChart().getBinding("points")}else if(t instanceof l){i=t.getBinding("columns")}else if(t instanceof s){var a=t.getLines();i=a&&a.length&&a[0].getBinding("points")}else if(t instanceof u){i=t.getBinding("data")}return i instanceof g?i:false};n._setRuntimeChartLabelsAndUnitOfMeasure=function e(){var t=this;var i=this._olistBinding,r=i===null||i===void 0?void 0:i.getContexts(),a=this.measures||[],n=this.dimension,o=this.uomPath,l=this.microChart,u=this._uomLabel;if(u&&o&&r&&r.length&&!this.showOnlyChart){u.setText(r[0].getObject(o))}else if(u){u.setText("")}if(!this._checkForChartLabelAggregations()){return}if(!r||!r.length){this._setChartLabels();return}var c=r[0],f=r[r.length-1],g=[],h=l instanceof s,p=c.getObject(n),d=f.getObject(n);var b,m,y={value:Infinity},v={value:-Infinity},C={value:Infinity},L={value:-Infinity};y=p==undefined?y:{context:c,value:p};v=d==undefined?v:{context:f,value:d};a.forEach(function(e,i){b=c.getObject(e);m=f.getObject(e);L=m>L.value?{context:f,value:m,index:h?i:0}:L;C=b<C.value?{context:c,value:b,index:h?i:0}:C;if(h){g.push(t._getCriticalityFromPoint({context:f,value:m,index:i}))}});this._setChartLabels(C.value,L.value,y.value,v.value);if(h){return Promise.all(g).then(function(e){var t=l.getLines();t.forEach(function(t,i){t.setColor(e[i])})})}else{return this._setChartLabelsColors(L,C)}};n._setChartLabelsColors=function e(t,i){var r=this.microChart;return Promise.all([this._getCriticalityFromPoint(i),this._getCriticalityFromPoint(t)]).then(function(e){if(r instanceof o){r.getAggregation("firstYLabel").setProperty("color",e[0],true);r.getAggregation("lastYLabel").setProperty("color",e[1],true)}else if(r instanceof l){r.getAggregation("leftTopLabel").setProperty("color",e[0],true);r.getAggregation("rightTopLabel").setProperty("color",e[1],true)}})};n._setChartLabels=function e(t,i,r,a){var n=this.microChart;t=this._formatDateAndNumberValue(t,this.measurePrecision,this.measureScale);i=this._formatDateAndNumberValue(i,this.measurePrecision,this.measureScale);r=this._formatDateAndNumberValue(r,this.dimensionPrecision,undefined,this.calendarPattern);a=this._formatDateAndNumberValue(a,this.dimensionPrecision,undefined,this.calendarPattern);if(n instanceof o){n.getAggregation("firstYLabel").setProperty("label",t,false);n.getAggregation("lastYLabel").setProperty("label",i,false);n.getAggregation("firstXLabel").setProperty("label",r,false);n.getAggregation("lastXLabel").setProperty("label",a,false)}else if(n instanceof l){n.getAggregation("leftTopLabel").setProperty("label",t,false);n.getAggregation("rightTopLabel").setProperty("label",i,false);n.getAggregation("leftBottomLabel").setProperty("label",r,false);n.getAggregation("rightBottomLabel").setProperty("label",a,false)}else if(n instanceof s){n.setProperty("leftTopLabel",t,false);n.setProperty("rightTopLabel",i,false);n.setProperty("leftBottomLabel",r,false);n.setProperty("rightBottomLabel",a,false)}};n._getCriticalityFromPoint=function e(t){var i=this;var r=Promise.resolve(le.Neutral);var a=this.getModel()&&this.getModel().getMetaModel(),n=this.dataPointQualifiers,o=a instanceof h&&t&&t.context&&t.context.getPath()&&a.getMetaPath(t.context.getPath());if(typeof o==="string"){r=a.requestObject("".concat(o,"/@com.sap.vocabularies.UI.v1.DataPoint").concat(n[t.index]?"#".concat(n[t.index]):"")).then(function(e){var r=le.Neutral;var a=t.context;if(e.Criticality){r=i._criticality(e.Criticality,a)}else if(e.CriticalityCalculation){var n=e.CriticalityCalculation,o={},l=function(e){var t;if(e.$Path){t=a.getObject(e.$Path)}else if(e.hasOwnProperty("$Decimal")){t=e.$Decimal}return t};o.sAcceptanceHigh=n.AcceptanceRangeHighValue?l(n.AcceptanceRangeHighValue):undefined;o.sAcceptanceLow=n.AcceptanceRangeLowValue?l(n.AcceptanceRangeLowValue):undefined;o.sDeviationHigh=n.DeviationRangeHighValue?l(n.DeviationRangeHighValue):undefined;o.sDeviationLow=n.DeviationRangeLowValue?l(n.DeviationRangeLowValue):undefined;o.sToleranceHigh=n.ToleranceRangeHighValue?l(n.ToleranceRangeHighValue):undefined;o.sToleranceLow=n.ToleranceRangeLowValue?l(n.ToleranceRangeLowValue):undefined;o.sImprovementDirection=n.ImprovementDirection.$EnumMember;r=i._criticalityCalculation(o.sImprovementDirection,t.value,o.sDeviationLow,o.sToleranceLow,o.sAcceptanceLow,o.sAcceptanceHigh,o.sToleranceHigh,o.sDeviationHigh)}return r})}return r};n._criticality=function t(i,r){var a,n=le.Neutral;if(i.$Path){var o=i.$Path;a=r.getObject(o);if(a==="Negative"||a==="1"||a===1){n=le.Error}else if(a==="Critical"||a==="2"||a===2){n=le.Critical}else if(a==="Positive"||a==="3"||a===3){n=le.Good}}else if(i.$EnumMember){a=i.$EnumMember;if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Negative")>-1){n=le.Error}else if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Positive")>-1){n=le.Good}else if(a.indexOf("com.sap.vocabularies.UI.v1.CriticalityType/Critical")>-1){n=le.Critical}}else{e.warning("Case not supported, returning the default Value Neutral")}return n};n._criticalityCalculation=function t(i,r,a,n,o,l,u,s){var c=le.Neutral;a=a==undefined?-Infinity:a;n=n==undefined?a:n;o=o==undefined?n:o;s=s==undefined?Infinity:s;u=u==undefined?s:u;l=l==undefined?u:l;if(i.indexOf("Minimize")>-1){if(r<=l){c=le.Good}else if(r<=u){c=le.Neutral}else if(s&&r<=s){c=le.Critical}else{c=le.Error}}else if(i.indexOf("Maximize")>-1){if(r>=o){c=le.Good}else if(r>=n){c=le.Neutral}else if(s&&r>=a){c=le.Critical}else{c=le.Error}}else if(i.indexOf("Target")>-1){if(r<=l&&r>=o){c=le.Good}else if(r>=n&&r<o||r>l&&r<=u){c=le.Neutral}else if(a&&r>=a&&r<n||r>u&&s&&r<=s){c=le.Critical}else{c=le.Error}}else{e.warning("Case not supported, returning the default Value Neutral")}return c};n._formatDateAndNumberValue=function e(t,i,r,a){if(a){return this._getSemanticsValueFormatter(a).formatValue(t,"string")}else if(!isNaN(t)){return this._getLabelNumberFormatter(i,r).format(t)}return t};n._getSemanticsValueFormatter=function e(t){if(!this._oDateType){this._oDateType=new p({style:"short",source:{pattern:t}})}return this._oDateType};n._getLabelNumberFormatter=function e(t,i){return f.getFloatInstance({style:"short",showScale:true,precision:typeof t==="number"?t:null,decimals:typeof i==="number"?i:null})};return i}(c),B=ae(N.prototype,"showOnlyChart",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),M=ae(N.prototype,"uomPath",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),E=ae(N.prototype,"measures",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),I=ae(N.prototype,"dimension",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),F=ae(N.prototype,"dataPointQualifiers",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),j=ae(N.prototype,"measurePrecision",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),S=ae(N.prototype,"measureScale",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),H=ae(N.prototype,"dimensionPrecision",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),U=ae(N.prototype,"chartTitle",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),$=ae(N.prototype,"chartDescription",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),k=ae(N.prototype,"navigationType",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=ae(N.prototype,"calendarPattern",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),G=ae(N.prototype,"onTitlePressed",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),q=ae(N.prototype,"microChart",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),X=ae(N.prototype,"_uomLabel",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=ae(N.prototype,"microChartTitle",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),N))||z);return ue},false);
//# sourceMappingURL=MicroChartContainer.js.map
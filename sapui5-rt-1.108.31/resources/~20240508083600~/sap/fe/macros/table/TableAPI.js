/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/ManifestSettings","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/PasteHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filter/FilterUtils","sap/fe/macros/table/Utils","sap/m/MessageBox","sap/ui/core/message/Message","../MacroAPI"],function(e,t,r,n,i,a,o,l,u,s,p){"use strict";var c,f,d,g,b,v,y,h,m,P,w,C,E,D,x,I,T,M,z,R,O,S,B,F,A,V,_,j,L,U,N,k,q,$,H,G,W,K,J,Q,X,Y,Z,ee,te,re,ne,ie,ae,oe,le,ue,se,pe,ce,fe,de,ge,be,ve,ye,he,me;var Pe=n.xmlEventHandler;var we=n.property;var Ce=n.event;var Ee=n.defineUI5Class;var De=r.CreationMode;function xe(e,t){try{var r=e()}catch(e){return t(e)}if(r&&r.then){return r.then(void 0,t)}return r}function Ie(e,t){try{var r=e()}catch(e){return t(true,e)}if(r&&r.then){return r.then(t.bind(null,false),t.bind(null,true))}return t(false,r)}function Te(e,t,r,n){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Me(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function ze(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Re(e,t)}function Re(e,t){Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return Re(e,t)}function Oe(e,t,r,n,i){var a={};Object.keys(n).forEach(function(e){a[e]=n[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a);if(i&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(i):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function Se(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var Be=(c=Ee("sap.fe.macros.table.TableAPI"),f=we({type:"string",expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"],expectedAnnotations:["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"]}),d=we({type:"sap.ui.model.Context"}),g=we({type:"boolean"}),b=we({type:"string"}),v=we({type:"boolean",defaultValue:false}),y=we({type:"string",defaultValue:"ResponsiveTable"}),h=we({type:"boolean",defaultValue:true}),m=we({type:"boolean",defaultValue:false}),P=we({type:"boolean",defaultValue:false}),w=we({type:"string"}),C=we({type:"string"}),E=we({type:"string"}),D=we({type:"boolean",defaultValue:false}),x=we({type:"boolean",defaultValue:true}),I=we({type:"boolean",defaultValue:false}),T=we({type:"boolean",defaultValue:false}),M=we({type:"boolean",defaultValue:false}),z=we({type:"boolean",defaultValue:false}),R=Ce(),O=Ce(),S=Ce(),B=we({type:"boolean|string",defaultValue:true}),F=we({type:"string"}),A=we({type:"string"}),V=we({type:"boolean",defaultValue:true}),_=Ce(),j=Pe(),L=Pe(),U=Pe(),N=Pe(),k=Pe(),q=Pe(),$=Pe(),H=Pe(),c(G=(W=function(r){ze(n,r);function n(e){var t;for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++){i[a-1]=arguments[a]}t=r.call.apply(r,[this,e].concat(i))||this;Te(t,"metaPath",K,Me(t));Te(t,"tableDefinition",J,Me(t));Te(t,"readOnly",Q,Me(t));Te(t,"id",X,Me(t));Te(t,"busy",Y,Me(t));Te(t,"type",Z,Me(t));Te(t,"enableExport",ee,Me(t));Te(t,"enablePaste",te,Me(t));Te(t,"enableFullScreen",re,Me(t));Te(t,"filterBar",ne,Me(t));Te(t,"selectionMode",ie,Me(t));Te(t,"header",ae,Me(t));Te(t,"enableAutoColumnWidth",oe,Me(t));Te(t,"headerVisible",le,Me(t));Te(t,"dataInitialized",ue,Me(t));Te(t,"bindingSuspended",se,Me(t));Te(t,"outDatedBinding",pe,Me(t));Te(t,"pendingRequest",ce,Me(t));Te(t,"rowPress",fe,Me(t));Te(t,"stateChange",de,Me(t));Te(t,"internalDataRequested",ge,Me(t));Te(t,"personalization",be,Me(t));Te(t,"variantManagement",ve,Me(t));Te(t,"menu",ye,Me(t));Te(t,"isSearchable",he,Me(t));Te(t,"selectionChange",me,Me(t));t.updateFilterBar();if(t.content){t.content.attachEvent("selectionChange",{},t.onTableSelectionChange,Me(t))}return t}var p=n.prototype;p.getSelectedContexts=function e(){return this.content.getSelectedContexts()};p.addMessage=function e(t){var r=this._getMessageManager();var n=this.content;var i=new s({target:n.getRowBinding().getResolvedPath(),type:t.type,message:t.message,processor:n.getModel(),description:t.description,persistent:t.persistent});r.addMessages(i);return i.getId()};p.removeMessage=function e(t){var r=this._getMessageManager();var n=r.getMessageModel().getData();var i=n.find(function(e){return e.id===t});if(i){r.removeMessages(i)}};p._getMessageManager=function e(){return sap.ui.getCore().getMessageManager()};p._getRowBinding=function e(){var t=this.getContent();return t.getRowBinding()};p.getCounts=function e(){var t=this.getContent();return l.getListBindingForCount(t,t.getBindingContext(),{batchGroupId:!this.getProperty("bindingSuspended")?t.data("batchGroupId"):"$auto",additionalFilters:l.getHiddenFilters(t)}).then(function(e){return l.getCountFormatted(e)}).catch(function(){return"0"})};p.onTableRowPress=function e(t,r,n,i){if(n&&n.isInactive()&&n.isTransient()){return false}if(n&&n.isA("sap.ui.model.odata.v4.Context")&&typeof n.getProperty("@$ui5.node.isExpanded")==="boolean"){return false}else{r._routing.navigateForwardToContext(n,i)}};p.onInternalDataReceived=function e(t){if(t.getParameter("error")){this.getController().messageHandler.showMessageDialog()}};p.onInternalDataRequested=function e(t){this.setProperty("dataInitialized",true);this.fireEvent("internalDataRequested",t.getParameters())};p.onPaste=function e(t,r){if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return}var n=t.getParameter("data"),a=t.getSource();if(a.getEnablePaste()===true){i.pasteData(n,a,r)}else{var o=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");u.error(o.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:o.getText("C_COMMON_SAPFE_ERROR")})}};p.onBeforeExport=function e(t){var r=t.getParameters().userExportSettings.splitCells,i=t.getSource(),a=t.getParameters().exportSettings,o=this.tableDefinition.columns;n.updateExportSettings(a,o,i,r)};n.dataStateIndicatorFilter=function e(t,r){var n;var i=(n=r.getBindingContext())===null||n===void 0?void 0:n.getPath();var a=(i?"".concat(i,"/"):"")+r.getRowBinding().getPath();return a===t.getTarget()?true:false};p.onDataStateChange=function e(t){var r=t.getSource();var n=t.getParameter("filteredMessages");if(n){var i=r.getModel("internal");i.setProperty("filteredMessages",n,r.getBindingContext("internal"))}};n.updateExportSettings=function e(t,r,i,o){var l;var u=null;var s;t.dataSource.sizeLimit=1e3;var p=(l=t.workbook)===null||l===void 0?void 0:l.columns;p.forEach(function(e){e.label=a.getLocalizedText(e.label,i);r===null||r===void 0?void 0:r.forEach(function(t){var i=t;if(o){var a;if(i.isDataPointFakeTargetProperty&&i.relativePath===e.property){e.property=[e.property]}var l=/(.*)-additionalProperty(\d+)/.exec(e.columnId);if(l===null){s=1;u=e}else if(l[1]===((a=u)===null||a===void 0?void 0:a.columnId)){e.label=e.label===u.label?"".concat(u.label," (").concat(++s,")"):e.label}}n.updateExportTypeOnTextOnlyProperties(i,e,r)});if(e.type==="Boolean"){var t=sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");e.falseValue=t.getText("no");e.trueValue=t.getText("yes")}});return t};n.updateExportTypeOnTextOnlyProperties=function e(t,r,n){var i;if(((i=t.propertyInfos)===null||i===void 0?void 0:i.length)===1&&r.property.length===1&&t.propertyInfos[0]===r.property[0]){var a;var o=n.find(function(e){return e.relativePath===r.property[0]});r.type=o===null||o===void 0?void 0:(a=o.exportSettings)===null||a===void 0?void 0:a.type}};p.resumeBinding=function e(t){this.setProperty("bindingSuspended",false);if(t&&!this.getDataInitialized()||this.getProperty("outDatedBinding")){var r;this.setProperty("outDatedBinding",false);(r=this.getContent())===null||r===void 0?void 0:r.rebind()}};p.refreshNotApplicableFields=function e(t){var r=this.getContent();return o.getNotApplicableFilters(t,r)};p.suspendBinding=function e(){this.setProperty("bindingSuspended",true)};p.invalidateContent=function e(){this.setProperty("dataInitialized",false);this.setProperty("outDatedBinding",false)};p.onMassEditButtonPressed=function t(r,n){var i=this.content;if(n&&n.massEdit){n.massEdit.openMassEditDialog(i)}else{e.warning("The Controller is not enhanced with Mass Edit functionality")}};p.onTableSelectionChange=function e(t){this.fireEvent("selectionChange",t.getParameters())};p.getTableDefinition=function e(){return this.tableDefinition};p.updateFilterBar=function e(){var t=this.getContent();var r=this.getFilterBar();if(t&&r&&t.getFilter()!==r){this._setFilterBar(r)}};p._setFilterBar=function e(r){var n;var i=this.getContent();var a=sap.ui.getCore();var o=this===null||this===void 0?void 0:this.getId();var l=this.data("tableAPILocalId");var u=l&&r&&o&&o.replace(new RegExp(l+"$"),r);var s=((n=t.getTargetView(this))===null||n===void 0?void 0:n.byId(r))||a.byId(r)||a.byId(u);if(s){if(s.isA("sap.fe.macros.filterBar.FilterBarAPI")){i.setFilter("".concat(s.getId(),"-content"))}else if(s.isA("sap.ui.mdc.FilterBar")){i.setFilter(s.getId())}}};p.checkIfColumnExists=function e(t,r){return t.some(function(e){if((e===null||e===void 0?void 0:e.columnName)===r&&e!==null&&e!==void 0&&e.sColumnNameVisible||(e===null||e===void 0?void 0:e.sTextArrangement)!==undefined&&(e===null||e===void 0?void 0:e.sTextArrangement)===r){return r}})};p.getIdentifierColumn=function e(){var t=this.getContent();var r=this.getTableDefinition().headerInfoTitle;var n=t&&t.getModel().getMetaModel(),i=t.data("metaPath");var a=n.getObject("".concat(i,"/$Type/$Key"));var o=[];if(a&&a.length>0){a.forEach(function(e){if(e!=="IsActiveEntity"){o.push(e)}})}var l=this.getTableDefinition().semanticKeys;var u=[];var s=[];var p=t.getColumns();p.forEach(function(e){var t=e===null||e===void 0?void 0:e.getDataProperty();u.push(t)});u.forEach(function(e){var t,r;var a=n.getObject("".concat(i,"/$Type/").concat(e,"@"));var o=a&&((t=a["@com.sap.vocabularies.Common.v1.Text"])===null||t===void 0?void 0:t.$Path);var l=a&&((r=a["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"])===null||r===void 0?void 0:r.$EnumMember);s.push({columnName:e,sTextArrangement:o,sColumnNameVisible:!(l==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly")})});var c;if(r!==undefined&&this.checkIfColumnExists(s,r)){c=r}else if(l!==undefined&&l.length===1&&this.checkIfColumnExists(s,l[0])){c=l[0]}else if(o!==undefined&&o.length===1&&this.checkIfColumnExists(s,o[0])){c=o[0]}return c};p.setUpEmptyRows=function e(t){try{var r;var n=this;if(((r=n.tableDefinition.control)===null||r===void 0?void 0:r.creationMode)!==De.InlineCreationRows){return Promise.resolve()}var i=new Promise(function(e){if(t.getDomRef()){e()}else{var r={onAfterRendering:function(){t.removeEventDelegate(r);e()}};t.addEventDelegate(r,n)}});return Promise.resolve(i).then(function(){var e=t.getModel("ui").getProperty("/isEditable");if(!e){return}var r=t.getRowBinding();var i=function(){if(r.isResolved()&&r.isLengthFinal()){var e=r.getContext().getPath();var i=r.getAllCurrentContexts().find(function(t){return t.isInactive()&&t.getPath().startsWith(e)});var a=function(){if(!i){return Promise.resolve(n._createEmptyRow(r,t)).then(function(){})}}();if(a&&a.then)return a.then(function(){})}}();if(i&&i.then)return i.then(function(){})})}catch(e){return Promise.reject(e)}};p._createEmptyRow=function r(n,i){try{var a;var o=this;var l=((a=o.tableDefinition.control)===null||a===void 0?void 0:a.inlineCreationRowCount)||2;var u=[];for(var s=0;s<l;s+=1){u.push({})}var p=i.data("tableType")!=="ResponsiveTable";var c=true;var f=t.getTargetView(i);var d=f.getController();var g=d._editFlow;var b=function(){if(!o.creatingEmptyRows){o.creatingEmptyRows=true;var t=Ie(function(){return xe(function(){return Promise.resolve(g.createMultipleDocuments(n,u,p,false,d.editFlow.onBeforeCreate,c)).then(function(e){e===null||e===void 0?void 0:e.forEach(function(e){e.created().catch(function(e){if(!e.canceled){throw e}})})})},function(t){e.error(t)})},function(e,t){o.creatingEmptyRows=false;if(e)throw t;return t});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(b&&b.then?b.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};return n}(p),K=Oe(W.prototype,"metaPath",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),J=Oe(W.prototype,"tableDefinition",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=Oe(W.prototype,"readOnly",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),X=Oe(W.prototype,"id",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=Oe(W.prototype,"busy",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Oe(W.prototype,"type",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Oe(W.prototype,"enableExport",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Oe(W.prototype,"enablePaste",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Oe(W.prototype,"enableFullScreen",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Oe(W.prototype,"filterBar",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=Oe(W.prototype,"selectionMode",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=Oe(W.prototype,"header",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Oe(W.prototype,"enableAutoColumnWidth",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Oe(W.prototype,"headerVisible",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Oe(W.prototype,"dataInitialized",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Oe(W.prototype,"bindingSuspended",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Oe(W.prototype,"outDatedBinding",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Oe(W.prototype,"pendingRequest",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Oe(W.prototype,"rowPress",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Oe(W.prototype,"stateChange",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=Oe(W.prototype,"internalDataRequested",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),be=Oe(W.prototype,"personalization",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=Oe(W.prototype,"variantManagement",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=Oe(W.prototype,"menu",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Oe(W.prototype,"isSearchable",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),me=Oe(W.prototype,"selectionChange",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),Oe(W.prototype,"onTableRowPress",[j],Object.getOwnPropertyDescriptor(W.prototype,"onTableRowPress"),W.prototype),Oe(W.prototype,"onInternalDataReceived",[L],Object.getOwnPropertyDescriptor(W.prototype,"onInternalDataReceived"),W.prototype),Oe(W.prototype,"onInternalDataRequested",[U],Object.getOwnPropertyDescriptor(W.prototype,"onInternalDataRequested"),W.prototype),Oe(W.prototype,"onPaste",[N],Object.getOwnPropertyDescriptor(W.prototype,"onPaste"),W.prototype),Oe(W.prototype,"onBeforeExport",[k],Object.getOwnPropertyDescriptor(W.prototype,"onBeforeExport"),W.prototype),Oe(W.prototype,"onDataStateChange",[q],Object.getOwnPropertyDescriptor(W.prototype,"onDataStateChange"),W.prototype),Oe(W.prototype,"onMassEditButtonPressed",[$],Object.getOwnPropertyDescriptor(W.prototype,"onMassEditButtonPressed"),W.prototype),Oe(W.prototype,"onTableSelectionChange",[H],Object.getOwnPropertyDescriptor(W.prototype,"onTableSelectionChange"),W.prototype),W))||G);return Be},false);
//# sourceMappingURL=TableAPI.js.map
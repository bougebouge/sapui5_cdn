/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/buildingBlocks/BuildingBlockRuntime","sap/fe/core/converters/controls/Common/Form","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/helpers/ID","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/form/FormHelper","sap/ui/model/odata/v4/AnnotationHelper"],function(t,e,a,n,i,r,o,l,s,u){"use strict";var c,p,m,f,b,h,d,y,v,g,P,C,L,x,F,S,w,z,T,M,O,I,j,E,B,k,A,_,D,X,V,$,R,N,U,q,H;var Q={};var G=l.getContextRelativeTargetObjectPath;var W=o.resolveBindingString;var J=o.ifElse;var K=o.equal;var Y=o.compileExpression;var Z=r.getInvolvedDataModelObjects;var tt=i.getFormContainerID;var et=n.UI;var at=a.createFormDefinition;var nt=e.xml;var it=t.xmlEvent;var rt=t.xmlAttribute;var ot=t.xmlAggregation;var lt=t.defineBuildingBlock;var st=t.BuildingBlockBase;function ut(t,e){if(!e){e=t.slice(0)}return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function ct(t,e,a,n){if(!a)return;Object.defineProperty(t,e,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(n):void 0})}function pt(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function mt(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t;ft(t,e)}function ft(t,e){ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function t(e,a){e.__proto__=a;return e};return ft(t,e)}function bt(t,e,a,n,i){var r={};Object.keys(n).forEach(function(t){r[t]=n[t]});r.enumerable=!!r.enumerable;r.configurable=!!r.configurable;if("value"in r||r.initializer){r.writable=true}r=a.slice().reverse().reduce(function(a,n){return n(t,e,a)||a},r);if(i&&r.initializer!==void 0){r.value=r.initializer?r.initializer.call(i):void 0;r.initializer=undefined}if(r.initializer===void 0){Object.defineProperty(t,e,r);r=null}return r}function ht(t,e){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var dt=(c=lt({name:"Form",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros"}),p=rt({type:"string",isPublic:true,required:true}),m=rt({type:"sap.ui.model.Context",required:true,isPublic:true,$kind:["EntitySet","NavigationProperty","EntityType"]}),f=rt({type:"sap.ui.model.Context",isPublic:true,required:true}),b=rt({type:"sap.ui.model.Context"}),h=rt({type:"boolean"}),d=rt({type:"boolean",defaultValue:true}),y=rt({type:"string",isPublic:true}),v=rt({type:"sap.ui.core.TitleLevel",isPublic:true,defaultValue:"Auto"}),g=rt({type:"string"}),P=rt({type:"string",defaultValue:"true"}),C=it(),L=ot({type:"sap.fe.macros.form.FormElement",isPublic:true,slot:"formElements",isDefault:true}),x=rt({type:"object",isPublic:true}),c(F=(S=function(t){mt(e,t);function e(e,a,n){var i;i=t.call(this,e,a,n)||this;ct(i,"id",w,pt(i));ct(i,"contextPath",z,pt(i));ct(i,"metaPath",T,pt(i));ct(i,"formContainers",M,pt(i));ct(i,"useFormContainerLabels",O,pt(i));ct(i,"partOfPreview",I,pt(i));ct(i,"title",j,pt(i));ct(i,"titleLevel",E,pt(i));ct(i,"displayMode",B,pt(i));ct(i,"isVisible",k,pt(i));ct(i,"onChange",A,pt(i));ct(i,"formElements",_,pt(i));ct(i,"layout",D,pt(i));if(i.metaPath&&i.contextPath&&(i.formContainers===undefined||i.formContainers===null)){var r=Z(i.metaPath,i.contextPath);var o={};var l=r.targetObject;var s=false;if(l&&l.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){s=true;l={$Type:"com.sap.vocabularies.UI.v1.ReferenceFacet",Label:l.Label,Target:{$target:l,fullyQualifiedName:l.fullyQualifiedName,path:"",term:"",type:"AnnotationPath",value:G(r)},annotations:{},fullyQualifiedName:l.fullyQualifiedName};o[l.Target.value]={fields:i.formElements}}var u=i.getConverterContext(r,i.contextPath,n,o);var c=at(l,i.isVisible,u);if(s){c.formContainers[0].annotationPath=i.metaPath.getPath()}i.formContainers=c.formContainers;i.useFormContainerLabels=c.useFormContainerLabels;i.facetType=l&&l.$Type}else{var p;i.facetType=(p=i.metaPath.getObject())===null||p===void 0?void 0:p.$Type}if(!i.isPublic){i._apiId=i.createId("Form");i._contentId=i.id}else{i._apiId=i.id;i._contentId="".concat(i.id,"-content")}if(i.displayMode!==undefined){i._editable=Y(J(K(W(i.displayMode,"boolean"),false),true,false))}else{i._editable=Y(et.IsEditable)}return i}Q=e;var a=e.prototype;a.getDataFieldCollection=function t(e,a){var n=a.getObject();var i;var r;if(n.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){i=u.getNavigationPath(n.Target.$AnnotationPath);r={Facet:n}}else{var o=this.contextPath.getPath();var l=a.getPath();if(l.startsWith(o)){l=l.substring(o.length);if(l.charAt(0)==="/"){l=l.slice(1)}}i=u.getNavigationPath(l);r=l}var c=s.getFormContainerTitleLevel(this.title,this.titleLevel);var p=this.useFormContainerLabels&&n?u.label(n,{context:a}):"";var m=this.id?tt(r):undefined;return nt(X||(X=ut(['\n\t\t\t\t\t<macro:FormContainer\n\t\t\t\t\txmlns:macro="sap.fe.macros"\n\t\t\t\t\t','\n\t\t\t\t\ttitle="','"\n\t\t\t\t\ttitleLevel="','"\n\t\t\t\t\tcontextPath="','"\n\t\t\t\t\tmetaPath="','"\n\t\t\t\t\tdataFieldCollection="','"\n\t\t\t\t\tnavigationPath="','"\n\t\t\t\t\tvisible="','"\n\t\t\t\t\tdisplayMode="','"\n\t\t\t\t\tonChange="','"\n\t\t\t\t\tactions="','"\n\t\t\t\t>\n\t\t\t\t<macro:formElements>\n\t\t\t\t\t<slot name="formElements" />\n\t\t\t\t</macro:formElements>\n\t\t\t</macro:FormContainer>'])),this.attr("id",m),p,c,i?e.entitySet:this.contextPath,a,e.formElements,i,e.isVisible,this.displayMode,this.onChange,e.actions)};a.getFormContainers=function t(){var e=this;if(this.formContainers.length===0){return""}if(this.facetType.indexOf("com.sap.vocabularies.UI.v1.CollectionFacet")>=0){return this.formContainers.map(function(t,a){if(t.isVisible){var n=e.contextPath.getModel().createBindingContext(t.annotationPath,e.contextPath);var i=n.getObject();if(i.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&s.isReferenceFacetPartOfPreview(i,e.partOfPreview)){if(i.Target.$AnnotationPath.$Type==="com.sap.vocabularies.Communication.v1.AddressType"){return nt(V||(V=ut(['<template:with path="formContainers>','" var="formContainer">\n\t\t\t\t\t\t\t\t\t\t\t<template:with path="formContainers>','/annotationPath" var="facet">\n\t\t\t\t\t\t\t\t\t\t\t\t<core:Fragment fragmentName="sap.fe.macros.form.AddressSection" type="XML" />\n\t\t\t\t\t\t\t\t\t\t\t</template:with>\n\t\t\t\t\t\t\t\t\t\t</template:with>'])),a,a)}return e.getDataFieldCollection(t,n)}}return""})}else if(this.facetType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){return this.formContainers.map(function(t){if(t.isVisible){var a=e.contextPath.getModel().createBindingContext(t.annotationPath,e.contextPath);return e.getDataFieldCollection(t,a)}else{return""}})}return nt($||($=ut([""])))};a.getLayoutInformation=function t(){switch(this.layout.type){case"ResponsiveGridLayout":return nt(R||(R=ut(['<f:ResponsiveGridLayout adjustLabelSpan="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tbreakpointL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tbreakpointM="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tbreakpointXL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolumnsL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolumnsM="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolumnsXL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\temptySpanL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\temptySpanM="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\temptySpanS="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\temptySpanXL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabelSpanL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabelSpanM="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabelSpanS="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabelSpanXL="','"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsingleContainerFullSize="','" />'])),this.layout.adjustLabelSpan,this.layout.breakpointL,this.layout.breakpointM,this.layout.breakpointXL,this.layout.columnsL,this.layout.columnsM,this.layout.columnsXL,this.layout.emptySpanL,this.layout.emptySpanM,this.layout.emptySpanS,this.layout.emptySpanXL,this.layout.labelSpanL,this.layout.labelSpanM,this.layout.labelSpanS,this.layout.labelSpanXL,this.layout.singleContainerFullSize);case"ColumnLayout":default:return nt(N||(N=ut(['<f:ColumnLayout\n\t\t\t\t\t\t\t\tcolumnsM="','"\n\t\t\t\t\t\t\t\tcolumnsL="','"\n\t\t\t\t\t\t\t\tcolumnsXL="','"\n\t\t\t\t\t\t\t\tlabelCellsLarge="','"\n\t\t\t\t\t\t\t\temptyCellsLarge="','" />'])),this.layout.columnsM,this.layout.columnsL,this.layout.columnsXL,this.layout.labelCellsLarge,this.layout.emptyCellsLarge)}};a.getTemplate=function t(){var e=this.onChange&&this.onChange.replace("{","\\{").replace("}","\\}")||"";var a=this.metaPath.getPath();var n=this.contextPath.getPath();if(!this.isVisible){return nt(U||(U=ut([""])))}else{return nt(q||(q=ut(['<macro:FormAPI xmlns:macro="sap.fe.macros.form"\n\t\t\t\t\txmlns:macrodata="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"\n\t\t\t\t\txmlns:f="sap.ui.layout.form"\n\t\t\t\t\txmlns:fl="sap.ui.fl"\n\t\t\t\t\tid="','"\n\t\t\t\t\tmetaPath="','"\n\t\t\t\t\tcontextPath="','">\n\t\t\t\t<f:Form\n\t\t\t\t\tfl:delegate=\'{\n\t\t\t\t\t\t"name": "sap/fe/macros/form/FormDelegate",\n\t\t\t\t\t\t"delegateType": "complete"\n\t\t\t\t\t}\'\n\t\t\t\t\tid="','"\n\t\t\t\t\teditable="','"\n\t\t\t\t\tmacrodata:entitySet="{contextPath>@sapui.name}"\n\t\t\t\t\tvisible="','"\n\t\t\t\t\tclass="sapUxAPObjectPageSubSectionAlignContent"\n\t\t\t\t\tmacrodata:navigationPath="','"\n\t\t\t\t\tmacrodata:onChange="','"\n\t\t\t\t>\n\t\t\t\t\t',"\n\t\t\t\t\t<f:layout>\n\t\t\t\t\t","\n\n\t\t\t\t\t</f:layout>\n\t\t\t\t\t<f:formContainers>\n\t\t\t\t\t\t","\n\t\t\t\t\t</f:formContainers>\n\t\t\t\t</f:Form>\n\t\t\t</macro:FormAPI>"])),this._apiId,a,n,this._contentId,this._editable,this.isVisible,n,e,this.addConditionally(this.title!==undefined,nt(H||(H=ut(['<f:title>\n\t\t\t\t\t\t\t<core:Title level="','" text="','" />\n\t\t\t\t\t\t</f:title>'])),this.titleLevel,this.title)),this.getLayoutInformation(),this.getFormContainers())}};return e}(st),w=bt(S.prototype,"id",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),z=bt(S.prototype,"contextPath",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),T=bt(S.prototype,"metaPath",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),M=bt(S.prototype,"formContainers",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),O=bt(S.prototype,"useFormContainerLabels",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),I=bt(S.prototype,"partOfPreview",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),j=bt(S.prototype,"title",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),E=bt(S.prototype,"titleLevel",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),B=bt(S.prototype,"displayMode",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),k=bt(S.prototype,"isVisible",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),A=bt(S.prototype,"onChange",[C],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),_=bt(S.prototype,"formElements",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),D=bt(S.prototype,"layout",[x],{configurable:true,enumerable:true,writable:true,initializer:function(){return{type:"ColumnLayout",columnsM:2,columnsXL:6,columnsL:3,labelCellsLarge:12}}}),S))||F);Q=dt;return Q},false);
//# sourceMappingURL=FormBuildingBlock.js.map
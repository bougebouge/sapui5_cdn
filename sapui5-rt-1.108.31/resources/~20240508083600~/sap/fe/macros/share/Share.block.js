/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/ClassSupport","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/Core","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/ushell/ui/footerbar/AddBookmarkButton","./ShareAPI","sap/fe/core/jsx-runtime/jsx"],function(e,t,r,n,i,o,a,u,l,s,c,f,v,d,m,p){"use strict";var b,h,g,y,S,A,M,I,_,w,B,P,O;var z={};var E=i.defineReference;var T=t.defineBuildingBlock;var C=t.BuildingBlockBase;var x=t.blockAttribute;function j(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=N(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function(){};return{s:i,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,u;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){a=true;u=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(a)throw u}}}}function N(e,t){if(!e)return;if(typeof e==="string")return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}function k(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function D(e,t,r,n){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function R(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function L(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;F(e,t)}function F(e,t){F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return F(e,t)}function H(e,t,r,n,i){var o={};Object.keys(n).forEach(function(e){o[e]=n[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o);if(i&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(i):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function U(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var J=(b=T({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",isRuntime:true}),h=x({type:"string",required:true,isPublic:true}),g=x({type:"boolean",defaultValue:true,isPublic:true,bindable:true}),y=E(),S=E(),A=E(),b(M=(I=function(t){L(i,t);function i(){var e;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}e=t.call.apply(t,[this].concat(n))||this;D(e,"id",_,R(e));D(e,"visible",w,R(e));D(e,"menuButton",B,R(e));D(e,"menu",P,R(e));D(e,"saveAsTileMenuItem",O,R(e));return e}z=i;var b=i.prototype;b._initializeMenuItems=function e(t,r){try{var n=this;return Promise.resolve(l.isTeamsModeActive()).then(function(e){if(e){var i,o;(i=n.menuButton.current)===null||i===void 0?void 0:i.unbindProperty("visible",true);(o=n.menuButton.current)===null||o===void 0?void 0:o.setVisible(false);return}var a=t.getController();var l=c.getLibraryResourceBundle("sap.fe.core");var s=r.getShellServices();return Promise.resolve(s.waitForPluginsLoad()).then(function(e){if(!e){var t;var r=(t=n.menuButton.current)===null||t===void 0?void 0:t.getAggregation("_control");r===null||r===void 0?void 0:r.attachEventOnce("press",{},function(){return n._initializeMenuItems},n)}if(n.menu.current){n.menu.current.addItem(p(u,{text:l.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:function(){return a.share._triggerEmail()}}));n._addShellBasedMenuItems(a,s,l)}})})}catch(e){return Promise.reject(e)}};b._addShellBasedMenuItems=function e(t,r,n){try{var i,o;var a=this;var l=r.hasUShell();var c=!!((i=(o=r.getUser()).isJamActive)!==null&&i!==void 0&&i.call(o));return Promise.resolve(s.getServiceAsync()).then(function(e){var r=e.getOptions();if(l){if(c){var i,o;a===null||a===void 0?void 0:(i=a.menu)===null||i===void 0?void 0:(o=i.current)===null||o===void 0?void 0:o.addItem(p(u,{text:n.getText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:function(){return t.share._triggerShareToJam()}}))}var s=j(r),m;try{var b=function(){var e,t,r;var n=m.value;var i={text:n.text,icon:n.icon,items:[]};if(n!==null&&n!==void 0&&n.subOptions&&(n===null||n===void 0?void 0:(e=n.subOptions)===null||e===void 0?void 0:e.length)>0){i.items=[];n.subOptions.forEach(function(e){var t=new u({text:e.text,icon:e.icon,press:a.collaborationMenuItemPress,customData:new f({key:"collaborationData",value:e})});if(e.fesrStepName){v.setSemanticStepname(t,"press",e.fesrStepName)}i.items.push(t)})}else{i.press=a.collaborationMenuItemPress;i["customData"]=new f({key:"collaborationData",value:n})}var o=new u(i);if(i.press&&n.fesrStepName){v.setSemanticStepname(o,"press",n.fesrStepName)}a===null||a===void 0?void 0:(t=a.menu)===null||t===void 0?void 0:(r=t.current)===null||r===void 0?void 0:r.addItem(o)};for(s.s();!(m=s.n()).done;){b()}}catch(e){s.e(e)}finally{s.f()}var h=new d;if(h.getEnabled()){var g,y;a===null||a===void 0?void 0:(g=a.menu)===null||g===void 0?void 0:(y=g.current)===null||y===void 0?void 0:y.addItem(p(u,{ref:a.saveAsTileMenuItem,text:h.getText(),icon:h.getIcon(),press:function(){return t.share._saveAsTile(a.saveAsTileMenuItem.current)},children:{dependents:[h]}}))}else{h.destroy()}}})}catch(e){return Promise.reject(e)}};b.collaborationMenuItemPress=function e(t){try{var n=t.getSource();return Promise.resolve(s.getServiceAsync()).then(function(e){var t=r.getTargetView(n);var i=t.getController();return Promise.resolve(i.share._adaptShareMetadata()).then(function(){var r=t.getModel("collaborationInfo").getData();e.share(n.data("collaborationData"),r)})})}catch(e){return Promise.reject(e)}};b.render=function t(r,i){var u=this;var l=p(m,{id:this.id,children:p(a,{ref:this.menuButton,icon:"sap-icon://action",visible:this.visible,tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:p(o,{ref:this.menu})})});r.addDependent(p(n,{visible:this.visible,enabled:this.visible,command:"Share",execute:function(){var e;return(e=u.menuButton.current)===null||e===void 0?void 0:e.getMenu().openBy(u.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(r,i).catch(function(t){e.error(t)});return l};return i}(C),_=H(I.prototype,"id",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),w=H(I.prototype,"visible",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=H(I.prototype,"menuButton",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),P=H(I.prototype,"menu",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),O=H(I.prototype,"saveAsTileMenuItem",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),I))||M);z=J;return z},false);
//# sourceMappingURL=Share.block.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/templating/FilterHelper","sap/ui/core/format/NumberFormat","sap/ui/mdc/condition/Condition","sap/ui/model/odata/type/DateTimeOffset"],function(e,t,r,a,n){"use strict";var i=t.getTypeCompliantValue;var o=t.getRangeProperty;var s={applyMedianScaleToChartData:function(e,t,r,a){var n=[];var i=e.data("measure");var o=t.getBindingContext("internal");var s=e.getPoints&&e.getPoints()||e.getBars&&e.getBars()||e.getSegments&&e.getSegments();for(var l=0;l<s.length;l++){n.push(s[l].getBindingContext().getObject())}var c=this._getMedianScaleFactor(n,i);if(c&&c.iShortRefNumber&&c.scale){o.setProperty("scalefactor/".concat(a),c.scale);o.setProperty("scalefactorNumber/".concat(a),c.iShortRefNumber)}else{o.setProperty("scalefactor/".concat(a),"");o.setProperty("scalefactorNumber/".concat(a),"");var u=t.byId("".concat(r,"::ScaleUoMTitle"));var f=t.byId("".concat(r,"::MeasureDimensionTitle"));var g=u.getText();if(g===" | "){u.setVisible(false);f.setTooltip(f.getText())}}},_getMedianScaleFactor:function(e,t){var a;var n;e.sort(function(e,r){if(Number(e[t])<Number(r[t])){return-1}if(Number(e[t])>Number(r[t])){return 1}return 0});if(e.length>0){var i=e.length/2,o=i%1===0?(parseFloat(e[i-1][t])+parseFloat(e[i][t]))/2:parseFloat(e[Math.floor(i)][t]),s=o;for(a=0;a<14;a++){n=Math.pow(10,a);if(Math.round(Math.abs(s)/n)<10){break}}}var l=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:n});for(a=0;a<e.length;a++){var c=e[a],u=l.format(c[t]),f=u.split(".");if(!f[1]&&parseInt(f[0],10)===0||f[1]&&parseInt(f[0],10)===0&&f[1].indexOf("0")===0||u/1e3>=1e3){n=undefined;break}}return{iShortRefNumber:n,scale:n?l.getScale():""}},getFormattedNumber:function(e,t,a,n){var i;e=typeof e==="string"?Number(e.replace(/,/g,"")):e;if(n){var o=r.getCurrencyInstance({showMeasure:false});return o.format(parseFloat(e),n)}else if(t){i=r.getFloatInstance({style:"short",showScale:false,shortRefNumber:t,shortDecimals:a});return i.format(parseFloat(e))}else{i=r.getFloatInstance({decimals:a});return i.format(parseFloat(e))}},applyUOMToTitle:function(e,t,r,a){var n=e.data("uom");var i;var o;if(n&&n["ISOCurrency"]){i=n["ISOCurrency"];o=i.$Path?t[i.$Path]:i}else if(n&&n["Unit"]){i=n["Unit"]}if(i){var s=i.$Path?t[i.$Path]:i;var l=r.getBindingContext("internal");l.setProperty("uom/".concat(a),s);if(o){l.setProperty("currency/".concat(a),s)}}},updateChartScaleFactorTitle:function(e,t,a,n){if(!e.data("scalefactor")){this.applyMedianScaleToChartData(e,t,a,n)}else{var i=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:e.data("scalefactor")});var o=t.getBindingContext("internal");o.setProperty("scalefactor/".concat(n),i.getScale())}},applyErrorMessageAndTitle:function(e,t,r,a){var n=a.getBindingContext("internal");n.setProperty(r,{});n.setProperty(r,{errorMessageTitle:e,errorMessage:t,showError:true})},checkMulitUnit:function(e,t){var r=[];if(e&&t){for(var a=0;a<e.length;a++){var n=e[a]&&e[a].getObject();r.push(n[t])}}return!!r.reduce(function(e,t){return e===t?e:NaN})},setMultiUOMMessage:function(t,r,a,n,i){var o=r.data("uom");var s=o&&o["ISOCurrency"]&&o["ISOCurrency"].$Path;var l=o&&o["Unit"]&&o["Unit"].$Path;var c=s||l;var u,f;if(c){if(!this.checkMulitUnit(t,c)){if(s){u=n.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=n.getText("M_VISUAL_FILTERS_MULTIPLE_CURRENCY",c);this.applyErrorMessageAndTitle(u,f,a,i);e.warning("Filter is set for multiple Currency for".concat(c))}else if(l){u=n.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=n.getText("M_VISUAL_FILTERS_MULTIPLE_UNIT",c);this.applyErrorMessageAndTitle(u,f,a,i);e.warning("Filter is set for multiple UOMs for".concat(c))}}}},setNoDataMessage:function(e,t,r){var a=t.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");var n=t.getText("M_VISUAL_FILTER_NO_DATA_TEXT");this.applyErrorMessageAndTitle(a,n,e,r)},convertFilterCondions:function(e){var t={};Object.keys(e).forEach(function(r){var n=[];var i=e[r];for(var o=0;o<i.length;o++){var s=i[o].value2?[i[o].value1,i[o].value2]:[i[o].value1];n.push(a.createCondition(i[o].operator,s,null,null,"Validated"))}if(n.length){t[r]=n}});return t},getCustomConditions:function(e,t,r){var a,n;if(t.$Type==="Edm.DateTimeOffset"){a=this._parseDateTime(i(this._formatDateTime(e.Low),t.$Type));n=e.High?this._parseDateTime(i(this._formatDateTime(e.High),t.$Type)):null}else{a=e.Low;n=e.High?e.High:null}return{operator:e.Option?o(e.Option.$EnumMember||e.Option):null,value1:a,value2:n,path:r}},_parseDateTime:function(e){return this._getDateTimeTypeInstance().parseValue(e,"string")},_formatDateTime:function(e){return this._getDateTimeTypeInstance().formatValue(e,"string")},_getDateTimeTypeInstance:function(){return new n({pattern:"yyyy-MM-ddTHH:mm:ssZ",calendarType:"Gregorian"},{V4:true})}};return s},false);
//# sourceMappingURL=VisualFilterUtils.js.map
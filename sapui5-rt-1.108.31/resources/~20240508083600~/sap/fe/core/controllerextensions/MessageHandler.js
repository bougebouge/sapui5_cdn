/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/ClassSupport","sap/ui/core/Core","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution"],function(e,t,r,s,o,i){"use strict";var a,n,g,c,u,l,p,f,v,d;var M=r.publicExtension;var h=r.privateExtension;var y=r.finalExtension;var m=r.extensible;var b=r.defineUI5Class;function w(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;O(e,t)}function O(e,t){O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return O(e,t)}function P(e,t,r,s,o){var i={};Object.keys(s).forEach(function(e){i[e]=s[e]});i.enumerable=!!i.enumerable;i.configurable=!!i.configurable;if("value"in i||i.initializer){i.writable=true}i=r.slice().reverse().reduce(function(r,s){return s(e,t,r)||r},i);if(o&&i.initializer!==void 0){i.value=i.initializer?i.initializer.call(o):void 0;i.initializer=undefined}if(i.initializer===void 0){Object.defineProperty(e,t,i);i=null}return i}var D=(a=b("sap.fe.core.controllerextensions.MessageHandler"),n=h(),g=m(i.Instead),c=M(),u=y(),l=M(),p=M(),f=y(),a(v=(d=function(r){w(o,r);function o(){return r.apply(this,arguments)||this}var i=o.prototype;i.getShowBoundMessagesInMessageDialog=function e(){return true};i.showMessageDialog=function e(r){var s=r&&r.customMessages?r.customMessages:undefined,o=this.base.getView().getBindingContext("internal");if(r&&r.isActionParameterDialogOpen&&o){o.setProperty("isActionParameterDialogOpen",true)}var i=this.getShowBoundMessagesInMessageDialog();var a=r&&r.context?r.context:this.getView().getBindingContext();if(o){o.setProperty("isActionParameterDialogOpen",false)}return new Promise(function(e,o){setTimeout(function(){t.showUnboundMessages(s,a,i,r===null||r===void 0?void 0:r.concurrentEditFlag,false,r===null||r===void 0?void 0:r.onBeforeShowMessage).then(e).catch(o)},0)})};i.removeTransitionMessages=function e(r,s,o){if(!r){t.removeBoundTransitionMessages(o)}if(!s){t.removeUnboundTransitionMessages()}};i._checkNavigationToMessagePage=function r(s){var o=t.getMessages();var i=this.getShowBoundMessagesInMessageDialog();var a=i?t.getMessages(true,true):[];var n=s&&s.customMessages?s.customMessages:[];var g=e.isStickyEditMode(this.base.getView());var c;if(s&&s.isDataReceivedError){c={title:s.title,description:s.description,navigateBackToOrigin:true}}else if(!g&&!a.length&&!n.length&&(o.length===1||s&&s.isInitialLoad503Error)){var u=o[0],l=u.getTechnicalDetails();var p;if(l&&l.httpStatus===503){if(l.retryAfter){var f=this._getSecondsBeforeRetryAfter(l.retryAfter);if(f>120){p=t.getRetryAfterMessage(u);c={description:p?"".concat(p," ").concat(u.getMessage()):u.getMessage(),navigateBackToOrigin:true}}}else{p=t.getRetryAfterMessage(u);c={description:p?"".concat(p," ").concat(u.getMessage()):u.getMessage(),navigateBackToOrigin:true}}}}return c};i._getSecondsBeforeRetryAfter=function e(t){var r=new Date,s=r.getTime(),o=t.getTime(),i=(o-s)/1e3;return i};i.showMessages=function t(r){try{var o=this;var i=e.getAppComponent(o.getView());var a;if(!i._isFclEnabled()){a=o._checkNavigationToMessagePage(r)}if(a){if(r&&r.messagePageNavigationCallback){r.messagePageNavigationCallback()}a.handleShellBack=!(r&&r.shellBack);o.removeTransitionMessages();var n=s.getLibraryResourceBundle("sap.fe.core");if(o.base._routing){return Promise.resolve(new Promise(function(e,t){setTimeout(function(){o.base._routing.navigateToMessagePage(r&&r.isDataReceivedError?n.getText("C_COMMON_SAPFE_DATA_RECEIVED_ERROR"):n.getText("C_MESSAGE_HANDLING_SAPFE_503_TITLE"),a).then(e).catch(t)},0)}))}}else{return Promise.resolve(o.showMessageDialog(r))}return Promise.resolve()}catch(e){return Promise.reject(e)}};return o}(o),P(d.prototype,"getShowBoundMessagesInMessageDialog",[n,g],Object.getOwnPropertyDescriptor(d.prototype,"getShowBoundMessagesInMessageDialog"),d.prototype),P(d.prototype,"showMessageDialog",[c,u],Object.getOwnPropertyDescriptor(d.prototype,"showMessageDialog"),d.prototype),P(d.prototype,"removeTransitionMessages",[l],Object.getOwnPropertyDescriptor(d.prototype,"removeTransitionMessages"),d.prototype),P(d.prototype,"showMessages",[p,f],Object.getOwnPropertyDescriptor(d.prototype,"showMessages"),d.prototype),d))||v);return D},false);
//# sourceMappingURL=MessageHandler.js.map
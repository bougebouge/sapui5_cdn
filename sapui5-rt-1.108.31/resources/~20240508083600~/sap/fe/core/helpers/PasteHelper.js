/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/util/PasteHelper"],function(e,t,r,n){"use strict";function o(e,t,r){t=a(t);if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function a(e){var t=i(e,"string");return typeof t==="symbol"?t:String(t)}function i(e,t){if(typeof e!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if(typeof n!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function u(e){return c(e)||l(e)||f(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){if(!e)return;if(typeof e==="string")return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,t)}function l(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function c(e){if(Array.isArray(e))return g(e)}function g(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}var p=function(e,t,r,n){var o=r.getProperty(e),a={parseKeepsEmptyString:true},i=n.getUI5Type("".concat(t,"/").concat(e),a),u=!o||r.getProperty("".concat(e,"@Org.OData.Core.V1.Computed"));return{property:e,ignore:u,type:i}};var E=function(e){var n=u(e);var o=r.getLibraryResourceBundle("sap.fe.core"),a=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_CORRECTION_MESSAGE"),i=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_CORRECTION_NOTE");var s;if(n.length>1){s=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_MESSAGE_PLURAL",[n.length])}else{s=o.getText("C_PASTE_HELPER_SAPFE_PASTE_ERROR_MESSAGE_SINGULAR")}n.unshift("");n.unshift(i);n.unshift(a);t.error(s,{title:o.getText("C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR"),details:n.join("<br>")})};var v={displayErrorMessages:E,formatCustomMessage:function(e,t){var n="";var o=e.length;var a=r.getLibraryResourceBundle("sap.fe.core"),i=a.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW");if(o>0){n+="".concat(i," ").concat(t,": ");e.forEach(function(e,t){if(e.messageText){n+=e.messageText+(t+1!==o?" ":"")}})}return n},getColumnInfo:function(e){var t=this;var r=e.getRowBinding().getModel(),n=r.getMetaModel(),a=r.resolve(e.getRowBinding().getPath(),e.getRowBinding().getContext()),i=n.getMetaContext(a);return e.getControlDelegate().fetchProperties(e).then(function(r){var s=Object.assign.apply(Object,[{}].concat(u(r.map(function(e){return o({},e.name,e)}))));var f=[];e.getColumns().forEach(function(e){var r=s[e.getDataProperty()];if(r.propertyInfos){r.propertyInfos.forEach(function(e){var r=s[e];if(r.exportSettings!==null){if(r&&r.path.indexOf("@com.sap.vocabularies.UI.v1.DataPoint")>-1||e.indexOf("/")>-1){f.push({property:r.path,ignore:true})}else{f.push(t.getInfoForEntityProperty(r.path,a,i,n))}}})}else if(r.exportSettings!==null){if(r.path){f.push(t.getInfoForEntityProperty(r.path,a,i,n))}else{f.push({property:"unused",type:null,ignore:true})}}});return f})},getInfoForEntityProperty:p,parsePastedData:function(e,t){var r=this;return this.getColumnInfo(t).then(function(t){var r=e.length?e[0].length:0;var o=-1;for(var a=0;a<t.length&&o<0;a++){if(!t[a].ignore){o=a}}return o<0||o>r-1?Promise.resolve({}):n.parse(e,t)}).then(function(e){if(e.errors){var t=e.errors.map(function(e){return e.message});r.displayErrorMessages(t);return[]}else{return e.parsedData?e.parsedData:[]}})},pasteData:function(t,r,n){var o=this;var a=n._editFlow;var i=r.getParent().getTableDefinition();var u=[];return this.parsePastedData(t,r).then(function(e){u=e||[];return Promise.all(u.map(function(e){var t;return a.getTransactionHelper().validateDocument(r.getBindingContext(),{data:e,customValidationFunction:i===null||i===void 0?void 0:(t=i.control)===null||t===void 0?void 0:t.customValidationFunction},n.getView())}))}).then(function(e){var t=e.reduce(function(e,t,r){if(t.length>0){e.push({messages:t,row:r+1})}return e},[]);if(t.length>0){var r=t.map(function(e){return o.formatCustomMessage(e.messages,e.row)});o.displayErrorMessages(r);return[]}return u}).then(function(e){var t;return e.length>0?a.createMultipleDocuments(r.getRowBinding(),e,i===null||i===void 0?void 0:(t=i.control)===null||t===void 0?void 0:t.createAtEnd,true,n.editFlow.onBeforeCreate):undefined}).catch(function(t){e.error("Error while pasting data",t)})}};return v},false);
//# sourceMappingURL=PasteHelper.js.map
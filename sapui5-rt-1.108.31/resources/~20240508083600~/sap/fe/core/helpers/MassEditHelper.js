/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/core/library","sap/fe/core/TemplateModel","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/field/FieldTemplating","sap/fe/macros/table/TableHelper","sap/m/Button","sap/m/Dialog","sap/m/MessageToast","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/ui/mdc/enum/EditMode","sap/ui/model/json/JSONModel","../controllerextensions/messageHandler/messageHandling","../controls/Any","../converters/MetaModelConverter","../templating/FieldControlHelper","../templating/UIFormatters","./SideEffectsHelper"],function(e,t,r,a,n,o,i,l,s,u,c,d,f,p,v,y,g,P,h,m,b,x,E,O,T){"use strict";var M=O.isCollectionField;var C=O.getRequiredExpression;var F=O.getEditMode;var S=E.isReadOnlyExpression;var D=x.getInvolvedDataModelObjects;var V=x.convertMetaModelContext;var B=s.setEditStyleProperties;var I=s.getTextBinding;var j=i.hasValueHelpWithFixedValues;var k=i.hasValueHelp;var A=i.hasUnit;var w=i.hasCurrency;var _=i.getAssociatedUnitPropertyPath;var H=i.getAssociatedUnitProperty;var R=o.getRelativePaths;var L=o.enhanceDataModelPath;var U=r.pathInModel;var N=r.or;var $=r.not;var G=r.ifElse;var q=r.constant;var Q=r.compileExpression;function K(e,t){return J(e)||z(e,t)||W(e,t)||X()}function X(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function z(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,o,i,l=[],s=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(a=o.call(r)).done)&&(l.push(a.value),l.length!==t);s=!0){}}catch(e){u=!0,n=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw n}}return l}}function J(e){if(Array.isArray(e))return e}function Y(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=W(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var a=0;var n=function(){};return{s:n,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,i=false,l;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){i=true;l=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(i)throw l}}}}function W(e,t){if(!e)return;if(typeof e==="string")return Z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z(e,t)}function Z(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++){a[r]=e[r]}return a}var ee={initLastLevelOfPropertyPath:function(e,t){var r;var a=0;var n=e.split("/");var o="";n.forEach(function(n){if(!t[n]&&a===0){t[n]={};r=t[n];o=o+n;a++}else if(!r[n]){o="".concat(o,"/").concat(n);if(o!==e){r[n]={};r=r[n]}else{r[n]=[]}}});return r},getUniqueValues:function(e,t,r){if(e!=undefined&&e!=null){return r.indexOf(e)===t}},getValueForMultiLevelPath:function(e,t){if(e&&e.indexOf("/")>0){var r=e.split("/");var a;r.forEach(function(e){a=t&&t[e]?t[e]:a&&a[e]});return a}},getDefaultSelectionPathComboBox:function(e,t){if(t&&e.length>0){var r=e,a=[];r.forEach(function(e){var r=e.getObject();var n=t.indexOf("/")>-1&&r.hasOwnProperty(t.split("/")[0]);if(e&&(r.hasOwnProperty(t)||n)){a.push(e.getObject(t))}});var n=a.filter(ee.getUniqueValues);if(n.length>1){return"Default/".concat(t)}else if(n.length===0){return"Empty/".concat(t)}else if(n.length===1){return"".concat(t,"/").concat(n[0])}}},getHiddenValueForContexts:function(e,t){if(e&&e.$Path){return!t.some(function(t){return t.getObject(e.$Path)===false})}return e},getInputType:function(e,t,r){var a={};var n;if(e){B(a,t,r,true);n=(a===null||a===void 0?void 0:a.editStyle)||""}var o=n&&["DatePicker","TimePicker","DateTimePicker","RatingIndicator"].indexOf(n)===-1&&!M(r)&&!j(e);return(o||"")&&n},getIsFieldGrp:function(e){return e&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target&&e.Target.value&&e.Target.value.indexOf("FieldGroup")>-1},getTextPath:function(e,t,r){var a;if(t&&(t.path||t.parameters&&t.parameters.length)&&e){if(t.path&&r==="Description"){a=t.path}else if(t.parameters){t.parameters.forEach(function(t){if(t.path&&t.path!==e){a=t.path}})}}return a},prepareDataForDialog:function(e,r,a){var n=e&&e.getModel().getMetaModel(),o=e.data("metaPath"),i=ee.getTableFields(e),l=n.getContext("".concat(o,"/@")),s=n.getContext(o),u=D(l);var c=new h;var d;var f;var p;var v;var y;var g;i.forEach(function(e){var i=e.dataProperty;if(i){var l,c,h,m,b,x,E;var O=i&&n.getObject("".concat(o,"/").concat(i,"@"));f=e.label||O&&O["@com.sap.vocabularies.Common.v1.Label"]||i;if(u){u.targetObject=u.targetEntityType.entityProperties.filter(function(e){return e.name===i})}u.targetObject=u.targetObject[0]||{};g=I(u,{},true)||{};var T=n.getContext(e.annotationPath),M=V(T),B=n.getContext("".concat(o,"/").concat(i,"@")),j=B&&B.getInterface();var U=D(T,s);if((M===null||M===void 0?void 0:(l=M.Value)===null||l===void 0?void 0:(c=l.path)===null||c===void 0?void 0:c.length)>0){U=L(U,i)}var N=ee.getHiddenValueForContexts(T&&T.getObject()["@com.sap.vocabularies.UI.v1.Hidden"],r)||false;var $=O&&O["@com.sap.vocabularies.UI.v1.IsImageURL"];j.context={getModel:function(){return j.getModel()},getPath:function(){return"".concat(o,"/").concat(i)}};O=M._type==="Property"?M:M&&M.Value&&M.Value.$target||M&&M.Target&&M.Target.$target;var G=O&&O.term&&O.term==="com.sap.vocabularies.UI.v1.Chart";var Q=!!M.Action;var K=ee.getIsFieldGrp(M);if($||N||G||Q||K){return}v=(w(O)||A(O))&&_(O)||"";var X=v&&H(O);p=k(O);y=X&&k(X);var z=(p||y)&&(((h=O)===null||h===void 0?void 0:(m=h.annotations)===null||m===void 0?void 0:(b=m.Common)===null||b===void 0?void 0:b.ValueListRelevantQualifiers)||X&&(X===null||X===void 0?void 0:(x=X.annotations)===null||x===void 0?void 0:(E=x.Common)===null||E===void 0?void 0:E.ValueListRelevantQualifiers));if(z){return}var J=O&&O.Value?O.Value:O;var Y=F(J,U,false,false,M,q(true));var W=Object.keys(P);var Z=!!Y&&W.includes(Y);var te=!!Y&&(Z&&Y===P.Editable||!Z);var re=i.includes("/")&&p;if(!te||re){return}var ae=ee.getInputType(O,M,U);if(ae){var ne=R(U);var oe=S(O,ne);var ie=t.computeDisplayMode(B.getObject());var le=p?p:false;var se=y&&!v.includes("/")?y:false;var ue=v&&!i.includes("/")?v:false;d={label:f,dataProperty:i,isValueHelpEnabled:p?p:false,unitProperty:ue,isFieldRequired:C(O,M,true,false,{},U),defaultSelectionPath:i?ee.getDefaultSelectionPathComboBox(r,i):false,defaultSelectionUnitPath:v?ee.getDefaultSelectionPathComboBox(r,v):false,entitySet:o,display:ie,descriptionPath:ee.getTextPath(i,g,ie),nullable:O.nullable!==undefined?O.nullable:true,isPropertyReadOnly:oe!==undefined?oe:false,inputType:ae,editMode:te?Y:undefined,propertyInfo:{hasVH:le,runtimePath:"fieldsInfo>/values/",relativePath:i,propertyPathForValueHelp:"".concat(o,"/").concat(i)},unitInfo:ue&&{hasVH:se,runtimePath:"fieldsInfo>/unitData/",relativePath:ue,propertyPathForValueHelp:"".concat(o,"/").concat(ue)}};a.push(d)}}});c.setData(a);return c},getTableFields:function(e){var t=e&&e.getColumns()||[];var r=e&&e.getParent().getTableDefinition().columns;return t.map(function(e){var t=e&&e.getDataProperty(),a=r&&r.filter(function(e){return e.name===t&&e.type==="Annotation"});return{dataProperty:t,label:e.getHeader(),annotationPath:a&&a[0]&&a[0].annotationPath}})},getDefaultTextsForDialog:function(e,t,r){var a=r.data("displayModePropertyBinding")==="true";return{keepExistingPrefix:"< Keep",leaveBlankValue:"< Leave Blank >",clearFieldValue:"< Clear Values >",massEditTitle:e.getText("C_MASS_EDIT_DIALOG_TITLE",t.toString()),applyButtonText:a?e.getText("C_MASS_EDIT_SAVE_BUTTON_TEXT"):e.getText("C_MASS_EDIT_APPLY_BUTTON_TEXT"),useValueHelpValue:"< Use Value Help >",cancelButtonText:e.getText("C_COMMON_OBJECT_PAGE_CANCEL"),noFields:e.getText("C_MASS_EDIT_NO_EDITABLE_FIELDS"),okButtonText:e.getText("C_COMMON_DIALOG_OK")}},setDefaultValuesToDialog:function(e,t,r,a){var n=a?r.unitProperty:r.dataProperty,o=r.inputType,i=r.isFieldRequired;var l="Values";e.defaultOptions=e.defaultOptions||[];var s=e.selectOptions&&e.selectOptions.length>0;var u={text:"".concat(t.keepExistingPrefix," ").concat(l," >"),key:"Default/".concat(n)};if(o==="CheckBox"){var c={text:"No",key:"".concat(n,"/false"),textInfo:{value:false}};var d={text:"Yes",key:"".concat(n,"/true"),textInfo:{value:true}};e.unshift(c);e.defaultOptions.unshift(c);e.unshift(d);e.defaultOptions.unshift(d);e.unshift(u);e.defaultOptions.unshift(u)}else{var f,p;if(r!==null&&r!==void 0&&(f=r.propertyInfo)!==null&&f!==void 0&&f.hasVH||r!==null&&r!==void 0&&(p=r.unitInfo)!==null&&p!==void 0&&p.hasVH&&a){var v={text:t.useValueHelpValue,key:"UseValueHelpValue/".concat(n)};e.unshift(v);e.defaultOptions.unshift(v)}if(s){if(i!=="true"&&!a){var y={text:t.clearFieldValue,key:"ClearFieldValue/".concat(n)};e.unshift(y);e.defaultOptions.unshift(y)}e.unshift(u);e.defaultOptions.unshift(u)}else{var g={text:t.leaveBlankValue,key:"Default/".concat(n)};e.unshift(g);e.defaultOptions.unshift(g)}}},getTextArrangementInfo:function(t,r,a,n){var o=n.getObject(t),i,l;if(r&&t){switch(a){case"Description":i=n.getObject(r)||"";l=i;break;case"Value":o=n.getObject(t)||"";l=o;break;case"ValueDescription":o=n.getObject(t)||"";i=n.getObject(r)||"";l=i?"".concat(o," (").concat(i,")"):o;break;case"DescriptionValue":o=n.getObject(t)||"";i=n.getObject(r)||"";l=i?"".concat(i," (").concat(o,")"):o;break;default:e.info("Display Property not applicable: ".concat(t));break}}return{textArrangement:a,valuePath:t,descriptionPath:r,value:o,description:i,fullText:l}},isEditable:function(e){var t=e.getBinding("any");var r=t.getExternalValue();return r===P.Editable},onContextEditableChange:function(e,t){var r=e.getProperty("/values/".concat(t,"/objectsForVisibility"))||[];var a=r.some(ee.isEditable);if(a){e.setProperty("/values/".concat(t,"/visible"),a)}},updateOnContextChange:function(e,t,r,a){var n=e.getBinding("any");a.objectsForVisibility=a.objectsForVisibility||[];a.objectsForVisibility.push(e);n.attachChange(ee.onContextEditableChange.bind(null,t,r))},getBoundObject:function(e,t){var r=new b({any:e});var a=t.getModel();r.setModel(a);r.setBindingContext(t);return r},getFieldVisiblity:function(e,t,r,a,n){var o=ee.getBoundObject(e,n);var i=ee.isEditable(o);if(!i){ee.updateOnContextChange(o,t,r,a)}return i},setRuntimeModelOnDialog:function(e,t,r,a){var n=[];var o=[];var i=[];var l=[];var s=[];var u={values:n,unitData:o,results:i,readablePropertyData:s,selectedKey:undefined,textPaths:l,noFields:r.noFields};var c=new h(u);t.forEach(function(t){var r;var i;var s;var u={};var c={};if(t.dataProperty&&t.dataProperty.indexOf("/")>-1){var d=ee.initLastLevelOfPropertyPath(t.dataProperty,n);var f=t.dataProperty.split("/");var p=Y(e),v;try{for(p.s();!(v=p.n()).done;){var y=v.value;var g=y.getObject(t.dataProperty);i="".concat(t.dataProperty,"/").concat(g);if(!u[i]&&d[f[f.length-1]]){r=ee.getTextArrangementInfo(t.dataProperty,t.descriptionPath,t.display,y);d[f[f.length-1]].push({text:r&&r.fullText||g,key:i,textInfo:r});u[i]=g}}}catch(e){p.e(e)}finally{p.f()}d[f[f.length-1]].textInfo={descriptionPath:t.descriptionPath,valuePath:t.dataProperty,displayMode:t.display}}else{n[t.dataProperty]=n[t.dataProperty]||[];n[t.dataProperty]["selectOptions"]=n[t.dataProperty]["selectOptions"]||[];if(t.unitProperty){o[t.unitProperty]=o[t.unitProperty]||[];o[t.unitProperty]["selectOptions"]=o[t.unitProperty]["selectOptions"]||[]}var P=Y(e),h;try{for(P.s();!(h=P.n()).done;){var m=h.value;var b=m.getObject();i="".concat(t.dataProperty,"/").concat(b[t.dataProperty]);if(t.dataProperty&&b[t.dataProperty]&&!u[i]){if(t.inputType!="CheckBox"){r=ee.getTextArrangementInfo(t.dataProperty,t.descriptionPath,t.display,m);var x={text:r&&r.fullText||b[t.dataProperty],key:i,textInfo:r};n[t.dataProperty].push(x);n[t.dataProperty]["selectOptions"].push(x)}u[i]=b[t.dataProperty]}if(t.unitProperty&&b[t.unitProperty]){s="".concat(t.unitProperty,"/").concat(b[t.unitProperty]);if(!c[s]){if(t.inputType!="CheckBox"){r=ee.getTextArrangementInfo(t.unitProperty,t.descriptionPath,t.display,m);var E={text:r&&r.fullText||b[t.unitProperty],key:s,textInfo:r};o[t.unitProperty].push(E);o[t.unitProperty]["selectOptions"].push(E)}c[s]=b[t.unitProperty]}}}}catch(e){P.e(e)}finally{P.f()}n[t.dataProperty].textInfo={descriptionPath:t.descriptionPath,valuePath:t.dataProperty,displayMode:t.display};if(Object.keys(u).length===1){a.setProperty(t.dataProperty,i&&u[i])}if(Object.keys(c).length===1){a.setProperty(t.unitProperty,s&&c[s])}}l[t.dataProperty]=t.descriptionPath?[t.descriptionPath]:[]});t.forEach(function(t){var a={};if(t.dataProperty.indexOf("/")>-1){var i=ee.getValueForMultiLevelPath(t.dataProperty,n);if(!i){i.push({text:r.leaveBlankValue,key:"Empty/".concat(t.dataProperty)})}else{ee.setDefaultValuesToDialog(i,r,t)}a=i}else if(n[t.dataProperty]){n[t.dataProperty]=n[t.dataProperty]||[];ee.setDefaultValuesToDialog(n[t.dataProperty],r,t);a=n[t.dataProperty]}if(o[t.unitProperty]&&o[t.unitProperty].length){ee.setDefaultValuesToDialog(o[t.unitProperty],r,t,true);o[t.unitProperty].textInfo={};o[t.unitProperty].selectedKey=ee.getDefaultSelectionPathComboBox(e,t.unitProperty);o[t.unitProperty].inputType=t.inputType}else if(t.dataProperty&&n[t.dataProperty]&&!n[t.dataProperty].length||t.unitProperty&&o[t.unitProperty]&&!o[t.unitProperty].length){var l=n[t.dataProperty]&&n[t.dataProperty].some(function(e){return e.text==="< Clear Values >"||e.text==="< Leave Blank >"});if(t.dataProperty&&!l){n[t.dataProperty].push({text:r.leaveBlankValue,key:"Empty/".concat(t.dataProperty)})}var u=o[t.unitProperty]&&o[t.unitProperty].some(function(e){return e.text==="< Clear Values >"||e.text==="< Leave Blank >"});if(t.unitProperty){if(!u){o[t.unitProperty].push({text:r.leaveBlankValue,key:"Empty/".concat(t.unitProperty)})}o[t.unitProperty].textInfo={};o[t.unitProperty].selectedKey=ee.getDefaultSelectionPathComboBox(e,t.unitProperty);o[t.unitProperty].inputType=t.inputType}}if(t.isPropertyReadOnly&&typeof t.isPropertyReadOnly==="boolean"){s.push({property:t.dataProperty,value:t.isPropertyReadOnly,type:"Default"})}else if(t.isPropertyReadOnly&&t.isPropertyReadOnly.operands&&t.isPropertyReadOnly.operands[0]&&t.isPropertyReadOnly.operands[0].operand1&&t.isPropertyReadOnly.operands[0].operand2){s.push({property:t.dataProperty,propertyPath:t.isPropertyReadOnly.operands[0].operand1.path,propertyValue:t.isPropertyReadOnly.operands[0].operand2.value,type:"Path"})}if(t.editMode){a.visible=t.editMode===P.Editable||e.some(ee.getFieldVisiblity.bind(ee,t.editMode,c,t.dataProperty,a))}else{a.visible=true}a.selectedKey=ee.getDefaultSelectionPathComboBox(e,t.dataProperty);a.inputType=t.inputType;a.unitProperty=t.unitProperty});return c},getDialogContext:function(e,t){var r=t&&t.getBindingContext();if(!r){var a=e.getModel();var n=e.getRowBinding();var o=a.bindList(n.getPath(),n.getContext(),[],[],{$$updateGroupId:"submitLater"});o.refreshInternal=function(){};r=o.create({},true)}return r},onDialogOpen:function(e){var t=e.getSource();var r=t.getModel("fieldsInfo");r.setProperty("/isOpen",true)},closeDialog:function(e){e.close();e.destroy()},messageHandlingForMassEdit:function(e,t,r,n,o,i){try{var l,s,u,c;var d=a.DraftStatus;var v=p.getLibraryResourceBundle("sap.fe.core");(l=r.getView())===null||l===void 0?void 0:(s=l.getBindingContext("internal"))===null||s===void 0?void 0:s.setProperty("getBoundMessagesForMassEdit",true);r._editFlow.getMessageHandler().showMessages({onBeforeShowMessage:function(a,n){n.fnGetMessageSubtitle=m.setMessageSubtitle.bind({},e,t);var l=[];a.forEach(function(e){if(!e.getTarget()){l.push(e)}});if(o.length>0&&i.length===0){r._editFlow.setDraftStatus(d.Saved);var s=v.getText("C_MASS_EDIT_SUCCESS_TOAST");f.show(s)}else if(i.length<e.getSelectedContexts().length){r._editFlow.setDraftStatus(d.Saved)}else if(i.length===e.getSelectedContexts().length){r._editFlow.setDraftStatus(d.Clear)}if(r.getModel("ui").getProperty("/isEditable")&&l.length===0){n.showMessageBox=false;n.showMessageDialog=false}return n}});if(n.isOpen()){var y,g;ee.closeDialog(n);(y=r.getView())===null||y===void 0?void 0:(g=y.getBindingContext("internal"))===null||g===void 0?void 0:g.setProperty("skipPatchHandlers",false)}(u=r.getView())===null||u===void 0?void 0:(c=u.getBindingContext("internal"))===null||c===void 0?void 0:c.setProperty("getBoundMessagesForMassEdit",false);return Promise.resolve()}catch(e){return Promise.reject(e)}},getSideEffectDataForKey:function(e,t,r,a){var n=e.getProperty("$Type");var o={};a.forEach(function(e){var a=e.keyValue;var i=l.getSideEffectsOnEntityAndProperty(a,n,t);o[a]=r._sideEffects.generateSideEffectsMapFromSideEffectId(i)});return o},fnGetPathForSourceProperty:function(e,t,r){var a=e.indexOf("/")>0?"/"+t+"/"+e.substr(0,e.lastIndexOf("/")+1)+"@sapui.name":false,n=!a?Promise.resolve(t):r.requestObject(a);e=a?e.substr(e.lastIndexOf("/")+1):e;return{sPath:e,pOwnerEntity:n,sNavigationPath:a}},fnGetEntityTypeOfOwner:function(e,t,r,a,n){var o=r.getProperty("$Type");var i=e.getObject("".concat(r,"/").concat(t)),l=i["$Type"],s=i["$Partner"];if(s){var u=e.getObject("/".concat(l,"/").concat(s));if(u){var c=u["$Type"];if(c!==o){n.push(a)}}}else{n.push(a)}return n},fnGetTargetsForMassEdit:function(e,t,r,a){var n=e.TargetProperties,o=e.TargetEntities;var i=[];var l=[];var s=t.getProperty("$Type");if(r===s){o===null||o===void 0?void 0:o.forEach(function(e){e=e["$NavigationPropertyPath"];var r;if(e.includes("/")){r=e.split("/")[0]}else{r=e}l=ee.fnGetEntityTypeOfOwner(a,r,t,e,l)})}if(n.length){n.forEach(function(e){var n=ee.fnGetPathForSourceProperty(e,r,a),o=n.pOwnerEntity;i.push(o.then(function(r){if(r===s){l.push(e)}else if(e.includes("/")){var n=e.split("/")[0];l=ee.fnGetEntityTypeOfOwner(a,n,t,e,l)}return Promise.resolve(l)}))})}else{i.push(Promise.resolve(l))}return Promise.all(i)},handleMassEditFieldUpdateAndRequestSideEffects:function(e){try{var r=function(){var r=e.oController,a=e.oFieldPromise,n=e.sideEffectsMap,o=e.textPaths,i=e.groupId,l=e.key,s=e.oEntitySetContext,c=e.oMetaModel,d=e.oSelectedContext,f=e.deferredTargetsForAQualifiedName;var p=[a];var v=s.getProperty("$Type");var y=t.getAppComponent(r.getView());var g=y.getSideEffectsService();if(n){var P=Object.keys(n);var h=Object.values(n);var m={};f[l]={};var b=Y(h.entries()),x;try{var E=function(){var e=K(x.value,2),t=e[0],a=e[1];var n=P[t];var o=n.split("#")[0];var y=r._sideEffects.getContextForSideEffects(d,o);a.context=y;var g=r._sideEffects.getRegisteredFailedRequests();var h=g[y.getPath()];r._sideEffects.deleteFailedRequestsForAContext(y);var b=[a.sideEffects];b=h&&h.length?b.concat(h):b;m[y]={};var E=Y(b),O;try{for(E.s();!(O=E.n()).done;){var T=O.value;if(!m[y].hasOwnProperty(T.fullyQualifiedName)){(function(){m[y][T.fullyQualifiedName]=true;var e=[],t=[],a=void 0;var n=function(r){try{var n=r.TargetProperties,o=r.TargetEntities;var i=r.fullyQualifiedName.split("@")[0];return Promise.resolve(ee.fnGetTargetsForMassEdit(r,s,i,c)).then(function(s){e=s[0];t=(n||[]).concat(o||[]);var d=r.TriggerAction;var p=t.filter(function(t){return!e.includes(t)});f[l][r.fullyQualifiedName]={aTargets:p,oContext:y,mSideEffect:r};if(d&&i===v){var g=u._isStaticAction(c.getObject("/".concat(d)),d);if(!g){a=d}else{f[l][r.fullyQualifiedName]["TriggerAction"]=d}}else{f[l][r.fullyQualifiedName]["TriggerAction"]=d}return{aTargets:e,TriggerAction:a}})}catch(e){return Promise.reject(e)}};p.push(r._sideEffects.requestSideEffects(T,y,i,n))})()}}}catch(e){E.e(e)}finally{E.f()}};for(b.s();!(x=b.n()).done;){E()}}catch(e){b.e(e)}finally{b.f()}}if(o!==null&&o!==void 0&&o[l]&&o[l].length){p.push(g.requestSideEffects(o[l],d,i))}return{v:Promise.resolve(Promise.allSettled(p))}}();if(typeof r==="object")return r.v}catch(e){return Promise.reject(e)}},createDialog:function(t,r,a){try{var o="sap/fe/core/controls/massEdit/MassEditDialog",i=[],l=p.getLibraryResourceBundle("sap.fe.core"),s=ee.getDefaultTextsForDialog(l,r.length,t),u=ee.prepareDataForDialog(t,r,i),f=ee.getDialogContext(t),P=ee.setRuntimeModelOnDialog(r,i,s,f),h=t.getModel(),b=h.getMetaModel(),x=new n(u.getData(),b);var E=g.loadTemplate(o,"fragment");return Promise.resolve(Promise.resolve(y.process(E,{name:o},{bindingContexts:{dataFieldModel:x.createBindingContext("/"),metaModel:b.createBindingContext("/")},models:{dataFieldModel:x,metaModel:b}}))).then(function(n){return Promise.resolve(v.load({definition:n})).then(function(n){var o=new d({resizable:true,title:s.massEditTitle,content:[n],afterOpen:ee.onDialogOpen,beginButton:new c({text:ee.helpers.getExpBindingForApplyButtonTxt(s,u.getObject("/")),type:"Emphasized",press:function(n){try{var i,l;m.removeBoundTransitionMessages();m.removeUnboundTransitionMessages();(i=a.getView())===null||i===void 0?void 0:(l=i.getBindingContext("internal"))===null||l===void 0?void 0:l.setProperty("skipPatchHandlers",true);var s=n.getSource().getParent();var u=s.getModel("fieldsInfo");var c=u.getProperty("/results");var d=t&&t.getModel().getMetaModel(),f=t.data("metaPath"),p=d.getContext(f);return Promise.resolve(T.generateSideEffectsMapFromMetaModel(d)).then(function(n){var i=[];var l=u.getProperty("/textPaths");var f=u.getProperty("/readablePropertyData");var v;var y;var g=[];var P={};var h=r.length;var m={};var b=ee.getSideEffectDataForKey(p,n,a,c);r.forEach(function(t,r){y=[];c.forEach(function(n){try{if(!P.hasOwnProperty(n.keyValue)){P[n.keyValue]=0}if(b[n.keyValue]){y[n.keyValue]=b[n.keyValue]}if(f){f.some(function(e){if(n.keyValue===e.property){if(e.type==="Default"){return e.value===true}else if(e.type==="Path"&&e.propertyValue&&e.propertyPath){return t.getObject(e.propertyPath)===e.propertyValue}}})}v="$auto.".concat(r);var o=t.setProperty(n.keyValue,n.value,v).catch(function(r){i.push(t.getObject());e.error("Mass Edit: Something went wrong in updating entries.",r);P[n.keyValue]=P[n.keyValue]+1;return Promise.reject({isFieldUpdateFailed:true})});var s={oController:a,oFieldPromise:o,sideEffectsMap:b[n.keyValue],textPaths:l,groupId:v,key:n.keyValue,oEntitySetContext:p,oMetaModel:d,oSelectedContext:t,deferredTargetsForAQualifiedName:m};g.push(ee.handleMassEditFieldUpdateAndRequestSideEffects(s));return Promise.resolve()}catch(e){return Promise.reject(e)}})});return Promise.resolve(Promise.allSettled(g).then(function(){try{v="$auto.massEditDeferred";var e=[];var t=Object.values(m);var r=Object.keys(m);t.forEach(function(t,n){var o=r[n];if(P[o]!==h){var i=Object.values(t);i.forEach(function(t){var r=t.aTargets,n=t.oContext,o=t.TriggerAction,i=t.mSideEffect;var l=function(){return r};var s=function(){return{aTargets:l(),TriggerAction:o}};e.push(a._sideEffects.requestSideEffects(i,n,v,s))})}});return Promise.resolve()}catch(e){return Promise.reject(e)}}).then(function(){ee.messageHandlingForMassEdit(t,r,a,s,c,i)}).catch(function(e){ee.closeDialog(o);return Promise.reject(e)})).then(function(){})})}catch(e){return Promise.reject(e)}}}),endButton:new c({text:s.cancelButtonText,visible:ee.helpers.hasEditableFieldsBinding(u.getObject("/"),true),press:function(e){var t=e.getSource().getParent();ee.closeDialog(t)}})});o.setModel(P,"fieldsInfo");o.setModel(h);o.setBindingContext(f);return o})})}catch(e){return Promise.reject(e)}},helpers:{getBindingExpForHasEditableFields:function(e,t){var r=e.reduce(function(e,t){return N(e,U("/values/"+t.dataProperty+"/visible","fieldsInfo"))},q(false));return t?r:$(r)},getExpBindingForApplyButtonTxt:function(e,t){var r=ee.helpers.getBindingExpForHasEditableFields(t,true);var a=G(r,q(e.applyButtonText),q(e.okButtonText));return Q(a)},hasEditableFieldsBinding:function(e,t){return Q(ee.helpers.getBindingExpForHasEditableFields(e,t))}}};return ee},false);
//# sourceMappingURL=MassEditHelper.js.map
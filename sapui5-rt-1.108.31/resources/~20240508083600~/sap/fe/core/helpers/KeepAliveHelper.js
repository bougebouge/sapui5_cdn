/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/KeepAliveRefreshTypes","./ModelHelper"],function(e,t,r){"use strict";var n=t.RefreshStrategyType;var a=t.PATH_TO_STORE;var o=function(e,t){var n=r.getEntitySetPath(t);var a=n.indexOf("$NavigationPropertyBinding")>-1&&e.getObject(n);return a?"/".concat(a):t};var i=function(e,t,r){return e===t||r===n.IncludingDependents&&e.startsWith(t)};var s=function(e,t,r,n){var a=t.startsWith("/")?t:"/".concat(t),s=r.startsWith("/")?r:"/".concat(r);if(!i(a,s,n)){a=o(e,a);if(!i(a,s,n)){s=o(e,s)}else{return true}}return i(a,s,n)};var v=function(e,t){var r=[];var n=e.getModel().getMetaModel();var o=e.getModel("internal");var i=o.getProperty(a)||{};if(t){t.forEach(function(e){var t=e.data("targetCollectionPath");for(var a in i){var o=i[a];if(r.indexOf(e)===-1&&s(n,t,a,o)){r.push(e)}}})}return r};var f=function(e,t){var r=e.getModel().getMetaModel();var n=e.getModel("internal");var o=n.getProperty(a)||{};var i;if(t){for(var v in o){var f=o[v];if(s(r,t,v,f)){i=f;if(i==="includingDependents"){break}}}}return i};var c=function(e){var t=e.getViewData(),r=t&&((t===null||t===void 0?void 0:t.contextPath)||"/".concat(t===null||t===void 0?void 0:t.entitySet));return d.getControlRefreshStrategyForContextPath(e,r)};var l=function(e,t,r){var n=t&&r&&"".concat(t,"-").concat(r);var a=e.intents;var o=a&&n&&a[n];var i=!o&&a&&t&&a[t];return o||i||(e===null||e===void 0?void 0:e.defaultBehavior)||(e===null||e===void 0?void 0:e._feDefault)};var u=function(e,t){if(e&&e.getModel("viewData")&&e.getModel("internal")){var r=e.getModel("viewData");var n=r.getProperty(a);if(n){var o=e.getModel("internal");var i=d.getRefreshStrategyForIntent(n,t===null||t===void 0?void 0:t.semanticObject,t===null||t===void 0?void 0:t.action);o.setProperty(a,i)}}};var g=function(t){var r=t.getBindingContext("internal");var n=t.getController();var a=n===null||n===void 0?void 0:n.viewState;var o=Promise.resolve();if(r&&r.getProperty("restoreStatus")==="pending"){if(a.refreshViewBindings){o=a.refreshViewBindings();o.then(function(){e.info("FE V4: Refresh was triggered successfull: ".concat(t.getId()))}).catch(function(r){e.warning("FE V4: Refresh was unsuccessfull: ".concat(t.getId()),r)})}o=o.then(function(){a.onRestore();r.setProperty("restoreStatus","done")}).catch(function(r){e.warning("FE V4: Restore was unsuccessfull: ".concat(t.getId()),r)})}return o};var d={getControlsForRefresh:v,getControlRefreshStrategyForContextPath:f,getViewRefreshInfo:c,getRefreshStrategyForIntent:l,storeControlRefreshStrategyForHash:u,restoreView:g};return d},false);
//# sourceMappingURL=KeepAliveHelper.js.map
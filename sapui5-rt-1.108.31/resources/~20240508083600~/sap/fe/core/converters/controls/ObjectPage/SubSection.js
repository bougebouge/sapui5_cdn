/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/PropertyHelper","../../helpers/ConfigurableObject","../../helpers/ID","../../ManifestSettings","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,n,a,i,r,o,l,u,c,s,v,d){"use strict";var f={};var p=d.isReferenceFacet;var m=d.createFormDefinition;var b=v.getDataVisualizationConfiguration;var g=s.getVisibilityEnablementFormMenuActions;var y=s.getFormHiddenActions;var I=s.getFormActions;var h=c.ActionType;var F=u.getSubSectionID;var S=u.getSideContentID;var A=u.getFormID;var U=u.getCustomSubSectionID;var O=l.Placement;var D=l.insertCustomElements;var T=o.isPathExpression;var C=r.ref;var w=r.pathInModel;var E=r.not;var P=r.ifElse;var k=r.getExpressionFromAnnotation;var M=r.fn;var j=r.equal;var L=r.compileExpression;var x=r.and;var N=i.KeyHelper;var R=a.IssueType;var $=a.IssueSeverity;var V=a.IssueCategory;var H=n.getStashedSettingsForHeaderFacet;var B=n.getHeaderFacetsFromManifest;var _=n.getDesignTimeMetadataSettingsForHeaderFacet;var z=t.removeDuplicateActions;var G=t.isActionNavigable;var q=t.getSemanticObjectMapping;var X=t.getEnabledForAnnotationAction;var K=t.getActionsFromManifest;var Q=t.ButtonType;function W(e,t){return Z(e)||Y(e,t)||ue(e,t)||J()}function J(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Y(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r,o,l=[],u=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(a=r.call(n)).done)&&(l.push(a.value),l.length!==t);u=!0){}}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return l}}function Z(e){if(Array.isArray(e))return e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach(function(t){ne(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ne(e,t,n){t=ae(t);if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function ae(e){var t=ie(e,"string");return typeof t==="symbol"?t:String(t)}function ie(e,t){if(typeof e!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var a=n.call(e,t||"default");if(typeof a!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function re(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ue(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var a=0;var i=function(){};return{s:i,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,l;return{s:function(){n=n.call(e)},n:function(){var e=n.next();r=e.done;return e},e:function(e){o=true;l=e},f:function(){try{if(!r&&n.return!=null)n.return()}finally{if(o)throw l}}}}function oe(e){return se(e)||ce(e)||ue(e)||le()}function le(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ue(e,t){if(!e)return;if(typeof e==="string")return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ve(e,t)}function ce(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function se(e){if(Array.isArray(e))return ve(e)}function ve(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++){a[n]=e[n]}return a}var de;(function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed"})(de||(de={}));f.SubSectionType=de;var fe=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"];function pe(e,t,n){var a=e.reduce(function(e,t){switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(function(e){return e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"})){e.splice.apply(e,[e.length,0].concat(oe(t.Facets)))}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return a.map(function(e){var i;return Fe(e,a,t,0,!(e!==null&&e!==void 0&&(i=e.Facets)!==null&&i!==void 0&&i.length),n)})}f.createSubSections=pe;function me(e){var t=B(e.getManifestWrapper().getHeaderFacets());var n=[];Object.keys(t).forEach(function(e){n.push(t[e]);return n});var a=n.reduce(function(e,t){if(t.templateEdit){e.push(t)}return e},[]);return a.map(function(e){return be(e)})}f.createCustomHeaderFacetSubSections=me;function be(e){var t=U(e.key);var n={id:t,key:e.key,title:e.title,type:de.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{}};return n}var ge=function(e,t){var n,a;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((a=e.Label)===null||a===void 0?void 0:a.toString())||t};function ye(e,t,n){var a=y(t,n)||[],i=I(t,n),r=K(i,n,e,undefined,undefined,a),o=D(e,r.actions,{command:"overwrite"});return{actions:o?g(z(o)):e,commandActions:r.commandActions}}function Ie(e,t){var n=new Array;switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":n=e.Facets.filter(function(e){return p(e)}).reduce(function(e,n){return Ae(e,n,t)},[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":n=Ae([],e,t);break;default:break}return ye(n,e,t)}function he(e){var t=j(k(e),true);return L(P(t,Q.Ghost,Q.Transparent))}function Fe(t,n,a,i,r,o){var l,u,c,s,v;var d=F({Facet:t});var f=(l=t.annotations)===null||l===void 0?void 0:(u=l.UI)===null||u===void 0?void 0:u.Hidden;var p=E(j(true,k(f)));var g=L(p);var y=g!==undefined&&typeof g==="string"&&g.indexOf("{=")===0&&!T(f);var I=g&&y?g.substring(g.indexOf("{=")+2,g.lastIndexOf("}"))!==undefined:false;var h=L(k(t.Label));var S={id:d,key:ge(t,d),title:h,type:de.Unknown,annotationPath:a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:g,isVisibilityDynamic:y,level:i,sideContent:undefined};if(o){S.stashed=H(t,t,a);S.flexSettings={designtime:_(t,t,a)}}var A="";i++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":var U=t.Facets;var O=U.map(function(e,t){return{index:t,facet:e}}).filter(function(e){var t,n;var a=e.facet;return fe.includes((t=a.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)});var D=U.filter(function(e){return!O.find(function(t){return t.facet===e})});if(O.length>0){var C=[];var w=[];var M=[];var N=re(O),R;try{for(N.s();!(R=N.n()).done;){var $=R.value.facet;C.push(Fe($,[],a,i,true,o))}}catch(e){N.e(e)}finally{N.f()}if(D.length>0){e.warning("Warning: CollectionFacet '".concat(t.ID,"' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet."));t.Facets=D;w.push(Fe(t,[],a,i,r,o))}if(O.find(function(e){var t=e.index;return t===0})){M.push.apply(M,C);M.push.apply(M,w)}else{M.push.apply(M,w);M.push.apply(M,C)}var V=te(te({},S),{},{type:de.Mixed,level:i,content:M});return V}else{var B=Ie(t,a),z=te(te({},S),{},{type:de.Form,formDefinition:m(t,g,a,B.actions),level:i,actions:B.actions.filter(function(e){return e.facetName===undefined}),commandActions:B.commandActions});return z}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){A="Unable to find annotationPath ".concat(t.Target.value)}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":var G=b(t.Target.value,Te(t,n,a),a,undefined,o);var q=((c=G.visualizations[0])===null||c===void 0?void 0:(s=c.annotation)===null||s===void 0?void 0:s.title)||((v=G.visualizations[0])===null||v===void 0?void 0:v.title);var X=Se(r,S.title,q);var K=P(y,x(I,E(j(h,"undefined")),X),x(g!==undefined,h!=="undefined",h!==undefined,p,X));var Q=te(te({},S),{},{type:de.DataVisualization,level:i,presentation:G,showTitle:X,titleVisible:L(K)});return Q;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":var W=Ie(t,a),J=te(te({},S),{},{type:de.Form,level:i,formDefinition:m(t,g,a,W.actions),actions:W.actions.filter(function(e){return e.facetName===undefined}),commandActions:W.commandActions});return J;default:A="For ".concat(t.Target.$target.term," Fragment");break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":A="For Reference URL Facet";break;default:break}var Y=te(te({},S),{},{text:A});return Y}f.createSubSection=Fe;function Se(e,t,n){if(e&&n===t){return false}return true}function Ae(e,t,n){var a=t.Target.$target;var i=t.Target.value;var r={};var o=[];var l=i.split("@"),u=W(l,1),c=u[0];if(c.length>0){if(c.lastIndexOf("/")===c.length-1){c=c.substr(0,c.length-1)}}else{c=undefined}if(a){switch(a.term){case"com.sap.vocabularies.UI.v1.FieldGroup":o=a.Data;r=K(n.getManifestControlConfiguration(a).actions,n,undefined,undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(a.qualifier){o=a}break;default:break}}e=o.reduce(function(e,i){var r,o,l,u,s,v,d,f,p,m,b,g,y,I,F,S;switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(((r=i.RequiresContext)===null||r===void 0?void 0:r.valueOf())===true){n.getDiagnostics().addIssue(V.Annotation,$.Low,R.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(((o=i.Inline)===null||o===void 0?void 0:o.valueOf())===true){n.getDiagnostics().addIssue(V.Annotation,$.Low,R.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(((l=i.Determining)===null||l===void 0?void 0:l.valueOf())===true){n.getDiagnostics().addIssue(V.Annotation,$.Low,R.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}var U={};if(i.Mapping){U.semanticObjectMapping=q(i.Mapping)}e.push({type:h.DataFieldForIntentBasedNavigation,id:A({Facet:t},i),key:N.generateKeyFromDataField(i),text:(u=i.Label)===null||u===void 0?void 0:u.toString(),annotationPath:"",enabled:i.NavigationAvailable!==undefined?L(j(k((s=i.NavigationAvailable)===null||s===void 0?void 0:s.valueOf()),true)):"true",visible:L(E(j(k((v=i.annotations)===null||v===void 0?void 0:(d=v.UI)===null||d===void 0?void 0:(f=d.Hidden)===null||f===void 0?void 0:f.valueOf()),true))),buttonType:he((p=i.annotations)===null||p===void 0?void 0:(m=p.UI)===null||m===void 0?void 0:m.Emphasized),press:L(M("._intentBasedNavigation.navigate",[k(i.SemanticObject),k(i.Action),U])),customData:L({semanticObject:k(i.SemanticObject),action:k(i.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":var O=n.getManifestControlConfiguration(a).actions;var D=N.generateKeyFromDataField(i);e.push({type:h.DataFieldForAction,id:A({Facet:t},i),key:D,text:(b=i.Label)===null||b===void 0?void 0:b.toString(),annotationPath:"",enabled:X(n,i.ActionTarget),binding:c?"{ 'path' : '".concat(c,"'}"):undefined,visible:L(E(j(k((g=i.annotations)===null||g===void 0?void 0:(y=g.UI)===null||y===void 0?void 0:(I=y.Hidden)===null||I===void 0?void 0:I.valueOf()),true))),requiresDialog:Ue(i.ActionTarget),buttonType:he((F=i.annotations)===null||F===void 0?void 0:(S=F.UI)===null||S===void 0?void 0:S.Emphasized),press:L(M("invokeAction",[i.Action,{contexts:M("getBindingContext",[],w("","$source")),invocationGrouping:i.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:k(i.Label),model:M("getModel",[],w("/","$source")),isNavigable:G(O&&O[D])}],C(".editFlow"))),facetName:i.Inline?t.fullyQualifiedName:undefined});break;default:break}return e},e);return D(e,r)}function Ue(e){if(e){var t,n;var a=(t=e.annotations)===null||t===void 0?void 0:(n=t.Common)===null||n===void 0?void 0:n.IsActionCritical;if(e.parameters.length>1||a){return"Dialog"}else{return"None"}}else{return"None"}}f.isDialog=Ue;function Oe(e,t){var n={};Object.keys(e).forEach(function(a){return n[a]=De(e[a],a,t)});return n}f.createCustomSubSections=Oe;function De(e,t,n){var a=e.sideContent?{template:e.sideContent.template,id:S(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;var i=e.position;if(!i){i={placement:O.After}}var r=e.visible!==undefined?e.visible:true;var o=r&&typeof r==="string"&&r.indexOf("{=")===0;var l=K(e.actions,n);var u={type:de.Unknown,id:e.id||U(t),actions:l.actions,key:t,title:e.title,level:1,position:i,visible:e.visible!==undefined?e.visible:true,sideContent:a,isVisibilityDynamic:o};if(e.template||e.name){u.type=de.XMLFragment;u.template=e.template||e.name||""}else{u.type=de.Placeholder}return u}f.createCustomSubSection=De;function Te(e,t,n){var a=n.getManifestWrapper();if(a.useIconTabBar()){return Ce(e,t)}else{var i,r,o,l,u,c;var s=n.getEntityType();if((i=s.annotations)!==null&&i!==void 0&&(r=i.UI)!==null&&r!==void 0&&(o=r.Facets)!==null&&o!==void 0&&o.length&&((l=s.annotations)===null||l===void 0?void 0:(u=l.UI)===null||u===void 0?void 0:(c=u.Facets)===null||c===void 0?void 0:c.length)>1){return Ce(e,t)}else{return true}}}function Ce(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){var n,a,i,r,o;var l=t;if(((n=l.Target)===null||n===void 0?void 0:(a=n.$target)===null||a===void 0?void 0:a.term)==="com.sap.vocabularies.UI.v1.LineItem"||((i=l.Target)===null||i===void 0?void 0:(r=i.$target)===null||r===void 0?void 0:r.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((o=l.Target.$target)===null||o===void 0?void 0:o.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var u,c,s,v;return((u=l.annotations)===null||u===void 0?void 0:(c=u.UI)===null||c===void 0?void 0:c.Hidden)!==undefined?(s=l.annotations)===null||s===void 0?void 0:(v=s.UI)===null||v===void 0?void 0:v.Hidden:false}return true}else{var d=t;return d.Facets.every(function(e){var t,n,a,i,r,o;var l=e;if(((t=l.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)==="com.sap.vocabularies.UI.v1.LineItem"||((a=l.Target)===null||a===void 0?void 0:(i=a.$target)===null||i===void 0?void 0:i.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((r=l.Target)===null||r===void 0?void 0:(o=r.$target)===null||o===void 0?void 0:o.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var u,c,s,v;return((u=l.annotations)===null||u===void 0?void 0:(c=u.UI)===null||c===void 0?void 0:c.Hidden)!==undefined?(s=l.annotations)===null||s===void 0?void 0:(v=s.UI)===null||v===void 0?void 0:v.Hidden:false}return true})}}return true})}return f},false);
//# sourceMappingURL=SubSection.js.map
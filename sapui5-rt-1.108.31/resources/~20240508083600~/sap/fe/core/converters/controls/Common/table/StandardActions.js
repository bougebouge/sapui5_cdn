/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/TableFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/templating/DataModelPathHelper","../../../helpers/BindingHelper","../../../ManifestSettings"],function(e,t,n,a,i,r){"use strict";var o={};var l=r.TemplateType;var s=r.CreationMode;var d=i.UI;var v=i.singletonPathVisitor;var u=a.isPathUpdatable;var p=a.isPathInsertable;var c=a.isPathDeletable;var f=a.getTargetObjectPath;var g=t.pathInModel;var b=t.or;var h=t.notEqual;var y=t.not;var T=t.length;var m=t.isPathInModelExpression;var C=t.isConstant;var M=t.ifElse;var P=t.greaterThan;var E=t.greaterOrEqual;var S=t.getExpressionFromAnnotation;var D=t.formatResult;var x=t.equal;var A=t.constant;var O=t.compileExpression;var R=t.and;var I;(function(e){e["CreateHidden"]="CreateHidden";e["DeleteHidden"]="DeleteHidden";e["UpdateHidden"]="UpdateHidden"})(I||(I={}));function U(e,t,n,a){return{collectionPath:f(e.getDataModelObjectPath()),hiddenAnnotation:{create:j(e,I.CreateHidden),delete:j(e,I.DeleteHidden),update:j(e,I.UpdateHidden)},creationMode:t,isDraftOrStickySupported:V(e),isViewWithMultipleVisualizations:a?e.getManifestWrapper().hasMultipleVisualizations(a):false,newAction:w(e),tableManifestConfiguration:n,restrictions:H(e)}}o.generateStandardActionsContext=U;function V(e){var t,a,i;var r=e.getDataModelObjectPath();var o=n.isObjectPathDraftSupported(r);var l=(t=r.startingEntitySet)!==null&&t!==void 0&&(a=t.annotations)!==null&&a!==void 0&&(i=a.Session)!==null&&i!==void 0&&i.StickySessionSupported?true:false;return o||l}o.isDraftOrStickySupported=V;function w(e){var t,a,i,r,o,l;var s=e.getEntitySet();var d=!n.isSingleton(s)?(s===null||s===void 0?void 0:(t=s.annotations)===null||t===void 0?void 0:(a=t.Common)===null||a===void 0?void 0:(i=a.DraftRoot)===null||i===void 0?void 0:i.NewAction)||(s===null||s===void 0?void 0:(r=s.annotations)===null||r===void 0?void 0:(o=r.Session)===null||o===void 0?void 0:(l=o.StickySessionSupported)===null||l===void 0?void 0:l.NewAction):undefined;var v=d===null||d===void 0?void 0:d.toString();if(v){var u,p,c;var f=e===null||e===void 0?void 0:(u=e.getEntityType().actions[v])===null||u===void 0?void 0:(p=u.annotations)===null||p===void 0?void 0:(c=p.Core)===null||c===void 0?void 0:c.OperationAvailable;f=f!==undefined?f:true;return{name:v,available:S(f)}}return undefined}o.getNewAction=w;function j(e,t){var n;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=e.getEntitySet();var r=e.getDataModelObjectPath();var o=r.navigationProperties.length>0&&a?[r.navigationProperties[r.navigationProperties.length-1].name]:[];var l=(i===null||i===void 0?void 0:(n=i.annotations.UI)===null||n===void 0?void 0:n[t])||false;return i?S(l,o,undefined,function(t){return v(t,e.getConvertedTypes(),o)}):A(false)}o.isActionAnnotatedHidden=j;function H(e){var t=e.getDataModelObjectPath();var n=[{key:"isInsertable",function:p},{key:"isUpdatable",function:u},{key:"isDeletable",function:c}];var a={};n.forEach(function(n){var i=n["function"];a[n.key]={expression:i.apply(null,[t,{pathVisitor:function(t,n){return v(t,e.getConvertedTypes(),n)}}]),navigationExpression:i.apply(null,[t,{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:function(t,n){return v(t,e.getConvertedTypes(),n)}}])}});return a}o.getRestrictions=H;function k(e,t,n){return(t||e.creationMode===s.External)&&!n}o.getInsertUpdateActionsTemplating=k;function L(e,t){var n=N(e,t);return{isTemplated:O(q(t,n)),visible:O(n),enabled:O(X(e,t,n))}}o.getStandardActionCreate=L;function z(e,t){var n=G(e,t);return{isTemplated:O(B(n)),visible:O(n),enabled:O(Y(e,t,n))}}o.getStandardActionDelete=z;function F(e,t){var n=N(e,t,true);return{isTemplated:O(q(t,n,true)),visible:O(n),enabled:O(Q(e,t,n))}}o.getCreationRow=F;function W(e,t,n){var a=N(e,t);var i=X(e,t,a);var r=J(e,t,a,n);return{visible:O(r),enabled:O(Z(r,i))}}o.getStandardActionPaste=W;function _(e,t){var n=K(e,t);return{isTemplated:O(B(n)),visible:O(n),enabled:O($(e,t,n))}}o.getStandardActionMassEdit=_;function q(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return R(b(R(n,e.creationMode===s.CreationRow),R(!n,e.creationMode!==s.CreationRow)),b(y(C(t)),t))}o.getCreateTemplating=q;function B(e){return b(y(C(e)),e)}o.getDefaultTemplating=B;function N(e,t){var n;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var i=t.restrictions.isInsertable.expression;var r=a?j(e,I.CreateHidden,false):t.hiddenAnnotation.create;var o=t.newAction;return M(t.creationMode===s.External,R(y(r),b(e.getTemplateType()===l.ListReport,d.IsEditable)),M(b(R(C(o===null||o===void 0?void 0:o.available),x(o===null||o===void 0?void 0:o.available,false)),R(C(i),x(i,false),!o),R(C(r),x(r,true)),R(t.creationMode===s.InlineCreationRows,((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.type)==="ResponsiveTable")),false,M(e.getTemplateType()===l.ListReport,b(y(m(r)),y(r)),R(y(r),d.IsEditable))))}o.getCreateVisibility=N;function G(e,t){var n=t.hiddenAnnotation.delete;var a=t.restrictions.isDeletable.expression;return M(b(t.isViewWithMultipleVisualizations,e.getTemplateType()===l.AnalyticalListPage),false,M(R(C(a),x(a,false)),false,M(R(C(n),x(n,A(true))),false,M(e.getTemplateType()!==l.ListReport,R(y(n),d.IsEditable),y(R(m(n),n))))))}o.getDeleteVisibility=G;function J(e,t,n,a){return R(h(t.tableManifestConfiguration.enablePaste,false),n,a,[l.ListReport,l.AnalyticalListPage].indexOf(e.getTemplateType())===-1,t.restrictions.isInsertable.expression)}o.getPasteVisibility=J;function K(e,t){var n;var a=t.hiddenAnnotation.update,i=t.restrictions.isUpdatable.expression,r=((n=t.tableManifestConfiguration)===null||n===void 0?void 0:n.enableMassEdit)||false;var o=e.getTemplateType()===l.ObjectPage?d.IsEditable:e.getTemplateType()===l.ListReport;return R(y(R(C(i),x(i,false))),r,o,y(a))}o.getMassEditVisibility=K;function Q(t,n,a){var i=p(t.getDataModelObjectPath(),{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:function(e,n){if(e.indexOf("/")===0){e=v(e,t.getConvertedTypes(),n);return e}var a=t.getDataModelObjectPath().navigationProperties;if(a){var i=a[a.length-1].partner;if(i){e="".concat(i,"/").concat(e)}}return e}});var r=i._type==="Unresolvable"?p(t.getDataModelObjectPath(),{pathVisitor:function(e){return v(e,t.getConvertedTypes(),[])}}):i;return R(a,r,b(!n.tableManifestConfiguration.disableAddRowButtonForEmptyData,D([g("creationRowFieldValidity","internal")],e.validateCreationRowFields)))}o.getCreationRowEnablement=Q;function X(e,t,n){var a;var i=t.restrictions.isInsertable.expression;var r=(a=e.resolveAbsolutePath(t.collectionPath).target)===null||a===void 0?void 0:a._type;return R(n,b(r==="EntitySet",R(i,b(e.getTemplateType()!==l.ObjectPage,d.IsEditable))))}o.getCreateEnablement=X;function Y(e,t,n){var a=t.restrictions.isDeletable.expression;var i=!C(a)&&t.restrictions.isDeletable.navigationExpression._type==="Unresolvable";var r=g("numberOfSelectedContexts","internal");var o=g("deletableContexts","internal");var s=g("unSavedContexts","internal");return R(n,M(b(e.getTemplateType()!==l.ObjectPage,i),R(b(R(h(o,undefined),P(T(o),0)),R(h(s,undefined),P(T(s),0))),g("deleteEnabled","internal")),R(h(r,0),a)))}o.getDeleteEnablement=Y;function Z(e,t){return R(e,t)}o.getPasteEnablement=Z;function $(e,t,a){var i=t.restrictions.isUpdatable.expression;var r=!C(i)&&t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable";var o=E(g("numberOfSelectedContexts","internal"),1);var l=E(T(g("updatableContexts","internal")),1);var s=n.isObjectPathDraftSupported(e.getDataModelObjectPath());var d=ee(e);var v=M(b(R(d,s),r),R(o,l),R(o));return R(a,M(r,v,R(v,i)))}o.getMassEditEnablement=$;function ee(e,t){var n=e.getTemplateType();if(n===l.ListReport||n===l.AnalyticalListPage||t&&e.getManifestWrapper().hasMultipleVisualizations(t)){return true}return false}o.isInDisplayMode=ee;return o},false);
//# sourceMappingURL=StandardActions.js.map
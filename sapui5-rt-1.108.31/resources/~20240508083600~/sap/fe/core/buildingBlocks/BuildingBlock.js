/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/deepClone","sap/base/util/merge","sap/base/util/ObjectPath","sap/fe/core/buildingBlocks/BuildingBlockRuntime","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/StableIdHelper","sap/ui/base/ManagedObject","sap/ui/core/Component","sap/ui/core/Fragment","sap/ui/core/util/XMLPreprocessor","../converters/ConverterContext"],function(e,t,n,r,i,a,o,u,s,c,l,f){"use strict";var d,g,v;var p={};var m=o.generate;var b=a.resolveBindingString;var h=r.xml;var B=r.registerBuildingBlock;var C=r.escapeXMLAttributeValue;function O(e,t){if(!t){t=e.slice(0)}return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var y=function(){function n(n,r,i){var a=this;this.isPublic=false;this.getConverterContext=function(n,r,i,a){var o=i.appComponent;var u=i.models.viewData&&i.models.viewData.getData();var s=Object.assign({},u);delete s.resourceBundle;s=e(s);s.controlConfiguration=t(s.controlConfiguration,a);return f.createConverterContextForMacro(n.startingEntitySet.name,i.models.metaModel,o&&o.getDiagnostics(),t,n.contextLocation,s)};Object.keys(n).forEach(function(e){a[e]=n[e]})}p.BuildingBlockBase=n;var r=n.prototype;r.createId=function e(){if(this.id){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return m([this.id].concat(n))}return undefined};r.getProperties=function e(){var t={};for(var n in this){if(this.hasOwnProperty(n)){t[n]=this[n]}}return t};n.register=function e(){};n.unregister=function e(){};r.addConditionally=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var n=arguments.length>1?arguments[1]:undefined;if(t){return n}else{return""}};r.attr=function e(t,n){if(n!==undefined){return function(){return"".concat(t,'="').concat(C(n),'"')}}else{return function(){return""}}};return n}();p.BuildingBlockBase=y;var P=function(t){if(!t.hasOwnProperty("metadata")){t.metadata=e(t.metadata||{properties:{},aggregations:{},events:{}})}return t.metadata};function k(e){return function(t,n,r){var i=P(t.constructor);if(e.defaultValue===undefined){var a;e.defaultValue=(a=r.initializer)===null||a===void 0?void 0:a.call(r)}delete r.initializer;if(i.properties[n.toString()]===undefined){i.properties[n.toString()]=e}return r}}p.xmlAttribute=k;function w(e){return k(e)}p.blockAttribute=w;function x(){return function(e,t,n){var r=P(e.constructor);delete n.initializer;if(r.events[t.toString()]===undefined){r.events[t.toString()]={type:"Function"}}return n}}p.xmlEvent=x;function j(){return x()}p.blockEvent=j;function M(e){return function(t,n,r){var i=P(t.constructor);delete r.initializer;if(i.aggregations[n]===undefined){i.aggregations[n]=e}return r}}p.xmlAggregation=M;function N(e){return M(e)}p.blockAggregation=N;var A={};function V(e){return function(t){P(t);t.xmlTag=e.name;t.namespace=e.namespace;t.publicNamespace=e.publicNamespace;t.fragment=e.fragment;t.isOpen=e.isOpen;t.isRuntime=e.isRuntime;t.apiVersion=2;if(t.isRuntime===true){t.prototype.getTemplate=function(){var n="".concat(e.namespace,".").concat(e.name);var r=[];for(var i in t.metadata.properties){var a=this[i];if(a!==undefined&&a!==null){var o,u,s;if(((o=a)===null||o===void 0?void 0:(u=(s=o).isA)===null||u===void 0?void 0:u.call(s,"sap.ui.model.Context"))===true){a=a.getPath()}r.push(h(d||(d=O(["feBB:",'="','"'])),i,a))}}for(var c in t.metadata.events){var l=this[c];if(l!==undefined){r.push(h(g||(g=O(["feBB:",'="','"'])),c,l))}}return h(v||(v=O(['<core:Fragment\n\t\t\t\t\txmlns:core="sap.ui.core"\n\t\t\t\t\txmlns:feBB="sap.fe.core.buildingBlocks"\n\t\t\t\t\tfragmentName="','"\n\t\t\t\t\tid="{this>id}"\n\t\t\t\t\ttype="FE_COMPONENTS"\n\t\t\t\t\t',"\n\t\t\t\t>\n\t\t\t\t</core:Fragment>"])),n,r)}}t.register=function(){B(t);if(t.isRuntime===true){A["".concat(e.namespace,".").concat(e.name)]=t}};t.unregister=function(){l.plugIn(null,t.namespace,t.name);l.plugIn(null,t.publicNamespace,t.name)}}}p.defineBuildingBlock=V;c.registerType("FE_COMPONENTS",{load:function(e){try{return Promise.resolve(A[e.fragmentName])}catch(e){return Promise.reject(e)}},init:function(e){try{var t,r,a,o;var c=this;var l=e.fragmentContent;if(!l){l=A[e.fragmentName]}var f={};var d=(e===null||e===void 0?void 0:(t=e.customData)===null||t===void 0?void 0:(r=t[0])===null||r===void 0?void 0:(a=r.mProperties)===null||a===void 0?void 0:(o=a.value)===null||o===void 0?void 0:o["sap.fe.core.buildingBlocks"])||{};delete e.customData;var g=s.getOwnerComponentFor(e.containingView);var v=i.getAppComponent(e.containingView);var p=v.getMetaModel();var m=g.getModel("_pageModel");for(var h in l.metadata.properties){var B=l.metadata.properties[h];var C=m.createBindingContext(d[h]);if(C===null){var O=d[h];if(typeof O==="string"){if(B.bindable!==true){switch(B.type){case"boolean":O=O==="true";break;case"number":O=Number(O);break}}else{O=b(O,B.type)}}f[h]=O}else if(C.getObject()!==undefined){f[h]=C.getObject()}else{f[h]=p.createBindingContext(d[h])}}for(var y in l.metadata.events){if(d[y]!==undefined&&d[y].startsWith(".")){f[y]=n.get(d[y].substring(1),e.containingView.getController())}else{f[y]=""}}return Promise.resolve(u.runWithPreprocessors(function(){var t=new l(f,{},{isRuntimeInstantiation:true,isPublic:false,appComponent:v}).render(e.containingView,v);if(!c._bAsync){c._aContent=t}return t},{id:function(t){return e.containingView.createId(t)},settings:function(t){var n=this.getMetadata().getAssociations();for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];if(t.hasOwnProperty(a)){t[a]=e.containingView.createId(t[a])}}return t}}))}catch(e){return Promise.reject(e)}}});return p},false);
//# sourceMappingURL=BuildingBlock.js.map
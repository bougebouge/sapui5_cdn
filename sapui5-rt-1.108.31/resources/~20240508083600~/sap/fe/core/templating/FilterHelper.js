/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/mdc/condition/Condition","sap/ui/mdc/enum/ConditionValidated"],function(e,t,n){"use strict";var r={};function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(e,t,n){t=d(t);if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function d(e){var t=u(e,"string");return typeof t==="symbol"?t:String(t)}function u(e,t){if(typeof e!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if(typeof r!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var l=["Edm.Boolean","Edm.Byte","Edm.Date","Edm.DateTime","Edm.DateTimeOffset","Edm.Decimal","Edm.Double","Edm.Float","Edm.Guid","Edm.Int16","Edm.Int32","Edm.Int64","Edm.SByte","Edm.Single","Edm.String","Edm.Time","Edm.TimeOfDay"];var c={Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith",Empty:"NotEmpty",NotEmpty:"Empty",LE:"NOTLE",GE:"NOTGE",LT:"NOTLT",GT:"NOTGT",BT:"NOTBT",NE:"EQ",EQ:"NE"};function s(e){var t;if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)){t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,4})/)[0]}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){t="".concat(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0],"+0000")}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){t="".concat(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0],"T00:00:00+0000")}else if(e.indexOf("Z")===e.length-1){t="".concat(e.split("Z")[0],"+0100")}else{t=undefined}return t}r._getDateTimeOffsetCompliantValue=s;function f(e){return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:e.match(/^(\d{8})/)&&e.match(/^(\d{8})/)[0]}r._getDateCompliantValue=f;function v(e,t){var n;if(l.indexOf(t)===-1){return undefined}n=e;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){n=e}else{n=e==="true"||(e==="false"?false:undefined)}break;case"Edm.Double":case"Edm.Single":n=isNaN(e)?undefined:parseFloat(e);break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":n=isNaN(e)?undefined:parseInt(e,10);break;case"Edm.Date":n=f(e);break;case"Edm.DateTimeOffset":n=s(e);break;case"Edm.TimeOfDay":n=e.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?e.match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]:undefined;break;default:}return n===null?undefined:n}r.getTypeCompliantValue=v;function m(t,n,r,a){var i=n,o,d;var u={};u.values=[];u.isEmpty=null;if(n===undefined||n===null){return}switch(t){case"CP":d="Contains";if(i){var l=i.indexOf("*");var s=i.lastIndexOf("*");if(l>-1){if(l===0&&s!==i.length-1){d="EndsWith";i=i.substring(1,i.length)}else if(l!==0&&s===i.length-1){d="StartsWith";i=i.substring(0,i.length-1)}else{i=i.substring(1,i.length-1)}}else{e.warning("Contains Option cannot be used without '*'.");return}}break;case"EQ":d=n===""?"Empty":t;break;case"NE":d=n===""?"NotEmpty":t;break;case"BT":if(r===undefined||r===null){return}o=r;d=t;break;case"LE":case"GE":case"GT":case"LT":d=t;break;default:e.warning("Selection Option is not supported : '".concat(t,"'"));return}if(a==="E"){d=c[d]}u.operator=d;if(d!=="Empty"){u.values.push(i);if(o){u.values.push(o)}}return u}r.resolveConditionValues=m;function p(e){return e.indexOf("/")>0?e.split("/")[1]:e}r.getRangeProperty=p;function g(e,t,n,r){var a=[];e===null||e===void 0?void 0:e.forEach(function(e){var i=r?r(e,t,n):h(e,t);if(i){a.push(i)}});return a}function E(e,t,n){var r=e.lastIndexOf("/");var a=r>-1?e.substring(0,e.lastIndexOf("/")+1):"";var i=t.getObject("".concat(n,"/").concat(a));return i===null||i===void 0?void 0:i[e.replace(a,"")]}function y(e,t,n,r){var a=e.PropertyName,i={},o=a.value||a.$PropertyPath,d=e.Ranges;var u=E(o,t,n);if(u){var l=g(d,u,o,r);if(l.length){i[o]=(i[o]||[]).concat(l)}}return i}function b(e,t,r,a){var o={};if(!r){return o}var d=r.SelectOptions,u=r.Parameters;d===null||d===void 0?void 0:d.forEach(function(n){var r=n.PropertyName,d=r.value||r.$PropertyPath;if(Object.keys(o).includes(d)){o[d]=o[d].concat(y(n,t,e,a)[d])}else{o=i(i({},o),y(n,t,e,a))}});u===null||u===void 0?void 0:u.forEach(function(e){var t=e.PropertyName.value||e.PropertyName.$PropertyPath;var r=a?{operator:"EQ",value1:e.PropertyValue,value2:null,path:t,isParameter:true}:{operator:"EQ",values:[e.PropertyValue],isEmpty:null,validated:n.Validated,isParameter:true};o[t]=[r]});return o}r.getFiltersConditionsFromSelectionVariant=b;function h(e,r){var a;var i=e.Sign?p(e.Sign):undefined;var o=e.Option?p(e.Option):undefined;var d=v(e.Low,r.$Type||r.type);var u=e.High?v(e.High,r.$Type||r.type):undefined;var l=m(o,d,u,i);if(l){a=t.createCondition(l.operator,l.values,null,null,n.Validated)}return a}r.getConditions=h;var O=function(e,r){var a={};var i=e.getInterface(1).getPath(),o=e.getInterface(1).getModel();if(r){for(var d in r){var u=o.getObject("".concat(i,"/").concat(d,"@com.sap.vocabularies.Common.v1.FilterDefaultValue"));if(u!==undefined){var l=d;a[l]=[t.createCondition("EQ",[u],null,null,n.Validated)]}}}return a};var T=function(e,n,r){var a={};var i=e.getInterface(1);var o=i.getModel();var d=i.getPath();for(var u in r){if(r[u][0]){var l=u.split("::");var c="";var s=l.length;var f=l.slice(0,l.length-1).join("/");var v=l[s-1];if(f){var m=o.getObject(d+"/"+f);if(m.$kind==="NavigationProperty"&&m.$isCollection){c+="".concat(f,"*/")}else if(m.$kind==="NavigationProperty"){c+="".concat(f,"/")}}c+=v;var p="values"in r[u][0]?r[u][0].values:[];a[c]=[t.createCondition(r[u][0].operator,p,null,null,null)]}}return a};function P(){var e={};e["$editState"]=[t.createCondition("DRAFT_EDIT_STATE",["ALL"],null,null,n.Validated)];return e}function N(e,t){var n,r;var a;var o=e.getInterface(1).getPath(),d=e.getInterface(1).getModel(),u=d.getObject("".concat(o,"@")),l=d.getObject("".concat(o,"/"));if(u["@com.sap.vocabularies.Common.v1.DraftRoot"]||u["@com.sap.vocabularies.Common.v1.DraftNode"]){a=P()}var c=(n=t)===null||n===void 0?void 0:n.selectionVariant;var s=((r=t)===null||r===void 0?void 0:r.defaultSemanticDates)||{};var f=O(e,l);var v=T(e,l,s);if(c){t=b(o,d,c)}else if(f){t=f}if(v){t=i(i({},t),v)}if(a){t=i(i({},t),a)}return Object.keys(t).length>0?JSON.stringify(t).replace(/([\{\}])/g,"\\$1"):undefined}r.getFilterConditions=N;N.requiresIContext=true;return r},false);
//# sourceMappingURL=FilterHelper.js.map
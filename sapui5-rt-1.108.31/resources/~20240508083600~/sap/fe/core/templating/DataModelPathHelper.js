/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/PropertyHelper"],function(t,e){"use strict";var n={};var i=e.isPathExpression;var r=e.isAnnotationPathExpression;var a=t.unresolveableExpression;var o=t.getExpressionFromAnnotation;var v=t.equal;var l=t.constant;var c=function(t){return u(t===null||t===void 0?void 0:t.contextLocation,t===null||t===void 0?void 0:t.navigationProperties).map(function(t){return t.name})};n.getRelativePaths=c;var u=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!t){return e}else if(e.length>=t.navigationProperties.length){var n=[];t.navigationProperties.forEach(function(t,i){if(e[i]!==t){n.push(e[i])}});n=n.concat(e.slice(t.navigationProperties.length));var i=0;while(n.length>1&&i!=n.length-1){var r=n[i];var a=n[i+1];if(r.partner===a.name){n.splice(0,2)}else{i++}}return n}else{var o=[];e.forEach(function(n,i){if(t.navigationProperties[i]!==n){o.push(e[i])}});o=o.concat(t.navigationProperties.slice(e.length));var v=0;while(o.length>1&&v!=o.length-1){var l=o[v];var c=o[v+1];if(l.partner===c.name){o.splice(0,2)}else{v++}}o=o.map(function(t){return t.targetType.navigationProperties.find(function(e){return e.name===t.partner})});return o}};n.getPathRelativeLocation=u;var s=function(t,e){var n="";if((i(e)||r(e))&&e.path){n=e.path}else if(typeof e==="string"){n=e}var a;if(i(e)||r(e)){a=e.$target}else if(t.targetEntityType){a=t.targetEntityType.resolvePath(n)}else{a=t.targetObject}var o=n.split("/");var v=t.targetEntitySet;var l=t.targetEntityType;var c=t.navigationProperties.concat();var u=t.targetEntityType;o.forEach(function(t){if(!u){return}var e=u.navigationProperties.find(function(e){return e.name===t});if(e){c.push(e);l=e.targetType;if(v&&v.navigationPropertyBinding.hasOwnProperty(t)){v=v.navigationPropertyBinding[t]}u=l}else{u=undefined}});return{startingEntitySet:t.startingEntitySet,navigationProperties:c,contextLocation:t.contextLocation,targetEntitySet:v,targetEntityType:l,targetObject:a,convertedTypes:t.convertedTypes}};n.enhanceDataModelPath=s;var g=function(t){var e="/".concat(t.startingEntitySet.name);var n=t.startingEntitySet;var i=[];t.navigationProperties.forEach(function(t){i.push(t.name);if(n&&n.navigationPropertyBinding.hasOwnProperty(i.join("/"))){e+="/$NavigationPropertyBinding/".concat(i.join("/"),"/$");n=n.navigationPropertyBinding[i.join("/")];i=[]}});return e};n.getTargetEntitySetPath=g;var f=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n="";if(!t.startingEntitySet){return"/"}if(!e){n+="/".concat(t.startingEntitySet.name)}if(t.navigationProperties.length>0){if(n.length>0){n+="/"}n+=t.navigationProperties.map(function(t){return t.name}).join("/")}if(t.targetObject&&t.targetObject.name&&t.targetObject._type!=="NavigationProperty"&&t.targetObject._type!=="EntityType"&&t.targetObject._type!=="EntitySet"&&t.targetObject!==t.startingEntitySet){if(!n.endsWith("/")){n+="/"}n+="".concat(t.targetObject.name)}else if(t.targetObject&&t.targetObject.hasOwnProperty("term")){if(n.length>0&&!n.endsWith("/")){n+="/"}n+="@".concat(t.targetObject.term);if(t.targetObject.hasOwnProperty("qualifier")&&!!t.targetObject.qualifier){n+="#".concat(t.targetObject.qualifier)}}return n};n.getTargetObjectPath=f;var d=function(t){var e;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(((e=t.contextLocation)===null||e===void 0?void 0:e.startingEntitySet)!==t.startingEntitySet){return f(t)}return p(t,n)};n.getContextRelativeTargetObjectPath=d;var p=function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=u(t.contextLocation,t.navigationProperties);if(e){if(n.find(function(t){return t.isCollection})){return undefined}}var i=n.map(function(t){return t.name}).join("/");if(t.targetObject&&(t.targetObject.name||t.targetObject.type==="PropertyPath"&&t.targetObject.value)&&t.targetObject._type!=="NavigationProperty"&&t.targetObject._type!=="EntityType"&&t.targetObject._type!=="EntitySet"&&t.targetObject!==t.startingEntitySet){if(i.length>0&&!i.endsWith("/")){i+="/"}i+=t.targetObject.type==="PropertyPath"?"".concat(t.targetObject.value):"".concat(t.targetObject.name)}else if(t.targetObject&&t.targetObject.hasOwnProperty("term")){if(i.length>0&&!i.endsWith("/")){i+="/"}i+="@".concat(t.targetObject.term);if(t.targetObject.hasOwnProperty("qualifier")&&!!t.targetObject.qualifier){i+="#".concat(t.targetObject.qualifier)}}else if(!t.targetObject){return undefined}return i};var h=function(t,e){return j(t,function(t){var e;return t===null||t===void 0?void 0:(e=t.UpdateRestrictions)===null||e===void 0?void 0:e.Updatable},e)};n.isPathUpdatable=h;var y=function(t,e){return j(t,function(t){var e;return t===null||t===void 0?void 0:(e=t.SearchRestrictions)===null||e===void 0?void 0:e.Searchable},e)};n.isPathSearchable=y;var P=function(t,e){return j(t,function(t){var e;return t===null||t===void 0?void 0:(e=t.DeleteRestrictions)===null||e===void 0?void 0:e.Deletable},e)};n.isPathDeletable=P;var b=function(t,e){return j(t,function(t){var e;return t===null||t===void 0?void 0:(e=t.InsertRestrictions)===null||e===void 0?void 0:e.Insertable},e)};n.isPathInsertable=b;var O=function(t,e){return j(t,function(n){if(n&&"FilterRestrictions"in n){var i;var r=(n===null||n===void 0?void 0:(i=n.FilterRestrictions)===null||i===void 0?void 0:i.FilterExpressionRestrictions)||[];var a=r.find(function(e){return e.Property.$target===t.targetObject});if(a){var o;return e.indexOf(a===null||a===void 0?void 0:(o=a.AllowedExpressions)===null||o===void 0?void 0:o.toString())!==-1}else{return false}}else{return false}})};n.checkFilterExpressionRestrictions=O;var j=function(t,e,n){if(!t||!t.startingEntitySet){return l(true)}t=s(t,n===null||n===void 0?void 0:n.propertyPath);var i=t.startingEntitySet;var r=null;var c=[];var g=[];var f=i;var d=t.targetEntityType;var p=false;t.navigationProperties.forEach(function(t){if(p){c=[]}c.push(t.name);g.push(t);if(!t.containsTarget){var e=c.join("/");if(i&&i.navigationPropertyBinding.hasOwnProperty(e)){r=i;i=i.navigationPropertyBinding[e];f=i;p=true}else{r=i;i=null;p=true}}else{r=i;f=null}});var h=c.join("/");var y,P;if(r!==null){var b,O,j;var m=r;(b=m.annotations)===null||b===void 0?void 0:(O=b.Capabilities)===null||O===void 0?void 0:(j=O.NavigationRestrictions)===null||j===void 0?void 0:j.RestrictedProperties.forEach(function(i){var r;if(((r=i.NavigationProperty)===null||r===void 0?void 0:r.type)==="NavigationPropertyPath"){var a=e(i);if(h===i.NavigationProperty.value&&a!==undefined){var l;var c=g.slice(0,-1);P=c;var s=u((l=t)===null||l===void 0?void 0:l.contextLocation,P).map(function(t){return t.name});var f=n!==null&&n!==void 0&&n.pathVisitor?E(n.pathVisitor,s):undefined;y=v(o(a,s,undefined,f),true)}}})}var S;if(!(n!==null&&n!==void 0&&n.ignoreTargetCollection)){var T,x;var R=e((T=f)===null||T===void 0?void 0:(x=T.annotations)===null||x===void 0?void 0:x.Capabilities);if(f===null&&R===undefined){var w;R=e(d===null||d===void 0?void 0:(w=d.annotations)===null||w===void 0?void 0:w.Capabilities)}if(R!==undefined){var B=u(t.contextLocation,g).map(function(t){return t.name});var L=n!==null&&n!==void 0&&n.pathVisitor?E(n.pathVisitor,B):undefined;S=v(o(R,B,undefined,L),true)}}return y||S||(n!==null&&n!==void 0&&n.authorizeUnresolvable?a:l(true))};n.checkOnPath=j;var E=function(t,e){return function(n){return t(n,e)}};return n},false);
//# sourceMappingURL=DataModelPathHelper.js.map
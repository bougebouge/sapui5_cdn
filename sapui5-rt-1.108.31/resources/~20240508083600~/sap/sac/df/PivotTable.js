/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/PivotTable",["sap/base/Log","sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/sac/df/utils/ErrorHandler","sap/sac/df/utils/ResourceModel","sap/sac/grid/Format","sap/sac/df/thirdparty/lodash"],function(e,t,a,i,o,n,r){"use strict";var s=t.extend("sap.sac.df.PivotTable",{metadata:{properties:{dataProviderName:{type:"string",defaultValue:"0"},format:{type:"sap.sac.grid.Format",multiple:false,defaultValue:n.ExcelStyle}},events:{navigationCmd:{parameters:{anchor:"sap.ui.core.Control",navigationCmdType:"sap.sac.df.types.NavigationCommandType",selection:"object",cmd:"function"}}},publicMethods:["autoFit","getRowCount","getColCount","getFixedRows","getFixedColumns"]},init:function(){var t=this;t.getInit=r.constant(Promise.resolve().then(function(){return sap.ui.core.mvc.XMLView.create({id:[t.getId(),"-gridView"].join(""),viewName:"sap.sac.df.view.Pivot"})}).then(function(e){t.getView=r.constant(e);t.addDependent(t.getView());t.getView().setModel(o,"i18n").setModel(new a,"VariableContainer").setModel(new a,"cm").setModel(new a);e=t.getView();t.getEasyGrid=r.constant(e.byId("theEasyGrid"));e.getPivotTable=r.constant(t);e.getController().getPivot=r.constant(t);t.getFixedColumns=t.getEasyGrid().getFixedColumns.bind(t.getEasyGrid());t.getFixedRows=t.getEasyGrid().getFixedRows.bind(t.getEasyGrid());t.onBeforeRendering();return e}).catch(i.handleWithPopUp));var n=t.setFormat;t.setFormat=function(){var a=n.apply(t,arguments);t.getInit().then(function(){return t.getModel("om").metadataLoaded()}).then(function(){t.getEasyGrid().setFormat(t.getFormat())}).catch(function(t){e.error(t)});return a}},onBeforeRendering:function(){var e=this;if(!e.getVisible()||!e.getEasyGrid||!e.getEasyGrid()){return}if(!e.getModel("om")){return}var t=e.getModel("om").getProperty("dataProvider")?"dataProvider":"DataProvider";var a=e.getEasyGrid();if(a.getFormat()!=e.getFormat()){a.setFormat(e.getFormat())}var i=e.getDataProviderName();function o(e){var o=r.clone(a.getBindingInfo(e));o.parts[0].path=["/"+t+"/",i,"/Grid/",e].join("");a.bindProperty(e,o)}if(e._oldDPName!==i){var n=r.clone(e.getEasyGrid().getBindingInfo("cells"));n.path=["/"+t+"/",i,"/Grid/Cells"].join("");a.bindAggregation("cells",n);["virtualRows","virtualColumns","fixedRows","fixedColumns","input","format"].forEach(o);e._oldDPName=i}if(a.getModel("om").getDataProvider(e.getDataProviderName())&&a.getFormat()!=e.getFormat()){a.setFormat(e.getFormat())}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t).style("height","100%").class("sapUiZenCommonsSize").openEnd();if(t.getView&&t.getView()){e.renderControl(t.getView())}else{t.getInit().then(function(){t.invalidate()})}e.close("div")}},handleResize:r.constant(null),getRowCount:function(){return this.getEasyGrid().getRowCount()},autoFit:function(){var e=this;if(e.getEasyGrid){e.getEasyGrid().autoFit()}},getColCount:function(){return this.getEasyGrid().getRowCount()},exit:function(){var e=this;sap.ui.Device.resize.detachHandler(e.handleResize);if(e.getEasyGrid){var a=e.getEasyGrid().getBindingInfo("cells");if(a&&a.template){a.template.destroy()}}e.destroyDependents();e.removeAllDependents();t.prototype.exit(e,arguments)}});return s});
//# sourceMappingURL=PivotTable.js.map
/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/utils/ResultSetHelper",["sap/base/Log","sap/sac/df/types/ValueType","sap/sac/df/utils/ListHelper","sap/sac/df/types/MemberType","sap/sac/df/utils/ResourceBundle","sap/sac/df/thirdparty/lodash"],function(e,t,a,i,r,n){"use strict";e.info("ResultSetHelper loaded");function u(){var u=this;u.dimensionMembersToList=function(e,t){if(!t){return null}return n.filter(n.map(a.arrayFromIter(t.getAxis(e.getAxisType()).getTuplesIterator()),function(t){var a=t.getTupleElementByDimension(e);var i=a&&a.getDimensionMember();return i?{Name:e.isStructure()&&e.getAllStructureMembers().getByKey(i.getName()).getFieldValue(e.getDisplayKeyField())?e.getAllStructureMembers().getByKey(i.getName()).getFieldValue(e.getDisplayKeyField()).getValue().getString():i.getName(),TechName:i.getName(),Description:i.getText()}:null}),n.identity)};u.tupleToObject=function(e){return n.reduce(e.getElements().getListFromImplementation(),function(e,t){var a=t.getDimensionMember().getName();e[t.getDimension().getExternalName()||t.getDimension().getName()]=a;return e},{})};u.getFields=function(e){var t=e.getKeyField();var a=e.getDisplayKeyField()||t;var i=e.getTextField()||a;return{oKeyField:t,oDisplayKeyField:a,oTextField:i}};u.flatten=function(t){var r={};var s={};var l=t.getQueryModel().getMeasureDimension();function g(t){return{tuple:t,member:n.reduce(t.getElements().getListFromImplementation(),function(a,n){var g=n.getDimensionMember();var m=g.getDimension();var o=u.getFields(m);var p=o.oTextField;if(m!=l){if(a&&g.getMemberType().getName()==i.Member){var c=m.getExternalName()||m.getName();s[c]={Name:c,Description:p?g.getFieldValue(p).getString():""};a[c]=g.getFieldValue(p).getString();return a}else{return a}}else{if(m.isStructure()){var d=g.getKeyFieldValue();if(d){var y=m.getStructureMemberByKey(d.getString()).getFieldValue(o.oDisplayKeyField)||m.getStructureMemberByKey(d.getString()).getFieldValue(o.oKeyField);if(y){t.kyf=y.getString()}else{e.error("Structure member has no string representation")}}else{e.error("Structure member has no string representation")}}else{t.kyf=g.getFieldValue(o.oDisplayKeyField).getString()}r[t.kyf]={Name:t.kyf,Description:g.getFieldValue(p)?g.getFieldValue(p).getString():t.kyf};return a}},{})}}function m(e){return n.map(a.arrayFromIter(e.getTuplesIterator()),g)}function o(e){var t=null;var a=e.getDataCell().getReferenceStructureElement1();if(a){var i=a.getDimension().getDisplayKeyField();var r=a.getFieldValue(i);t=r?r.getString():a.getName()}if(!t){a=e.getDataCell().getReferenceStructureElement2();if(a){i=a.getDimension().getDisplayKeyField();r=a.getFieldValue(i);t=r?r.getString():a.getName()}}return t}function p(e){var t=e.getValueException();return t===sap.firefly.ValueException.NULL_VALUE||t===sap.firefly.ValueException.UNDEFINED}function c(e){var t=e.getValueType().isNumber();var a=t?0:"";return p(e)?a:t?e.getValue():e.getFormattedValue()}var d=n.filter(m(t.getColumnsAxis()),"member");var y=n.filter(m(t.getRowsAxis()),"member");var f=y.length>0?n.flatten(n.map(y,function(e){return n.map(d,function(a){var i=n.assign(n.clone(e.member),a.member);var r=t.getDataCellByTuples(a.tuple,e.tuple);if(r){if(r.getDataCell()){if(l){var u=o(r);i[u]=c(r)}}else if(e.tuple&&e.tuple.kyf||a.tuple&&a.tuple.kyf){i[e.tuple&&e.tuple.kyf||a.tuple&&a.tuple.kyf]=c(r)}}return i})})):d.length>0?n.map(d,function(e){var a=n.clone(e.member);var i=t.getDataCell(e.tuple.getAxisIndex(),0);if(i){if(i.getDataCell()){if(l){var r=o(i);a[r]=c(i)}}else if(e.tuple&&e.tuple.kyf){a[e.tuple&&e.tuple.kyf]=c(i)}}return a}):[];return{FlatResultSet:f,Measures:n.map(r,n.identity),Dimensions:n.map(s,n.identity)}};function s(e,t,a){if(e.length<1||t.length<1){return{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,1])}]}}return{Feeds:[{uid:"categoryAxis",type:"Dimension",values:[a.catDimension||e[0].Name]},{uid:"valueAxis",type:"Measure",values:n.map(t,function(e){return e.Name})}]}}function l(e,t){return e.length<1||t.length<1?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,1])}]}:{Feeds:[{uid:"color",type:"Dimension",values:[e[0].Name]},{uid:"size",type:"Measure",values:[t[0].Name]}]}}function g(e,t,a){if(e.length<2||t.length<1){return{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,1])}]}}var i=[{uid:"categoryAxis",type:"Dimension",values:[a.catDimension||e[0].Name]},{uid:"color",type:"Measure",values:[t[0].Name]}];if(a.cat2Dimension){i.push({uid:"categoryAxis2",type:"Dimension",values:[a.cat2Dimension]})}return{Feeds:i}}function m(e,t,a){return e.length<1||t.length<1?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[2,1])}]}:{Feeds:[{uid:"valueAxis",type:"Measure",values:[t[0].Name]},{uid:"categoryAxis",type:"Dimension",values:[a.catDimension||e[0].Name]},{uid:"color",type:"Dimension",values:[a.colDimension]}]}}function o(e,t){return e.length<1||t.length<3?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,3])}]}:{Feeds:[{uid:"valueAxis",type:"Measure",values:[t[0].Name]},{uid:"valueAxis2",type:"Measure",values:[t[1].Name]},{uid:"bubbleWidth",type:"Measure",values:[t[2].Name]},{uid:"color",type:"Dimension",values:[e[0].Name]}]}}function p(e,t){return e.length<2||t.length<3?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[2,2])}]}:{Feeds:[{uid:"title",type:"Dimension",values:[e[0].Name]},{uid:"title",type:"Dimension",values:[e[1].Name]},{uid:"color",type:"Measure",values:[t[0].Name]},{uid:"weight",type:"Measure",values:[t[1].Name]}]}}function c(e,t){return e.length<1||t.length<2?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,2])}]}:{Feeds:[{uid:"valueAxis",type:"Measure",values:[t[0].Name]},{uid:"valueAxis2",type:"Measure",values:[t[1].Name]},{uid:"color",type:"Dimension",values:[e[0].Name]}]}}function d(e,t){return e.length<2||t.length<1?{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[2,1])}]}:{Feeds:[{uid:"valueAxis",type:"Measure",values:[t[0].Name]},{uid:"categoryAxis",type:"Dimension",values:[e[0].Name]},{uid:"waterfallType",type:"Dimension",values:[e[1].Name]}]}}function y(e,t){return e.length<1?{Messages:[{msgText:r.getText("CHARTTYPE_NEED_SUPPORTED",[1])}]}:{Feeds:[{uid:"categoryAxis",type:"Dimension",values:[e[0].Name]},{uid:"valueAxis",type:"Measure",values:n.map(t,function(e){return e.Name})}]}}function f(e,t){return e.length<1?{Messages:[{msgText:r.getText("CHARTTYPE_NEED_SUPPORTED",[1])}]}:{Feeds:[{uid:"timeAxis",type:"Dimension",values:[e[0].Name]},{uid:"valueAxis",type:"Measure",values:n.map(t,function(e){return e.Name})}]}}function T(e,t){if(e.length<1||t.length<3&&t.length<2){return{Messages:[{msgText:r.getText("CHARTTYPE_NEEDS_SUPPORTED",[1,2])}]}}var a=[{uid:"actualValues",type:"Measure",values:[t[0].Name]},{uid:"targetValues",type:"Measure",values:[t[1].Name]},{uid:"categoryAxis",type:"Dimension",values:[e[0].Name]}];if(t.length>2){a.push({uid:"additionalValues",type:"Measure",values:[t[2].Name]})}return{Feeds:a}}u.calculateFeeds=function e(t,a,i,n){switch(t){case"bar":return s(a,i,n);case"column":return s(a,i,n);case"bubble":return o(a,i);case"stacked_column":return m(a,i,n);case"pie":return l(a,i);case"donut":return l(a,i);case"stacked_bar":return m(a,i,n);case"vertical_bullet":return T(a,i);case"horizontal_bullet":return T(a,i);case"heatmap":return g(a,i,n);case"line":return y(a,i);case"time_line":return f(a,i);case"scatter":return c(a,i);case"waterfall":return d(a,i);case"horizontal_waterfall":return d(a,i);case"treemap":return p(a,i);default:return{Messages:[{msgText:r.getText("CHARTTYPE_NOT_SUPPORTED",[t])}]}}};u.transformVariable=function(e){return{Name:e.getNameExternal()||e.getName(),Dimension:e.getDimension&&e.getDimension()&&(e.getDimension().getExternalName()||e.getDimension().getName()),ValueType:e.getValueType().getName(),VariableType:e.getVariableType().getName(),Description:e.getText(),Mandatory:e.isMandatory(),SupportsMultipleValues:e.supportsMultipleValues(),TechName:e.getName(),InputEnabled:e.isInputEnabled(),Position:e.getVariableOrder(),SupportsValueHelp:e.supportsValueHelp&&e.supportsValueHelp(),Hints:{IsDate:e.getValueType().getName()===t.Date,IsNoDate:e.getValueType().getName()!==t.Date},MemberFilter:e.getMemberFilter?n.map(a.arrayFromList(e.getMemberFilter()),function(e){var t=e.getDimension();var a=t&&t.getTextField()&&e.getLow().getSupplementValueString(e.getDimension().getTextField().getName())?e.getLow().getSupplementValueString(e.getDimension().getTextField().getName()):e.getLow().getString();var i=t&&t.getTextField()&&e.getHigh().getSupplementValueString(e.getDimension().getTextField().getName())?e.getHigh().getSupplementValueString(e.getDimension().getTextField().getName()):e.getHigh().getString();var r=i?[a,i].join(" - "):a;if(e.getSetSign()===sap.firefly.SetSign.EXCLUDING){r="!( "+r+")"}return{Low:e.getLow().getString(),High:e.getHigh().getString(),ComparisonOperator:e.getComparisonOperator().getName(),Text:r,IsExcluding:e.getSetSign().getName()}}):function(){var t=e.getValueByString();if(!t){return[]}return[{Low:t,ComparisionOperator:"EQUAL",Text:t,IsExcluding:false}]}()}}}return new u});
//# sourceMappingURL=ResultSetHelper.js.map
/*!
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/sac/df/firefly/ff0005.language.ext","sap/sac/df/firefly/ff2100.runtime"],function(e){"use strict";e.RpcSqlInaUtil={QY_MESSAGES:"Messages",QY_MESSAGE_CLASS:"MessageClass",QY_NUMBER:"Number",QY_TYPE:"Type",QY_TEXT:"Text",VA_SEVERITY_ERROR:2,createErrorResponse:function(t){var r=e.PrFactory.createStructure();var n=r.putNewList(e.RpcSqlInaUtil.QY_MESSAGES);var i=t.size();for(var o=0;o<i;o++){var a=t.get(o);var l=n.addNewStructure();l.putString(e.RpcSqlInaUtil.QY_TEXT,a.getText());l.putInteger(e.RpcSqlInaUtil.QY_TYPE,e.RpcSqlInaUtil.VA_SEVERITY_ERROR);l.putInteger(e.RpcSqlInaUtil.QY_NUMBER,a.getCode());l.putString(e.RpcSqlInaUtil.QY_MESSAGE_CLASS,"RpcSql")}return r},getErrors:function(t){var r=e.XList.create();if(e.notNull(t)&&t.isStructure()){var n=t.asStructure().getByKey(e.RpcSqlInaUtil.QY_MESSAGES);if(e.notNull(n)&&n.isList()){var i=n.asList();for(var o=0,a=i.size();o<a;o++){if(i.getStructureAt(o).getIntegerByKey(e.RpcSqlInaUtil.QY_TYPE)===e.RpcSqlInaUtil.VA_SEVERITY_ERROR){r.add(e.XMessage.createError("RpcSql",i.getStructureAt(o).getStringByKey(e.RpcSqlInaUtil.QY_TEXT),null,false,null))}}}}return r}};e.SqlAccessControl=function(){};e.SqlAccessControl.prototype=new e.XObject;e.SqlAccessControl.prototype._ff_c="SqlAccessControl";e.SqlAccessControl.create=function(t){var r=new e.SqlAccessControl;r.m_allowed_schemas=e.XListOfString.create();r.m_allowed_tables=e.XList.create();r.m_parent=t;return r};e.SqlAccessControl.create2=function(){return e.SqlAccessControl.create(null)};e.SqlAccessControl.loadAccessControlFile=function(t){var r=e.XHashMapByString.create();var n=t.asStructure();var i=n.getKeysAsReadOnlyListOfString();for(var o=0;o<i.size();o++){var a=i.get(o);r.put(a,e.SqlAccessControl.create2().importJson(n.getStructureByKey(a)))}return r};e.SqlAccessControl.prototype.m_parent=null;e.SqlAccessControl.prototype.m_allowed_schemas=null;e.SqlAccessControl.prototype.m_allowed_tables=null;e.SqlAccessControl.prototype.allowSchema=function(e){this.m_allowed_schemas.add(e)};e.SqlAccessControl.prototype.allowTable=function(t){this.m_allowed_tables.add(e.SqlReference.create(t))};e.SqlAccessControl.prototype.allowTable2=function(t,r){this.m_allowed_tables.add(e.SqlReference.create2(t,r))};e.SqlAccessControl.prototype.hasAccess=function(t){var r=t.getComponents().size()===2?t.getComponents().get(0):"";var n;for(n=0;n<this.m_allowed_schemas.size();n++){if(e.XString.isEqual(r,this.m_allowed_schemas.get(n))){return true}}for(n=0;n<this.m_allowed_tables.size();n++){var i=this.m_allowed_tables.get(n).getComponents().size();if(t.getComponents().size()!==i){continue}var o;for(o=0;o<i;o++){if(!e.XString.isEqual(t.getComponents().get(o),this.m_allowed_tables.get(n).getComponents().get(o))){break}}if(o===i){return true}}if(e.notNull(this.m_parent)){return this.m_parent.hasAccess(t)}return false};e.SqlAccessControl.prototype.importJson=function(t){var r;var n=t.getListByKey("allowedSchemas");if(e.notNull(n)){for(r=0;r<n.size();r++){var i=n.getStringAt(r);this.allowSchema(i)}}var o=t.getListByKey("allowedTables");if(e.notNull(o)){for(r=0;r<o.size();r++){var a=o.getStringAt(r);var l=e.SqlTokenizer.create(a);var s=l.parsePlainOrReference();if(e.isNull(s)||!l.endOfInput()){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Unexpected sql table identifier {0}",e.StringListBuilder.create().add(a).build()))}if(s.getType()===e.SqlTokenType.PLAIN){this.allowTable(s.asSqlPlainToken().getString())}else{this.m_allowed_tables.add(s.asSqlReferenceToken().getReference())}}}return this};e.SqlAccessControl.prototype.toJson=function(){var t=new e.SqlCodeGenOptions;t.referenceQuotes='"';t.stringQuotes="'";var r;var n=e.PrFactory.createStructure();var i=n.putNewList("allowedSchemas");for(r=0;r<this.m_allowed_schemas.size();r++){i.addString(this.m_allowed_schemas.get(r))}var o=n.getListByKey("allowedTables");for(r=0;r<this.m_allowed_tables.size();r++){o.addString(this.m_allowed_tables.get(r).toSqlString(t))}return n};e.SqlValidateAccess=function(){};e.SqlValidateAccess.prototype=new e.XObject;e.SqlValidateAccess.prototype._ff_c="SqlValidateAccess";e.SqlValidateAccess.create=function(t,r){var n=new e.SqlValidateAccess;n.m_tokenizer=e.SqlTokenizer.create(t);n.m_tokenizer.next();n.m_access=r;n.m_errors=e.XListOfString.create();return n};e.SqlValidateAccess.main=function(){e.SqlModule.getInstance();var t=e.DefaultSession.create();var r=e.SqlAccessControl.create2();r.allowTable("test");r.allowSchema("mydb");r.allowTable("facts");var n=(new e.ListBuilder).init().build();n.add(e.XPair.create(e.XStringValue.create('select * from "facts" UNION select (\'___INA_SQL_TOTAL\') AS "YEAR" from "facts"'),e.XBooleanValue.create(true)));var i=0;for(var o=0;o<n.size();o++){var a=n.get(o).getFirstObject().getString();var l=e.SqlValidateAccess.create(a,r).validate();if(l!==n.get(o).getSecondObject().getBoolean()){i++;t.getLogger().logError("Test failed unexpected result:");t.getLogger().logError(a);t.getLogger().logError(e.XBoolean.convertToString(l))}}t.getLogger().logError2("Failed Tests:",e.XInteger.convertToString(i))};e.SqlValidateAccess.prototype.m_tokenizer=null;e.SqlValidateAccess.prototype.m_access=null;e.SqlValidateAccess.prototype.m_errors=null;e.SqlValidateAccess.prototype.validateSelectJoinAlias=function(){var t=this.m_tokenizer.getCurrentDepth();var r=this.m_tokenizer.next();if(r.getType()===e.SqlTokenType.PLAIN||r.getType()===e.SqlTokenType.REFERENCE){r=this.m_tokenizer.next()}if(r.getType()===e.SqlTokenType.OPERATOR&&e.XString.isEqual(r.asSqlOperatorToken().getString(),",")){return this.validateSelectJoins()}while(t<=this.m_tokenizer.getCurrentDepth()){r=this.m_tokenizer.next();if(e.isNull(r)){return true}if(r.getType()===e.SqlTokenType.PLAIN){if(t===this.m_tokenizer.getCurrentDepth()&&e.XString.isEqual(r.asSqlPlainToken().getString(),"union")){this.m_tokenizer.next();return this.validate()}if(e.XString.isEqual(r.asSqlPlainToken().getString(),"select")){this.m_errors.add("Queries after from and joins are not supported");return false}}}return true};e.SqlValidateAccess.prototype.validateSelectJoin=function(){var t=this.m_tokenizer.next();if(e.isNull(t)){return false}if(t.getType()===e.SqlTokenType.REFERENCE&&this.m_access.hasAccess(t.asSqlReferenceToken().getReference())||t.getType()===e.SqlTokenType.PLAIN&&this.m_access.hasAccess(e.SqlReference.create(t.asSqlPlainToken().getString()))){return this.validateSelectJoinAlias()}else if(t.getType()===e.SqlTokenType.OPERATOR&&e.XString.isEqual(t.asSqlOperatorToken().getString(),"(")){this.m_tokenizer.next();if(!this.validate()){return false}return this.validateSelectJoinAlias()}return false};e.SqlValidateAccess.prototype.validateSelectJoins=function(){var t=this.m_tokenizer.getCurrent();if(t.getType()===e.SqlTokenType.PLAIN){if(e.XString.isEqual(t.asSqlPlainToken().getString(),"inner")){t=this.m_tokenizer.next();if(t.getType()===e.SqlTokenType.PLAIN&&e.XString.isEqual(t.asSqlPlainToken().getString(),"join")){return this.validateSelectJoin()}return false}else if(e.XString.isEqual(t.asSqlPlainToken().getString(),"full")||e.XString.isEqual(t.asSqlPlainToken().getString(),"left")||e.XString.isEqual(t.asSqlPlainToken().getString(),"right")){t=this.m_tokenizer.next();if(t.getType()===e.SqlTokenType.PLAIN&&e.XString.isEqual(t.asSqlPlainToken().getString(),"outer")){t=this.m_tokenizer.next()}if(t.getType()===e.SqlTokenType.PLAIN&&e.XString.isEqual(t.asSqlPlainToken().getString(),"join")){return this.validateSelectJoin()}return false}}var r=this.m_tokenizer.getCurrentDepth();while(r<=this.m_tokenizer.getCurrentDepth()){var n=this.m_tokenizer.getCurrent();if(e.isNull(n)){return true}if(n.getType()===e.SqlTokenType.PLAIN){if(e.XString.isEqual(n.asSqlPlainToken().getString(),"select")){return false}}this.m_tokenizer.next()}return true};e.SqlValidateAccess.prototype.isSqlKeyword=function(t){var r=e.StringListBuilder.create().add("select").add("true").add("false").add("null").add("with").add("inner").add("join").add("outer").add("left").add("right").add("full").add("from").add("on").add("and").add("or").add("like").add("order").add("group").add("by").add("limit").add("offset").add("asc").add("desc").add("top").add("where").add("not").add("in").add("union").build();for(var n=0;n<r.size();n++){if(e.XString.isEqual(t,r.get(n))){return true}}return false};e.SqlValidateAccess.prototype.validateSelectAlias=function(){var t=this.m_tokenizer.getCurrentDepth();var r=this.m_tokenizer.next();if(this.m_tokenizer.endOfInput()&&e.isNull(r)){return true}if(e.isNull(r)){throw e.XException.createIllegalStateException("NO")}if(r.getType()===e.SqlTokenType.PLAIN&&!this.isSqlKeyword(r.asSqlPlainToken().getString())||r.getType()===e.SqlTokenType.REFERENCE){r=this.m_tokenizer.next();if(this.m_tokenizer.endOfInput()&&e.isNull(r)){return true}}if(e.isNull(r)){throw e.XException.createIllegalStateException("NO")}if(r.getType()===e.SqlTokenType.OPERATOR&&e.XString.isEqual(r.asSqlOperatorToken().getString(),",")){return this.validateSelectFrom()}if(t===this.m_tokenizer.getCurrentDepth()&&e.XString.isEqual(r.asSqlPlainToken().getString(),"union")){this.m_tokenizer.next();return this.validate()}return t>this.m_tokenizer.getCurrentDepth()||this.validateSelectJoins()};e.SqlValidateAccess.prototype.validateSelectFrom=function(){var t=this.m_tokenizer.next();if(e.isNull(t)){return false}if(t.getType()===e.SqlTokenType.REFERENCE&&this.m_access.hasAccess(t.asSqlReferenceToken().getReference())||t.getType()===e.SqlTokenType.PLAIN&&!this.isSqlKeyword(t.asSqlPlainToken().getString())&&this.m_access.hasAccess(e.SqlReference.create(t.asSqlPlainToken().getString()))){return this.validateSelectAlias()}else if(t.getType()===e.SqlTokenType.OPERATOR&&e.XString.isEqual(t.asSqlOperatorToken().getString(),"(")){this.m_tokenizer.next();if(!this.validate()){return false}return this.validateSelectAlias()}return false};e.SqlValidateAccess.prototype.validateSelect=function(){var t=this.m_tokenizer.getCurrentDepth();while(t<=this.m_tokenizer.getCurrentDepth()){var r=this.m_tokenizer.next();if(e.isNull(r)){return false}if(r.getType()===e.SqlTokenType.PLAIN){if(e.XString.isEqual(r.asSqlPlainToken().getString(),"select")){this.m_errors.add("SubQueries before from and joins are not supported");return false}if(t===this.m_tokenizer.getCurrentDepth()&&e.XString.isEqual(r.asSqlPlainToken().getString(),"from")){return this.validateSelectFrom()}}}return false};e.SqlValidateAccess.prototype.validateWith=function(){var t=this.m_tokenizer.next();if(e.isNull(t)||t.getType()!==e.SqlTokenType.PLAIN&&t.getType()!==e.SqlTokenType.REFERENCE){return false}var r=e.SqlAccessControl.create(this.m_access);r.allowTable(t.getType()===e.SqlTokenType.PLAIN?t.asSqlPlainToken().getString():t.asSqlReferenceToken().getReference().getComponents().get(0));var n=new e.SqlValidateAccess;n.m_access=r;n.m_tokenizer=this.m_tokenizer;t=this.m_tokenizer.next();if(e.isNull(t)||t.getType()!==e.SqlTokenType.PLAIN||!e.XString.isEqual(t.asSqlPlainToken().getString(),"as")){return false}t=this.m_tokenizer.next();if(e.isNull(t)||t.getType()!==e.SqlTokenType.OPERATOR||!e.XString.isEqual(t.asSqlOperatorToken().getString(),"(")){return false}this.m_tokenizer.next();if(!this.validate()){return false}if(this.m_tokenizer.getCurrent().getType()!==e.SqlTokenType.OPERATOR||!e.XString.isEqual(this.m_tokenizer.getCurrent().asSqlOperatorToken().getString(),")")){return false}t=this.m_tokenizer.next();if(e.isNull(t)){return false}if(t.getType()===e.SqlTokenType.OPERATOR&&e.XString.isEqual(t.asSqlOperatorToken().getString(),",")){return n.validateWith()}return n.validate()};e.SqlValidateAccess.prototype.validate=function(){var t=this.m_tokenizer.getCurrent();if(e.isNull(t)||t.getType()!==e.SqlTokenType.PLAIN){return false}if(e.XString.isEqual(t.asSqlPlainToken().getString(),"select")){return this.validateSelect()}if(e.XString.isEqual(t.asSqlPlainToken().getString(),"with")){return this.validateWith()}return false};e.SqlCodeGenOptions=function(){};e.SqlCodeGenOptions.prototype=new e.XObject;e.SqlCodeGenOptions.prototype._ff_c="SqlCodeGenOptions";e.SqlCodeGenOptions.prototype.referenceQuotes='"';e.SqlCodeGenOptions.prototype.stringQuotes="'";e.SqlCodeGenOptions.prototype.hasWith=true;e.SqlCodeGenOptions.prototype.hasSubqueries=true;e.SqlCodeGenOptions.prototype.noQuote=false;e.SqlJoin=function(){};e.SqlJoin.prototype=new e.XObject;e.SqlJoin.prototype._ff_c="SqlJoin";e.SqlJoin.create=function(t,r){var n=new e.SqlJoin;if(e.XStringUtils.containsString(t," on",true)){throw e.XException.createIllegalArgumentException("jointype contains a space")}n.m_jointype=t;n.m_table=r;n.m_on=null;return n};e.SqlJoin.prototype.m_jointype=null;e.SqlJoin.prototype.m_table=null;e.SqlJoin.prototype.m_on=null;e.SqlJoin.prototype.on=function(e){this.m_on=e;return this};e.SqlJoin.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();r.append(this.m_jointype);r.append(" ");r.append(this.m_table.toSqlString(t));if(e.notNull(this.m_on)){r.append(" on ");r.append(this.m_on)}var n=r.toString();e.XObjectExt.release(r);return n};e.SqlJoin.prototype.ReplaceTableSource=function(t,r){if(this.m_table.isEqualTableSource(t)){return e.SqlJoin.create(this.m_jointype,r).on(this.m_on)}return this};e.SqlOperation=function(){};e.SqlOperation.prototype=new e.XObject;e.SqlOperation.prototype._ff_c="SqlOperation";e.SqlOperation.create=function(t,r){var n=new e.SqlOperation;n.m_format=t;n.m_operants=r;return n};e.SqlOperation.format=function(t,r){var n=e.XStringBuffer.create();for(var i=0;i<e.XString.size(t);){var o=e.XString.indexOfFrom(t,"{",i);var a=e.XString.indexOfFrom(t,"}",i);if(o===-1||a<o){if(a!==-1){if(a+1>=e.XString.size(t)){throw e.XException.createIllegalArgumentException("invalid format string")}n.append(e.XString.substring(t,i,a+1));if(!e.XString.isEqual(e.XString.substring(t,a+1,a+2),"}")){throw e.XException.createIllegalArgumentException("invalid format string")}i=a+2}else{n.append(e.XString.substring(t,i,-1));i=e.XString.size(t)}}else if(o+1>=e.XString.size(t)){throw e.XException.createIllegalArgumentException("invalid format string")}else if(e.XString.isEqual(e.XString.substring(t,o+1,o+2),"{")){n.append(e.XString.substring(t,i,o+1));i=o+2}else{n.append(e.XString.substring(t,i,o));var l=e.XInteger.convertFromString(e.XString.substring(t,o+1,a));if(l<0||l>=r.size()){throw e.XException.createIllegalArgumentException("index out of range")}n.append(r.get(l));i=a+1}}return n.toString()};e.SqlOperation.parseStringLiteral=function(t,r){var n=e.XListOfString.create();n.add(t);if(!e.XString.match(r,e.SqlOperation.format("^{0}({0}{0}|[^{0}])*{0}",n))){return null}var i=e.XString.substring(r,1,-1);for(var o=0;o+1<e.XString.size(i);o++){if(e.XString.isEqual(e.XString.substring(i,o,o+1),t)){if(e.XString.isEqual(e.XString.substring(i,o+1,o+2),t)){i=e.XStringUtils.concatenate2(e.XString.substring(i,0,o+1),e.XString.substring(i,o+2,-1))}else{break}}}return e.SqlStringConstant.create(i)};e.SqlOperation.main=function(){var t=e.SqlOperation.parseValue("'Hello World'",new e.SqlCodeGenOptions);t.isEqualTo(null);t=e.SqlOperation.parseValue("  'Hello World'",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  +2.5",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  +2.",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  +.1",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  -.1",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  +2e+4",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  +2e-4",new e.SqlCodeGenOptions);t=e.SqlOperation.parseValue("  -.3e-4",new e.SqlCodeGenOptions)};e.SqlOperation.parseNumber=function(t){var r=t;var n=0;if(e.XString.match(r,"^[\\+-]")){n++}for(;n<e.XString.size(r);n++){if(!e.XString.match(e.XString.substring(r,n,-1),"^[0-9]")){break}}var i=n;if(e.XString.match(e.XString.substring(r,n,-1),"^\\.")){for(i=n+1;i<e.XString.size(r);i++){if(!e.XString.match(e.XString.substring(r,i,-1),"^[0-9]")){break}}}var o=0;if(i+2<e.XString.size(r)&&e.XString.match(e.XString.substring(r,i,-1),"^e")){o=i+1;if(e.XString.match(e.XString.substring(r,o,-1),"^[+-]")){o++}for(;o<e.XString.size(r);o++){if(!e.XString.match(e.XString.substring(r,o,-1),"^[0-9]")){break}}}if(i>n||o>0){return e.SqlDoubleConstant.create(e.XDouble.convertFromString(e.XString.substring(r,0,o>0?o:i)))}return e.SqlIntegerConstant.create(e.XLong.convertFromString(e.XString.substring(r,0,n)))};e.SqlOperation.parseValue=function(t,r){var n=t;while(e.XString.match(n,"^\\s")){n=e.XString.substring(n,1,-1)}var i=e.SqlOperation.parseStringLiteral(r.stringQuotes,n);if(e.notNull(i)){return i}i=e.SqlOperation.parseStringLiteral(r.referenceQuotes,n);if(e.notNull(i)){return i}if(e.XString.match(n,"^\\(")){i=e.SqlOperation.parseValue(e.XString.substring(n,1,-1),r);if(e.notNull(i)){return i}}if(e.XString.match(n,"^[\\+-]?([0-9]+(\\.[0-9]*)?|\\.[0-9]+)(e[+-]?[0-9]+)?")){i=e.SqlOperation.parseNumber(n);if(e.notNull(i)){return i}}return null};e.SqlOperation.and=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) and ({1})",n)};e.SqlOperation.or=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) or ({1})",n)};e.SqlOperation.equals=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) = ({1})",n)};e.SqlOperation.less=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) < ({1})",n)};e.SqlOperation.greater=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) > ({1})",n)};e.SqlOperation.lessEqual=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) <= ({1})",n)};e.SqlOperation.greaterEqual=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) >= ({1})",n)};e.SqlOperation._in=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) in ({1})",n)};e.SqlOperation.between=function(t,r,n){var i=e.XList.create();i.add(t);i.add(r);i.add(n);return e.SqlOperation.create("({0}) between ({1}) and ({2})",i)};e.SqlOperation.not=function(t){var r=e.XList.create();r.add(t);return e.SqlOperation.create("not ({0})",r)};e.SqlOperation.exists=function(t){var r=e.XList.create();r.add(t);return e.SqlOperation.create("exists ({0})",r)};e.SqlOperation.like=function(t,r){var n=e.XList.create();n.add(t);n.add(r);return e.SqlOperation.create("({0}) like ({1})",n)};e.SqlOperation.prototype.m_format="";e.SqlOperation.prototype.m_operants=null;e.SqlOperation.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();for(var n=0;n<e.XString.size(this.m_format);){var i=e.XString.indexOfFrom(this.m_format,"{",n);var o=e.XString.indexOfFrom(this.m_format,"}",n);if(i===-1||o<i){if(o!==-1){if(o+1>=e.XString.size(this.m_format)){throw e.XException.createIllegalArgumentException("invalid format string")}r.append(e.XString.substring(this.m_format,n,o+1));if(!e.XString.isEqual(e.XString.substring(this.m_format,o+1,o+2),"}")){throw e.XException.createIllegalArgumentException("invalid format string")}n=o+2}else{r.append(e.XString.substring(this.m_format,n,-1));n=e.XString.size(this.m_format)}}else if(i+1>=e.XString.size(this.m_format)){throw e.XException.createIllegalArgumentException("invalid format string")}else if(e.XString.isEqual(e.XString.substring(this.m_format,i+1,i+2),"{")){r.append(e.XString.substring(this.m_format,n,i+1));n=i+2}else{r.append(e.XString.substring(this.m_format,n,i));var a=e.XInteger.convertFromString(e.XString.substring(this.m_format,i+1,o));if(a<0||a>=this.m_operants.size()){throw e.XException.createIllegalArgumentException("index out of range")}r.append(this.m_operants.get(a).toSqlString(t));n=o+1}}return r.toString()};e.SqlOperation.prototype.ReplaceTableSource=function(e,t){return this};e.SqlParser=function(){};e.SqlParser.prototype=new e.XObject;e.SqlParser.prototype._ff_c="SqlParser";e.SqlParser.format=function(t,r){var n=e.XStringBuffer.create();for(var i=0;i<e.XString.size(t);){var o=e.XString.indexOfFrom(t,"{",i);var a=e.XString.indexOfFrom(t,"}",i);if(o===-1||a<o){if(a!==-1){if(a+1>=e.XString.size(t)){throw e.XException.createIllegalArgumentException("invalid format string")}n.append(e.XString.substring(t,i,a+1));if(!e.XString.isEqual(e.XString.substring(t,a+1,a+2),"}")){throw e.XException.createIllegalArgumentException("invalid format string")}i=a+2}else{n.append(e.XString.substring(t,i,-1));i=e.XString.size(t)}}else if(o+1>=e.XString.size(t)){throw e.XException.createIllegalArgumentException("invalid format string")}else if(e.XString.isEqual(e.XString.substring(t,o+1,o+2),"{")){n.append(e.XString.substring(t,i,o+1));i=o+2}else{n.append(e.XString.substring(t,i,o));var l=e.XInteger.convertFromString(e.XString.substring(t,o+1,a));if(l<0||l>=r.size()){throw e.XException.createIllegalArgumentException("index out of range")}n.append(r.get(l));i=a+1}}return n.toString()};e.SqlParser.format1=function(t,r){var n=e.XListOfString.create();n.add(r);return e.SqlParser.format(t,n)};e.SqlParser.format2=function(t,r,n){var i=e.XListOfString.create();i.add(r);i.add(n);return e.SqlParser.format(t,i)};e.SqlParser.format3=function(t,r,n,i){var o=e.XListOfString.create();o.add(r);o.add(n);o.add(i);return e.SqlParser.format(t,o)};e.SqlParser.main=function(){e.SqlParser.test()};e.SqlParser.create=function(t){var r=new e.SqlParser;r.m_statement=t;return r};e.SqlParser.test=function(){var t=e.SqlParser.create("'Hello World'").parseValue(new e.SqlCodeGenOptions);t.isEqualTo(null);t=e.SqlParser.create("  'Hello World'").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  +2.5").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  +2.").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  +.1").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  -.1").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  +2e+4").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  +2e-4").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  -.3e-4").parseValue(new e.SqlCodeGenOptions);t=e.SqlParser.create("  -.3e-4 = `Hello World` and 'x' = 'y' or 'y' = 'y' and 'x' = 'x' ").parseCondition2(new e.SqlCodeGenOptions,0);e.XLogger.println(t.toSqlString(new e.SqlCodeGenOptions))};e.SqlParser.prototype.m_statement="";e.SqlParser.prototype.position=0;e.SqlParser.prototype.getStatement=function(){return e.XString.substring(this.m_statement,this.position,-1)};e.SqlParser.prototype.updatePosition=function(e){this.position=this.position+e};e.SqlParser.prototype.getStatementUpdatePosition=function(t){var r=e.XString.substring(this.m_statement,this.position,this.position+t);this.position=this.position+t;return r};e.SqlParser.prototype.parseStringLiteral=function(t){var r=e.XListOfString.create();r.add(t);if(!e.XString.match(this.getStatement(),e.SqlParser.format("^{0}({0}{0}|[^{0}])*{0}",r))){return null}var n=e.XString.substring(this.getStatement(),1,-1);var i=0;for(;i+1<e.XString.size(n);i++){if(e.XString.isEqual(e.XString.substring(n,i,i+1),t)){if(e.XString.isEqual(e.XString.substring(n,i+1,i+2),t)){n=e.XStringUtils.concatenate2(e.XString.substring(n,0,i+1),e.XString.substring(n,i+2,-1))}else{break}}}this.updatePosition(i+2);return e.XString.substring(n,0,i)};e.SqlParser.prototype.parseNumber=function(){var t=0;if(e.XString.match(this.getStatement(),"^[\\+-]")){t++}for(;t<e.XString.size(this.getStatement());t++){if(!e.XString.match(e.XString.substring(this.getStatement(),t,-1),"^[0-9]")){break}}var r=t;if(e.XString.match(e.XString.substring(this.getStatement(),t,-1),"^\\.")){for(r=t+1;r<e.XString.size(this.getStatement());r++){if(!e.XString.match(e.XString.substring(this.getStatement(),r,-1),"^[0-9]")){break}}}var n=0;if(r+2<e.XString.size(this.getStatement())&&e.XString.match(e.XString.substring(this.getStatement(),r,-1),"^e")){n=r+1;if(e.XString.match(e.XString.substring(this.getStatement(),n,-1),"^[+-]")){n++}for(;n<e.XString.size(this.getStatement());n++){if(!e.XString.match(e.XString.substring(this.getStatement(),n,-1),"^[0-9]")){break}}}if(r>t||n>0){return e.SqlDoubleConstant.create(e.XDouble.convertFromString(this.getStatementUpdatePosition(n>0?n:r)))}return e.SqlIntegerConstant.create(e.XLong.convertFromString(this.getStatementUpdatePosition(t)))};e.SqlParser.prototype.skipWhiteSpace=function(){var t=false;while(e.XString.match(this.getStatement(),"^\\s")){t=true;this.updatePosition(1)}return t};e.SqlParser.prototype.parseValue=function(t){this.skipWhiteSpace();var r=this.parseStringLiteral(t.stringQuotes);if(e.notNull(r)){return e.SqlStringConstant.create(r)}r=this.parseStringLiteral(t.referenceQuotes);if(e.notNull(r)){this.skipWhiteSpace();if(!e.XString.match(this.getStatement(),"^\\.")){return e.SqlReference.create(r)}this.updatePosition(1);var n=this.parseStringLiteral(t.referenceQuotes);this.skipWhiteSpace();if(e.notNull(n)&&!e.XString.match(this.getStatement(),"^\\.")){return e.SqlReference.create2(r,n)}this.updatePosition(1);var i=this.parseStringLiteral(t.referenceQuotes);this.skipWhiteSpace();if(e.notNull(n)){return e.SqlReference.create3(r,n,i)}}var o;if(e.XString.match(this.getStatement(),"^\\(")){this.updatePosition(1);o=this.parseValue(t);if(e.notNull(o)){this.skipWhiteSpace();if(!e.XString.match(this.getStatement(),"^\\)")){throw e.XException.createIllegalArgumentException(e.SqlParser.format1("Syntax error at position {0}",e.XInteger.convertToString(this.position)))}this.updatePosition(1);return o}}if(e.XString.match(this.getStatement(),"^[\\+-]?([0-9]+(\\.[0-9]*)?|\\.[0-9]+)(e[+-]?[0-9]+)?")){o=this.parseNumber();if(e.notNull(o)){return o}}return null};e.SqlParser.prototype.parseArtihmetic=function(t,r){this.skipWhiteSpace();if(e.XString.match(this.getStatement(),"^\\(")){this.updatePosition(1);var n=this.parseArtihmetic(t,0);if(e.notNull(n)){this.skipWhiteSpace();if(!e.XString.match(this.getStatement(),"^\\)")){throw e.XException.createIllegalArgumentException(e.SqlParser.format1("Syntax error at position {0}, expected )",e.XInteger.convertToString(this.position)))}this.updatePosition(1);return n}return n}var i=this.parseValue(t);this.skipWhiteSpace();if(e.XString.match(this.getStatement(),"^\\*")){this.updatePosition(1);return null}return i};e.SqlParser.prototype.parseCondition=function(t,r){this.skipWhiteSpace();if(e.XString.match(this.getStatement(),"^\\(")){this.updatePosition(1);var n=this.parseCondition(t,0);if(e.notNull(n)){this.skipWhiteSpace();if(!e.XString.match(this.getStatement(),"^\\)")){throw e.XException.createIllegalArgumentException(e.SqlParser.format1("Syntax error at position {0}, expected )",e.XInteger.convertToString(this.position)))}this.updatePosition(1);return n}return n}var i=this.parseValue(t);var o;this.skipWhiteSpace();if(e.XString.match(this.getStatement(),"^\\=")){this.updatePosition(1);o=this.parseValue(t);return e.SqlOperation.equals(i,o)}if(e.XString.match(this.getStatement(),"^\\<")){this.updatePosition(1);o=this.parseValue(t);return e.SqlOperation.less(i,o)}if(e.XString.match(this.getStatement(),"^\\>")){this.updatePosition(1);o=this.parseValue(t);return e.SqlOperation.greater(i,o)}if(e.XString.match(this.getStatement(),"^\\<=")){this.updatePosition(1);o=this.parseValue(t);return e.SqlOperation.lessEqual(i,o)}if(e.XString.match(this.getStatement(),"^\\>=")){this.updatePosition(1);o=this.parseValue(t);return e.SqlOperation.greaterEqual(i,o)}return null};e.SqlParser.prototype.parseCondition2=function(t,r){var n;this.skipWhiteSpace();if(r<=2&&e.XString.match(this.getStatement(),"^\\not")){this.updatePosition(1);n=this.parseCondition(t,3);return e.SqlOperation.not(n)}var i=null;if(e.XString.match(this.getStatement(),"^\\(")){this.updatePosition(1);var o=this.parseCondition2(t,0);if(e.notNull(o)){this.skipWhiteSpace();if(!e.XString.match(this.getStatement(),"^\\)")){throw e.XException.createIllegalArgumentException(e.SqlParser.format1("Syntax error at position {0}, expected )",e.XInteger.convertToString(this.position)))}this.updatePosition(1);i=o}}if(e.isNull(i)){i=this.parseCondition(t,r)}while(e.XString.size(this.getStatement())>0){this.skipWhiteSpace();if(e.XString.size(this.getStatement())===0){break}if(r<=1&&e.XString.match(this.getStatement(),"^and")){this.updatePosition(3);n=this.parseCondition2(t,1);i=e.SqlOperation.and(i,n)}else if(r<=0&&e.XString.match(this.getStatement(),"^or")){this.updatePosition(2);n=this.parseCondition2(t,0);i=e.SqlOperation.or(i,n)}else{break}}return i};e.SqlSubQuery={};e.ListBuilder=function(){};e.ListBuilder.prototype=new e.XObject;e.ListBuilder.prototype._ff_c="ListBuilder";e.ListBuilder.create=function(){return(new e.ListBuilder).init()};e.ListBuilder.create2=function(t){return(new e.ListBuilder).init2(t)};e.ListBuilder.prototype.m_cells=null;e.ListBuilder.prototype.init=function(){this.m_cells=e.XList.create();return this};e.ListBuilder.prototype.init2=function(e){this.m_cells=e;return this};e.ListBuilder.prototype.add=function(e){this.m_cells.add(e);return this};e.ListBuilder.prototype.build=function(){return this.m_cells};e.MapBuilder=function(){};e.MapBuilder.prototype=new e.XObject;e.MapBuilder.prototype._ff_c="MapBuilder";e.MapBuilder.create=function(){return(new e.MapBuilder).init()};e.MapBuilder.create2=function(t){return(new e.MapBuilder).init2(t)};e.MapBuilder.prototype.m_cells=null;e.MapBuilder.prototype.init=function(){this.m_cells=e.XSimpleMap.create();return this};e.MapBuilder.prototype.init2=function(e){this.m_cells=e;return this};e.MapBuilder.prototype.put=function(e,t){this.m_cells.put(e,t);return this};e.MapBuilder.prototype.build=function(){return this.m_cells};e.PrListBuilder=function(){};e.PrListBuilder.prototype=new e.XObject;e.PrListBuilder.prototype._ff_c="PrListBuilder";e.PrListBuilder.create=function(){return(new e.PrListBuilder).init()};e.PrListBuilder.prototype.m_cells=null;e.PrListBuilder.prototype.init=function(){this.m_cells=e.PrFactory.createList();return this};e.PrListBuilder.prototype.add=function(e){this.m_cells.add(e);return this};e.PrListBuilder.prototype.build=function(){return this.m_cells};e.StringListBuilder=function(){};e.StringListBuilder.prototype=new e.XObject;e.StringListBuilder.prototype._ff_c="StringListBuilder";e.StringListBuilder.create=function(){return(new e.StringListBuilder).init()};e.StringListBuilder.create2=function(t){return(new e.StringListBuilder).init2(t)};e.StringListBuilder.prototype.m_cells=null;e.StringListBuilder.prototype.init=function(){this.m_cells=e.XListOfString.create();return this};e.StringListBuilder.prototype.init2=function(e){this.m_cells=e;return this};e.StringListBuilder.prototype.add=function(e){this.m_cells.add(e);return this};e.StringListBuilder.prototype.build=function(){return this.m_cells};e.StringMapBuilder=function(){};e.StringMapBuilder.prototype=new e.XObject;e.StringMapBuilder.prototype._ff_c="StringMapBuilder";e.StringMapBuilder.create=function(){return(new e.StringMapBuilder).init()};e.StringMapBuilder.create2=function(t){return(new e.StringMapBuilder).init2(t)};e.StringMapBuilder.prototype.m_cells=null;e.StringMapBuilder.prototype.init=function(){this.m_cells=e.XHashMapByString.create();return this};e.StringMapBuilder.prototype.init2=function(e){this.m_cells=e;return this};e.StringMapBuilder.prototype.put=function(e,t){this.m_cells.put(e,t);return this};e.StringMapBuilder.prototype.build=function(){return this.m_cells};e.SqlToken=function(){};e.SqlToken.prototype=new e.XObject;e.SqlToken.prototype._ff_c="SqlToken";e.SqlToken.prototype.asSqlPlainToken=function(){return null};e.SqlToken.prototype.asSqlReferenceToken=function(){return null};e.SqlToken.prototype.asSqlStringToken=function(){return null};e.SqlToken.prototype.asSqlNumberToken=function(){return null};e.SqlToken.prototype.asSqlOperatorToken=function(){return null};e.SqlTokenizer=function(){};e.SqlTokenizer.prototype=new e.XObject;e.SqlTokenizer.prototype._ff_c="SqlTokenizer";e.SqlTokenizer.create=function(t){if(e.isNull(e.SqlTokenType.PLAIN)){e.SqlTokenType.staticSetup()}var r=new e.SqlTokenizer;r.m_sql=t;r.m_pos=0;r.m_depth=0;return r};e.SqlTokenizer.startsWithFrom=function(t,r,n){var i=n;var o=n+e.XString.size(r);if(e.XString.size(t)<o){return false}while(i<o){if(e.XString.getCharAt(t,i)!==e.XString.getCharAt(r,i-n)){return false}i++}return i===o};e.SqlTokenizer.main=function(){var t=e.SqlTokenizer.create("SELECT mycol From myTable");while(t.parse()!==null){e.XInteger.convertToString(t.m_pos)}t=e.SqlTokenizer.create("with x as (SELECT mycol From myTable) select * from x UNION select * from x");while(t.parse()!==null){e.XInteger.convertToString(t.m_pos)}};e.SqlTokenizer.prototype.m_sql=null;e.SqlTokenizer.prototype.m_pos=0;e.SqlTokenizer.prototype.m_depth=0;e.SqlTokenizer.prototype.m_current=null;e.SqlTokenizer.prototype.skipSpace=function(){var t=" ";var r=this.m_pos;while(r<e.XString.size(this.m_sql)&&e.XString.getCharAt(this.m_sql,r)===e.XString.getCharAt(t,0)){r++}if(this.m_pos<r){this.m_pos=r;return true}return false};e.SqlTokenizer.prototype.endOfInput=function(){return this.m_pos===e.XString.size(this.m_sql)};e.SqlTokenizer.prototype.expectTokenEnd=function(){if(!this.endOfInput()&&!this.isOperator()&&!this.skipSpace()){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Missing space or end of input after the current token at position {0}",e.StringListBuilder.create().add(e.XInteger.convertToString(this.m_pos)).build()))}};e.SqlTokenizer.prototype.parsePlainToken=function(){var t=this.m_pos;var r="aAzZ_09.";while(t<e.XString.size(this.m_sql)){var n=e.XString.getCharAt(this.m_sql,t);if(n>=e.XString.getCharAt(r,0)&&n<=e.XString.getCharAt(r,2)||n>=e.XString.getCharAt(r,1)&&n<=e.XString.getCharAt(r,3)||n===e.XString.getCharAt(r,4)||t>0&&n>=e.XString.getCharAt(r,5)&&n<=e.XString.getCharAt(r,6)){t++}else{break}}if(this.m_pos<t){var i=e.SqlPlainToken.create(e.XString.toLowerCase(e.XString.substring(this.m_sql,this.m_pos,t)));this.m_pos=t;if(this.endOfInput()||e.XString.getCharAt(this.m_sql,this.m_pos)!==e.XString.getCharAt(r,7)){this.expectTokenEnd()}return i}return null};e.SqlTokenizer.prototype.parseIntegerToken=function(){var t=this.m_pos;var r="09+-";while(t<e.XString.size(this.m_sql)){var n=e.XString.getCharAt(this.m_sql,t);if(n>=e.XString.getCharAt(r,0)&&n<=e.XString.getCharAt(r,1)||t>0&&(n===e.XString.getCharAt(r,2)||n===e.XString.getCharAt(r,3))){t++}else{break}}if(this.m_pos<t){var i=e.XString.substring(this.m_sql,this.m_pos,t);this.m_pos=t;return i}return null};e.SqlTokenizer.prototype.parseNumberToken=function(){var t=this.m_pos;var r=this.parseIntegerToken();var n=null;var i=null;if(this.endOfInput()){return e.notNull(r)?e.SqlNumberToken.create(r):null}var o=".eE";var a=e.XString.getCharAt(this.m_sql,this.m_pos);if(a===e.XString.getCharAt(o,0)){this.m_pos++;n=this.parseIntegerToken();if(e.isNull(r)&&e.isNull(n)){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Invalid floating point format at position {0}",e.StringListBuilder.create().add(e.XInteger.convertToString(this.m_pos)).build()))}}if(e.isNull(r)&&e.isNull(n)){return null}if(!this.endOfInput()&&a===e.XString.getCharAt(o,1)||a===e.XString.getCharAt(o,2)){this.m_pos++;i=this.parseIntegerToken();if(e.isNull(i)){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Invalid floating point format at position {0}",e.StringListBuilder.create().add(e.XInteger.convertToString(this.m_pos)).build()))}}if(t<this.m_pos){var l=e.SqlNumberToken.create(e.XString.substring(this.m_sql,t,this.m_pos));this.expectTokenEnd();return l}return null};e.SqlTokenizer.prototype.parseQuote=function(t){var r=this.m_pos;if(this.endOfInput()||e.XString.getCharAt(this.m_sql,r)!==e.XString.getCharAt(t,0)){return null}r++;var n=e.XStringBuffer.create();while(r<e.XString.size(this.m_sql)){var i=e.XString.getCharAt(this.m_sql,r);if(i===e.XString.getCharAt(t,0)){if(r+1<e.XString.size(this.m_sql)&&e.XString.getCharAt(this.m_sql,r+1)===e.XString.getCharAt(t,0)){r++}else{break}}n.appendChar(i);r++}if(this.endOfInput()||e.XString.getCharAt(this.m_sql,r)!==e.XString.getCharAt(t,0)){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Missing closing Quote {0} at position {1}",e.StringListBuilder.create().add(t).add(e.XInteger.convertToString(this.m_pos)).build()))}r++;var o=e.SqlStringToken.create(n.toString());this.m_pos=r;return o};e.SqlTokenizer.prototype.isOperator=function(){var t=this.m_pos;if(this.endOfInput()){return false}var r=e.StringListBuilder.create().add(",").add(";").add("(").add(")").add("+").add("-").add("*").add("/").add("!=").add("=").add("<=").add(">=").add("<").add(">").build();for(var n=0;n<r.size();n++){if(e.SqlTokenizer.startsWithFrom(this.m_sql,r.get(n),t)){return true}}return false};e.SqlTokenizer.prototype.parseOperator=function(){var t=this.m_pos;if(this.endOfInput()){return null}var r=e.StringListBuilder.create().add(",").add(";").add("(").add(")").add("+").add("-").add("*").add("/").add("!=").add("=").add("<=").add(">=").add("<").add(">").build();for(var n=0;n<r.size();n++){if(e.SqlTokenizer.startsWithFrom(this.m_sql,r.get(n),t)){t=t+e.XString.size(r.get(n));if(n===2){this.m_depth++}if(n===3){if(this.m_depth===0){throw e.XException.createIllegalArgumentException("unexpected ) missing (")}this.m_depth--}break}}if(this.m_pos<t){var i=e.SqlOperatorToken.create(e.XString.substring(this.m_sql,this.m_pos,t));this.m_pos=t;return i}return null};e.SqlTokenizer.prototype.parsePlainOrReference2=function(){var t=this.parsePlainToken();if(e.notNull(t)){return t}var r=this.parseQuote('"');if(e.notNull(r)){return e.SqlReferenceToken.create(e.SqlReference.create(r.getString()))}return null};e.SqlTokenizer.prototype.parsePlainOrReferenceAsReference=function(){var t=this.parsePlainToken();if(e.notNull(t)){return t.getString()}t=this.parseQuote('"');if(e.notNull(t)){return t.getString()}var r="*";if(e.XString.getCharAt(this.m_sql,this.m_pos)===e.XString.getCharAt(r,0)){this.m_pos++;return r}return null};e.SqlTokenizer.prototype.parsePlainOrReference=function(){var t=this.parsePlainOrReference2();if(e.notNull(t)){var r=".";this.skipSpace();if(this.endOfInput()||e.XString.getCharAt(this.m_sql,this.m_pos)!==e.XString.getCharAt(r,0)){return t}this.m_pos++;this.skipSpace();var n=this.parsePlainOrReferenceAsReference();if(e.isNull(n)){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Missing reference name after . at position {0}",e.StringListBuilder.create().add(e.XInteger.convertToString(this.m_pos)).build()))}this.skipSpace();var i=t.getType()===e.SqlTokenType.PLAIN?t.asSqlPlainToken().getString():t.asSqlReferenceToken().getReference().getComponents().get(0);if(this.endOfInput()||e.XString.getCharAt(this.m_sql,this.m_pos)!==e.XString.getCharAt(r,0)){return e.SqlReferenceToken.create(e.SqlReference.create2(i,n))}this.m_pos++;this.skipSpace();var o=this.parsePlainOrReferenceAsReference();if(e.isNull(o)){throw e.XException.createIllegalArgumentException(e.SqlOperation.format("Missing reference name after . at position {0}",e.StringListBuilder.create().add(e.XInteger.convertToString(this.m_pos)).build()))}return e.SqlReferenceToken.create(e.SqlReference.create3(i,n,o))}return null};e.SqlTokenizer.prototype.parse=function(){this.skipSpace();var t=this.parsePlainOrReference();if(e.notNull(t)){return t}t=this.parseQuote("'");if(e.notNull(t)){return t}t=this.parseNumberToken();if(e.notNull(t)){return t}t=this.parseOperator();if(e.notNull(t)){return t}if(this.endOfInput()&&this.m_depth>0){throw e.XException.createIllegalArgumentException("Expected ) at the of the input")}return null};e.SqlTokenizer.prototype.getCurrentDepth=function(){return this.m_depth};e.SqlTokenizer.prototype.next=function(){this.m_current=this.parse();return this.m_current};e.SqlTokenizer.prototype.getCurrent=function(){return this.m_current};e.RpcSqlDriverFactory=function(){};e.RpcSqlDriverFactory.prototype=new e.SqlDriverFactory;e.RpcSqlDriverFactory.prototype._ff_c="RpcSqlDriverFactory";e.RpcSqlDriverFactory.staticSetup=function(){e.SqlDriverFactory.registerFactory(new e.RpcSqlDriverFactory)};e.RpcSqlDriverFactory.prototype.newSqlDriver=function(t,r){if(e.XString.indexOf(t,"ina_sql=")===0){if(e.isNull(r)){throw e.XException.createIllegalArgumentException("Invalid Connection Pool == null")}return e.RpcSqlDriver.create2(t,r,e.XString.substring(t,8,-1))}return null};e.RpcSqlProxy=function(){};e.RpcSqlProxy.prototype=new e.XObject;e.RpcSqlProxy.prototype._ff_c="RpcSqlProxy";e.RpcSqlProxy.prototype.m_connectionstring=null;e.RpcSqlProxy.prototype.m_drivername=null;e.RpcSqlProxy.prototype.m_username=null;e.RpcSqlProxy.prototype.m_password=null;e.RpcSqlProxy.prototype.m_acl=null;e.RpcSqlProxy.prototype.convert=function(t){var r=t.getMetaData();var n=e.PrFactory.createStructure();var i=n.putNewList("columns");for(var o=0;o<r.size();o++){i.add(e.PrFactory.createString(r.get(o)))}var a=n.putNewList("values");while(t.next()){var l=a.addNewList();for(var s=0;s<r.size();s++){var p=r.getType(s);if(p===e.SqlResultSetType.DOUBLE){l.add(e.PrFactory.createDouble(t.getDoubleAt(s)));continue}if(p===e.SqlResultSetType.LONG){l.add(e.PrFactory.createLong(t.getLongAtExt(s,-1)));continue}if(p===e.SqlResultSetType.INTEGER){l.add(e.PrFactory.createInteger(t.getIntegerAtExt(s,-1)));continue}if(p===e.SqlResultSetType.BOOLEAN){l.add(e.PrFactory.createBoolean(t.getBooleanAtExt(s,true)));continue}if(p===e.SqlResultSetType.STRING){l.add(e.PrFactory.createString(t.getStringAtExt(s,null)));continue}l.addNull()}}return n};e.RpcSqlProxy.prototype.getDataBaseProvider=function(){var t=e.SqlDriverFactory.create(this.m_drivername,null);t.processOpenExt(e.SyncType.BLOCKING,null,null,this.m_connectionstring,this.m_username,this.m_password);return t};e.RpcSqlProxy.prototype.onHttpRequest=function(t){var r=t.getClientHttpRequest().getInternalUser();if(e.isNull(r)){r=""}var n=null;var i=e.notNull(this.m_acl)?e.SqlAccessControl.loadAccessControlFile(this.m_acl):null;if(e.notNull(i)){n=i.getByKey(r);if(e.isNull(n)){n=e.SqlAccessControl.create2()}}var o=t.getClientHttpRequest().getJsonContent();var a=t.getClientHttpRequest().getRelativePath();var l=t.newServerResponse();if(e.XString.isEqual(a,"/sap/sql/ina/GetServerInfo")){var s=e.PrFactory.createStructure();var p=s.putNewStructure("ServerInfo");p.putString("SystemId","SQLJSON");p.putString("DataBaseManagementSystem","Generic Sql");var c=s.putNewList("Services");var u=c.addNewStructure();var S=u.putNewList("Capabilities");var g=S.addNewStructure();g.putString("Capability","BasicSql");g.putString("Description","A simple sql protocol");g=S.addNewStructure();g.putString("Capability","BasicSqlMetaData");g.putString("Description","Metadata for Sql Database");u.putString("Service","Analytics");s.putNewStructure("Settings");l.setString(s.toString());t.setResponse(l);return}else if(e.XString.isEqual(a,"/BasicSql")){if(e.isNull(o)||!o.isStructure()){var f=e.MessageManagerSimple.createMessageManager();f.addError(1,"Expected a json object!");this.respondWithInaError(t,l,f.getErrors());return}var q=o.asStructure().getStringByKey("sql");if(e.notNull(n)){var d=e.SqlValidateAccess.create(q,n);if(!d.validate()){this.respondWithInaError(t,l,(new e.ListBuilder).init().add(e.XMessage.createError(q,"Access Denied",null,false,null)).build());return}}var h=o.asStructure().getStringByKey("type");var m=this.getDataBaseProvider();if(e.XString.isEqual(h,"update")){m.processExecuteUpdate(e.SyncType.BLOCKING,null,null,q);if(m.hasErrors()){this.respondWithInaError(t,l,m.getErrors())}else{l.setStatusCode(201);t.setResponse(l)}}else if(e.XString.isEqual(h,"query")){var y=m.processExecuteQuery(e.SyncType.BLOCKING,null,null,q);if(m.hasErrors()){this.respondWithInaError(t,l,m.getErrors())}else{var _=this.convert(y.getData());l.setStatusCode(200);l.setString(_.toString());t.setResponse(l)}}else{var v=e.MessageManagerSimple.createMessageManager();v.addError(1,e.XStringUtils.concatenate2("Unexpected query type: ",h));this.respondWithInaError(t,l,v.getErrors())}m.close()}else if(e.XString.isEqual(a,"/GetSchemas")){this.getSchemas(o.asStructure(),t,l)}else if(e.XString.isEqual(a,"/GetTables")){this.getTables(o.asStructure(),t,l)}else if(e.XString.isEqual(a,"/GetColumns")){this.getColumns(o.asStructure(),t,l)}else if(e.XString.isEqual(a,"/GetImportedKeys")){this.getImportedKeys(o.asStructure(),t,l)}else{l.setStatusCode(404);t.setResponse(l)}};e.RpcSqlProxy.prototype.getSchemas=function(t,r,n){var i=this.getDataBaseProvider();var o=i.processGetSchemas(e.SyncType.BLOCKING,null,null);if(i.hasErrors()){this.respondWithInaError(r,n,i.getErrors())}else{n.setStatusCode(200);n.setString(this.convert(o.getData()).toString());r.setResponse(n)}i.close()};e.RpcSqlProxy.prototype.getTables=function(t,r,n){var i=this.getDataBaseProvider();var o=t.getStringByKey("catalog");var a=t.getStringByKey("schemaNamePattern");var l=t.getStringByKey("tableNamePattern");var s=i.processGetTables(e.SyncType.BLOCKING,null,null,o,a,l);if(i.hasErrors()){this.respondWithInaError(r,n,i.getErrors())}else{n.setStatusCode(200);n.setString(this.convert(s.getData()).toString());r.setResponse(n)}i.close()};e.RpcSqlProxy.prototype.getColumns=function(t,r,n){var i=this.getDataBaseProvider();var o=t.getStringByKey("catalog");var a=t.getStringByKey("schemaNamePattern");var l=t.getStringByKey("tableNamePattern");var s=t.getStringByKey("columnNamePattern");var p=i.processGetColumns(e.SyncType.BLOCKING,null,null,o,a,l,s);if(i.hasErrors()){this.respondWithInaError(r,n,i.getErrors())}else{n.setStatusCode(200);n.setString(this.convert(p.getData()).toString());r.setResponse(n)}i.close()};e.RpcSqlProxy.prototype.getImportedKeys=function(t,r,n){var i=this.getDataBaseProvider();var o=t.getStringByKey("catalog");var a=t.getStringByKey("schema");var l=t.getStringByKey("table");var s=i.processGetImportedKeys(e.SyncType.BLOCKING,null,null,o,a,l);if(i.hasErrors()){this.respondWithInaError(r,n,i.getErrors())}else{n.setStatusCode(200);n.setString(this.convert(s.getData()).toString());r.setResponse(n)}i.close()};e.RpcSqlProxy.prototype.respondWithInaError=function(t,r,n){var i=e.MessageManagerSimple.createMessageManager();i.setServerStatusCode(404);r.setString(e.RpcSqlInaUtil.createErrorResponse(n).toString());r.setStatusCode(200);t.setResponse(r)};e.RpcSqlProxy.prototype.initServerContainer=function(t){this.m_drivername=t.getByKey("drivername");this.m_connectionstring=t.getByKey("connectionstring");this.m_username=t.getByKey("username");this.m_password=t.getByKey("password");var r=e.DefaultSession.create();if(e.notNull(r)){var n=e.XFile.create(r,t.getByKey("acl"));if(e.notNull(n)&&n.isValid()){var i=n.load();if(e.notNull(i)){this.m_acl=i.getJsonContent()}}}};e.RawSqlTableSource=function(){};e.RawSqlTableSource.prototype=new e.XObject;e.RawSqlTableSource.prototype._ff_c="RawSqlTableSource";e.RawSqlTableSource.create=function(t){var r=new e.RawSqlTableSource;r.m_source=t;return r};e.RawSqlTableSource.prototype.m_source=null;e.RawSqlTableSource.prototype.toSqlString=function(e){return this.m_source};e.RawSqlTableSource.prototype.ReplaceTableSource=function(e,t){return this};e.RawSqlTableSource.prototype.isEqualTableSource=function(e){return false};e.SqlSelectAlias=function(){};e.SqlSelectAlias.prototype=new e.XObject;e.SqlSelectAlias.prototype._ff_c="SqlSelectAlias";e.SqlSelectAlias.create=function(t,r){var n=new e.SqlSelectAlias;n.initialize(t,r);return n};e.SqlSelectAlias.quote=function(t,r){return e.XStringUtils.concatenate3(r,e.XString.replace(t,r,e.XStringUtils.concatenate2(r,r)),r)};e.SqlSelectAlias.prototype.m_body=null;e.SqlSelectAlias.prototype.m_alias=null;e.SqlSelectAlias.prototype.initialize=function(t,r){if(e.isNull(t)){throw e.XException.createIllegalArgumentException("body is null")}if(e.isNull(r)){throw e.XException.createIllegalArgumentException("alias is null")}this.m_body=t;this.m_alias=r};e.SqlSelectAlias.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();r.append("(");r.append(this.m_body.toSqlString(t));r.append(") AS ");r.append(e.SqlSelectAlias.quote(this.m_alias,t.referenceQuotes));return r.toString()};e.SqlSelectAlias.prototype.ReplaceTableSource=function(e,t){return this};e.SqlSelectAll=function(){};e.SqlSelectAll.prototype=new e.XObject;e.SqlSelectAll.prototype._ff_c="SqlSelectAll";e.SqlSelectAll.prototype.m_tableref=null;e.SqlSelectAll.prototype.setTableReference=function(e){this.m_tableref=e;return this};e.SqlSelectAll.prototype.toSqlString=function(t){return e.notNull(this.m_tableref)?e.SqlOperation.format("{0}.*",(new e.StringListBuilder).init().add(this.m_tableref.toSqlString(t)).build()):"*"};e.SqlSelectAll.prototype.ReplaceTableSource=function(e,t){return this};e.SqlTableAlias=function(){};e.SqlTableAlias.prototype=new e.XObject;e.SqlTableAlias.prototype._ff_c="SqlTableAlias";e.SqlTableAlias.create=function(t,r){var n=new e.SqlTableAlias;n.initialize(t,r);n.m_quote=true;return n};e.SqlTableAlias.quote=function(t,r){return e.XStringUtils.concatenate3(r,e.XString.replace(t,r,e.XStringUtils.concatenate2(r,r)),r)};e.SqlTableAlias.create2=function(t,r){var n=new e.SqlTableAlias;n.initialize(t,r);n.m_quote=false;return n};e.SqlTableAlias.prototype.m_body=null;e.SqlTableAlias.prototype.m_alias=null;e.SqlTableAlias.prototype.m_quote=false;e.SqlTableAlias.prototype.initialize=function(t,r){if(e.isNull(t)){throw e.XException.createIllegalArgumentException("body is null")}if(e.isNull(r)){throw e.XException.createIllegalArgumentException("alias is null")}this.m_body=t;this.m_alias=r};e.SqlTableAlias.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();if(this.m_quote){r.append("(")}r.append(this.m_body.toSqlString(t));if(this.m_quote){r.append(")")}r.append(" ");r.append(e.SqlTableAlias.quote(this.m_alias,t.referenceQuotes));return r.toString()};e.SqlTableAlias.prototype.ReplaceTableSource=function(t,r){return e.SqlTableAlias.create(this.m_body.ReplaceTableSource(t,r),this.m_alias)};e.SqlTableAlias.prototype.isEqualTableSource=function(e){return false};e.SqlNumberToken=function(){};e.SqlNumberToken.prototype=new e.SqlToken;e.SqlNumberToken.prototype._ff_c="SqlNumberToken";e.SqlNumberToken.create=function(t){var r=new e.SqlNumberToken;r.m_token=t;return r};e.SqlNumberToken.prototype.m_token=null;e.SqlNumberToken.prototype.getType=function(){return e.SqlTokenType.NUMBER};e.SqlNumberToken.prototype.asSqlNumberToken=function(){return this};e.SqlNumberToken.prototype.getString=function(){return this.m_token};e.SqlOperatorToken=function(){};e.SqlOperatorToken.prototype=new e.SqlToken;e.SqlOperatorToken.prototype._ff_c="SqlOperatorToken";e.SqlOperatorToken.create=function(t){var r=new e.SqlOperatorToken;r.m_token=t;return r};e.SqlOperatorToken.prototype.m_token=null;e.SqlOperatorToken.prototype.getType=function(){return e.SqlTokenType.OPERATOR};e.SqlOperatorToken.prototype.asSqlOperatorToken=function(){return this};e.SqlOperatorToken.prototype.getString=function(){return this.m_token};e.SqlPlainToken=function(){};e.SqlPlainToken.prototype=new e.SqlToken;e.SqlPlainToken.prototype._ff_c="SqlPlainToken";e.SqlPlainToken.create=function(t){var r=new e.SqlPlainToken;r.m_token=t;return r};e.SqlPlainToken.prototype.m_token=null;e.SqlPlainToken.prototype.getType=function(){return e.SqlTokenType.PLAIN};e.SqlPlainToken.prototype.asSqlPlainToken=function(){return this};e.SqlPlainToken.prototype.getString=function(){return this.m_token};e.SqlReferenceToken=function(){};e.SqlReferenceToken.prototype=new e.SqlToken;e.SqlReferenceToken.prototype._ff_c="SqlReferenceToken";e.SqlReferenceToken.create=function(t){var r=new e.SqlReferenceToken;r.m_token=t;return r};e.SqlReferenceToken.prototype.m_token=null;e.SqlReferenceToken.prototype.getType=function(){return e.SqlTokenType.REFERENCE};e.SqlReferenceToken.prototype.asSqlReferenceToken=function(){return this};e.SqlReferenceToken.prototype.getReference=function(){return this.m_token};e.SqlStringToken=function(){};e.SqlStringToken.prototype=new e.SqlToken;e.SqlStringToken.prototype._ff_c="SqlStringToken";e.SqlStringToken.create=function(t){var r=new e.SqlStringToken;r.m_token=t;return r};e.SqlStringToken.prototype.m_token=null;e.SqlStringToken.prototype.getType=function(){return e.SqlTokenType.STRING};e.SqlStringToken.prototype.asSqlStringToken=function(){return this};e.SqlStringToken.prototype.getString=function(){return this.m_token};e.SqlQuery=function(){};e.SqlQuery.prototype=new e.XObject;e.SqlQuery.prototype._ff_c="SqlQuery";e.SqlQuery.create=function(){var t=new e.SqlQuery;t.m_selection=e.XList.create();t.m_from=e.XList.create();t.m_groupby=e.XList.create();t.m_orderby=e.XList.create();t.m_where=null;t.m_having=null;t.m_joins=e.XList.create();t.m_distinct=false;t.m_limit=-1;t.m_offset=0;return t};e.SqlQuery.prototype.m_selection=null;e.SqlQuery.prototype.m_from=null;e.SqlQuery.prototype.m_groupby=null;e.SqlQuery.prototype.m_where=null;e.SqlQuery.prototype.m_having=null;e.SqlQuery.prototype.m_joins=null;e.SqlQuery.prototype.m_orderby=null;e.SqlQuery.prototype.m_distinct=false;e.SqlQuery.prototype.m_offset=0;e.SqlQuery.prototype.m_limit=0;e.SqlQuery.prototype.setDistinct=function(e){this.m_distinct=e;return this};e.SqlQuery.prototype.select=function(t){if(e.isNull(t)){throw e.XException.createIllegalArgumentException("column == null")}this.getSelection().add(t);return this};e.SqlQuery.prototype.from=function(e){this.m_from.add(e);return this};e.SqlQuery.prototype.groupBy=function(e){this.m_groupby.add(e);return this};e.SqlQuery.prototype.orderBy=function(t,r){this.m_orderby.add(e.XPair.create(t,e.XBooleanValue.create(r)));return this};e.SqlQuery.prototype.limit=function(e,t){this.m_offset=e;this.m_limit=t;return this};e.SqlQuery.prototype.where=function(e){this.m_where=e;return this};e.SqlQuery.prototype.having=function(e){this.m_having=e;return this};e.SqlQuery.prototype.innerJoin=function(t){var r=e.SqlJoin.create("inner join",t);this.m_joins.add(r);return r};e.SqlQuery.prototype.leftJoin=function(t){var r=e.SqlJoin.create("left join",t);this.m_joins.add(r);return r};e.SqlQuery.prototype.rightJoin=function(t){var r=e.SqlJoin.create("right join",t);this.m_joins.add(r);return r};e.SqlQuery.prototype.toSqlString=function(t){var r=this.m_orderby.size()>0&&this.m_limit!==-1;var n=e.XStringBuffer.create();var i=e.XMath.random(4096);if(r){n.append("select * from (")}n.append("select");n.append(" ");if(this.m_distinct){n.append("distinct");n.append(" ")}var o;for(o=0;o<this.getSelection().size();++o){if(o!==0){n.append(", ")}n.append(this.getSelection().get(o).toSqlString(t))}if(r){n.append(", ROW_NUMBER() over (");this.appendOrderBy(t,n);n.append(") as ROW_");n.appendInt(i)}n.append(" ");n.append("from");n.append(" ");while(this.m_from.size()>1&&this.m_joins.size()>0){var a=this.m_from.removeAt(1);this.m_joins.insert(0,e.SqlJoin.create("cross join",a))}for(o=0;o<this.m_from.size();++o){if(o!==0){n.append(", ")}n.append(this.m_from.get(o).toSqlString(t))}for(o=0;o<this.m_joins.size();++o){n.append(" ");n.append(this.m_joins.get(o).toSqlString(t))}if(e.notNull(this.m_where)){n.append(" where ");n.append(this.m_where)}if(this.m_groupby.size()>0){n.append(" group by ");for(o=0;o<this.m_groupby.size();++o){if(o!==0){n.append(", ")}n.append(this.m_groupby.get(o).toSqlString(t))}if(e.notNull(this.m_having)){n.append(" having ");n.append(this.m_having)}}if(this.m_orderby.size()>0&&!r){n.append(" ");this.appendOrderBy(t,n)}if(r){n.append(") T where T.ROW_");n.appendInt(i);n.append(" <= ");n.appendInt(this.m_offset+this.m_limit);n.append(" AND T.ROW_");n.appendInt(i);n.append(" > ");n.appendInt(this.m_offset);n.append(" order by T.ROW_");n.appendInt(i)}var l=n.toString();e.XObjectExt.release(n);return l};e.SqlQuery.prototype.appendOrderBy=function(e,t){var r;t.append("order by ");for(r=0;r<this.m_orderby.size();++r){if(r!==0){t.append(", ")}t.append(this.m_orderby.get(r).getFirstObject().toSqlString(e));t.append(" ");if(this.m_orderby.get(r).getSecondObject().getBoolean()){t.append("desc")}else{t.append("asc")}}};e.SqlQuery.prototype.cloneQuery=function(){var t=new e.SqlQuery;t.m_selection=this.getSelection().createListCopy();t.m_from=this.m_from.createListCopy();t.m_orderby=this.m_orderby.createListCopy();t.m_groupby=this.m_groupby.createListCopy();t.m_where=this.m_where;t.m_having=this.m_having;t.m_joins=this.m_joins.createListCopy();t.m_distinct=this.m_distinct;return t};e.SqlQuery.prototype.releaseObject=function(){e.XObjectExt.release(this.getSelection());e.XObjectExt.release(this.m_from);e.XObjectExt.release(this.m_groupby);e.XObjectExt.release(this.m_joins);e.XObject.prototype.releaseObject.call(this)};e.SqlQuery.prototype.selectAll=function(){return this.select(new e.SqlSelectAll)};e.SqlQuery.prototype.ReplaceTableSource=function(t,r){var n=this.cloneQuery();for(var i=0;i<this.m_from.size();++i){if(this.m_from.get(i).isEqualTableSource(t)){var o=new e.SqlCodeGenOptions;o.noQuote=true;n.m_from.set(i,e.SqlTableAlias.create(r,t.toSqlString(o)))}else{n.m_from.set(i,n.m_from.get(i).ReplaceTableSource(t,r))}}return n};e.SqlQuery.prototype.isEqualTableSource=function(e){return false};e.SqlQuery.prototype.getSelection=function(){return this.m_selection};e.SqlUnion=function(){};e.SqlUnion.prototype=new e.XObject;e.SqlUnion.prototype._ff_c="SqlUnion";e.SqlUnion.create=function(t,r){var n=new e.SqlUnion;n.queries=e.XList.create();n.queries.add(t);n.queries.add(r);return n};e.SqlUnion.prototype.queries=null;e.SqlUnion.prototype.unionWith=function(e){this.queries.add(e);return this};e.SqlUnion.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();r.append(this.queries.get(0).toSqlString(t));for(var n=1,i=this.queries.size();n<i;n++){r.append(" UNION ");r.append(this.queries.get(n).toSqlString(t))}return r.toString()};e.SqlUnion.prototype.ReplaceTableSource=function(t,r){var n=new e.SqlUnion;n.queries=e.XList.create();for(var i=0,o=this.queries.size();i<o;i++){n.unionWith(this.queries.get(i).ReplaceTableSource(t,r))}return n};e.SqlUnion.prototype.isEqualTableSource=function(e){return false};e.SqlWindowFunction=function(){};e.SqlWindowFunction.prototype=new e.XObject;e.SqlWindowFunction.prototype._ff_c="SqlWindowFunction";e.SqlWindowFunction.prototype.toSqlString=function(e){return"sum()"};e.SqlWindowFunction.prototype.ReplaceTableSource=function(e,t){return this};e.SqlWith=function(){};e.SqlWith.prototype=new e.XObject;e.SqlWith.prototype._ff_c="SqlWith";e.SqlWith.create=function(){var t=new e.SqlWith;t.m_localVars=e.XList.create();return t};e.SqlWith.prototype.m_localVars=null;e.SqlWith.prototype.m_body=null;e.SqlWith.prototype.addDependency=function(t,r){this.m_localVars.add(e.XPair.create(e.XStringValue.create(t),r))};e.SqlWith.prototype.setBody=function(e){this.m_body=e};e.SqlWith.prototype.toSqlString=function(t){if(e.isNull(this.m_body)){throw e.XException.createIllegalArgumentException("you have to set the body to get a String")}var r=e.XStringBuffer.create();if(t.hasWith){r.append("with ");for(var n=0,i=this.m_localVars.size();n<i;++n){if(n!==0){r.append(", ")}r.append(e.SqlReference.create(this.m_localVars.get(n).getFirstObject().getString()).toSqlString(t));r.append(" as (");r.append(this.m_localVars.get(n).getSecondObject().toSqlString(t));r.append(")")}r.append(" ");r.append(this.m_body.toSqlString(t))}else if(t.hasSubqueries){var o=this.m_body;for(var a=0,l=this.m_localVars.size();a<l;++a){for(var s=0;s<l;++s){o=o.ReplaceTableSource(e.SqlReference.create(this.m_localVars.get(s).getFirstObject().getString()),this.m_localVars.get(s).getSecondObject())}}r.append(o.toSqlString(t))}else{throw e.XException.createRuntimeException("Not implemented yet")}return r.toString()};e.SqlWith.prototype.ReplaceTableSource=function(t,r){var n=new e.SqlCodeGenOptions;n.noQuote=true;var i=t.toSqlString(n);var o;for(o=0;o<this.m_localVars.size();o++){if(e.XString.isEqual(i,this.m_localVars.get(o).getFirstObject().getString())){return this}}var a=new e.SqlWith;a.m_localVars=e.XList.create();a.m_body=this.m_body;for(o=0;o<this.m_localVars.size();o++){a.m_localVars.add(e.XPair.create(this.m_localVars.get(o).getFirstObject(),this.m_localVars.get(o).getSecondObject().ReplaceTableSource(t,r)));a.m_body=a.m_body.ReplaceTableSource(t,r)}return a};e.SqlWith.prototype.isEqualTableSource=function(e){return false};e.RawSqlConstant=function(){};e.RawSqlConstant.prototype=new e.XObject;e.RawSqlConstant.prototype._ff_c="RawSqlConstant";e.RawSqlConstant.create=function(t){var r=new e.RawSqlConstant;r.m_source=t;return r};e.RawSqlConstant.prototype.m_source=null;e.RawSqlConstant.prototype.toSqlString=function(e){return this.m_source};e.RawSqlConstant.prototype.ReplaceTableSource=function(e,t){return this};e.SqlAggregateFunction=function(){};e.SqlAggregateFunction.prototype=new e.XObject;e.SqlAggregateFunction.prototype._ff_c="SqlAggregateFunction";e.SqlAggregateFunction.create=function(t,r){var n=new e.SqlAggregateFunction;n.m_over=r;n.m_name=t;return n};e.SqlAggregateFunction.prototype.m_over=null;e.SqlAggregateFunction.prototype.m_name=null;e.SqlAggregateFunction.prototype.toSqlString=function(t){return e.XStringUtils.concatenate4(this.m_name,"(",this.m_over.toSqlString(t),")")};e.SqlAggregateFunction.prototype.ReplaceTableSource=function(e,t){return this};e.SqlCast=function(){};e.SqlCast.prototype=new e.XObject;e.SqlCast.prototype._ff_c="SqlCast";e.SqlCast.create=function(t,r){var n=new e.SqlCast;n.m_constant=t;n.m_type=r;return n};e.SqlCast.prototype.m_constant=null;e.SqlCast.prototype.m_type=null;e.SqlCast.prototype.toSqlString=function(t){return e.SqlOperation.format("CAST ( {0} AS {1} )",e.StringListBuilder.create().add(this.m_constant.toSqlString(t)).add(this.m_type).build())};e.SqlCast.prototype.ReplaceTableSource=function(e,t){this.m_constant=this.m_constant.ReplaceTableSource(e,t);return this};e.SqlDoubleConstant=function(){};e.SqlDoubleConstant.prototype=new e.XObject;e.SqlDoubleConstant.prototype._ff_c="SqlDoubleConstant";e.SqlDoubleConstant.create=function(t){var r=new e.SqlDoubleConstant;r.m_value=t;return r};e.SqlDoubleConstant.prototype.m_value=0;e.SqlDoubleConstant.prototype.toSqlString=function(t){return e.XDouble.convertToString(this.m_value)};e.SqlDoubleConstant.prototype.ReplaceTableSource=function(e,t){return this};e.SqlIntegerConstant=function(){};e.SqlIntegerConstant.prototype=new e.XObject;e.SqlIntegerConstant.prototype._ff_c="SqlIntegerConstant";e.SqlIntegerConstant.create=function(t){var r=new e.SqlIntegerConstant;r.m_value=t;return r};e.SqlIntegerConstant.prototype.m_value=0;e.SqlIntegerConstant.prototype.toSqlString=function(t){return e.XLong.convertToString(this.m_value)};e.SqlIntegerConstant.prototype.ReplaceTableSource=function(e,t){return this};e.SqlReference=function(){};e.SqlReference.prototype=new e.XObject;e.SqlReference.prototype._ff_c="SqlReference";e.SqlReference.create3=function(t,r,n){var i=new e.SqlReference;i.initialize(t,r,n);return i};e.SqlReference.create2=function(t,r){var n=new e.SqlReference;n.initialize(null,t,r);return n};e.SqlReference.create=function(t){var r=new e.SqlReference;r.initialize(null,null,t);return r};e.SqlReference.quote=function(t,r){return e.XStringUtils.concatenate3(r,e.XString.replace(t,r,e.XStringUtils.concatenate2(r,r)),r)};e.SqlReference.prototype.m_components=null;e.SqlReference.prototype.getComponents=function(){return this.m_components};e.SqlReference.prototype.initialize=function(t,r,n){this.m_components=e.XListOfString.create();if(e.notNull(t)){this.m_components.add(t)}if(e.notNull(r)){this.m_components.add(r)}if(e.notNull(n)){this.m_components.add(n)}};e.SqlReference.prototype.toSqlString=function(t){var r=e.XStringBuffer.create();if(this.m_components.size()===1&&t.noQuote){r.append(this.m_components.get(0))}else{for(var n=0,i=this.m_components.size();n<i;n++){if(n!==0){r.append(".")}r.append(e.SqlReference.quote(this.m_components.get(n),t.referenceQuotes))}}return r.toString()};e.SqlReference.prototype.ReplaceTableSource=function(e,t){return this};e.SqlReference.prototype.isEqualTableSource=function(t){return e.XString.isEqual(this.toSqlString(new e.SqlCodeGenOptions),t.toSqlString(new e.SqlCodeGenOptions))};e.SqlStringConstant=function(){};e.SqlStringConstant.prototype=new e.XObject;e.SqlStringConstant.prototype._ff_c="SqlStringConstant";e.SqlStringConstant.create=function(t){if(e.isNull(t)){throw e.XException.createIllegalArgumentException("string of StringConstat is null")}var r=new e.SqlStringConstant;r.m_string=t;return r};e.SqlStringConstant.quote=function(t,r){return e.XStringUtils.concatenate3(r,e.XString.replace(t,r,e.XStringUtils.concatenate2(r,r)),r)};e.SqlStringConstant.prototype.m_string=null;e.SqlStringConstant.prototype.toSqlString=function(t){return e.SqlStringConstant.quote(this.m_string,t.stringQuotes)};e.SqlStringConstant.prototype.ReplaceTableSource=function(e,t){return this};e.RpcSqlDriver=function(){};e.RpcSqlDriver.prototype=new e.MessageManager;e.RpcSqlDriver.prototype._ff_c="RpcSqlDriver";e.RpcSqlDriver.create=function(t,r,n){var i=new e.RpcSqlDriver;i.setupDriver(r.getConnectionPool(),n);return i};e.RpcSqlDriver.create2=function(t,r,n){var i=new e.RpcSqlDriver;i.setupDriver(r,n);return i};e.RpcSqlDriver.prototype.m_connectionUri=null;e.RpcSqlDriver.prototype.m_connection=null;e.RpcSqlDriver.prototype.m_pool=null;e.RpcSqlDriver.prototype.m_systemAlias=null;e.RpcSqlDriver.prototype.setupDriver=function(e,t){this.m_pool=e;this.m_systemAlias=t;this.setupSessionContext(null)};e.RpcSqlDriver.prototype.open=function(t){this.m_connection=this.m_pool.getConnection(this.m_systemAlias);var r=this.m_connection.getServerMetadata();if(e.isNull(r)){this.addError(9,"Failed to connect to server, missing Server Metadata");return}if(!r.supportsAnalyticCapability("BasicSql")){this.addError(10,"Server doesn't support BasicSql");return}};e.RpcSqlDriver.prototype.openExt=function(t,r,n){this.open(e.XUri.createFromUrl(t))};e.RpcSqlDriver.prototype.close=function(){};e.RpcSqlDriver.prototype.executeUpdate=function(t){var r=e.PrFactory.createStructure();r.putString("type","update");r.putString("sql",t);var n=this.m_connection.newRpcFunction("/BasicSql");n.getRpcRequest().setMethod(e.HttpRequestMethod.HTTP_POST);n.getRpcRequest().setRequestStructure(r);n.processFunctionExecution(e.SyncType.BLOCKING,null,null);this.addAllMessages(n);return 0};e.RpcSqlDriver.prototype.processExecuteUpdate=function(t,r,n,i){return e.RpcSqlUpdateAction.createAndRun(this,this.m_connection,t,r,n,this.getSession(),i)};e.RpcSqlDriver.prototype.executeQuery=function(t){var r=e.PrFactory.createStructure();r.putString("type","query");r.putString("sql",t);var n=this.m_connection.newRpcFunction("/BasicSql");n.getRpcRequest().setMethod(e.HttpRequestMethod.HTTP_POST);n.getRpcRequest().setRequestStructure(r);n.processFunctionExecution(e.SyncType.BLOCKING,null,null);this.addAllMessages(n);var i=e.PrFactory.createList();i.add(n.getRpcResponse().getRootElement());return e.SqlJsonResultSet.create(i)};e.RpcSqlDriver.prototype.processExecuteQuery=function(t,r,n,i){return e.RpcSqlQueryAction.createAndRun(this,this.m_connection,t,r,n,this.getSession(),i)};e.RpcSqlDriver.prototype.getConnection=function(){return this.m_connectionUri};e.RpcSqlDriver.prototype.processOpen=function(t,r,n,i){this.open(i);return e.RpcSqlOpenAction.createAndRun(this,t,r,n,this.getSession())};e.RpcSqlDriver.prototype.processOpenExt=function(t,r,n,i,o,a){this.openExt(i,o,a);return e.RpcSqlOpenAction.createAndRun(this,t,r,n,this.getSession())};e.RpcSqlDriver.prototype.processGetSchemas=function(t,r,n){var i=this.m_connection.getServerMetadata();if(e.isNull(i)){this.addError(9,"Failed to connect to server, missing Server Metadata");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}if(!i.supportsAnalyticCapability("BasicSqlMetaData")){this.addError(10,"Server doesn't support BasicSqlMetaData");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}return e.RpcSqlQueryAction.createAndRunSpecial(this,this.m_connection,t,r,n,this.getSession(),"/GetSchemas",e.PrFactory.createStructure())};e.RpcSqlDriver.prototype.processGetTables=function(t,r,n,i,o,a){var l=this.m_connection.getServerMetadata();if(e.isNull(l)){this.addError(9,"Failed to connect to server, missing Server Metadata");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}if(!l.supportsAnalyticCapability("BasicSqlMetaData")){this.addError(10,"Server doesn't support BasicSqlMetaData");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}var s=e.PrFactory.createStructure();s.putString("catalog",i);s.putString("schemaNamePattern",o);s.putString("tableNamePattern",a);return e.RpcSqlQueryAction.createAndRunSpecial(this,this.m_connection,t,r,n,this.getSession(),"/GetTables",s)};e.RpcSqlDriver.prototype.processGetColumns=function(t,r,n,i,o,a,l){var s=this.m_connection.getServerMetadata();if(e.isNull(s)){this.addError(9,"Failed to connect to server, missing Server Metadata");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}if(!s.supportsAnalyticCapability("BasicSqlMetaData")){this.addError(10,"Server doesn't support BasicSqlMetaData");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}var p=e.PrFactory.createStructure();p.putString("catalog",i);p.putString("schemaNamePattern",o);p.putString("tableNamePattern",a);p.putString("columnNamePattern",l);return e.RpcSqlQueryAction.createAndRunSpecial(this,this.m_connection,t,r,n,this.getSession(),"/GetColumns",p)};e.RpcSqlDriver.prototype.processGetImportedKeys=function(t,r,n,i,o,a){var l=this.m_connection.getServerMetadata();if(e.isNull(l)){this.addError(9,"Failed to connect to server, missing Server Metadata");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}if(!l.supportsAnalyticCapability("BasicSqlMetaData")){this.addError(10,"Server doesn't support BasicSqlMetaData");return e.SqlSynchroniousQueryAction.createAndRun(null,t,r,n,this.getSession())}var s=e.PrFactory.createStructure();s.putString("catalog",i);s.putString("schema",o);s.putString("table",a);return e.RpcSqlQueryAction.createAndRunSpecial(this,this.m_connection,t,r,n,this.getSession(),"/GetImportedKeys",s)};e.SqlTokenType=function(){};e.SqlTokenType.prototype=new e.XConstant;e.SqlTokenType.prototype._ff_c="SqlTokenType";e.SqlTokenType.PLAIN=null;e.SqlTokenType.REFERENCE=null;e.SqlTokenType.STRING=null;e.SqlTokenType.NUMBER=null;e.SqlTokenType.OPERATOR=null;e.SqlTokenType.staticSetup=function(){e.SqlTokenType.PLAIN=e.SqlTokenType.create("PLAIN");e.SqlTokenType.REFERENCE=e.SqlTokenType.create("REFERENCE");e.SqlTokenType.STRING=e.SqlTokenType.create("STRING");e.SqlTokenType.NUMBER=e.SqlTokenType.create("NUMBER");e.SqlTokenType.OPERATOR=e.SqlTokenType.create("OPERATOR")};e.SqlTokenType.create=function(t){return e.XConstant.setupName(new e.SqlTokenType,t)};e.RpcSqlOpenAction=function(){};e.RpcSqlOpenAction.prototype=new e.SyncAction;e.RpcSqlOpenAction.prototype._ff_c="RpcSqlOpenAction";e.RpcSqlOpenAction.createAndRun=function(t,r,n,i,o){var a=new e.RpcSqlOpenAction;a.m_driver=t;a.setupActionAndRun(r,n,i,o);return a};e.RpcSqlOpenAction.prototype.m_driver=null;e.RpcSqlOpenAction.prototype.callListener=function(e,t,r,n){t.onOpened(e,r,n)};e.RpcSqlOpenAction.prototype.processSynchronization=function(e){this.setData(this.m_driver);return false};e.RpcSqlQuery=function(){};e.RpcSqlQuery.prototype=new e.SyncAction;e.RpcSqlQuery.prototype._ff_c="RpcSqlQuery";e.RpcSqlQuery.createAndRun=function(t,r,n,i,o){var a=new e.RpcSqlQuery;a.m_driver=t;a.setupActionAndRun(r,n,i,o);return a};e.RpcSqlQuery.prototype.m_driver=null;e.RpcSqlQuery.prototype.callListener=function(e,t,r,n){t.onQueryResult(e,r,n)};e.RpcSqlQuery.prototype.processSynchronization=function(e){this.m_driver.addInfo(0,"");this.setData(null);return false};e.RpcSqlQueryAction=function(){};e.RpcSqlQueryAction.prototype=new e.SyncAction;e.RpcSqlQueryAction.prototype._ff_c="RpcSqlQueryAction";e.RpcSqlQueryAction.createAndRun=function(t,r,n,i,o,a,l){var s=e.PrFactory.createStructure();s.putString("type","query");s.putString("sql",l);return e.RpcSqlQueryAction.createAndRunSpecial(t,r,n,i,o,a,"/BasicSql",s)};e.RpcSqlQueryAction.createAndRunSpecial=function(t,r,n,i,o,a,l,s){var p=new e.RpcSqlQueryAction;p.m_driver=t;if(e.isNull(r)){t.addError(2,"Not Connected!");p.m_rpc=null}else{var c=r.newRpcFunction(l);c.getRpcRequest().setMethod(e.HttpRequestMethod.HTTP_POST);c.getRpcRequest().setRequestStructure(s);p.m_rpc=c}p.setupActionAndRun(n,i,o,a);return p};e.RpcSqlQueryAction.prototype.m_driver=null;e.RpcSqlQueryAction.prototype.m_rpc=null;e.RpcSqlQueryAction.prototype.callListener=function(e,t,r,n){t.onQueryResult(e,r,n)};e.RpcSqlQueryAction.prototype.processSynchronization=function(t){if(e.isNull(this.m_rpc)){return false}this.m_rpc.processFunctionExecution(t,this,null);return true};e.RpcSqlQueryAction.prototype.onFunctionExecuted=function(t,r,n){this.m_driver.addAllMessages(this.m_rpc);if(this.m_rpc.isValid()&&this.m_rpc.getServerStatusCode()===200){var i=e.RpcSqlInaUtil.getErrors(this.m_rpc.getRpcResponse().getRootElement());if(i.size()>0){for(var o=0,a=i.size();o<a;o++){this.m_driver.addMessage(i.get(o))}}else{var l=e.PrFactory.createList();l.add(this.m_rpc.getRpcResponse().getRootElement());this.setData(e.SqlJsonResultSet.create(l))}}else{this.m_driver.addError(2,"Failed to execute Query");this.setData(null)}this.endSync()};e.RpcSqlUpdateAction=function(){};e.RpcSqlUpdateAction.prototype=new e.SyncAction;e.RpcSqlUpdateAction.prototype._ff_c="RpcSqlUpdateAction";e.RpcSqlUpdateAction.createAndRun=function(t,r,n,i,o,a,l){var s=new e.RpcSqlUpdateAction;s.m_driver=t;if(e.isNull(r)){t.addError(2,"Not Connected!");s.m_rpc=null}else{var p=e.PrFactory.createStructure();p.putString("type","update");p.putString("sql",l);var c=r.newRpcFunction("/BasicSql");c.getRpcRequest().setMethod(e.HttpRequestMethod.HTTP_POST);c.getRpcRequest().setRequestStructure(p);s.m_rpc=c}s.setupActionAndRun(n,i,o,a);return s};e.RpcSqlUpdateAction.prototype.m_driver=null;e.RpcSqlUpdateAction.prototype.m_rpc=null;e.RpcSqlUpdateAction.prototype.callListener=function(e,t,r,n){t.onUpdated(e,r,n)};e.RpcSqlUpdateAction.prototype.processSynchronization=function(t){if(e.isNull(this.m_rpc)){return false}this.m_rpc.processFunctionExecution(t,this,null);return true};e.RpcSqlUpdateAction.prototype.onFunctionExecuted=function(t,r,n){this.m_driver.addAllMessages(this.m_rpc);if(this.m_rpc.isValid()&&this.m_rpc.getServerStatusCode()>=200&&this.m_rpc.getServerStatusCode()<300){var i=e.RpcSqlInaUtil.getErrors(this.m_rpc.getRpcResponse().getRootElement());if(i.size()>0){for(var o=0,a=i.size();o<a;o++){this.m_driver.addMessage(i.get(o))}this.setData(e.XIntegerValue.create(1))}else{this.setData(e.XIntegerValue.create(0))}}else{this.m_driver.addError(2,"Failed to execute Update");this.setData(e.XIntegerValue.create(1))}this.endSync()};e.SqlModule=function(){};e.SqlModule.prototype=new e.DfModule;e.SqlModule.prototype._ff_c="SqlModule";e.SqlModule.s_module=null;e.SqlModule.getInstance=function(){if(e.isNull(e.SqlModule.s_module)){e.DfModule.checkInitialized(e.RuntimeModule.getInstance());e.SqlModule.s_module=e.DfModule.startExt(new e.SqlModule);e.SqlTokenType.staticSetup();e.RpcSqlDriverFactory.staticSetup();e.DfModule.stopExt(e.SqlModule.s_module)}return e.SqlModule.s_module};e.SqlModule.prototype.getName=function(){return"ff3500.sql"};e.SqlModule.getInstance();return sap.firefly});
//# sourceMappingURL=ff3500.sql.js.map
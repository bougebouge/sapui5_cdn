/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Core","./UtilizationChart","sap/gantt/def/pattern/BackSlashPattern"],function(jQuery,t,e,i){"use strict";var n=e.extend("sap.gantt.simple.UtilizationLineChart",{metadata:{library:"sap.gantt",properties:{showMiddleLine:{type:"boolean",defaultValue:true}},defaultAggregation:"dimensions",aggregations:{dimensions:{type:"sap.gantt.simple.UtilizationDimension",group:"Data"}},associations:{overConsumptionPattern:{type:"sap.gantt.def.DefBase",altTypes:["string"],multiple:false,group:"Appearance"}}},renderer:{apiVersion:2}});n.prototype.applySettings=function(t,i){t=t||{};e.prototype.applySettings.call(this,t,i);this._createDefaultDefs()};n.prototype.renderElement=function(t,e){if(this.getDimensions().length===0){this.renderEmptyDomRefs(t,true);return}this.renderEmptyDomRefs(t,false);var i=this.getX(),n=this.getHeight(),r=this.getRowYCenter()-n/2,o=this.getWidth();var s={x:i,y:r,width:o,height:n};this.renderDimensionClipPaths(t,s);this.renderDefaultDefs(t);this.renderULCBackground(t,s);this.renderMiddleLine(t,s);this.renderOverConsumptionBackground(t,s);this.renderOverConsumptionClipPath(t,s);this.renderDimensionPaths(t,s);this.renderTooltips(t,s);t.close("g")};n.prototype.renderEmptyDomRefs=function(t,e){t.openStart("g",this);t.class("sapGanttUtilizationLine");t.openEnd();if(e){t.close("g")}};n.prototype.renderDimensionClipPaths=function(t,e){var i=this.getDimensions();t.openStart("defs").openEnd();for(var n=0;n<i.length;n++){t.openStart("clipPath",i[n].getId()+"-clipPath");t.openEnd();this.renderDimensionPath(t,i[n],e.y,e.height);t.close("clipPath")}t.close("defs")};n.prototype.renderULCBackground=function(t,e){var i=jQuery.extend({id:this.getId()+"-ulcBg",fill:this.getFill()||"transparent",stroke:"none"},true,e);this.renderRectangleWithAttributes(t,i)};n.prototype.getClipPathIdOfDimension=function(t){return"url(#"+t.getId()+"-clipPath)"};n.prototype.renderOverConsumptionBackground=function(t,e){var i=jQuery.extend({id:this.getId()+"-ulcOverConsumptionBg",fill:this._getOverageFillPattern()},true,e);i.height=this.getThresholdHeight(e.height);this.renderRectangleWithAttributes(t,i)};n.prototype.renderOverConsumptionClipPath=function(t,e){var i=jQuery.extend({},true,e);i.height=this.getThresholdHeight(e.height);var n=this.getDimensions();for(var r=0;r<n.length;r++){var o=jQuery.extend({"clip-path":this.getClipPathIdOfDimension(n[r]),fill:this.getOverConsumptionColor()},true,i);this.renderRectangleWithAttributes(t,o)}};n.prototype._getOverageFillPattern=function(){var e=this.getOverConsumptionPattern();if(e){e=t.byId(e).getRefString()}else{e="url(#"+this.getId()+"-defaultPattern"+")"}return e};n.prototype.getThresholdHeight=function(t){return this.getOverConsumptionMargin()*t/(100+this.getOverConsumptionMargin())};n.prototype.renderMiddleLine=function(t,e){if(this.getShowMiddleLine()){var i=this.getMiddleLineY(e);t.openStart("path",this.getId()+"-middleLine");t.attr("d","M "+e.x+" "+i+" h "+e.width);t.class("sapGanttUtilizationMiddleLine");t.openEnd().close("path")}};n.prototype.getMiddleLineY=function(t){var e=this.getThresholdHeight(t.height);return t.y+e+(t.height-e)/2};n.prototype.renderDimensionPaths=function(t,e){var i=e.x,n=this.getThresholdHeight(e.height),r=e.y,o=e.width,s=e.height;var a=this.getDimensions();for(var h=0;h<a.length;h++){t.openStart("g").openEnd();var p=a[h];var l={id:p.getId()+"-ulcRect",x:i,y:r+n,width:o,height:s-n,fill:this.getRemainCapacityColor(),"fill-opacity":.5,"stroke-opacity":.5,"clip-path":this.getClipPathIdOfDimension(p)};this.renderRectangleWithAttributes(t,l);this.renderDimensionPath(t,p,r,s,"ulcPath");t.close("g")}};n.prototype.renderTooltips=function(t,e){var i=e.y,n=e.height;t.openStart("g");t.class("ulc-tooltips").openEnd();var r=this.getAllDimensionPoints();r.forEach(function(e,r,o){var s=o[r+1]||e;var a=e.tooltip;var h=e.name!==s.name;if(h){a=e.tooltip+"\n"+s.tooltip}var p=this.toX(e.from),l=o.length-1===r,g=this.toX(l?s.to:s.from),d=Math.abs(g-p);if(d>0){var f={opacity:0,fillOpacity:0,strokeOpacity:0};var u=jQuery.extend({x:p,y:i,width:d,height:n},f);this.renderRectangleWithAttributes(t,u,a)}}.bind(this));t.close("g")};n.prototype.getAllDimensionPoints=function(){var t=[];this.getDimensions().forEach(function(e){var i=e.getName();e.getPeriods().forEach(function(e,n,r){var o=e.getTooltip();if(!o){o=i+":"+e.getValue()}t.push({name:i,from:e.getFrom(),to:e.getTo(),tooltip:o})})});t.sort(function(t,e){return t.from-e.from});return t};n.prototype.renderDimensionPath=function(t,e,i,n,r){var o=e.getPeriods();var s="";for(var a=0;a<o.length;a++){var h=a===0,p=a===o.length-1;var l=o[a];var g=this.toX(l.getFrom());var d=this.toX(l.getTo());var f=l.getValue();var u=this.getOverConsumptionMargin();if(f>100+u){f=100+u}var c=i+n;var m=n*(f/(100+u));var v=c-m;s+=(h?" M "+g+" "+c:"")+" L "+g+" "+v+" L "+d+" "+v+(p?" L "+d+" "+c:"")}if(r){t.openStart("path",e.getId()+"-"+r)}else{t.openStart("path")}t.attr("d",s);t.attr("fill","none");t.attr("stroke-width",2);t.attr("stroke",e.getDimensionColor());t.class("sapGanttUlcDimensionPath");t.openEnd().close("path")};n.prototype._createDefaultDefs=function(){if(this.getOverConsumptionPattern()){return}this.mDefaultDefs=new sap.gantt.def.SvgDefs({defs:[new i({id:this.getId()+"-defaultPattern",tileWidth:5,tileHeight:9,backgroundColor:"#fff",stroke:"#ececec",strokeWidth:1})]})};n.prototype.renderDefaultDefs=function(t){if(this.mDefaultDefs){t.unsafeHtml(this.mDefaultDefs.getDefString())}};n.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);if(this.mDefaultDefs){this.mDefaultDefs.destroy()}};return n},true);
//# sourceMappingURL=UtilizationLineChart.js.map
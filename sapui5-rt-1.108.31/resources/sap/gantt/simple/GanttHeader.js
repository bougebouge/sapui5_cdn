/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Core","sap/ui/Device","./RenderUtils","../misc/Utility","sap/gantt/misc/Format","sap/ui/core/theming/Parameters","./BaseRectangle","./AdhocLineRenderer","./GanttUtils","./DeltaLineRenderer","./BaseLine","sap/gantt/simple/GanttExtension"],function(e,t,a,r,i,n,o,l,g,s,h,d,f){"use strict";var p=e.extend("sap.gantt.simple.GanttHeader",{metadata:{library:"sap.gantt",properties:{iHeaderMinheight:{type:"int",defaultValue:33},_iHeaderHeight:{type:"int",defaultValue:0},_iHeaderHeightInitial:{type:"int",defaultValue:0}},aggregations:{_overflowToolbar:{type:"sap.m.Toolbar",multiple:false}},renderer:{apiVersion:2}}});p.prototype._setIHeaderHeight=function(e){this.setProperty("_iHeaderHeight",Math.floor(e),true)};p.prototype._getIHeaderHeight=function(){return this.getProperty("_iHeaderHeight")};p.prototype._setIHeaderHeightInitial=function(e){this.setProperty("_iHeaderHeightInitial",Math.floor(e),true)};p.prototype._getIHeaderHeightInitial=function(){return this.getProperty("_iHeaderHeightInitial")};var v=0;p.prototype.renderElement=function(){var e=t.createRenderManager(),a=this.getParent(),i;if(!a.getShowGanttHeader()){return}var d=a.getId();var p=jQuery("div.sapGanttChartWithTableHeader[data-sap-ui-related="+d.replace(/([:.\[\],=@])/g,"\\$1")+"]");var H=this.getParent().getTable(),c=H.getAggregation("extension");i=c.filter(function(e){if(e instanceof sap.m.OverflowToolbar){return e}});this.iOverflowToolbarHeight=0;if(a.getEnableChartOverflowToolbar()){this.renderOverflowToolbar(e,a);var u=t.byId(d+"-ganttHeaderOverflowToolbar").getDomRef();if(i[0]){var b=t.byId(i[0].sId).getDomRef();if(b){this.iOverflowToolbarHeight=b.clientHeight}}else if(u){this.iOverflowToolbarHeight=u.clientHeight}}if(p&&p.length>0){v=p[0].offsetHeight;if(this.iOverflowToolbarHeight&&a.getEnableChartOverflowToolbar()){v-=this.iOverflowToolbarHeight}}this._setIHeaderHeight(v);var T=r.getGanttRenderWidth(a);var m=0;var w=a.getSimpleAdhocLines().filter(function(e){return e.MarkerType!=sap.gantt.simple.MarkerType.None});var L=a.getDeltaLines().filter(function(e){return e.getVisible()});var y,E,I;y=this._getIHeaderHeight()/4;E=this._getIHeaderHeight()/5*2;I=this._getIHeaderHeight()/5*4;if(w.length>0&&a.getEnableAdhocLine()===true||L.length>0&&a.getEnableDeltaLine()===true){L=L.filter(function(e){return e.getVisible()});w=w.filter(function(e){return e});var _=0;var O=0;var M;if(w.length>0&&a.getEnableAdhocLine()===true&&(L.length>0&&a.getEnableDeltaLine()===true)){M=s.calculateLevelForMarkers(w,L);O=Math.max.apply(Math,M.adhocLines.map(function(e){return e.mProperties._level}));_=Math.max.apply(Math,M.deltaLines.map(function(e){return e.mProperties._level}));if(O>=_){m=_*4+(O-_)*8+_*3+3}else{m=_*4+_*3}}else if(w.length>0&&a.getEnableAdhocLine()===true){M=s.calculateLevelForMarkers(w,[]);O=Math.max.apply(Math,M.adhocLines.map(function(e){return e.mProperties._level}));m=O*8}else if(L.length>0&&a.getEnableDeltaLine()===true){M=s.calculateLevelForMarkers([],L);_=Math.max.apply(Math,M.deltaLines.map(function(e){return e.mProperties._level}));m=_*4+(_+1)*3}if(this.iOverflowToolbarHeight&&!!i[0]&&a.getEnableChartOverflowToolbar()){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+m)}else if(this.iOverflowToolbarHeight&&(!i[0]||a.getEnableChartOverflowToolbar())){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+m+this.iOverflowToolbarHeight)}else{a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+m)}y=(this._getIHeaderHeight()-m)/4;E=(this._getIHeaderHeight()-m)/5*2;I=(this._getIHeaderHeight()-m)/5*4}else{if(this.iOverflowToolbarHeight&&!!i[0]&&a.getEnableChartOverflowToolbar()){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}else if(this.iOverflowToolbarHeight&&(!i[0]||a.getEnableChartOverflowToolbar())){a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+this.iOverflowToolbarHeight)}else{a.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}}var S=a.getAxisTimeStrategy(),x=S.getTimeLineOption(),C=a.getAxisTime();var A=C.getTickTimeIntervalLabel(x,null,[0,T]);e.openStart("svg",d+"-header-svg");e.class("sapGanttChartHeaderSvg");e.attr("height",this._getIHeaderHeight()+"px");e.attr("width",T);if(this.iOverflowToolbarHeight&&a.getEnableChartOverflowToolbar()){e.style("transform","translate(0,"+this.iOverflowToolbarHeight+"px)")}e.openEnd();e.openStart("g").openEnd();this.renderHeaderLabel(e,A[0],{y:E,className:"sapGanttTimeHeaderSvgText"});this.renderHeaderLabel(e,A[1],{y:I,className:"sapGanttTimeHeaderSvgTextMedium"});if(C.largeIntervalLabel&&!C.largeIntervalPath){for(var N=0;N<A[0].length;N++){if(A[0][N].value===C.firstTickPosition){A[0].splice(N,1);break}}}this.renderIntervalLine(e,A[0],{start:0,end:y,className:"sapGanttTimeHeaderLargeIntervalSvgPath"});this.renderIntervalLine(e,A[1],{start:I,end:this._getIHeaderHeight(),className:"sapGanttTimeHeaderSvgPath"});e.close("g");if(a.getEnableAdhocLine()===true&&w.length>0||a.getEnableDeltaLine()===true&&L.length>0){e.openStart("svg","inner-header-svg").openEnd();e.openStart("g","inner-header-g");e.style("height",m);e.openEnd();var P=new l({x:0,y:this._getIHeaderHeight()-m,height:"1px",width:"100%",fill:o.get("sapUiListVerticalBorderColor")});var G=this;P.renderElement(e,P);var D=a.getRenderedTimeRange(),k=D[0],R=D[1];w=w.filter(function(e){var t=n.abapTimestampToDate(e.getTimeStamp());return t>=k&&t<=R&&e.getVisible()&&e.getMarkerType()===sap.gantt.simple.MarkerType.Diamond});if(w.length>0){w.forEach(function(t){g.renderMarker(e,t,a,G._getIHeaderHeight(),m)})}if(L.length!==0){L.forEach(function(t){h.renderDeltaLineHeader(e,t,a,G._getIHeaderHeight(),m)})}e.close("g");e.close("svg")}var V=C.getNowLabel(a.getNowLineInUTC())[0].value;this.renderNowLineHeader(e,a,{headerHeight:this._getIHeaderHeight(),nowLineX:V,iMarkerArea:m});e.openStart("g");e.class("sapGanttChartHeaderSelection");e.openEnd().close("g");e.close("svg");e.flush(p.get(0));e.destroy();f.attachEvents(a)};p.prototype.renderHeaderLabel=function(e,r,n){var o=t.getConfiguration().getRTL();var l=a.browser.edge&&o;r.forEach(function(t){e.openStart("text");e.class(n.className);e.attr("text-anchor","start");e.attr("x",t.value+(o?-5:5));e.attr("y",n.y);if(l){var a=i.calculateStringLength(t.label)*(n.fontSize/2);e.attr("transform","translate("+-a+")")}e.openEnd();e.text(t.label);if(n.className==="sapGanttTimeHeaderSvgTextMedium"&&t.largeLabel){e.openStart("title").openEnd();e.text(t.largeLabel);e.close("title")}e.close("text")})};p.prototype.renderIntervalLine=function(e,t,a){var r="";for(var i=0;i<t.length;i++){var n=t[i];if(n){r+=" M"+" "+(n.value-1/2)+" "+a.start+" L"+" "+(n.value-1/2)+" "+a.end}}e.openStart("path");e.attr("d",r);e.class(a.className);e.openEnd();e.close("path")};p.prototype.renderNowLineHeader=function(e,t,a){var r=t.getAdhocLines();var i=t.getDeltaLines();var n=a.headerHeight;var o=a.iMarkerArea;var l=n;if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){l=n-o}var g=l,s=a.nowLineX;if(t.getEnableNowLine()===false||isNaN(s)){return}var h=8;var f=h/2,p=Math.sqrt(h*h-f*f);var v=[[s,g],[s-f,g-p],[s+f,g-p],[s,g]].reduce(function(e,t,a){var r=t.join(",");return a===0?"M"+r:e+"L"+r},"");e.openStart("g");e.class("sapGanttNowLineHeaderSvgPath");e.openEnd();e.openStart("path");e.attr("d",v);e.openEnd();e.close("path");e.close("g");if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){e.openStart("g");e.class("sapGanttNowLineBodySvgLine");e.openEnd();var H=new d({x1:s,y1:l,x2:s,y2:"100%",strokeWidth:1}).setProperty("childElement",true);H.renderElement(e,H);e.close("g")}};p.prototype.renderOverflowToolbar=function(e,t){var a=t.getId();if(!this._oOverflowToolbar){this.setAggregation("_overflowToolbar",new sap.m.OverflowToolbar(a+"-ganttHeaderOverflowToolbar",{design:"Solid"}).addStyleClass("sapGanttHeaderOverflowToolbar"));this.getAggregation("_overflowToolbar").addContent(new sap.m.ToolbarSpacer);this._oOverflowToolbar=true}var r=t.getOverflowToolbarItems();if(r.length>0){r.forEach(function(e){this.getAggregation("_overflowToolbar").addContent(e)}.bind(this))}this.getAggregation("_overflowToolbar").setWidth("100%");e.openStart("div",a+"-ganttHeaderOverflowToolbarContainer");e.style("width","100%");e.style("position","absolute");e.openEnd();e.renderControl(this.getAggregation("_overflowToolbar"));e.close("div")};p.prototype.exit=function(){if(this._oOverflowToolbar){this._oOverflowToolbar=false}};return p},true);
//# sourceMappingURL=GanttHeader.js.map
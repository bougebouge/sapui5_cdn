sap.ui.define(["sap/ui/core/Control","sap/ui/core/Core","./FindAndSelectUtils","sap/tnt/NavigationListItem","sap/tnt/NavigationList","sap/gantt/library"],function(e,t,s,n,a,i){"use strict";var r=e.extend("sap.gantt.simple.GanttSearchSidePanel",{metadata:{library:"sap.gantt",properties:{},aggregations:{}}});r.prototype.initSearchSidePanel=function(){this._oRb=t.getLibraryResourceBundle("sap.gantt");this.emptyListAndField=true;if(!s._ganttSearchResults){s._ganttSearchResults=[]}else{this.getParent().fireGanttSearchSidePanelList({searchResults:s._ganttSearchResults});this.list=this.getParent().getSearchSidePanelList();if(!this.list){var e=s._ganttSearchResults.map(function(e,t){var s=new n({text:("Gantt "+(e.ganttID+1)+", "+e.sMatchedValue).substring(0,200),id:"listItem"+t});return s});this.list=new a({items:[e]})}this.aSidePanelSearchResults=s._ganttSearchResults;s._searchResultsCount=this.aSidePanelSearchResults.length}var r=[];var o=new sap.m.Button(this.getId()+"-sidePanelToolbarButton",{icon:"sap-icon://drill-up",type:"Transparent",visible:this.getParent().getToolbar().getFindMode()===i.config.FindMode.Both,tooltip:this._oRb.getText("GNT_FIND_POPUP"),press:function(){var e=this.getParent().getToolbar(),t=e._searchFlexBox;e.fireFindPopupButtonPress();t.getItems()[0].setValue(this._oSearchSidePanel.getItems()[1].getContent()[0].getValue());if(s._ganttSearchResults.length>0){t.getItems()[2].setText("("+(s._selectedIndex+1)+"/"+s._searchResultsCount+")")}this.getParent().setShowSearchSidePanel(false);s.updateToolbarItems(e,true,true);e.searchResultsCount=s._searchResultsCount;s.toggleNavigationState(t.getItems()[1],t.getItems()[3]);this._oSearchSidePanel.destroy()}.bind(this)});var g=new sap.m.Button(this.getId()+"-sidePanelCloseButton",{text:this._oRb.getText("GNT_FIND_CLOSE"),type:"Transparent",tooltip:this._oRb.getText("GNT_FIND_CLOSE"),press:function(){var e=this.getParent().getToolbar(),t=e._searchFlexBox;e.fireCloseSidePanelButtonPress();t.getItems()[0].setValue(this._oSearchSidePanel.getItems()[1].getContent()[0].getValue());this.getParent().setShowSearchSidePanel(false);s.updateToolbarItems(e,false);s.updateShapeSelectionANDHighlight(this.getParent().getGanttCharts(),s.previousGanttID);if(s._ganttSearchResults.length>0){t.getItems()[2].setText("("+(s._selectedIndex+1)+"/"+s._searchResultsCount+")")}s.toggleNavigationState(this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1]);this._oSearchSidePanel.destroy()}.bind(this)});r.push(o);r.push(g);this._oSearchSidePanel=new sap.m.VBox(this.getId()+"-ganttSearchSidePanel",{items:[new sap.m.Panel({content:[new sap.m.FlexBox(this.getId()+"-sidePanelHeader",{justifyContent:"End",items:[new sap.m.Title({text:this._oRb.getText("GNT_FIND_PLACEHOLDER")}),r]}).addStyleClass("sapUiFindHeader")]}).addStyleClass("sapUiNoContentPadding"),new sap.m.Panel(this.getId()+"-sidePanelFindOperation",{content:[new sap.m.SearchField(this.getId()+"-sidePanelFindSearchField",{placeholder:this._oRb.getText("GNT_FIND_PLACEHOLDER"),value:this.getParent().getToolbar()._searchFlexBox.getItems()[0].getValue(),search:function(e){if(e.getParameter("clearButtonPressed")){var t=this._oSearchSidePanel.getItems();s.updateShapeSelectionANDHighlight(this.getParent().getGanttCharts(),s.previousGanttID);s._selectedIndex=0;s._searchResultsCount=0;s._ganttSearchResults=[];t[2].getContent()[0].getItems()[0].setText(this._oRb.getText("GNT_EMPTY_RESULT_INFO_SIDE_PANEL"));t[3].getContent()[0].destroyItems();t[2].rerender();t[3].rerender();this.getParent().getToolbar()._searchFlexBox.getItems()[2].setText("("+s._selectedIndex+"/"+s._searchResultsCount+")");this.getParent().getToolbar()._searchFlexBox.getItems()[0].setValue("");this.setEmptyListInfo(this.emptyListAndField);s.toggleNavigationState(this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1])}else{var n=this._oSearchSidePanel.getItems()[1].getContent()[0].getValue();s.triggerSearchEvent(n,this.getParent().getGanttCharts(),true,this.getParent().getAggregation("toolbar"),this);this.setContainerHeight()}}.bind(this)})]}),new sap.m.Panel(this.getId()+"-sidePanelFindListHeader",{content:[new sap.m.FlexBox(this.getId()+"-sidePanelFindListHeaderBox",{alignItems:"Center",justifyContent:"SpaceBetween",items:[new sap.m.Text(this.getId()+"-sidePanelFindListHeaderTitle",{text:this._oRb.getText("GNT_RESULT")+" ("+s._searchResultsCount+")"}),new sap.m.FlexBox({items:[new sap.m.Button(this.getId()+"-sidePanelFindListNavigateUp",{icon:"sap-icon://navigation-up-arrow",type:"Transparent",tooltip:this._oRb.getText("GNT_FIND_PREVIOUS"),press:function(){if(s._selectedIndex>0){s._selectedIndex--;s.navigateToSearchResult(this.getParent().getGanttCharts(),this)}}.bind(this)}),new sap.m.Button(this.getId()+"-sidePanelFindListNavigateDown",{icon:"sap-icon://navigation-down-arrow",type:"Transparent",tooltip:this._oRb.getText("GNT_FIND_NEXT"),press:function(){if(s._ganttSearchResults.length-1>s._selectedIndex){s._selectedIndex++;s.navigateToSearchResult(this.getParent().getGanttCharts(),this)}}.bind(this)})]})]}).addStyleClass("sapUiFindResults")]}).addStyleClass("sapUiNoContentPadding"),new sap.m.ScrollContainer(this.getId()+"-searchListContainer",{height:"auto",vertical:true,focusable:true,content:[this.list]})]});this._oSearchSidePanel.getItems()[3].getContent()[0].setSelectedItem("listItem"+s._selectedIndex);this._oSearchSidePanel.getItems()[1].getContent()[0].setValue(this.getParent().getToolbar()._searchFlexBox.getItems()[0].getValue())};r.prototype.onBeforeRendering=function(){if(this._oSearchSidePanel){this._oSearchSidePanel.destroy()}this.initSearchSidePanel()};r.prototype.onAfterRendering=function(){if(this._oSearchSidePanel.getItems()[3].getContent()[0].getItems().length===0&&this._oSearchSidePanel.getItems()[1].getContent()[0].getValue()===""){this.setEmptyListInfo(this.emptyListAndField)}else if(this._oSearchSidePanel.getItems()[3].getContent()[0].getItems().length===0&&this._oSearchSidePanel.getItems()[1].getContent()[0].getValue()!==""){this.setEmptyListInfo(!this.emptyListAndField)}this.setContainerHeight();var e=document.getElementById("listItem"+s._selectedIndex);var t=this.getParent().getUIArea().getContent()[0].getDomRef().getBoundingClientRect().bottom;if(e){if(e.getBoundingClientRect().bottom>t){var n=e.offsetTop;document.getElementById(this.getId()+"-searchListContainer").scrollTop=n}}s.toggleNavigationState(this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1],true);var a=this.getParent().getToolbar().getAllToolbarItems();a.forEach(function(e){if(e.getId().includes("findAndSelectSearchButton")&&e.getDomRef()){Array.from(e.getDomRef().children).forEach(function(e){if(e.id.includes("findAndSelectSearchButton-inner")){setTimeout(function(){e.classList.add("sapMBtnEmphasized")})}})}});setTimeout(function(){if(e){e.children[0].focus()}else{var t=this._oSearchSidePanel.getItems()[1].getContent()[0];var s=t.getValue().length;var n=t.getDomRef().getElementsByTagName("input")[0];t.focus();n.setSelectionRange(s,s)}}.bind(this),0);this.addEventListener()};r.prototype.setEmptyListInfo=function(e){if(e){this.list.addItem(new n({text:this._oRb.getText("GNT_EMPTY_LIST_FIELD_INFO")}))}else{this.list.addItem(new n({text:this._oRb.getText("GNT_EMPTY_LIST_INFO")}))}this.list.getItems()[0].setEnabled(false);this.list.rerender();var t=this.list.getItems()[0].getDomRef().querySelector(".sapTntNavLIText");t.style.textAlign="center"};r.prototype.setContainerHeight=function(){var e=this._oSearchSidePanel.getItems()[2].getDomRef().getBoundingClientRect().bottom;var t=this.getParent().getUIArea().getContent()[0].getDomRef().getBoundingClientRect().bottom;var s=this.getParent().getEnableStatusBar()?64:32;var n=t-(e+s);this._oSearchSidePanel.getItems()[3].setHeight(n+"px");this._oSearchSidePanel.getItems()[3].rerender()};r.prototype._updateContent=function(){if(this.list){this.list.destroyItems()}this.list=this.getParent().getSearchSidePanelList();if(!this.list){var e=s._ganttSearchResults.map(function(e,t){var s=new n({text:("Gantt "+(e.ganttID+1)+", "+e.sMatchedValue).substring(0,200),id:"listItem"+t});return s});this.list=new a({items:[e]})}this.aSidePanelSearchResults=s._ganttSearchResults;s._searchResultsCount=this.aSidePanelSearchResults.length;this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[0].setText(this._oRb.getText("GNT_RESULT")+"("+s._searchResultsCount+")");this._oSearchSidePanel.getItems()[3].destroyContent();this._oSearchSidePanel.getItems()[3].addContent(this.list);this._oSearchSidePanel.getItems()[2].rerender();this._oSearchSidePanel.getItems()[3].rerender();this.addEventListener()};r.prototype.addEventListener=function(){var e=this._oSearchSidePanel.getItems()[3].getContent()[0]._itemNavigation.oDomRef;var t=null;e.addEventListener("keydown",function(e){if(e.target.tagName==="DIV"){t=e.target.parentElement.id}else if(e.target.tagName==="A"){t=e.target.parentElement.parentElement.id}if(e.code==="ArrowDown"){if(s._selectedIndex===s._searchResultsCount-1){s._selectedIndex=parseInt(t.replace(/\D/g,""),10)}else{s._selectedIndex=parseInt(t.replace(/\D/g,""),10)+1}}else if(e.code==="ArrowUp"){if(s._selectedIndex===0){s._selectedIndex=parseInt(t.replace(/\D/g,""),10)}else{s._selectedIndex=parseInt(t.replace(/\D/g,""),10)-1}}s.updateShapeSelectionANDHighlight(this.getParent().getGanttCharts(),s.previousGanttID);this._oSearchSidePanel.getItems()[3].getContent()[0].setSelectedItem("listItem"+s._selectedIndex);var n=s._ganttSearchResults[s._selectedIndex];if(s.previousGanttID!==n.ganttID){s.previousGanttID=n.ganttID}var a=this.getParent().getGanttCharts()[s.previousGanttID];s.scrollToShape(n,a);s.toggleNavigationState(this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1],true)}.bind(this));e.addEventListener("click",function(){s._selectedIndex=parseInt(document.activeElement.id.replace(/\D/g,""),10);this._oSearchSidePanel.getItems()[3].getContent()[0].setSelectedItem("listItem"+s._selectedIndex);this._oSearchSidePanel.getItems()[3].getContent()[0].getSelectedItem().getDomRef().children[0].focus();var e=s._ganttSearchResults[s._selectedIndex];s.updateShapeSelectionANDHighlight(this.getParent().getGanttCharts(),s.previousGanttID);if(s.previousGanttID!==e.ganttID){s.previousGanttID=e.ganttID}var t=this.getParent().getGanttCharts()[s.previousGanttID];s.scrollToShape(e,t);s.toggleNavigationState(this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[0],this._oSearchSidePanel.getItems()[2].getContent()[0].getItems()[1].getItems()[1],true)}.bind(this))};r.prototype.exit=function(){this._oSearchSidePanel.destroy()};return r});
//# sourceMappingURL=GanttSearchSidePanel.js.map
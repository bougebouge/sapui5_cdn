/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","./BaseShape","./GanttUtils","sap/ui/Device","sap/ui/core/theming/Parameters","../library","./RenderUtils"],function(t,e,i,r,a,s,n){"use strict";var o=s.simple.shapes.ShapeAlignment;var l=e.extend("sap.gantt.simple.BaseText",{metadata:{library:"sap.gantt",properties:{text:{type:"string"},x:{type:"float"},y:{type:"float"},fontSize:{type:"int",defaultValue:13},textAnchor:{type:"string",defaultValue:"start"},fontFamily:{type:"string",defaultValue:"Arial"},truncateWidth:{type:"float"},showEllipsis:{type:"boolean",defaultValue:true},isLabel:{type:"boolean",defaultValue:false},_shapeCropped:{type:"boolean",defaultValue:false},_xBiassed:{type:"float"}}},renderer:{apiVersion:2}});var h=["x","y","text-anchor","style","filter","transform","opacity"];l.prototype.getX=function(){var t=i.getValueX(this);if(isNaN(t)&&this.getParent()&&this.getParent().getTime){t=i.getValueX(this.getParent())}return t};l.prototype.getY=function(){var t=this.getProperty("y"),e=1;if(t!==null&&t!==undefined){return t}var i=this.getFontSize();var r=this.getRowYCenter()+i/2;if(this._iBaseRowHeight!=undefined){if(this.getAlignShape()==o.Top){r=this.getRowYCenter()-this._iBaseRowHeight/2+i}else if(this.getAlignShape()==o.Bottom){r=this.getRowYCenter()+this._iBaseRowHeight/2-e}r=parseInt(r,10)}return r};l.prototype.getStyle=function(){var t=e.prototype.getStyle.apply(this,arguments);var i=this.getTitleColor()?this.getTitleColor():this.getFill()||a.get("sapUiBaseText");var r={"font-size":this.getFontSize()+"px",fill:this.determineValueColor(i),"font-family":this.getFontFamily(),"font-weight":this.getFontWeight()};return t+this.getInlineStyle(r)};l.prototype.renderElement=function(t,e){this.writeElementData(t,"text",true);if(this.aCustomStyleClasses){this.aCustomStyleClasses.forEach(function(e){t.class(e)})}n.renderAttributes(t,e,h);var i=e.getGanttChartBase();if(i&&i.getSelectOnlyGraphicalShape()&&e.getIsLabel()){t.class("sapGanttTextNoPointerEvents")}t.openEnd();n.renderTooltip(t,e);if(this.getShowAnimation()){n.renderElementAnimation(t,e)}this.writeTruncatedText(t,e);t.close("text")};l.prototype.writeTruncatedText=function(t,e){var i=e.getText(),r=this.getTruncateWidth()!=null;if(r){var a=this._truncateText(i);this.renderEllipsisIfNecessary(t,a)}else{t.text(i)}};l.prototype.getTruncateWidth=function(){var e=this.getProperty("truncateWidth");var i=this.getParent();if(i&&i.isA("sap.gantt.simple.BaseShape")){var r=0;if(i.getWidth){r=i.getWidth()}else if(i.getEndTime()&&i.getTime()){r=Math.abs(this.getXByTime(i.getEndTime())-this.getXByTime(i.getTime()))}else{r=e}if(r<e){return r}}if(this.getTextAnchor().toLowerCase()===s.simple.horizontalTextAlignment.Dynamic.toLowerCase()&&this.getProperty("_shapeCropped")){e=t.getConfiguration().getRTL()?e+this.getProperty("_xBiassed"):e-this.getProperty("_xBiassed")}return e};l.prototype.renderEllipsisIfNecessary=function(t,e){if(e.ellipsis){t.text(e.truncatedText+"...")}else{t.text(e.truncatedText)}};l.prototype._truncateText=function(t){var e=this._processTextForTruncation(t);e=e||{ellipsis:false,truncatedText:t};return e};l.prototype._processTextForTruncation=function(e){var i=this.getTruncateWidth(),r=this.measureTextWidth("..."),a=this.measureTextWidth(e);if(a>i){var s,n;if(this.getShowEllipsis()&&r<i){n=true;s=i-r}else{n=false;s=i}var o;var l=this._geNumberOfTruncatedCharacters(a,s,e);if(t.getConfiguration().getRTL()){var h=e.length-l;o=e.slice(h,e.length).trim()}else{o=e.slice(0,l).trim()}return{ellipsis:n,truncatedText:o}}return null};l.prototype.getTextAnchor=function(){var t=this.getProperty("textAnchor");return t};l.prototype._geNumberOfTruncatedCharacters=function(t,e,i){var r=0;if(t>e){if(e>0&&i.length>0){r=Math.round(e/Math.ceil(t/i.length));while(true){if(r<0){break}var a=this.measureTextWidth(i.slice(0,r));var s=this.measureTextWidth(i.slice(0,r+1));if(a>e){r--;continue}if(s<e){r++;continue}break}}}else{return i?i.length:0}return r>=0&&r<=i.length?r:0};l.prototype.measureTextWidth=function(t){return i.getShapeTextWidth(t,this.getFontSize(),this.getFontFamily(),this.getFontWeight())};return l},true);
//# sourceMappingURL=BaseText.js.map
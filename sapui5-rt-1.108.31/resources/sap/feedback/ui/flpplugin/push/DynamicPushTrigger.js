/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","../utils/Constants"],function(i,t,n){"use strict";return i.extend("sap.feedback.ui.flpplugin.push.DynamicPushTrigger",{_oCentralConfig:null,_oStorage:null,_oTimeout:null,_fnHandleDynamicPush:null,_iDynamicPushDelayInMinutes:null,_iNextDynamicPushDate:null,_iMinimumTimeToStartTimerForDynamicPushInHrs:null,constructor:function(i,t){if(!i){throw Error("oCentralConfig is not provided!")}this._oCentralConfig=i;if(!t){throw Error("oStorage is not provided!")}this._oStorage=t},init:function(i){if(!i){t.error("Callback for Dynamic Push trigger not set, could not start Dynamic Push trigger.",null,n.S_PLUGIN_DYNAMICPUSHTRIGGER_NAME);return}var e=this._oCentralConfig.getPushConfig();if(e){this._iDynamicPushDelayInMinutes=e.getDynamicPushIntervalTimer();this._iMinimumTimeToStartTimerForDynamicPushInHrs=e.getMinimumTimeToStartTimerForDynamicPush();var r=this._readUserState();this._iNextDynamicPushDate=r.getDynamicPushDate()}if(!Number.isFinite(this._iDynamicPushDelayInMinutes)){t.error("Interval for Dynamic Push is invalid, could not start Dynamic Push trigger.",null,n.S_PLUGIN_DYNAMICPUSHTRIGGER_NAME);return}if(!Number.isFinite(this._iMinimumTimeToStartTimerForDynamicPushInHrs)){t.error("Minimum time to start timer for Dynamic Push is invalid, could not start Dynamic Push trigger.",null,n.S_PLUGIN_DYNAMICPUSHTRIGGER_NAME);return}this._fnHandleDynamicPush=i;if(this._canTimerStart()){this._startTimer(this._iDynamicPushDelayInMinutes)}},stopTimer:function(){clearTimeout(this._oTimeout);this._oTimeout=null},_onTimeoutCallback:function(){this._oTimeout=null;if(this._fnHandleDynamicPush){this._fnHandleDynamicPush()}this._oTimeout=this._startTimer(this._iDynamicPushDelayInMinutes)},_startTimer:function(){this._oTimeout=setTimeout(this._onTimeoutCallback.bind(this),this._iDynamicPushDelayInMinutes*n.E_TIME.minutesToMilliseconds);t.info("Fiori Feedback Plug-in: dynamical push will be triggered in ",this._iDynamicPushDelayInMinutes+" minutes",n.S_PLUGIN_DYNAMICPUSHTRIGGER_NAME)},_readUserState:function(){return this._oStorage.readUserState()},_canTimerStart:function(){if(this._iNextDynamicPushDate-Date.now()<=this._iMinimumTimeToStartTimerForDynamicPushInHrs*n.E_TIME.hoursToMilliseconds){return true}return false}})});
//# sourceMappingURL=DynamicPushTrigger.js.map
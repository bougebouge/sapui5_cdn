/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/write/_internal/FlexInfoSession"],function(e,t,n,r,s,i,a,o){"use strict";var u="/flex/keyuser";var l=e({},n,{layers:[t.CUSTOMER,t.PUBLIC],ROUTES:{CHANGES:u+r.API_VERSION+"/changes/",SETTINGS:u+r.API_VERSION+"/settings",TOKEN:u+r.API_VERSION+"/settings",VERSIONS:{GET:u+r.API_VERSION+"/versions/",ACTIVATE:u+r.API_VERSION+"/versions/activate/",DISCARD:u+r.API_VERSION+"/versions/draft/"},TRANSLATION:{UPLOAD:u+r.API_VERSION+"/translation/texts",DOWNLOAD:u+r.API_VERSION+"/translation/texts/",GET_SOURCELANGUAGE:u+r.API_VERSION+"/translation/sourcelanguages/"},CONTEXTS:u+r.API_VERSION+"/contexts/"},isLanguageInfoRequired:true,loadFeatures:function(e){return n.loadFeatures.call(this,e).then(function(e){e.isContextSharingEnabled=true;return e})},getContexts:function(e){var t=["type","$skip","$filter"];var n=a(e,t);var i=s.getUrl(this.ROUTES.CONTEXTS,e,n);return s.sendRequest(i,"GET",{initialConnector:r}).then(function(e){return e.response})},loadContextDescriptions:function(e){var t={};s.addLanguageInfo(t);c.call(this,e);var n=s.getUrl(this.ROUTES.CONTEXTS,e,t);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return i.sendRequest(n,"POST",e)},isContextSharingEnabled:function(){return Promise.resolve(true)},getFlexInfo:function(e){return o.get(e.selector)||{}}});function c(e){e.initialConnector=r;e.tokenUrl=this.ROUTES.TOKEN}function S(e){var t={title:e.title};e.payload=JSON.stringify(t);e.dataType="json";e.contentType="application/json; charset=utf-8"}function T(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}l.versions={load:function(e){c.call(this,e);var t={};s.addLanguageInfo(t);t.limit=e.limit;var n=s.getUrl(this.ROUTES.VERSIONS.GET,e,t);return s.sendRequest(n,"GET",e).then(function(e){return e.response.versions.map(function(e){return T(e)})})},activate:function(e){c.call(this,e);S(e);var t={version:e.version};s.addLanguageInfo(t);var n=s.getUrl(this.ROUTES.VERSIONS.ACTIVATE,e,t);return i.sendRequest(n,"POST",e).then(function(e){var t=e.response;return T(t)})},discardDraft:function(e){c.call(this,e);var t=s.getUrl(this.ROUTES.VERSIONS.DISCARD,e);return i.sendRequest(t,"DELETE",e)}};l.translation={getTexts:function(e){c.call(this,e);var t=a(e,["sourceLanguage","targetLanguage"]);var n=s.getUrl(this.ROUTES.TRANSLATION.DOWNLOAD,e,t);return s.sendRequest(n,"GET",e).then(function(e){return e.response})},getSourceLanguages:function(e){c.call(this,e);var t={};var n=s.getUrl(this.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,t);return s.sendRequest(n,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts:function(e){c.call(this,e);var t=s.getUrl(this.ROUTES.TRANSLATION.UPLOAD,e,{});return s.sendRequest(t,"POST",e)}};l.initialConnector=r;return l});
//# sourceMappingURL=KeyUserConnector.js.map
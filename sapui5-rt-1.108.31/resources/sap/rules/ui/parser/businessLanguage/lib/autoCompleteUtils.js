sap.ui.define(["sap/rules/ui/parser/businessLanguage/lib/parseModel","sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/businessLanguage/lib/parseUtils","sap/rules/ui/parser/businessLanguage/lib/vocabularyUtils","sap/rules/ui/parser/businessLanguage/lib/parserTokens","sap/rules/ui/parser/businessLanguage/lib/utils","sap/rules/ui/parser/businessLanguage/lib/antlr3_all_min","sap/rules/ui/parser/infrastructure/errorHandling/hrfException"],function(t,e,n,i,o,s,a,r){"use strict";var l=new t.parseModelLib;var u=new n.parseUtilsLib;var p=new i.vocabularyUtilsLib;var g=new s;function f(){}f.prototype.overwriteParserReportError=function(t,e){t.reportError=function(n){function i(){l.getModelManger().setDFAFailed(true);e.contextInfo.valueListAttribute=l.getModelManger().getValueListAttribute();e.contextInfo.isDeprecatedAllContext=l.getModelManger().isAllContext();e.contextInfo.isTermAllContext=l.getModelManger().isTermAllContext()}function s(){l.getModelManger().cleanValueListAttribute();t.isInsideWhere=t.isInsideWhere!==undefined&&t.isInsideWhere===true?true:l.getModelManger().isInsideWhere;t.disableAliases=t.disableAliases!==undefined&&t.disableAliases===true?true:l.getModelManger().disableAliases;var e=l.getModelManger().contextQueue.length;if(e>0){var n=l.getModelManger().contextQueue[e-1];var i=n.associations.path.length;var o=i>0?n.associations.path[i-1].object:n.root.name;t.context=n.root.isAlias?null:o;t.fullContext=n;t.contextWasFound=true}else{if(t.hasOwnProperty("contextWasFound")===false||t.contextWasFound===false){t.context=null;t.fullContext=null;t.isInsideWhere=null}}}function p(){if(!t.lexerErrorOccurred){e.lastText=n.input.tokenSource.input.data;if(!(n.input.tokens.length===undefined||n.input.tokens.length===0)){var i=n.input.tokens.length-1;var s=n.input.tokens[n.input.tokens.length-1].stop+1;var r=n.input.tokens[n.input.tokens.length-1].start;for(i;i>=0;i--){if(n.input.tokens[i].channel!==a.antlr.runtime.Token.HIDDEN_CHANNEL&&n.input.tokens[i].type===o.NAVIGATION){r=n.input.tokens[i].start;break}}e.lastText=e.lastText.substring(r,s)}}}function f(){if(n instanceof a.antlr.runtime.NoViableAltException||n instanceof a.antlr.runtime.RecognitionException&&!(n instanceof a.antlr.runtime.UnwantedTokenException)){if(g.isInArray(n.decisionNumber,t.DFA_decisions)){u.handleFailedDFA(t,n,e)}}else if(n instanceof a.antlr.runtime.MismatchedTokenException){if(n instanceof a.antlr.runtime.UnwantedTokenException){e.isPartialText=e.isPartialText||u.isLastTokenPartialText(t)}}}i();s();p();f();throw new r.HrfException}};f.prototype.overwriteLexerReportError=function(t,e,n){t.reportError=function(t){if(e.lexerErrorOccurred===false){e.lexerErrorOccurred=true;e.lexerErrorStartIndex=t.input.markers[1].charPositionInLine;if(t instanceof a.antlr.runtime.NoViableAltException){var i=t.input.data;n.lastText=i.substring(t.input.p,t.input.n);n.isPartialText=true}if((t instanceof a.antlr.runtime.MismatchedTokenException||t instanceof a.antlr.runtime.MismatchedSetException||t instanceof a.antlr.runtime.EarlyExitException)&&t.c===-1){var o=e.input.tokens.length;if(o>0){var s=e.input.tokens[o-1].stop+1;var l=t.input.data;n.lastText=l.substring(s,t.input.n)}else{n.lastText=t.input.data}n.isPartialText=true}else if(t.c===" "){throw new r.HrfException}}}};f.prototype.insertTermsAlternatives=function(t,n,i,o){var s="";var a;var r;for(a=0;a<t.length;a++){r=n===null?t[a]:t[a].substring(n.length);s=s+o+'{"text":"'+t[a]+'", "completion":"'+i+r+'", "tokenType":"'+e.tokenTypesEnum.vocabulary+'"';s=s+"}";o=","}return s};f.prototype.insertOMAlternatives=function(t,e,n,i,o,s){var a="";var r;e.sort(function(t,e){if(t.name>e.name){return 1}if(t.name<e.name){return-1}return 0});var u,p;var g=JSON.stringify(n);g=g.substring(1,g.length-1);var f;var T=null;for(r=0;r<e.length;r++){if(e[r].tokenType==="vocabulary"&&s==="displayText"){T=e[r].description}else{T=e[r].name}f=JSON.stringify(T);f=f.substring(1,f.length-1);u=g===null?f:f.substring(g.length);if(this.navigationCompletionInfo.isValueListSuggestions){if(t.getValueListType(l.getModelManger().vocabulary,f)==="External"){f=u="<Value Help>";i=""}}p=e[r].info?JSON.stringify(e[r].info):null;a=a+o+'{"text":"'+f+'", "completion":"'+i+u+'", "tokenType":"'+e[r].tokenType+'"';if(p){a=a+","+'"info":'+p}a=a+"}";o=","}return a};f.prototype.completeByValueListInLexerError=function(t,e){var n="";if(e.lexerErrorOccurred){var i=p.getAltValueListForValueListAttr(l.getModelManger().vocabulary,t,this.parsingOutputInfo.contextInfo.valueListAttribute,this.parsingOutputInfo.lastText);if(i.length>0){this.startSuggestionList();var o="";n+=this.insertOMAlternatives(t,i,this.parsingOutputInfo.lastText,"",o,null);this.navigationCompletionInfo.isValueListSuggestions=true;this.strSuggestions+=n;return true}}return false};f.prototype.filterTypes=function t(e,n,i){var s=[];if(e===o.COUNT_OF||e===o.NUMBER_OF){s[0]=i[o.TYPECOLLECTION].toLowerCase()}else{s=n}return s};f.prototype.convertNavigationRELTypesToBusinessTypes=function(t){var n;var i;var s;var a=t.getTokenNames();var r=g.removeDuplicate(this.parsingOutputInfo.allowedTypes);var l=u.getLastTokenTypeAndIgnoreWS(t);r=this.filterTypes(l,r,a);for(n=0;n<r.length;n++){i={};s={};switch(r[n]){case a[o.TYPENUMBER].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEAN].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRING].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATE].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIME].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMP].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVAL].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPENUMBERCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEANCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRINGCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIMECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMPCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVALCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPENUMBERDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEANDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRINGDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATEDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIMEDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMPDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVALDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=null;break;default:continue}s=JSON.parse(JSON.stringify(i));if(s.isCollection!==true){s.isCollection=true;this.navigationCompletionInfo.collectionBusinessTypes.push(i)}else{this.navigationCompletionInfo.completeCollection=true}this.navigationCompletionInfo.collectionBusinessTypes.push(s);this.navigationCompletionInfo.simpleBusinessTypes.push(i)}};f.prototype.calcSpacePrefixAdditionForNonNavigation=function(t){if(!this.isPartialCompletion()&&!g.isEmptyArray(t.input.tokens)&&t.input.tokens[t.input.tokens.length-1].type!==o.WS){return" "}return""};f.prototype.calcSpacePrefixAdditionForNavigation=function(t){if(!this.isPartialCompletion()&&!g.isEmptyArray(t.input.tokens)&&t.input.tokens[t.input.tokens.length-1].type!==o.WS&&t.input.tokens[t.input.tokens.length-1].type!==o.NAVIGATION&&t.input.tokens[t.input.tokens.length-1].type!==o.ALL){return" "}return""};f.prototype.calculateNavigationStartText=function(){if(this.isPartialCompletion()){this.navigationCompletionInfo.navigationTextInput=this.parsingOutputInfo.lastText}else{this.navigationCompletionInfo.navigationTextInput=""}};f.prototype.isPartialCompletion=function(){return this.parsingOutputInfo.isPartialText};f.prototype.handleEmptyNextTokens=function(t){if(g.isEmptyArray(this.parsingOutputInfo.nextTokens)){if(this.isPartialCompletion()&&t.lexerErrorOccurred){this.parsingOutputInfo.nextTokens=t.getTokenNames();this.parsingOutputInfo.allTokens=true}}};f.prototype.disableToken=function(t,e,n,i,s){var a=false;var r=u.getTokensDisplayMap(s);a=n===r.DOT&&u.endsWith(this.parsingOutputInfo.lastText.toLowerCase()," ")||n===r.COUNT_OF||n===r.MAXIMUM_OF||n===r.MINIMUM_OF||n===r.FIRST||n===r.LAST||i===o.CURRENT&&!e.isInsideWhere||n===r.EQ_SIGN||n===r.NOT_EQUAL_SIGN||n===r.GREATER_EQUAL_SIGN||n===r.LESS_EQUAL_SIGN||n===r.GREATER_SIGN||n===r.LESS_SIGN||n===r.EQUALS||n===r.DOES_NOT_EQUAL||n===r.NOT_EQUAL||n===r.ZERO_OR_ONE||i===o.CURRENT&&this.parsingOutputInfo.contextInfo.isDeprecatedAllContext===false&&!this.parsingOutputInfo.contextInfo.isTermAllContext||i===o.ALL_OF_OBJ||i===o.ALL&&!t.isTermModifierEmpty(l.getModelManger().vocabulary)||i===o.OF&&!t.isTermModifierEmpty(l.getModelManger().vocabulary)||i===o.CURRENT&&!t.isCurrentTermModifierEmpty(l.getModelManger().vocabulary);return a};f.prototype.disableAdvancedFunctions=function(t,e){var n=t.getAdvancedFunctions(l.getModelManger().vocabulary);if(!u.advancedFunctions.hasOwnProperty(e)){return false}var i;for(i=0;i<n.advancedFunctions.length;i++){if(n.advancedFunctions[i].name===u.advancedFunctions[e]){return false}}return true};f.prototype.disableGreaterOrLessThenOps=function(t,e){if(t===o.IS_EQUAL_OR_GREATER_THAN||t===o.IS_GREATER_THAN||t===o.GREATER_THAN||t===o.IS_EQUAL_OR_LESS_THAN||t===o.IS_LESS_THAN||t===o.LESS_THAN){var n=u.getLastTokenTypeAndIgnoreWS(e);if(n===o.TYPETIME||n===o.TYPEDATE||n===o.TYPETIMESTAMP){return true}}return false};f.prototype.disableDateTimeFormatsForString=function(t,e,n){var i=false;var s=u.getTokensDisplayMap(n);if(g.isInArray(o.TYPESTRING.toString(),e)&&!(g.isInArray(o.TYPETIMESTAMP.toString(),e)||g.isInArray(o.TYPEDATE.toString(),e)||g.isInArray(o.TYPETIME.toString(),e))){i=t===s.DATESTRING||t===s.TIMESTAMPSTRING||t===s.TIMESTRING}return i};f.prototype.getTokenName=function(t,e){var n=e.getTokenNames();var i=e.parseModelLib.getModelManger();var o=u.getTokensDisplayMap(i);var s=n[t];if(o.hasOwnProperty(s)){s=o[s]}if(s===o.DATESTRING||s===o.TIMESTAMPSTRING||s===o.TIMESTRING){return s}return s.toLowerCase()};f.prototype.disableNumericFragements=function(t,e,n){var i=false;var s=u.getTokensDisplayMap(n);if(g.isInArray(o.ZERO_TO_ONE.toString(),e)&&(g.isInArray(o.INT.toString(),e)||g.isInArray(o.DECIMAL.toString(),e))){i=t===s.ZERO_TO_ONE}return i};f.prototype.isValidTokenToSuggest=function(t,e,n){var i=!t||t==="<eor>"||n||this.isPartialCompletion()&&e!==this.parsingOutputInfo.lastText.toLowerCase()||t.indexOf("parameter")!==-1;return!i};f.prototype.checkNavigationToken=function(t){var e=false;if(t.lastIndexOf("type",0)===0&&t.indexOf("parameter",0)<0||t==="navigation"){e=true;this.parsingOutputInfo.navigationCompleteion=true;if(t!=="navigation"){this.parsingOutputInfo.allowedTypes.push(t)}}return e};f.prototype.filterTokens=function(t,e){var n=[];var i="<eor>";var o=-1;var s=0;var a="";var r=false;var l={};var u=e.parseModelLib.getModelManger();this.parsingOutputInfo.nextTokens=g.removeDuplicate(this.parsingOutputInfo.nextTokens);for(s=0;s<this.parsingOutputInfo.nextTokens.length;s++){r=false;i="<eor>";o=this.parsingOutputInfo.allTokens?s:parseInt(this.parsingOutputInfo.nextTokens[s],10);if(o>0){i=this.getTokenName(o,e)}a=i.substring(0,this.parsingOutputInfo.lastText.length);if(this.disableToken(t,e,i,o,u)){continue}if(this.disableAdvancedFunctions(t,i)){continue}if(this.disableDateTimeFormatsForString(i,this.parsingOutputInfo.nextTokens,u)){continue}if(this.disableNumericFragements(i,this.parsingOutputInfo.nextTokens,u)){continue}if(this.disableGreaterOrLessThenOps(o,e)){continue}r=this.checkNavigationToken(i);if(this.isValidTokenToSuggest(i,a,r)){l={};l.type=o;l.name=i;n.push(l)}}n=g.removeDupplicateByName(n);n.sort(function(t,e){if(t>e){return 1}if(t<e){return-1}return 0});return n};f.prototype.handleWhitespaceCharsInLastText=function(){if(u.isEmptyString(this.parsingOutputInfo.lastText)){this.parsingOutputInfo.lastText=""}this.parsingOutputInfo.lastText=this.parsingOutputInfo.lastText.replace(/\s+/g," ")};f.prototype.startSuggestionList=function(){this.strSuggestions="["};f.prototype.closeSuggestionList=function(){if(this.strSuggestions.charAt(this.strSuggestions.length-1)===","){this.strSuggestions=this.strSuggestions.slice(0,this.strSuggestions.length-1)}this.strSuggestions=this.strSuggestions+"]";this.strSuggestions=this.strSuggestions.replace(/\\/g,"\\\\")};f.prototype.prepareContextSuggestionsInsideWhere_dotMode=function(t,e,n,i){if(this.navigationCompletionInfo.navigationTextInput.indexOf(".")!==-1&&this.parsingOutputInfo.contextInfo.contextNavigation!==null&&this.navigationCompletionInfo.completeCollection===false&&e!==o.CURRENT){var s=this.navigationCompletionInfo.navigationTextInput.substring(0,this.navigationCompletionInfo.navigationTextInput.lastIndexOf("."));if(this.parsingOutputInfo.contextInfo.contextNavigation.navigation.indexOf(s)===0){if(n.length>2){var a=p.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,t,l.getModelManger().vocabulary,this.navigationCompletionInfo.collectionBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(a.isValid===false&&a.attribute.altAttr.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,a.attribute.altAttr,a.attribute.name,i,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.commaDelimiter=","}}var r=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.substring(0,this.parsingOutputInfo.contextInfo.contextNavigation.navigation.lastIndexOf("."));if(s!==r&&r.indexOf(this.navigationCompletionInfo.navigationTextInput)===0){var u=r.replace(this.navigationCompletionInfo.navigationTextInput,"");var g=u.split(".");this.navigationCompletionInfo.navSuggestions=this.navigationCompletionInfo.navSuggestions+this.navigationCompletionInfo.commaDelimiter+'{"text":"'+i+n[n.length-1]+g[0]+'", "completion":"'+i+g[0]+'"}';this.navigationCompletionInfo.commaDelimiter=","}}}};f.prototype.prepareContextAttrsSuggestionsInsideWhere=function(t,e){var n=l.getModelManger().termMode;if(this.parsingOutputInfo.contextInfo.contextDO!==null&&!u.endsWith(this.navigationCompletionInfo.navigationTextInput,".")&&(this.navigationCompletionInfo.completeCollection===false&&e!==o.CURRENT)){var i=this.parsingOutputInfo.contextInfo.contextDO+"."+this.navigationCompletionInfo.navigationTextInput;var s=p.validateNavigationDetails(i,t,l.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute,n);if(s.isValid===false&&s.associations.isValid===false&&s.attribute.altAttr.length>0){this.navigationCompletionInfo.navAlternatives=s.attribute.altAttr}}};f.prototype.prepareContextCompletion=function(t,e,n,i){this.prepareContextSuggestionsInsideWhere_dotMode(t,e,n,i);this.prepareContextAttrsSuggestionsInsideWhere(t,e,i)};f.prototype.completeNavSuggestions_dotMode=function(t,e,n){var i=null;i=p.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,t,l.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(i.isValid===false){if(i.root.isValid===false){if(this.parsingOutputInfo.contextInfo.valueListAttribute){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navAlternatives=[];this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altValueList)}this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altDO);if(e.disableAliases===false){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altAlias)}this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,this.navigationCompletionInfo.navAlternatives,i.root.name,n,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[]}else{this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.attribute.altAssoc);this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,i.attribute.altAttr.concat(this.navigationCompletionInfo.navAlternatives),i.attribute.name,n,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[]}}};f.prototype.completeNavSuggestions_termsMode=function(t,n,i,s,a){var r=null;if(this.parsingOutputInfo.contextInfo.contextNavigation!==null){var u=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.split(".");if(this.parsingOutputInfo.contextInfo.contextNavigation.attribute.isValid){u.pop()}r=u.length===0?this.parsingOutputInfo.contextInfo.contextNavigation.navigation:u.join(".")}var g=s===o.CURRENT?true:false;if(g&&r){var f=r.split(".");r=f.length>0?f[0]:r}else if(s===o.ALL){r=null}var T=l.getModelManger().termMode;var c=null;var I=false;if(l.getModelManger().flags.hasOwnProperty(e.propertiesEnum.noAssocSuggestion)){I=l.getModelManger().flags[e.propertiesEnum.noAssocSuggestion]}var v=this.parsingOutputInfo.contextInfo.valueListAttribute;if(!this.parsingOutputInfo.contextInfo.valueListAttribute&&a){v=a}c=p.getNavigationCompletion(this.navigationCompletionInfo.navigationTextInput,t,l.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,v,r,g,this.navigationCompletionInfo.completeCollection,this.parsingOutputInfo.contextInfo.isDeprecatedAllContext,n.isInsideWhere,this.parsingOutputInfo.contextInfo.isTermAllContext,T,I);if(c.altValueList.length>0){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navAlternatives=c.altValueList}if(n.disableAliases===false&&c.altAlias.length>0){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(c.altAlias)}if(c.altDO.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertTermsAlternatives(c.altDO,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter);this.navigationCompletionInfo.commaDelimiter=","}if(this.navigationCompletionInfo.navAlternatives.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,this.navigationCompletionInfo.navAlternatives,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter,T);this.navigationCompletionInfo.navAlternatives=[]}};f.prototype.isDotMode=function(t){return this.navigationCompletionInfo.navigationTextInput.indexOf(".")!==-1||!p.isTermsExists(t,l.getModelManger().vocabulary)||l.getModelManger().flags.hasOwnProperty(e.propertiesEnum.disableTerms)&&l.getModelManger().flags[e.propertiesEnum.disableTerms]};f.prototype.isTermMode=function(t){return p.isTermsExists(t,l.getModelManger().vocabulary)&&(!l.getModelManger().flags.hasOwnProperty(e.propertiesEnum.disableTerms)||!l.getModelManger().flags[e.propertiesEnum.disableTerms])};f.prototype.addNavigationSuggestions=function(t,e,n){var i="";this.initNavigationInfo();if(this.parsingOutputInfo.navigationCompleteion){if(this.completeByValueListInLexerError(t,e)){return}i=this.calcSpacePrefixAdditionForNavigation(e);this.calculateNavigationStartText();this.convertNavigationRELTypesToBusinessTypes(e);var s=u.getLastTokenTypeAndIgnoreWS(e);var a=this.navigationCompletionInfo.navigationTextInput.split(".");this.parsingOutputInfo.contextInfo.isDeprecatedAllContext=this.parsingOutputInfo.contextInfo.isDeprecatedAllContext||s===o.ALL;this.prepareContextCompletion(t,s,a,i);if(this.isTermMode(t)){this.completeNavSuggestions_termsMode(t,e,i,s,n)}if(this.isDotMode(t)){this.completeNavSuggestions_dotMode(t,e,i)}jQuery.sap.log.debug("Autocopmlete: End : this.navigationCompletionInfo.navSuggestions - "+this.navigationCompletionInfo.navSuggestions);if(this.navigationCompletionInfo.isValueListSuggestions){this.startSuggestionList()}this.strSuggestions+=this.navigationCompletionInfo.navSuggestions}};f.prototype.addNonNavigationSuggestions=function(t,e){var n;var i=null;var o={};var s="";if(t.length>0&&this.strSuggestions.length>1){this.strSuggestions+=","}for(n=0;n<t.length;n++){i=null;s=t[n].name;if(this.isPartialCompletion()){i=s.substring(this.parsingOutputInfo.lastText.length,s.length)}else{i=s}if(i){o=u.getTokenTypeMetadata(t[n].type,s,0,false,l.getModelManger());this.strSuggestions+='{"text":"'+s+'","completion":"'+e+i+'","tokenType":"'+o.group+'","info":'+JSON.stringify(o.info)+"},"}}};f.prototype.setDOContext=function(t){if(t.hasOwnProperty("context")){this.parsingOutputInfo.contextInfo.contextDO=t.context}if(t.hasOwnProperty("fullContext")){this.parsingOutputInfo.contextInfo.contextNavigation=t.fullContext;this.parsingOutputInfo.contextInfo.isTermAllContext=this.parsingOutputInfo.contextInfo.isTermAllContext||t.fullContext&&t.fullContext.modifiers&&t.fullContext.modifiers.hasOwnProperty("all")}};f.prototype.initParsingOutputInfo=function(t){this.parsingOutputInfo={nextTokens:[],lastText:t,isPartialText:false,allTokens:false,allowedTypes:[],navigationCompleteion:false,contextInfo:{contextDO:null,contextNavigation:null,valueListAttribute:null,isDeprecatedAllContext:false,isTermAllContext:false}}};f.prototype.initNavigationInfo=function(){this.navigationCompletionInfo={simpleBusinessTypes:[],collectionBusinessTypes:[],completeCollection:false,isValueListSuggestions:false,navigationTextInput:"",navAlternatives:[],navSuggestions:"",commaDelimiter:""}};f.prototype.getNextSuggestions=function(t,n,i,o,s,a){var r="";var p=[];this.startSuggestionList();this.initParsingOutputInfo(t);this.overwriteParserReportError(i,this.parsingOutputInfo);this.overwriteLexerReportError(n,i,this.parsingOutputInfo);var g=s===e.TYPE_ALL?e.TYPE_AUTOCOMPLETE:s;u.parseType(i,g);this.setDOContext(i);if(i.lastExpecting.reachedEOF||this.parsingOutputInfo.isPartialText){this.parsingOutputInfo.nextTokens=i.lastExpecting.expecting;if(i.lastExpecting.isPartialText){this.parsingOutputInfo.isPartialText=i.lastExpecting.isPartialText}}else{this.parsingOutputInfo.nextTokens=[]}r=this.calcSpacePrefixAdditionForNonNavigation(i);this.handleEmptyNextTokens(i);p=this.filterTokens(o,i);this.handleWhitespaceCharsInLastText();if(o.getTermModes().indexOf("byDescription")!==-1){l.getModelManger()[e.propertiesEnum.termMode]=e.DISPLAY_TEXT}this.addNavigationSuggestions(o,i,a);this.addNonNavigationSuggestions(p,r);this.closeSuggestionList();return this.strSuggestions};return{autoCompleteUtilsLib:f}},true);
//# sourceMappingURL=autoCompleteUtils.js.map
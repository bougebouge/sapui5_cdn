/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","./library","sap/rules/ui/ExpressionBasic","sap/rules/ui/InstructionRenderer","./DecisionTableCellExpressionBasicRenderer"],function(jQuery,e,t,i,s){"use strict";var a=t.extend("sap.rules.ui.DecisionTableCellExpressionBasic",{metadata:{library:"sap.rules.ui",properties:{headerValue:{type:"string",defaultValue:"",bindable:"bindable"},fixedOperator:{type:"string",defaultValue:"",bindable:"bindable"},attributeName:{type:"string",defaultValue:"",bindable:"bindable"},type:{type:"sap.rules.ui.ExpressionType",defaultValue:sap.rules.ui.ExpressionType.BooleanEnhanced,bindable:"bindable"}}},_reload:function(){this._isOperation=" is ";this._ofOperation=" of the ";this._equalOperation="is equal to";var e;var t=this.resultDataObjectName;if("getAttributeName"in this&&this.getAttributeName()){e=this.getAttributeName()}if(e&&t){if(this.getType()==="Boolean"){this.sHeaderValue=t+this._isOperation+e}else{this.sHeaderValue=e+this._ofOperation+t}this.FixedOperatorValue=this._equalOperation}else{this.sHeaderValue=this.getHeaderValue();this.FixedOperatorValue=this.getFixedOperator()}this.shouldReload=false;this.sCellValue=this.getValue();this.sValueFromSettings=this.sHeaderValue+" "+this.FixedOperatorValue;this.sValue=(this.sValueFromSettings+this.sCellValue).trim();var s=sap.ui.getCore().byId(this.getExpressionLanguage());var a;if(!this.sHeaderValue&&!this.FixedOperatorValue){this.setProperty("value",this.sValue);sap.rules.ui.ExpressionBasic.prototype._reload.apply(this,arguments);return}else{if(this.sHeaderValue&&this.FixedOperatorValue){a=s._getRightSuggestions(this.sHeaderValue,this.FixedOperatorValue,this.sCellValue,null,null);if(!s._hasValueSource&&this._checkForValueHelpSuggestions(a)){return}}else if(this.sHeaderValue&&!this.FixedOperatorValue){var r=s.validateExpression(this.sHeaderValue);if(r.status==="Error"){this.bReadOnly=true;this.bFlagForChange=true;a=[s._getLeftSuggestions("","")]}else{var l=this._getSubExpression(this.sCellValue);var o=l[1]?l[1].exp:"";a=[s._getCompSuggestions(this.sHeaderValue,o,null)];if(o){var n;var u=l[2]?l[2].exp:"";n=s._getRightSuggestions(this.sHeaderValue,o,u,null,null);a.push.apply(a,n);if(!s._hasValueSource&&this._checkForValueHelpSuggestions(a)){return}}}}this.instructions=this._createInstructions(a);var p=new i({instructions:this.instructions,useIndent:false,change:this._onChange.bind(this)});this.setAggregation("_instructionRenderer",p,true)}},_calculateOffSet:function(){if(!this.sHeaderValue&&!this.FixedOperatorValue){this.offSet=0}else if(this.sHeaderValue&&this.FixedOperatorValue){this.offSet=2}else{this.offSet=1}},_onChangeByIndex:function(e,t){sap.rules.ui.ExpressionBasic.prototype._onChangeByIndex.apply(this,[this.offSet+e,this.sHeaderValue+this.FixedOperatorValue,e])},renderer:s});a.prototype.init=function(){};a.prototype.exit=function(){this._handleValidation()};a.prototype.validateExpression=function(){};a.prototype.onAfterRendering=function(){sap.rules.ui.ExpressionBasic.prototype.onAfterRendering.apply(this,arguments);this._calculateOffSet();this.oDecisionTableCell=this.getParent()&&this.getParent().getParent()?this.getParent().getParent():null;if(this.oDecisionTableCell){var e=this.oDecisionTableCell.getValueStatePath();var t=this.oDecisionTableCell.getModel("dtModel");this.setProperty("valueStateText","");t.setProperty(e.slice(8),sap.ui.core.ValueState.None);this.createEventListeners()}};a.prototype.onBeforeRendering=function(){sap.rules.ui.ExpressionBasic.prototype.onBeforeRendering.apply(this,arguments)};a.prototype._getSubExpression=function(e){var t=sap.ui.getCore().byId(this.getExpressionLanguage());return t._getSubExpressions(null,"dummy "+e)};a.prototype._handleValidation=function(){var e;var t=this.getHeaderValue();var i=this.getFixedOperator();var s=this.getValue();var a;if(!s){a=s}else{a=t+" "+i+" "+s}var r=sap.ui.getCore().byId(this.getExpressionLanguage());if(a){var l=r.validateExpression(a);if(l.deferredResult){l.deferredResult.done(function(t){if(this.oDecisionTableCell){var i=this.oDecisionTableCell.getValueStateTextPath();var s=this.oDecisionTableCell.getValueStatePath();var a=this.oDecisionTableCell.getModel("dtModel");if(t.status===sap.rules.ui.ValidationStatus.Error){e=t.errorDetails.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ");a.setProperty(i.slice(8),e);if(!this.oDecisionTableCell._oPopover||!this.oDecisionTableCell._oPopover.isOpen()){a.setProperty(s.slice(8),sap.ui.core.ValueState.Error)}else{a.setProperty(s.slice(8),sap.ui.core.ValueState.None)}this.setProperty("valueStateText",e)}else{this.setProperty("valueStateText","");a.setProperty(i.slice(8),"null");a.setProperty(s.slice(8),sap.ui.core.ValueState.None)}}}.bind(this))}if(this.oDecisionTableCell){var o=this.oDecisionTableCell.getValueStateTextPath();var n=this.oDecisionTableCell.getValueStatePath();var u=this.oDecisionTableCell.getModel("dtModel");if(l.status===sap.rules.ui.ValidationStatus.Error){e=l.errorDetails.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ");this.setProperty("valueStateText",e);u.setProperty(o.slice(8),e);u.setProperty(n.slice(8),sap.ui.core.ValueState.Error)}else{this.setProperty("valueStateText","");u.setProperty(o.slice(8),"null");u.setProperty(n.slice(8),sap.ui.core.ValueState.None)}}}};a.prototype.createEventListeners=function(){var e=this.oDecisionTableCell.getDomRef().parentElement.parentElement;if(e){document.getElementById(this.getId()).addEventListener("keyup",function(t){if(t.keyCode===27){jQuery(e).focus()}}.bind(this))}};return a},true);
//# sourceMappingURL=DecisionTableCellExpressionBasic.js.map
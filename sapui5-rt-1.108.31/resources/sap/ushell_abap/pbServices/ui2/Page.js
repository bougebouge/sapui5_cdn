// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/AllCatalogs","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,i,n,a,jQuery){"use strict";var s=function(s,r){var g,u,o,l,c,d=[],f=true,h=true,p=this;function P(){if(h){throw new n(p+": page is just a stub","Page")}}function I(t){var i,n=!!(t.Bags&&t.Bags.results),a=n?t.Bags.results:[],r=t.PageChipInstances&&t.PageChipInstances.results||[],g=a.length,u=r.length;f=!n;delete t.Bags;delete t.Catalog;delete t.PageChipInstances;o=t;h=false;for(i=0;i<g;i+=1){l.put(a[i].id,new e(s,a[i]))}for(i=0;i<u;i+=1){d[i]=s.createChipInstance(r[i],null,null,p)}}function v(e,t){s.getPageBuildingService().updatePage(o,function(t){p.updateScope();if(e){e()}},t)}this.addChipInstance=function(e,t,i,n){var a=s.getPageBuildingService(),r,g;function u(e){var a=s.createChipInstance(e,n?null:t,i,p);d.push(a);p.updateScope();if(n){t(a)}}P();if(e.getChip){g=e;r=g.getChip()}else{r=e}if(r.getRemoteCatalog()){a.createPageChipInstanceFromRawData({pageId:o.id,chipId:r.getId(),configuration:g&&g.getConfiguration()||"",title:g&&g.getTitle(),remoteCatalogId:r.getRemoteCatalog().getId()},u,i)}else{a.createPageChipInstance(o.id,null,r.getId(),g&&g.getTitle(),g&&g.getConfiguration()||"","",u,i)}};this.addChipInstanceReference=function(e,t,i){var n=s.getPageBuildingService();function a(n){var a=s.createChipInstance(n,e.isStub()?null:t,i,p);d.push(a);if(e.isStub()){t(a)}}P();n.clonePageChipInstance(e.getPage().getId(),e.getId(),this.getId(),a,i)};this.exit=function(){var e,t;a.debug("Exiting: "+this,null,"Page");for(e=0,t=d.length;e<t;e+=1){d[e].exit()}o=null;l=new i.Map;c=null;d=[];h=true;a.debug("Exited: "+this,null,"Page")};this.getAllCatalogs=function(){if(!u){u=new t(s,g)}return u};this.getBagIds=function(){if(f){throw new n(p+": page is just a stub, load bags on demand","Page")}return l.keys()};this.getBag=function(t){var i;if(f){throw new n(p+": page is just a stub, load bags on demand","Page")}if(!t){throw new n("Missing bag ID","Page")}if(l.containsKey(t)){return l.get(t)}i=new e(s,{pageId:this.getId(),id:t,$tmp:true});l.put(t,i);return i};this.loadBag=function(t){var i;if(!t){throw new n("Missing bag ID","Page")}if(l.containsKey(t)){i=l.get(t)}else{i=new jQuery.Deferred;l.put(t,i);s.getPageBuildingService().readBag(g,t,function(t){i.resolve(new e(s,t))},function(){i.resolve(new e(s,{pageId:g,id:t,$tmp:true}))})}return i.promise()};this.getCatalog=function(){P();if(!c&&o.catalogId){c=s.createCatalog(o.catalogId)}return c};this.getChipInstances=function(){P();return d.slice()};this.getId=function(){return g};this.getLayout=function(){P();return o.layout};this.setLayout=function(e,t,n){P();if(o.layout===e){if(t){n=n||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,n,true)}return}o.layout=e;v(t,n)};this.getOriginalLanguage=function(){P();return o.originalLanguage};this.getScope=function(){P();return o.scope};this.getTitle=function(){P();return o.title};this.setTitle=function(e,t,n){P();if(o.title===e){if(t){n=n||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,n,true)}return}o.title=e;v(t,n)};this.isCatalogPage=function(){P();return o.isCatalogPage==="X"};this.isPersonalizationLocked=function(){P();return o.isPersLocked==="X"};this.setPersonalizationLocked=function(e,t,a){P();if(s.getPageBuildingService().isPersonalization()){throw new n("Personalization locking cannot be changed at personalization scope","Page")}if(o.isPersLocked==="X"&&e||o.isPersLocked!=="X"&&!e){if(t){a=a||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,a,true)}return}o.isPersLocked=e?"X":" ";v(t,a)};this.isOutdated=function(){P();return o.outdated==="X"};this.isReadOnly=function(){P();return o.isReadOnly==="X"};this.isPersonalized=function(){P();return o.scope==="PERSONALIZATION"};this.isStub=function(){return h};this.load=function(e,t,i){var r;if(!h){throw new n("Page is not a stub anymore","Page")}function u(){if(r===0){a.debug("Initialized: "+p,null,"Page");e()}}function o(){r-=1;u()}s.getPageBuildingService().readPage(g,function(e){var n,s=e.PageChipInstances&&e.PageChipInstances.results||[],g=s.length;a.debug("Loaded: "+p,null,"Page");I(e);r=i?0:g;if(!i){for(n=0;n<g;n+=1){d[n].load(o,t)}}u()},t)};this.remove=function(e,t){this.exit();s.getPageBuildingService().deletePage(g,e,t)};this.removeChipInstance=function(e,t,i){var n=d.indexOf(e);P();if(n>=0){d.splice(n,1);e.remove(function(){p.updateScope();if(t){t.apply(this,arguments)}},function(){d.splice(n,0,e);i=i||s.getPageBuildingService().getDefaultErrorHandler();i.apply(this,arguments)});return true}return false};this.toString=function(e){var t=['Page({sId:"',g,'",bIsStub:',h,",bIsLoadingBagsOnDemand:",f];if(e){t.push(",oAlterEgo:",JSON.stringify(o),",oCatalog:",c?c.toString(e):c,",oFactory:",s.toString(e),",aChipInstances:",JSON.stringify(d))}t.push("})");return t.join("")};this.updateScope=function(){if(s.getPageBuildingService().isPersonalization()){o.scope="PERSONALIZATION"}};if(typeof r==="object"){g=r.id;I(r)}else if(typeof r==="string"){g=r}if(!g){throw new n("Missing ID","Page")}l=new i.Map;a.debug("Created: "+this,null,"Page")};return s});
//# sourceMappingURL=Page.js.map
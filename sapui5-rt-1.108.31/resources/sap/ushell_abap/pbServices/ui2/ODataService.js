// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error"],function(e,r){"use strict";var n=new e.Map;var t=function(e,t){var s;this.getCsrfToken=function(){if(n.get(s)&&n.get(s).token){return n.get(s).token}return""};this.getDefaultErrorHandler=function(){return t};this.openBatchQueue=function(){e.openBatchQueue()};this.refreshCsrfToken=function(i,o){var a;if(typeof i!=="function"){throw new r("Success callback is not a function","ODataService")}o=o||t;a=n.get(s);if(!a.fetchingInProgress){a.token=undefined;a.fetchingInProgress=true;e.read("",function(){if(!n.get(s)||!n.get(s).token){o("No CSRF token delivered");a.errorHandlers.forEach(function(e){e("No CSRF token delivered")})}else{i();a.successHandlers.forEach(function(e){e()})}a.successHandlers=[];a.errorHandlers=[];a.fetchingInProgress=false},function(){a.fetchingInProgress=false;o.apply(null,arguments)})}else{a.successHandlers.push(i);a.errorHandlers.push(o)}};this.setCsrfToken=function(e){var t;if(e&&typeof e!=="string"){throw new r("Invalid CSRF token: "+e,"ODataService")}t=n.get(s);t.token=e};this.setDefaultErrorHandler=function(e){if(e&&typeof e!=="function"){throw new r("Error callback is not a function","ODataService")}t=e||function(){}};this.submitBatchQueue=function(){e.submitBatchQueue.apply(e,arguments)};this.toString=function(r){var n=["ODataService({"];if(r){n.push('csrfToken:"',this.getCsrfToken(),'"');n.push(",oODataWrapper:",e.toString(true))}n.push("})");return n.join("")};if(!e){throw new r("Missing OData wrapper","ODataService")}s=e.getBaseUrl();if(!n.get(s)){n.put(s,{fetchingInProgress:false,successHandlers:[],errorHandlers:[]})}this.setDefaultErrorHandler(t)};t.resetSharedCsrfTokens=function(){n=new e.Map};return t});
//# sourceMappingURL=ODataService.js.map
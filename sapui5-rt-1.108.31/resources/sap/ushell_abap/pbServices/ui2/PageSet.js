// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Page","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],function(e,t,i,n){"use strict";var a={assigned:1,userCreated:2,personalized:3,defaultPage:4};var s=function(s,g){var u,r,o,f=[],l,d=true,c=this;function p(){if(d){throw new i(c+": page set is just a stub","sap.ushell_abap.pbServices.ui2.PageSet")}}this.getPageType=function(e){var t=e.getId(),n;p();if(!l.containsKey(t)){throw new i("Unknown page "+t,"sap.ushell_abap.pbServices.ui2.PageSet")}n=l.get(t);if(n===a.assigned&&e.isPersonalized()){n=a.personalized}return n};function h(i){var g=i.DefaultPage.id,u=i.AssignedPages&&i.AssignedPages.results||[];r=i;l=new e.Map;u.forEach(function(e){l.put(e.id,a.assigned)});r.Pages.results.forEach(function(e){var i=new t(s,e),n=i.getId();f.push(i);if(g===n){o=i;l.put(n,a.defaultPage)}else if(!l.containsKey(n)){l.put(n,a.userCreated)}});delete r.AssignedPages;delete r.DefaultPage;delete r.Pages;d=false;n.debug("Initialized: "+c,null,"PageSet")}this.appendPage=function(e,g,r,o){p();if(typeof r!=="function"){throw new i("Missing success handler","PageSet")}s.getPageBuildingService().createPageInPageSet(u,e,g,function(e){var i=new t(s,e);f.push(i);l.put(i.getId(),a.userCreated);n.debug("Appended new page with ID "+i.getId()+" to pageset "+c,null,"PageSet");r(i)},o)};this.isPageRemovable=function(e){return this.getPageType(e)===a.userCreated};this.isPageResettable=function(e){return this.getPageType(e)===a.personalized};this.removePage=function(e,t,n){if(!this.isPageRemovable(e)){throw new i("Cannot remove page "+e.getId(),"PageSet")}e.remove(function(){f.splice(f.indexOf(e),1);l.remove(e.getId());if(t){t()}},n)};this.resetPage=function(e,t,n){if(!this.isPageResettable(e)){throw new i("Cannot reset page "+e.getId(),"sap.ushell_abap.pbServices.ui2.PageSet")}e.remove(function(){e.load(t,n,true)},n)};this.filter=function(e,t){var i,n=[],a;p();e=e||[];t=t||[];for(i=0;i<f.length;i+=1){a=f[i];if(e.indexOf(a.getId())!==-1){n.push(a)}else if(a.getCatalog()&&t.indexOf(a.getCatalog().getId())!==-1){n.push(a)}}f=n};this.getConfiguration=function(){p();return r.configuration};this.setConfiguration=function(t,n,a){p();if(typeof n!=="function"){throw new i("Missing success handler","PageSet")}if(r.configuration===t){e.callHandler(n,a,true);return}r.configuration=t;s.getPageBuildingService().updatePageSet(r,function(e){n()},a)};this.getDefaultPage=function(){p();return o};this.getId=function(){return u};this.getPages=function(){p();return f.slice()};this.isStub=function(){return d};this.load=function(e,t){if(!d){throw new i("Page set is not a stub anymore","PageSet")}s.getPageBuildingService().readPageSet(u,function(t){n.debug("Loaded: "+c,null,"PageSet");h(t);e()},t,true)};this.toString=function(e){var t=['PageSet({sId:"',u,'",bIsStub:',d];if(e){t.push(",oAlterEgo:",JSON.stringify(r),",oFactory:",s.toString(e),",aPages:",JSON.stringify(f))}t.push("})");return t.join("")};u=g;if(!u){throw new i("Missing page set ID","PageSet")}n.debug("Created: "+this,null,"PageSet")};return s});
//# sourceMappingURL=PageSet.js.map
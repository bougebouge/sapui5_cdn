// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/resources"],function(e,r,jQuery,a,t){"use strict";var s;var n="default";return function(){this._updateODataObjectBasedOnDatatype=function(e,r){if(jQuery.type(e)==="string"){r.value=e.toString();r.dataType="Edm.String"}if(jQuery.type(e)==="boolean"){r.value=e.toString();r.dataType="Edm.Boolean"}return r};this.getThemeList=function(){var e=new jQuery.Deferred,t="/sap/opu/odata/UI2/INTEROP/Themes";r.read({requestUri:t},function(r,a){var t,s=[];for(t=0;t<r.results.length;t=t+1){s.push(r.results[t])}e.resolve({options:s})},function(r){a.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this.getLanguageList=function(){var e=new jQuery.Deferred,s=encodeURI("/sap/opu/odata/UI2/INTEROP/UserProfilePropertyValues?$filter=id eq 'PREFERRED_LOGON_LANGUAGE'");r.read({requestUri:s},function(r){var a=[{text:t.i18n.getText("userSettings.browserLanguage"),key:n}];var s=r.results.map(function(e){return{text:e.description,key:e.value}}).sort(function(e,r){return e.text.localeCompare(r.text)});a=a.concat(s);e.resolve(a)},function(r){a.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this.getUserProfilePropertyValueLists=function(){var e=new jQuery.Deferred;var r;var t={};var s=["NUMBER_FORMAT","TIME_ZONE","TIME_FORMAT","DATE_FORMAT"];var n=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");n.openBatchQueue();var u;for(var p=0;p<s.length;p++){u=s[p];r=encodeURI("UserProfilePropertyValues?$filter=id eq '"+u+"'&$select=description,value");n.read(r,function(e){t[this]=e.results}.bind(u),function(e){a.error(e.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter")})}n.submitBatchQueue(function(){e.resolve(t)},function(r){a.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this._createWrapper=function(r){return e.createODataWrapper(r,false,function(e){})};this.updateUserPreferences=function(e){a.debug("[000] updateUserPreferences","UserInfoAdapter");var r=this,t,u,p,o,i,d=function(){o-=1;if(o===0){t.resolve()}},f=function(e,r){t.reject(e,r)};a.debug("[000] updateUserPreferences: _createWrapper","UserInfoAdapter");s=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");t=new jQuery.Deferred;a.debug("[000] updateUserPreferences: oDataWrapper.openBatchQueue","UserInfoAdapter");s.openBatchQueue();p=e.getChangedProperties()||[];a.debug("[000] updateUserPreferences: getChangedProperties","UserInfoAdapter");o=p.length;p.forEach(function(e){var t=e.name,p=e.newValue;if(t.toUpperCase()==="LANGUAGE"){t="PREFERRED_LOGON_LANGUAGE";p=p===n?undefined:p}u="UserProfileProperties("+["id='"+t+"'","shellType='FLP')"].join(",");i={id:t,shellType:"FLP",value:p};r._updateODataObjectBasedOnDatatype(p,i);a.debug("[000] updateUserPreferences: oDataWrapper: put","UserInfoAdapter");s.put(u,i,d,f)});a.debug("[000] updateUserPreferences: submitBatchQueue","UserInfoAdapter");s.submitBatchQueue(function(){if(o===0){t.resolve()}},f);return t.promise()}}},true);
//# sourceMappingURL=UserInfoAdapter.js.map
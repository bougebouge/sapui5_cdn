/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel","sap/ovp/cards/custom/Component","sap/viz/ui5/controls/common/feeds/FeedItem","sap/sac/df/thirdparty/lodash"],function(e,t,o,a,r){"use strict";var n=o.extend("sap.sac.df.InACard.Component",{metadata:{manifest:"json",properties:{contentFragment:{type:"string",defaultValue:"sap.sac.df.InACard.fragment.InACard"},controllerName:{type:"string",defaultValue:"sap.sac.df.InACard.controller.InACard"},footerFragment:{type:"string",defaultValue:""},widgetType:{widgetType:"sap.sac.df.types.WidgetType",defaultValue:"pivot"},dataProviderName:"string"}},init:function(){var t=this;o.prototype.init.apply(t,arguments);t.setModel(t.getComponentData().model,"om");t.setModel(t.getComponentData().model,"$FlexVariants");var n=sap.ui.getCore().byId("mainView");if(n&&!n.getModel("$FlexVariants")){n.setModel(t.getModel("om"),"$FlexVariants")}var d=sap.ui.getCore().byId("viewPortContainer")&&sap.ui.getCore().byId("viewPortContainer").getPages();d=d&&d[0].getComponentHandle&&d[0].getComponentHandle()&&d[0].getComponentHandle().getInstance();if(d&&!d.getModel("$FlexVariants")){d.setModel(t.getModel("om"),"$FlexVariants")}var i;t.getRootControl().setBusy(true);t.rootControlLoaded().then(function(){return t.getRootControl().loaded()}).then(function(){t.setDataProviderName(t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName"));return t.getModel("om").dataLoaded()}).then(function(){i=t.getModel("om").getDataProvider(t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName"));t.getRootControl().getModel("ovpCardProperties").setProperty("/title",i.QueryTitle||i.QueryName);var e=t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName");var o=t.getRootControl().byId("idVizFrame");var n=r.clone(o.getBindingInfo("vizProperties"));n.parts[0].path=["/dataProvider/",e,"/Chart/vizProperties"].join("");var d=t.getRootControl().byId("flatDS");var s=r.clone(d.getBindingInfo("dimensions"));s.path=["/dataProvider/",e,"/FlatDimensions"].join("");d.bindAggregation("dimensions",s);var l=r.clone(d.getBindingInfo("measures"));l.path=["/dataProvider/",e,"/Measures"].join("");d.bindAggregation("measures",l);var g=r.clone(d.getBindingInfo("data"));g.path=["/dataProvider/",e,"/FlatResultSet"].join("");d.bindAggregation("data",g);t.getModel("om").attachRequestCompleted(function(){o.bindProperty("vizProperties",n);o.destroyFeeds();var d=t.getModel("om").getProperty(["/dataProvider/",e,"/Chart/Feeds"].join(""));r.forEach(d,function(e){o.addFeed(new a({type:e.type,uid:e.uid,values:e.values}))});var i=t.getRootControl();r.forEach(i.byId("flatDS").getDimensions(),function(e){e.bindProperty("value","om>"+e.getIdentity())});r.forEach(i.byId("flatDS").getMeasures(),function(e){e.bindProperty("value","om>"+e.getIdentity())});i.byId("idVizFrame").setVizProperties(r.clone(i.byId("idVizFrame").getVizProperties()))});return t.getModel("om").synchronize()}).catch(function(t){e.error(t)}).then(function(){t.getRootControl().setBusy(false)})}});return n});
//# sourceMappingURL=Component.js.map
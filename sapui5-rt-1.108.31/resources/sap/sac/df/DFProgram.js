/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/ui/core/Control","sap/base/Log","jquery.sap.global","sap/sac/df/DFKernel","sap/sac/df/firefly/library"],function(t,e,jQuery,r){"use strict";var n=t.extend("sap.sac.df.DFProgram",{metadata:{properties:{program:{type:"string"},arguments:{type:"string[]",defaultValue:[]},environment:{type:"string[]",defaultValue:[]},systemLandscape:{type:"string",defaultValue:""},systemLandscapeDef:{type:"object",defaultValue:null},configuration:{type:"string",defaultValue:""},configurationURI:{type:"string",defaultValue:null},kernelId:{type:"string",defaultValue:"dfk"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"}},aggregations:{}},init:function(){var t=this.getId()+"--program";this.programContainer=jQuery('<div id="'+t+'" style="width=100%; height=100%"/>')},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("flex","auto");t.style("width",e.getWidth());t.style("height",e.getHeight());t.openEnd();t.close("div")}},onAfterRendering:function(){if(t.prototype.onAfterRendering){t.prototype.onAfterRendering.apply(this,arguments)}var e=jQuery(window.document.getElementById(this.getId()));this.programContainer.appendTo(e);e.css("position","relative");if(this.getProgram()&&!this.program){this.runProgram(this.getProgram())}},runProgram:function(t){if(t===this.programName){return}if(this.program){this._cleanUpProgram()}try{var r=this;this._getKernel().then(function(e){r.program=sap.firefly.ProgramRunner.createRunner(e.getSession(),t);r.setClientArgs();r.setClientEnvironment(r.program);r.program.setNativeAnchorId(r.getId()+"--program");r.processConfigURI(function(){window.sactable=window.SACGridRendering;r.program.runProgram()})})}catch(t){e.error(t)}},exit:function(){if(this.program){this._cleanUpProgram()}},_cleanUpProgram:function(){sap.firefly.XObjectExt.release(this.program);this.program.releaseObject();this.program=null},_getKernel:function(){return Promise.resolve().then(function(){if(this.localKernel){return this.localKernel}var t=this.getKernelId();if(t){var e=this.getParent().getModel(t);if(e){return e}}var n={systemLandscape:{type:"BW"}};var i=this.getSystemLandscapeDef();if(i){n.systemLandscape.Systems=i;n.masterSystem=i.masterSystemName}this.localKernel=new r(n);return this.localKernel}.bind(this))},setClientArgs:function(){var t=this.getArguments();t.forEach(function(t){var e=t.split("=");var r=e[0].trim();var n=e[1].trim();if(n==="true"||n==="false"){var i=n==="true"?true:false;this.program.setBooleanArgument(r,i)}else if(n.startsWith("$")){n=this.getUrlParams(r);if(r==="datasource"){n="query:[][]["+n+"]"}this.program.setArgument(r,n)}else{this.program.setArgument(r,n)}}.bind(this));if(this.getConfiguration()!==""){this.program.setArgument("configuration",this.getConfiguration())}},processConfigURI:function(t){if(this.getConfigurationURI()){var e=this.getConfigurationURI();if(!e.startsWith("http")){e=window.location.protocol+"//";e+=window.location.hostname;e+=window.location.port?":"+window.location.port:"";e+=this.getConfigurationURI()}this.readJsonFile(e,function(e){this.program.setArgument("configuration",e);t()}.bind(this))}else{t()}},readJsonFile:function(t,e){var r=new XMLHttpRequest;r.overrideMimeType("application/json");r.open("GET",t,true);r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){e(r.responseText)}};r.send(null)},getUrlParams:function(t){return(window.location.href.split(t+"=")[1]||"").split("&")[0]},setClientEnvironment:function(t){var e=this.getEnvironment();e.forEach(function(e){var r=e.split("=");t.setEnvironmentVariable(r[0],r[1])}.bind(this))}});return n});
//# sourceMappingURL=DFProgram.js.map
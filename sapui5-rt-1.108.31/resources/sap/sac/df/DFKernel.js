/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define(["sap/ui/model/Model","sap/base/Log","sap/sac/df/firefly/library"],function(e,t){"use strict";var s=e.extend("sap.sac.df.DFKernel",{constructor:function(t,s){e.apply(this);var i=t||{};this.init(i,s)},init:function(e){var t=this;if(!t.initPromise){t.initPromise=new Promise(function(s){if(!t.kernelProgram){sap.firefly.XLogger.getInstance().setLogFilterLevel(sap.firefly.Severity.PRINT);t.initProgram=sap.firefly.KernelBoot.createByName("DragonflyAppProgram");t.initProgram.addProgramStartedListener(function(i,r){if(!t.kernelProgram){t.kernelProgram=r;if(t.aSystemLandscapes){t.addSystemLandscapes()}t.kernelProgram.getProcess().getApplication().setClientInfo(null,e.clientIdentifier,null);s(t.kernelProgram)}});t._setEnvironment(e);t.initProgram.runFull()}else{s(t.kernelProgram)}})}return t.initPromise},_setEnvironment:function(e){this.initProgram.setEnvironmentVariable(sap.firefly.XEnvironmentConstants.FIREFLY_LOG_SEVERITY,"Print");if(e.systemLandscape){if(e.systemLandscape.URI){var t=e.systemLandscape.URI;if(!t.startsWith("http")){t=window.location.protocol+"//";t+=window.location.hostname;t+=window.location.port?":"+window.location.port:"";t+=e.systemLandscape.URI}this.initProgram.setEnvironmentVariable("ff_system_landscape_uri",t)}else if(e.systemLandscape.Systems){this.aSystemLandscapes=[];var s=Object.keys(e.systemLandscape.Systems);s.forEach(function(t){var s=e.systemLandscape.Systems[t];this.aSystemLandscapes.push(s)}.bind(this))}}else if(e.systemType){this.masterSystemName=e.masterSystem||"local"+e.systemType;this.aSystemLandscapes=[{systemName:this.masterSystemName,systemType:e.systemType,protocol:window.location.protocol==="http:"?"HTTP":"HTTPS",host:window.location.hostname,port:window.location.port,authentication:"NONE"}]}else{throw new Error("System Configuration is invalid")}this.masterSystemName=this.masterSystemName||e.masterSystem;if(!this.masterSystemName){throw new Error("System Configuration is invalid")}},getSession:function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getSession()},getApplication:function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getApplication()},addSystemLandscapes:function(){var e=this.kernelProgram.getProcess().getKernel().getSubSystemContainer(sap.firefly.SubSystemType.SYSTEM_LANDSCAPE);var t=e.getMainApi();var s=this.kernelProgram.getApplication();s.setSystemLandscape(t);this.aSystemLandscapes.forEach(function(e){var i=t.createSystem();i.setName(e.systemName);i.setTimeout(1e4);i.setAuthenticationType(sap.firefly.AuthenticationType[e.authentication||"NONE"]);var r=sap.firefly.SystemType[e.systemType];i.setSystemType(r);i.setProtocolType(sap.firefly.ProtocolType[e.protocol]);i.setHost(e.host);i.setPort(e.port);i.setPath(e.path);t.setSystemByDescription(i);if(r.isTypeOf(sap.firefly.SystemType.BW)){i.setSessionCarrierType(sap.firefly.SessionCarrierType.SAP_CONTEXT_ID_HEADER);s.getConnectionPool().setMaximumSharedConnections(e.systemName,10)}});t.setMasterSystemName(this.masterSystemName)}});return s});
//# sourceMappingURL=DFKernel.js.map
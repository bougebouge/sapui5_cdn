/*!
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/inatile/InATile",["sap/base/Log","jquery.sap.global","sap/ushell/ui/tile/TileBase","sap/sac/df/olap/OlapModel","sap/ui/core/format/NumberFormat","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/sac/df/inatile/InATileRenderer","sap/sac/df/thirdparty/lodash","sap/sac/df/library"],function(e,jQuery,t,a,n,r,s,i,o){"use strict";var l=t.extend("sap.sac.df.inatile.InATile",{metadata:{properties:{host:{type:"string"},port:{type:"int",defaultValue:443},path:{type:"string"},systemType:{type:"sap.sac.df.types.SystemType"},systemName:{type:"string",defaultValue:"localAbapAnalyticEngine"},protocolType:{type:"sap.sac.df.types.ProtocolType"},client:{type:"string"},dataSourceName:{type:"string"},dataSourceType:{type:"sap.sac.df.types.DataSourceType"},packageName:{type:"string"},schemaName:{type:"string"},widgetType:{widgetType:"sap.sac.df.types.WidgetType",defaultValue:"pivot"}}},renderer:i,init:function(){function i(e){var t;var a=30;if(isNaN(e)){t=e}else{var r=n.getFloatInstance({maxFractionDigits:2});var s;var i=Math.abs(e);if(i>=1e9){s="B";e/=1e9}else if(i>=1e6){s="M";e/=1e6}else if(i>=1e3){s="K";e/=1e3}}t=r.format(e);var o=t;var l=o[a-1];a-=l==="."||l===","?1:0;o=o.substring(0,a);return[o,s].join(" ")}var l=this;var p=null;l.getMicrochartBar=function(){return p};t.prototype.init.apply(l,arguments);l.setBusy(true);l.getInit=o.constant(Promise.resolve(r.load({name:"sap.sac.df.inatile.MicroBarChart",controller:{press:function(){e.info("Micro Chart Pressed")}}})).then(function(e){l.addDependent(e);p=e;if(l.getWidgetType()!=="pivot"){p.setModel(new s,"mc")}l.setBusy(true);var t={systemLandsape:l.getSystemType()?[{systemName:l.getSystemName(),systemType:l.getSystemType(),protocolType:l.getProtocolType(),port:l.getPort(),client:l.getClient()}]:null,dataProvider:{0:{dataSourceName:l.getDataSourceName(),dataSourceType:l.getDataSourceType(),packageName:l.getPackageName(),schemaName:l.getSchemaName(),systemName:l.getSystemName()}}};l.setModel(new a(t),"om");l.setBusy(true);return l.getModel("om").dataLoaded()}).then(function(){var e=l.getModel("om").getDataProvider("0");l.setTitle(e.QueryTitle||e.QueryName);o.forEach(e.FlatDimensions,function(t){e.removeDrilldown(t.Name)});l.setBusy(true);return l.getModel("om").synchronize()}).then(function(){var e=l.getModel("om").getDataProvider("0");if(e.FlatResultSet.length>0){if(l.getWidgetType()==="pivot"){l.setSubtitle(o.map(e.FlatResultSet[0],function(t,a){var n=o.find(e.Measures,function(e){return e.Name===a});return[n&&n.Description||a,i(t)].join(": ")}).join("\n"))}if(e.FlatResultSet.length>1){if(l.getWidgetType()==="pivot"){l.setInfo(o.map(e.FlatResultSet[1],function(t,a){var n=o.find(e.Measures,function(e){return e.Name===a});return[n&&n.Description||a,i(t)].join(": ")}).join("\n"))}else{p.getModel("mc").setData({columns:o.map(e.FlatResultSet,function(t){return o.reduce(t,function(t,a,n){var r=o.find(e.Measures,function(e){return e.Name===n});return{label:r&&r.Description||n,value:a,displayValue:i(a)}},null)})});p.getModel("mc").refresh();l.getModel().refresh()}}}}).then(function(){p.invalidate();l.invalidate()}).catch(function(t){e.error(t)}).then(function(){l.setBusy(false)}))},onAfterRendering:function(){var e=this;var t=jQuery(e.getDomRef()).find(".sapZenDshInATile");t.children().width(t.width()-30)}});return l});
//# sourceMappingURL=InATile.js.map
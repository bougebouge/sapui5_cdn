/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controls/filterbar/utils/VisualFilterUtils","sap/fe/core/helpers/ClassSupport","sap/fe/macros/CommonHelper","sap/fe/macros/filter/FilterUtils","sap/m/VBox","sap/ui/core/Core","../../templating/FilterHelper"],function(e,t,r,a,i,n,o,s){"use strict";var l,c,u,g,p,f,_,h,d,E,v;var I=s.getFiltersConditionsFromSelectionVariant;var m=r.property;var T=r.implementInterface;var R=r.event;var S=r.defineUI5Class;function L(e,t,r,a){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(a):void 0})}function b(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function P(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;y(e,t)}function y(e,t){y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return y(e,t)}function M(e,t,r,a,i){var n={};Object.keys(a).forEach(function(e){n[e]=a[e]});n.enumerable=!!n.enumerable;n.configurable=!!n.configurable;if("value"in n||n.initializer){n.writable=true}n=r.slice().reverse().reduce(function(r,a){return a(e,t,r)||r},n);if(i&&n.initializer!==void 0){n.value=n.initializer?n.initializer.call(i):void 0;n.initializer=undefined}if(n.initializer===void 0){Object.defineProperty(e,t,n);n=null}return n}function V(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var F=(l=S("sap.fe.core.controls.filterbar.VisualFilter"),c=T("sap.ui.core.IFormContent"),u=m({type:"boolean"}),g=m({type:"string"}),p=R(),l(f=(_=function(r){P(n,r);function n(){var e;for(var t=arguments.length,a=new Array(t),i=0;i<t;i++){a[i]=arguments[i]}e=r.call.apply(r,[this].concat(a))||this;L(e,"__implements__sap_ui_core_IFormContent",h,b(e));L(e,"showValueHelp",d,b(e));L(e,"valueHelpIconSrc",E,b(e));L(e,"valueHelpRequest",v,b(e));return e}var s=n.prototype;s.onAfterRendering=function e(){var r;var n=this.getItems()[1].getItems()[0];var s=this.data("infoPath");var l=n.getBinding("segments")||n.getBinding("bars")||n.getBinding("points");var c=n.getBindingContext("internal");var u=o.getLibraryResourceBundle("sap.fe.macros");var g=n.data("showOverlayInitially");var p=n.data("selectionVariantAnnotation")?a.parseCustomData(n.data("selectionVariantAnnotation")):{SelectOptions:[]};var f=n.data("requiredProperties")?a.parseCustomData(n.data("requiredProperties")):[];var _=n.getModel().getMetaModel();var h=l?l.getPath():"";var d=this.getParent().getParent();if(d.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){d=d.getParent().getParent()}var E={};var v=[];var m;if(d.getMetadata().getElementName()==="sap.fe.core.controls.FilterBar"){E=d.getConditions();v=d.getPropertyInfoSet();m=d.data("entityType").split("/")[1]}var T=n.data("parameters")?n.data("parameters").customData:[];var R=I(h,_,p,t.getCustomConditions.bind(t));var S=t.convertFilterCondions(R);var L={};Object.keys(E).forEach(function(e){if(E[e].length){L[e]=E[e]}});Object.keys(S).forEach(function(e){if(!L[e]){L[e]=S[e]}});if(g==="true"){if(!Object.keys(p).length){if(f.length>1){c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{r=_.getObject("".concat(h,"/").concat(f[0],"@com.sap.vocabularies.Common.v1.Label"))||f[0];c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",r)})}}else{var b=[];var P=[];if(p.SelectOptions){p.SelectOptions.forEach(function(e){b.push(e.PropertyName.$PropertyPath)})}if(p.Parameters){p.Parameters.forEach(function(e){b.push(e.PropertyName.$PropertyPath)})}f.forEach(function(e){if(b.indexOf(e)===-1){P.push(e)}});if(P.length>1){c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{r=_.getObject("".concat(h,"/").concat(P[0],"@com.sap.vocabularies.Common.v1.Label"))||P[0];c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",r)})}if(P.length>1){c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{c.setProperty(s,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",P[0])})}}}if(!this._oChartBinding||this._oChartBinding!==l){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(l);this._oChartBinding=l}var y=c.getProperty(s)&&c.getProperty(s).showError;var M=h!==""?h.split("/")[1].split("(")[0]:"";if(T&&T.length&&m===M){var V=i.getBindingPathForParameters(d,L,v,T);if(V){l.sPath=V}}if(l&&l.isSuspended()&&!y){l.resume()}};s.attachDataRecivedHandler=function e(t){if(t){t.attachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=t}};s.detachDataReceivedHandler=function e(t){if(t){t.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};s.setShowValueHelp=function e(t){if(this.getItems().length>0){var r=this.getItems()[0].getItems()[0];r.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}};s.setValueHelpIconSrc=function e(t){if(this.getItems().length>0){var r=this.getItems()[0].getItems()[0];r.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}};s.onInternalDataReceived=function r(a){var i=this.getId();var n=e.getTargetView(this);var s=this.getItems()[1].getItems()[0];var l=this.data("infoPath");var c=s.getBindingContext("internal");var u=o.getLibraryResourceBundle("sap.fe.macros");var g=s.data("uom");t.updateChartScaleFactorTitle(s,n,i,l);if(a.getParameter("error")){var p=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");var f=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");t.applyErrorMessageAndTitle(p,f,l,n)}else if(a.getParameter("data")){var _=a.getSource().getCurrentContexts();if(_&&_.length===0){t.setNoDataMessage(l,u,n)}else{c.setProperty(l,{})}t.setMultiUOMMessage(_,s,l,u,n)}if(g&&(g["ISOCurrency"]&&g["ISOCurrency"].$Path||g["Unit"]&&g["Unit"].$Path)){var h=a.getSource().getContexts();var d=h&&h[0].getObject();t.applyUOMToTitle(s,d,n,l)}};return n}(n),h=M(_.prototype,"__implements__sap_ui_core_IFormContent",[c],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),d=M(_.prototype,"showValueHelp",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),E=M(_.prototype,"valueHelpIconSrc",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),v=M(_.prototype,"valueHelpRequest",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),_))||f);return F},false);
//# sourceMappingURL=VisualFilter.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/templating/DataModelPathHelper","../helpers/BindingHelper","../ManifestSettings"],function(i,e,t,n,o,a,l,r){"use strict";var d={};var v=r.ActionType;var u=l.UI;var s=l.singletonPathVisitor;var f=l.Draft;var c=a.isPathDeletable;var p=n.not;var y=n.ifElse;var g=n.getExpressionFromAnnotation;var b=n.fn;var A=n.equal;var m=n.constant;var D=n.compileExpression;var h=n.and;var E=t.KeyHelper;var S=e.Placement;var F=i.getSemanticObjectMapping;var I=i.getEnabledForAnnotationAction;var O=i.ButtonType;function C(i,e){var t,n,o;return((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(function(i){var t,n,o;if((i===null||i===void 0?void 0:(t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true){var a,l,r,d,v;if((i===null||i===void 0?void 0:i.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&!!i.Determining===e&&(!(i!==null&&i!==void 0&&(a=i.ActionTarget)!==null&&a!==void 0&&a.isBound)||(i===null||i===void 0?void 0:(l=i.ActionTarget)===null||l===void 0?void 0:(r=l.annotations)===null||r===void 0?void 0:(d=r.Core)===null||d===void 0?void 0:(v=d.OperationAvailable)===null||v===void 0?void 0:v.valueOf())!==false)){return true}}return false}))||[]}d.getIdentificationDataFieldForActions=C;function T(i,e){var t,n,o;return((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Identification)===null||o===void 0?void 0:o.filter(function(i){var t,n,o;if((i===null||i===void 0?void 0:(t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(o=n.Hidden)===null||o===void 0?void 0:o.valueOf())!==true){if((i===null||i===void 0?void 0:i.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!!i.Determining===e){return true}}return false}))||[]}var P=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];function N(i,e){var t=i.getDataModelObjectPath(),n=t.navigationProperties.map(function(i){return i.name}),o=g(e,n,undefined,function(e){return s(e,i.getConvertedTypes(),[])}),a=i.getManifestWrapper(),l=a.getViewLevel(),r=l>1?u.IsEditable:p(u.IsEditable);return y(e===undefined||e.valueOf()===false,r,h(r,A(o,false)))}d.getDeleteButtonVisibility=N;function U(i,e){return y(e!==undefined,e,y(i!==undefined,A(i,true),m(true)))}d.getDeleteButtonEnabled=U;function k(i,e){var t=i.getEntitySet(),n=o.isDraftRoot(t),a=i.getDataModelObjectPath(),l=a.navigationProperties.map(function(i){return i.name}),r=g(e,l,undefined,function(e){return s(e,i.getConvertedTypes(),l)}),d=p(u.IsEditable);var v=y(e===undefined||e.valueOf()===false,d,h(d,A(r,false)));return y(n,h(v,f.HasNoDraftForCurrentUser),v)}d.getEditButtonVisibility=k;function H(i){var e=i.getEntitySet(),t=o.isDraftRoot(e),n=o.isSticky(e);var a;if(t&&!o.isSingleton(e)){var l,r;a=e===null||e===void 0?void 0:(l=e.annotations.Common)===null||l===void 0?void 0:(r=l.DraftRoot)===null||r===void 0?void 0:r.EditAction}else if(n&&!o.isSingleton(e)){var d,v;a=e===null||e===void 0?void 0:(d=e.annotations.Session)===null||d===void 0?void 0:(v=d.StickySessionSupported)===null||v===void 0?void 0:v.EditAction}if(a){var u,s;var f=i.getAbsoluteAnnotationPath(a);var c=i.resolveAbsolutePath(f).target;if((c===null||c===void 0?void 0:(u=c.annotations)===null||u===void 0?void 0:(s=u.Core)===null||s===void 0?void 0:s.OperationAvailable)===null){}else{return I(i,c!==null&&c!==void 0?c:undefined)}}return"true"}d.getEditButtonEnabled=H;function B(i){var e,t,n,a,l;var r=i.getEntitySet(),d=i.getEntityType(),u=o.getStickySession(r),f=o.getDraftRoot(r),y=o.getDraftNode(r),m=r&&((e=r.annotations)===null||e===void 0?void 0:(t=e.Capabilities)===null||t===void 0?void 0:t.DeleteRestrictions),h=r&&!o.isSingleton(r)&&((n=r.annotations.UI)===null||n===void 0?void 0:(a=n.UpdateHidden)===null||a===void 0?void 0:a.valueOf()),S=i.getDataModelObjectPath(),B=c(S,{pathVisitor:function(e,t){return s(e,i.getConvertedTypes(),t)}}),M=B?D(B):B,x=C(i.getEntityType(),false);var R=[];if(!o.isSingleton(r)&&f!==null&&f!==void 0&&f.EditAction&&h!==true){R.push({type:v.DraftActions,key:"DraftActions"})}if(f||y){R.push({type:v.CollaborationAvatars,key:"CollaborationAvatars"})}x.filter(function(i){return P.indexOf(i===null||i===void 0?void 0:i.Criticality)>-1}).forEach(function(e){var t,n;R.push({type:v.DataFieldForAction,annotationPath:i.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:E.generateKeyFromDataField(e),visible:D(p(A(g((t=e.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:I(i,e.ActionTarget),isNavigable:true})});if((f!==null&&f!==void 0&&f.EditAction||u!==null&&u!==void 0&&u.EditAction)&&h!==true){var j=o.isUpdateHidden(r,d);R.push({type:v.Primary,key:"EditAction",visible:D(k(i,j)),enabled:H(i)})}if(M&&M!=="false"||(m===null||m===void 0?void 0:(l=m.Deletable)===null||l===void 0?void 0:l.valueOf())!==false&&M!=="false"){var K=o.getDeleteHidden(r,d);R.push({type:v.Secondary,key:"DeleteAction",visible:D(N(i,K)),enabled:D(U(m===null||m===void 0?void 0:m.Deletable,B)),parentEntityDeleteEnabled:M})}var V=T(i.getEntityType(),false);V.filter(function(i){return P.indexOf(i===null||i===void 0?void 0:i.Criticality)===-1}).forEach(function(e){var t,n,o,a,l,r,d;var u={semanticObjectMapping:e.Mapping?F(e.Mapping):[]};if(((t=e.RequiresContext)===null||t===void 0?void 0:t.valueOf())===true){throw new Error("RequiresContext property should not be true for header IBN action : ".concat(e.Label))}else if(((n=e.Inline)===null||n===void 0?void 0:n.valueOf())===true){throw new Error("Inline property should not be true for header IBN action : ".concat(e.Label))}R.push({type:v.DataFieldForIntentBasedNavigation,text:(o=e.Label)===null||o===void 0?void 0:o.toString(),annotationPath:i.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),buttonType:O.Ghost,visible:D(p(A(g((a=e.annotations)===null||a===void 0?void 0:(l=a.UI)===null||l===void 0?void 0:(r=l.Hidden)===null||r===void 0?void 0:r.valueOf()),true))),enabled:e.NavigationAvailable!==undefined?D(A(g((d=e.NavigationAvailable)===null||d===void 0?void 0:d.valueOf()),true)):true,key:E.generateKeyFromDataField(e),isNavigable:true,press:D(b("._intentBasedNavigation.navigate",[g(e.SemanticObject),g(e.Action),u])),customData:D({semanticObject:g(e.SemanticObject),action:g(e.Action)})})});x.filter(function(i){return P.indexOf(i===null||i===void 0?void 0:i.Criticality)===-1}).forEach(function(e){var t,n;R.push({type:v.DataFieldForAction,annotationPath:i.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:E.generateKeyFromDataField(e),visible:D(p(A(g((t=e.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:I(i,e.ActionTarget),isNavigable:true})});return R}d.getHeaderDefaultActions=B;function M(i){var e,t,n;var o=i.getEntityType();var a=((e=o.annotations)===null||e===void 0?void 0:(t=e.UI)===null||t===void 0?void 0:(n=t.Identification)===null||n===void 0?void 0:n.filter(function(i){var e,t,n;return(i===null||i===void 0?void 0:(e=i.annotations)===null||e===void 0?void 0:(t=e.UI)===null||t===void 0?void 0:(n=t.Hidden)===null||n===void 0?void 0:n.valueOf())===true}))||[];return a.map(function(i){return{type:v.Default,key:E.generateKeyFromDataField(i)}})}d.getHiddenHeaderActions=M;function x(i,e){var t,n,a,l,r;var d=e.getEntitySet();var u=e.getEntityType();var s=o.getStickySession(d),f=!o.isSingleton(d)&&d&&(((t=d.annotations.Common)===null||t===void 0?void 0:(n=t.DraftRoot)===null||n===void 0?void 0:n.term)||((a=d.annotations)===null||a===void 0?void 0:(l=a.Session)===null||l===void 0?void 0:(r=l.StickySessionSupported)===null||r===void 0?void 0:r.term)),c=f==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.SaveAction),y=i>1,b=f==="com.sap.vocabularies.Common.v1.DraftRoot"||s&&(s===null||s===void 0?void 0:s.DiscardAction);var m=C(e.getEntityType(),true);var h=m.filter(function(i){return P.indexOf(i===null||i===void 0?void 0:i.Criticality)>-1}).map(function(i){var t,n;return{type:v.DataFieldForAction,annotationPath:e.getEntitySetBasedAnnotationPath(i.fullyQualifiedName),key:E.generateKeyFromDataField(i),visible:D(p(A(g((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:I(e,i.ActionTarget),isNavigable:true}});if((d===null||d===void 0?void 0:d.entityTypeName)===(u===null||u===void 0?void 0:u.fullyQualifiedName)&&c){h.push({type:v.Primary,key:"SaveAction"})}if(y){h.push({type:v.DefaultApply,key:"ApplyAction"})}m.filter(function(i){return P.indexOf(i===null||i===void 0?void 0:i.Criticality)===-1}).forEach(function(i){var t,n;h.push({type:v.DataFieldForAction,annotationPath:e.getEntitySetBasedAnnotationPath(i.fullyQualifiedName),key:E.generateKeyFromDataField(i),visible:D(p(A(g((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.Hidden),true))),enabled:I(e,i.ActionTarget),isNavigable:true})});if(b){h.push({type:v.Secondary,key:"CancelAction",position:{placement:S.End}})}return h}d.getFooterDefaultActions=x;return d},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map
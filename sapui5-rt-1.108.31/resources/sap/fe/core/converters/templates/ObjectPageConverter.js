/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","sap/fe/core/helpers/BindingToolkit","sap/fe/templates/ObjectPage/ObjectPageTemplating","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/BindingHelper","../helpers/ConfigurableObject","../helpers/ID","../ManifestSettings"],function(e,t,n,r,i,o,a,l,s,c,v){"use strict";var u={};var d=v.TemplateType;var f=c.getSectionID;var b=c.getEditableHeaderSectionID;var g=c.getCustomSectionID;var p=s.Placement;var m=s.insertCustomElements;var y=l.UI;var h=a.SubSectionType;var S=a.createSubSections;var A=a.createCustomSubSections;var O=a.createCustomHeaderFacetSubSections;var E=o.getHeaderFacetsFromManifest;var w=o.getHeaderFacetsFromAnnotations;var C=i.getAvatar;var P=r.getPressExpressionForPrimaryAction;var j=r.getEditCommandExecutionVisible;var H=r.getEditCommandExecutionEnabled;var I=n.not;var F=n.ifElse;var T=n.getExpressionFromAnnotation;var k=n.equal;var M=n.constant;var x=n.compileExpression;var D=t.getHiddenHeaderActions;var U=t.getHeaderDefaultActions;var B=t.getFooterDefaultActions;var V=e.removeDuplicateActions;var z=e.getActionsFromManifest;function W(e){return G(e)||_(e)||N(e)||L()}function L(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,t){if(!e)return;if(typeof e==="string")return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}function _(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function G(e){if(Array.isArray(e))return q(e)}function q(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++){r[n]=e[n]}return r}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $(e,t,n){t=K(t);if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function K(e){var t=Q(e,"string");return typeof t==="symbol"?t:String(t)}function Q(e,t){if(typeof e!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var r=n.call(e,t||"default");if(typeof r!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var X=function(e,t){var n,r;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((r=e.Label)===null||r===void 0?void 0:r.toString())||t};function Y(e,t){var n,r;var i=b();var o=(n=e.getEntityType().annotations)===null||n===void 0?void 0:(r=n.UI)===null||r===void 0?void 0:r.HeaderFacets;var a=o?S(o,e,true):[];var l=O(e);var s=[];if(l.length>0){var c=0;t.forEach(function(e){while(a.length>c&&a[c].visible==="false"){s.push(a[c]);c++}if(a.length>c&&(e.key===a[c].key||e.key.slice(e.key.lastIndexOf("::")+2)===a[c].key.slice(a[c].key.lastIndexOf("::")+2))){s.push(a[c]);c++}else{l.forEach(function(t){if(e.key===t.key){s.push(t)}})}})}else{s=a}var v={id:i,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:x(y.IsEditable),subSections:s};return v}u.createEditableHeaderSection=Y;function Z(e){var t,n,r;var i=e.getEntityType();var o=((t=i.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(r=n.Facets)===null||r===void 0?void 0:r.map(function(t){return ee(t,e)}))||[];return o}function ee(e,t){var n,r,i;var o=f({Facet:e});var a={id:o,key:X(e,o),title:x(T(e.Label)),showTitle:!!e.Label,visible:x(I(k(T((n=e.annotations)===null||n===void 0?void 0:(r=n.UI)===null||r===void 0?void 0:(i=r.Hidden)===null||i===void 0?void 0:i.valueOf()),true))),subSections:S([e],t)};return a}function te(e,t){var n={};Object.keys(e).forEach(function(r){n[r]=ne(e[r],r,t)});return n}function ne(e,t,n){var r=e.id||g(t);var i=e.position;if(!i){i={placement:p.After}}var o;if(!e.subSections){o=$({},t,R(R({},e),{},{position:undefined,visible:"true"}))}else{o=e.subSections}var a=A(o,n);var l={id:r,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:i,subSections:a};return l}var re=function(e){var t=U(e);var n=e.getManifestWrapper();var r=z(n.getHeaderActions(),e,t,undefined,undefined,D(e));var i=m(t,r.actions,{isNavigable:"overwrite",enabled:"overwrite",visible:"overwrite",defaultValuesExtensionFunction:"overwrite",command:"overwrite"});return{actions:V(i),commandActions:r.commandActions}};u.getHeaderActions=re;var ie=function(e){var t=e.getManifestWrapper();var n=B(t.getViewLevel(),e);var r=z(t.getFooterActions(),e,n);var i=m(n,r.actions,{isNavigable:"overwrite",enabled:"overwrite",visible:"overwrite",defaultValuesExtensionFunction:"overwrite",command:"overwrite"});return{actions:i,commandActions:r.commandActions}};u.getFooterActions=ie;var oe=function(e,t,n){var r="";var i=[].concat(W(t),W(n));var o=function(e){if(e&&e.indexOf("{=")>-1){return e.replace("{=","(").slice(0,-1)+")"}return e};var a=i.filter(function(t){if(t!==null&&t!==void 0&&t.annotationPath){var n=e.getConverterContextFor(t===null||t===void 0?void 0:t.annotationPath).getDataModelObjectPath().targetObject;if(n!==null&&n!==void 0&&n.Criticality&&(n===null||n===void 0?void 0:n.Criticality)==="UI.CriticalityType/Positive"){return true}}});var l=e.getEntitySet();if(a.length>0){var s,c;r=P(a[0].annotationPath&&e.getConverterContextFor(a[0].annotationPath).getDataModelObjectPath().targetObject,l===null||l===void 0?void 0:l.name,a[0],o((s=a[0].visible)!==null&&s!==void 0?s:"true"),o((c=a[0].enabled)!==null&&c!==void 0?c:"true"),o(j(t)),o(H(t)))}else{r=P(null,l===null||l===void 0?void 0:l.name,null,"false","false",o(j(t)),o(H(t)))}return r};u.getPrimaryAction=oe;function ae(e){var t;return e!==null&&e!==void 0&&(t=e.presentation)!==null&&t!==void 0&&t.visualizations[0]?e.presentation.visualizations[0]:undefined}function le(e,t){var n,r;return e.visible==="true"&&(e===null||e===void 0?void 0:(n=e.presentation)===null||n===void 0?void 0:n.visualizations)&&(t===null||t===void 0?void 0:t.type)==="Table"&&(t===null||t===void 0?void 0:(r=t.control)===null||r===void 0?void 0:r.type)==="GridTable"}function se(e,t,n,r){if(le(t,n)){var i=n.control;if(!(r==="Page"&&e.length>1)){i.rowCountMode="Auto"}}}function ce(e){if(e!==null&&e!==void 0&&e.content){if(e.content.length===1){var t;if(((t=e.content[0].presentation)===null||t===void 0?void 0:t.visualizations[0]).control.type==="GridTable"){var n;((n=e.content[0].presentation)===null||n===void 0?void 0:n.visualizations[0]).control.rowCountMode="Auto"}}}}function ve(e,t,n){var r;var i;var o=t.subSections;if(o.length===1){r=o[0];switch(o[0].type){case"DataVisualization":i=ae(r);se(e,r,i,n);break;case"Mixed":ce(r);break;default:break}}}var ue=function(e){var t=e.getManifestWrapper();var n=m(Z(e),te(t.getSections(),e),{title:"overwrite",visible:"overwrite",subSections:{actions:"merge",title:"overwrite",sideContent:"overwrite"}});n.forEach(function(e){var r;ve(n,e,t.getSectionLayout());(r=e.subSections)===null||r===void 0?void 0:r.forEach(function(e){var t;e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"&&(t=e.content)!==null&&t!==void 0&&t.length){var n;var r=e.content.find(function(e){return e.type===h.Form});if(e.sideContent){if(r){r.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(r&&(n=e.actions)!==null&&n!==void 0&&n.length){r.actions=e.actions;e.actions=[]}}})});return n};u.getSections=ue;function de(e){var t,n;var r=e.getManifestWrapper();return(((t=e.getEntityType().annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.HeaderFacets)||[]).length>0||Object.keys(r.getHeaderFacets()).length>0}function fe(e){var t=e.getManifestWrapper();return F(!de(e),M(false),F(k(t.isHeaderEditable(),false),M(true),I(y.IsEditable)))}var be=function(e){return x(fe(e))};u.getShowHeaderContent=be;var ge=function(e){return x(I(fe(e)))};u.getExpandedImageVisible=ge;var pe=function(e){var t,n;var r=e.getManifestWrapper();var i;var o=e.getEntityType();var a=m(w(e),E(r.getHeaderFacets()));var l=re(e);var s=ie(e);if(r.isHeaderEditable()&&((t=o.annotations.UI)!==null&&t!==void 0&&t.HeaderFacets||(n=o.annotations.UI)!==null&&n!==void 0&&n.HeaderInfo)){i=Y(e,a)}var c=ue(e);var v=oe(e,l.actions,s.actions);return{template:d.ObjectPage,header:{visible:r.getShowObjectPageHeader(),section:i,facets:a,actions:l.actions,showContent:be(e),hasContent:de(e),avatar:C(e),title:{expandedImageVisible:ge(e)}},sections:c,footerActions:s.actions,headerCommandActions:l.commandActions,footerCommandActions:s.commandActions,showAnchorBar:r.getShowAnchorBar(),useIconTabBar:r.useIconTabBar(),primaryAction:v}};u.convertPage=pe;return u},false);
//# sourceMappingURL=ObjectPageConverter.js.map
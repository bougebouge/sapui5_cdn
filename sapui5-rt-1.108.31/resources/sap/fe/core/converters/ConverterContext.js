/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/DataModelPathHelper"],function(t,e,n){"use strict";var a=n.getTargetObjectPath;var r=n.getContextRelativeTargetObjectPath;var i=n.enhanceDataModelPath;var o=e.getInvolvedDataModelObjectFromPath;var s=e.convertTypes;var u=function(t){return typeof t==="object"};function c(t){return t&&t.hasOwnProperty("_type")}var h=function(t,e){var n;var a;var r;var i;var o=[];var s=[];t.objectPath.forEach(function(t){var e;if(c(t)){switch(t._type){case"NavigationProperty":o.push(t.name);s.push(t);i=t.targetType;if(r&&r.navigationPropertyBinding.hasOwnProperty(o.join("/"))){a=r.navigationPropertyBinding[o.join("/")];r=a;o=[]}else{a=undefined}break;case"EntitySet":if(n===undefined){n=t}a=t;r=a;i=(e=a)===null||e===void 0?void 0:e.entityType;break;default:break}}});var u={startingEntitySet:n,targetEntityType:i,targetEntitySet:a,navigationProperties:s,contextLocation:undefined,targetObject:t.target,convertedTypes:e};u.contextLocation=u;return u};var f=function(){function e(e,n,r,i,o){this.convertedTypes=e;this.manifestSettings=n;this.diagnostics=r;this.mergeFn=i;this.targetDataModelPath=o;this.manifestWrapper=new t(this.manifestSettings,i);this.baseContextPath=a(this.targetDataModelPath)}var n=e.prototype;n._getEntityTypeFromFullyQualifiedName=function t(e){return this.convertedTypes.entityTypes.find(function(t){if(e.startsWith(t.fullyQualifiedName)){var n=e.replace(t.fullyQualifiedName,"");return n.startsWith("/")||n.startsWith("@")}return false})};n.getAnnotationEntityType=function t(e){if(e){var n=e.fullyQualifiedName;var a=this._getEntityTypeFromFullyQualifiedName(n);if(!a){throw new Error("Cannot find Entity Type for ".concat(e.fullyQualifiedName))}return a}else{return this.targetDataModelPath.targetEntityType}};n.getManifestControlConfiguration=function t(e){if(u(e)){return this.manifestWrapper.getControlConfiguration(e.fullyQualifiedName.replace(this.targetDataModelPath.targetEntityType.fullyQualifiedName,""))}var n=this.manifestWrapper.hasMultipleEntitySets()&&this.baseContextPath!=="/".concat(this.manifestWrapper.getEntitySet())?"".concat(this.baseContextPath,"/").concat(e):e;return this.manifestWrapper.getControlConfiguration(n)};n.getAbsoluteAnnotationPath=function t(e){if(!e){return e}if(e[0]==="/"){return e}return"".concat(this.baseContextPath,"/").concat(e)};n.getEntitySet=function t(){return this.targetDataModelPath.targetEntitySet};n.getContextPath=function t(){return this.baseContextPath};n.getDataModelObjectPath=function t(){return this.targetDataModelPath};n.getEntityContainer=function t(){return this.convertedTypes.entityContainer};n.getEntityType=function t(){return this.targetDataModelPath.targetEntityType};n.getParameterEntityType=function t(){var e,n;var a=this.targetDataModelPath.startingEntitySet.entityType;var r=!!((e=a.annotations)!==null&&e!==void 0&&(n=e.Common)!==null&&n!==void 0&&n.ResultContext);return r&&a};n.getEntityTypeAnnotation=function t(n){if(!n.includes("@")){throw new Error("Not an annotation path: '".concat(n,"'"))}var a=n.startsWith("/");var r;if(a){r=n}else{var i=this.getContextPath().split("@",1)[0];r=i.endsWith("/")?i+n:"".concat(i,"/").concat(n)}var s=this.resolveAbsolutePath(r);var u=o({target:s.target,visitedObjects:s.objectPath},this.convertedTypes,a?undefined:this.targetDataModelPath.contextLocation,true);return{annotation:s.target,converterContext:new e(this.convertedTypes,this.manifestSettings,this.diagnostics,this.mergeFn,u)}};n.getTemplateType=function t(){return this.manifestWrapper.getTemplateType()};n.getConvertedTypes=function t(){return this.convertedTypes};n.getRelativeAnnotationPath=function t(e,n){return e.replace(n.fullyQualifiedName,"")};n.getEntitySetBasedAnnotationPath=function t(e){if(!e){return e}var n=this.targetDataModelPath.targetEntityType.fullyQualifiedName;if(this.targetDataModelPath.targetEntitySet||(this.baseContextPath.startsWith("/")&&this.baseContextPath.match(/\//g)||[]).length>1){var a=e.replace(n,"/");if(a.length>2&&a[0]==="/"&&a[1]==="/"){a=a.substr(1)}return this.baseContextPath+(a.startsWith("/")?a:"/".concat(a))}else{return"/".concat(e)}};n.getManifestWrapper=function t(){return this.manifestWrapper};n.getDiagnostics=function t(){return this.diagnostics};n.resolveAbsolutePath=function t(e){return this.convertedTypes.resolvePath(e)};n.getConverterContextFor=function t(n){var a=this.convertedTypes.resolvePath(n);var r=h(a,this.convertedTypes);return new e(this.convertedTypes,this.manifestSettings,this.diagnostics,this.mergeFn,r)};n.getAnnotationsByTerm=function t(e,n){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[this.getEntityType()];var r=[];a.forEach(function(t){if(t){var a=(t===null||t===void 0?void 0:t.annotations[e])||{};if(a){r=Object.keys(a).filter(function(t){return a[t].term===n}).reduce(function(t,e){t.push(a[e]);return t},r)}}});return r};n.getRelativeModelPathFunction=function t(){var e=this.targetDataModelPath;return function(t){var n=i(e,t);return r(n,true)}};e.createConverterContextForMacro=function t(n,a,r,i,o){var u=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var c=a.isA("sap.ui.model.odata.v4.ODataMetaModel")?a:a.getModel();var h=s(c);var f=h.entitySets.find(function(t){return t.name===n});if(!f){f=h.singletons.find(function(t){return t.name===n})}if(!o||f!==o.startingEntitySet){o={startingEntitySet:f,navigationProperties:[],targetEntitySet:f,targetEntityType:f.entityType,targetObject:f,convertedTypes:h}}return new e(h,u,r,i,o)};return e}();return f},false);
//# sourceMappingURL=ConverterContext.js.map
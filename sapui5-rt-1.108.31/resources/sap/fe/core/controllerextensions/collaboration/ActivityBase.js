/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/UriParameters","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/ui/core/ws/SapPcpWebSocket"],function(e,t,o,r){"use strict";var a={};var n=r.SUPPORTED_PROTOCOLS;var c=o.Activity;var i="/collaboration";var s="/collaboration/connected";var l="/collaboration/connection";var u="/collaboration/DraftID";function f(e){return!!e.getProperty(s)}a.isCollaborationConnected=f;function d(o,r,a,n,c,f){var d=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(c.getProperty(l)){if(c.getProperty(u)===a){return}else{v(c)}}var p=[o];c.setProperty(i,{activeUsers:p,activities:{}});d=d||t.fromQuery(window.location.search).get("useFLPUser")==="true";var b=P(o,r,a,n,d);c.setProperty(l,b);c.setProperty(u,a);b.attachMessage(function(e){var t=e.getParameter("pcpFields");f(t)});b.attachOpen(function(){c.setProperty(s,true)});b.attachError(function(){e.error("The connection to the websocket channel ".concat(r," could not be established"));c.setProperty(s,false)});b.attachClose(function(){c.setProperty(s,false)})}a.initializeCollaboration=d;function p(e,t,o){if(f(o)){var r=o.getProperty(l);r.send("",{clientAction:e,clientContent:t});if(e===c.Activate||e===c.Discard){v(o)}}}a.broadcastCollaborationMessage=p;function v(e){var t=e.getProperty(l);t===null||t===void 0?void 0:t.close();e.setProperty(l,null);e.setProperty(u,undefined)}a.endCollaboration=v;function P(e,o,a,c){var i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var s=window.location;var l;var u=t.fromQuery(window.location.search).get("useBackendUrl");if(u){l=u.replace("https","wss")}else{l=s.protocol==="https:"?"wss:":"ws:";l+="//".concat(s.host)}l+="".concat((o.startsWith("/")?"":"/")+o,"?draft=").concat(a,"&relatedService=").concat(c);if(i){l+="&userID=".concat(encodeURI(e.id),"&userName=").concat(encodeURI(e.initialName||""))}return new r(l,[n.v10])}return a},false);
//# sourceMappingURL=ActivityBase.js.map
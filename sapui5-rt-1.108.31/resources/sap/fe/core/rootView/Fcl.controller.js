/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/KeepAliveHelper","sap/m/Link","sap/m/MessageBox","sap/m/MessagePage","./RootViewBaseController"],function(e,t,n,o,r,i,a,l,u,s){"use strict";var g,c,C,h,f;var d=l.Icon;var m=l.Action;var p=r.usingExtension;var v=r.defineUI5Class;function F(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=P(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var o=0;var r=function(){};return{s:r,n:function(){if(o>=e.length)return{done:true};return{done:false,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,a=false,l;return{s:function(){n=n.call(e)},n:function(){var e=n.next();i=e.done;return e},e:function(e){a=true;l=e},f:function(){try{if(!i&&n.return!=null)n.return()}finally{if(a)throw l}}}}function y(e){return E(e)||b(e)||P(e)||w()}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e,t){if(!e)return;if(typeof e==="string")return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}function b(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function E(e){if(Array.isArray(e))return M(e)}function M(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,o=new Array(t);n<t;n++){o[n]=e[n]}return o}function x(e,t,n,o){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function S(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function T(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;R(e,t)}function R(e,t){R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return R(e,t)}function _(e,t,n,o,r){var i={};Object.keys(o).forEach(function(e){i[e]=o[e]});i.enumerable=!!i.enumerable;i.configurable=!!i.configurable;if("value"in i||i.initializer){i.writable=true}i=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},i);if(r&&i.initializer!==void 0){i.value=i.initializer?i.initializer.call(r):void 0;i.initializer=undefined}if(i.initializer===void 0){Object.defineProperty(e,t,i);i=null}return i}function A(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var L=n.LayoutType;var B={page:{names:["BeginColumn","MidColumn","EndColumn"],currentGetter:{prefix:"getCurrent",suffix:"Page"},getter:{prefix:"get",suffix:"Pages"}}};var V=function(e){if(e.isA("sap.ui.core.ComponentContainer")){return e.getComponentInstance().getRootControl()}else{return e}};var I=(g=v("sap.fe.core.rootView.Fcl"),c=p(o.override({applyInitialStateOnly:function(){return false},adaptBindingRefreshControls:function(e){this.getView().getController()._getAllVisibleViews().forEach(function(t){var n=Promise.resolve(t);e.push(n)})},adaptStateControls:function(e){this.getView().getController()._getAllVisibleViews().forEach(function(t){var n=Promise.resolve(t);e.push(n)})},onRestore:function(){var e=this.getView();var t=this.getView().getController();var n=t.getAppContentContainer(e);var o=n.getModel("internal");var r=o.getProperty("/pages");for(var i in r){o.setProperty("/pages/".concat(i,"/restoreStatus"),"pending")}t.onContainerReady()},onSuspend:function(){var e=this.getView().getController();var t=e.getFclControl();var n=t.getBeginColumnPages()||[];var o=t.getMidColumnPages()||[];var r=t.getEndColumnPages()||[];var i=[].concat(n,o,r);i.forEach(function(e){var t=V(e);var n=t&&t.getController();if(n&&n.viewState&&n.viewState.onSuspend){n.viewState.onSuspend()}})}})),g(C=(h=function(n){T(o,n);function o(){var e;for(var t=arguments.length,o=new Array(t),r=0;r<t;r++){o[r]=arguments[r]}e=n.call.apply(n,[this].concat(o))||this;x(e,"viewState",f,S(e));return e}var r=o.prototype;r.onInit=function e(){n.prototype.onInit.call(this);this._internalInit()};r.attachRouteMatchers=function e(){this.getRouter().attachBeforeRouteMatched(this._getViewForNavigatedRowsComputation,this);n.prototype.attachRouteMatchers.call(this);this._internalInit();this.getRouter().attachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getRouter().attachRouteMatched(this.onRouteMatched,this);this.getFclControl().attachStateChange(this._saveLayout,this)};r._internalInit=function e(){var t,n;if(this._oRouterProxy){return}this.sCurrentRouteName="";this.sCurrentArguments={};this.SQUERYKEYNAME="?query";var o=this.getAppComponent();this._oRouterProxy=o.getRouterProxy();this._oFCLConfig={maxColumnsCount:3};var r=o.getManifest()["sap.ui5"].routing;if(r!==null&&r!==void 0&&(t=r.config)!==null&&t!==void 0&&t.flexibleColumnLayout){var i=r.config.flexibleColumnLayout;if(i.defaultTwoColumnLayoutType){this._oFCLConfig.defaultTwoColumnLayoutType=i.defaultTwoColumnLayoutType}if(i.defaultThreeColumnLayoutType){this._oFCLConfig.defaultThreeColumnLayoutType=i.defaultThreeColumnLayoutType}if(i.limitFCLToTwoColumns===true){this._oFCLConfig.maxColumnsCount=2}}if(r!==null&&r!==void 0&&(n=r.config)!==null&&n!==void 0&&n.controlAggregation){this._oFCLConfig.defaultControlAggregation=r.config.controlAggregation}this._initializeTargetAggregation(o);this._initializeRoutesInformation(o)};r.getFclControl=function e(){return this.getView().getContent()[0]};r._saveLayout=function e(t){this.sPreviousLayout=t.getParameters().layout};r._getViewForNavigatedRowsComputation=function e(){var t=this;var n=this._getAllVisibleViews(this.sPreviousLayout);var o=n[n.length-1];var r;this.getRouter().attachEventOnce("routeMatched",function(e){r=V(e.getParameter("views")[e.getParameter("views").length-1]);if(o){if(r.getViewData()&&r.getViewData().viewLevel===t._oFCLConfig.maxColumnsCount){t.oAdditionalViewForNavRowsComputation=r}if(r.getViewData()&&o.getViewData()&&o.getViewData().viewLevel<t._oFCLConfig.maxColumnsCount&&o.getViewData()&&o.getViewData().viewLevel>r.getViewData().viewLevel&&r!==o){t.oAdditionalViewForNavRowsComputation=o}}})};r.getViewForNavigatedRowsComputation=function e(){return this.oAdditionalViewForNavRowsComputation};r.onExit=function e(){this.getRouter().detachRouteMatched(this.onRouteMatched,this);this.getRouter().detachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getFclControl().detachStateChange(this.onStateChanged,this);this.getFclControl().detachAfterEndColumnNavigate(this.onStateChanged,this);this._oTargetsAggregation=null;this._oTargetsFromRoutePattern=null;s.prototype.onExit.bind(this)()};r.isFclEnabled=function e(){return true};r.displayMessagePage=function e(t,n){var o=this.getFclControl();if(this._oFCLConfig&&n.FCLLevel>=this._oFCLConfig.maxColumnsCount){n.FCLLevel=this._oFCLConfig.maxColumnsCount-1}if(!this.aMessagePages){this.aMessagePages=[null,null,null]}var r=this.aMessagePages[n.FCLLevel];if(!r){r=new u({showHeader:false,icon:"sap-icon://message-error"});this.aMessagePages[n.FCLLevel]=r;switch(n.FCLLevel){case 0:o.addBeginColumnPage(r);break;case 1:o.addMidColumnPage(r);break;default:o.addEndColumnPage(r)}}r.setText(t);if(n.technicalMessage){r.setCustomDescription(new a({text:n.description||n.technicalMessage,press:function(){l.show(n.technicalMessage,{icon:d.ERROR,title:n.title,actions:[m.OK],defaultAction:m.OK,details:n.technicalDetails||"",contentWidth:"60%"})}}))}else{r.setDescription(n.description||"")}o.to(r.getId());return Promise.resolve(true)};r._initializeTargetAggregation=function e(t){var n=this;var o=t.getManifest(),r=o["sap.ui5"].routing?o["sap.ui5"].routing.targets:null;this._oTargetsAggregation={};if(r){Object.keys(r).forEach(function(e){var t=r[e];if(t.controlAggregation){n._oTargetsAggregation[e]={aggregation:t.controlAggregation,pattern:t.contextPattern}}else{n._oTargetsAggregation[e]={aggregation:"page",pattern:null}}})}};r._initializeRoutesInformation=function e(t){var n=this;var o=t.getManifest(),r=o["sap.ui5"].routing?o["sap.ui5"].routing.routes:null;this._oTargetsFromRoutePattern={};if(r){r.forEach(function(e){n._oTargetsFromRoutePattern[e.pattern]=e.target})}};r.getCurrentArgument=function e(){return this.sCurrentArguments};r.getCurrentRouteName=function e(){return this.sCurrentRouteName};r.getConstants=function e(){return B};r.getTargetAggregation=function e(){return this._oTargetsAggregation};r.onRouteMatched=function e(t){var n=t.getParameter("name");this.sCurrentRouteName=n;this.sCurrentArguments=t.getParameter("arguments")};r._scrollTablesToLastNavigatedItems=function e(){var t=this._getAllVisibleViews();if(t.length>1||t[0].getViewData().viewLevel<this._oFCLConfig.maxColumnsCount){var n;var o=this.getViewForNavigatedRowsComputation();if(o&&t.indexOf(o)===-1){t.push(o)}for(var r=t.length-1;r>0;r--){var i=t[r],a=t[r-1];if(i.getBindingContext()){n=i.getBindingContext().getPath();a.getController()._scrollTablesToRow(n)}}}};r.onStateChanged=function e(t){var n=t.getParameter("isNavigationArrow");if(this.sCurrentArguments!==undefined){if(!this.sCurrentArguments[this.SQUERYKEYNAME]){this.sCurrentArguments[this.SQUERYKEYNAME]={}}this.sCurrentArguments[this.SQUERYKEYNAME].layout=t.getParameter("layout")}this._forceModelContextChangeOnBreadCrumbs(t);if(n){this._oRouterProxy.navTo(this.sCurrentRouteName,this.sCurrentArguments)}};r._forceModelContextChangeOnBreadCrumbs=function e(t){var n=t.getSource();var o=[];o=o.concat(n.getBeginColumnPages()).concat(n.getMidColumnPages()).concat(n.getEndColumnPages());o.forEach(function(e){var t=V(e);var n=t.byId&&t.byId("breadcrumbs");if(n){n.fireModelContextChange()}})};r._updateShareButtonVisibility=function e(t,n){var o;switch(n){case"OneColumn":o=t==="beginColumn";break;case"MidColumnFullScreen":case"ThreeColumnsBeginExpandedEndHidden":case"ThreeColumnsMidExpandedEndHidden":case"TwoColumnsBeginExpanded":case"TwoColumnsMidExpanded":o=t==="midColumn";break;case"EndColumnFullScreen":case"ThreeColumnsEndExpanded":case"ThreeColumnsMidExpanded":o=t==="endColumn";break;default:o=false}return o};r.updateUIStateForView=function e(t,n){var o=this.getHelper().getCurrentUIState(),r=["beginColumn","midColumn","endColumn"],i=this.getFclControl().getLayout();var a;if(!t.getModel("fclhelper")){t.setModel(this._createHelperModel(),"fclhelper")}if(n>=this._oFCLConfig.maxColumnsCount){a=r[this._oFCLConfig.maxColumnsCount-1];o.actionButtonsInfo.midColumn.fullScreen=null;o.actionButtonsInfo.midColumn.exitFullScreen=null;o.actionButtonsInfo.midColumn.closeColumn=null;o.actionButtonsInfo.endColumn.exitFullScreen=null;o.actionButtonsInfo.endColumn.fullScreen=null;o.actionButtonsInfo.endColumn.closeColumn=null}else{a=r[n]}if(n>=this._oFCLConfig.maxColumnsCount||i==="EndColumnFullScreen"||i==="MidColumnFullScreen"||i==="OneColumn"){t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",true)}else{t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",false)}o.actionButtonsInfo.beginColumn={fullScreen:null,exitFullScreen:null,closeColumn:null};var l=Object.assign({},o.actionButtonsInfo[a]);l.switchVisible=l.fullScreen!==null||l.exitFullScreen!==null;l.switchIcon=l.fullScreen!==null?"sap-icon://full-screen":"sap-icon://exit-full-screen";l.isFullScreen=l.fullScreen===null;t.getModel("fclhelper").setProperty("/actionButtonsInfo",l);t.getModel("fclhelper").setProperty("/showShareIcon",this._updateShareButtonVisibility(a,i))};r.onBeforeRouteMatched=function e(t){if(t){var n=t.getParameters().arguments[this.SQUERYKEYNAME];var o=n?n.layout:null;if(!o){var r=this.getHelper().getNextUIState(0);o=r.layout}var i=t.getParameter("config").target;o=this._correctLayoutForTargets(o,i);if(o){this.getFclControl().setLayout(o)}}};r.getHelper=function e(){return t.getInstanceFor(this.getFclControl(),this._oFCLConfig)};r.calculateLayout=function e(t,n,o){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!o){o=r?this.getFclControl().getLayout():this.getHelper().getNextUIState(t).layout}var i=this.getRouter().getRouteByHash("".concat(n,"?layout=").concat(o));var a=this._oTargetsFromRoutePattern[i.getPattern()];return this._correctLayoutForTargets(o,a)};r._correctLayoutForTargets=function e(t,n){var o={2:["TwoColumnsMidExpanded","TwoColumnsBeginExpanded","MidColumnFullScreen"],3:["ThreeColumnsMidExpanded","ThreeColumnsEndExpanded","ThreeColumnsMidExpandedEndHidden","ThreeColumnsBeginExpandedEndHidden","MidColumnFullScreen","EndColumnFullScreen"]};if(n&&!Array.isArray(n)){n=[n]}if(!n){return t}else if(n.length>1){var r=o[n.length];if(r.indexOf(t)<0){t=r[0]}}else{var i=this.getTargetAggregation()[n[0]].aggregation||this._oFCLConfig.defaultControlAggregation;switch(i){case"beginColumnPages":t="OneColumn";break;case"midColumnPages":t="MidColumnFullScreen";break;case"endColumnPages":t="EndColumnFullScreen";break}}return t};r.getInstancedViews=function e(){var t=this.getFclControl();var n=[].concat(y(t.getBeginColumnPages()),y(t.getMidColumnPages()),y(t.getEndColumnPages()));return n.map(function(e){return e.getComponentInstance().getRootControl()})};r._getAllVisibleViews=function t(n){var o=[];n=n?n:this.getFclControl().getLayout();switch(n){case L.EndColumnFullScreen:if(this.getFclControl().getCurrentEndColumnPage()){o.push(V(this.getFclControl().getCurrentEndColumnPage()))}break;case L.MidColumnFullScreen:if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}break;case L.OneColumn:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}break;case L.ThreeColumnsEndExpanded:case L.ThreeColumnsMidExpanded:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}if(this.getFclControl().getCurrentEndColumnPage()){o.push(V(this.getFclControl().getCurrentEndColumnPage()))}break;case L.TwoColumnsBeginExpanded:case L.TwoColumnsMidExpanded:case L.ThreeColumnsMidExpandedEndHidden:case L.ThreeColumnsBeginExpandedEndHidden:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}break;default:e.error("Unhandled switch case for ".concat(this.getFclControl().getLayout()))}return o};r._getAllViews=function t(n){var o=[];n=n?n:this.getFclControl().getLayout();switch(n){case L.OneColumn:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}break;case L.ThreeColumnsEndExpanded:case L.ThreeColumnsMidExpanded:case L.ThreeColumnsMidExpandedEndHidden:case L.ThreeColumnsBeginExpandedEndHidden:case L.EndColumnFullScreen:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}if(this.getFclControl().getCurrentEndColumnPage()){o.push(V(this.getFclControl().getCurrentEndColumnPage()))}break;case L.TwoColumnsBeginExpanded:case L.TwoColumnsMidExpanded:if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}break;case L.MidColumnFullScreen:var r=this.getHelper().getCurrentUIState().actionButtonsInfo.midColumn.exitFullScreen;if(this.getFclControl().getCurrentBeginColumnPage()){o.push(V(this.getFclControl().getCurrentBeginColumnPage()))}if(this.getFclControl().getCurrentMidColumnPage()){o.push(V(this.getFclControl().getCurrentMidColumnPage()))}if(r.indexOf("ThreeColumn")>=0){if(this.getFclControl().getCurrentEndColumnPage()){o.push(V(this.getFclControl().getCurrentEndColumnPage()))}}break;default:e.error("Unhandled switch case for ".concat(this.getFclControl().getLayout()))}return o};r.onContainerReady=function e(){var t=this._getAllVisibleViews();var n=t.reduce(function(e,t){e.push(i.restoreView(t));return e},[]);return Promise.all(n)};r.getRightmostContext=function e(){var t=this.getRightmostView();return t&&t.getBindingContext()};r.getRightmostView=function e(){return this._getAllViews().pop()};r.isContextUsedInPages=function e(t){if(!this.getFclControl()){return false}var n=this._getAllViews();var o=F(n),r;try{for(o.s();!(r=o.n()).done;){var i=r.value;if(i){if(i.getBindingContext()===t){return true}}else{return false}}}catch(e){o.e(e)}finally{o.f()}return false};return o}(s),f=_(h.prototype,"viewState",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),h))||C);return I},false);
//# sourceMappingURL=Fcl.controller.js.map
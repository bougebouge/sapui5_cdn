/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/base/ManagedObject","sap/ui/core/util/XMLPreprocessor"],function(t,e,r){"use strict";function n(t){return c(t)||o(t)||i(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){if(!t)return;if(typeof t==="string")return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(t,e)}function o(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function c(t){if(Array.isArray(t))return u(t)}function u(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,n=new Array(e);r<e;r++){n[r]=t[r]}return n}var s=[];var f="http://schemas.sap.com/sapui5/extension/sap.fe.info/1",l="http://www.w3.org/2000/xmlns/",p=location.search.indexOf("sap-ui-xx-feTraceInfo=true")>-1,h=["sap.m","sap.uxap","sap.ui.unified","sap.f","sap.ui.table","sap.suite.ui.microchart","sap.ui.layout.form","sap.ui.mdc","sap.ui.mdc.link","sap.ui.mdc.field","sap.fe.fpm"],d={};function m(t){return JSON.parse(JSON.stringify(t))}function g(t,r,n,a){var i;var o=[];try{i=e.bindingParser(t,undefined,false,true)||[]}catch(t){i=[]}i=Array.isArray(i)?i:[i];i.filter(function(t){return t.path||t.parts}).forEach(function(t){var e=t.parts||[t];e.filter(function(t){return t.path}).forEach(function(t){var e=r[t.model]=r[t.model]||{};var i=t.path.indexOf(">")<0?(t.model&&"".concat(t.model,">"))+t.path:t.path;var c;var u;if(typeof t.model==="undefined"&&i.indexOf(">")>-1){u=i.split(">");t.model=u[0];t.path=u[1]}try{c=n.getContext(i);o.push(n.getResult("{".concat(i,"}"),a).then(function(r){if(c.getModel().getMetadata().getName()==="sap.ui.model.json.JSONModel"){if(!r.oModel){e[t.path]=r}else{e[t.path]="Context from ".concat(r.getPath())}}else{e[t.path]={path:c.getPath(),data:typeof r==="object"?"[ctrl/cmd-click] on path to see data":r}}}).catch(function(){e[t.path]={bindingFor:"Runtime"}}))}catch(r){e[t.path]={bindingFor:"Runtime"}}})});return Promise.all(o)}function v(t,e,r,n){return t.then(function(t){e[r]=n!==t?{originalValue:n,resolvedValue:t}:n}).catch(function(t){e[r]={originalValue:n,error:t.stack&&t.stack.toString()||t}})}function b(t,e){var r={};var n=[];var a={};var i;for(var o=t.attributes.length>>>0;o--;){var c=t.attributes[o],u=c.nodeName,s=t.getAttribute(u);if(!["core:require"].includes(u)){n.push(g(s,a,e,t));i=e.getResult(s,t);if(i){n.push(v(i,r,u,s))}else{}}}return Promise.all(n).then(function(){return{properties:r,contexts:a}})}function y(e,r){try{var a=e.nodeName.split(":")[1]||e.nodeName,i=/^[A-Z]/.test(a),o={control:"".concat(e.namespaceURI,".").concat(e.nodeName.split(":")[1]||e.nodeName)};if(i){var c=n(e.ownerDocument.children).find(function(t){return!t.nodeName.startsWith("#")});if(c&&!c.getAttribute("xmlns:trace")){c.setAttributeNS(l,"xmlns:trace",f);c.setAttributeNS(f,"trace:is","on")}return b(e,r).then(function(t){var n=Object.keys(t.contexts).length>0;if(n){Object.assign(o,t);o.viewInfo=r.getViewInfo();o.macroInfo=r.getSettings()["_macroInfo"];o.traceID=s.length;e.setAttributeNS(f,"trace:traceID",o.traceID);s.push(o)}return r.visitAttributes(e)}).then(function(){return r.visitChildNodes(e)}).catch(function(t){o.error={exception:t,node:(new XMLSerializer).serializeToString(e)}})}else{return r.visitAttributes(e).then(function(){return r.visitChildNodes(e)})}}catch(n){t.error("Error while tracing '".concat(e===null||e===void 0?void 0:e.nodeName,"': ").concat(n.message),"TraceInfo");return r.visitAttributes(e).then(function(){return r.visitChildNodes(e)})}}if(p){h.forEach(function(t){d[t]=r.plugIn(y.bind(t),t)})}function I(t,e,r,n,a){try{var i=e.metadataContexts&&Object.keys(e.metadataContexts)||[];var o=e.properties&&Object.keys(e.properties)||[];var c=m(a.getSettings()["_macroInfo"]||{});var u={macro:t,metaDataContexts:[],properties:{}};if(i.length===0){i=Object.keys(r).filter(function(t){return t!=="this"})}if(!n.getAttribute("xmlns:trace")){n.setAttributeNS(l,"xmlns:trace",f)}if(i.length>0){i.forEach(function(t){var e=r[t],n=e&&{name:t,path:e.getPath()};if(n){u.metaDataContexts.push(n)}});o.forEach(function(t){var e=r.this.getObject(t);if(e){u.properties[t]=e}});u.viewInfo=a.getViewInfo();u.traceID=s.length;c.parentMacroID=c.macroID;c.macroID=u.traceID;u.macroInfo=c;n.setAttributeNS(f,"trace:macroID",u.traceID);s.push(u);return u}}catch(e){var p;return{isError:true,error:e,name:t,node:(new XMLSerializer).serializeToString(n),contextPath:a===null||a===void 0?void 0:(p=a.getContext())===null||p===void 0?void 0:p.getPath()}}}function x(t){if(t){return s[t]}var e=s.filter(function(t){return t.error});return e.length>0&&e||s}function A(){return p}return{isTraceInfoActive:A,traceMacroCalls:I,getTraceInfo:x}},true);
//# sourceMappingURL=TraceInfo.js.map
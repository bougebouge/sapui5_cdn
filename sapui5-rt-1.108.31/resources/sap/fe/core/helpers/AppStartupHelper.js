/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","./ModelHelper"],function(e,t,a){"use strict";var r={_getKeysFromStartupParams:function(e,t){var a=true;var r=e.map(function(e){if(t[e]&&t[e].length===1){return{name:e,value:t[e][0]}}else{a=false;return{name:e,value:""}}});return a?r:undefined},_createFilterFromKeys:function(r,n,i){var o=a.isFilteringCaseSensitive(i);var s=false;var u=r.map(function(a){if(a.name==="IsActiveEntity"){s=true}return new e({path:a.name,operator:t.EQ,value1:a.value,caseSensitive:o})});if(n&&!s){var c=new e({filters:[new e("IsActiveEntity","EQ",false),new e("SiblingEntity/IsActiveEntity","EQ",null)],and:false});u.push(c)}return new e(u,true)},_requestObjectsFromParameters:function(e,t){var a=this;var r=e.map(function(e){var r=e.semanticKeys||e.technicalKeys||[];var n=a._createFilterFromKeys(r,e.draftMode,t.getMetaModel());var i=t.bindList(e.contextPath,undefined,undefined,n,{$select:r.map(function(e){return e.name}).join(",")});return i.requestContexts(0,2)});return Promise.all(r)},_getReachablePageInfoFromRoute:function(e,t,a,r){var n,i;var o=e.pattern.replace(":?query:","");o=o.replace(/\/$/,"");if(!o||!o.endsWith(")")){return undefined}o=o.replace(/\(\{[^\}]*\}\)/g,"(#)");var s=Array.isArray(e.target)?e.target[e.target.length-1]:e.target;var u=t.targets[s];var c=o.split("/");var l=c.length-1;if(l!==0&&(u===null||u===void 0?void 0:(n=u.options)===null||n===void 0?void 0:(i=n.settings)===null||i===void 0?void 0:i.allowDeepLinking)!==true){return undefined}var f=u.options.settings.contextPath||u.options.settings.entitySet&&"/".concat(u.options.settings.entitySet);var v=f&&r.getObject("/$EntityContainer".concat(f,"/"));if(!v){return undefined}var p=r.getObject("/$EntityContainer".concat(f,"/@com.sap.vocabularies.Common.v1.SemanticKey"));var g=p?this._getKeysFromStartupParams(p.map(function(e){return e.$PropertyPath}),a):undefined;var h=!g&&l===0?this._getKeysFromStartupParams(v["$Key"],a):undefined;if(g===undefined&&h===undefined){return undefined}var d=r.getObject("/$EntityContainer".concat(f,"@com.sap.vocabularies.Common.v1.DraftRoot"))||r.getObject("/$EntityContainer".concat(f,"@com.sap.vocabularies.Common.v1.DraftNode"))?true:false;return{pattern:o,contextPath:f,draftMode:d,technicalKeys:h,semanticKeys:g,target:s,pageLevel:l}},_getReachablePages:function(e,t,a){var r=this;var n=e.routes;var i={};n.forEach(function(n){var o=r._getReachablePageInfoFromRoute(n,e,t,a);if(o){if(!i[o.pageLevel]){i[o.pageLevel]=[]}i[o.pageLevel].push(o)}});var o=[];var s=0;while(i[s]){o.push(i[s]);s++}return o},_getStartupPagesFromStartupParams:function(e,t,a){var r=this._getReachablePages(e,t,a);if(r.length===0){return[]}var n=[];var i=[];function o(e){var t=r[e];var a=i.length?i[i.length-1]:undefined;if(t){t.forEach(function(t){if(!a||t.pattern.indexOf(a.pattern)===0){i.push(t);o(e+1);i.pop()}})}if(i.length>n.length){n=i.slice()}}o(0);return n},_getDeepLinkObject:function(e,t){if(t.length===1){return{context:t[0]}}else if(t.length>1){var a=e[e.length-1].pattern;t.forEach(function(e){a=a.replace("(#)","(".concat(e.getPath().split("(")[1]))});return{hash:a}}else{return{}}},getDeepLinkStartupHash:function(e,t,a){var r=this;var n;return a.getMetaModel().requestObject("/$EntityContainer/").then(function(){n=r._getStartupPagesFromStartupParams(e,t,a.getMetaModel());return r._requestObjectsFromParameters(n,a)}).then(function(e){if(e.length){var t=[];e.forEach(function(e){if(e.length===1){t.push(e[0])}});return t.length===e.length?r._getDeepLinkObject(n,t):{}}else{return{}}})},getCreateStartupHash:function(e,t,a,r){var n=this;return r.requestObject("".concat(t,"@")).then(function(i){var o="";var s=true;if(i["@com.sap.vocabularies.Common.v1.DraftRoot"]&&i["@com.sap.vocabularies.Common.v1.DraftRoot"]["NewAction"]){o="".concat(t,"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction@Org.OData.Core.V1.OperationAvailable")}else if(i["@com.sap.vocabularies.Session.v1.StickySessionSupported"]&&i["@com.sap.vocabularies.Session.v1.StickySessionSupported"]["NewAction"]){o="".concat(t,"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction@Org.OData.Core.V1.OperationAvailable")}if(o){var u=r.getObject(o);if(u===false){s=false}}else{var c=i["@Org.OData.Capabilities.V1.InsertRestrictions"];if(c&&c.Insertable===false){s=false}}if(s){return n.getDefaultCreateHash(e,t,a)}else{return""}})},getDefaultCreateHash:function(e,t,a){var r=e&&e.preferredMode?e.preferredMode[0]:"create";var n="";r=r.indexOf(":")!==-1&&r.length>r.indexOf(":")+1?r.substr(0,r.indexOf(":")):"create";n="".concat(t.substring(1),"(...)?i-action=").concat(r);if(a.getRouteInfoByHash(n)){return n}else{throw new Error("No route match for creating a new ".concat(t.substring(1)))}}};return r},false);
//# sourceMappingURL=AppStartupHelper.js.map
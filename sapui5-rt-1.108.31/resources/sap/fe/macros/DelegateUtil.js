/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/macros/field/FieldHelper","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,n,o,r,a){"use strict";var i={};var l=a.generateID;var c=o.getRelativePropertyPath;var u=n.generate;var s=function(e,t,n){try{var o=[];return Promise.resolve(Promise.resolve().then(n.getAggregation.bind(n,e,"customData"))).then(function(e){var r=e.reduce(function(e,r){return e.then(n.getProperty.bind(n,r,"key")).then(function(e){if(e===t){o.push(r)}})},Promise.resolve());return Promise.resolve(r).then(function(){if(o.length===1){return n.getProperty(o[0],"value")}else{return undefined}})})}catch(e){return Promise.reject(e)}};var d="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";var m={"Edm.Boolean":{modelType:"Bool"},"Edm.Byte":{modelType:"Int"},"Edm.Date":{modelType:"Date"},"Edm.DateTime":{modelType:"Date"},"Edm.DateTimeOffset":{modelType:"DateTimeOffset"},"Edm.Decimal":{modelType:"Decimal"},"Edm.Double":{modelType:"Float"},"Edm.Float":{modelType:"Float"},"Edm.Guid":{modelType:"Guid"},"Edm.Int16":{modelType:"Int"},"Edm.Int32":{modelType:"Int"},"Edm.Int64":{modelType:"Int"},"Edm.SByte":{modelType:"Int"},"Edm.Single":{modelType:"Float"},"Edm.String":{modelType:"String"},"Edm.Time":{modelType:"TimeOfDay"},"Edm.TimeOfDay":{modelType:"TimeOfDay"},"Edm.Stream":{modelType:undefined}};i.mDefaultTypeForEdmType=m;function f(){this.control.detachModelContextChange(f,this);var e=this.modelName,t=this.control.getModel(e);if(t){this.resolve(t)}else{this.control.attachModelContextChange(f,this)}}var p={getLocalizedText:function(t,n){var o=/{([A-Za-z0-9_.|@]+)>([A-Za-z0-9_.|]+)}/.exec(t);if(o){try{var r=n.getModel(o[1]).getResourceBundle();return r.getText(o[2])}catch(n){e.info("Unable to retrieve localized text ".concat(t))}}return t},getCustomData:function(e,t,n){if(n){return s(e,t,n)}else{if(e&&t){if(e instanceof window.Element){return e.getAttributeNS(d,t)}if(e.data instanceof Function){return e.data(t)}}return undefined}},setCustomData:function(e,t,n){if(e&&t){if(e instanceof window.Element){return e.setAttributeNS(d,"customData:".concat(t),n)}if(e.data instanceof Function){return e.data(t,n)}}},fetchPropertiesForEntity:function(e,t){return t.requestObject("".concat(e,"/"))},fetchAnnotationsForEntity:function(e,t){return t.requestObject("".concat(e,"@"))},fetchModel:function(e){return new Promise(function(t){var n=e.getDelegate().payload&&e.getDelegate().payload.modelName,o={modelName:n,control:e,resolve:t};f.call(o)})},loadMacroLibrary:function(){return new Promise(function(e){sap.ui.require(["sap/fe/macros/macroLibrary"],function(){e()})})},templateControlFragment:function(e,n,o,r){return t.templateControlFragment(e,n,o,r)},doesValueHelpExist:function(e){var t=e.sPropertyName||"";var n=e.sValueHelpType||"";var o=e.oMetaModel;var a=e.oModifier;var i="".concat(e.sBindingPath,"/").concat(t);var s=o.createBindingContext(i);var d=r.valueHelpProperty(s);var m=e.sBindingPath&&e.sBindingPath.indexOf("/")===0;if(d.indexOf("$Path")>-1){d=o.getObject(d)}if(m&&d.indexOf("/")!==0){d="".concat(e.sBindingPath,"/").concat(d)}var f=l(e.flexId,u([a?a.getId(e.oControl):e.oControl.getId(),n]),c(s.getProperty(i),{context:{getModel:function(){return e.oMetaModel},getPath:function(){return i}}}),c(s.getProperty(d),{context:{getModel:function(){return e.oMetaModel},getPath:function(){return d}}}));return Promise.resolve().then(function(){if(a){return a.getAggregation(e.oControl,"dependents")}return e.oControl.getAggregation("dependents")}).then(function(e){return Promise.resolve(e&&e.some(function(e){return a?a.getId(e)===f:e.getId()===f}))})},isValueHelpRequired:function(t,n){var o=t.sPropertyName||"",a=t.oMetaModel,i="".concat(t.sBindingPath,"/").concat(o),l=a.createBindingContext(i),c=r.valueHelpProperty(l,n);return this.getCustomData(t.oControl,"displayModePropertyBinding",t.oModifier).then(function(e){e=typeof e==="boolean"?e:e==="true";if(e){return false}return Promise.all([a.requestObject("".concat(c,"@com.sap.vocabularies.Common.v1.ValueListWithFixedValues")),a.requestObject("".concat(c,"@com.sap.vocabularies.Common.v1.ValueListReferences")),a.requestObject("".concat(c,"@com.sap.vocabularies.Common.v1.ValueListMapping")),a.requestObject("".concat(c,"@com.sap.vocabularies.Common.v1.ValueList"))])}).then(function(e){return!!e[0]||!!e[1]||!!e[2]||!!e[3]}).catch(function(t){e.warning("Error while retrieving custom data / value list annotation values",t)})},isTypeFilterable:function(e){return e&&e in m&&!!m[e].modelType},getModelType:function(e){return e&&e in m&&m[e].modelType},isMultiValue:function(e){var t=true;switch(e.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":t=false;break;default:break}if(e.type&&e.type.indexOf("Boolean")>0){t=false}return t}};return p},false);
//# sourceMappingURL=DelegateUtil.js.map
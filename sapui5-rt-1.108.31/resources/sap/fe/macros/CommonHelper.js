/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/m/library","sap/ui/Device","sap/ui/mdc/enum/EditMode","sap/ui/model/Context","sap/ui/model/odata/v4/AnnotationHelper"],function(t,e,n,a,r,i,o,c,s){"use strict";var u=i.system;var l=n.ref;var f=n.fn;var g=n.compileExpression;var d=r.ValueColor;var v={useFieldValueHelp:function(){return location.href.indexOf("sap-fe-oldFieldValueHelp=true")>-1},getPathToKey:function(t){return t.getObject()},isVisible:function(t,e){var n=e.context.getModel(),a=e.context.getPath(),r=n.getObject("".concat(a,"@")),i=r["@com.sap.vocabularies.UI.v1.Hidden"];return typeof i==="object"?"{= !${"+i.$Path+"} }":!i},isDialog:function(t,e){var n=e.context.getModel(),a=e.context.getPath(),r=n.getObject("".concat(a,"/@$ui5.overload@com.sap.vocabularies.Common.v1.IsActionCritical"));if(r){return"Dialog"}else if(t){var i=Array.isArray(t)?t[0]:t;if(i.$Parameter&&i.$Parameter.length>1){return"Dialog"}else{return"None"}}},getParameterEditMode:function(t,e){var n=e.context.getModel(),a=e.context.getPath(),r=n.getObject("".concat(a,"@")),i=r["@com.sap.vocabularies.Common.v1.FieldControl"],c=r["@Org.OData.Core.V1.Immutable"],s=r["@Org.OData.Core.V1.Computed"];var u=o.Editable;if(c||s){u=o.ReadOnly}else if(i){if(i.$EnumMember){if(i.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){u=o.ReadOnly}if(i.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Inapplicable"||i.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Hidden"){u=o.Disabled}}if(i.$Path){u="{= %{"+i.$Path+"} < 3 ? (%{"+i.$Path+"} === 0 ? '"+o.Disabled+"' : '"+o.ReadOnly+"') : '"+o.Editable+"'}"}}return u},getMetaPath:function(t,e){return e&&e.context&&e.context.getPath()||undefined},isDesktop:function(){return u.desktop===true},getTargetCollection:function(t,e){var n=t.getPath();if(t.getMetadata().getName()==="sap.ui.model.Context"&&(t.getObject("$kind")==="EntitySet"||t.getObject("$ContainsTarget")===true)){return n}if(t.getModel){n=t.getModel().getMetaPath&&t.getModel().getMetaPath(n)||t.getModel().getMetaModel().getMetaPath(n)}var a=n.split("/").filter(function(t){return t&&t!="$Type"});var r="/".concat(a[0]);if(a.length===1){return r}var i=e===undefined?a.slice(1).join("/$NavigationPropertyBinding/"):e;return"".concat(r,"/$NavigationPropertyBinding/").concat(i)},isPropertyFilterable:function(t,n,a){var r=n.context.getModel(),i=n.context.getPath(),o=v.getLocationForPropertyPath(r,i),c=i.replace("".concat(o,"/"),"");if(a&&(a.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||a.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return false}return e.isPropertyFilterable(r,o,c)},getLocationForPropertyPath:function(t,e){var n;var a=e.slice(0,e.lastIndexOf("/"));if(t.getObject("".concat(a,"/$kind"))==="EntityContainer"){n=a.length+1;a=e.slice(n,e.indexOf("/",n))}return a},gotoActionParameter:function(t){var n=t.getPath(),a=t.getObject("".concat(n,"/$Name"));return e.getParameterPath(n,a)},getEntitySetName:function(t,e){var n=t.getObject("/");for(var a in n){if(typeof n[a]==="object"&&n[a].$Type===e){return a}}},getActionPath:function(t,e,n,a){var r=t.getPath().split("/@")[0];n=!n?t.getObject(t.getPath()):n;if(n&&n.indexOf("(")>-1){n=n.split("(")[0]}else if(t.getObject(r)){var i=t.getObject(r).$Type;var o=this.getEntitySetName(t.getModel(),i);if(o){r="/".concat(o)}}else{return r}if(a){return t.getObject("".concat(r,"/").concat(n,"@Org.OData.Core.V1.OperationAvailable"))}if(e){return"".concat(r,"/").concat(n)}else{return{sContextPath:r,sProperty:t.getObject("".concat(r,"/").concat(n,"@Org.OData.Core.V1.OperationAvailable/$Path")),sBindingParameter:t.getObject("".concat(r,"/").concat(n,"/@$ui5.overload/0/$Parameter/0/$Name"))}}},getNavigationContext:function(t){return s.getNavigationPath(t.getPath())},getNavigationPath:function(t,e){var n=t.startsWith("/");var a=t.split("/").filter(function(t){return!!t});if(n){a.shift()}if(!e){a.pop()}return a.join("/")},getActionContext:function(t){return v.getActionPath(t,true)},getPathToBoundActionOverload:function(t){var e=v.getActionPath(t,true);return"".concat(e,"/@$ui5.overload/0")},addSingleQuotes:function(t,e){if(e&&t){t=this.escapeSingleQuotes(t)}return"'".concat(t,"'")},escapeSingleQuotes:function(t){return t.replace(/[']/g,"\\'")},generateFunction:function(t){var e="";for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n++){e+=n+1<1||arguments.length<=n+1?undefined:arguments[n+1];if(n<(arguments.length<=1?0:arguments.length-1)-1){e+=", "}}var a="".concat(t,"()");if(e){a="".concat(t,"(").concat(e,")")}return a},getHeaderDataPointLinkVisibility:function(t,e,n){var a;if(n){a=e?"{= ${internal>isHeaderDPLinkVisible/"+t+"} === true && "+n+"}":"{= ${internal>isHeaderDPLinkVisible/"+t+"} !== true && "+n+"}"}else{a=e?"{= ${internal>isHeaderDPLinkVisible/"+t+"} === true}":"{= ${internal>isHeaderDPLinkVisible/"+t+"} !== true}"}return a},objectToString:function(t){var e=Object.keys(t).length,n="";for(var a in t){var r=t[a];if(r&&typeof r==="object"){r=this.objectToString(r)}n+="".concat(a,": ").concat(r);if(e>1){--e;n+=", "}}return"{ ".concat(n,"}")},removeEscapeCharacters:function(t){return t?t.replace(/\\?\\([{}])/g,"$1"):undefined},stringifyObject:function(e){if(!e){return undefined}else{var n=JSON.parse(e);if(typeof n==="object"&&!Array.isArray(n)){var a={ui5object:true};Object.assign(a,n);return JSON.stringify(a)}else{var r=Array.isArray(n)?"Array":typeof n;t.error("Unexpected object type in stringifyObject (".concat(r,") - only works with object"));throw new Error("stringifyObject only works with objects!")}}},stringifyCustomData:function(t){var e={ui5object:true};e["customData"]=t instanceof c?t.getObject():t;return JSON.stringify(e)},parseCustomData:function(t){t=typeof t==="string"?JSON.parse(t):t;if(t&&t.hasOwnProperty("customData")){return t["customData"]}return t},_getDraftAdministrativeDataType:function(t,e){return t.requestObject("/".concat(e,"/DraftAdministrativeData/"))},getPopoverText:function(t,e){return v._getDraftAdministrativeDataType(t.getModel(),e).then(function(t){var e="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(t.InProcessByUserDescription){e+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}"}if(t.LastChangedByUserDescription){e+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}"}e+="], formatter: 'sap.fe.macros.field.FieldRuntime.formatDraftOwnerTextInPopover'}";return e})},getContextPath:function(t,e){var n=e&&e.context&&e.context.getPath();return n[n.length-1]==="/"?n.slice(0,-1):n},getSortConditions:function(t,e,n){if(e&&v._isPresentationVariantAnnotation(n)&&e.SortOrder){var a={sorters:[]};var r=t.getPath(0).split("@")[0];e.SortOrder.forEach(function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={};var i={};if(e.DynamicProperty){var o;n=(o=t.getModel(0).getObject(r+e.DynamicProperty.$AnnotationPath))===null||o===void 0?void 0:o.Name}else if(e.Property){n=e.Property.$PropertyPath}if(n){i.name=n;i.descending=!!e.Descending;a.sorters.push(i)}else{throw new Error("Please define the right path to the sort property")}});return JSON.stringify(a)}return undefined},_isPresentationVariantAnnotation:function(t){return t.indexOf("@com.sap.vocabularies.UI.v1.PresentationVariant")>-1||t.indexOf("@com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1},createPresentationPathContext:function(t){var e=t.sPath.split("@")||[];var n=t.getModel();if(e.length&&e[e.length-1].indexOf("com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1){var a=t.sPath.split("/PresentationVariant")[0];return n.createBindingContext("".concat(a,"@sapui.name"))}return n.createBindingContext("".concat(t.sPath,"@sapui.name"))},getPressHandlerForDataFieldForIBN:function(t,e,n){var a={navigationContexts:e?e:"${$source>/}.getBindingContext()"};if(t.RequiresContext&&!t.Inline&&n){a.applicableContexts="${internal>ibn/"+t.SemanticObject+"-"+t.Action+"/aApplicable/}";a.notApplicableContexts="${internal>ibn/"+t.SemanticObject+"-"+t.Action+"/aNotApplicable/}";a.label=this.addSingleQuotes(t.Label,true)}if(t.Mapping){a.semanticObjectMapping=this.addSingleQuotes(JSON.stringify(t.Mapping))}return this.generateFunction(n?"._intentBasedNavigation.navigateWithConfirmationDialog":"._intentBasedNavigation.navigate",this.addSingleQuotes(t.SemanticObject),this.addSingleQuotes(t.Action),this.objectToString(a))},getEntitySet:function(t){var e=t.getPath();return a.getEntitySetPath(e)},handleVisibilityOfMenuActions:function(t){var e=[];if(Array.isArray(t)){for(var n=0;n<t.length;n++){if(t[n].indexOf("{")>-1&&t[n].indexOf("{=")===-1){t[n]="{="+t[n]+"}"}if(t[n].split("{=").length>0){t[n]=t[n].split("{=")[1].slice(0,-1)}e.push("(".concat(t[n],")"))}}return e.length>0?"{= ".concat(e.join(" || "),"}"):t},getCriticalityCalculationBinding:function(e,n,a,r,i,o,c,s){var u=d.Neutral;n="%".concat(n);a=a||-Infinity;r=r||a;i=i||r;s=s||Infinity;c=c||s;o=o||c;a=a&&(+a?+a:"%".concat(a));r=r&&(+r?+r:"%".concat(r));i=i&&(+i?+i:"%".concat(i));o=o&&(+o?+o:"%".concat(o));c=c&&(+c?+c:"%".concat(c));s=s&&(+s?+s:"%".concat(s));if(e.indexOf("Minimize")>-1){u="{= "+n+" <= "+o+" ? '"+d.Good+"' : "+n+" <= "+c+" ? '"+d.Neutral+"' : "+"("+s+" && "+n+" <= "+s+") ? '"+d.Critical+"' : '"+d.Error+"' }"}else if(e.indexOf("Maximize")>-1){u="{= "+n+" >= "+i+" ? '"+d.Good+"' : "+n+" >= "+r+" ? '"+d.Neutral+"' : "+"("+a+" && "+n+" >= "+a+") ? '"+d.Critical+"' : '"+d.Error+"' }"}else if(e.indexOf("Target")>-1){u="{= ("+n+" <= "+o+" && "+n+" >= "+i+") ? '"+d.Good+"' : "+"(("+n+" >= "+r+" && "+n+" < "+i+") || ("+n+" > "+o+" && "+n+" <= "+c+")) ? '"+d.Neutral+"' : "+"(("+a+" && ("+n+" >= "+a+") && ("+n+" < "+r+")) || (("+n+" > "+c+") && "+s+" && ("+n+" <= "+s+"))) ? '"+d.Critical+"' : '"+d.Error+"' }"}else{t.warning("Case not supported, returning the default Value Neutral")}return u},_getCriticalityFromEnum:function(t){var e;if(t==="com.sap.vocabularies.UI.v1.CriticalityType/Negative"){e=d.Error}else if(t==="com.sap.vocabularies.UI.v1.CriticalityType/Positive"){e=d.Good}else if(t==="com.sap.vocabularies.UI.v1.CriticalityType/Critical"){e=d.Critical}else{e=d.Neutral}return e},getValueCriticality:function(t,e){var n;var a=[];if(e&&e.length>0){e.forEach(function(e){if(e.Value&&e.Criticality.$EnumMember){var n="${"+t+"} === '"+e.Value+"' ? '"+v._getCriticalityFromEnum(e.Criticality.$EnumMember)+"'";a.push(n)}});n=a.length>0&&a.join(" : ")+" : undefined"}return n?"{= "+n+" }":undefined},getMeasureAttributeIndex:function(t,e){var n,a;var r,i;if((e===null||e===void 0?void 0:(n=e.Measures)===null||n===void 0?void 0:n.length)>0){r=e.Measures;i=r[t].$PropertyPath}else if((e===null||e===void 0?void 0:(a=e.DynamicMeasures)===null||a===void 0?void 0:a.length)>0){r=e.DynamicMeasures;i=r[t].$AnnotationPath}var o;var c=e.MeasureAttributes;var s=-1;var u=function(t,e,n){if(e){if(e.Measure&&e.Measure.$PropertyPath===t){s=n;return true}else if(e.DynamicMeasure&&e.DynamicMeasure.$AnnotationPath===t){s=n;return true}}};if(c){o=c.some(u.bind(null,i))}return o&&s>-1&&s},getMeasureAttribute:function(e){var n=e.getModel(),a=e.getPath();return n.requestObject(a).then(function(e){var n=e.MeasureAttributes,r=v.getMeasureAttributeIndex(0,e);var i=r>-1&&n[r]&&n[r].DataPoint?"".concat(a,"MeasureAttributes/").concat(r,"/"):undefined;if(i===undefined){t.warning("DataPoint missing for the measure")}return i?"".concat(i,"DataPoint/$AnnotationPath/"):i})},getMeasureAttributeForMeasure:function(e){var n=e.getModel(),a=e.getPath(),r=a.substring(0,a.lastIndexOf("Measure")),i=a.replace(/.*\//,"");return n.requestObject(r).then(function(e){var n=e.MeasureAttributes,a=v.getMeasureAttributeIndex(i,e);var o=a>-1&&n[a]&&n[a].DataPoint?"".concat(r,"MeasureAttributes/").concat(a,"/"):undefined;if(o===undefined){t.warning("DataPoint missing for the measure")}return o?"".concat(o,"DataPoint/$AnnotationPath/"):o})},isDraftParentEntityForContainment:function(t,e){if(t){if(e&&e.parentEntitySet&&e.parentEntitySet.sPath){var n=e.parentEntitySet.sPath;var a=e.parentEntitySet.oModel.getObject("".concat(n,"@com.sap.vocabularies.Common.v1.DraftRoot"));var r=e.parentEntitySet.oModel.getObject("".concat(n,"@com.sap.vocabularies.Common.v1.DraftNode"));if(a||r){return true}else{return false}}}else{return false}},getDataFromTemplate:function(t){var e=t.getPath().split("/");var n=e[e.length-1];var a="/".concat(e.slice(1,-2).join("/"),"/@");var r=t.getObject(a);var i=r.Template;var o=i.split("}");var c=[];for(var s=0;s<o.length-1;s++){var u=o[s].split("{")[1].trim();c.push(u)}Object.keys(r.Data).forEach(function(t){if(t.startsWith("$")){delete r.Data[t]}});var l=Object.keys(r.Data).indexOf(n);return"/".concat(e.slice(1,-2).join("/"),"/Data/").concat(c[l])},notLastIndex:function(t,e){var n=t.Template;var a=n.split("}");var r=[];var i=false;for(var o=0;o<a.length-1;o++){var c=a[o].split("{")[1].trim();r.push(c)}r.forEach(function(n){if(t.Data[n]===e&&r.indexOf(n)!==r.length-1){i=true}});return i},getDelimiter:function(t){return t.split("}")[1].split("{")[0].trim()},oMetaModel:undefined,setMetaModel:function(t){this.oMetaModel=t},getMetaModel:function(t,e){if(t){return e.context.getModel()}return this.oMetaModel},getParameters:function(t,n){if(t){var a=n.context.getModel();var r=n.context.getPath();var i=e.getParameterInfo(a,r);if(i.parameterProperties){return Object.keys(i.parameterProperties)}}return[]},buildActionWrapper:function(t,e){var n=[l("$event"),t.handlerModule,t.handlerMethod];if(e&&e.id){var a={contexts:l("${internal>selectedContexts}")};n.push(a)}return g(f("FPM.actionWrapper",n))},getHiddenPathExpression:function(t){if(t["@com.sap.vocabularies.UI.v1.Hidden"]!==null){var e=t["@com.sap.vocabularies.UI.v1.Hidden"];return typeof e==="object"?"{= !${"+e.$Path+"} }":!e}return true}};v.isPropertyFilterable.requiresIContext=true;v.getPopoverText.requiresIContext=true;v.getSortConditions.requiresIContext=true;return v},false);
//# sourceMappingURL=CommonHelper.js.map
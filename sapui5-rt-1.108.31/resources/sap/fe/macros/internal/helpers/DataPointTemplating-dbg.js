/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/formatters/ValueFormatter", "sap/fe/core/helpers/BindingToolkit", "sap/fe/core/templating/DataModelPathHelper", "sap/fe/core/templating/PropertyHelper", "sap/fe/core/templating/UIFormatters", "sap/ui/model/odata/v4/AnnotationHelper"], function (valueFormatters, BindingToolkit, DataModelPathHelper, PropertyHelper, UIFormatters, AnnotationHelper) {
  "use strict";

  var _exports = {};
  var getDisplayMode = UIFormatters.getDisplayMode;
  var getBindingWithUnitOrCurrency = UIFormatters.getBindingWithUnitOrCurrency;
  var getBindingWithTimezone = UIFormatters.getBindingWithTimezone;
  var formatWithTypeInformation = UIFormatters.formatWithTypeInformation;
  var EDM_TYPE_MAPPING = UIFormatters.EDM_TYPE_MAPPING;
  var isProperty = PropertyHelper.isProperty;
  var hasStaticPercentUnit = PropertyHelper.hasStaticPercentUnit;
  var getRelativePaths = DataModelPathHelper.getRelativePaths;
  var enhanceDataModelPath = DataModelPathHelper.enhanceDataModelPath;
  var unresolveableExpression = BindingToolkit.unresolveableExpression;
  var isPathInModelExpression = BindingToolkit.isPathInModelExpression;
  var getExpressionFromAnnotation = BindingToolkit.getExpressionFromAnnotation;
  var formatResult = BindingToolkit.formatResult;
  var compileExpression = BindingToolkit.compileExpression;
  var typesSupportingNumberOfFractionalDigits = ["Edm.Single", "Edm.Double", "Edm.Decimal"];
  var getDataPointTargetExpression = function (oDataModelPath) {
    return oDataModelPath !== null && oDataModelPath !== void 0 && oDataModelPath.TargetValue ? getExpressionFromAnnotation(oDataModelPath.TargetValue) : unresolveableExpression;
  };
  var oResourceModel = sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");
  var buildExpressionForProgressIndicatorDisplayValue = function (oPropertyDataModelObjectPath) {
    var _oPropertyDataModelOb;
    var fieldValue = (oPropertyDataModelObjectPath === null || oPropertyDataModelObjectPath === void 0 ? void 0 : (_oPropertyDataModelOb = oPropertyDataModelObjectPath.targetObject) === null || _oPropertyDataModelOb === void 0 ? void 0 : _oPropertyDataModelOb.Value) || "";
    var relativeLocation = getRelativePaths(oPropertyDataModelObjectPath);
    var fieldValueExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    var TargetExpression = getDataPointTargetExpression(oPropertyDataModelObjectPath.targetObject);
    if (fieldValueExpression && TargetExpression) {
      var _targetObject$annotat, _targetObject$annotat2, _targetObject$annotat3, _targetObject$annotat4;
      var targetObject = oPropertyDataModelObjectPath.targetObject.Value;
      if (!isProperty(targetObject)) {
        targetObject = oPropertyDataModelObjectPath.targetObject.Value.$target;
      }
      var unit = ((_targetObject$annotat = targetObject.annotations) === null || _targetObject$annotat === void 0 ? void 0 : (_targetObject$annotat2 = _targetObject$annotat.Measures) === null || _targetObject$annotat2 === void 0 ? void 0 : _targetObject$annotat2.Unit) || ((_targetObject$annotat3 = targetObject.annotations) === null || _targetObject$annotat3 === void 0 ? void 0 : (_targetObject$annotat4 = _targetObject$annotat3.Measures) === null || _targetObject$annotat4 === void 0 ? void 0 : _targetObject$annotat4.ISOCurrency);
      if (!unit) {
        return oResourceModel.getText("T_COMMON_PROGRESS_INDICATOR_DISPLAY_VALUE_NO_UOM", [compileExpression(fieldValueExpression), compileExpression(TargetExpression)]);
      }
      // If the unit isn't a path, we check for a % sign as it is a special case.
      if (hasStaticPercentUnit(fieldValue === null || fieldValue === void 0 ? void 0 : fieldValue.$target)) {
        return "".concat(compileExpression(fieldValueExpression), " %");
      }
      fieldValueExpression = formatWithTypeInformation(targetObject, fieldValueExpression);
      var unitBindingExpression = unit.$target ? formatWithTypeInformation(unit.$target, getExpressionFromAnnotation(unit, relativeLocation)) : getExpressionFromAnnotation(unit, relativeLocation);
      return compileExpression(formatResult([fieldValueExpression, TargetExpression, unitBindingExpression], valueFormatters.formatProgressIndicatorText));
    }
    return undefined;
  };
  _exports.buildExpressionForProgressIndicatorDisplayValue = buildExpressionForProgressIndicatorDisplayValue;
  var buildUnitBindingExpression = function (dataPoint) {
    var _dataPoint$targetObje, _dataPoint$targetObje2, _targetObject$annotat5, _targetObject$annotat6, _targetObject$annotat7, _targetObject$annotat8;
    var relativeLocation = getRelativePaths(dataPoint);
    var targetObject = dataPoint === null || dataPoint === void 0 ? void 0 : (_dataPoint$targetObje = dataPoint.targetObject) === null || _dataPoint$targetObje === void 0 ? void 0 : (_dataPoint$targetObje2 = _dataPoint$targetObje.Value) === null || _dataPoint$targetObje2 === void 0 ? void 0 : _dataPoint$targetObje2.$target;
    if (!isProperty(targetObject)) {
      return "";
    }
    var unit = ((_targetObject$annotat5 = targetObject.annotations) === null || _targetObject$annotat5 === void 0 ? void 0 : (_targetObject$annotat6 = _targetObject$annotat5.Measures) === null || _targetObject$annotat6 === void 0 ? void 0 : _targetObject$annotat6.Unit) || ((_targetObject$annotat7 = targetObject.annotations) === null || _targetObject$annotat7 === void 0 ? void 0 : (_targetObject$annotat8 = _targetObject$annotat7.Measures) === null || _targetObject$annotat8 === void 0 ? void 0 : _targetObject$annotat8.ISOCurrency);
    return unit ? compileExpression(getExpressionFromAnnotation(unit, relativeLocation)) : "";
  };
  _exports.buildUnitBindingExpression = buildUnitBindingExpression;
  var buildRatingIndicatorSubtitleExpression = function (oContext, mSampleSize) {
    if (mSampleSize) {
      return formatRatingIndicatorSubTitle(AnnotationHelper.value(mSampleSize, {
        context: oContext
      }));
    }
  };
  // returns the text for the Rating Indicator Subtitle (e.g. '7 reviews')
  var formatRatingIndicatorSubTitle = function (iSampleSizeValue) {
    if (iSampleSizeValue) {
      var sSubTitleLabel = iSampleSizeValue > 1 ? oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL_PLURAL") : oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE_LABEL");
      return oResourceModel.getText("T_ANNOTATION_HELPER_RATING_INDICATOR_SUBTITLE", [String(iSampleSizeValue), sSubTitleLabel]);
    }
  };

  /**
   * This function is used to get the header text of rating indicator.
   *
   * @param oContext
   * @param oDataPoint
   * @function param {object} oContext context of interface
   * param {object} oDataPoint data point object
   * @returns Expression binding for rating indicator text
   */
  var getHeaderRatingIndicatorText = function (oContext, oDataPoint) {
    if (oDataPoint && oDataPoint.SampleSize) {
      return buildRatingIndicatorSubtitleExpression(oContext, oDataPoint.SampleSize);
    } else if (oDataPoint && oDataPoint.Description) {
      var sModelValue = AnnotationHelper.value(oDataPoint.Description, {
        context: oContext
      });
      return "${path:" + sModelValue + "}";
    }
  };
  getHeaderRatingIndicatorText.requiresIContext = true;
  _exports.getHeaderRatingIndicatorText = getHeaderRatingIndicatorText;
  var buildExpressionForDescription = function (fieldValue) {
    var _fieldValue$targetObj, _fieldValue$targetObj2, _fieldValue$targetObj3;
    var relativeLocation = getRelativePaths(fieldValue);
    if (fieldValue !== null && fieldValue !== void 0 && (_fieldValue$targetObj = fieldValue.targetObject) !== null && _fieldValue$targetObj !== void 0 && (_fieldValue$targetObj2 = _fieldValue$targetObj.annotations) !== null && _fieldValue$targetObj2 !== void 0 && (_fieldValue$targetObj3 = _fieldValue$targetObj2.Common) !== null && _fieldValue$targetObj3 !== void 0 && _fieldValue$targetObj3.Text) {
      var _fieldValue$targetObj4, _fieldValue$targetObj5;
      var oTextExpression = getExpressionFromAnnotation(fieldValue === null || fieldValue === void 0 ? void 0 : (_fieldValue$targetObj4 = fieldValue.targetObject.annotations) === null || _fieldValue$targetObj4 === void 0 ? void 0 : (_fieldValue$targetObj5 = _fieldValue$targetObj4.Common) === null || _fieldValue$targetObj5 === void 0 ? void 0 : _fieldValue$targetObj5.Text, relativeLocation);
      if (isPathInModelExpression(oTextExpression)) {
        oTextExpression.parameters = {
          "$$noPatch": true
        };
      }
      return oTextExpression;
    }
    return undefined;
  };
  var getFloatFormat = function (outExpression, fieldValue, numberOfFractionalDigits) {
    // numberOfFractionalDigits is only defined in getValueFormatted when NumberOfFractionalDigits is defined.
    // In that case, we need to instance the preserveDecimals parameter because of a change MDC side
    if (numberOfFractionalDigits) {
      if (!outExpression.formatOptions) {
        outExpression.formatOptions = {};
      }
      outExpression.formatOptions = Object.assign(outExpression.formatOptions, {
        preserveDecimals: false,
        maxFractionDigits: numberOfFractionalDigits
      });
    }
    return outExpression;
  };
  var getValueFormatted = function (oPropertyDataModelPath, fieldValue, sPropertyType, sNumberOfFractionalDigits) {
    var _fieldValue$path;
    var outExpression;
    var relativeLocation = (fieldValue === null || fieldValue === void 0 ? void 0 : (_fieldValue$path = fieldValue.path) === null || _fieldValue$path === void 0 ? void 0 : _fieldValue$path.indexOf("/")) === -1 ? getRelativePaths(oPropertyDataModelPath) : [];
    outExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    var oPropertyDefinition = oPropertyDataModelPath.targetObject;
    if (sPropertyType && isPathInModelExpression(outExpression)) {
      var _EDM_TYPE_MAPPING$sPr;
      formatWithTypeInformation(oPropertyDefinition, outExpression);
      outExpression.type = (_EDM_TYPE_MAPPING$sPr = EDM_TYPE_MAPPING[sPropertyType]) === null || _EDM_TYPE_MAPPING$sPr === void 0 ? void 0 : _EDM_TYPE_MAPPING$sPr.type;
      if (typesSupportingNumberOfFractionalDigits.includes(sPropertyType)) {
        // for the listReport, the decimal/single/double fields are formatted by returning a string
        // for the facets of the OP, the decimal/single/double fields are formatted by returning a promise, so we manage all the cases
        outExpression = getFloatFormat(outExpression, fieldValue, sNumberOfFractionalDigits);
      }
    }
    return outExpression;
  };
  var buildFieldBindingExpression = function (oDataModelPath, dataPointFormatOptions, bHideMeasure) {
    var _oDataPointValue$$tar, _oPropertyDataModelOb2, _oPropertyDataModelOb3, _oPropertyDataModelOb4;
    var oDataPoint = oDataModelPath.targetObject;
    var oDataPointValue = (oDataPoint === null || oDataPoint === void 0 ? void 0 : oDataPoint.Value) || "";
    var propertyType = oDataPointValue === null || oDataPointValue === void 0 ? void 0 : (_oDataPointValue$$tar = oDataPointValue.$target) === null || _oDataPointValue$$tar === void 0 ? void 0 : _oDataPointValue$$tar.type;
    var numberOfFractionalDigits;
    if (typesSupportingNumberOfFractionalDigits.includes(propertyType) && oDataPoint.ValueFormat) {
      if (oDataPoint.ValueFormat.NumberOfFractionalDigits) {
        numberOfFractionalDigits = oDataPoint.ValueFormat.NumberOfFractionalDigits;
      }
    }
    var oPropertyDataModelObjectPath = enhanceDataModelPath(oDataModelPath, oDataPointValue.path);
    var oDescription = oPropertyDataModelObjectPath ? buildExpressionForDescription(oPropertyDataModelObjectPath) : undefined;
    var oFormattedValue = getValueFormatted(oPropertyDataModelObjectPath, oDataPointValue, propertyType, numberOfFractionalDigits);
    var sDisplayMode = oDescription ? dataPointFormatOptions.displayMode || getDisplayMode(oPropertyDataModelObjectPath) : "Value";
    var oBindingExpression;
    switch (sDisplayMode) {
      case "Description":
        oBindingExpression = oDescription;
        break;
      case "ValueDescription":
        oBindingExpression = formatResult([oFormattedValue, oDescription], valueFormatters.formatWithBrackets);
        break;
      case "DescriptionValue":
        oBindingExpression = formatResult([oDescription, oFormattedValue], valueFormatters.formatWithBrackets);
        break;
      default:
        if ((_oPropertyDataModelOb2 = oPropertyDataModelObjectPath.targetObject) !== null && _oPropertyDataModelOb2 !== void 0 && (_oPropertyDataModelOb3 = _oPropertyDataModelOb2.annotations) !== null && _oPropertyDataModelOb3 !== void 0 && (_oPropertyDataModelOb4 = _oPropertyDataModelOb3.Common) !== null && _oPropertyDataModelOb4 !== void 0 && _oPropertyDataModelOb4.Timezone) {
          oBindingExpression = getBindingWithTimezone(oPropertyDataModelObjectPath, oFormattedValue);
        } else {
          oBindingExpression = _computeBindingWithUnitOrCurrency(oPropertyDataModelObjectPath, oFormattedValue, bHideMeasure || (dataPointFormatOptions === null || dataPointFormatOptions === void 0 ? void 0 : dataPointFormatOptions.measureDisplayMode) === "Hidden");
        }
    }
    return compileExpression(oBindingExpression);
  };
  _exports.buildFieldBindingExpression = buildFieldBindingExpression;
  var _computeBindingWithUnitOrCurrency = function (propertyDataModelObjectPath, formattedValue, hideMeasure) {
    var _propertyDataModelObj, _propertyDataModelObj2, _propertyDataModelObj3, _propertyDataModelObj4, _propertyDataModelObj5, _propertyDataModelObj6;
    if ((_propertyDataModelObj = propertyDataModelObjectPath.targetObject) !== null && _propertyDataModelObj !== void 0 && (_propertyDataModelObj2 = _propertyDataModelObj.annotations) !== null && _propertyDataModelObj2 !== void 0 && (_propertyDataModelObj3 = _propertyDataModelObj2.Measures) !== null && _propertyDataModelObj3 !== void 0 && _propertyDataModelObj3.Unit || (_propertyDataModelObj4 = propertyDataModelObjectPath.targetObject) !== null && _propertyDataModelObj4 !== void 0 && (_propertyDataModelObj5 = _propertyDataModelObj4.annotations) !== null && _propertyDataModelObj5 !== void 0 && (_propertyDataModelObj6 = _propertyDataModelObj5.Measures) !== null && _propertyDataModelObj6 !== void 0 && _propertyDataModelObj6.ISOCurrency) {
      if (hideMeasure && hasStaticPercentUnit(propertyDataModelObjectPath.targetObject)) {
        return formattedValue;
      }
      return getBindingWithUnitOrCurrency(propertyDataModelObjectPath, formattedValue, undefined, hideMeasure ? {
        showMeasure: false
      } : undefined);
    }
    return formattedValue;
  };

  /**
   * Method to calculate the percentage value of Progress Indicator. Basic formula is Value/Target * 100.
   *
   * @param oPropertyDataModelObjectPath
   * @returns The expression binding used to calculate the percentage value, which is shown in the progress indicator based on the formula given above.
   */
  _exports._computeBindingWithUnitOrCurrency = _computeBindingWithUnitOrCurrency;
  var buildExpressionForProgressIndicatorPercentValue = function (oPropertyDataModelObjectPath) {
    var _oPropertyDataModelOb5, _oPropertyDefinition$, _oPropertyDefinition$2, _oPropertyDefinition$3, _oPropertyDefinition$4;
    var fieldValue = (oPropertyDataModelObjectPath === null || oPropertyDataModelObjectPath === void 0 ? void 0 : (_oPropertyDataModelOb5 = oPropertyDataModelObjectPath.targetObject) === null || _oPropertyDataModelOb5 === void 0 ? void 0 : _oPropertyDataModelOb5.Value) || "";
    var relativeLocation = getRelativePaths(oPropertyDataModelObjectPath);
    var fieldValueExpression = getExpressionFromAnnotation(fieldValue, relativeLocation);
    var TargetExpression = getDataPointTargetExpression(oPropertyDataModelObjectPath.targetObject);
    var oPropertyDefinition = fieldValue.$target;
    var unit = ((_oPropertyDefinition$ = oPropertyDefinition.annotations) === null || _oPropertyDefinition$ === void 0 ? void 0 : (_oPropertyDefinition$2 = _oPropertyDefinition$.Measures) === null || _oPropertyDefinition$2 === void 0 ? void 0 : _oPropertyDefinition$2.Unit) || ((_oPropertyDefinition$3 = oPropertyDefinition.annotations) === null || _oPropertyDefinition$3 === void 0 ? void 0 : (_oPropertyDefinition$4 = _oPropertyDefinition$3.Measures) === null || _oPropertyDefinition$4 === void 0 ? void 0 : _oPropertyDefinition$4.ISOCurrency);
    if (unit) {
      var unitBindingExpression = unit.$target ? formatWithTypeInformation(unit.$target, getExpressionFromAnnotation(unit, relativeLocation)) : getExpressionFromAnnotation(unit, relativeLocation);
      return compileExpression(formatResult([fieldValueExpression, TargetExpression, unitBindingExpression], valueFormatters.computePercentage));
    }
    return compileExpression(formatResult([fieldValueExpression, TargetExpression, ""], valueFormatters.computePercentage));
  };
  _exports.buildExpressionForProgressIndicatorPercentValue = buildExpressionForProgressIndicatorPercentValue;
  return _exports;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0eXBlc1N1cHBvcnRpbmdOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMiLCJnZXREYXRhUG9pbnRUYXJnZXRFeHByZXNzaW9uIiwib0RhdGFNb2RlbFBhdGgiLCJUYXJnZXRWYWx1ZSIsImdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbiIsInVucmVzb2x2ZWFibGVFeHByZXNzaW9uIiwib1Jlc291cmNlTW9kZWwiLCJzYXAiLCJ1aSIsImdldENvcmUiLCJnZXRMaWJyYXJ5UmVzb3VyY2VCdW5kbGUiLCJidWlsZEV4cHJlc3Npb25Gb3JQcm9ncmVzc0luZGljYXRvckRpc3BsYXlWYWx1ZSIsIm9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgiLCJmaWVsZFZhbHVlIiwidGFyZ2V0T2JqZWN0IiwiVmFsdWUiLCJyZWxhdGl2ZUxvY2F0aW9uIiwiZ2V0UmVsYXRpdmVQYXRocyIsImZpZWxkVmFsdWVFeHByZXNzaW9uIiwiVGFyZ2V0RXhwcmVzc2lvbiIsImlzUHJvcGVydHkiLCIkdGFyZ2V0IiwidW5pdCIsImFubm90YXRpb25zIiwiTWVhc3VyZXMiLCJVbml0IiwiSVNPQ3VycmVuY3kiLCJnZXRUZXh0IiwiY29tcGlsZUV4cHJlc3Npb24iLCJoYXNTdGF0aWNQZXJjZW50VW5pdCIsImZvcm1hdFdpdGhUeXBlSW5mb3JtYXRpb24iLCJ1bml0QmluZGluZ0V4cHJlc3Npb24iLCJmb3JtYXRSZXN1bHQiLCJ2YWx1ZUZvcm1hdHRlcnMiLCJmb3JtYXRQcm9ncmVzc0luZGljYXRvclRleHQiLCJ1bmRlZmluZWQiLCJidWlsZFVuaXRCaW5kaW5nRXhwcmVzc2lvbiIsImRhdGFQb2ludCIsImJ1aWxkUmF0aW5nSW5kaWNhdG9yU3VidGl0bGVFeHByZXNzaW9uIiwib0NvbnRleHQiLCJtU2FtcGxlU2l6ZSIsImZvcm1hdFJhdGluZ0luZGljYXRvclN1YlRpdGxlIiwiQW5ub3RhdGlvbkhlbHBlciIsInZhbHVlIiwiY29udGV4dCIsImlTYW1wbGVTaXplVmFsdWUiLCJzU3ViVGl0bGVMYWJlbCIsIlN0cmluZyIsImdldEhlYWRlclJhdGluZ0luZGljYXRvclRleHQiLCJvRGF0YVBvaW50IiwiU2FtcGxlU2l6ZSIsIkRlc2NyaXB0aW9uIiwic01vZGVsVmFsdWUiLCJyZXF1aXJlc0lDb250ZXh0IiwiYnVpbGRFeHByZXNzaW9uRm9yRGVzY3JpcHRpb24iLCJDb21tb24iLCJUZXh0Iiwib1RleHRFeHByZXNzaW9uIiwiaXNQYXRoSW5Nb2RlbEV4cHJlc3Npb24iLCJwYXJhbWV0ZXJzIiwiZ2V0RmxvYXRGb3JtYXQiLCJvdXRFeHByZXNzaW9uIiwibnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzIiwiZm9ybWF0T3B0aW9ucyIsIk9iamVjdCIsImFzc2lnbiIsInByZXNlcnZlRGVjaW1hbHMiLCJtYXhGcmFjdGlvbkRpZ2l0cyIsImdldFZhbHVlRm9ybWF0dGVkIiwib1Byb3BlcnR5RGF0YU1vZGVsUGF0aCIsInNQcm9wZXJ0eVR5cGUiLCJzTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzIiwicGF0aCIsImluZGV4T2YiLCJvUHJvcGVydHlEZWZpbml0aW9uIiwidHlwZSIsIkVETV9UWVBFX01BUFBJTkciLCJpbmNsdWRlcyIsImJ1aWxkRmllbGRCaW5kaW5nRXhwcmVzc2lvbiIsImRhdGFQb2ludEZvcm1hdE9wdGlvbnMiLCJiSGlkZU1lYXN1cmUiLCJvRGF0YVBvaW50VmFsdWUiLCJwcm9wZXJ0eVR5cGUiLCJWYWx1ZUZvcm1hdCIsIk51bWJlck9mRnJhY3Rpb25hbERpZ2l0cyIsImVuaGFuY2VEYXRhTW9kZWxQYXRoIiwib0Rlc2NyaXB0aW9uIiwib0Zvcm1hdHRlZFZhbHVlIiwic0Rpc3BsYXlNb2RlIiwiZGlzcGxheU1vZGUiLCJnZXREaXNwbGF5TW9kZSIsIm9CaW5kaW5nRXhwcmVzc2lvbiIsImZvcm1hdFdpdGhCcmFja2V0cyIsIlRpbWV6b25lIiwiZ2V0QmluZGluZ1dpdGhUaW1lem9uZSIsIl9jb21wdXRlQmluZGluZ1dpdGhVbml0T3JDdXJyZW5jeSIsIm1lYXN1cmVEaXNwbGF5TW9kZSIsInByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCIsImZvcm1hdHRlZFZhbHVlIiwiaGlkZU1lYXN1cmUiLCJnZXRCaW5kaW5nV2l0aFVuaXRPckN1cnJlbmN5Iiwic2hvd01lYXN1cmUiLCJidWlsZEV4cHJlc3Npb25Gb3JQcm9ncmVzc0luZGljYXRvclBlcmNlbnRWYWx1ZSIsImNvbXB1dGVQZXJjZW50YWdlIl0sInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyJEYXRhUG9pbnRUZW1wbGF0aW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUHJvcGVydHkgfSBmcm9tIFwiQHNhcC11eC92b2NhYnVsYXJpZXMtdHlwZXNcIjtcbmltcG9ydCB2YWx1ZUZvcm1hdHRlcnMgZnJvbSBcInNhcC9mZS9jb3JlL2Zvcm1hdHRlcnMvVmFsdWVGb3JtYXR0ZXJcIjtcbmltcG9ydCB0eXBlIHsgQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uLCBDb21waWxlZEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiwgUGF0aEluTW9kZWxFeHByZXNzaW9uIH0gZnJvbSBcInNhcC9mZS9jb3JlL2hlbHBlcnMvQmluZGluZ1Rvb2xraXRcIjtcbmltcG9ydCB7XG5cdGNvbXBpbGVFeHByZXNzaW9uLFxuXHRmb3JtYXRSZXN1bHQsXG5cdGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbixcblx0aXNQYXRoSW5Nb2RlbEV4cHJlc3Npb24sXG5cdHVucmVzb2x2ZWFibGVFeHByZXNzaW9uXG59IGZyb20gXCJzYXAvZmUvY29yZS9oZWxwZXJzL0JpbmRpbmdUb29sa2l0XCI7XG5pbXBvcnQgdHlwZSB7IERhdGFNb2RlbE9iamVjdFBhdGggfSBmcm9tIFwic2FwL2ZlL2NvcmUvdGVtcGxhdGluZy9EYXRhTW9kZWxQYXRoSGVscGVyXCI7XG5pbXBvcnQgeyBlbmhhbmNlRGF0YU1vZGVsUGF0aCwgZ2V0UmVsYXRpdmVQYXRocyB9IGZyb20gXCJzYXAvZmUvY29yZS90ZW1wbGF0aW5nL0RhdGFNb2RlbFBhdGhIZWxwZXJcIjtcbmltcG9ydCB7IGhhc1N0YXRpY1BlcmNlbnRVbml0LCBpc1Byb3BlcnR5IH0gZnJvbSBcInNhcC9mZS9jb3JlL3RlbXBsYXRpbmcvUHJvcGVydHlIZWxwZXJcIjtcbmltcG9ydCB7XG5cdEVETV9UWVBFX01BUFBJTkcsXG5cdGZvcm1hdFdpdGhUeXBlSW5mb3JtYXRpb24sXG5cdGdldEJpbmRpbmdXaXRoVGltZXpvbmUsXG5cdGdldEJpbmRpbmdXaXRoVW5pdE9yQ3VycmVuY3ksXG5cdGdldERpc3BsYXlNb2RlXG59IGZyb20gXCJzYXAvZmUvY29yZS90ZW1wbGF0aW5nL1VJRm9ybWF0dGVyc1wiO1xuaW1wb3J0IEFubm90YXRpb25IZWxwZXIgZnJvbSBcInNhcC91aS9tb2RlbC9vZGF0YS92NC9Bbm5vdGF0aW9uSGVscGVyXCI7XG5cbmNvbnN0IHR5cGVzU3VwcG9ydGluZ051bWJlck9mRnJhY3Rpb25hbERpZ2l0cyA9IFtcIkVkbS5TaW5nbGVcIiwgXCJFZG0uRG91YmxlXCIsIFwiRWRtLkRlY2ltYWxcIl07XG5cbmV4cG9ydCB0eXBlIERhdGFQb2ludEZvcm1hdE9wdGlvbnMgPSBQYXJ0aWFsPHtcblx0bWVhc3VyZURpc3BsYXlNb2RlOiBzdHJpbmc7XG5cdGRpc3BsYXlNb2RlOiBzdHJpbmc7XG59PjtcblxuY29uc3QgZ2V0RGF0YVBvaW50VGFyZ2V0RXhwcmVzc2lvbiA9IChvRGF0YU1vZGVsUGF0aDogYW55KTogQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPHN0cmluZz4gPT4ge1xuXHRyZXR1cm4gb0RhdGFNb2RlbFBhdGg/LlRhcmdldFZhbHVlID8gZ2V0RXhwcmVzc2lvbkZyb21Bbm5vdGF0aW9uKG9EYXRhTW9kZWxQYXRoLlRhcmdldFZhbHVlKSA6IHVucmVzb2x2ZWFibGVFeHByZXNzaW9uO1xufTtcblxuY29uc3Qgb1Jlc291cmNlTW9kZWwgPSBzYXAudWkuZ2V0Q29yZSgpLmdldExpYnJhcnlSZXNvdXJjZUJ1bmRsZShcInNhcC5mZS5tYWNyb3NcIik7XG5cbmV4cG9ydCBjb25zdCBidWlsZEV4cHJlc3Npb25Gb3JQcm9ncmVzc0luZGljYXRvckRpc3BsYXlWYWx1ZSA9IChcblx0b1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aFxuKTogQ29tcGlsZWRCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb24gPT4ge1xuXHRjb25zdCBmaWVsZFZhbHVlID0gb1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aD8udGFyZ2V0T2JqZWN0Py5WYWx1ZSB8fCBcIlwiO1xuXHRjb25zdCByZWxhdGl2ZUxvY2F0aW9uID0gZ2V0UmVsYXRpdmVQYXRocyhvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoKTtcblx0bGV0IGZpZWxkVmFsdWVFeHByZXNzaW9uID0gZ2V0RXhwcmVzc2lvbkZyb21Bbm5vdGF0aW9uKGZpZWxkVmFsdWUsIHJlbGF0aXZlTG9jYXRpb24pIGFzIGFueTtcblx0Y29uc3QgVGFyZ2V0RXhwcmVzc2lvbiA9IGdldERhdGFQb2ludFRhcmdldEV4cHJlc3Npb24ob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QpIGFzIGFueTtcblxuXHRpZiAoZmllbGRWYWx1ZUV4cHJlc3Npb24gJiYgVGFyZ2V0RXhwcmVzc2lvbikge1xuXHRcdGxldCB0YXJnZXRPYmplY3QgPSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLnRhcmdldE9iamVjdC5WYWx1ZTtcblx0XHRpZiAoIWlzUHJvcGVydHkodGFyZ2V0T2JqZWN0KSkge1xuXHRcdFx0dGFyZ2V0T2JqZWN0ID0gb1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QuVmFsdWUuJHRhcmdldDtcblx0XHR9XG5cdFx0Y29uc3QgdW5pdCA9IHRhcmdldE9iamVjdC5hbm5vdGF0aW9ucz8uTWVhc3VyZXM/LlVuaXQgfHwgdGFyZ2V0T2JqZWN0LmFubm90YXRpb25zPy5NZWFzdXJlcz8uSVNPQ3VycmVuY3k7XG5cblx0XHRpZiAoIXVuaXQpIHtcblx0XHRcdHJldHVybiBvUmVzb3VyY2VNb2RlbC5nZXRUZXh0KFwiVF9DT01NT05fUFJPR1JFU1NfSU5ESUNBVE9SX0RJU1BMQVlfVkFMVUVfTk9fVU9NXCIsIFtcblx0XHRcdFx0Y29tcGlsZUV4cHJlc3Npb24oZmllbGRWYWx1ZUV4cHJlc3Npb24pIGFzIHN0cmluZyxcblx0XHRcdFx0Y29tcGlsZUV4cHJlc3Npb24oVGFyZ2V0RXhwcmVzc2lvbikgYXMgc3RyaW5nXG5cdFx0XHRdKTtcblx0XHR9XG5cdFx0Ly8gSWYgdGhlIHVuaXQgaXNuJ3QgYSBwYXRoLCB3ZSBjaGVjayBmb3IgYSAlIHNpZ24gYXMgaXQgaXMgYSBzcGVjaWFsIGNhc2UuXG5cdFx0aWYgKGhhc1N0YXRpY1BlcmNlbnRVbml0KGZpZWxkVmFsdWU/LiR0YXJnZXQpKSB7XG5cdFx0XHRyZXR1cm4gYCR7Y29tcGlsZUV4cHJlc3Npb24oZmllbGRWYWx1ZUV4cHJlc3Npb24pIGFzIHN0cmluZ30gJWA7XG5cdFx0fVxuXG5cdFx0ZmllbGRWYWx1ZUV4cHJlc3Npb24gPSBmb3JtYXRXaXRoVHlwZUluZm9ybWF0aW9uKHRhcmdldE9iamVjdCwgZmllbGRWYWx1ZUV4cHJlc3Npb24pO1xuXHRcdGNvbnN0IHVuaXRCaW5kaW5nRXhwcmVzc2lvbiA9IHVuaXQuJHRhcmdldFxuXHRcdFx0PyBmb3JtYXRXaXRoVHlwZUluZm9ybWF0aW9uKHVuaXQuJHRhcmdldCwgZ2V0RXhwcmVzc2lvbkZyb21Bbm5vdGF0aW9uKHVuaXQsIHJlbGF0aXZlTG9jYXRpb24pKVxuXHRcdFx0OiBnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odW5pdCwgcmVsYXRpdmVMb2NhdGlvbik7XG5cblx0XHRyZXR1cm4gY29tcGlsZUV4cHJlc3Npb24oXG5cdFx0XHRmb3JtYXRSZXN1bHQoW2ZpZWxkVmFsdWVFeHByZXNzaW9uLCBUYXJnZXRFeHByZXNzaW9uLCB1bml0QmluZGluZ0V4cHJlc3Npb25dLCB2YWx1ZUZvcm1hdHRlcnMuZm9ybWF0UHJvZ3Jlc3NJbmRpY2F0b3JUZXh0KVxuXHRcdCk7XG5cdH1cblx0cmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbmV4cG9ydCBjb25zdCBidWlsZFVuaXRCaW5kaW5nRXhwcmVzc2lvbiA9IChkYXRhUG9pbnQ6IERhdGFNb2RlbE9iamVjdFBhdGgpOiBDb21waWxlZEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiA9PiB7XG5cdGNvbnN0IHJlbGF0aXZlTG9jYXRpb24gPSBnZXRSZWxhdGl2ZVBhdGhzKGRhdGFQb2ludCk7XG5cblx0Y29uc3QgdGFyZ2V0T2JqZWN0ID0gZGF0YVBvaW50Py50YXJnZXRPYmplY3Q/LlZhbHVlPy4kdGFyZ2V0O1xuXHRpZiAoIWlzUHJvcGVydHkodGFyZ2V0T2JqZWN0KSkge1xuXHRcdHJldHVybiBcIlwiO1xuXHR9XG5cdGNvbnN0IHVuaXQgPSB0YXJnZXRPYmplY3QuYW5ub3RhdGlvbnM/Lk1lYXN1cmVzPy5Vbml0IHx8IHRhcmdldE9iamVjdC5hbm5vdGF0aW9ucz8uTWVhc3VyZXM/LklTT0N1cnJlbmN5O1xuXHRyZXR1cm4gdW5pdCA/IGNvbXBpbGVFeHByZXNzaW9uKGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbih1bml0LCByZWxhdGl2ZUxvY2F0aW9uKSkgOiBcIlwiO1xufTtcblxuY29uc3QgYnVpbGRSYXRpbmdJbmRpY2F0b3JTdWJ0aXRsZUV4cHJlc3Npb24gPSAob0NvbnRleHQ6IGFueSwgbVNhbXBsZVNpemU6IGFueSk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG5cdGlmIChtU2FtcGxlU2l6ZSkge1xuXHRcdHJldHVybiBmb3JtYXRSYXRpbmdJbmRpY2F0b3JTdWJUaXRsZShBbm5vdGF0aW9uSGVscGVyLnZhbHVlKG1TYW1wbGVTaXplLCB7IGNvbnRleHQ6IG9Db250ZXh0IH0pIGFzIGFueSk7XG5cdH1cbn07XG4vLyByZXR1cm5zIHRoZSB0ZXh0IGZvciB0aGUgUmF0aW5nIEluZGljYXRvciBTdWJ0aXRsZSAoZS5nLiAnNyByZXZpZXdzJylcbmNvbnN0IGZvcm1hdFJhdGluZ0luZGljYXRvclN1YlRpdGxlID0gKGlTYW1wbGVTaXplVmFsdWU6IG51bWJlcik6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG5cdGlmIChpU2FtcGxlU2l6ZVZhbHVlKSB7XG5cdFx0Y29uc3Qgc1N1YlRpdGxlTGFiZWwgPVxuXHRcdFx0aVNhbXBsZVNpemVWYWx1ZSA+IDFcblx0XHRcdFx0PyBvUmVzb3VyY2VNb2RlbC5nZXRUZXh0KFwiVF9BTk5PVEFUSU9OX0hFTFBFUl9SQVRJTkdfSU5ESUNBVE9SX1NVQlRJVExFX0xBQkVMX1BMVVJBTFwiKVxuXHRcdFx0XHQ6IG9SZXNvdXJjZU1vZGVsLmdldFRleHQoXCJUX0FOTk9UQVRJT05fSEVMUEVSX1JBVElOR19JTkRJQ0FUT1JfU1VCVElUTEVfTEFCRUxcIik7XG5cdFx0cmV0dXJuIG9SZXNvdXJjZU1vZGVsLmdldFRleHQoXCJUX0FOTk9UQVRJT05fSEVMUEVSX1JBVElOR19JTkRJQ0FUT1JfU1VCVElUTEVcIiwgW1N0cmluZyhpU2FtcGxlU2l6ZVZhbHVlKSwgc1N1YlRpdGxlTGFiZWxdKTtcblx0fVxufTtcblxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZ2V0IHRoZSBoZWFkZXIgdGV4dCBvZiByYXRpbmcgaW5kaWNhdG9yLlxuICpcbiAqIEBwYXJhbSBvQ29udGV4dFxuICogQHBhcmFtIG9EYXRhUG9pbnRcbiAqIEBmdW5jdGlvbiBwYXJhbSB7b2JqZWN0fSBvQ29udGV4dCBjb250ZXh0IG9mIGludGVyZmFjZVxuICogcGFyYW0ge29iamVjdH0gb0RhdGFQb2ludCBkYXRhIHBvaW50IG9iamVjdFxuICogQHJldHVybnMgRXhwcmVzc2lvbiBiaW5kaW5nIGZvciByYXRpbmcgaW5kaWNhdG9yIHRleHRcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEhlYWRlclJhdGluZ0luZGljYXRvclRleHQgPSAob0NvbnRleHQ6IGFueSwgb0RhdGFQb2ludDogYW55KTogc3RyaW5nIHwgdW5kZWZpbmVkID0+IHtcblx0aWYgKG9EYXRhUG9pbnQgJiYgb0RhdGFQb2ludC5TYW1wbGVTaXplKSB7XG5cdFx0cmV0dXJuIGJ1aWxkUmF0aW5nSW5kaWNhdG9yU3VidGl0bGVFeHByZXNzaW9uKG9Db250ZXh0LCBvRGF0YVBvaW50LlNhbXBsZVNpemUpO1xuXHR9IGVsc2UgaWYgKG9EYXRhUG9pbnQgJiYgb0RhdGFQb2ludC5EZXNjcmlwdGlvbikge1xuXHRcdGNvbnN0IHNNb2RlbFZhbHVlID0gQW5ub3RhdGlvbkhlbHBlci52YWx1ZShvRGF0YVBvaW50LkRlc2NyaXB0aW9uLCB7IGNvbnRleHQ6IG9Db250ZXh0IH0pO1xuXHRcdHJldHVybiBcIiR7cGF0aDpcIiArIHNNb2RlbFZhbHVlICsgXCJ9XCI7XG5cdH1cbn07XG5nZXRIZWFkZXJSYXRpbmdJbmRpY2F0b3JUZXh0LnJlcXVpcmVzSUNvbnRleHQgPSB0cnVlO1xuXG5jb25zdCBidWlsZEV4cHJlc3Npb25Gb3JEZXNjcmlwdGlvbiA9IChmaWVsZFZhbHVlOiBEYXRhTW9kZWxPYmplY3RQYXRoKTogQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPGFueT4gfCB1bmRlZmluZWQgPT4ge1xuXHRjb25zdCByZWxhdGl2ZUxvY2F0aW9uID0gZ2V0UmVsYXRpdmVQYXRocyhmaWVsZFZhbHVlKTtcblx0aWYgKGZpZWxkVmFsdWU/LnRhcmdldE9iamVjdD8uYW5ub3RhdGlvbnM/LkNvbW1vbj8uVGV4dCkge1xuXHRcdGNvbnN0IG9UZXh0RXhwcmVzc2lvbiA9IGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbihmaWVsZFZhbHVlPy50YXJnZXRPYmplY3QuYW5ub3RhdGlvbnM/LkNvbW1vbj8uVGV4dCwgcmVsYXRpdmVMb2NhdGlvbik7XG5cdFx0aWYgKGlzUGF0aEluTW9kZWxFeHByZXNzaW9uKG9UZXh0RXhwcmVzc2lvbikpIHtcblx0XHRcdG9UZXh0RXhwcmVzc2lvbi5wYXJhbWV0ZXJzID0geyBcIiQkbm9QYXRjaFwiOiB0cnVlIH07XG5cdFx0fVxuXHRcdHJldHVybiBvVGV4dEV4cHJlc3Npb247XG5cdH1cblx0cmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbmNvbnN0IGdldEZsb2F0Rm9ybWF0ID0gKFxuXHRvdXRFeHByZXNzaW9uOiBQYXRoSW5Nb2RlbEV4cHJlc3Npb248YW55Pixcblx0ZmllbGRWYWx1ZTogYW55LFxuXHRudW1iZXJPZkZyYWN0aW9uYWxEaWdpdHM6IHN0cmluZ1xuKTogQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPGFueT4gPT4ge1xuXHQvLyBudW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMgaXMgb25seSBkZWZpbmVkIGluIGdldFZhbHVlRm9ybWF0dGVkIHdoZW4gTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzIGlzIGRlZmluZWQuXG5cdC8vIEluIHRoYXQgY2FzZSwgd2UgbmVlZCB0byBpbnN0YW5jZSB0aGUgcHJlc2VydmVEZWNpbWFscyBwYXJhbWV0ZXIgYmVjYXVzZSBvZiBhIGNoYW5nZSBNREMgc2lkZVxuXHRpZiAobnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzKSB7XG5cdFx0aWYgKCFvdXRFeHByZXNzaW9uLmZvcm1hdE9wdGlvbnMpIHtcblx0XHRcdG91dEV4cHJlc3Npb24uZm9ybWF0T3B0aW9ucyA9IHt9O1xuXHRcdH1cblx0XHRvdXRFeHByZXNzaW9uLmZvcm1hdE9wdGlvbnMgPSBPYmplY3QuYXNzaWduKG91dEV4cHJlc3Npb24uZm9ybWF0T3B0aW9ucywge1xuXHRcdFx0cHJlc2VydmVEZWNpbWFsczogZmFsc2UsXG5cdFx0XHRtYXhGcmFjdGlvbkRpZ2l0czogbnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzXG5cdFx0fSk7XG5cdH1cblx0cmV0dXJuIG91dEV4cHJlc3Npb247XG59O1xuXG5jb25zdCBnZXRWYWx1ZUZvcm1hdHRlZCA9IChcblx0b1Byb3BlcnR5RGF0YU1vZGVsUGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCxcblx0ZmllbGRWYWx1ZTogYW55LFxuXHRzUHJvcGVydHlUeXBlOiBzdHJpbmcsXG5cdHNOdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHM6IHN0cmluZ1xuKTogQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPHN0cmluZz4gPT4ge1xuXHRsZXQgb3V0RXhwcmVzc2lvbjogQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPGFueT47XG5cdGNvbnN0IHJlbGF0aXZlTG9jYXRpb24gPSBmaWVsZFZhbHVlPy5wYXRoPy5pbmRleE9mKFwiL1wiKSA9PT0gLTEgPyBnZXRSZWxhdGl2ZVBhdGhzKG9Qcm9wZXJ0eURhdGFNb2RlbFBhdGgpIDogW107XG5cdG91dEV4cHJlc3Npb24gPSBnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24oZmllbGRWYWx1ZSwgcmVsYXRpdmVMb2NhdGlvbik7XG5cdGNvbnN0IG9Qcm9wZXJ0eURlZmluaXRpb24gPSBvUHJvcGVydHlEYXRhTW9kZWxQYXRoLnRhcmdldE9iamVjdCBhcyBQcm9wZXJ0eTtcblx0aWYgKHNQcm9wZXJ0eVR5cGUgJiYgaXNQYXRoSW5Nb2RlbEV4cHJlc3Npb24ob3V0RXhwcmVzc2lvbikpIHtcblx0XHRmb3JtYXRXaXRoVHlwZUluZm9ybWF0aW9uKG9Qcm9wZXJ0eURlZmluaXRpb24sIG91dEV4cHJlc3Npb24pO1xuXHRcdG91dEV4cHJlc3Npb24udHlwZSA9IEVETV9UWVBFX01BUFBJTkdbc1Byb3BlcnR5VHlwZV0/LnR5cGU7XG5cdFx0aWYgKHR5cGVzU3VwcG9ydGluZ051bWJlck9mRnJhY3Rpb25hbERpZ2l0cy5pbmNsdWRlcyhzUHJvcGVydHlUeXBlKSkge1xuXHRcdFx0Ly8gZm9yIHRoZSBsaXN0UmVwb3J0LCB0aGUgZGVjaW1hbC9zaW5nbGUvZG91YmxlIGZpZWxkcyBhcmUgZm9ybWF0dGVkIGJ5IHJldHVybmluZyBhIHN0cmluZ1xuXHRcdFx0Ly8gZm9yIHRoZSBmYWNldHMgb2YgdGhlIE9QLCB0aGUgZGVjaW1hbC9zaW5nbGUvZG91YmxlIGZpZWxkcyBhcmUgZm9ybWF0dGVkIGJ5IHJldHVybmluZyBhIHByb21pc2UsIHNvIHdlIG1hbmFnZSBhbGwgdGhlIGNhc2VzXG5cdFx0XHRvdXRFeHByZXNzaW9uID0gZ2V0RmxvYXRGb3JtYXQob3V0RXhwcmVzc2lvbiwgZmllbGRWYWx1ZSwgc051bWJlck9mRnJhY3Rpb25hbERpZ2l0cyk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG91dEV4cHJlc3Npb247XG59O1xuXG5leHBvcnQgY29uc3QgYnVpbGRGaWVsZEJpbmRpbmdFeHByZXNzaW9uID0gKFxuXHRvRGF0YU1vZGVsUGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCxcblx0ZGF0YVBvaW50Rm9ybWF0T3B0aW9uczogRGF0YVBvaW50Rm9ybWF0T3B0aW9ucyxcblx0YkhpZGVNZWFzdXJlOiBib29sZWFuXG4pOiBDb21waWxlZEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbiA9PiB7XG5cdGNvbnN0IG9EYXRhUG9pbnQgPSBvRGF0YU1vZGVsUGF0aC50YXJnZXRPYmplY3Q7XG5cdGNvbnN0IG9EYXRhUG9pbnRWYWx1ZSA9IG9EYXRhUG9pbnQ/LlZhbHVlIHx8IFwiXCI7XG5cdGNvbnN0IHByb3BlcnR5VHlwZSA9IG9EYXRhUG9pbnRWYWx1ZT8uJHRhcmdldD8udHlwZTtcblx0bGV0IG51bWJlck9mRnJhY3Rpb25hbERpZ2l0cztcblxuXHRpZiAodHlwZXNTdXBwb3J0aW5nTnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzLmluY2x1ZGVzKHByb3BlcnR5VHlwZSkgJiYgb0RhdGFQb2ludC5WYWx1ZUZvcm1hdCkge1xuXHRcdGlmIChvRGF0YVBvaW50LlZhbHVlRm9ybWF0Lk51bWJlck9mRnJhY3Rpb25hbERpZ2l0cykge1xuXHRcdFx0bnVtYmVyT2ZGcmFjdGlvbmFsRGlnaXRzID0gb0RhdGFQb2ludC5WYWx1ZUZvcm1hdC5OdW1iZXJPZkZyYWN0aW9uYWxEaWdpdHM7XG5cdFx0fVxuXHR9XG5cdGNvbnN0IG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGggPSBlbmhhbmNlRGF0YU1vZGVsUGF0aChvRGF0YU1vZGVsUGF0aCwgb0RhdGFQb2ludFZhbHVlLnBhdGgpO1xuXHRjb25zdCBvRGVzY3JpcHRpb24gPSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoID8gYnVpbGRFeHByZXNzaW9uRm9yRGVzY3JpcHRpb24ob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCkgOiB1bmRlZmluZWQ7XG5cdGNvbnN0IG9Gb3JtYXR0ZWRWYWx1ZSA9IGdldFZhbHVlRm9ybWF0dGVkKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgsIG9EYXRhUG9pbnRWYWx1ZSwgcHJvcGVydHlUeXBlLCBudW1iZXJPZkZyYWN0aW9uYWxEaWdpdHMpO1xuXHRjb25zdCBzRGlzcGxheU1vZGUgPSBvRGVzY3JpcHRpb24gPyBkYXRhUG9pbnRGb3JtYXRPcHRpb25zLmRpc3BsYXlNb2RlIHx8IGdldERpc3BsYXlNb2RlKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgpIDogXCJWYWx1ZVwiO1xuXHRsZXQgb0JpbmRpbmdFeHByZXNzaW9uOiBhbnk7XG5cdHN3aXRjaCAoc0Rpc3BsYXlNb2RlKSB7XG5cdFx0Y2FzZSBcIkRlc2NyaXB0aW9uXCI6XG5cdFx0XHRvQmluZGluZ0V4cHJlc3Npb24gPSBvRGVzY3JpcHRpb247XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIFwiVmFsdWVEZXNjcmlwdGlvblwiOlxuXHRcdFx0b0JpbmRpbmdFeHByZXNzaW9uID0gZm9ybWF0UmVzdWx0KFtvRm9ybWF0dGVkVmFsdWUsIG9EZXNjcmlwdGlvbl0sIHZhbHVlRm9ybWF0dGVycy5mb3JtYXRXaXRoQnJhY2tldHMpO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBcIkRlc2NyaXB0aW9uVmFsdWVcIjpcblx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IGZvcm1hdFJlc3VsdChbb0Rlc2NyaXB0aW9uLCBvRm9ybWF0dGVkVmFsdWVdLCB2YWx1ZUZvcm1hdHRlcnMuZm9ybWF0V2l0aEJyYWNrZXRzKTtcblx0XHRcdGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRpZiAob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5Db21tb24/LlRpbWV6b25lKSB7XG5cdFx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IGdldEJpbmRpbmdXaXRoVGltZXpvbmUob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aCwgb0Zvcm1hdHRlZFZhbHVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG9CaW5kaW5nRXhwcmVzc2lvbiA9IF9jb21wdXRlQmluZGluZ1dpdGhVbml0T3JDdXJyZW5jeShcblx0XHRcdFx0XHRvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRcdFx0XHRcdG9Gb3JtYXR0ZWRWYWx1ZSxcblx0XHRcdFx0XHRiSGlkZU1lYXN1cmUgfHwgZGF0YVBvaW50Rm9ybWF0T3B0aW9ucz8ubWVhc3VyZURpc3BsYXlNb2RlID09PSBcIkhpZGRlblwiXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdH1cblx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKG9CaW5kaW5nRXhwcmVzc2lvbik7XG59O1xuXG5leHBvcnQgY29uc3QgX2NvbXB1dGVCaW5kaW5nV2l0aFVuaXRPckN1cnJlbmN5ID0gKFxuXHRwcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGg6IERhdGFNb2RlbE9iamVjdFBhdGgsXG5cdGZvcm1hdHRlZFZhbHVlOiBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPixcblx0aGlkZU1lYXN1cmU6IGJvb2xlYW5cbik6IEJpbmRpbmdUb29sa2l0RXhwcmVzc2lvbjxzdHJpbmc+ID0+IHtcblx0aWYgKFxuXHRcdHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5NZWFzdXJlcz8uVW5pdCB8fFxuXHRcdHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3Q/LmFubm90YXRpb25zPy5NZWFzdXJlcz8uSVNPQ3VycmVuY3lcblx0KSB7XG5cdFx0aWYgKGhpZGVNZWFzdXJlICYmIGhhc1N0YXRpY1BlcmNlbnRVbml0KHByb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QpKSB7XG5cdFx0XHRyZXR1cm4gZm9ybWF0dGVkVmFsdWU7XG5cdFx0fVxuXHRcdHJldHVybiBnZXRCaW5kaW5nV2l0aFVuaXRPckN1cnJlbmN5KFxuXHRcdFx0cHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoLFxuXHRcdFx0Zm9ybWF0dGVkVmFsdWUsXG5cdFx0XHR1bmRlZmluZWQsXG5cdFx0XHRoaWRlTWVhc3VyZSA/IHsgc2hvd01lYXN1cmU6IGZhbHNlIH0gOiB1bmRlZmluZWRcblx0XHQpO1xuXHR9XG5cdHJldHVybiBmb3JtYXR0ZWRWYWx1ZTtcbn07XG5cbi8qKlxuICogTWV0aG9kIHRvIGNhbGN1bGF0ZSB0aGUgcGVyY2VudGFnZSB2YWx1ZSBvZiBQcm9ncmVzcyBJbmRpY2F0b3IuIEJhc2ljIGZvcm11bGEgaXMgVmFsdWUvVGFyZ2V0ICogMTAwLlxuICpcbiAqIEBwYXJhbSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoXG4gKiBAcmV0dXJucyBUaGUgZXhwcmVzc2lvbiBiaW5kaW5nIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSBwZXJjZW50YWdlIHZhbHVlLCB3aGljaCBpcyBzaG93biBpbiB0aGUgcHJvZ3Jlc3MgaW5kaWNhdG9yIGJhc2VkIG9uIHRoZSBmb3JtdWxhIGdpdmVuIGFib3ZlLlxuICovXG5leHBvcnQgY29uc3QgYnVpbGRFeHByZXNzaW9uRm9yUHJvZ3Jlc3NJbmRpY2F0b3JQZXJjZW50VmFsdWUgPSAob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aDogRGF0YU1vZGVsT2JqZWN0UGF0aCk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG5cdGNvbnN0IGZpZWxkVmFsdWUgPSBvUHJvcGVydHlEYXRhTW9kZWxPYmplY3RQYXRoPy50YXJnZXRPYmplY3Q/LlZhbHVlIHx8IFwiXCI7XG5cdGNvbnN0IHJlbGF0aXZlTG9jYXRpb24gPSBnZXRSZWxhdGl2ZVBhdGhzKG9Qcm9wZXJ0eURhdGFNb2RlbE9iamVjdFBhdGgpO1xuXHRjb25zdCBmaWVsZFZhbHVlRXhwcmVzc2lvbiA9IGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbihmaWVsZFZhbHVlLCByZWxhdGl2ZUxvY2F0aW9uKTtcblx0Y29uc3QgVGFyZ2V0RXhwcmVzc2lvbiA9IGdldERhdGFQb2ludFRhcmdldEV4cHJlc3Npb24ob1Byb3BlcnR5RGF0YU1vZGVsT2JqZWN0UGF0aC50YXJnZXRPYmplY3QpO1xuXG5cdGNvbnN0IG9Qcm9wZXJ0eURlZmluaXRpb24gPSBmaWVsZFZhbHVlLiR0YXJnZXQgYXMgUHJvcGVydHk7XG5cdGNvbnN0IHVuaXQgPSBvUHJvcGVydHlEZWZpbml0aW9uLmFubm90YXRpb25zPy5NZWFzdXJlcz8uVW5pdCB8fCBvUHJvcGVydHlEZWZpbml0aW9uLmFubm90YXRpb25zPy5NZWFzdXJlcz8uSVNPQ3VycmVuY3k7XG5cdGlmICh1bml0KSB7XG5cdFx0Y29uc3QgdW5pdEJpbmRpbmdFeHByZXNzaW9uID0gKHVuaXQgYXMgYW55KS4kdGFyZ2V0XG5cdFx0XHQ/IGZvcm1hdFdpdGhUeXBlSW5mb3JtYXRpb24oXG5cdFx0XHRcdFx0KHVuaXQgYXMgYW55KS4kdGFyZ2V0LFxuXHRcdFx0XHRcdGdldEV4cHJlc3Npb25Gcm9tQW5ub3RhdGlvbih1bml0LCByZWxhdGl2ZUxvY2F0aW9uKSBhcyBCaW5kaW5nVG9vbGtpdEV4cHJlc3Npb248c3RyaW5nPlxuXHRcdFx0ICApXG5cdFx0XHQ6IChnZXRFeHByZXNzaW9uRnJvbUFubm90YXRpb24odW5pdCwgcmVsYXRpdmVMb2NhdGlvbikgYXMgQmluZGluZ1Rvb2xraXRFeHByZXNzaW9uPHN0cmluZz4pO1xuXG5cdFx0cmV0dXJuIGNvbXBpbGVFeHByZXNzaW9uKFxuXHRcdFx0Zm9ybWF0UmVzdWx0KFtmaWVsZFZhbHVlRXhwcmVzc2lvbiwgVGFyZ2V0RXhwcmVzc2lvbiwgdW5pdEJpbmRpbmdFeHByZXNzaW9uXSwgdmFsdWVGb3JtYXR0ZXJzLmNvbXB1dGVQZXJjZW50YWdlKVxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4gY29tcGlsZUV4cHJlc3Npb24oZm9ybWF0UmVzdWx0KFtmaWVsZFZhbHVlRXhwcmVzc2lvbiwgVGFyZ2V0RXhwcmVzc2lvbiwgXCJcIl0sIHZhbHVlRm9ybWF0dGVycy5jb21wdXRlUGVyY2VudGFnZSkpO1xufTtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXNCQSxJQUFNQSx1Q0FBdUMsR0FBRyxDQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsYUFBYSxDQUFDO0VBTzNGLElBQU1DLDRCQUE0QixHQUFHLFVBQUNDLGNBQW1CLEVBQXVDO0lBQy9GLE9BQU9BLGNBQWMsYUFBZEEsY0FBYyxlQUFkQSxjQUFjLENBQUVDLFdBQVcsR0FBR0MsMkJBQTJCLENBQUNGLGNBQWMsQ0FBQ0MsV0FBVyxDQUFDLEdBQUdFLHVCQUF1QjtFQUN2SCxDQUFDO0VBRUQsSUFBTUMsY0FBYyxHQUFHQyxHQUFHLENBQUNDLEVBQUUsQ0FBQ0MsT0FBTyxFQUFFLENBQUNDLHdCQUF3QixDQUFDLGVBQWUsQ0FBQztFQUUxRSxJQUFNQywrQ0FBK0MsR0FBRyxVQUM5REMsNEJBQWlELEVBQ1g7SUFBQTtJQUN0QyxJQUFNQyxVQUFVLEdBQUcsQ0FBQUQsNEJBQTRCLGFBQTVCQSw0QkFBNEIsZ0RBQTVCQSw0QkFBNEIsQ0FBRUUsWUFBWSwwREFBMUMsc0JBQTRDQyxLQUFLLEtBQUksRUFBRTtJQUMxRSxJQUFNQyxnQkFBZ0IsR0FBR0MsZ0JBQWdCLENBQUNMLDRCQUE0QixDQUFDO0lBQ3ZFLElBQUlNLG9CQUFvQixHQUFHZCwyQkFBMkIsQ0FBQ1MsVUFBVSxFQUFFRyxnQkFBZ0IsQ0FBUTtJQUMzRixJQUFNRyxnQkFBZ0IsR0FBR2xCLDRCQUE0QixDQUFDVyw0QkFBNEIsQ0FBQ0UsWUFBWSxDQUFRO0lBRXZHLElBQUlJLG9CQUFvQixJQUFJQyxnQkFBZ0IsRUFBRTtNQUFBO01BQzdDLElBQUlMLFlBQVksR0FBR0YsNEJBQTRCLENBQUNFLFlBQVksQ0FBQ0MsS0FBSztNQUNsRSxJQUFJLENB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
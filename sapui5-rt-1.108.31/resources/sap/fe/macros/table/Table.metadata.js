/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/internal/helpers/TableTemplating","sap/fe/macros/MacroMetadata"],function(e,t,a,n,i,o,r){"use strict";var l=o.buildExpressionForHeaderVisible;var s=i.getContextRelativeTargetObjectPath;var u=n.generate;var c=a.getInvolvedDataModelObjects;var p=t.getVisualizationsFromPresentationVariant;var d=t.getDataVisualizationConfiguration;var b=r.extend("sap.fe.macros.table.Table",{name:"Table",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",fragment:"sap.fe.macros.table.Table",metadata:{stereotype:"xmlmacro",properties:{tableDefinition:{type:"sap.ui.model.Context"},metaPath:{type:"sap.ui.model.Context",isPublic:true},contextPath:{type:"sap.ui.model.Context",isPublic:true},collection:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty","Singleton"]},parentEntitySet:{type:"sap.ui.model.Context"},id:{type:"string",isPublic:true},_apiId:{type:"string"},navigationPath:{type:"string"},readOnly:{type:"boolean",isPublic:true},fieldMode:{type:"string",defaultValue:"",allowedValues:["","nowrapper"]},disableAddRowButtonForEmptyData:{type:"boolean"},customValidationFunction:{type:"string"},useCondensedTableLayout:{type:"boolean"},rowAction:{type:"string",defaultValue:undefined},selectionMode:{type:"string",isPublic:true},busy:{type:"boolean",isPublic:true},enableFullScreen:{type:"boolean",isPublic:true},header:{type:"string",isPublic:true},headerVisible:{type:"boolean",isPublic:true},headerLevel:{type:"sap.ui.core.TitleLevel",defaultValue:"Auto",isPublic:true},noDataText:{type:"string"},creationMode:{type:"string"},createAtEnd:{type:"boolean"},createOutbound:{type:"string"},createOutboundDetail:{type:"string"},createNewAction:{type:"string"},personalization:{type:"string|boolean",isPublic:true},isSearchable:{type:"boolean",isPublic:true},type:{type:"string",isPublic:true},tableType:{type:"string"},enableExport:{type:"boolean",isPublic:true},enablePaste:{type:"boolean",isPublic:true},selectionLimit:{type:"string"},multiSelectMode:{type:"string"},filterBar:{type:"string",isPublic:true},filterBarId:{type:"string"},tableDelegate:{type:"string"},enableAutoScroll:{type:"boolean"},visible:{type:"string"},isAlp:{type:"boolean",defaultValue:false},variantManagement:{type:"string",isPublic:true},columnEditMode:{type:"string",computed:true},tabTitle:{type:"string",defaultValue:""},enableAutoColumnWidth:{type:"boolean"},dataStateIndicatorFilter:{type:"string"},isCompactType:{type:"boolean"}},events:{variantSaved:{type:"function"},variantSelected:{type:"function"},onChange:{type:"function"},rowPress:{type:"function",isPublic:true},onContextChange:{type:"function"},onSegmentedButtonPressed:{type:"function"},stateChange:{type:"function"},selectionChange:{type:"function",isPublic:true}},aggregations:{actions:{type:"sap.fe.macros.internal.table.Action | sap.fe.macros.internal.table.ActionGroup",isPublic:true},columns:{type:"sap.fe.macros.internal.table.Column",isPublic:true}}},create:function(e,t,a,n){var i;var o=c(e.metaPath,e.contextPath);if(!e.tableDefinition){var r=this.getConverterContext(o,e.contextPath,a);var s=this._getVisualizationPath(o,r);var p=this._getPresentationPath(o);var b=this._buildActions(n.actions);var f=this.parseAggregation(n.columns,function(e,t){var a;var i=e.getAttribute("key")||"InlineXMLColumn_"+t;n[i]=e;return{key:i,type:"Slot",width:e.getAttribute("width"),importance:e.getAttribute("importance"),horizontalAlign:e.getAttribute("horizontalAlign"),availability:e.getAttribute("availability"),header:e.getAttribute("header"),template:((a=e.children[0])===null||a===void 0?void 0:a.outerHTML)||"",properties:e.getAttribute("properties")?e.getAttribute("properties").split(","):undefined,position:{placement:e.getAttribute("positionPlacement"),anchor:e.getAttribute("positionAnchor")}}});var g={};var y={enableExport:e.enableExport,enableFullScreen:e.enableFullScreen,enablePaste:e.enablePaste,selectionMode:e.selectionMode,type:e.type};y=JSON.parse(JSON.stringify(y));g[s]={actions:b,columns:f,tableSettings:y};var h=this.getConverterContext(o,e.contextPath,a,g);var m=d(s,e.useCondensedLayout,h,undefined,undefined,p);i=m.visualizations[0];e.tableDefinition=this.createBindingContext(i,a)}else{i=e.tableDefinition.getObject()}i.path="{_pageModel>"+e.tableDefinition.getPath()+"}";this.setDefaultValue(e,"selectionMode",i.annotation.selectionMode,true);this.setDefaultValue(e,"enableFullScreen",i.control.enableFullScreen,true);this.setDefaultValue(e,"enableExport",i.control.enableExport,true);this.setDefaultValue(e,"enablePaste",i.annotation.standardActions.actions.paste.enabled,true);this.setDefaultValue(e,"updatablePropertyPath",i.annotation.standardActions.updatablePropertyPath,true);this.setDefaultValue(e,"type",i.control.type,true);this.setDefaultValue(e,"useCondensedTableLayout",i.control.useCondensedTableLayout);this.setDefaultValue(e,"disableAddRowButtonForEmptyData",i.control.disableAddRowButtonForEmptyData);this.setDefaultValue(e,"customValidationFunction",i.control.customValidationFunction);this.setDefaultValue(e,"headerVisible",i.control.headerVisible);this.setDefaultValue(e,"searchable",i.annotation.searchable);this.setDefaultValue(e,"showRowCount",i.control.showRowCount);this.setDefaultValue(e,"inlineCreationRowCount",i.control.inlineCreationRowCount);this.setDefaultValue(e,"header",i.annotation.title);this.setDefaultValue(e,"selectionLimit",i.control.selectionLimit);this.setDefaultValue(e,"isCompactType",i.control.isCompactType);if(e.id){e._apiId=e.id;e.id=this.getContentId(e.id)}else{this.setDefaultValue(e,"id",i.annotation.id);e._apiId=i.annotation.id+"::Table"}this.setDefaultValue(e,"creationMode",i.annotation.create.mode);this.setDefaultValue(e,"createAtEnd",i.annotation.create.append);this.setDefaultValue(e,"createOutbound",i.annotation.create.outbound);this.setDefaultValue(e,"createNewAction",i.annotation.create.newAction);this.setDefaultValue(e,"createOutboundDetail",i.annotation.create.outboundDetail);this.setDefaultValue(e,"personalization",i.annotation.p13nMode);this.setDefaultValue(e,"variantManagement",i.annotation.variantManagement);this.setDefaultValue(e,"enableAutoColumnWidth",i.control.enableAutoColumnWidth);this.setDefaultValue(e,"dataStateIndicatorFilter",i.control.dataStateIndicatorFilter);switch(e.readOnly){case"false":e.readOnly=false;break;case"true":e.readOnly=true;break;default:}if(e.readOnly===undefined&&i.annotation.displayMode===true){e.readOnly=true}if(e.rowPress){e.rowAction="Navigation"}this.setDefaultValue(e,"rowPress",i.annotation.row.press);this.setDefaultValue(e,"rowAction",i.annotation.row.action);if(e.personalization==="false"){e.personalization=undefined}else if(e.personalization==="true"){e.personalization="Sort,Column,Filter"}switch(e.personalization){case"false":e.personalization=undefined;break;case"true":e.personalization="Sort,Column,Filter";break;default:}if(e.isSearchable==="false"){e.searchable=false}else{e.searchable=i.annotation.searchable}var v=false;if(!e.filterBar&&!e.filterBarId&&e.searchable){e.filterBarId=u([e.id,"StandardAction","BasicSearch"]);v=true}e.useBasicSearch=v;e.tableType=e.type;e.showCreate=i.annotation.standardActions.actions.create.visible||true;e.autoBindOnInit=i.annotation.autoBindOnInit;e.navigationPath=i.annotation.navigationPath;if(i.annotation.collection.startsWith("/")&&o.startingEntitySet._type==="Singleton"){i.annotation.collection=e.navigationPath}e.parentEntitySet=a.models.metaModel.createBindingContext("/"+(o.contextLocation.targetEntitySet?o.contextLocation.targetEntitySet.name:o.startingEntitySet.name));e.collection=a.models.metaModel.createBindingContext(i.annotation.collection);switch(e.readOnly){case true:e.columnEditMode="Display";break;case false:e.columnEditMode="Editable";break;default:e.columnEditMode=undefined}e.headerBindingExpression=l(e);return e},_buildActions:function(e){var t={};if(e&&e.children.length>0){var a=Array.prototype.slice.apply(e.children);var n=0;a.forEach(function(e){n++;var a=[];if(e.children.length&&e.localName==="ActionGroup"&&e.namespaceURI==="sap.fe.macros"){var i=Array.prototype.slice.apply(e.children);i.forEach(function(e){var a=e.getAttribute("key")||"InlineXMLAction_"+n;var i={key:a,text:e.getAttribute("text"),__noWrap:true,press:e.getAttribute("press"),requiresSelection:e.getAttribute("requiresSelection")==="true",enabled:e.getAttribute("enabled")===null?true:e.getAttribute("enabled")};t[i.key]=i;n++});a=Object.values(t).slice(-e.children.length).map(function(e){return e.key})}var o=e.getAttribute("key")||"InlineXMLAction_"+n;var r={key:o,text:e.getAttribute("text"),position:{placement:e.getAttribute("placement"),anchor:e.getAttribute("anchor")},__noWrap:true,press:e.getAttribute("press"),requiresSelection:e.getAttribute("requiresSelection")==="true",enabled:e.getAttribute("enabled")===null?true:e.getAttribute("enabled"),menu:a.length?a:null};t[r.key]=r})}return t},_getVisualizationPath:function(t,a){var n=s(t);if(t.targetObject.term==="com.sap.vocabularies.UI.v1.LineItem"){return n}var i=a.getEntityTypeAnnotation(n);var o=[];switch(t.targetObject.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(t.targetObject.PresentationVariant){o=p(t.targetObject.PresentationVariant,n,i.converterContext)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":o=p(t.targetObject,n,i.converterContext);break;default:e.error("Bad metapath parameter for table : ".concat(t.targetObject.term))}var r=o.find(function(e){return e.visualization.term==="com.sap.vocabularies.UI.v1.LineItem"});if(r){return r.annotationPath}else{return n}},_getPresentationPath:function(e){var t;switch(e.targetObject.term){case"com.sap.vocabularies.UI.v1.PresentationVariant":t=s(e);break;case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":t=s(e)+"/PresentationVariant";break;default:t=null}return t}});return b},false);
//# sourceMappingURL=Table.metadata.js.map
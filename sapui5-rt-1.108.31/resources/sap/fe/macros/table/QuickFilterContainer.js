/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/chart/ChartUtils","sap/fe/macros/DelegateUtil","sap/fe/macros/table/Utils","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Item","sap/ui/model/json/JSONModel"],function(e,t,r,i,n,o,a,l,s,c,u,f,h,d){"use strict";var g,p,b,v,y,C,_,m,w,S,T,E,I;var P=i.generate;var F=r.property;var O=r.defineUI5Class;var D=r.aggregation;function j(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function z(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function A(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;V(e,t)}function V(e,t){V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return V(e,t)}function M(e,t,r,i,n){var o={};Object.keys(i).forEach(function(e){o[e]=i[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},o);if(n&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(n):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function x(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var K="quickFilterKey";var B="filters";var R=(g=O("sap.fe.macros.table.QuickFilterContainer",{interfaces:["sap.m.IOverflowToolbarContent"]}),p=F({type:"boolean"}),b=F({type:"string"}),v=F({type:"string"}),y=F({type:"string",defaultValue:"$auto"}),C=D({type:"sap.ui.core.Control",multiple:false,isDefault:true}),g(_=(m=function(r){A(i,r);function i(){var e;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++){i[n]=arguments[n]}e=r.call.apply(r,[this].concat(i))||this;j(e,"showCounts",w,z(e));j(e,"entitySet",S,z(e));j(e,"parentEntityType",T,z(e));j(e,"batchGroupId",E,z(e));j(e,"selector",I,z(e));e._attachedToView=false;return e}i.render=function e(t,r){t.renderControl(r.selector)};var u=i.prototype;u.init=function e(){var t=this;r.prototype.init.call(this);this._attachedToView=false;this.attachEvent("modelContextChange",this._initControl);var i={onBeforeRendering:function(){t._createControlSideEffects();t._attachedToView=true;t.removeEventDelegate(i)}};this.addEventDelegate(i,this)};u._initControl=function e(t){if(this.getModel()){this.detachEvent(t.getId(),this._initControl);this._manageTable();this._createContent()}};u._manageTable=function e(){var t,r;var i=this.getParent();var n=this._getFilterModel(),a=n.getObject("/paths"),l=Array.isArray(a)&&a.length>0?a[0].annotationPath:undefined;while(i&&!i.isA("sap.ui.mdc.Table")){i=i.getParent()}this._oTable=i;var s=f.byId(this._oTable.getFilter());if(s&&s.isA("sap.ui.mdc.FilterBar")){s.attachEvent("filtersChanged",this._onFiltersChanged.bind(this))}(t=this._oTable)===null||t===void 0?void 0:(r=t.getParent())===null||r===void 0?void 0:r.attachEvent("internalDataRequested",this._onTableDataRequested.bind(this));o.setCustomData(i,K,l)};u._onFiltersChanged=function e(t){if(t.getParameter("conditionsBased")){this.selector.setProperty("enabled",false)}};u._onTableDataRequested=function e(){this.selector.setProperty("enabled",true);if(this.showCounts){this._updateCounts()}};u.setSelectorKey=function e(t){var r=this.selector;if(r&&r.getSelectedKey()!==t){r.setSelectedKey(t);o.setCustomData(this._oTable,K,t);var i=this._oTable.getFilter&&this._oTable.getFilter();var n=i&&f.byId(i);var a=n&&n.getSuspendSelection&&n.getSuspendSelection();if(!a){this._oTable.rebind()}}};u.getSelectorKey=function e(){var t=this.selector;return t?t.getSelectedKey():null};u.getDomRef=function e(t){var r=this.selector;return r?r.getDomRef(t):null};u._getFilterModel=function e(){var t=this.getModel(B);if(!t){var r=o.getCustomData(this,B);t=new d(r);this.setModel(t,B)}return t};u._createContent=function e(){var t=this;var r=this._getFilterModel(),i=r.getObject("/paths"),n=i.length>3,o={id:P([this._oTable.getId(),"QuickFilter"]),enabled:r.getObject("/enabled"),items:{path:"".concat(B,">/paths"),factory:function(e,r){var i={key:r.getObject().annotationPath,text:t._getSelectorItemText(r)};return n?new h(i):new s(i)}}};if(n){o.autoAdjustWidth=true}o[n?"change":"selectionChange"]=this._onSelectionChange.bind(this);this.selector=n?new c(o):new l(o)};u.getOverflowToolbarConfig=function e(){return{canOverflow:true}};u._createControlSideEffects=function e(){var t=this;var r=this.selector,i=r.getItems(),n=o.getCustomData(this._oTable,"navigationPath");if(n){(function(){var e=[];for(var r in i){var o=i[r].getKey(),l=a.getFiltersInfoForSV(t._oTable,o);l.properties.forEach(function(t){var r="".concat(n,"/").concat(t);if(!e.includes(r)){e.push(r)}})}t._getSideEffectController().addControlSideEffects(t.parentEntityType,{SourceProperties:e,TargetEntities:[{$NavigationPropertyPath:n}],sourceControlId:t.getId()})})()}};u._getSelectorItemText=function e(t){var r=t.getObject().annotationPath,i=t.getPath(),n=this.getModel().getMetaModel(),o=n.getObject("".concat(this.entitySet,"/").concat(r));return o.Text+(this.showCounts?" ({".concat(B,">").concat(i,"/count})"):"")};u._getSideEffectController=function e(){var t=this._getViewController();return t?t._sideEffects:undefined};u._getViewController=function e(){var r=t.getTargetView(this);return r&&r.getController()};u._updateCounts=function t(){var r=this._oTable,i=this._getViewController(),l=this.selector,s=l.getItems(),c=this._getFilterModel(),u=[],f=[];var h=[];var d=[];var g=o.getCustomData(r,K);if(i&&i.getChartControl){var p=i.getChartControl();if(p){var b=n.getAllFilterInfo(p);if(b&&b.filters.length){d=b.filters}}}h=h.concat(a.getHiddenFilters(r)).concat(d);for(var v in s){var y=s[v].getKey(),C=a.getFiltersInfoForSV(r,y);f.push(C.text);c.setProperty("/paths/".concat(v,"/count"),"...");u.push(a.getListBindingForCount(r,r.getBindingContext(),{batchGroupId:y===g?this.batchGroupId:"$auto",additionalFilters:h.concat(C.filters)}))}Promise.all(u).then(function(e){for(var t in e){c.setProperty("/paths/".concat(t,"/count"),a.getCountFormatted(e[t]))}}).catch(function(t){e.error("Error while retrieving the binding promises",t)})};u._onSelectionChange=function e(t){var r=t.getSource();o.setCustomData(this._oTable,K,r.getSelectedKey());this._oTable.rebind();var i=this._getViewController();if(i&&i.getExtensionAPI&&i.getExtensionAPI().updateAppState){i.getExtensionAPI().updateAppState()}};u.destroy=function e(t){if(this._attachedToView){var i=this._getSideEffectController();if(i){i.removeControlSideEffects(this)}}delete this._oTable;r.prototype.destroy.call(this,t)};return i}(u),w=M(m.prototype,"showCounts",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),S=M(m.prototype,"entitySet",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),T=M(m.prototype,"parentEntityType",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),E=M(m.prototype,"batchGroupId",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),I=M(m.prototype,"selector",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||_);return R},false);
//# sourceMappingURL=QuickFilterContainer.js.map
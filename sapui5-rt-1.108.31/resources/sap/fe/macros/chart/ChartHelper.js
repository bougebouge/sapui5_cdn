/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/macros/CommonHelper","sap/fe/macros/internal/helpers/ActionHelper","sap/fe/macros/ODataMetaModelUtil","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/AnnotationHelper"],function(a,e,t,r,o,n,i){"use strict";var c=e.getUiControl;function s(a){if(!a){return undefined}var e=JSON.stringify(a);e=e.replace(new RegExp("{","g"),"\\{");e=e.replace(new RegExp("}","g"),"\\}");return e}function l(a){var e=a.getPath(),t=e.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant).*/,"");return t}var u={"com.sap.vocabularies.UI.v1.ChartType/Column":"column","com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":"stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnDual":"dual_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual":"dual_stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":"100_stacked_column","com.sap.vocabularies.UI.v1.ChartType/ColumnStackedDual100":"100_dual_stacked_column","com.sap.vocabularies.UI.v1.ChartType/Bar":"bar","com.sap.vocabularies.UI.v1.ChartType/BarStacked":"stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarDual":"dual_bar","com.sap.vocabularies.UI.v1.ChartType/BarStackedDual":"dual_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarStacked100":"100_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/BarStackedDual100":"100_dual_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/Area":"area","com.sap.vocabularies.UI.v1.ChartType/AreaStacked":"stacked_column","com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":"100_stacked_column","com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":"bar","com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":"stacked_bar","com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":"100_stacked_bar","com.sap.vocabularies.UI.v1.ChartType/Line":"line","com.sap.vocabularies.UI.v1.ChartType/LineDual":"dual_line","com.sap.vocabularies.UI.v1.ChartType/Combination":"combination","com.sap.vocabularies.UI.v1.ChartType/CombinationStacked":"stacked_combination","com.sap.vocabularies.UI.v1.ChartType/CombinationDual":"dual_combination","com.sap.vocabularies.UI.v1.ChartType/CombinationStackedDual":"dual_stacked_combination","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStacked":"horizontal_stacked_combination","com.sap.vocabularies.UI.v1.ChartType/Pie":"pie","com.sap.vocabularies.UI.v1.ChartType/Donut":"donut","com.sap.vocabularies.UI.v1.ChartType/Scatter":"scatter","com.sap.vocabularies.UI.v1.ChartType/Bubble":"bubble","com.sap.vocabularies.UI.v1.ChartType/Radar":"line","com.sap.vocabularies.UI.v1.ChartType/HeatMap":"heatmap","com.sap.vocabularies.UI.v1.ChartType/TreeMap":"treemap","com.sap.vocabularies.UI.v1.ChartType/Waterfall":"waterfall","com.sap.vocabularies.UI.v1.ChartType/Bullet":"bullet","com.sap.vocabularies.UI.v1.ChartType/VerticalBullet":"vertical_bullet","com.sap.vocabularies.UI.v1.ChartType/HorizontalWaterfall":"horizontal_waterfall","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationDual":"dual_horizontal_combination","com.sap.vocabularies.UI.v1.ChartType/HorizontalCombinationStackedDual":"dual_horizontal_stacked_combination"};var p={"com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category":"category","com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series":"series","com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Category2":"category2"};var v={getP13nMode:function(a){var e=[],t=a.variantManagement&&(a.variantManagement==="Page"||a.variantManagement==="Control"),r=true;if(t&&r){if(r){return"Sort,Type,Item"}else if(typeof r==="object"){if(r.type){e.push("Type")}if(r.sort){e.push("Sort")}return e.join(",")}}},formatChartType:function(a){return u[a.$EnumMember]},formatDimensions:function(e){var t=e.getObject("./"),r=e.getModel(),i=l(e),c=[];var u,v;var m=false;t.DimensionAttributes=t.DimensionAttributes||[];for(u=0;u<t.Dimensions.length;u++){var b=t.Dimensions[u].$PropertyPath;var d=r.getObject("".concat(i+b,"@com.sap.vocabularies.Common.v1.Text"))||{};if(b.indexOf("/")>-1){a.error("$expand is not yet supported. Dimension: ".concat(b," from an association cannot be used"))}if(d.$Path&&d.$Path.indexOf("/")>-1){a.error("$expand is not yet supported. Text Property: ".concat(d.$Path," from an association cannot be used for the dimension ").concat(b));m=true}var h={key:b,textPath:!m?d.$Path:undefined,label:r.getObject("".concat(i+b,"@com.sap.vocabularies.Common.v1.Label")),role:"category"};for(v=0;v<t.DimensionAttributes.length;v++){var f=t.DimensionAttributes[v];if(h.key===f.Dimension.$PropertyPath){h.role=p[f.Role.$EnumMember]||h.role;break}}h.criticality=o.fetchCriticality(r,r.createBindingContext(i+b)).then(s);c.push(h)}var y=new n(c);y.$$valueAsPromise=true;return y.createBindingContext("/")},formatMeasures:function(a){return a.getModel().getObject().measures},getUiChart:function(a){return c(a,"@com.sap.vocabularies.UI.v1.Chart")},getOperationAvailableMap:function(a,e){var t=a.Actions||[];return JSON.stringify(r.getOperationAvailableMap(t,"chart",e))},getSortConditions:function(a,e,r,o){if(e&&t._isPresentationVariantAnnotation(r)&&e.SortOrder){var n={sorters:[]};var i=a.getPath(0).split("@")[0];e.SortOrder.forEach(function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var t="";var r={};if(e.DynamicProperty){var c;t="_fe_aggregatable_"+((c=a.getModel(0).getObject(i+e.DynamicProperty.$AnnotationPath))===null||c===void 0?void 0:c.Name)}else if(e.Property){var s=o.GroupableProperties;if(s&&s.length){for(var l=0;l<s.length;l++){if(s[l].$PropertyPath===e.Property.$PropertyPath){t="_fe_groupable_"+e.Property.$PropertyPath;break}if(!t){t="_fe_aggregatable_"+e.Property.$PropertyPath}}}else if(a.getModel(0).getObject(i+e.Property.$PropertyPath+"@Org.OData.Aggregation.V1.Groupable")){t="_fe_groupable_"+e.Property.$PropertyPath}else{t="_fe_aggregatable_"+e.Property.$PropertyPath}}if(t){r.name=t;r.descending=!!e.Descending;n.sorters.push(r)}else{throw new Error("Please define the right path to the sort property")}});return JSON.stringify(n)}return undefined},getBindingData:function(a,e,r){var o=[];var n;for(var i in r){if(r[i].$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var c=r[i].Action;var s=t.getActionPath(e,false,c,true);if(s&&s.$Path){o.push("'".concat(s.$Path,"'"))}else if(s===null){}}}if(o.length>0){n=" $select: '"+o.join()+"'"}return"'{path: '"+(e.getObject("$kind")==="EntitySet"?"/":"")+e.getObject("@sapui.name")+"'"+(n?",parameters:{"+n+"}":"")+"}'"},_getModel:function(a,e){return e.context},isDataFieldForActionButtonEnabled:function(a,e,t,o,n){if(a!==true){return"true"}var i=t.getModel();var c=t.getPath();var s=i.getObject(c).$Partner;var l=o&&JSON.parse(o);var u=l&&l[e]&&l[e].split("/");var p=r.getNumberOfContextsExpression(n);if(u&&u[0]===s){var v=l[e].replace(s+"/","");return"{= ${"+p+" && ${"+v+"}}"}else{return"{= ${"+p+"}"}},getHiddenPathExpressionForTableActionsAndIBN:function(a,e){var t=e.context,r=t.getPath(),o=i.getNavigationPath(r);if(a.indexOf("/")>0){var n=a.split("/");var c=n[0];if(t.getObject(o+"/$Partner")===c){return"{= !%{"+n.slice(1).join("/")+"} }"}}return true},getPressEventForDataFieldForActionButton:function(a,e,t){var o={contexts:"${internal>selectedContexts}"};return r.getPressEventDataFieldForActionButton(a,e,o,t)},getActionType:function(a){return(a["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")>-1||a["$Type"].indexOf("com.sap.vocabularies.UI.v1.DataFieldForAction")>-1)&&a["Inline"]},getCollectionName:function(a){return a.split("/")[a.split("/").length-1]}};v.getSortConditions.requiresIContext=true;return v},false);
//# sourceMappingURL=ChartHelper.js.map
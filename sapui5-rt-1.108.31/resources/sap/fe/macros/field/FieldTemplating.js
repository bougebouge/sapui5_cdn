/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/templating/CommonFormatters","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/ui/model/json/JSONModel"],function(e,t,i,a,n,r,o,l){"use strict";var s={};var u=n.isReadOnlyExpression;var v=a.getContextRelativeTargetObjectPath;var d=a.enhanceDataModelPath;var c=t.transformRecursively;var f=t.resolveBindingString;var p=t.pathInModel;var g=t.or;var m=t.not;var y=t.isPathInModelExpression;var h=t.isComplexTypeExpression;var b=t.ifElse;var O=t.getExpressionFromAnnotation;var I=t.equal;var T=t.constant;var D=t.compileExpression;var U=t.and;var P=e.UI;function E(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function j(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?E(Object(i),!0).forEach(function(t){x(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function x(e,t,i){t=F(t);if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}function F(e){var t=B(e,"string");return typeof t==="symbol"?t:String(t)}function B(e,t){if(typeof e!=="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==undefined){var a=i.call(e,t||"default");if(typeof a!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var S=function(e,t){return c(e,"PathInModel",function(e){var a=e;if(e.modelName===undefined){var n=d(t,e.path);a=i.getBindingWithTextArrangement(n,e)}return a})};s.addTextArrangementToBindingExpression=S;var C=function(e,t){return c(e,"PathInModel",function(e){var i=e;if(e.modelName===undefined){var a=d(t,e.path);i=o.formatWithTypeInformation(a.targetObject,e)}return i})};s.formatValueRecursively=C;var A=function(e,t){return $(e,t,true)};s.getTextBindingExpression=A;var $=function(e,t){var a,n,l,s,u,c,f,g,m,y,b,O,I,U,P;var E=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(((a=e.targetObject)===null||a===void 0?void 0:a.$Type)==="com.sap.vocabularies.UI.v1.DataField"||((n=e.targetObject)===null||n===void 0?void 0:n.$Type)==="com.sap.vocabularies.UI.v1.DataPointType"||((l=e.targetObject)===null||l===void 0?void 0:l.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"||((s=e.targetObject)===null||s===void 0?void 0:s.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||((u=e.targetObject)===null||u===void 0?void 0:u.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"||((c=e.targetObject)===null||c===void 0?void 0:c.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithAction"){var x=e.targetObject.Value||"";return D(T(x))}if(r.isPathExpression(e.targetObject)&&e.targetObject.$target){e=d(e,e.targetObject.path)}var F=p(v(e));var B;if((f=e.targetObject)!==null&&f!==void 0&&(g=f.annotations)!==null&&g!==void 0&&(m=g.Measures)!==null&&m!==void 0&&m.Unit||(y=e.targetObject)!==null&&y!==void 0&&(b=y.annotations)!==null&&b!==void 0&&(O=b.Measures)!==null&&O!==void 0&&O.ISOCurrency){B=o.getBindingWithUnitOrCurrency(e,F);if((t===null||t===void 0?void 0:t.measureDisplayMode)==="Hidden"&&h(B)){B.formatOptions=j(j({},B.formatOptions),{},{showMeasure:false})}}else if((I=e.targetObject)!==null&&I!==void 0&&(U=I.annotations)!==null&&U!==void 0&&(P=U.Common)!==null&&P!==void 0&&P.Timezone){B=o.getBindingWithTimezone(e,F,false,true)}else{B=i.getBindingWithTextArrangement(e,F,t)}if(E){return B}return D(B)};s.getTextBinding=$;var M=function(e,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var n=arguments.length>4?arguments[4]:undefined;var l=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var s=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(r.isPathExpression(e.targetObject)&&e.targetObject.$target){var u=e.targetEntityType.resolvePath(e.targetObject.path,true);e.targetObject=u.target;u.visitedObjects.forEach(function(t){if(t&&t._type==="NavigationProperty"){e.navigationProperties.push(t)}})}var d=e.targetObject;if(r.isProperty(d)){var c=p(v(e));if(y(c)){var f,g,m,h,b,I;if((f=d.annotations)!==null&&f!==void 0&&(g=f.Communication)!==null&&g!==void 0&&g.IsEmailAddress){c.type="sap.fe.core.type.Email"}else if(!i&&((m=d.annotations)!==null&&m!==void 0&&(h=m.Measures)!==null&&h!==void 0&&h.ISOCurrency||(b=d.annotations)!==null&&b!==void 0&&(I=b.Measures)!==null&&I!==void 0&&I.Unit)){c=o.getBindingWithUnitOrCurrency(e,c,true,s?undefined:{showMeasure:false})}else{var T,U;var P=(T=e.targetObject.annotations)===null||T===void 0?void 0:(U=T.Common)===null||U===void 0?void 0:U.Timezone;if(P){c=o.getBindingWithTimezone(e,c,true)}else{c=o.formatWithTypeInformation(d,c)}if(y(c)&&c.type==="sap.ui.model.odata.type.String"){c.formatOptions={parseKeepsEmptyString:true}}}if(y(c)){if(a){delete c.formatOptions;delete c.constraints;delete c.type}if(n){c.parameters=n}if(l){c.targetType="any"}}return D(c)}else{return""}}else if((d===null||d===void 0?void 0:d.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(d===null||d===void 0?void 0:d.$Type)==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"){return D(O(d.Value))}else{return""}};s.getValueBinding=M;var w=function(e,t){var i=r.getAssociatedTextPropertyPath(e.targetObject);if(i){var a=d(e,i);return M(a,t,true,true,{$$noPatch:true})}return undefined};s.getAssociatedTextBinding=w;var W=function(e,t){var i,a,n,r;var o=(e===null||e===void 0?void 0:(i=e.targetEntityType)===null||i===void 0?void 0:i.navigationProperties)||[];var l=(e===null||e===void 0?void 0:(a=e.targetEntityType)===null||a===void 0?void 0:(n=a.annotations)===null||n===void 0?void 0:(r=n.Common)===null||r===void 0?void 0:r.SemanticKey)||[];var s=false;o.forEach(function(e){if(e.referentialConstraint&&e.referentialConstraint.length){e.referentialConstraint.forEach(function(i){if((i===null||i===void 0?void 0:i.sourceProperty)===t.name){var a,n,r;if(e!==null&&e!==void 0&&(a=e.targetType)!==null&&a!==void 0&&(n=a.annotations)!==null&&n!==void 0&&(r=n.UI)!==null&&r!==void 0&&r.QuickViewFacets){s=true}}})}});if(e.startingEntitySet!==e.targetEntitySet){var u,v,d;var c=l.some(function(e){var i;return(e===null||e===void 0?void 0:(i=e.$target)===null||i===void 0?void 0:i.name)===t.name});if((c||t.isKey)&&e!==null&&e!==void 0&&(u=e.targetEntityType)!==null&&u!==void 0&&(v=u.annotations)!==null&&v!==void 0&&(d=v.UI)!==null&&d!==void 0&&d.QuickViewFacets){s=true}}return s};s.isUsedInNavigationWithQuickViewFacets=W;var V=function(e,t){var i,a,n;var o=r.isPathExpression(e)&&e.$target||e;if(!((i=o.annotations)!==null&&i!==void 0&&(a=i.Common)!==null&&a!==void 0&&a.Text)&&!((n=o.annotations)!==null&&n!==void 0&&n.Measures)&&r.hasValueHelp(o)&&t.textAlignMode==="Form"){return true}return false};s.isRetrieveTextFromValueListEnabled=V;var k=function(e,t){var i,a,n,r,o,l;var s=e.targetObject;var u;if(s){switch(s.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":case"com.sap.vocabularies.UI.v1.DataPointType":u=s.Value.$target;break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if((s===null||s===void 0?void 0:(i=s.Target)===null||i===void 0?void 0:(a=i.$target)===null||a===void 0?void 0:a.$Type)==="com.sap.vocabularies.UI.v1.DataPointType"){var v;u=(v=s.Target.$target)===null||v===void 0?void 0:v.Value.$target;break}case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForAction":default:u=undefined}}var d=t!==null&&t!==void 0&&t.isAnalytics?P.IsExpanded:T(false);var c=t!==null&&t!==void 0&&t.isAnalytics?I(P.NodeLevel,0):T(false);return D(U.apply(void 0,[m(I(O(s===null||s===void 0?void 0:(n=s.annotations)===null||n===void 0?void 0:(r=n.UI)===null||r===void 0?void 0:r.Hidden),true)),b(!!u,u&&m(I(O((o=u.annotations)===null||o===void 0?void 0:(l=o.UI)===null||l===void 0?void 0:l.Hidden),true)),true),g(m(d),c)]))};s.getVisibleExpression=k;var N=function(e,t,i){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var n=M(e,i,a);if(n===""){n=$(t,i,a)}return n};s.QVTextBinding=N;var H=function(e){var t,i,a,n,r,o;var l=e.targetObject;if(l!==null&&l!==void 0&&(t=l.$target)!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(a=i.Communication)!==null&&a!==void 0&&a.IsEmailAddress){return"email"}if(l!==null&&l!==void 0&&(n=l.$target)!==null&&n!==void 0&&(r=n.annotations)!==null&&r!==void 0&&(o=r.Communication)!==null&&o!==void 0&&o.IsPhoneNumber){return"phone"}return"text"};s.getQuickViewType=H;var z=function(e){var t=[];if(e){var i=Object.keys(e).filter(function(e){return e==="SemanticObject"||e.startsWith("SemanticObject#")});for(var a=0;a<i.length;a++){var n=D(O(e[i[a]]));t.push({key:(n===null||n===void 0?void 0:n.indexOf("{"))===-1?n:n===null||n===void 0?void 0:n.split("{")[1].split("}")[0],value:n})}}return t};s.getSemanticObjectExpressionToResolve=z;var R=function(e){if(e.length>0){var t="";var i="";var a=[];for(var n=0;n<e.length;n++){t=e[n].key;i=D(O(e[n].value));a.push({key:t,value:i})}var r=new l(a);r.$$valueAsPromise=true;var o=r.createBindingContext("/");return o}else{return new l([]).createBindingContext("/")}};s.getSemanticObjects=R;var L=function(e,t,i){if(e.wrap==="false"){return false}if(t!=="Edm.String"){return i}if(e.editMode==="Display"){return true}if(e.editMode.indexOf("{")>-1){return D(g(m(P.IsEditable),i))}return i};s.getMultipleLinesForDataField=L;var Q=function(e,t){return e.requestObject("/".concat(t,"/DraftAdministrativeData/"))};s._getDraftAdministrativeDataType=Q;var q=function(e,t){return Q(e.getModel(),t).then(function(e){var t=[];if(e.InProcessByUserDescription){t.push(p("DraftAdministrativeData/InProcessByUserDescription"))}t.push(p("DraftAdministrativeData/InProcessByUser"));if(e.LastChangedByUserDescription){t.push(p("DraftAdministrativeData/LastChangedByUserDescription"))}t.push(p("DraftAdministrativeData/LastChangedByUser"));return D(b(p("HasDraftEntity"),g.apply(void 0,t),f("")))})};s.getBindingForDraftAdminBlockInline=q;var K=function(e,t){var i=r.getAssociatedUnitProperty(e);var a=r.getAssociatedCurrencyProperty(e);return r.hasValueHelp(e)&&e.type!=="Edm.Boolean"||t!=="Hidden"&&(i&&r.hasValueHelp(i)||a&&r.hasValueHelp(a))};var _=function(e,t,i,a){var n,l,s,v,d,c,f,p,g,y,h,b;var O=i.targetObject;if(!r.isProperty(O)){e.editStyle=null;return}if(!a){e.valueBindingExpression=M(i,e.formatOptions)}switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(((n=t.Target)===null||n===void 0?void 0:(l=n.$target)===null||l===void 0?void 0:l.Visualization)==="UI.VisualizationType/Rating"){e.editStyle="RatingIndicator";return}break;case"com.sap.vocabularies.UI.v1.DataPointType":if((t===null||t===void 0?void 0:t.Visualization)==="UI.VisualizationType/Rating"){e.editStyle="RatingIndicator";return}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":e.editStyle=null;return;default:}if(K(O,(s=e.formatOptions)===null||s===void 0?void 0:s.measureDisplayMode)){if(!a){var I;e.textBindingExpression=w(i,e.formatOptions);if(((I=e.formatOptions)===null||I===void 0?void 0:I.measureDisplayMode)!=="Hidden"){e.valueBindingExpression=M(i,e.formatOptions,false,false,undefined,false,true)}}e.editStyle="InputWithValueHelp";return}switch(O.type){case"Edm.Date":e.editStyle="DatePicker";return;case"Edm.Time":case"Edm.TimeOfDay":e.editStyle="TimePicker";return;case"Edm.DateTime":case"Edm.DateTimeOffset":e.editStyle="DateTimePicker";if(!((v=O.annotations)!==null&&v!==void 0&&(d=v.Common)!==null&&d!==void 0&&d.Timezone)){e.showTimezone=undefined}else{e.showTimezone=true}return;case"Edm.Boolean":e.editStyle="CheckBox";return;case"Edm.Stream":e.editStyle="File";return;case"Edm.String":if((c=O.annotations)!==null&&c!==void 0&&(f=c.UI)!==null&&f!==void 0&&(p=f.MultiLineText)!==null&&p!==void 0&&p.valueOf()){e.editStyle="TextArea";return}break;default:e.editStyle="Input"}if((g=O.annotations)!==null&&g!==void 0&&(y=g.Measures)!==null&&y!==void 0&&y.ISOCurrency||(h=O.annotations)!==null&&h!==void 0&&(b=h.Measures)!==null&&b!==void 0&&b.Unit){if(!a){e.unitBindingExpression=D(o.getBindingForUnitOrCurrency(i));e.descriptionBindingExpression=o.ifUnitEditable(O,"",o.getBindingForUnitOrCurrency(i));var T=r.getAssociatedCurrencyProperty(O)||r.getAssociatedUnitProperty(O);e.unitEditable=D(m(u(T)))}e.editStyle="InputWithUnit";return}e.editStyle="Input"};q.requiresIContext=true;s.setEditStyleProperties=_;return s},false);
//# sourceMappingURL=FieldTemplating.js.map
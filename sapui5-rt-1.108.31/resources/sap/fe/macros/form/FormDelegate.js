/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/ui/model/json/JSONModel","sap/ui/model/ListBinding"],function(e,t,n,a){"use strict";var r={createLayout:function(a){try{var r=a.modifier,o=a.appComponent&&a.appComponent.getModel().getMetaModel(),i=a.element;return Promise.resolve(t.getCustomData(i,"entitySet",r)).then(function(l){function s(){var s=l.startsWith("/")?"".concat(l):"/".concat(l);var v=a.parentSelector?a.modifier.bySelector(a.parentSelector,a.appComponent,a.view):undefined;return Promise.resolve(t.getCustomData(v,"navigationPath",r)).then(function(l){var v=function(l,s,v){try{return Promise.resolve(t.getCustomData(i,"onChange",r)).then(function(u){return Promise.resolve(t.getCustomData(i,"displayMode",r)).then(function(i){var m;var p=new n({_flexId:(m=a.fieldSelector)===null||m===void 0?void 0:m.id,onChange:e.removeEscapeCharacters(u),displayMode:e.removeEscapeCharacters(i),navigationPath:v});var f={bindingContexts:{entitySet:d,dataField:c,this:p.createBindingContext("/")},models:{this:p,entitySet:o,metaModel:o,dataField:o}};return t.templateControlFragment(l,f,{view:s},r)})})}catch(e){return Promise.reject(e)}};var u=l?"".concat(s,"/").concat(l):s;var d=o.getMetaContext(u);var c=o.createBindingContext("".concat(u,"/").concat(a.bindingPath));var m=a.element.sId||a.element.id;function p(e){var i;var l=new n({id:m,idPrefix:(i=a.fieldSelector)===null||i===void 0?void 0:i.id}),s={bindingContexts:{entitySet:d,property:c,this:l.createBindingContext("/")},models:{this:l,entitySet:o,metaModel:o,property:o}};return t.templateControlFragment(e,s,{},r)}var f={sPropertyName:a.bindingPath,sBindingPath:u,sValueHelpType:"FormVH",oControl:i,oMetaModel:o,oModifier:r};return Promise.resolve(t.isValueHelpRequired(f)).then(function(e){return Promise.resolve(t.doesValueHelpExist(f)).then(function(t){function n(){return Promise.resolve(v("sap.fe.macros.form.FormElementFlexibility",a.view,l)).then(function(e){return{control:e,valueHelp:r}})}var r;var o=function(){if(e&&!t){return Promise.resolve(p("sap.fe.macros.form.ValueHelpWrapper")).then(function(e){r=e})}}();return o&&o.then?o.then(n):n(o)})})})}var v=function(){if(!l){return Promise.resolve(t.getCustomData(i,"navigationPath",r)).then(function(e){l=e})}}();return v&&v.then?v.then(s):s(v)})}catch(e){return Promise.reject(e)}},getPropertyInfo:function(e){function t(e){if(e&&e.$Type){if(e.$Type.toLowerCase().indexOf("edm")!==0){return true}}return false}function n(e,t){return t.some(function(t){return e.startsWith(t)})}function r(e,r,o,i,l,s,v){var u={name:e,bindingPath:e,entityType:i};var d=o["@com.sap.vocabularies.UI.v1.DataFieldDefault"];var c=d&&d.Label||o["@com.sap.vocabularies.Common.v1.Label"];u.label=c||"[LABEL_MISSING: "+e+"]";var m=o["@com.sap.vocabularies.UI.v1.Hidden"];u.hideFromReveal=m;if(m&&m.$Path){var p;u.hideFromReveal=(p=l.getBindingContext())===null||p===void 0?void 0:p.getProperty(m.$Path)}var f;if(!u.hideFromReveal){f=o["@com.sap.vocabularies.Common.v1.FieldControl"];if(f){u.hideFromReveal=f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Hidden"}}f=o["@com.sap.vocabularies.Common.v1.FieldControl"];var g=f&&f.Path;if(g&&!u.hideFromReveal){var h=l.getBinding(s)instanceof a;if(!h){var C;var P=(C=l.getBindingContext())===null||C===void 0?void 0:C.getProperty(g);u.hideFromReveal=P===0}}if(d&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation")){u.unsupported=true}if(n(e,v)||t(r)){u.unsupported=true}return u}function o(e,t,n,a,o){var i=[];var l="";var s=[];var v;for(l in e){v=e[l];if(v.$kind==="NavigationProperty"){s.push(l)}}for(l in e){v=e[l];if(v.$kind==="Property"){var u=n.getObject("/"+t+"/"+l+"@");var d=r(l,v,u,t,a,o,s);i.push(d)}}return i}function i(e,t){if(t.path){return t.path}var n=e.getBindingContext();if(n){if(e.data("navigationPath")){return n.getPath()+"/"+e.data("navigationPath")}return n.getPath()}}function l(e,t,n){var a=e.getModel(n.modelName);if(a){if(a.isA("sap.ui.model.odata.v4.ODataModel")){var r=a.getMetaModel();var l=i(e,n);if(l){var s=r.getMetaContext(l);var v=s.getObject();var u=s.getObject(v.$Type);return o(u,v.$Type,r,e,t)}}}return Promise.resolve([])}return Promise.resolve().then(function(){return l(e.element,e.aggregationName,e.payload)})}};return r},false);
//# sourceMappingURL=FormDelegate.js.map
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/SemanticKeyHelper","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,n,r,i,a){"use strict";function o(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}var s;function l(e,t){var n=Object.keys(e);var r=n.map(function(t){var n=e[t];if(n!==undefined){return new i(t,a.EQ,n)}});if(t){var o=new i({filters:[new i("SiblingEntity/IsActiveEntity",a.EQ,true)],and:false});r.push(o)}return new i(r,true)}function u(e,t,n){var r=e.getView().getBindingContext().getModel().bindList("/".concat(t),undefined,undefined,n,{$$groupId:"$auto.Heroes"});return r.requestContexts(0,2).then(function(e){if(e&&e.length){return e[0].getPath()}})}function c(e,t,n){var i=[];var a=[];var o=e.getModel().getMetaModel().getMetaPath(e.getPath());if(o.indexOf("/")===0){o=o.substring(1)}var s=o.split("/");var c=r.getInstance().getHash().split("?")[0];var f=c.split("/");var g={};var v=[];f.forEach(function(t){var n=t.substring(t.indexOf("(")+1,t.length-1).split(",");var r={};var i=t.split("(")[0];g[i]={};v.push(i);g[i]["bIsActiveEntityDefined"]=true;for(var a=0;a<n.length;a++){var o=n[a];var s=o.split("=");var l=s[1];var u=s[0];if(o.indexOf("=")===-1){var c=e.getModel().getMetaModel();var f=c.getObject("/".concat(v.join("/"),"/$Type/$Key"));l=s[0];u=f[0];g[t.split("(")[0]]["bIsActiveEntityDefined"]=false}if(u!=="IsActiveEntity"){if(l.indexOf("'")===0&&l.lastIndexOf("'")===l.length-1){l=decodeURIComponent(l.substring(1,l.length-1))}r[u]=l}}g[i].mKeyValues=r});var d=n;s.forEach(function(t){var r={};var i=d.$NavigationPropertyBinding&&d.$NavigationPropertyBinding[t];if(i){r.pageEntityName=d.$NavigationPropertyBinding[t];d=e.getModel().getMetaModel().getObject("/".concat(i))||n}else{r.pageEntityName=t}r.mKeyValues=g[t].mKeyValues;r.bIsActiveEntityDefined=g[t].bIsActiveEntityDefined;a.push(r)});a.forEach(function(e){var n=l(e.mKeyValues,e.bIsActiveEntityDefined);i.push(u(t,e.pageEntityName,n))});return i}function f(t,n){var i=r.getInstance().getHash().split("?")[0];var a=i&&i.substr(0,i.indexOf("("));if(a.indexOf("/")===0){a=a.substring(1)}var o=t.getModel().getMetaModel().getObject("/".concat(a));var s=t;var l=c(t,n,o);if(l.length>0){return Promise.all(l).then(function(e){var t=[];var n=o;if(e[0].indexOf("/")===0){t.push(e[0].substring(1))}else{t.push(e[0])}for(var r=1;r<e.length;r++){var i=e[r];var a="";var l=i&&i.substr(0,i.indexOf("("));if(l.indexOf("/")===0){l=l.substring(1)}if(i.indexOf("/")===0){i=i.substring(1)}a=Object.keys(n.$NavigationPropertyBinding)[Object.values(n.$NavigationPropertyBinding).indexOf(l)];if(a){t.push(i.replace(l,a));n=s.getModel().getMetaModel().getObject("/".concat(l))||o}else{t.push(i)}}return t}).catch(function(t){e.info("Failed to retrieve one or more active context path's",t)})}else{return Promise.resolve()}}function g(e,i){var a,o;var l=r.getInstance().getHash().split("?")[0];if(e){var u=e.getModel();var c=u.getMetaModel();s=t.isStickySessionSupported(c);var g=l&&l.substr(0,l.indexOf("("));if(g.indexOf("/")===0){g=g.substring(1)}o=n.getSemanticKeys(c,g)}var v=i.getView().getViewData();if(e&&!s&&(v.viewLevel===1&&!o||v.viewLevel>=2)){a=f(e,i);return a}else{return Promise.resolve()}}function v(e,t,n){var i;var a=r.getInstance().getHash();var o=r.getInstance().hrefForAppSpecificHash?r.getInstance().hrefForAppSpecificHash(""):"";if(e&&!t&&n){i=o+n.join("/")}else{i=a?o+a:window.location.hash}return window.location.origin+window.location.pathname+window.location.search+i}function d(){var t=sap.ushell&&sap.ushell.Container;if(t){return t.getFLPUrlAsync(true).then(function(e){return e}).catch(function(t){e.error("Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)",t)})}else{return Promise.resolve(document.URL)}}function p(t,n,i){var a;var o=r.getInstance().getHash();var s=r.getInstance().hrefForAppSpecificHash?r.getInstance().hrefForAppSpecificHash(""):"";if(t&&!n&&i){a=s+i.join("/")}else{a=o?s+o:window.location.hash}if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.runningInIframe&&sap.ushell.Container.runningInIframe()){sap.ushell.Container.getFLPUrl(true).then(function(e){return e.substr(0,e.indexOf("#"))+a}).catch(function(t){e.error("Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)",t)})}else{return Promise.resolve(window.location.origin+window.location.pathname+a)}}var h={adaptShareMetadata:function(t){try{var n=this;var r=n.base.getView().getBindingContext();var i=n.base.getView().getModel("ui");var a=i.getProperty("/isEditable");var l=o(function(){return Promise.resolve(g(r,n.base.getView().getController())).then(function(e){var r=n.base.getView().getController()._getPageTitleInformation();return Promise.resolve(Promise.all([p(a,s,e),v(a,s,e),d()])).then(function(e){var i=r.title;var a=r.subtitle?r.subtitle.toString():"";if(a){i="".concat(i," - ").concat(a)}t.tile={title:r.title,subtitle:a};t.email.title=i;t.title=i;t.jam.url=e[0];t.url=e[1];t.email.url=e[2];var o=n.base.getView().getModel("collaborationInfo");o.setProperty("/url",t.url);o.setProperty("/appTitle",t.title);o.setProperty("/subTitle",a)})})},function(t){e.error(t)});return Promise.resolve(l&&l.then?l.then(function(){return t}):t)}catch(e){return Promise.reject(e)}}};return h},false);
//# sourceMappingURL=Share.js.map
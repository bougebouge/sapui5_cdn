/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/collaboration/ActivitySync","sap/fe/core/controllerextensions/collaboration/Manage","sap/fe/core/controllerextensions/EditFlow","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalEditFlow","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/MassEdit","sap/fe/core/controllerextensions/MessageHandler","sap/fe/core/controllerextensions/PageReady","sap/fe/core/controllerextensions/Paginator","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/ViewState","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/ModelHelper","sap/fe/core/PageController","sap/fe/macros/chart/ChartRuntime","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/table/Utils","sap/fe/navigation/SelectionVariant","sap/fe/templates/ObjectPage/ExtensionAPI","sap/fe/templates/RootContainer/overrides/EditFlow","sap/fe/templates/TableScroller","sap/m/InstanceManager","sap/m/Link","sap/m/MessageBox","sap/ui/core/Core","sap/ui/core/mvc/OverrideExecution","sap/ui/model/odata/v4/ODataListBinding","./overrides/IntentBasedNavigation","./overrides/InternalRouting","./overrides/MessageHandler","./overrides/Paginator","./overrides/Share","./overrides/ViewState"],function(e,t,n,i,r,o,a,s,c,l,u,g,f,d,v,h,p,b,m,y,C,P,S,w,x,A,E,B,_,I,M,V,O,D,F,T,j,R,k,L,N,z,H,U){"use strict";var G,$,q,J,K,W,Q,X,Y,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,ue,ge,fe,de,ve,he,pe,be,me,ye,Ce;var Pe=P.usingExtension;var Se=P.publicExtension;var we=P.finalExtension;var xe=P.extensible;var Ae=P.defineUI5Class;var Ee=a.showUserDetails;var Be=a.openManageDialog;var _e=o.isConnected;var Ie=o.disconnect;var Me=o.connect;function Ve(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}function Oe(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}function De(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=je(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var i=0;var r=function(){};return{s:r,n:function(){if(i>=e.length)return{done:true};return{done:false,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,s;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){a=true;s=e},f:function(){try{if(!o&&n.return!=null)n.return()}finally{if(a)throw s}}}}function Fe(e){return ke(e)||Re(e)||je(e)||Te()}function Te(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function je(e,t){if(!e)return;if(typeof e==="string")return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}function Re(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ke(e){if(Array.isArray(e))return Le(e)}function Le(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,i=new Array(t);n<t;n++){i[n]=e[n]}return i}function Ne(e,t,n,i){if(!n)return;Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function ze(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function He(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Ue(e,t)}function Ue(e,t){Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return Ue(e,t)}function Ge(e,t,n,i,r){var o={};Object.keys(i).forEach(function(e){o[e]=i[e]});o.enumerable=!!o.enumerable;o.configurable=!!o.configurable;if("value"in o||o.initializer){o.writable=true}o=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},o);if(r&&o.initializer!==void 0){o.value=o.initializer?o.initializer.call(r):void 0;o.initializer=undefined}if(o.initializer===void 0){Object.defineProperty(e,t,o);o=null}return o}function $e(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var qe=(G=Ae("sap.fe.templates.ObjectPage.ObjectPageController"),$=Pe(b),q=Pe(s),J=Pe(m.override(H)),K=Pe(u.override(M)),W=Pe(f.override(L)),Q=Pe(p.override(z)),X=Pe(v.override(N)),Y=Pe(l.override(k)),Z=Pe(g.override({getNavigationMode:function(){var e=this.getView().getController().getStickyEditMode&&this.getView().getController().getStickyEditMode();return e?"explace":undefined}})),ee=Pe(y.override(U)),te=Pe(h.override({isContextExpected:function(){return true}})),ne=Pe(d),ie=Se(),re=we(),oe=Se(),ae=xe(j.After),G(se=(ce=function(o){He(a,o);function a(){var t;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++){r[a]=arguments[a]}t=o.call.apply(o,[this].concat(r))||this;Ne(t,"placeholder",le,ze(t));Ne(t,"editFlow",ue,ze(t));Ne(t,"share",ge,ze(t));Ne(t,"_editFlow",fe,ze(t));Ne(t,"_routing",de,ze(t));Ne(t,"paginator",ve,ze(t));Ne(t,"messageHandler",he,ze(t));Ne(t,"intentBasedNavigation",pe,ze(t));Ne(t,"_intentBasedNavigation",be,ze(t));Ne(t,"viewState",me,ze(t));Ne(t,"pageReady",ye,ze(t));Ne(t,"massEdit",Ce,ze(t));t.handlers={onPrimaryAction:function(e,t,n,i,r,o){var a=e.getView().getViewData().viewLevel,s=e._getObjectPageLayoutControl();if(o.positiveActionVisible){if(o.positiveActionEnabled){e.handlers.onCallAction(t,i,r)}}else if(o.editActionVisible&&a===1){if(o.editActionEnabled){e._editDocument(n)}}else if(a===1&&s.getModel("ui").getProperty("/isEditable")){e._saveDocument(n)}else if(s.getModel("ui").getProperty("/isEditable")){e._applyDocument(n)}},onTableContextChange:function(t){var n=this;var i=t.getSource();var r;this._findTables().some(function(e){if(e.getRowBinding()===i){r=e;return true}return false});var o=this._editFlow.getCurrentActionPromise();if(o){var a;if(r.getType().getMetadata().isA("sap.ui.mdc.table.GridTableType")){a=i.getContexts(0)}else{a=i.getCurrentContexts()}if(!a[0]){return}o.then(function(e){if(!e||e.controlId!==r.sId){return}var t=e.oData;var i=e.keys;var o=-1;a.find(function(e,n){var r=e.getObject();var a=i.every(function(e){return r[e]===t[e]});if(a){o=n}return a});if(o!==-1){var s=O.getOpenDialogs();var c=s.length>0?s.find(function(e){return e.data("FullScreenDialog")!==true}):null;if(c){c.attachEventOnce("afterClose",function(){r.focusRow(o,true)})}else{r.focusRow(o,true)}n._editFlow.deleteCurrentActionPromise()}}).catch(function(t){e.error("An error occurs while scrolling to the newly created Item: ".concat(t))})}this.messageButton.fireModelContextChange()},onCallAction:function(e,t,n){var i=e.getController();return i.editFlow.invokeAction(t,n).then(i._showMessagePopover.bind(i,undefined)).catch(i._showMessagePopover.bind(i))},onDataPointTitlePressed:function(e,t,n,r,o){n=typeof n==="string"?JSON.parse(n):n;var a=n[r],s=i.getSemanticObjectMapping(a),c=t.getBindingContext(),l=c.getModel().getMetaModel().getMetaPath(c.getPath());var u=e._getChartContextData(c,o);var g;u=u.map(function(e){return{data:e,metaPath:l+(o?"/".concat(o):"")}});if(a&&a.parameters){var f=a.parameters&&e._intentBasedNavigation.getOutboundParams(a.parameters);if(Object.keys(f).length>0){g=f}}if(a&&a.semanticObject&&a.action){e._intentBasedNavigation.navigate(a.semanticObject,a.action,{navigationContexts:u,semanticObjectMapping:s,additionalNavigationParameters:g})}},onChevronPressNavigateOutBound:function(e,t,n,i){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,n,i)},onNavigateChange:function(e){this.getExtensionAPI().updateAppState();this.bSectionNavigated=true;var t=this.getView().getBindingContext("internal");var n=this._getObjectPageLayoutControl();if(n.getModel("ui").getProperty("/isEditable")&&this.getView().getViewData().sectionLayout==="Tabs"&&t.getProperty("errorNavigationSectionFlag")===false){var i=e.getParameter("subSection");this._updateFocusInEditMode([i])}},onVariantSelected:function(){this.getExtensionAPI().updateAppState()},onVariantSaved:function(){var e=this;setTimeout(function(){e.getExtensionAPI().updateAppState()},500)},navigateToSubSection:function(t,n){var r=typeof n==="string"?JSON.parse(n):n;var o=t.getView().byId("fe::ObjectPage");var a;var s;if(r.sectionId){a=t.getView().byId(r.sectionId);s=r.subSectionId?t.getView().byId(r.subSectionId):a&&a.getSubSections()&&a.getSubSections()[0]}else if(r.subSectionId){s=t.getView().byId(r.subSectionId);a=s&&s.getParent()}if(!a||!s||!a.getVisible()||!s.getVisible()){t.getView().getModel("sap.fe.i18n").getResourceBundle().then(function(n){var r=i.getTranslatedText("C_ROUTING_NAVIGATION_DISABLED_TITLE",n,null,t.getView().getViewData().entitySet);e.error(r);F.error(r)}).catch(function(t){e.error(t)})}else{o.scrollToSection(s.getId());o.fireNavigate({section:a,subSection:s})}},onChartSelectionChanged:function(e){x.fnUpdateChart(e)},onStateChange:function(){this.getExtensionAPI().updateAppState()}};return t}var s=a.prototype;s.getExtensionAPI=function e(t){if(t){this.mCustomSectionExtensionAPIs=this.mCustomSectionExtensionAPIs||{};if(!this.mCustomSectionExtensionAPIs[t]){this.mCustomSectionExtensionAPIs[t]=new I(this,t)}return this.mCustomSectionExtensionAPIs[t]}else{if(!this.extensionAPI){this.extensionAPI=new I(this)}return this.extensionAPI}};s.onInit=function e(){o.prototype.onInit.call(this);var t=this._getObjectPageLayoutControl();var n=this.getView().getBindingContext("internal");n===null||n===void 0?void 0:n.setProperty("externalNavigationContext",{page:true});n===null||n===void 0?void 0:n.setProperty("relatedApps",{visibility:false,items:null});n===null||n===void 0?void 0:n.setProperty("batchGroups",this._getBatchGroupsForView());n===null||n===void 0?void 0:n.setProperty("errorNavigationSectionFlag",false);if(!this.getView().getViewData().useNewLazyLoading&&t.getEnableLazyLoading()){t.attachEvent("subSectionEnteredViewPort",this._handleSubSectionEnteredViewPort.bind(this))}this.messageButton=this.getView().byId("fe::FooterBar::MessageButton");this.messageButton.oItemBinding.attachChange(this._fnShowOPMessage,this)};s.onExit=function e(){if(this.mCustomSectionExtensionAPIs){for(var t=0,n=Object.keys(this.mCustomSectionExtensionAPIs);t<n.length;t++){var i=n[t];if(this.mCustomSectionExtensionAPIs[i]){this.mCustomSectionExtensionAPIs[i].destroy()}}delete this.mCustomSectionExtensionAPIs}if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI;var r=this.messageButton?this.messageButton.oMessagePopover:null;if(r&&r.isOpen()){r.close()}var o=this.getView().getBindingContext();if(o&&o.isKeepAlive()){o.setKeepAlive(false)}if(_e(this.getView())){Ie(this.getView())}};s._fnShowOPMessage=function e(){var t=this.getExtensionAPI();var n=this.getView();var i=this.messageButton.oMessagePopover.getItems().map(function(e){return e.getBindingContext("message").getObject()}).filter(function(e){var t;return e.getTargets()[0]===((t=n.getBindingContext())===null||t===void 0?void 0:t.getPath())});if(t){t.showMessages(i)}};s._getTableBinding=function e(t){return t&&t.getRowBinding()};s.checkSectionsForGridTable=function e(t){var n=this;var i=function(e,t){var r,o;var a=[].concat(Fe(t.getBlocks()),Fe(t.getMoreBlocks()));if(a.length===1&&(r=n.searchTableInBlock(a[0]))!==null&&r!==void 0&&(o=r.getType())!==null&&o!==void 0&&o.isA("sap.ui.mdc.table.GridTableType")){t.addStyleClass("sapUxAPObjectPageSubSectionFitContainer");t.detachEvent("modelContextChange",i,n)}};for(var r=t.length-1;r>=0;r--){if(t[r].getVisible()){var o=t[r];o.attachEvent("modelContextChange",o,i,this);break}}};s.searchTableInBlock=function e(t){var n=t.content;var i;if(t.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){if(n.isA("sap.m.Panel")&&n.data("FullScreenTablePlaceHolder")){i=n.data("tableAPIreference")}else if(n.isA("sap.fe.macros.table.TableAPI")){i=n}if(i){return i.content}}return undefined};s.onBeforeRendering=function e(){var t;w.prototype.onBeforeRendering.apply(this);if((t=this.oView.oViewData)!==null&&t!==void 0&&t.retrieveTextFromValueList&&A.getMetaModel()===undefined){A.setMetaModel(this.getAppComponent().getMetaModel())}};s.onAfterRendering=function t(){var n=this;this.getView().getModel("sap.fe.i18n").getResourceBundle().then(function(e){n.oResourceBundle=e}).catch(function(t){e.error("Error while retrieving the resource bundle",t)});var i;if(this._getObjectPageLayoutControl().getUseIconTabBar()){var r=this._getObjectPageLayoutControl().getSections();var o=De(r),a;try{for(o.s();!(a=o.n()).done;){var s=a.value;i=s.getSubSections();this.checkSectionsForGridTable(i)}}catch(e){o.e(e)}finally{o.f()}}else{i=this._getAllSubSections();this.checkSectionsForGridTable(i)}};s._onBeforeBinding=function e(t,n){var i=this;var r=this._findTables(),o=this._getObjectPageLayoutControl(),a=this.getView().getBindingContext("internal"),s=this.getView().getModel("internal"),c=a.getProperty("batchGroups"),l=this.getView().getViewData().viewLevel;var u;c.push("$auto");if(n.bDraftNavigation!==true){this._closeSideContent()}var g=o.getBindingContext();if(g&&g.hasPendingChanges()&&!c.some(g.getModel().hasPendingChanges.bind(g.getModel()))){g.getBinding().resetChanges()}for(var f=0;f<r.length;f++){u=r[f].getCreationRow();if(u){u.setBindingContext(null)}}var d=function(){if(!o.isFirstRendering()&&!n.bPersistOPScroll){o.setSelectedSection(null)}};o.attachEventOnce("modelContextChange",d);var v={onAfterRendering:d};o.addEventDelegate(v,this);this.pageReady.attachEventOnce("pageReady",function(){o.removeEventDelegate(v)});if(l>1){var h=n&&n.listBinding;var p=s.getProperty("/paginatorCurrentContext");if(p){var b=p.getBinding();this.paginator.initialize(b,p);s.setProperty("/paginatorCurrentContext",null)}else if(h){if(h.isA("sap.ui.model.odata.v4.ODataListBinding")){this.paginator.initialize(h,t)}else{var m=h.getPath();if(/\([^\)]*\)$/.test(m)){var y=m.replace(/\([^\)]*\)$/,"");h=new R(h.oModel,y);var C=function(){if(h.getContexts().length>0){i.paginator.initialize(h,t);h.detachEvent("change",C)}};h.getContexts(0);h.attachEvent("change",C)}else{this.paginator.initialize(undefined)}}}}if(!this.getView().getViewData().useNewLazyLoading&&o.getEnableLazyLoading()){var P=o.getSections();var S=o.getUseIconTabBar();var w=2;var x=o.getModel("ui").getProperty("/isEditable");var A=this.getView().getViewData().editableHeaderContent;for(var E=0;E<P.length;E++){var B=P[E];var _=B.getSubSections();for(var I=0;I<_.length;I++,w--){if(w<1||S&&(E>1||E===1&&!A&&!x)){var M=_[I];if(M.data().isVisibilityDynamic!=="true"){M.setBindingContext(null)}}}}}if(this.placeholder.isPlaceholderEnabled()&&n.showPlaceholder){var V=this.getView();var O=V.getParent().oContainer.getParent();if(O){O.showPlaceholder({})}}};s._getFirstClickableElement=function e(t){var n;var i=t.getHeaderTitle()&&t.getHeaderTitle().getActions();if(i&&i.length){n=i.find(function(e){if(e.isA("sap.fe.macros.share.ShareAPI")){return e.getVisible()}else if(!e.isA("sap.ui.core.InvisibleText")&&!e.isA("sap.m.ToolbarSpacer")){return e.getVisible()&&e.getEnabled()}})}return n};s._getFirstEmptyMandatoryFieldFromSubSection=function t(n){if(n){for(var i=0;i<n.length;i++){var r=n[i].getBlocks();if(r){for(var o=0;o<r.length;o++){var a=void 0;if(r[o].isA("sap.ui.layout.form.Form")){a=r[o].getFormContainers()}else if(r[o].getContent&&r[o].getContent()&&r[o].getContent().isA("sap.ui.layout.form.Form")){a=r[o].getContent().getFormContainers()}if(a){for(var s=0;s<a.length;s++){var c=a[s].getFormElements();if(c){for(var l=0;l<c.length;l++){var u=c[l].getFields();try{if(u[0].getRequired&&u[0].getRequired()&&!u[0].getValue()){return u[0]}}catch(t){e.debug("Error when searching for mandaotry empty field: ".concat(t))}}}}}}}}}return undefined};s._updateFocusInEditMode=function e(t){var n=this._getObjectPageLayoutControl();var i=this._getFirstEmptyMandatoryFieldFromSubSection(t);var r;if(i){r=i.content.getContentEdit()[0]}else{r=n._getFirstEditableInput()||this._getFirstClickableElement(n)}if(r){setTimeout(function(){r.focus()},0)}};s._handleSubSectionEnteredViewPort=function e(t){var n=t.getParameter("subSection");n.setBindingContext(undefined)};s._onBackNavigationInDraft=function e(t){this.messageHandler.removeTransitionMessages();if(this.getAppComponent().getRouterProxy().checkIfBackHasSameContext()){history.back()}else{c.processDataLossOrDraftDiscardConfirmation(function(){history.back()},Function.prototype,t,this,false,c.NavigationType.BackNavigation)}};s._onAfterBinding=function t(r,o){var a=this;var s=function(t,n){try{var i=t.getCreationRow();var r,o;var a=function(){if(i){var t=Ve(function(){return Promise.resolve(v).then(function(){var t=function(){if(i.getModel("ui").getProperty("/isEditable")){r=d.bindList(n.getPath(),n.getContext(),[],[],{$$updateGroupId:"doNotSubmit",$$groupId:"doNotSubmit"});r.refreshInternal=function(){};o=r.create();i.setBindingContext(o);var t=Ve(function(){return Promise.resolve(o.created()).then(function(){})},function(){e.trace("transient fast creation context deleted")});if(t&&t.then)return t.then(function(){})}}();if(t&&t.then)return t.then(function(){})})},function(t){e.error("Error while computing the final UI state",t)});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};var c=this._getObjectPageLayoutControl();var l=this._findTables();this._sideEffects.clearPropertiesStatus();r=c.getBindingContext();var u=[];c.getSections().forEach(function(e){e.getSubSections().forEach(function(e){u=i.getIBNActions(e,u)})});l.forEach(function(e){var t=e.getBindingContext("internal");t.setProperty("creationRowFieldValidity",{});t.setProperty("creationRowCustomValidity",{});u=i.getIBNActions(e,u);var r=e.getRowBinding();if(r){if(S.isStickySessionSupported(r.getModel().getMetaModel())){r.removeCachesAndMessages("")}}var o=JSON.parse(A.parseCustomData(E.getCustomData(e,"operationAvailableMap"))),a=e.getSelectedContexts();n.setActionEnablement(t,o,a,"table");e.clearSelection()});i.getSemanticTargetsFromPageModel(this,"_pageModel");var g=c.getHeaderTitle();var f=[];f=i.getIBNActions(g,f);u=u.concat(f);i.updateDataFieldForIBNButtonsVisibility(u,this.getView());var d,v;var h=function(t){var n=a._getTableBinding(t),i=function(){s(t,n)};if(!n){e.error("Expected binding missing for table: ".concat(t.getId()));return}if(n.oContext){i()}else{var r=function(){if(n.oContext){i();n.detachChange(r)}};n.attachChange(r)}};if(r){d=r.getModel();v=this._editFlow.computeEditMode(r);if(S.isCollaborationDraftSupported(d.getMetaModel())){v.then(function(){if(a.getView().getModel("ui").getProperty("/isEditable")){Me(a.getView())}else if(_e(a.getView())){Ie(a.getView())}}).catch(function(t){e.error("Error while waiting for the final UI State",t)})}if(r.getBinding().oCache){this._updateRelatedApps()}else{var p=function(){a._updateRelatedApps();r.getBinding().detachDataReceived(p)};r.getBinding().attachDataReceived(p)}var b=r.getBinding&&r.getBinding()||r;if(this.currentBinding!==b){b.attachEvent("patchSent",this.editFlow.handlePatchSent,this);this.currentBinding=b}l.forEach(function(t){B.whenBound(t).then(h).catch(function(t){e.error("Error while waiting for the table to be bound",t)})});if(!this.getView().getViewData().useNewLazyLoading){c._triggerVisibleSubSectionsEvents()}}};s.onPageReady=function t(n){var r=this;var o=function(){var e=r._getObjectPageLayoutControl();var t=!e.getModel("ui").getProperty("/isEditable");if(t){var n=r._getFirstClickableElement(e);if(n){n.focus()}}else{var i=T.byId(e.getSelectedSection());if(i){r._updateFocusInEditMode(i.getSubSections())}}};var a=this.getView();var s=a.getBindingContext("internal");var c=a.getBindingContext();if(c){var l=S.isStickySessionSupported(c.getModel().getMetaModel());if(!l){var u=i.getAppComponent(a);u.getShellServices().setBackNavigation(function(){return r._onBackNavigationInDraft(c)})}}this.getAppComponent().getAppStateHandler().applyAppState().then(function(){if(n.forceFocus){o()}}).catch(function(t){e.error("Error while setting the focus",t)});s.setProperty("errorNavigationSectionFlag",false);this._checkDataPointTitleForExternalNavigation()};s.getStickyEditMode=function e(){var t=this.getView().getBindingContext&&this.getView().getBindingContext();var n=false;if(t){var i=S.isStickySessionSupported(t.getModel().getMetaModel());if(i){n=this.getView().getModel("ui").getProperty("/isEditable")}}return n};s._getObjectPageLayoutControl=function e(){return this.byId("fe::ObjectPage")};s._getPageTitleInformation=function e(){var t=this._getObjectPageLayoutControl();var n=t.getCustomData().find(function(e){return e.getKey()==="ObjectPageSubtitle"});return{title:t.data("ObjectPageTitle")||"",subtitle:n&&n.getValue(),intent:"",icon:""}};s._executeHeaderShortcut=function e(t){var n="".concat(this.getView().getId(),"--").concat(t),r=this._getObjectPageLayoutControl().getHeaderTitle().getActions().find(function(e){return e.getId()===n});i.fireButtonPress(r)};s._executeFooterShortcut=function e(t){var n="".concat(this.getView().getId(),"--").concat(t),r=this._getObjectPageLayoutControl().getFooter().getContent().find(function(e){return e.getMetadata().getName()==="sap.m.Button"&&e.getId()===n});i.fireButtonPress(r)};s._executeTabShortCut=function e(t){var n=this._getObjectPageLayoutControl(),i=n.getSections(),r=i.length-1,o=t.oSource.getCommand();var a,s=n.indexOfSection(this.byId(n.getSelectedSection()));if(s!==-1&&r>0){if(o==="NextTab"){if(s<=r-1){a=i[++s]}}else if(s!==0){a=i[--s]}if(a){n.setSelectedSection(a);a.focus()}}};s._getFooterVisibility=function e(){var t=this.getView().getBindingContext("internal");var n=this.getView().getId();t.setProperty("messageFooterContainsErrors",false);sap.ui.getCore().getMessageManager().getMessageModel().getData().forEach(function(e){if(e.validation&&e.type==="Error"&&e.target.indexOf(n)>-1){t.setProperty("messageFooterContainsErrors",true)}})};s._showMessagePopover=function t(n,i){if(n){e.error(n)}var r=this.getAppComponent().getRootViewController();var o=r.isFclEnabled()?r.getRightmostView():this.getAppComponent().getRootContainer().getCurrentPage();if(!o.isA("sap.m.MessagePage")){var a=this.messageButton,s=a.oMessagePopover,c=s.getBinding("items");if(c.getLength()>0&&!s.isOpen()){a.setVisible(true);setTimeout(function(){s.openBy(a)},0)}}return i};s._editDocument=function e(t){var n=this.getView().getModel("ui");r.lock(n);return this.editFlow.editDocument.apply(this.editFlow,[t]).finally(function(){r.unlock(n)})};s.getDraftRootContext=function e(){try{var t=false;var n=this;var i=n.getView();var r=i.getBindingContext();var o=function(){if(r){function s(e){if(t)return e;t=true;return undefined}var e=S.getDraftRootPath(r);var o;var a=function(){if(e){var a,s,c;var l=(a=n.getAppComponent().getRootViewController().getInstancedViews().find(function(t){var n;return((n=t.getBindingContext())===null||n===void 0?void 0:n.getPath())===e}))===null||a===void 0?void 0:a.getBindingContext();if(l){t=true;return l}var u=i.getModel("internal");o=u.getProperty("/simpleDraftRootContext");if(((s=o)===null||s===void 0?void 0:s.getPath())===e){t=true;return o}var g=r.getModel();var f=g.getMetaModel();var d=f.getMetaPath(e);var v=C.getInvolvedDataModelObjects(f.getContext(d));o=g.bindContext(e).getBoundContext();return Promise.resolve(o.requestProperty((c=v.targetEntityType.keys[0])===null||c===void 0?void 0:c.name)).then(function(){u.setProperty("/simpleDraftRootContext",o);t=true;return o})}}();return a&&a.then?a.then(s):s(a)}}();return Promise.resolve(o&&o.then?o.then(function(e){return t?e:undefined}):t?o:undefined)}catch(e){return Promise.reject(e)}};s._validateDocument=function e(){try{var t=false;var n=this;var i=T.byId(T.getCurrentFocusedControlId());var r=i===null||i===void 0?void 0:i.getBindingContext();var o=function(){if(r&&!r.isTransient()){return Promise.resolve(n._editFlow.syncTask()).then(function(){var e=n.getAppComponent();var i=e.getSideEffectsService();var o=i.getEntityTypeFromContext(r);var a=o?i.getGlobalODataEntitySideEffects(o):[];return function(){if(a.length){var i=Promise.all(a.map(function(e){return n._sideEffects.requestSideEffects(e,r)}));t=true;return i}else{return Promise.resolve(n.getDraftRootContext()).then(function(n){if(n){var i=c.executeDraftValidation(n,e);t=true;return i}})}}()})}}();return Promise.resolve(o&&o.then?o.then(function(e){return t?e:undefined}):t?o:undefined)}catch(e){return Promise.reject(e)}};s._saveDocument=function e(t){try{var n=this;var i=n.getView().getModel("ui"),o=[];var a=false;r.lock(i);n._findTables().forEach(function(e){var t=n._getTableBinding(e);var i={creationMode:e.data("creationMode"),creationRow:e.getCreationRow(),createAtEnd:e.data("createAtEnd")==="true"};var r=i.creationRow&&i.creationRow.getBindingContext()&&Object.keys(i.creationRow.getBindingContext().getObject()).length>1;if(r){i.bSkipSideEffects=true;a=true;o.push(n.editFlow.createDocument(t,i).then(function(){return t}))}});return Promise.resolve(Oe(function(){return Promise.resolve(Promise.all(o)).then(function(e){var i={bExecuteSideEffectsOnError:a,bindings:e};return Ve(function(){return Promise.resolve(n.editFlow.saveDocument(t,i)).then(function(){})},function(e){n._showMessagePopover(e);throw e})})},function(e,t){if(r.isLocked(i)){r.unlock(i)}if(e)throw t;return t}))}catch(e){return Promise.reject(e)}};s._manageCollaboration=function e(){Be(this.getView())};s._showCollaborationUserDetails=function e(t){Ee(t,this.getView())};s._cancelDocument=function e(t,n){n.cancelButton=this.getView().byId(n.cancelButton);return this.editFlow.cancelDocument(t,n)};s._applyDocument=function e(t){var n=this;return this.editFlow.applyDocument(t).catch(function(){return n._showMessagePopover()})};s._updateRelatedApps=function e(){var t=this._getObjectPageLayoutControl();if(i.resolveStringtoBoolean(t.data("showRelatedApps"))){i.updateRelatedAppsDetails(t)}};s._findControlInSubSection=function e(t,n,i,r){for(var o=0;o<t.length;o++){var a=t[o].getContent instanceof Function&&t[o].getContent();if(r){if(a&&a.mAggregations&&a.getAggregation("items")){var s=a.getAggregation("items");s.forEach(function(e){if(e.isA("sap.fe.macros.chart.ChartAPI")){a=e}})}}if(a&&a.isA&&a.isA("sap.ui.layout.DynamicSideContent")){a=a.getMainContent instanceof Function&&a.getMainContent();if(a&&a.length>0){a=a[0]}}if(a&&a.isA&&a.isA("sap.fe.macros.table.TableAPI")){a=a.getContent instanceof Function&&a.getContent();if(a&&a.length>0){a=a[0]}}if(a&&a.isA&&a.isA("sap.ui.mdc.Table")){i.push(a)}if(a&&a.isA&&a.isA("sap.fe.macros.chart.ChartAPI")){a=a.getContent instanceof Function&&a.getContent();if(a&&a.length>0){a=a[0]}}if(a&&a.isA&&a.isA("sap.ui.mdc.Chart")){i.push(a)}}};s._getAllSubSections=function e(){var t=this._getObjectPageLayoutControl();var n=[];t.getSections().forEach(function(e){n=n.concat(e.getSubSections())});return n};s._getAllBlocks=function e(){var t=[];this._getAllSubSections().forEach(function(e){t=t.concat(e.getBlocks())});return t};s._findTables=function e(){var t=this._getAllSubSections();var n=[];for(var i=0;i<t.length;i++){this._findControlInSubSection(t[i].getBlocks(),t[i],n);this._findControlInSubSection(t[i].getMoreBlocks(),t[i],n)}return n};s._findCharts=function e(){var t=this._getAllSubSections();var n=[];for(var i=0;i<t.length;i++){this._findControlInSubSection(t[i].getBlocks(),t[i],n,true);this._findControlInSubSection(t[i].getMoreBlocks(),t[i],n,true)}return n};s._closeSideContent=function e(){this._getAllBlocks().forEach(function(e){var t=e.getContent instanceof Function&&e.getContent();if(t&&t.isA&&t.isA("sap.ui.layout.DynamicSideContent")){if(t.setShowSideContent instanceof Function){t.setShowSideContent(false)}}})};s._getChartContextData=function e(t,n){var i=t.getObject();var r=[i];if(t&&n){if(i[n]){r=i[n];delete i[n];r.push(i)}}return r};s._scrollTablesToRow=function e(t){if(this._findTables&&this._findTables().length>0){var n=this._findTables();for(var i=0;i<n.length;i++){V.scrollTableToRow(n[i],t)}}};s._mergeMultipleContexts=function e(t,n,r){var o=this;var a=[],s=[],c,l,u;var g=t.getPath();var f=t&&t.getModel()&&t.getModel().getMetaModel();var d=f&&f.getMetaPath(g).replace(/^\/*/,"");if(n&&n.length){c=n[0];u=c.getPath();l=f&&f.getMetaPath(u).replace(/^\/*/,"");n.forEach(function(e){if(r){var t=o._getChartContextData(e,r);if(t){a=t.map(function(e){return{contextData:e,entitySet:"".concat(d,"/").concat(r)}})}}else{a.push({contextData:e.getObject(),entitySet:l})}})}s.push({contextData:t.getObject(),entitySet:d});s=i.removeSensitiveData(s,f);var v=i.addPageContextToSelectionVariant(new _,s,this.getView());a=i.removeSensitiveData(a,f);return{selectionVariant:v,attributes:a}};s._getBatchGroupsForView=function e(){var t=this.getView().getViewData(),n=t.controlConfiguration,i=n&&Object.keys(n),r=["$auto.Heroes","$auto.Decoration","$auto.Workers"];if(i&&i.length>0){i.forEach(function(e){var t=n[e];if(t.requestGroupId==="LongRunners"){r.push("$auto.LongRunners")}})}return r};s._setBreadcrumbLinks=function t(n){try{var i;var r=this;var o=n.getBindingContext(),a=r.getAppComponent(),s=[],c=[],l=o===null||o===void 0?void 0:o.getPath(),u=(i=l===null||l===void 0?void 0:l.split("/"))!==null&&i!==void 0?i:[],g=a&&a.getMetaModel();var f="";var d=Ve(function(){u.shift();u.splice(-1,1);u.forEach(function(e){f+="/".concat(e);var t=a.getRootViewController();var n=g.getMetaPath(f);var i=g.getObject("".concat(n,"/@com.sap.vocabularies.Common.v1.ResultContext"));if(i){c.push(1);return}else{c.push(0)}s.push(t.getTitleInfoFromPath(f))});return Promise.resolve(Promise.all(s)).then(function(e){var t,i,r;var o=De(e),a;try{for(o.s();!(a=o.n()).done;){var s=a.value;i=e.indexOf(s);t=i-c[i];r=n.getLinks()[t]?n.getLinks()[t]:new D;r.setText(s.subtitle||s.title);r.setHref(encodeURI(s.intent));if(!n.getLinks()[t]){n.addLink(r)}}}catch(e){o.e(e)}finally{o.f()}})},function(t){e.error("Error while setting the breadcrumb links:"+t)});return Promise.resolve(d&&d.then?d.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};s._checkDataPointTitleForExternalNavigation=function n(){var r=this.getView();var o=r.getBindingContext("internal");var a=i.getHeaderFacetItemConfigForExternalNavigation(r.getViewData(),this.getAppComponent().getRoutingService().getOutbounds());var s=this.getAppComponent().getShellServices();var c=r&&r.getBindingContext();o.setProperty("isHeaderDPLinkVisible",{});if(c){c.requestObject().then(function(e){g(a,e)}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})}function l(t){e.error(t)}function u(e,t){var n=e;if(t&&t.length===1&&t[0].supported){o.setProperty("isHeaderDPLinkVisible/".concat(n),true)}}function g(e,n){var i=function(i){var o=e[i];var a={};var c=r.byId(i);if(!c){return"continue"}var g=c.getBindingContext();var f=g&&g.getObject();var d=t({},n,f);if(o.semanticObjectMapping){var v=o.semanticObjectMapping;for(var h in v){var p=v[h];var b=p["LocalProperty"]["$PropertyPath"];var m=p["SemanticObjectProperty"];if(b!==m){if(d.hasOwnProperty(b)){var y={};y[m]=d[b];d=t({},d,y);delete d[b]}}}}if(d){for(var C in d){if(C.indexOf("_")!==0&&C.indexOf("odata.context")===-1){a[C]=d[C]}}}s.isNavigationSupported([{target:{semanticObject:o.semanticObject,action:o.action},params:a}]).then(function(e){return u(i,e)}).catch(l)};for(var o in e){var a=i(o);if(a==="continue")continue}}};return a}(w),le=Ge(ce.prototype,"placeholder",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Ge(ce.prototype,"editFlow",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=Ge(ce.prototype,"share",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Ge(ce.prototype,"_editFlow",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Ge(ce.prototype,"_routing",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=Ge(ce.prototype,"paginator",[Q],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Ge(ce.prototype,"messageHandler",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Ge(ce.prototype,"intentBasedNavigation",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),be=Ge(ce.prototype,"_intentBasedNavigation",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),me=Ge(ce.prototype,"viewState",[ee],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=Ge(ce.prototype,"pageReady",[te],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=Ge(ce.prototype,"massEdit",[ne],{configurable:true,enumerable:true,writable:true,initializer:null}),Ge(ce.prototype,"getExtensionAPI",[ie,re],Object.getOwnPropertyDescriptor(ce.prototype,"getExtensionAPI"),ce.prototype),Ge(ce.prototype,"onPageReady",[oe,ae],Object.getOwnPropertyDescriptor(ce.prototype,"onPageReady"),ce.prototype),ce))||se);return qe},false);
//# sourceMappingURL=ObjectPageController.controller.js.map
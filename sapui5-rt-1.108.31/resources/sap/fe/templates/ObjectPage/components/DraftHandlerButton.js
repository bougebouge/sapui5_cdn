/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ClassSupport","sap/fe/templates/ObjectPage/ObjectPageTemplating","sap/m/Button","sap/m/ResponsivePopover","sap/m/SelectList","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/core/jsx-runtime/jsx","sap/fe/core/jsx-runtime/jsxs","sap/fe/core/jsx-runtime/Fragment"],function(e,t,i,r,n,a,o,c,l,s,p,f,u,d){"use strict";var v,_,T,h,b,A,g,O,w,m,E;var S={};var C=a.getSwitchDraftAndActiveVisibility;var y=n.defineReference;var I=r.pathInModel;var D=r.not;var P=r.ifElse;var B=r.and;var R=i.UI;var j=i.Entity;var x=e.xmlAttribute;var H=e.defineBuildingBlock;var V=e.BuildingBlockBase;function z(e,t,i,r){if(!i)return;Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function K(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function M(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;F(e,t)}function F(e,t){F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,i){t.__proto__=i;return t};return F(e,t)}function N(e,t,i,r,n){var a={};Object.keys(r).forEach(function(e){a[e]=r[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function W(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var Y=(v=H({name:"DraftHandlerButton",namespace:"sap.fe.templates.ObjectPage.components",isRuntime:true}),_=x({type:"string"}),T=x({type:"sap.ui.model.Context"}),h=y(),b=y(),v(A=(g=function(e){M(i,e);function i(i){var r;r=e.call(this,i)||this;r.SWITCH_TO_DRAFT_KEY="switchToDraft";r.SWITCH_TO_ACTIVE_KEY="switchToActive";z(r,"id",O,K(r));z(r,"contextPath",w,K(r));z(r,"switchToActiveRef",m,K(r));z(r,"switchToDraftRef",E,K(r));r.initialSelectedKey=r.SWITCH_TO_ACTIVE_KEY;r.handleSelectedItemChange=function(e){var t=e.getParameter("item").getProperty("key");if(t!==r.initialSelectedKey){r._containingView.getController().editFlow.toggleDraftActive(r._containingView.getBindingContext())}if(r.popover){r.popover.close();r.popover.destroy();delete r.popover}};r.openSwitchActivePopover=function(e){var i=e.getSource();var n=t.getTargetView(i);var a=n.getBindingContext();var o=a.getObject().IsActiveEntity;r.initialSelectedKey=o?r.SWITCH_TO_ACTIVE_KEY:r.SWITCH_TO_DRAFT_KEY;r.popover=r.createPopover();r._containingView=n;n.addDependent(r.popover);r.popover.openBy(i);r.popover.attachEventOnce("afterOpen",function(){if(o){var e;(e=r.switchToDraftRef.current)===null||e===void 0?void 0:e.focus()}else{var t;(t=r.switchToActiveRef.current)===null||t===void 0?void 0:t.focus()}});return r.popover};return r}S=i;var r=i.prototype;r.createPopover=function e(){return f(c,{showHeader:false,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiNoContentPadding",placement:"Bottom",children:u(l,{selectedKey:this.initialSelectedKey,itemPress:this.handleSelectedItemChange,children:[f(p,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_DRAFT_MIT}",ref:this.switchToDraftRef},this.SWITCH_TO_DRAFT_KEY),f(p,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_SAVED_VERSION_MIT}",ref:this.switchToActiveRef},this.SWITCH_TO_ACTIVE_KEY)]})})};r.render=function e(){var t=P(B(D(R.IsEditable),D(R.IsCreateMode),j.HasDraft),I("C_COMMON_OBJECT_PAGE_SAVED_VERSION_BUT","sap.fe.i18n"),I("C_COMMON_OBJECT_PAGE_DRAFT_BUT","sap.fe.i18n"));var i=C(this.contextPath.getObject("@"));return u(d,{children:[f(o,{id:"fe::StandardAction::SwitchDraftAndActiveObject",text:t,visible:i,icon:"sap-icon://navigation-down-arrow",iconFirst:false,type:"Transparent",press:this.openSwitchActivePopover,ariaDescribedBy:["fe::StandardAction::SwitchDraftAndActiveObject::AriaTextDraftSwitcher"]}),f(s,{text:"{sap.fe.i18n>T_HEADER_DATAPOINT_TITLE_DRAFT_SWITCHER_ARIA_BUTTON}",id:"fe::StandardAction::SwitchDraftAndActiveObject::AriaTextDraftSwitcher"})]})};return i}(V),O=N(g.prototype,"id",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),w=N(g.prototype,"contextPath",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),m=N(g.prototype,"switchToActiveRef",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),E=N(g.prototype,"switchToDraftRef",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),g))||A);S=Y;return S},false);
//# sourceMappingURL=DraftHandlerButton.js.map
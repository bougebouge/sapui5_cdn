sap.ui.define(["sap/ovp/cards/AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ui/model/FilterOperator","sap/ovp/cards/ovpLogger"],function(e,t,r,n){"use strict";var a=new n("OVP.linklist.AnnotationHelper");function i(e){var t=[];var r,n;var a=e.getProperty("/sortBy");if(a){var i=e.getProperty("/sortOrder");if(i&&i.toLowerCase()!=="descending"){n=false}else{n=true}r={path:a,descending:n};t.push(r)}return t}function o(t,n){var i=[];var o=t.getProperty("/filters");if(o){i=i.concat(o)}var s=n&&n.SelectOptions;var f,l,u;if(s){for(var g=0;g<s.length;g++){f=s[g];l=f.PropertyName.PropertyPath;for(var p=0;p<f.Ranges.length;p++){u=f.Ranges[p];if(u.Sign.EnumMember){var d={path:l,operator:u.Option.EnumMember.split("/")[1],value1:e.getPrimitiveValue(u.Low),value2:e.getPrimitiveValue(u.High),sign:u.Sign.EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(d.sign==="E"&&d.operator!==r.EQ){a.error("Exclude sign is supported only with EQ operator");continue}if(d.sign==="E"&&d.operator===r.EQ){d.operator=r.NE;d.sign="I"}if(d.operator==="CP"&&d.sign==="I"){var c=r.Contains;var v=d.value1;if(v){var y=v.indexOf("*");var P=v.lastIndexOf("*");if(y>-1){if(y===0&&P!==v.length-1){c=r.EndsWith;v=v.substring(1,v.length)}else if(y!==0&&P===v.length-1){c=r.StartsWith;v=v.substring(0,v.length-1)}else{v=v.substring(1,v.length-1)}}}d.operator=c;d.value1=v}i.push(d)}}}}return i}function s(t,r,n){var a=t.getSetting("ovpCardProperties");var s=a.getProperty("/metaModel");var f=s.getODataEntityType(r.entityType);var l="/"+r.name;var u=f[a.getProperty("/selectionAnnotationPath")];var g;var p=a.getProperty("/layoutDetail");if(p==="resizable"){var d=a.getProperty("/cardLayout");if(d){if(a.getProperty("/listFlavor")==="standard"){var c="";for(var v in n){c+=v}var y=a.getProperty("/cardLayout/iRowHeigthPx");if(y===undefined){y=16}var P;if(a.getProperty("/densityStyle")==="cozy"){P=72;if(c.indexOf("Description")===-1&&(c.indexOf("Title")>0&&c.indexOf("ImageUrl")>0||c.indexOf("Title")>0&&c.indexOf("TypeImageUrl")>0)){P=56}else if(c.indexOf("Description")===-1&&c.indexOf("Title")>0){P=48}}else{P=60;if(c.indexOf("Description")===-1&&(c.indexOf("Title")>0&&c.indexOf("ImageUrl")>0||c.indexOf("Title")>0&&c.indexOf("TypeImageUrl")>0)){P=48}else if(c.indexOf("Description")===-1&&c.indexOf("Title")>0){P=40}}a.setProperty("/cardLayout/itemHeight",P);if(!a.getProperty("/defaultSpan")&&a.getProperty("/cardLayout/autoSpan")){g=a.getProperty("/cardLayout/noOfItems");var m=Math.ceil((g*P+a.getProperty("/cardLayout/headerHeight")+2*a.getProperty("/cardLayout/iCardBorderPx"))/y);a.setProperty("/cardLayout/noOfItems",m)}else{var h=Math.floor(d.rowSpan*y-a.getProperty("/cardLayout/headerHeight")-2*a.getProperty("/cardLayout/iCardBorderPx"));g=Math.floor(h/P)*d.colSpan}}}}else{g=6}var O=t.getSetting("ovpCardProperties"),x=O.getProperty("/parameters");if(u||!!x){if(u&&u.Parameters||!!x){l=e.resolveParameterizedEntitySet(t.getSetting("dataModel"),r,u,x)}}var I="{path: '"+l+"', length: "+g;var S=i(a);if(S.length>0){I=I+", sorter:"+JSON.stringify(S)}var L=o(a,u);if(L.length>0){I=I+", filters:"+JSON.stringify(L)}var w=e.checkFilterPreference(a);if(w){I=I+", parameters:{custom: {cardId: '"+a.getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}}"}else{I=I+", parameters:{custom: {_requestFrom: 'ovp_internal'}}"}I=I+"}";return I}s.requiresIContext=true;function f(e,t){var r=e.getModel().getProperty("/baseUrl");return v(r,t)}f.requiresIContext=true;function l(e,r){var n=true;var a=t.format(e,r);if(a.toLowerCase().indexOf("icon")>0){n=false}return n}l.requiresIContext=true;function u(e){var t=true;if(!e){return null}else if(e.toLowerCase().indexOf("icon")>0){t=false}return t}function g(e){var t=new RegExp("http(s)?://(www.)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?","i");return t.test(e)}function p(e){var t;if(e.hasOwnProperty("Path")){t="{"+e.Path+"}"}else{t=e.String}return t}function d(e){var t="{"+e.String+"}";return t}function c(e){if(e){return 1}return 0}function v(e,t){if(!t){return undefined}else if(t.lastIndexOf(e,0)===0||t.indexOf("://")>0){return t}else if(t.lastIndexOf("/",0)===0){return e+t}else{return e+"/"+t}}function y(e,t,r){var n;if(typeof r==="object"){n=r[e]}else{n=typeof r==="boolean"?r:true}return!t[e]&&n}function P(e,t,r){var n="";if(e){if(t&&r){n="#"+t+"-"+r;for(var a=0;a<e.length;a++){if(e[a].value===n){return e[a].name}}n=""}else{return e[0].name}}return n}function m(e,t){return v(e.baseUrl,t)}function h(e){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","")}function O(e){return e.Path&&"{"+e.Path+"}"||e.String||""}return{formatItems:s,formatUrl:f,isImageUrl:l,isImageUrlStaticData:u,isValidURL:g,getIconPath:p,formatString:d,linkedAction:c,formUrl:v,isVisible:y,getApplicationName:P,getImageUrl:m,contentRowIndex:h,getAvatarInitials:O}},true);
//# sourceMappingURL=AnnotationHelper.js.map
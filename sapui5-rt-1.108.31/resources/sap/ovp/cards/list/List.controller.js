sap.ui.define(["sap/ovp/cards/generic/Card.controller","sap/ui/thirdparty/jquery","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/cards/AnnotationHelper","sap/ovp/app/OVPUtils","sap/ovp/cards/ovpLogger","sap/ovp/cards/jUtils","sap/ovp/app/FilterHelper","sap/ovp/filter/FilterUtils","sap/ui/core/Core","sap/ovp/cards/Integration/IntegrationCard"],function(e,jQuery,t,a,i,n,s,r,o,d,l,p,h){"use strict";var g=new r("OVP.list.List");return e.extend("sap.ovp.cards.list.List",{counter:0,arrayLength:0,minMaxModel:{},onInit:function(){e.prototype.onInit.apply(this,arguments);this.counter=0;this.minMaxModel=new t;this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");var a=this;this.eventhandler=function(e,t,i){l.applyFiltersToV2Card(i,a)};this.GloabalEventBus=p.getEventBus();if(this.oMainComponent&&this.oMainComponent.isMacroFilterBar){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",a.eventhandler)}},onContactDetailsLinkPress:function(e){var t,a,i;a=e.getSource();t=a.getParent().getAggregation("items")[0];i=a.getBindingContext();if(!i){return}t.bindElement(i.getPath());t.openBy(a)},onAfterRendering:function(){e.prototype.onAfterRendering.apply(this,arguments);var t=this.getCardPropertiesModel().getProperty("/imageSupported");var i=this.getCardPropertiesModel().getProperty("/densityStyle");if(t){var n=this.byId("ovpList");n.attachUpdateFinished(function(){this._addImageCss(i)}.bind(this))}if(!a.checkIfAPIIsUsed(this)&&this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var s=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var r=Math.max(s.dashboardLayout.headerHeight,this.getHeaderHeight());var o=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var d=document.getElementById(o);if(!s.dashboardLayout.autoSpan){d.getElementsByClassName("sapOvpWrapper")[0].style.height=s.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX-(r+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px"}if(s.dashboardLayout.showOnlyHeader){d.classList.add("sapOvpMinHeightContainer")}}if(this.getView()&&this.getView().byId("sapOvpCardInsights")){this.getView().byId("sapOvpCardInsights").setEnabled(true)}},_addImageCss:function(e){var t=this.byId("ovpList");var a=t.getItems();var i=false;var n=t.getDomRef().getAttribute("class");if(e==="cozy"){n=n+" sapOvpListImageCozy"}else{n=n+" sapOvpListImageCompact"}t.getDomRef().setAttribute("class",n);a.forEach(function(e){if(e.getIcon().indexOf("icon")!=-1){i=true}});a.forEach(function(t){var a=t.getDomRef();var n;if(a&&a.children[0]&&a.children[0].children[0]){n=a.children[0].children[0]}var s=t.getDescription();var r=t.getIcon();var o=i;var d=t.getTitle();var l=d.split(" ").map(function(e){return e?e[0].toUpperCase():""}).join("").substring(0,2);if(r!=""&&r.indexOf("icon")==-1){i=false}if(i&&a.children[0]){jQuery(a.children[0]).addClass("sapOvpIconListItem")}else if(a.children[0]){jQuery(a.children[0]).addClass("sapOvpImageListItem")}if(n&&e==="cozy"&&i===false){if(n){var p=n.getAttribute("class");p=p+" sapOvpImageCozy";n.setAttribute("class",p)}}var h="";if(i===true&&s===""){h=e==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy"}else if(i===false&&s===""){h=e==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy"}else{h=e==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy"}t.addStyleClass(h);if(a&&a.children[0]&&r===""&&a.children[0].id!=="ovpIconImagePlaceHolder"){var g=document.createElement("div");g.innerText=l;g.setAttribute("id","ovpIconImagePlaceHolder");g.className=i===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(i===false&&e==="cozy"){g.className=g.className+" sapOvpImageCozy"}a.insertBefore(g,a.children[0])}i=o})},onListItemPress:function(e){var t=s.bCRTLPressed?s.constants.explace:s.constants.inplace;s.bCRTLPressed=false;if(a.checkIfAPIIsUsed(this)){if(this.checkAPINavigation()){i.onContentClicked(e)}}else{var n=this.getEntityNavigationEntries(e.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(e.getSource().getBindingContext(),n[0],t)}},getCardItemsBinding:function(){var e=this.getView().byId("ovpList");return e&&e.getBinding("items")},_getMinMaxObjectFromContext:function(e){this.counter++;var t=this.getEntityType(),a=this.getCardPropertiesModel().getProperty("/annotationPath"),i=t[a],s=this.getMetaModel().createBindingContext(t.$path+"/"+a),r={minValue:0,maxValue:0};if(n.isFirstDataPointPercentageUnit(s,i)){r.minValue=0;r.maxValue=100;r.isPercentage=true;return r}var o=n.getFirstDataPointValue(s,i),d=this.getView().byId("ovpList"),l=d.getBinding("items"),p=this.getModel(),h=l.getCurrentContexts();for(var g=0;e?g<e:g<h.length;g++){var c=p.getOriginalProperty(o,h[g]),u=parseFloat(c,10);if(u<r.minValue){r.minValue=u}else if(u>r.maxValue){r.maxValue=u}}return r},_updateMinMaxModel:function(e){var t=this._getMinMaxObjectFromContext(e);this.minMaxModel.setData({minValue:t.minValue,maxValue:t.maxValue,isPercentage:t.isPercentage||false});this.minMaxModel.refresh();return t},returnBarChartValue:function(e){this._updateMinMaxModel();var t=parseFloat(e,10);return t},getCardItemBindingInfo:function(){var e=this.getView().byId("ovpList");return e.getBindingInfo("items")},resizeCard:function(e,t){var a,i,n;try{var s=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),r=this.getCardItemBindingInfo(),o=this.getHeaderHeight(),d=this.getView().byId("ovpCardContentContainer").getDomRef();if(e.showOnlyHeader){d.classList.add("sapOvpContentHidden");a=0}else{d.classList.remove("sapOvpContentHidden");n=o+t.dropDownHeight;i=e.rowSpan*e.iRowHeightPx-n;a=Math.abs(Math.floor(i/t.itemHeight));s.style.height=e.rowSpan*e.iRowHeightPx+"px"}d.style.height=e.rowSpan*e.iRowHeightPx-(o+2*e.iCardBorderPx)+"px";if(a!==r.length){r.length=a;e.noOfItems=r.length;this._updateMinMaxModel(r.length);this.getCardItemsBinding().refresh()}else{this._handleCountHeader()}}catch(e){g.warning("OVP resize: "+this.cardId+" catch "+e.toString())}},onShowInsightCardPreview:function(e){var t=e.getSource()&&e.getSource().getParent();if(t){t.close()}var a=this.getView();var i=a.getController();var n=i.oCardComponentData;var s=this;h.showCard({entitySet:i.entitySet,entityType:i.entityType,cardComponentName:"List",cardComponentData:n,cardComponent:i.oCardComponent,itemBindingInfo:s.getCardItemBindingInfo(),view:a}).then(function(e){s.saveGeneratedCardManifest(e)})}})});
//# sourceMappingURL=List.controller.js.map
sap.ui.define(["sap/ovp/cards/v4/generic/Card.controller","sap/ui/thirdparty/jquery","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/CommonUtils","sap/ovp/cards/v4/V4AnnotationHelper","sap/ovp/app/OVPUtils","sap/ovp/cards/ovpLogger","sap/ovp/cards/jUtils","sap/ovp/cards/Filterhelper","sap/ovp/filter/FilterUtils","sap/ui/core/Core"],function(t,jQuery,e,a,i,s,r,n,o,d,l,h){"use strict";var g=new n("OVP.v4.list.List");return t.extend("sap.ovp.cards.v4.list.List",{counter:0,arrayLength:0,minMaxModel:{},onInit:function(){t.prototype.onInit.apply(this,arguments);this.counter=0;this.minMaxModel=new e;this.minMaxModel.setData({minValue:0,maxValue:0});this.getView().setModel(this.minMaxModel,"minMaxModel");var a=this;this.eventhandler=function(t,e,i){l.applyFiltersToV4Card(i,a)};this.GloabalEventBus=h.getEventBus();if(this.oMainComponent&&(this.oMainComponent.isMacroFilterBar||this.oMainComponent.oGlobalFilter)){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",a.eventhandler)}},onContactDetailsLinkPress:function(t){var e,a,i;a=t.getSource();e=a.getParent().getAggregation("items")[0];i=a.getBindingContext();if(!i){return}e.bindElement(i.getPath());e.openBy(a)},onAfterRendering:function(){t.prototype.onAfterRendering.apply(this,arguments);var e=this.getCardPropertiesModel().getProperty("/imageSupported");var i=this.getCardPropertiesModel().getProperty("/densityStyle");if(e){var s=this.byId("ovpList");s.attachUpdateFinished(function(){this._addImageCss(i)}.bind(this))}if(!a.checkIfAPIIsUsed(this)&&this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var r=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var n=Math.max(this.getHeaderHeight(),r.dashboardLayout.headerHeight);var o=this.oDashboardLayoutUtil.getCardDomId(this.cardId);var l=document.getElementById(o);if(!r.dashboardLayout.autoSpan){l.getElementsByClassName("sapOvpWrapper")[0].style.height=r.dashboardLayout.rowSpan*this.oDashboardLayoutUtil.ROW_HEIGHT_PX-(n+2*this.oDashboardLayoutUtil.CARD_BORDER_PX)+"px";r.dashboardLayout.autoSpan=true}if(r.dashboardLayout.showOnlyHeader){l.classList.add("sapOvpMinHeightContainer")}}if(!a.checkIfAPIIsUsed(this)){var h=this.getCardPropertiesModel();var g=this.getOwnerComponent().getModel("ui").getData().cards;var p=[];var c=this.getEntitySet()&&this.getEntitySet()["$Type"];var v=c&&this.getMetaModel().getContext("/"+c);if(v){var u=v.getObject();this.selectionVaraintFilter=d.getSelectionVariantFilters(g,h,this.getEntityType())}var m=this.oCardComponentData.mainComponent;if(m.getGlobalFilter()){p=d._getEntityRelevantFilters(u,m.oGlobalFilter.getFilters())}if(m.getMacroFilterBar()){var f=m.aFilters;p=d._getEntityRelevantFilters(u,f)}p=d.mergeFilters(p,this.selectionVaraintFilter);if(this.getCardItemsBinding()){this.getCardItemsBinding().filter(p)}if(this.getKPIBinding()){this.getKPIBinding().filter(p)}}},_addImageCss:function(t){var e=this.byId("ovpList");var a=e.getItems();var i=false;var s=e.getDomRef().getAttribute("class");if(t==="cozy"){s=s+" sapOvpListImageCozy"}else{s=s+" sapOvpListImageCompact"}e.getDomRef().setAttribute("class",s);a.forEach(function(t){if(t.getIcon().indexOf("icon")!=-1){i=true}});a.forEach(function(e){var a=e.getDomRef();var s;if(a&&a.children[0]&&a.children[0].children[0]){s=a.children[0].children[0]}var r=e.getDescription();var n=e.getIcon();var o=i;var d=e.getTitle();var l=d.split(" ").map(function(t){return t?t[0].toUpperCase():""}).join("").substring(0,2);if(n!=""&&n.indexOf("icon")==-1){i=false}if(i&&a.children[0]){jQuery(a.children[0]).addClass("sapOvpIconListItem")}else if(a.children[0]){jQuery(a.children[0]).addClass("sapOvpImageListItem")}if(s&&t==="cozy"&&i===false){if(s){var h=s.getAttribute("class");h=h+" sapOvpImageCozy";s.setAttribute("class",h)}}var g="";if(i===true&&r===""){g=t==="compact"?"sapOvpListWithIconNoDescCompact":"sapOvpListWithIconNoDescCozy"}else if(i===false&&r===""){g=t==="compact"?"sapOvpListWithImageNoDescCompact":"sapOvpListWithImageNoDescCozy"}else{g=t==="compact"?"sapOvpListWithImageIconCompact":"sapOvpListWithImageIconCozy"}e.addStyleClass(g);if(a&&a.children[0]&&n===""&&a.children[0].id!=="ovpIconImagePlaceHolder"){var p=document.createElement("div");p.innerText=l;p.setAttribute("id","ovpIconImagePlaceHolder");p.className=i===true?"sapOvpIconPlaceHolder":"sapOvpImagePlaceHolder";if(i===false&&t==="cozy"){p.className=p.className+" sapOvpImageCozy"}a.insertBefore(p,a.children[0])}i=o})},onListItemPress:function(t){var e=r.bCRTLPressed?r.constants.explace:r.constants.inplace;r.bCRTLPressed=false;if(a.checkIfAPIIsUsed(this)){if(this.checkAPINavigation()){i.onContentClicked(t)}}else{var s=this.getEntityNavigationEntries(t.getSource().getBindingContext(),this.getCardPropertiesModel().getProperty("/annotationPath"));this.doNavigation(t.getSource().getBindingContext(),s[0],e)}},getCardItemsBinding:function(){var t=this.getView().byId("ovpList");return t&&t.getBinding("items")},_getMinMaxObjectFromContext:function(t){this.counter++;var e=this.getEntitySet(),a=this.getCardPropertiesModel().getProperty("/annotationPath");a="@"+a;var i=this.getMetaModel().getData(a).$Annotations[e.$Type][a];var r="/"+e.$Type+"/@"+a;var n=this.getMetaModel().createBindingContext(r),o={minValue:0,maxValue:0};if(s.isFirstDataPointPercentageUnit(n,i)){o.minValue=0;o.maxValue=100;return o}var d=s.getFirstDataPointValue(n,i),l=this.getView().byId("ovpList"),h=l.getBinding("items"),g=h.getCurrentContexts();for(var p=0;t?p<t:p<g.length;p++){var c=g[p].getValue(d);var v=parseFloat(c,10);if(v<o.minValue){o.minValue=v}else if(v>o.maxValue){o.maxValue=v}}return o},_updateMinMaxModel:function(t){var e=this._getMinMaxObjectFromContext(t);this.minMaxModel.setData({minValue:e.minValue,maxValue:e.maxValue});this.minMaxModel.refresh();return e},returnBarChartValue:function(t){this._updateMinMaxModel();var e=parseFloat(t,10);return e},getCardItemBindingInfo:function(){var t=this.getView().byId("ovpList");return t.getBindingInfo("items")},resizeCard:function(t,e){var a,i,s;try{var r=document.getElementById(this.oDashboardLayoutUtil.getCardDomId(this.cardId)),n=this.getCardItemBindingInfo(),o=this.getHeaderHeight(),d=this.getView().byId("ovpCardContentContainer").getDomRef();if(t.showOnlyHeader){d.classList.add("sapOvpContentHidden");a=0}else{d.classList.remove("sapOvpContentHidden");s=o+e.dropDownHeight;i=t.rowSpan*t.iRowHeightPx-s;a=Math.abs(Math.floor(i/e.itemHeight));r.style.height=t.rowSpan*t.iRowHeightPx+"px"}d.style.height=t.rowSpan*t.iRowHeightPx-(o+2*t.iCardBorderPx)+"px";if(a!==n.length){n.length=a;t.noOfItems=n.length;this.getCardItemsBinding().refresh()}else{this._handleCountHeader()}}catch(t){g.warning("OVP resize: "+this.cardId+" catch "+t.toString())}},onExit:function(){t.prototype.onExit.apply(this,arguments)}})});
//# sourceMappingURL=List.controller.js.map
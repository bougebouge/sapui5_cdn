sap.ui.define(["sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ui/model/FilterOperator","sap/ovp/cards/ovpLogger"],function(e,t,r,n){"use strict";var a=new n("OVP.v4.linklist.AnnotationHelper");function i(e){var t=[];var r,n;var a=e.getProperty("/sortBy");if(a){var i=e.getProperty("/sortOrder");if(i&&i.toLowerCase()!=="descending"){n=false}else{n=true}r={path:a,descending:n};t.push(r)}return t}function o(t,n){var i=[];var o=t.getProperty("/filters");if(o){i=i.concat(o)}var s=n&&n.SelectOptions;var f,l,u;if(s){for(var g=0;g<s.length;g++){f=s[g];l=f.PropertyName.$PropertyPath;for(var p=0;p<f.Ranges.length;p++){u=f.Ranges[p];if(u.Sign.$EnumMember){var d={path:l,operator:u.Option.$EnumMember.split("/")[1],value1:e.getPrimitiveValue(u.Low),value2:e.getPrimitiveValue(u.High),sign:u.Sign.$EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(d.sign==="E"&&d.operator!==r.EQ){a.error("Exclude sign is supported only with EQ operator");continue}if(d.sign==="E"&&d.operator===r.EQ){d.operator=r.NE;d.sign="I"}if(d.operator==="CP"&&d.sign==="I"){var c=r.Contains;var v=d.value1;if(v){var y=v.indexOf("*");var P=v.lastIndexOf("*");if(y>-1){if(y===0&&P!==v.length-1){c=r.EndsWith;v=v.substring(1,v.length)}else if(y!==0&&P===v.length-1){c=r.StartsWith;v=v.substring(0,v.length-1)}else{v=v.substring(1,v.length-1)}}}d.operator=c;d.value1=v}i.push(d)}}}}return i}function s(t,r,n){var a=t.getSetting("ovpCardProperties");var s=a.getProperty("/metaModel");var f=r;var l=s.getData();var u="/"+a.getProperty("/entitySet");var g;if(a.getProperty("/selectionAnnotationPath")){var p="@"+a.getProperty("/selectionAnnotationPath");g=l["$Annotations"][f.$Type][p]}var d;var c=a.getProperty("/layoutDetail");if(c==="resizable"){var v=a.getProperty("/cardLayout");if(v){if(a.getProperty("/listFlavor")==="standard"){var y="";for(var P in n){y+=P}var h=a.getProperty("/cardLayout/iRowHeigthPx");if(h===undefined){h=16}var m;if(a.getProperty("/densityStyle")==="cozy"){m=72;if(y.indexOf("Description")===-1&&(y.indexOf("Title")>0&&y.indexOf("ImageUrl")>0||y.indexOf("Title")>0&&y.indexOf("TypeImageUrl")>0)){m=56}else if(y.indexOf("Description")===-1&&y.indexOf("Title")>0){m=48}}else{m=60;if(y.indexOf("Description")===-1&&(y.indexOf("Title")>0&&y.indexOf("ImageUrl")>0||y.indexOf("Title")>0&&y.indexOf("TypeImageUrl")>0)){m=48}else if(y.indexOf("Description")===-1&&y.indexOf("Title")>0){m=40}}a.setProperty("/cardLayout/itemHeight",m);if(!a.getProperty("/defaultSpan")&&a.getProperty("/cardLayout/autoSpan")){d=a.getProperty("/cardLayout/noOfItems");var x=Math.ceil((d*m+a.getProperty("/cardLayout/headerHeight")+2*a.getProperty("/cardLayout/iCardBorderPx"))/h);a.setProperty("/cardLayout/noOfItems",x)}else{var O=Math.floor(v.rowSpan*h-a.getProperty("/cardLayout/headerHeight")-2*a.getProperty("/cardLayout/iCardBorderPx"));d=Math.floor(O/m)*v.colSpan}}}}else{d=6}var I=t.getSetting("ovpCardProperties"),S=I.getProperty("/parameters");if(g||!!S){if(g&&g.Parameters||!!S){u=e.resolveParameterizedEntitySet(t.getSetting("dataModel"),r,g,S)}}var L="{path: '"+u+"', length: "+d;var w=i(a);if(w.length>0){L=L+", sorter:"+JSON.stringify(w)}var C=o(a,g);if(C.length>0){L=L+", filters:"+JSON.stringify(C)}var E=e.checkFilterPreference(a);if(E){L=L+", parameters:{custom: {cardId: '"+a.getProperty("/cardId")+"'}}"}L=L+"}";return L}s.requiresIContext=true;function f(e,t){var r=e.getModel().getProperty("/baseUrl");return v(r,t)}f.requiresIContext=true;function l(e,r){var n=true;var a=t.format(e,r);if(a.toLowerCase().indexOf("icon")>0){n=false}return n}l.requiresIContext=true;function u(e){var t=true;if(!e){return null}else if(e.toLowerCase().indexOf("icon")>0){t=false}return t}function g(e){var t=new RegExp("http(s)?://(www.)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?","i");return t.test(e)}function p(e){var t;if(e.hasOwnProperty("$Path")){t="{"+e.$Path+"}"}else{t=e}return t}function d(e){var t="{"+e+"}";return t}function c(e){if(e){return 1}return 0}function v(e,t){if(!t){return undefined}else if(t.lastIndexOf(e,0)===0||t.indexOf("://")>0){return t}else if(t.lastIndexOf("/",0)===0){return e+t}else{return e+"/"+t}}function y(e,t,r){var n;if(typeof r==="object"){n=r[e]}else{n=typeof r==="boolean"?r:true}return!t[e]&&n}function P(e,t,r){var n="";if(e){if(t&&r){n="#"+t+"-"+r;for(var a=0;a<e.length;a++){if(e[a].value===n){return e[a].name}}n=""}else{return e[0].name}}return n}function h(e,t){return v(e.baseUrl,t)}function m(e){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","")}function x(e){return e.$Path&&"{"+e.$Path+"}"||e||""}return{getSorters:i,getFilters:o,formatItems:s,formatUrl:f,isImageUrl:l,isImageUrlStaticData:u,isValidURL:g,getIconPath:p,formatString:d,linkedAction:c,formUrl:v,isVisible:y,getApplicationName:P,getImageUrl:h,contentRowIndex:m,getAvatarInitials:x}},true);
//# sourceMappingURL=AnnotationHelper.js.map
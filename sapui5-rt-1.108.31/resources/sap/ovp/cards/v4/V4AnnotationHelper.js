sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/analytics/odata4analytics","sap/fe/navigation/SelectionVariant","sap/ovp/app/resources","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/security/encodeURL","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ovp/app/OVPUtils","sap/ovp/helpers/V4/MetadataAnalyzer"],function(e,t,r,a,i,n,o,u,l,s,f,c,p,g,v,m,h,y,d){"use strict";var P={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var C={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var T={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var b={List_condensed:{phone:5,tablet:5,desktop:5},List_extended:{phone:3,tablet:3,desktop:3},List_condensed_bar:{phone:5,tablet:5,desktop:5},List_extended_bar:{phone:3,tablet:3,desktop:3},Table:{phone:5,tablet:5,desktop:5},Stack_simple:{phone:20,tablet:20,desktop:20},Stack_complex:{phone:5,tablet:5,desktop:5}};var $=new m("OVP.cards.V4AnnotationHelper");function V(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/showLabelText");if(a==="true"){var i=t.Address[0];if(typeof i.country!=="undefined"){return"{path:'"+i.country.Path+"'}"}else if(typeof i.locality!=="undefined"){return"{path:'"+i.locality.Path+"'}"}else if(typeof i.street!=="undefined"){return"{path:'"+i.street.Path+"'}"}else if(typeof i.code!=="undefined"){return"{path:'"+i.code.Path+"'}"}}else{return null}}V.requiresIContext=true;function D(e,t){if(!t){return""}if(t.Label){return t.Label}var r=e.getSetting&&e.getSetting("ovpCardProperties");var a=r&&r.getProperty("/metaModel");var i=r&&r.getProperty("/entityType");if(!a||!i){return""}var n;if(t.Value){n=t.Value.$Path}if(t.Target){var o="/"+L(i.$Type,t);var u=o&&a.getProperty(o);n=u&&u.Value.$Path}if(!n||!n.length>0||n===" "){return""}var l=a.getData()["$Annotations"][i.$Type+"/"+n];if(!l){return""}var s=l["sap:label"]||l["@com.sap.vocabularies.Common.v1.Label"]||""||"";return s}D.requiresIContext=true;function I(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}I.requiresContext=true;function F(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function O(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function S(e,t){var r;if(t){r=t.None;if(e&&e.$EnumMember){var a=e.$EnumMember;if(x(a,"Negative")){r=t.Negative}else if(x(a,"Critical")){r=t.Critical}else if(x(a,"Positive")){r=t.Positive}}}return r}function N(e){if(e=="Error"){e=1}else if(e=="Warning"){e=2}else if(e=="Success"){e=3}else{e=0}return e}function x(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function E(t,r,a,i,n,o,u){if(typeof t=="string"){t=e.getFloatInstance().parse(t)}var l={};l.$EnumMember="None";var s=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!n&&n!==0&&(a||a===0)){n=a}if(!o&&o!==0&&(i||i===0)){o=i}if(!a&&a!==0){a=s}if(!i&&i!==0){i=f}if(t!==undefined){t=Number(t);if(x(r,"Minimize")||x(r,"Minimizing")){if((o||o===0)&&(i||i===0)){if(t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Maximize")||x(r,"Maximizing")){if((n||n===0)&&(a||a===0)){if(t>=parseFloat(n)){l.$EnumMember="Positive"}else if(t<parseFloat(a)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Target")){if((o||o===0)&&(i||i===0)&&(n||n===0)&&(a||a===0)){if(t>=parseFloat(n)&&t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t<parseFloat(a)||t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}}return S(l,u)}function A(t,r,a,i){if(typeof t=="string"){t=e.getFloatInstance().parse(t)}if(!t||!r){return}t=Number(t);if(!i&&t-r>=0){return"Up"}if(!a&&t-r<=0){return"Down"}if(r&&i&&t-r>=i){return"Up"}if(r&&a&&t-r<=a){return"Down"}}function M(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=F(e,r);if(!a){var i=R(e,t);var n=i.map(function(e){return e.Value.$Path});n=n.filter(function(e){return!!e});a=t.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&n.indexOf(e.Value.$Path)===-1){return true}return false});a=B(a);O(e,r,a)}return a}M.requiresIContext=true;function R(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=F(e,a);if(!i){if(r){i=t.filter(w)}else{i=t.filter(U)}i=B(i);var n;for(var o=0;o<i.length;o++){n=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[o]=e.getModel(0).getProperty(L(n,i[o]));n=""}O(e,a,i)}return i}R.requiresIContext=true;function U(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true}return false}function w(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)){return true}return false}function q(e){if(!e||!e.Criticality||!e.Criticality.Path){return}return"{path:'"+e.Criticality.Path+"'}"}function L(e,t){return e+t.Target.$AnnotationPath}function _(e){var t,r;if(e["@com.sap.vocabularies.UI.v1.Importance"]){t=e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember;switch(t){case"com.sap.vocabularies.UI.v1.ImportanceType/High":r=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":r=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":r=3;break}}else{r=4}return r}function B(e){if(e.length<2){return e}var t=parseInt(e.length/2,10);var r=e.slice(0,t);var a=e.slice(t,e.length);return k(B(r),B(a))}function k(e,t){var r=[];while(e.length&&t.length){var a=_(e[0]),i=_(t[0]);if(a<=i){r.push(e.shift())}else{r.push(t.shift())}}while(e.length){r.push(e.shift())}while(t.length){r.push(t.shift())}return r}function H(e,t,r){var a=M(e,t)[r];if(a){return W(e,a)}return""}function j(e,t,r){var a=M(e,t)[r];return D(e,a)}function G(e,t,r){var a=R(e,t)[r];if(a&&a.Title){return a.Title.String}return""}function X(e,t,r){var a=t.filter(U);a=B(a);if(!a||!a.length||!a.length>0){return""}return D(e,a[0])}function Y(e,t,r,a){var i=R(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return Q(e,i,o,u,a)}function z(e,t,r){var a=R(e,t)[r];if(a&&a.Criticality){return true}}function J(e,t,r){var a=R(e,t)[r];var i=a.Criticality.Path;return"{path:'"+i+"'}"}function Q(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var u=n.getProperty("/ignoreSapText");o=u==undefined?o:u}var l=a.getData()["$Annotations"][r.$Type+"/"+t.Value.$Path];var s=false;if(o==true){if(l&&(l["@com.sap.vocabularies.Analytics.v1.Measure"]||l["sap:aggregation-role"]=="measure")){s=true}}if(!s&&l){var f;if(l[C.TEXT]){f=l[C.TEXT]?l[C.TEXT]:l[C.TEXT].$Path}else if(l["sap:text"]){f=l["sap:text"]}if(f){t={Value:{$Path:f}}}}return W(e,t,i)}function W(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return Z(e,t,o,u,r,i)}W.requiresIContext=true;function K(e,t,r,i){var e=!e.getPath()?e.getInterface(0):e;if(!r||typeof i!=="string"){return i}var n=r["@"+C.TEXT];if(!n){return i}var o,u;o=r["@"+C.TEXT+"@"+C.TEXT_ARRANGEMENT];u=o&&o.$EnumMember;if(!u){o=n&&n["@"+C.TEXT_ARRANGEMENT];u=o&&o.$EnumMember}if(!u){o=t&&t[C.TEXT_ARRANGEMENT];u=o&&o.$EnumMember}var l=a.format(n,{context:e});if(!l||l===" "){return i}if(!u){return i+" ("+l+")"}var s;switch(u){case T.TEXT_FIRST:s=l+" ("+i+")";break;case T.TEXT_LAST:s=i+" ("+l+")";break;case T.TEXT_ONLY:s=l;break;case T.TEXT_SEPARATE:s=i+" ("+l+")";break;default:s=i;break}return s}function Z(e,t,r,i,n,o,u){if(t.Value.Apply){return a.format(e,t.Value)}var l=t.Value.$Path?t.Value.$Path:t.Value.String;var s=te(i,r,t.Value.$Path),f="",c,p;var g=e.getSetting("ovpCardProperties");var v=g&&g.getProperty("/contentFragment");if(!o){if(t.Value.$Path&&t.Value.$Path.split("/").length>1){s=oe(i,r,t.Value.$Path)}if(!s){return""}if(s&&(s.$Type==="Edm.DateTime"||s.$Type==="Edm.DateTimeOffset")){var m={relative:true,relativeScale:"auto"},h=g&&g.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}p={dateFormat:m,bUTC:s.$Type==="Edm.DateTime"?true:false};c="sap.ovp.cards.AnnotationHelper.formatDate";f=re([t.Value.$Path?t.Value.$Path:l.split("/")[l.split("/").length-1]],c,p)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits>=0||s["scale"]){var y=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits?t.ValueFormat.NumberOfFractionalDigits:0,d;var P=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.$Decimal;if(s["@"+C.ISO_CURRENCY]){d=s["@"+C.ISO_CURRENCY].$Path?s["@"+C.ISO_CURRENCY].$Path:s["@"+C.ISO_CURRENCY]}else if(s["@"+C.UOM]){d=s["@"+C.UOM].$Path?s["@"+C.UOM].$Path:s["@"+C.UOM]}else if(s["@sap:unit"]){d=s["@sap:unit"]}var T=d?i.getProperty("/"+r.$Type)[d]:null,b=[t.Value.$Path?t.Value.$Path:l.split("/")[l.split("/").length-1]];if(y>2){y=2}p={numberOfFractionalDigits:y,scaleFactor:P};if(s["@"+C.ISO_CURRENCY]){var $=s["@"+C.ISO_CURRENCY];if($.$Path){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";b.push($.$Path)}else if($.String){p.currencyString=$.String;c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency"}}else if(T&&(T[C.ISO_CURRENCY]||T["sap:semantics"]==="currency-code")){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";b.push(d)}else{c="sap.ovp.cards.v4.V4AnnotationHelper.formatNumberCalculation"}f=re(b,c,p)}else{if(u){f=a.format(t.Value,{context:e})}else{var V=a.format(t.Value,e.getModel()?{context:e}:{context:e.getInterface(0)});var D=V.split(",");var I=[];if(D.length>1){for(var F=0;F<D.length;F++){if(D[F].indexOf("path:")>=0||D[F].indexOf("type:")>=0){I.push(D[F])}}if(I.length>0){f=f+I.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=V}}}if(v){f=K(e,r,s,f)}if(s&&s["@"+C.UOM]){var O=s["@"+C.UOM];if(O.$Path){f+=" "+re([O.$Path]);f+=" "+ee(O.$Path,i,r)}else if(O.String){if(O.String!=="%"){f+=" "}f+=O.String}}}if(!n){if(s["@"+C.ISO_CURRENCY]){var $=s["@"+C.ISO_CURRENCY];if($){if($.$Path){f+=" "+re([$.$Path])}else{f+=" "+$}f+=" "+ee($.$Path,i,r)}}}if(f[0]===" "){f=f.substring(1)}f=f.replace("\\","");f=f.replace("\\","");f=f.replace("Unsupported: ","");f=f.replace("$P","p");return f}function ee(e,t,r){if(e){var a,i,n;if(e.split("/").length>1){a=oe(t,r,e);i=ye(t,r,e)}else{a=te(t,r,e)}if(a){n=a["@"+C.TEXT]&&a["@"+C.TEXT].$Path}if(n&&i){n=i+"/"+n}if(n){return" ({"+n+"})"}return""}}function te(e,t,r){var a=e.getData().$Annotations[t.$Type+"/"+r];var i=d.getEntitySetName(e,t.$Type);var n=e.getObject("/"+i+"/"+r);var o=y.merge(true,{},a,n);return o}function re(e,t,r,a){var i="",n=e.length;if(n>1||r){i="{parts:[";for(var o=0;o<n;o++){if(a){i+="{path: '"+e[o]+"',type:'sap.ui.model.odata.type.String'}"+(o===n-1&&!r?"]":", ")}else{i+="{path: '"+e[o]+"'}"+(o===n-1&&!r?"]":", ")}}if(r){var u="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";i+=u+"]"}}else{i="{path: '"+e[0]+"'"}i+=(t?", formatter: '"+t+"'":"")+"}";return i}function ae(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getFloatInstance().parse(r)}return a.format(Number(r))}function ie(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ne(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getCurrencyInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getFloatInstance().parse(r)}if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function oe(e,t,r){var a=r.split("/");if(a.length>1){for(var i=0;i<a.length-1;i++){t=e.getProperty("/"+t.$Type)[a[i]]}return te(e,t,a[a.length-1])}}function ue(e,t,r){var a=R(e,t);var i=P.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return ce(e,n,i)}return ge(e,n,i)}function le(e,t,r){var a=R(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function se(e,t,r){if(le(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}se.requiresIContext=true;function fe(e,t,r){var a=R(e,t),i=P.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=ce(e,o,i)}else{n=ge(e,o,i)}}return n}function ce(e,t,r){var i=r.None;var n;var o=t.Criticality;if(o){n="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(o.$Path){var u="$"+a.format(o,{context:e});i=s(n,u)}else if(o.$EnumMember){var l="'"+o.$EnumMember+"'";i=s(n,l)}else{$.warning("Case not supported, returning the default Neutral state")}}else{$.warning("Case not supported, returning the default Neutral state")}return i}function pe(e,t,r){var a=R(e,t);var i="None";if(a.length>r){var n=a[r];if(n&&n.Criticality&&n.Criticality.Path){i=J(e,t,r)}else{i=ge(e,n,P.StateValues);i=N(i)}}return i}function ge(e,t,r,a){var i=r.None;if(t.Criticality){i=S(t.Criticality,r)}else if(t.CriticalityCalculation&&t.Value&&t.Value&&t.Value.$Path){i=ve(e,t,r,a)}return i}function ve(e,t,r,a){var i=Ee(t.Value,a);var n=t.CriticalityCalculation.ImprovementDirection.$EnumMember;var o=Ee(t.CriticalityCalculation.DeviationRangeLowValue,a);var u=Ee(t.CriticalityCalculation.DeviationRangeHighValue,a);var l=Ee(t.CriticalityCalculation.ToleranceRangeLowValue,a);var s=Ee(t.CriticalityCalculation.ToleranceRangeHighValue,a);var f=he(o);var c=he(u);var p=he(l);var g=he(s);var v={deviationLow:o,deviationHigh:u,toleranceLow:l,toleranceHigh:s,bIsDeviationLowBinding:f,bIsDeviationHighBinding:c,bIsToleranceLowBinding:p,bIsToleranceHighBinding:g,sImprovementDirection:n,oCriticalityConfigValues:r};var m="{value:"+JSON.stringify(v)+", model: 'ovpCardProperties'}";var h="parts: ["+i;h+=f?","+o:"";h+=c?","+u:"";h+=p?","+l:"";h+=g?","+s:"";h+=","+m;h+="]";var y="sap.ovp.cards.v4.V4AnnotationHelper.formatColor";return"{"+h+", formatter: '"+y+"'}"}function me(){var e=arguments[arguments.length-1];var t=1;return E(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationLow,e.bIsDeviationHighBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationHigh,e.bIsToleranceLowBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceLow,e.bIsToleranceHighBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceHigh,e.oCriticalityConfigValues)}function he(e){return typeof e==="string"&&e.charAt(0)==="{"}function ye(e,t,r){var a="";var i=r.split("/");if(i.length>1){i.pop();a=i.join("/")}return a}function de(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function Pe(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/addODataSelect");var i=r.getProperty("/metaModel");var n=i.getData();var o=t;var u,l,s,f;if(r.getProperty("/selectionAnnotationPath")){u="@"+r.getProperty("/selectionAnnotationPath");l=n["$Annotations"][o.$Type][u]}if(r.getProperty("/presentationAnnotationPath")){s=r.getProperty("/presentationAnnotationPath");s="@"+s;f=n["$Annotations"][o.$Type][s]}var c="/"+r.getProperty("/entitySet");var p=Array.prototype.slice.call(arguments,2);var g=e.getSetting("ovpCardProperties"),v=g.getProperty("/parameters");if(l||!!v){if(l&&l.Parameters&&l.Parameters.length>0||!!v){c=St(e.getSetting("dataModel"),t,l,v)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var m="{path: '"+c+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var m="{path: '"+c+"', length: "+Ae(r)}var h=[];if(a){h=Te(e,i,o,p);var y=r.getProperty("/template");if(y!="sap.ovp.cards.charts.analytical"&&y!="sap.ovp.cards.charts.smart.chart"){var d=Ve(f);for(var P=0;P<d.length;P++){if(h.indexOf(d[P])===-1){h.push(d[P])}}}}var C=Ce(i,o.$Type,p);var T=de(r);if(T||h.length>0||C.length>0){m=m+", parameters: {"}if(h.length>0||C.length>0){if(h.length>0){m=m+"select: '"+h.join(",")+"'"}if(C.length>0){if(h.length>0){m=m+", "}m=m+"$expand: '"+C.join(",")+"'"}if(T){m=m+", "}}if(T){m=m+"custom: {cardId: '"+r.getProperty("/cardId")+"'}"}if(T||h.length>0||C.length>0){m=m+", $count: true}"}else{m=m+", parameters: {$count:true}"}var b=$e(r,f);if(b.length>0){m=m+", sorter:"+JSON.stringify(b)}var $=Oe(r,l);if($.length>0){m=m+", filters:"+JSON.stringify($)}m=m+"}";return m}Pe.requiresIContext=true;function Ce(e,t,r){var a=[];var i,n;for(var o=0;o<r.length;o++){if(!r[o]){continue}i=e.getData()["$Annotations"][t]["@"+r[o]];i=i?i:[];for(var u=0;u<i.length;u++){if(i[u].Value&&i[u].Value.$Path){n=ye(e,t,i[u].Value.$Path);if(n&&a.indexOf(n)===-1){a.push(n)}}}}return a}function Te(e,t,r,i){var n=[];var o,u,l;for(var s=0;s<i.length;s++){if(!i[s]){continue}var c=d.getEntitySetName(t,r.$Type);o=c+"/@"+i[s];u=e.getModel(0);var p={};if(e&&e.bDummyContext){v(p,e,u,true)}else{p=e}l=u.getObject("/"+o);if(!l){l=[]}else if(f(l)){if(l.Data){l=l.Data}else{l=[]}}var g;var m;var h;var y;for(var P=0;P<l.length;P++){m=[];g=l[P];h="";y=g.$Type;if(y==="com.sap.vocabularies.UI.v1.DataField"){h=Z(p.getInterface(0),g,r,t,undefined,undefined,true)}else if(y==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var C=L(r.$path,g);h=Q(p,t.getProperty(C),r,t);var T=q(t.getProperty(C));if(T&&T.length>0){h+=T}}else if(y==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&g.Url){var b;if(!g.Url.UrlRef){b=a.format(p,g.Url)}if(b&&b.substring(0,2)==="{="){h=b}}if(h){var $=a.format(g.Value,{context:p.getInterface(0)});if(h.indexOf("(")<0&&h!==$){h=[].concat($,h).join(" ")}m=be(h)}if(m&&m.length>0){var V;for(var D=0;D<m.length;D++){V=m[D];if(!n[V]){n[V]=true;var I={};I[V]=te(t,r,V);var F=qt(V,I);if(F&&F!==V){n[F]=true}var O=nr(t,r,V);if(O&&O!==V){n[O]=true}}}}}}return Object.keys(n)}function be(e){var t,r=0,a=e.length,i="",n;for(t=0;t<a;t++){n=e.charAt(t);if(!n){return}switch(n){case"{":r++;break;case"}":r--;break;default:if(r<=0){continue}break}i+=n}e=i;var o=/\${([a-zA-Z0-9\_|\/]*)/g;var u=/[^[{]*[a-zA-Z0-9\_]/g;var l=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s,f,c=[];if(e.indexOf("{parts:[")!==-1){e=e.replace("{parts:[","");e=e.replace("]","");e=e.replace(e.lastIndexOf("}",""))}if(e.substring(0,2)==="{="){s=o;f=1}else if(e.indexOf("path")!==-1){if(e.indexOf("{value")>0){var p=0;var t=e.indexOf("{value")+5;var g;while(t<a){if(e[t]==="}"&&p===0){g=t;break}if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1}t++}e=e.slice(0,e.indexOf("{value"))+e.slice(g)}var v=u.exec(e);while(v){if(v[0].indexOf("path")===-1&&v[0].indexOf("@i18n")!==0&&v[0].indexOf("model: 'ovpCardProperties'")<=-1){c.push(v[0])}v=u.exec(e)}s=l;f=1}else{s=u;f=0}var m=s.exec(e);while(m){if(m[f]&&m[f].indexOf("@i18n")!==0){c.push(m[f])}m=s.exec(e)}return c}function $e(e,t){var r=[];var a,i;var n=e.getProperty("/sortBy");if(n){var o=e.getProperty("/sortOrder");if(o&&o.toLowerCase()!=="descending"){i=false}else{i=true}a={path:n,descending:i};r.push(a)}var u=t&&t.SortOrder||undefined;var l,n;if(u){for(var s=0;s<u.length;s++){l=u[s];n=l.Property.$PropertyPath;i=Se(l.Descending,true);a={path:n,descending:i};r.push(a)}}return r}function Ve(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function De(e){var t=e.getProperty("/entityType");var r=t[e.getProperty("/selectionAnnotationPath")];return{filters:Oe(e,r),parameters:Fe(r)}}function Ie(e){if(!e){return}var t=e.getProperty("/entityType");var r=t[e.getProperty("/presentationAnnotationPath")];var a=$e(e,r);var i=[];var n,o=a.length;for(n=0;n<o;n++){if(!a[n].path){continue}i.push({Property:a[n].path,Descending:a[n].descending})}if(i.length>0){return{SortOrder:i}}}function Fe(e){var t,r=[];if(!e||!e.Parameters){return r}var a=e.Parameters.length;for(var i=0;i<a;i++){t=e.Parameters[i];if(!t.PropertyName||!t.PropertyName.PropertyPath){continue}if(!t.PropertyValue){$.error("Missing value for parameter "+t.PropertyName.PropertyPath);continue}r[r.length]={path:t.PropertyName.PropertyPath,value:xe(t.PropertyValue)}}return r}function Oe(e,t){var r=[];var a;var n=e.getProperty("/filters");if(n){r=r.concat(n)}if(t&&t.SelectOptions){a=t.SelectOptions}else{a=t}var o,u,l;if(a){for(var s=0;s<a.length;s++){o=a[s];u=o.PropertyName.$PropertyPath;for(var f=0;f<o.Ranges.length;f++){l=o.Ranges[f];if(l.Sign.$EnumMember){var c={path:u,operator:l.Option.$EnumMember.split("/")[1],value1:xe(l.Low),value2:xe(l.High),sign:l.Sign.$EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(c.sign==="E"&&c.operator!==i.EQ){$.error("Exclude sign is supported only with EQ operator");continue}if(c.sign==="E"&&c.operator===i.EQ){c.operator=i.NE;c.sign="I"}if(c.operator==="CP"&&c.sign==="I"){var p=i.Contains;var g=c.value1;if(g){var v=g.indexOf("*");var m=g.lastIndexOf("*");if(v>-1){if(v===0&&m!==g.length-1){p=i.EndsWith;g=g.substring(1,g.length)}else if(v!==0&&m===g.length-1){p=i.StartsWith;g=g.substring(0,g.length-1)}else{g=g.substring(1,g.length-1)}}}c.operator=p;c.value1=g}r.push(c)}}}}return r}function Se(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function Ne(e){var t;if(e){if(e.String){t=Number(e.String)}else if(e.Int){t=Number(e.Int)}else if(e.$Decimal){t=Number(e.$Decimal)}else if(e.Double){t=Number(e.Double)}else if(e.Single){t=Number(e.Single)}else if(typeof e==="number"){return e}}return t}function xe(e){var t;if(e){if(e.String||e.String===""){t=e.String}else if(typeof e=="string"){t=e}else if(e.Boolean||e.Bool){t=Se(e)}else if(e.DateTime){t=e.DateTime}else if(e.DateTimeOffset){t=e.DateTimeOffset}else{t=Ne(e)}}return t}function Ee(e,t){if(e){if(e.$Path){return t?"{path:'"+e.$Path+"Agg"+"', type:'sap.ui.model.odata.type.Decimal'}":"{path:'"+e.$Path+"'}"}else{return xe(e)}}else{return""}}function Ae(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=b["List_extended_bar"]}else{i=b["List_extended"]}}else if(a=="bar"){i=b["List_condensed_bar"]}else{i=b["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=b["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=b["Stack_complex"]}else{i=b["Stack_simple"]}}if(i){return i[o]}return 5}function Me(e){var t=e.getObject();var r=R(e,t,true);var a=r.map(function(e){if(e&&e.Value&&e.Value.$Path){return e.Value.$Path}else if(e&&e.fn&&e.fn.$Path){return e.fn.$Path}});t.filter(function(e,r){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&a.indexOf(e.Value.$Path)>-1){t.splice(r,1)}});return e.sPath}Me.requiresIContext=true;function Re(e,t){if(t.charAt(0)==="/"||t.indexOf("http")===0){return t}var r=e.getModel(0).getProperty("/baseUrl");if(r){return r+"/"+t}return t}Re.requiresIContext=true;function Ue(e,t){var r=R(e,t);return r.length}Ue.requiresIContext=true;function we(e,t){return Le(e,t,0)}we.requiresIContext=true;function qe(e,t){return Le(e,t,1)}qe.requiresIContext=true;function Le(e,t,r){var a=R(e,t),i=a[r];if(i&&i.Value&&i.Value.$Path){return i.Value.$Path}return""}function _e(e,t){return j(e,t,0)}_e.requiresIContext=true;function Be(e,t){return j(e,t,1)}Be.requiresIContext=true;function ke(e,t){return j(e,t,2)}ke.requiresIContext=true;function He(e,t){return j(e,t,3)}He.requiresIContext=true;function je(e,t){return j(e,t,4)}je.requiresIContext=true;function Ge(e,t,r){return H(e,t,r)}Ge.requiresIContext=true;function Xe(e,t,r){return Y(e,t,r)}Xe.requiresIContext=true;function Ye(e,t,r,a){var i=Ue(e,t);if(i>0){return Xe(e,t,r)}else{return Ge(e,t,a)}}Ye.requiresIContext=true;function ze(e,t,r){return mt(e,t,r)}ze.requiresIContext=true;function Je(e,t){return G(e,t,0)}Je.requiresIContext=true;function Qe(e,t){return G(e,t,1)}Qe.requiresIContext=true;function We(e,t){return G(e,t,2)}We.requiresIContext=true;function Ke(e,t){return X(e,t,0)}Ke.requiresIContext=true;function Ze(e,t){for(var r=0;r<t.length;r++){var i=t[r];if(i.$Type==="com.sap.vocabularies.UI.v1.DataField"){if(i.IconUrl&&i.IconUrl.String){return i.IconUrl.String}if(i.IconUrl&&i.IconUrl.$Path){return a.format(i.IconUrl,{context:e})}}}}Ze.requiresIContext=true;function et(e,t,r){var a="";var i;if(Array.isArray(t)){i=R(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=gt(o,n)}if(!i||!i.Value){return a}var u=e.getSetting("ovpCardProperties");var l=u&&u.getProperty("/entityType");var s=u&&u.getProperty("/metaModel");var f=s&&s.getData()["$Annotations"][l.$Type+"/"+i.Value.$Path];var c=f&&f["@"+C.ISO_CURRENCY];if(c){if(c.$Path){a+=" "+re([c.$Path])}else{a+=" "+c}a+=" "+ee(c.$Path,s,l)}return a}et.requiresIContext=true;function tt(e,t,r,a){return Y(e,t,r,a)}tt.requiresIContext=true;function rt(e,t){return ue(e,t,0)}rt.requiresIContext=true;function at(e,t){return fe(e,t,0)}at.requiresIContext=true;function it(e,t){return ue(e,t,1)}it.requiresIContext=true;function nt(e,t){return ue(e,t,2)}nt.requiresIContext=true;function ot(e,t){return pe(e,t,0)}ot.requiresIContext=true;function ut(e){var t={};t.$EnumMember="None";if(Number(e)===1){t.$EnumMember="Negative"}else if(Number(e)===2){t.$EnumMember="Critical"}else if(Number(e)===3){t.$EnumMember="Positive"}return S(t,P.ColorValues)}function lt(e,t){if(t&&t.Criticality&&t.Criticality.$Path){return"{parts: [{path:'"+t.Criticality.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.kpiValueCriticality'}"}else{return ge(e,t,P.ColorValues,true)}}lt.requiresIContext=true;function st(e,t){return z(e,t,0)}st.requiresIContext=true;function ft(e,t){var r=R(e,t)[0];if(r&&(r.Criticality||r.CriticalityCalculation)){return true}return false}ft.requiresIContext=true;function ct(e,t){return z(e,t,1)}ct.requiresIContext=true;function pt(e,t){return z(e,t,2)}pt.requiresIContext=true;function gt(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=L(a,t);t=e.getModel(0).getProperty(i);return t}function vt(e,t){if(!t){return""}return W(e,t)}vt.requiresIContext=true;function mt(e,t,r,i){var n;var o=i==undefined?r:M(e,r)[i];var u=e.getSetting("ovpCardProperties");var l=u.getProperty("/metaModel");var s=t.$Type;var f=l.getData()["$Annotations"][s+"/"+o.Value.$Path];if(f){n=f["@com.sap.vocabularies.Common.v1.SemanticObject"];if(n){return a.format(n,e.getModel()?{context:e}:{context:e.getInterface(0)})}else{return""}}}function ht(e,t,r){var a=r===undefined?t.Value.$Path:t[r].Value.$Path;var i=a.indexOf("/")!=-1?a.split("/")[0]:"";return i}ht.requiresIContext=true;function yt(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=a.getData()["$Annotations"][t.$Type];if(i["@com.sap.vocabularies.Communication.v1.Contact"]){return true}return false}yt.requiresIContext=true;function dt(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var u=Object.assign({},e);t=gt(u,o);return Q(e,t,i,n,r)}dt.requiresIContext=true;function Pt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=P.StateValues;t=gt(a,r);if(t&&t.Criticality){i=ce(e,t,n)}else{i=ge(e,t,n)}return i}Pt.requiresIContext=true;function Ct(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=gt(a,r);if(t&&t.Criticality){return true}}Ct.requiresIContext=true;function Tt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");t=gt(a,r);if(!t){return}var u=o.getProperty("/"+n.$Type)[t.Value.$Path];if(t&&u&&u.$Type=="Edm.String"&&(t.Criticality||t.CriticalityCalculation)){return"Center"}if(u&&(u.$Type=="Edm.DateTime"||u.$Type=="Edm.DateTimeOffset")){return"Right"}}Tt.requiresIContext=true;function bt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=gt(a,r);var i="None";if(t&&t.Criticality&&t.Criticality.Path){i="{path:'"+t.Criticality.Path+"'}"}else{i=ge(e,t,P.StateValues);i=N(i)}return i}bt.requiresIContext=true;function $t(e,t){var r;for(var a=0;a<t.length;a++){r=t[a];if(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1}}return 0}$t.requiresIContext=true;function Vt(e,t){var r=R(e,t)[0];if(r&&r.Value&&r.Value.$Path){var a=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var i=e.getModel(0);var n=i.getData(r.Value.$Path);var o=a.substr(1,a.length-2);if(n&&n[o][r.Value.$Path][C.UOM]){return n[C.UOM].String==="%"}}return false}Vt.requiresIContext=true;function Dt(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i="/"+r.getProperty("/entitySet");var n=a.getObject(i);t="/"+n.$Type+"/@"+t;return a.createBindingContext(t)}function It(e,t){if(e==="Edm.String"){var r=t.PropertyValue.String;return r}return t.PropertyValue.String}function Ft(e,t,r,a){var i="";var n=[];if(a&&a.Parameters){e.parameters.forEach(function(r){a.Parameters.forEach(function(a){var i=a.PropertyName.PropertyPath.split("/");i=i[i.length-1];if(i===r){var o=It(e["parameterType"][r],a);o=g(t.formatValue(o,e["parameterType"][r]));n.push(i+"="+o)}})})}else{i="/"+r.name;$.error("SelectionParameters","There are no parameters to resolve");return i}try{i="/"+e.entitySetName+"("+n.join(",")+")/"+e.navPropertyName}catch(e){i="/"+r.name;$.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return i}function Ot(e,t,r,a,i){var n="";var l=new o.Model(o.Model.ReferenceByModel(e));var s=l.findQueryResultByName(t.name);var f=new o.QueryResultRequest(s);var p=s.getParameterization();if(!p){n="/"+t.name;return n}if(i){var g=i.getAnalyticalParameters()}if(p){var v;f.setParameterizationRequest(new o.ParameterizationRequest(p));if(r&&r.Parameters){c(r.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){v=this.PropertyNameFrom.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String)}else{v=this.PropertyName.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValue.String)}})}else if(a){c(a,function(){f.getParameterizationRequest().setParameterValue(this.path,this.value)})}else if(g&&g.length>0){var m=i&&i.getUiState({allFilters:false});var h=m?JSON.stringify(m.getSelectionVariant()):"{}";var r=new u(h);for(var y in p.getAllParameters()){for(var d=0;d<g.length;d++){if(g[d]&&g[d].name==y){var P=g[d].name;var C=r.getParameter(P);if(!C){var T=r.getSelectOption(P);C=T&&T[0]&&T[0].Low}f.getParameterizationRequest().setParameterValue(y,C)}}}}else{n="/"+t.name;$.error("SelectionParameters","There are no parameters to resolve");return n}}try{n=f.getURIToQueryResultEntitySet()}catch(e){s=f.getQueryResult();n="/"+s.getEntitySet().getQName();$.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return n}function St(e,t,r,a,i){var n="";if(p.checkAnalyticalParameterisedEntitySet(e,t.name)){n=Ot(e,t,r,a,i)}else{var o=p.getParametersByEntitySet(e,t.name);var u=p.getPropertyOfEntitySet(e,t.name);var l={};if(o){o["parameters"].forEach(function(e){u.forEach(function(t){if(t["name"]==e){l[e]=t["type"]}})});o["parameterType"]=l;n=Ft(o,e,t,r)}else{n="/"+t.name}}return n}function Nt(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function xt(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"){return true}return false});var a=B(r);if(a){return a[t]}return}function Et(e,t,r){if(!r||!r.length||r.length===0){return false}r=xt(r,0);return mt(e,t,r)}Et.requiresIContext=true;function At(e,t,r){if(!r||!r.length||r.length===0){return false}r=xt(r,1);return mt(e,t,r)}At.requiresIContext=true;function Mt(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1){return true}return false});var a=B(r);if(a){return a[t]}return}function Rt(e){if(!e||!e.length||e.length===0){return false}var t=Mt(e,0);if(t){return true}return false}function Ut(e,t,r,a){var i;if(r&&r.Value&&r.Value.$Path){i=r.Value.$Path}else if(r&&r.Description&&r.Description.Value&&r.Description.Value.$Path){i=r.Description.Value.$Path}var n="";var o=a&&a.Parameters;var u="";var l=e.getSetting("ovpCardProperties"),s=l.getProperty("/parameters");o=o||!!s;var f=e.getSetting("dataModel");var c=e.getModel(0);var p=d.getEntitySetName(c,t.$Type);if(o){var g=St(f,t,a,s);n+="{path: '"+g+"'"}else{n+="{path: '/"+p+"'"}n+=", length: 1";var v=e.getSetting("ovpCardProperties");var m=v.getProperty("/entityType");var h=c.getObject("/"+p+"/");var y,P;for(y in h){if(y.startsWith("$")){continue}P=m.$Type.concat("/",y);h[y].annotations=c.getData(y).$Annotations[P]}var C=Oe(v,a);if(C.length>0){u+=", filters: "+JSON.stringify(C)}var T=[];var b=f.oMetaModel.getData().$Annotations;var $=wt(i,b,t.$Type);T.push("'"+i+"Agg' : { 'name' : '"+i+"', 'with' : '"+$+"'}");if(r&&r.Criticality&&r.Criticality.$Path){$=wt(r.Criticality.$Path,b,t.$Type);T.push("'"+r.Criticality.$Path+"Agg' : { 'name' : '"+r.Criticality.$Path+"', 'with' : '"+$+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.DeviationRangeLowValue&&r.CriticalityCalculation.DeviationRangeLowValue.$Path){$=wt(r.CriticalityCalculation.DeviationRangeLowValue.$Path,b,t.$Type);T.push("'"+r.CriticalityCalculation.DeviationRangeLowValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.DeviationRangeLowValue.$Path+"', 'with' : '"+$+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.ToleranceRangeLowValue&&r.CriticalityCalculation.ToleranceRangeLowValue.$Path){var $=wt(r.CriticalityCalculation.ToleranceRangeLowValue.$Path,b,t.$Type);T.push("'"+r.CriticalityCalculation.ToleranceRangeLowValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.ToleranceRangeLowValue.$Path+"', 'with' : '"+$+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.DeviationRangeHighValue&&r.CriticalityCalculation.DeviationRangeHighValue.$Path){var $=wt(r.CriticalityCalculation.DeviationRangeHighValue.$Path,b,t.$Type);T.push("'"+r.CriticalityCalculation.DeviationRangeHighValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.DeviationRangeHighValue.$Path+"', 'with' : '"+$+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.ToleranceRangeHighValue&&r.CriticalityCalculation.ToleranceRangeHighValue.$Path){var $=wt(r.CriticalityCalculation.ToleranceRangeHighValue.$Path,b,t.$Type);T.push("'"+r.CriticalityCalculation.ToleranceRangeHighValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.ToleranceRangeHighValue.$Path+"', 'with' : '"+$+"'}")}if(r&&r.TrendCalculation&&r.TrendCalculation.ReferenceValue&&r.TrendCalculation.ReferenceValue.$Path){var $=wt(r.TrendCalculation.ReferenceValue.$Path,b,t.$Type);T.push("'"+r.TrendCalculation.ReferenceValue.$Path+"Agg' : { 'name' : '"+r.TrendCalculation.ReferenceValue.$Path+"', 'with' : '"+$+"'}")}var V=de(l);var D=V?", custom: {cardId: '"+l.getProperty("/cardId")+"'}":"";var I="parameters:{'$$aggregation' : {'aggregate' : {"+T.join(",")+"}}"+D+"}";return n+", "+I+u+"}"}Ut.requiresIContext=true;function wt(e,t,r){var a=t[r+"/"+e];if(a["@Org.OData.Aggregation.V1.default"]){return a["@Org.OData.Aggregation.V1.default"].$EnumMember.split("/")[1].toLowerCase()}return"sum"}function qt(e,t,r){var a;var i,n,o;for(o in t){if(o!==e){continue}if(t[o].annotations&&t[o].annotations.hasOwnProperty("@"+C.ISO_CURRENCY)){i=t[o].annotations["@"+C.ISO_CURRENCY].$Path;n=t[o].annotations["@"+C.ISO_CURRENCY].$String;if(i){return i}else{return r?n:""}}if(t[o].annotations&&t[o].annotations.hasOwnProperty("@"+C.UOM)){i=t[o].annotations.hasOwnProperty("@"+C.UOM).$Path;n=t[o].annotations["@"+C.UOM].$String;if(i){a=i}else{a=r?n:""}if(a&&a!="%"){return a}else{return null}}if(t[o].annotations&&t[o].annotations.hasOwnProperty("sap:unit")){return t[o].annotations["sap:unit"]}break}return null}function Lt(e){if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");var i=te(a,r,e.Value.$Path);if(i[C.UOM]){var n=i[C.UOM];if(n.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true}}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}var o={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var u="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var l=[e.Value.$Path+"Agg"];return re(l,u,o,true)}function _t(){var t=arguments[arguments.length-1],r=arguments[0];r=Number(r);var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function Bt(e,t){if(!t||!t.Value||!t.Value.$Path||!t.TrendCalculation){return""}var r=Ee(t.Value,true);var a=Ee(t.TrendCalculation.ReferenceValue,true);var i=Ee(t.TrendCalculation.DownDifference,true);var n=Ee(t.TrendCalculation.UpDifference,true);var o=he(a);var u=he(i);var l=he(n);var s={referenceValue:a,downDifference:i,upDifference:n,bIsRefValBinding:o,bIsDownDiffBinding:u,bIsUpDiffBinding:l};var f="{value:"+JSON.stringify(s)+", model: 'ovpCardProperties'}";var c="parts: ["+r;c+=o?","+a:"";c+=u?","+i:"";c+=l?","+n:"";c+=","+f;c+="]";var p="sap.ovp.cards.v4.V4AnnotationHelper.formatTrendIcon";return"{"+c+", formatter: '"+p+"'}"}Bt.requiresIContext=true;function kt(){var e=arguments[arguments.length-1];var t=1;return A(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)}function Ht(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}if(e.TrendCalculation.ReferenceValue.$Path){return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}, {path:'"+e.TrendCalculation.ReferenceValue.$Path+"'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}else{return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}}function jt(t,r){var a,i,n,o,u=false;if(typeof t=="string"){t=e.getFloatInstance().parse(t)}if(isNaN(+t)){return""}if(t==0){o=r}else{o=t}i=this.getModel("ovpCardProperties");if(i.getProperty("/iNumberOfFractionalDigits")){n=+i.getProperty("/iNumberOfFractionalDigits")}if(i.getProperty("/bPercentageAvailableForTarget")){u=true}if(r){a=r}else{if(i.getProperty("/sManifestTargetValue")){a=i.getProperty("/sManifestTargetValue")}}if(!n||n<0){n=0}else if(n>2){n=2}if(a){var l=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(u){return l.format(+a)+" %"}else{return l.format(+a)}}}function Gt(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){t.setProperty("/iNumberOfFractionalDigits",e.ValueFormat.NumberOfFractionalDigits)}if(e.TrendCalculation.ReferenceValue){if(e.TrendCalculation.ReferenceValue.$Path){var i=te(a,r,e.TrendCalculation.ReferenceValue.$Path);if(i[C.UOM]){var n=i[C.UOM];if(n.String=="%"){t.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'},{path:'"+e.TrendCalculation.ReferenceValue.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}if(e.TrendCalculation.ReferenceValue){t.setProperty("/sManifestTargetValue",e.TrendCalculation.ReferenceValue);return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}}}function Xt(t,r){var a,i,n;if(typeof t=="string"){t=e.getFloatInstance().parse(t)}if(isNaN(+t)){return""}t=+t;n=this.getModel("ovpCardProperties");if(n.getProperty("/iNumberOfFractionalDigits")){a=+n.getProperty("/iNumberOfFractionalDigits")}if(r){i=+r}else{if(n.getProperty("/sManifestTargetValue")){i=+n.getProperty("/sManifestTargetValue")}}if(!a||a<0){a=0}else if(a>2){a=2}if(i){var o=(t-i)/i;var u=e.getPercentInstance({style:"short",minFractionDigits:a,maxFractionDigits:a,showScale:true});return u.format(o)}}function Yt(e){if(e&&e.GroupBy&&!h(e.GroupBy)&&e.GroupBy[0].hasOwnProperty("$PropertyPath")){return true}else{return false}}function zt(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function Jt(e,t){return zt(e,t)}function Qt(e,t){var r=zt(e,t);return r?r:l.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function Wt(e){var t="";var r=e&&e.GroupBy;if(!r){return t}var a=this.getModel("ovpCardProperties").getProperty("/metaModel");var i=this.getModel("ovpCardProperties").getProperty("/entityType");var n;if(e.GroupBy.constructor===Array){n=e.GroupBy}else if(!e.GroupBy.Collection){return t}else{n=e.GroupBy.Collection}var o;c(n,function(){o=ir(a,i,this.$PropertyPath);if(!o){return}t+=o;t+=", "});if(t[t.length-1]===" "&&t[t.length-2]===","){t=t.substring(0,t.length-2)}return t==""?"":l.getText("By",[t])}function Kt(e,t,r){var a=true;var i=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][i].PropertyName.PropertyPath){a=false}t=[t];var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");var l=Oe(n,t);if(l.length==0){return""}var s;var f;s=l[0].path;f=nr(u,o,s);if(f!==s){return""}var c=u.getODataProperty(o,t[0].PropertyName.PropertyPath)["type"];var p=rr(l,c);if(a===true){return p+", "}return p}Kt.requiresIContext=true;function Zt(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var u=n.getODataProperty(o,r[t.index].path)["type"];var l=rr([r[t.index]],u);if(a===true){return l+", "}return l}Zt.requiresIContext=true;function er(e){return e.id}function tr(e){return e.id}function rr(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(ar(e[a],t))}return r.join(", ")}function ar(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=l.getText("kpiHeader_Filter_NotOperator",[i])}return i}function ir(e,t,r){return or(e,t,r,"com.sap.vocabularies.Common.v1.Label")}function nr(e,t,r){return or(e,t,r,"sap:text")}function or(e,t,r,a){var i={};i[r]=te(e,t,r);if(!i){$.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}if(i[r].annotations){var n=i[r].annotations["@"+a]}if(n){return n}return Object.keys(i)[0]}function ur(e){if(!e||!e.Value||!e.Value.$Path){return""}var t={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var r="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var a=[e.Value.$Path];return re(a,r,t)}function lr(e,t){if(t.hasOwnProperty(e)){return true}return false}function sr(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function fr(e){if(e){return undefined}return"_BASIC"}function cr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("ContactInformationType/work")>=0){var i=a.format(t[r].address,{context:e});return i}}return""}cr.requiresIContext=true;function pr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/work")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}pr.requiresIContext=true;function gr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/cell")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}gr.requiresIContext=true;function vr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/fax")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}vr.requiresIContext=true;return{getGroupID:fr,getConditionTypeForDateProperties:sr,isDateRangeType:lr,criticalityConstants:P,TextArrangementType:T,getLabelForDataItem:D,colorPaletteForComparisonMicroChart:se,formatField:W,checkFilterPreference:de,formatItems:Pe,getCardSelections:De,getCardSorters:Ie,getFilters:Oe,getPrimitiveValue:xe,getAnnotationLabel:Jt,getApplicationName:Qt,removeDuplicateDataField:Me,formatUrl:Re,getDataPointsCount:Ue,getFirstDataPointValue:we,getFirstDataFieldName:_e,getSecondDataFieldName:Be,getRequestFields:Ve,getThirdDataFieldName:ke,formatDataFieldValueOnIndex:Ge,formatDataPointValueOnIndex:Xe,formatDataPointOrField:Ye,formatsemanticObjectOfDataFieldGeneric:ze,getLabelForFirstDataPoint:Ke,formatImageUrl:Ze,formatUnit:et,formatObjectNumber:tt,formatFirstDataPointState:rt,formatFirstDataPointColor:at,formatSecondDataPointState:it,formatThirdDataPointState:nt,formatFirstDataPointStateForSmartField:ot,formatKPIHeaderState:lt,isFirstDataPointCriticality:st,isFirstDataPointCriticalityForTableStatus:ft,getSortedDataFields:M,getSortedDataPoints:R,formatDataFieldValueGeneric:vt,formatDataPointValue:dt,formatDataPointStateGeneric:Pt,checkCriticalityGeneric:Ct,checkCriticalityGenericForTableStatus:Tt,formatDataPointStateForSmartFieldGeneric:bt,hasActions:$t,isFirstDataPointPercentageUnit:Vt,resolveEntityTypePath:Dt,resolveParameterizedEntitySet:St,getAssociationObject:Nt,semanticObjectOfFirstDataField:Et,semanticObjectOfSecondDataField:At,isFirstContactAnnotation:Rt,getAggregateNumber:Ut,KpiValueFormatter:_t,kpiValueCriticality:ut,formThePathForAggregateNumber:Lt,formThePathForTrendIcon:Bt,formPathForPercentageChange:Ht,TargetValueFormatter:jt,formPathForTargetValue:Gt,returnPercentageChange:Xt,isPresentationVarientPresent:Yt,listGroupBy:Wt,formTheFilterByString:Kt,formTheFilterByStringNotFromSelVar:Zt,formTheIdForFilter:er,formTheIdForFilterNotFromSelVar:tr,_criticality2state:S,_calculateCriticalityState:E,_calculateTrendDirection:A,_getPropertiesFromBindingString:be,sortCollectionByImportance:B,checkNavTargetForContactAnno:ht,checkForContactAnnotation:yt,getKPIHeaderAggregateNumber:ur,formatColor:me,formatTrendIcon:kt,formatNumberCalculation:ae,formatCurrency:ne,formatDate:ie,getSapTextPathForUOM:ee,getEmail:cr,getPhone:pr,getDevice:gr,getPhoneType:vr,generatePathForField:re}},true);
//# sourceMappingURL=V4AnnotationHelper.js.map
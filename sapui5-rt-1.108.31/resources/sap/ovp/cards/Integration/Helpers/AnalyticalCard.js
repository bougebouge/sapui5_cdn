sap.ui.define(["sap/ovp/cards/charts/Utils","sap/ovp/cards/Integration/Helpers/i18n","sap/ovp/cards/Integration/Helpers/Batch"],function(e,t,a){"use strict";var r={},n=0,i=0,s={},o={},u={};function l(e,t){if(r&&!r[e]){r[e]=t}else{var a=r[e];for(var n in t){if(t.hasOwnProperty(n)&&a.hasOwnProperty(n)&&a[n]!==t[n]){a[n]=t[n]}}}}function p(){n=0;i=0;s={}}function c(e,t){var a=e&&e.getFeeds(),r;for(var n=0;n<a.length;n++){if(a[n]&&a[n].getValues()&&a[n].getValues().indexOf(t)>-1){r=n;s[r]=s[r]+1||0}}return{sFeedNo:r,count:s[r]}}function g(e,t,a){if(!o[e]){o[e]={}}o[e][t]=a}function d(e,t){if(o){if(o[e]){return o[e][t]}}}function f(e,t){u[e]=t}function v(e){return u&&u[e]}function y(t,a,r){if(t==="date"){var n=r.property.filter(function(e){return e.name===a});var i=e.getSemanticProperties(n);var s=i&&i.propertyType;if(s){var o={propertyType:s};return"{= extension.formatters.formatDateValue(${"+a+"},"+JSON.stringify(o)+")}"}return"{= format.dateTime(${"+a+"}, {pattern: 'YYYY-MM-dd'}) }"}return"{"+a+"}"}function m(e,t,a){if(a){return a}else if(t){return"{"+t+"}"}else{return e.getProperty("displayValue")||""}}function T(e,s,o){var u=e.entityType,l=e.vizFrame,g=e.cardComponentData.cardId,f=e.view,v=a.getBatchObject(e,o["configuration"]);var T=u[s],h=T.Title&&T.Title.String||"",P=l.getVizType(),V=g,b=g,M,_;if(!h&&f.byId("ovpCT")){h=f.byId("ovpCT").getText()}if(h&&!h.startsWith("{")){M=h.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");M=g+"_"+M.replace(/ /g,"_");_=h;t.seti18nValueToMap("content.chartProperties.title.text","{{"+M+"}}",true);t.inserti18nPayLoad(g,M,h,"Title","chart Title")}else if(h.includes("@i18n&gt;")){var F=h.split("@i18n&gt;");_="{{"+F[1]+"}"}else if(h.includes("@i18n>")){var F=h.split("@i18n>");_="{{"+F[1]+"}"}var C=function(e,a,r){return function(i){var s=i.getBinding("displayValue"),o=s&&s.getPath(),u=i.getBinding("value"),l=u&&u.getPath(),p=i.getName(),g=p.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");var f="";if(l){f=d(a,l)}e=e+"_"+g.replace(/ /g,"_")+"_"+n;t.inserti18nPayLoad(a,e,p,"Label","chart dimension name");t.seti18nValueToMap("content.dimensions."+n+".label","{{"+e+"}}",true);var v=i.getParent().getParent(),T=c(v,p);t.seti18nValueToMap("content.feeds."+T.sFeedNo+".values."+T.count,"{{"+e+"}}",true);n=n+1;return{label:p,value:y(i.getProperty("dataType"),l,r),dataType:i.getProperty("dataType"),displayValue:m(i,o,f)}}};var D=function(e){return function(a){var r=a.getBinding("value"),n=r&&r.getPath(),s=a.getName(),o=s.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");e=e+"_"+o.replace(/ /g,"_")+"_"+i;t.inserti18nPayLoad(g,e,s,"Label","chart measure name");t.seti18nValueToMap("content.measures."+i+".label","{{"+e+"}}",true);var u=a.getParent().getParent(),l=c(u,s);t.seti18nValueToMap("content.feeds."+l.sFeedNo+".values."+l.count,"{{"+e+"}}",true);i=i+1;return{label:s,value:"{"+n+"}"}}};p();var I={chartType:P,chartProperties:r&&r[l&&l.getId()]||{},title:{text:_,visible:true,alignment:"Left"},dimensions:l.getDataset().getDimensions().map(C(b,g,u)),measures:l.getDataset().getMeasures().map(D(V)),feeds:l.getFeeds().map(function(e){return{type:e.getType(),uid:e.getUid(),values:e.getValues()}}),data:{path:"/content/d/results"},actionableArea:"Chart"};if(!v.header){I.data.path="/d/results"}return I}return{setVizPropertyMap:l,setDimensionPath:g,setUoMForSubTitle:f,getUoMForSubTitle:v,createChartContent:T}});
//# sourceMappingURL=AnalyticalCard.js.map
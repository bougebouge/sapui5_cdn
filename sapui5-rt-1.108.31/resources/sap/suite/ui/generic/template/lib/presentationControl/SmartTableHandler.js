sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/model/base/ManagedObjectModel","sap/ui/dom/getFirstEditableInput","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper"],function(e,t,n,r,i,a){"use strict";function o(e,t,o,u){var s=u.getTable();var g=i.isMTable(s);var l=i.isUiTable(s);var c=i.isTreeTable(s);var f=l?"rows":"items";function d(){return s.getBinding(f)}function v(){return u.getTableBindingPath()}function b(){return s.getColumns()}function p(){var e=[];if(g){e=s.getSelectedContexts()}else if(l){var t=s.getPlugins().filter(function(e){return e.isA("sap.ui.table.plugins.SelectionPlugin")})[0];var n=t?t.getSelectedIndices():s.getSelectedIndices();if(n){var r;for(var i=0;i<n.length;i++){r=s.getContextByIndex(n[i],true);if(r){e.push(r)}}}}return e}function h(){var e=d();if(!e){return null}if(c){var t=e.getLength()>0?e.getLength():0;var n=[];for(var r=0;r<t;r++){var i=e.getContextByIndex(r);n.push(i)}return n}return l?e.getContexts():e.getCurrentContexts()}function m(){return u.getModel()}function C(){var e=[];var t=u.getCustomData().find(function(e){return e.getKey()==="TemplateSortOrder"});var n=t&&t.getValue();if(n){n.split(", ").forEach(function(t){var n=t.split(" ");e.push({Property:n[0],Descending:n.length>1})})}return e}function P(){return s.getAggregation(f)}function I(){return t.setEnabledToolbarButtons(u)}function T(){return t.setEnabledFooterButtons(u)}function S(e){u.attachAfterVariantInitialise(function(){u.setCurrentVariantId(e)});u.setCurrentVariantId(e)}function x(){return s.getBindingInfo(f)}function y(e,t,n){e(n)}function B(t,n,r){var i=x();if(i&&i.binding){return new Promise(function(a,u){var s=function(e){i.binding.detachDataReceived(s);y(a,u,e);if(typeof r==="function"){(r||Function.prototype)()}};i.binding.attachDataReceived(s);if(t){i.binding.refresh(t)}else{i.binding.refresh()}if(!n&&e.getView().getModel("ui").getProperty("/editable")){o.messagesRefresh()}})}else{return F()}}function F(){return new Promise(function(e,t){var n=function(r){u.detachBeforeRebindTable(n);var i=r.getParameters().bindingParams;var a=i.events.dataReceived||Function.prototype;var o=function(n){a.call(this,n);y(e,t,n)};i.events.dataReceived=o};u.attachBeforeRebindTable(n);u.rebindTable()})}function R(t){var n=e.getOwnerComponent();var r=n.getModel().getMetaModel();var i=[];var a=r.getODataEntitySet(n.getEntitySet())["Org.OData.Capabilities.V1.SortRestrictions"];if(a&&a.NonSortableProperties){i=a.NonSortableProperties.map(function(e){return e.PropertyPath})}var o=t.filter(function(e){return!i.includes(e.Property)});var s=u.getUiState();var g=s.getPresentationVariant();if(!g.SortOrder){g.SortOrder=C()}g.SortOrder=g.SortOrder.concat(o);s.setPresentationVariant(g);u.setUiState(s)}function w(e){if(g){var t=s.getItems().findIndex(function(t){return t.getBindingContextPath()===e});if(t>-1){s.scrollToIndex(t)}}}function V(e){var t=e.getPath();var n=-2;for(var r=0;n===-2;r++){var i=s.getContextByIndex(r,true);var a=i&&i.getPath();if(a===t){n=r}else if(!i){n=-1}}return n}function O(e){var t=s.getFirstVisibleRow();var n=s.getVisibleRowCount();var r=e.getPath();for(var i=0;i<n;i++){if(s.getContextByIndex(t+i,true).getPath()===r){return s.getRows()[i]}}}a.testable(O,"getGridTableRow");a.testable(V,"getGridTableRowIndexFromContext");function E(e){var t=e&&r(e.getDomRef());var n=t&&i.getUI5ControlForDomElement(t);i.focusUI5Control(n)}function D(e){if(g){var t=s.getItems();var n=t.find(function(t){return e.getPath()===t.getBindingContext().getPath()});if(n){setTimeout(function(){E(n)},0)}}else{var r=V(e);if(r!==-1){s.setFirstVisibleRow(r);setTimeout(function(){var t=O(e);E(t)},0)}}}function M(){return new Promise(function(e,t){N(function(){Promise.resolve(i.searchInTree(s,function(e){if(i.isSmartField(e)){return i.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e})}})).then(e)})})}function U(){return g?s.getGrowingThreshold():s.getThreshold()}function A(){return u.getDataStateIndicator()}function G(){return g}function H(){return u.getToolbar()}function N(e){if(!s.getBusy()){e();return}var t=new n(s);var r=t.bindProperty("/busy");var i=function(){t.destroy();N(e)};r.attachChange(i)}return{getBinding:d,getBindingPath:v,getSelectedContexts:p,getCurrentContexts:h,getVisibleProperties:b,getItems:P,getBindingInfo:x,getModel:m,setEnabledToolbarButtons:I,setEnabledFooterButtons:T,setCurrentVariantId:S,setCurrentTableVariantId:S,setCurrentChartVariantId:Function.prototype,refresh:B,rebind:F,applyNavigationSortOrder:R,scrollToSelectedItemAsPerChildContext:w,getFirstFocussableEditableCellPromise:M,setFocusOnFirstEditableFieldInTableRow:D,getThreshold:U,getDataStateIndicator:A,getToolbar:H,isMTable:G}}return e.extend("sap.suite.ui.generic.template.lib.presentationControl.SmartTableHandler",{constructor:function(e,n,r,i){t(this,o(e,n,r,i))}})});
//# sourceMappingURL=SmartTableHandler.js.map
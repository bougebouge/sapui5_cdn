/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/utils/filter"],function(e){"use strict";var t=function(t,i,r){var n;var s;var l=new e(t.instances.messageHandler);var u;var a;var o=0;var f=0;var c=jQuery.extend(true,[],r);var d;if(i.preselectionDefaults&&i.preselectionDefaults.length>0){d=jQuery.extend(true,[],i.preselectionDefaults)}else if(jQuery.isFunction(i.preselectionFunction)){d=jQuery.extend(true,[],i.preselectionFunction())}var p=false;if(i.valueHelpRequest||jQuery.isArray(i.valueList)&&i.valueList.length>0){p=true}var v=false;var y={};var h={};var g;D=D.bind(this);x=x.bind(this);E=E.bind(this);R=R.bind(this);F=F.bind(this);Q=Q.bind(this);this.hasValueHelpRequest=function(){return!!i.valueHelpRequest};this.setContext=function(e){if(i.notConfigured===true){r=e}else{t.instances.messageHandler.putMessage(t.instances.messageHandler.createMessageObject({code:"5100",aParameters:["Context of configured Startfilter cannot be changed"]}))}};this.getPropertyName=function(){return i.property};this.getLabel=function(){return i.label};this.getAliasNameIfExistsElsePropertyName=function(){return i.alias||i.property};this.isMultiSelection=function(){if(i.multiSelection==="true"||i.multiSelection===true){return true}return false};this.isVisible=function(){if(r&&r.type==="internalFilter"&&!i.filterResolutionRequest){return false}return!i.invisible};this.setRestriction=function(e){l=e.copy();if(!a){a=jQuery.Deferred()}m(++f)};this.setSelectedValues=function(e,t){if(!a){a=jQuery.Deferred()}if(!n){n=jQuery.Deferred();if(!t){F().done(function(e){if(n){n.resolve(e)}})}else{n.resolve(e)}}if(e.type==="internalFilter"){s=e}else{s=jQuery.extend(true,[],e)}if(!t){m(++f)}};this.getSelectedValues=function(){var e;if(!a){a=jQuery.Deferred();e=a;m(++f)}else if(a.state()==="pending"){e=a;if(n){n.done(function(){m(++f)})}else{m(++f)}}return e.promise()};this.getValues=function(){var e;if(!u||u.state()!=="pending"){u=jQuery.Deferred()}e=u;j(++o);return e.promise()};this.getMetadata=function(){if(i.metadataProperty){return jQuery.Deferred().resolve(i.metadataProperty)}return jQuery.Deferred().resolve({})};this.serialize=function(e,t){var i=jQuery.Deferred();var r={propertyName:this.getPropertyName()};F().done(function(s){if(s&&s.type==="internalFilter"){s=s.mapToSapUI5FilterExpression()}r.selectedValues=s;if(n){n.done(function(s){if(e===true){r.initiallySelectedValues=s}if(t!==true){n=null}i.resolve(r)})}else{i.resolve(r)}});return i};this.deserialize=function(i){if(i.selectedValues&&(i.selectedValues.aFilters||i.selectedValues.sPath)){i.selectedValues=e.transformUI5FilterToInternal(t.instances.messageHandler,i.selectedValues)}s=null;if(i.initiallySelectedValues){n=jQuery.Deferred().resolve(i.initiallySelectedValues)}else{n=null}if(jQuery.isArray(i.selectedValues)){c=jQuery.extend(true,[],i.selectedValues);r=jQuery.extend(true,[],i.selectedValues)}else{c=i.selectedValues;r=i.selectedValues}v=false};this.reset=function(){if(n){n.done(function(e){s=e})}};function j(e){Q(e,o).done(function(t){if(e===o){u.resolve(t)}})}function m(e){F(e).done(function(t){if(e===f){var i=a;a=jQuery.Deferred();i.resolve(t,a.promise())}})}function Q(e,t){var n=jQuery.Deferred();var s=[];l=l.bind(this);if(p&&jQuery.isArray(r)){V(e,t).then(function(e){var t=e.data;var i=D(c,t);n.resolve(i)})}else if(r&&r.type==="internalFilter"&&p&&i.filterResolutionRequest){jQuery.when(V(e,t),R(e,t)).then(function(e,t){var i=e.data;l(t.data,i);n.resolve(i)})}else if(p&&(i.preselectionDefaults&&i.preselectionDefaults.length>0||jQuery.isFunction(i.preselectionFunction))){V(e,t).then(function(e){var t=e.data;g=D(d,t);n.resolve(g)})}else if(p){V(e,t).then(function(e){n.resolve(e.data)})}else if(r&&r.type==="internalFilter"&&i.filterResolutionRequest){R(e,t).then(function(e){n.resolve(e.data)})}else if(jQuery.isArray(r)&&i.filterResolutionRequest&&!p){R(e,t).then(function(e){n.resolve(e.data)})}else if(jQuery.isArray(r)){s=D(c,s);n.resolve(s)}else if((i.preselectionDefaults&&i.preselectionDefaults.length>0||jQuery.isFunction(i.preselectionFunction))&&!p&&!i.filterResolutionRequest&&!r){if(this.isMultiSelection()){g=D(d,s)}else if(d.length>0){g=D([d[0]],s)}n.resolve(g)}else if((i.preselectionDefaults&&i.preselectionDefaults.length>0||jQuery.isFunction(i.preselectionFunction))&&i.filterResolutionRequest&&!r){if(this.isMultiSelection()){g=D(d,s)}else if(d.length>0){g=D([d[0]],s)}n.resolve(g)}else if(r&&r.type==="internalFilter"||!r){n.resolve(null)}return n.promise();function l(e,t){var i=E(t);for(var r=e.length-1;r>=0;r--){if(!i[e[r][this.getAliasNameIfExistsElsePropertyName()]]){t.unshift(e[r])}}}}function D(e,t){var i=jQuery.extend(true,[],t);var r=E(t);var n;for(var s=e.length-1;s>=0;s--){if(!r[e[s]]){n={};n[this.getAliasNameIfExistsElsePropertyName()]=e[s];i.unshift(n)}else if(!v){e.splice(s,1)}}v=true;return i}function F(e){var t=jQuery.Deferred();var n;var l;var u;var a=this;if(s){if(!i.invisible){c(jQuery.extend(true,[],s),e)}else{n=s;o()}}else if(jQuery.isFunction(i.preselectionFunction)&&!p){n=i.preselectionFunction();o()}else if(r&&r.type==="internalFilter"&&!i.filterResolutionRequest){t.resolve(r)}else if(i.preselectionDefaults===null&&!r){t.resolve([])}else if(i.filterResolutionRequest&&!r&&!p&&!(i.preselectionDefaults&&i.preselectionDefaults.length>0)){t.resolve(null)}else if(r&&r.type==="internalFilter"&&i.filterResolutionRequest){R(e,f).then(function(t){var i=x(t);c(jQuery.extend(true,[],i),e)})}else if(p&&!jQuery.isArray(r)&&!(i.preselectionDefaults&&i.preselectionDefaults.length>0)&&!i.preselectionFunction){V(e,f).then(function(e){var t=x(e);if(this.isMultiSelection()){n=t}else{n=[t[0]]}o()}.bind(this))}else if(p&&!jQuery.isArray(r)&&(i.preselectionDefaults&&i.preselectionDefaults.length>0||i.preselectionFunction)){if(jQuery.isFunction(i.preselectionFunction)){l=i.preselectionFunction()}else{l=i.preselectionDefaults}c(jQuery.extend(true,[],l),e)}else if(jQuery.isArray(r)){c(r,e)}else if(i.preselectionDefaults&&i.preselectionDefaults.length>0){n=i.preselectionDefaults;c(n,e)}else{t.resolve(null)}return t.promise();function o(){if(n&&n.type==="internalFilter"){t.resolve(n)}else{t.resolve(jQuery.extend(true,[],n))}}function c(e,t){Q(t,f).done(function(t){if(t!==null){n=[];u=E(t);e.forEach(function(e){if(u[e]){n.push(e)}});if(e.length!==0&&n.length===0&&i.preselectionDefaults!==null){n=x({data:t})}if(!a.isMultiSelection()){n=[n[0]]}if(s!==null){s=n}}else{n=null}o()})}}function R(n,s){var u;var a=jQuery.Deferred();if(n&&n!==s){return a.promise()}var o;if(jQuery.isArray(r)){o=new e(t.instances.messageHandler);r.forEach(function(e){o.addOr(this.getAliasNameIfExistsElsePropertyName(),"eq",e)}.bind(this))}else if(r instanceof e){o=r}else{o=new e(t.instances.messageHandler)}if(!l.isEmpty()){u=new e(t.instances.messageHandler);u.addAnd(l).addAnd(o)}else{u=o}if(y.lastMergedFilter&&y.lastMergedFilter.isEqual(u)){y.lastFilterResolutionPromise.done(function(e){a.resolve(e)})}else{y.lastMergedFilter=u.copy();y.lastFilterResolutionPromise=a;t.functions.createRequest(i.filterResolutionRequest).sendGetInBatch(u,f,undefined)}return a.promise();function f(e){a.resolve(e)}}function V(e,t){var r;if(i.valueHelpRequest){return q(e,t)}else if(i.valueList){r={data:D(i.valueList,[])};return jQuery.Deferred().resolve(r)}}function q(e,r){var n=jQuery.Deferred();var s={paging:{top:1e5,skip:0,inlineCount:true}};if(e&&r!==e){return n.promise()}if(h.lastRestriction&&h.lastRestriction.isEqual(l)){h.lastValueHelpPromise.done(function(e){n.resolve(e)})}else{h.lastRestriction=l.copy();h.lastValueHelpPromise=n;t.functions.createRequest(i.valueHelpRequest).sendGetInBatch(l,u,s)}return n.promise();function u(e){n.resolve(e)}}function x(e){var t=[];e.data.forEach(function(e){t.push(e[this.getAliasNameIfExistsElsePropertyName()])}.bind(this));return t}function E(e){var t={};e.forEach(function(e){var i=e[this.getAliasNameIfExistsElsePropertyName()];t[i]=true}.bind(this));return t}};sap.apf.utils.StartFilter=t;return t},true);
//# sourceMappingURL=startFilter.js.map
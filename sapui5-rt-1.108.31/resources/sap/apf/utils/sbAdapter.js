sap.ui.define(["sap/apf/abap/LrepConnector","sap/base/Log","sap/ui/thirdparty/datajs"],function(e,n){"use strict";var a={semanticObject:"FioriApplication",action:"executeAPFConfiguration"};var t={semanticObject:"FioriApplication",action:"editAPFConfiguration"};var r={semanticObject:"FioriApplication",action:"executeAPFConfigurationS4HANA"};var i={semanticObject:"FioriApplication",action:"editAPFConfigurationS4HANA"};var o="/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata/AnalyticalConfigurationQueryResults";var s=undefined;var u={};u._hanaConfigurations=undefined;u._lrepConfigurations=undefined;u.getConfigurations=function(e,n){var t=jQuery.Deferred();var i=[];jQuery.when(p(),c()).then(function(o,s){i=s.concat(o);var u=C(e,n);if(u&&!m(u,a)&&!m(u,r)){i.forEach(function(e){e.runtimeIntent=u})}t.resolve(i)});return t.promise()};u.getTargetMappingInstaceIDsWithConfigurations=function(e,n,t,i){var o=jQuery.Deferred();var s=[];var u=[];jQuery.when(p(),c()).then(function(c,p){l(t,i).then(function(t){return f(1e3).then(function(){s=p.concat(c);var i=C(e,n);t.forEach(function(e){if(e.semanticParameters["sap-apf-configuration-id"]){var n=e.semanticParameters["sap-apf-configuration-id"].defaultValue;s.forEach(function(t){if(n.value===t.id){t.targetMappingInstanceId=e;if(i&&!m(i,a)&&!m(i,r)){t.runtimeIntent=i}u.push(t)}})}});o.resolve(u)})})});return o.promise();function f(e,n){return new Promise(function(a){setTimeout(a.bind(null,n),e)})}};u.getConfigurationNameById=function(e){var n=jQuery.Deferred();if(!e){return n.resolve("")}if(e.indexOf(".")>-1){p().done(a)}else{c().done(a)}return n.promise();function a(a){a.forEach(function(a){if(a.id===e){n.resolve(a.title)}});if(n.state!=="resolved"){n.resolve("")}}};function c(){var e=jQuery.Deferred();if(!u._hanaConfigurations){var n={requestUri:o+"?$select=AnalyticalConfiguration,AnalyticalConfigurationName,Application",async:true,method:"GET"};OData.request(n,r,i)}else{e.resolve(jQuery.extend(true,[],u._hanaConfigurations))}return e.promise();function r(n){var r=[];n.results.forEach(function(e){r.push({title:e.AnalyticalConfigurationName,id:e.AnalyticalConfiguration,runtimeIntent:a,modelerIntent:t,configurationId:e.AnalyticalConfiguration,applicationId:e.Application})});u._hanaConfigurations=jQuery.extend(true,[],r);e.resolve(r)}function i(){u._hanaConfigurations=[];e.resolve([])}}function p(){var e=jQuery.Deferred();if(!u._lrepConfigurations){g().then(function(n){var a=[];n.response.forEach(function(e){var n;var t;if(e.fileType&&e.fileType==="apfconfiguration"){n=v(e);t=e.name;a.push({title:h(e,"apfdt-configname"),id:n+"."+t,runtimeIntent:r,modelerIntent:i,configurationId:t,applicationId:n})}});u._lrepConfigurations=jQuery.extend(true,[],a);e.resolve(a)},function(){e.resolve([]);u._lrepConfigurations=[]})}else{e.resolve(jQuery.extend(true,[],u._lrepConfigurations))}return e.promise()}function f(e){var n;if(sap.ushell.Container&&sap.ushell.Container.getService){if(e=="S")n=sap.ushell.Container.getService("PageBuilding","CONF").getFactory();else if(e=="C")n=sap.ushell.Container.getService("PageBuilding","CUST").getFactory();else n=sap.ushell.Container.getService("PageBuilding","PERS").getFactory();return n}}function l(e,a){var t=jQuery.Deferred();var r=a;var i=[];var o=f(e);var u=o.getPageBuildingService();u.readCatalog(r,jQuery.proxy(function(e){if(e&&e.Chips&&e.Chips.results instanceof Array){jQuery.each(e.Chips.results,jQuery.proxy(function(e,a){try{if(a&&a.baseChipId==="X-SAP-UI2-CHIP:/UI2/ACTION"){s=a;var r=JSON.parse(s.configuration);var o=JSON.parse(r.tileConfiguration);var u=o.ui5_component;var c="smartbusiness";var p="sap.apf";if(u&&u.indexOf(c)===-1){d(u).then(function(e){jQuery.each(e.response.results,jQuery.proxy(function(e,a){if(a&&a["sap.ui5/dependencies/libs"]){if(a["sap.ui5/dependencies/libs"].indexOf(p)!==-1){var t;var r=JSON.parse(s.configuration);var o=JSON.parse(r.tileConfiguration);var u=o.signature&&o.signature.parameters;if(s.ChipBags&&s.ChipBags.results instanceof Array){jQuery.each(s.ChipBags.results,jQuery.proxy(function(e,a){if(a&&a.id==="tileProperties"){if(a.ChipProperties&&a.ChipProperties.results instanceof Array){jQuery.each(a.ChipProperties.results,jQuery.proxy(function(e,n){if(n&&n.name==="display_title_text"){t=n.value;return false}},this))}else{n.error("sbAdapter/getTargetMappingInstanceIDsFromCatalogID","Unable to read the properties inside the chip bag 'tileProperties' for "+s.catalogPageChipInstanceId)}return false}},this))}else{n.error("sbAdapter/getTargetMappingInstanceIDsFromCatalogID","Unable to read the chip bags for "+s.catalogPageChipInstanceId)}i.push({instanceID:s.catalogPageChipInstanceId||"",title:t||"",semanticObject:o.semantic_object||"",semanticAction:o.semantic_action||"",ui5Component:o.ui5_component||"",semanticParameters:u||{}});window.TargetMapping=i}}},this))},function(){t.resolve([])})}}}catch(e){n.error("sbAdapter/getTargetMappingInstanceIDsFromCatalogID",e&&e.message)}},this));t.resolve(i)}else{n.error("sbAdapter/getTargetMappingInstanceIDsFromCatalogID","Invalid catalog object");t.reject()}},this),jQuery.proxy(function(e,n){t.reject(n)},this));return t.promise()}function g(){var n=e.createConnector();var a={async:true,contentType:"application/json"};var t=[];t.push({name:"deep-read",value:true});t.push({name:"metadata",value:true});t.push({name:"layer",value:"CUSTOMER"});var r="/sap/bc/lrep/content/sap/apf/dt/";r+=n._buildParams(t);return n.send(r,"GET",{},a)}function d(n){var a=e.createConnector();var t={async:true,contentType:"application/json"};var r=[];r.push({name:"sap.app/id",value:n});r.push({name:"fields",value:"sap.ui5/dependencies/libs"});var i="/sap/bc/ui2/app_index";i+=a._buildParams(r);return a.send(i,"GET",{},t)}function v(e){var n=e.ns.split("/");return n[n.length-2]}function h(e,n){var a;e.metadata.forEach(function(e){if(e.name===n){a=e.value}});return a}function m(e,n){if(e.semanticObject===n.semanticObject&&e.action===n.action){return true}return false}function C(e,n){if(e&&n){return{semanticObject:e,action:n}}}return u},true);
//# sourceMappingURL=sbAdapter.js.map
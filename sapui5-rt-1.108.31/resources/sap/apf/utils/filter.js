/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/utils/filter","sap/apf/core/constants","sap/base/Log"],function(e,t,r){"use strict";var n=function(e){var t;var s=this;var a=function(){t=new i(e,n.topAndId)};this.getById=function(e){if(t){if(e===n.topAndId){return t}return t.getById(e)}return undefined};this.type="filter";this.getExpressions=function(){if(t){return t.getExpressions()}return[]};this.getInternalFilter=function(){return t.getInternalFilter()};this.getTopAnd=function(){return t};this.updateExpression=function(t,r){e.check(t===r.id,"sId differs from oExpression.id");var n=this.getById(t);n.update(r)};this.updateValue=function(t,r,n){e.check(t!==undefined,"Filter updateValue: parameter id required");e.check(r!==undefined,"Filter updateValue: parameter value is required");var i=this.getById(t);e.check(i!==undefined,"Filter updateValue: id for expression not valid");i.updateValue(r,n)};this.serialize=function(){function e(t,r){var n={id:r.getId(),type:r.type,expressions:[],terms:[]};t.forEach(function(t,i){if(t instanceof Array){if(r.type==="filterAnd"){n.terms.push(e(t,r.getAndTerms()[i]))}else if(r.type==="filterOr"){n.terms.push(e(t,r.getOrTerms()[i]))}}else{n.expressions.push(t)}});return n}return e(this.getTopAnd().getExpression(),this.getTopAnd())};this.deserialize=function(e){t=undefined;a();function r(e,t){if(e.type==="filterAnd"&&e.id!==n.topAndId){t=t.addAnd(e.id)}else if(e.type==="filterOr"&&e.id!==n.topAndId){t=t.addOr(e.id)}e.expressions.forEach(function(e){t.addExpression(e)});e.terms.forEach(function(e){r(e,t)})}r(e,this.getTopAnd());return this};this.addAnd=function(e){r.error("Method 'addAnd' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.intersectWith=function(t){var r=0;var i=[];var a;var o=new n(e);var d=s.serialize();u(d);switch(arguments.length){case 1:a=arguments[0];if(a instanceof Array){i=a}else{i.push(a)}break;default:i=Array.prototype.slice.call(arguments,0)}i.forEach(function(t){e.check(t instanceof n,"Parameter value is not of type sap.apf.utils.Filter");var r=t.serialize();u(r);Array.prototype.push.apply(d.expressions,r.expressions);Array.prototype.push.apply(d.terms,r.terms)});o.deserialize(d);return o;function u(e){if(e.id!==n.topAndId){e.id="#"+r+++"#"}e.terms.forEach(u)}};a();return this};n.createFilterFromSapUi5FilterJSON=function(e,t){var r=new n(e);function i(e,t,r){var n;t++;if(r.aFilters){if(r.bAnd){if(t!==1){n=e.addAnd()}else{n=e}}else{n=e.addOr()}r.aFilters.forEach(function(e){i(n,t,e)})}else if(r.sOperator){e.addExpression({name:r.sPath,operator:r.sOperator,value:r.oValue1,high:r.oValue2})}}i(r.getTopAnd(),0,t);return r};n.getOperators=function(){return t.FilterOperators};n.prototype.getOperators=n.getOperators;n.topAndId="filterTopAnd";var i=function(n,i){var o=i;var d=[];var u=this;this.type="filterAnd";this.getById=function(e){if(e===o){return this}var t;var r;for(r=0;r<d.length;r++){t=d[r].getById(e);if(t!==undefined){return t}}return undefined};this.getExpressions=function(){var e=[];var t;var r;for(r=0;r<d.length;r++){t=d[r].getExpression();if(t instanceof Array&&t.length===0){continue}if(t instanceof Array){e.push(t)}else{e.push([t])}}return e};this.getExpression=function(){var e=[];var t;var r;for(r=0;r<d.length;r++){t=d[r].getExpression();if(t instanceof Array&&t.length===0){continue}e.push(t)}return e};this.getCompoundExpressions=function(){r.error("Method 'getExpressions' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getId=function(){return i};this.getInternalFilter=function(){var t=new e(n);var r=d.length;var i;for(i=0;i<r;i++){t.addAnd(d[i].getInternalFilter())}return t};this.addAndTerm=function(e){r.error("Method 'addAndTerm' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getAndTerms=function(){return d};this.addOr=function(e){n.check(e===undefined||this.getById(e)===undefined,"Filter includes duplicated identifiers (IDs)");var t=new s(n,e,u);d.push(t);return t};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase()}n.check(e.id===undefined||this.getById(e.id)===undefined,"Filter includes duplicated identifiers (IDs)");n.check(e.operator!==undefined,"sap.apf.utils.Filter oExpression.operator undefined");n.check(jQuery.inArray(e.operator,t.aSelectOpt)>-1,"Filter oExpression.operator "+e.operator+" not supported");d.push(new a(n,e));return this}};var s=function(n,s,o){var d=s;var u=[];var p=o;this.type="filterOr";this.getById=function(e){if(e===d){return this}var t;for(var r=0;r<u.length;r++){t=u[r].getById(e);if(t!==undefined){return t}}return undefined};this.getExpression=function(){var e=[];var t;for(var r=0;r<u.length;r++){t=u[r].getExpression();if(t instanceof Array&&t.length===0){continue}e.push(t)}return e};this.getId=function(){return s};this.getInternalFilter=function(){var t=new e(n);for(var r=0;r<u.length;r++){t.addOr(u[r].getInternalFilter())}return t};this.getAndObject=function(){return p};this.addOrTerm=function(e){r.error("Method 'addOr' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getOrTerms=function(){return u};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase()}n.check(e.id===undefined||this.getAndObject().getById(e.id)===undefined,"Filter includes duplicated identifiers (IDs)");n.check(e.operator!==undefined,"sap.apf.utils.Filter oExpression.operator undefined");n.check(jQuery.inArray(e.operator,t.aSelectOpt)>-1,"Filter oExpression.operator "+e.operator+" not supported");u.push(new a(n,e));return this};this.addAnd=function(e){n.check(e===undefined||this.getById(e)===undefined,"Filter includes duplicated identifiers (IDs)");var t=new i(n,e);u.push(t);return t}};var a=function(r,n){u(n.high,n.operator);var i=n.id;var s=n.name;var a=n.operator;var o=n.value;var d=n.high;this.getById=function(e){if(i===e){return this}return undefined};this.getExpression=function(){if(!a||a!==t.FilterOperators.BT){return{name:s,operator:a,value:o}}return{name:s,operator:a,value:o,high:d}};this.getInternalFilter=function(){return new e(r,s,a,o,d)};this.update=function(e){u(e.high,e.operator);s=e.name;a=e.operator;o=e.value;d=e.high};this.updateValue=function(e,t){o=e;if(t!==undefined){d=t}u(d,a)};function u(e,n){if(!n){return}if(n===t.FilterOperators.BT&&(e===null||e===undefined)){r.check(false,"sap.apf.utils.FilterExpression: High value needed for 'between' selection")}else if(n!==t.FilterOperators.BT&&(e!==null&&e!==undefined)){r.check(false,"sap.apf.utils.FilterExpression: High value only needed for 'between' selection")}}};sap.apf=sap.apf||{};sap.apf.utils=sap.apf.utils||{};sap.apf.utils.Filter=n;return n},true);
//# sourceMappingURL=filter.js.map
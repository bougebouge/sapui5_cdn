/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(["sap/ui/core/format/DateFormat","sap/apf/utils/hashtable","sap/base/util/UriParameters","sap/m/ViewSettingsDialog"],function(e,t,r,a){"use strict";function n(e){var t=parseInt(e,10);if(t<10){return"0"+t}return e}var i;var s=0;var o={renderHeaderOfTextPropertyFile:function(e,t){var r=e.toLowerCase();var a=/^[0-9a-f]+$/;var n=a.test(r);if(!n||e.length!==32){t.putMessage(t.createMessageObject({code:"5409",aParameters:[e]}));r="<please enter valid translation uuid, if you want to upload into a SAP translation system>"}else{r=r.substring(0,8)+"-"+r.substring(8,12)+"-"+r.substring(12,16)+"-"+r.substring(16,20)+"-"+r.substring(20)}return"#FIORI: insert Fiori-Id\n"+"# __ldi.translation.uuid="+r+"\n"+"#ApfApplicationId="+e+"\n\n"},getUriParameters:function(){var e=new r(window.location.href);return e.mParams},createPromise:function(e,t){var r=jQuery.Deferred();if(!t){r.resolve(e)}else{setTimeout(function(){r.resolve(e)},t)}return r.promise()},renderTextEntries:function(e,t){i=false;var r=e.getKeys();r.sort(function(t,r){var a=e.getItem(t);var n=e.getItem(r);if(a.LastChangeUTCDateTime<n.LastChangeUTCDateTime){return-1}if(a.LastChangeUTCDateTime>n.LastChangeUTCDateTime){return 1}return 0});var a=r.length;var n="";var s;for(s=0;s<a;s++){n=n+o.renderEntryOfTextPropertyFile(e.getItem(r[s]),t)}return n},renderEntryOfTextPropertyFile:function(t,r){var a,n;if(!i&&(!t.TextElementType||!t.MaximumLength)){i=true;r.putMessage(r.createMessageObject({code:"5408",aParameters:[t.TextElement]}))}var s="#"+(t.TextElementType||"<Add text type>")+","+(t.MaximumLength||"<Add maximum length>");if(t.TranslationHint&&t.TranslationHint!==""){s=s+":"+t.TranslationHint}s=s+"\n"+t.TextElement+"="+t.TextElementDescription+"\n";var o=e.getDateTimeInstance({pattern:"yyyy/MM/dd HH:mm:ss"});if(t.LastChangeUTCDateTime&&t.LastChangeUTCDateTime!==""){a=t.LastChangeUTCDateTime.replace(/\/Date\(/,"").replace(/\)\//,"");n=new Date(parseInt(a,10))}else{n=new Date}s=s+"# LastChangeDate="+o.format(n)+"\n\n";return s},eliminateDuplicatesInArray:function(e,t){e.check(t!==undefined&&typeof t==="object"&&t.hasOwnProperty("length")===true,"Error - aArray is undefined");var r=[];var a,n;for(a=0;a<t.length;a++){for(n=a+1;n<t.length;n++){if(t[a]===t[n]){n=++a}}r.push(t[a])}return r},hashCode:function(e){var t=0;var r;var a=0;e=e.toString();var n=e.length;for(r=0;r<n;r++){a=e.charCodeAt(r);t=17*t+a<<0}return Math.abs(t)},escapeOdata:function(e){if(typeof e==="string"){return e.replace("'","''")}return e},json2javascriptFormat:function(e,t){var r;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){return e}if(typeof e==="string"){return e.toLowerCase()==="true"}return false;case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.String":return e;case"Edm.Int16":case"Edm.Int32":return parseInt(e,10);case"Edm.Single":case"Edm.Float":return parseFloat(e);case"Edm.Time":return e;case"Edm.DateTime":r=e.replace("/Date(","").replace(")/","");r=parseFloat(r);return new Date(r);case"Edm.DateTimeOffset":r=e.replace("/Date(","");r=r.replace(")/","");r=parseFloat(r);return new Date(r);default:return e}},formatValue:function(t,r){function a(e){var t;var r=new RegExp("^[0-9]*$");if(e instanceof Date){return e}if(typeof e==="string"){if(e.substring(0,6)==="/Date("){t=e.replace("/Date(","");t=t.replace(")/","");t=parseInt(t,10);return new Date(t)}else if(e.length===8&&r.test(e)){return o.convertFiscalYearMonthDayToDate(e)}return new Date(e)}return undefined}var i;var s="";if(t===null||t===undefined){return"null"}var u=r.dataType.type;switch(u){case"Edm.String":if(r["sap-semantics"]==="yearmonthday"){if(typeof t==="object"&&t instanceof Date){var f=t.getUTCFullYear()+"";var c=n(t.getUTCMonth()+1+"");var m=n(t.getUTCDate()+"");t=f+c+m}}s="'"+String(t).replace(/'/g,"''")+"'";break;case"Edm.Time":if(typeof t==="number"){i=new Date;i.setTime(t);var l=i.getUTCHours();if(l<10){l="0"+l}var p=i.getUTCMinutes();if(p<10){p="0"+p}var d=i.getUTCSeconds();if(d<10){d="0"+d}s="time'"+l+":"+p+":"+d+"'"}else{s="time'"+t+"'"}break;case"Edm.DateTime":if(!o.formatValue.oDateTimeFormat){o.formatValue.oDateTimeFormat=e.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''"})}i=a(t);s=o.formatValue.oDateTimeFormat.format(i,true);break;case"Edm.DateTimeOffset":if(!o.formatValue.oDateTimeOffsetFormat){o.formatValue.oDateTimeOffsetFormat=e.getDateInstance({pattern:"'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''"})}i=a(t);s=o.formatValue.oDateTimeOffsetFormat.format(i,true);break;case"Edm.Guid":s="guid'"+t+"'";break;case"Edm.Decimal":s=t+"M";break;case"Edm.Int64":s=String(t)+"L";break;case"Edm.Single":s=t+"f";break;case"Edm.Binary":s="binary'"+t+"'";break;default:s=t;break}return s},extractFunctionFromModulePathString:function(e){if(jQuery.isFunction(e)){return e}var t,r,a;r=e.split(".");t=window;var n;for(n=0;n<r.length-1;n++){t=t[r[n]];if(!t){return undefined}}a=r[r.length-1];return t[a]},isValidGuid:function(e){return/^[0-9A-F]{32}$/.test(e)},isValidPseudoGuid:function(e){return/^[0-9A-F]{32}$/.test(e)},createPseudoGuid:function(e){if(!e&&e!==0){e=32}var t=Date.now().toString();var r=e-t.length;t+=o.createRandomNumberString(r);return t},createRandomNumberString:function(e){var t="";var r,a,n;while(t.length<e){r=Math.min(10,e-t.length);a=Math.pow(10,r);n=u((new Date).getTime());t+=Math.floor(n*a)}return t},migrateConfigToCategoryStepAssignment:function(e,t){var r=t.constructors&&t.constructors.Hashtable||r;var a=new r(t.instances.messageHandler);if(e.steps){e.steps.forEach(function(e){if(e.categories){e.categories.forEach(function(t){var r=a.getItem(t.id);if(!r){r={category:t.id,steps:[{type:"step",id:e.id}]};a.setItem(t.id,r)}else{r.steps.push({type:"step",id:e.id})}});delete e.categories}})}if(e.categories){e.categories.forEach(function(e){if(!e.steps){var t=a.getItem(e.id);if(t){e.steps=t.steps}else{e.steps=[]}}})}},getComponentNameFromManifest:function(e){var t;if(e["sap.ui5"]&&e["sap.ui5"].componentName){t=e["sap.ui5"].componentName}else{t=e["sap.app"].id}if(t.search("Component")>-1){return t}return t+".Component"},validateSelectedValues:function(e,t){var r={valid:[],invalid:[]};if(!e||!jQuery.isArray(e)||e.length===0){return r}if(!t||!jQuery.isArray(t)||t.length===0){r.invalid=e;return r}e.forEach(function(e){if(jQuery.inArray(e,t)===-1){r.invalid.push(e)}else{r.valid.push(e)}});return r},extractPathnameFromUrl:function(e){var t="a";var r;var a=document.createElement(t);a.href=e;if(a.pathname){r=a.pathname;if(r&&r[0]!=="/"){r="/"+r}return r}return e},extractOdataErrorResponse:function(e){var t;if(typeof e==="string"){t=JSON.parse(e)}else{t=e}var r=t&&t.error&&t.error.message&&t.error.message.value||t&&t.error&&t.error.message&&t.error.message||e;if(t&&t.error&&t.error.innererror&&t.error.innererror.errordetails){r=r+"\n";t.error.innererror.errordetails.forEach(function(e){r=r+e.message+"\n"})}else if(t&&t.error&&t.error.details){r=r+"\n";t.error.details.forEach(function(e){r=r+e.message+"\n"})}return r},checkAndCloseDialog:function(e){if(e!==undefined){if(e instanceof a){e.destroy()}else if(e.isOpen()){e.close()}}},convertFiscalYearMonthDayToDate:function(e){var t=parseInt(e.substr(0,4),10);var r=parseInt(e.substr(4,2),10);var a=parseInt(e.substr(6,2),10);return new Date(Date.UTC(t,r-1,a))},convertFiscalYearMonthDayToDateString:function(e){return o.convertFiscalYearMonthDayToDate(e).toUTCString()},convertDateListToInternalFormat:function(e,t){function r(e){var t=parseInt(e,10);if(t<10){return"200"+t}else if(t<100){return"20"+t}return e}if(!e||!e.length){return e}var a=[];e.forEach(function(e){var i,s,o,u,f;if(new RegExp("^[0-9]{1,2}\\.[0-9]{1,2}\\.[0-9]+$").test(e)){u=e.split(".");o=n(u[0]);s=n(u[1]);i=r(u[2])}else if(new RegExp("^[0-9]{1,2}/[0-9]{1,2}/[0-9]+$").test(e)){u=e.split("/");s=n(u[0]);o=n(u[1]);i=r(u[2])}else if(new RegExp("^[0-9]{4}-[0-9]{2}-[0-9]{2}").test(e)){i=e.slice(0,4);s=e.slice(5,7);o=e.slice(8,10)}if(i!==undefined&&s!==undefined&&o!==undefined){if(t.getAttribute("type")==="Edm.String"){a.push(i+s+o)}else{f=new Date(Date.UTC(parseInt(i,10),parseInt(s,10)-1,parseInt(o,10)));a.push(f)}}else{a.push(e)}});return a},convertToExternalFormat:function(t,r){var a=r.getAttribute("type");var n,i;var s;switch(a){case"Edm.DateTime":s=r.getAttribute("sap:display-format");if(s==="Date"&&t instanceof Date){n=e.getDateInstance({style:"short"});return n.format(t,true)}else if(s==="Date"&&typeof t==="string"){if(t.length===8){i=o.convertFiscalYearMonthDayToDate(t);n=e.getDateInstance({style:"short"});return n.format(i,true)}i=new Date(Date.parse(t));if(isNaN(i.getTime())){return t}n=e.getDateInstance({style:"short"});return n.format(i,true)}return t.toString();case"Edm.String":s=r.getAttribute("sap:semantics");if(s==="yearmonthday"){if(t.length===8){i=o.convertFiscalYearMonthDayToDate(t)}else{i=new Date(Date.parse(t))}if(isNaN(i.getTime())){return t}n=e.getDateInstance({style:"short"});return n.format(i,true)}return t;default:return t}},sortByProperty:function(e,t,r){if(e.length===0){return[]}var a=r?r.type:undefined;var n=e[0][t];var i;if(typeof n==="number"){return e.sort(function(e,r){return e[t]-r[t]})}else if(typeof n==="object"&&n instanceof Date){return e.sort(function(e,r){return e[t].getTime()-r[t].getTime()})}else if(typeof n==="string"){switch(a){case"Edm.DateTime":return e.sort(function(e,r){return Date.parse(e[t])-Date.parse(r[t])});case"Edm.String":i=r["sap:semantics"];if(i==="yearmonthday"&&n.length===8){return e.sort(function(e,r){return e[t].localeCompare(r[t])})}else if(i==="yearmonthday"){return e.sort(function(e,r){return Date.parse(e[t])-Date.parse(r[t])})}return e.sort(function(e,r){return e[t].localeCompare(r[t])});default:return e.sort(function(e,r){return e[t].localeCompare(r[t])})}}},isPropertyTypeWithDateSemantics:function(e){var t=e["type"];var r=e["sap:display-format"];return t==="Edm.DateTime"&&r==="Date"||t==="Edm.String"&&e["sap:semantics"]==="yearmonthday"}};function u(e){s++;var t,r,a;e=s.toString()+e.toString();t=o.hashCode(e);r=t.toString().length;a=t/Math.pow(10,r);return a}Object.keys(o).forEach(function(e){sap.apf.utils[e]=o[e]});return o},true);
//# sourceMappingURL=utils.js.map
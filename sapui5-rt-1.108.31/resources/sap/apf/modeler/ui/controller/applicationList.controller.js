/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/m/Input","sap/ui/core/Icon","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/ui/model/Filter"],function(e,t,i,a,n,o,r,p,l,s,d){"use strict";function c(e){var t=e.coreApi.getText;e.byId("idAppPage").setTitle(t("configModelerTitle"));e.byId("idAppTitle").setText(t("applicationOverview"));e.byId("idApplicationToolbar").setTooltip(t("applications"));e.byId("idAppNumberTitle").setText(t("applications"));e.byId("idAppNumberTitle").setTooltip(t("applications"));e.byId("idDescriptionLabel").setText(t("description"));if(e.coreApi.showSemanticObject()){e.byId("idSemanticObjectLabel").setText(t("semanticObject"))}e.byId("idImportButton").setText(t("import"));e.byId("idImportButton").setTooltip(t("importConfig"));e.byId("idNewButton").setText(t("new"));e.byId("idNewButton").setTooltip(t("newApplication"));e.byId("idEditIcon").setTooltip(t("editApplication"));e.byId("idDeleteIcon").setTooltip(t("deleteApplication"));e.byId("idTextpoolCleanupIcon").setTooltip(t("textCleanUp"));e.byId("idAriaPropertyForDelete").setText(t("ariaTextForDeleteIcon"));e.byId("idAriaPropertyForEdit").setText(t("ariaTextForEditIcon"));e.byId("idAriaPropertyForTextpoolCleanup").setText(t("ariaTextForTextpoolCleanupIcon"))}function u(e){var t=e.coreApi.getText;sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").setTitle(t("confirmation"));sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteButton").setText(t("deleteButton"));sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idCancelButtonDialog").setText(t("cancel"))}function m(e){var t=e.applicationHandler.getList();e.byId("idAppCount").setText("("+t.length+")");var i=[];t.forEach(function(e){var t={};t.id=e.Application;t.description=e.ApplicationName;t.semanticObject=e.SemanticObject;i.push(t)});var a=s.prepareModel(i,i.length);e.byId("idApplicationTable").setModel(a);if(e.actualQuery!==""){e.filterValues(e.actualQuery)}}function f(e,t){var i=e.coreApi.createMessageObject({code:t});e.coreApi.putMessage(i)}function g(e){e.byId("idApplicationTable").attachEvent("addNewAppEvent",e.handleAdditionOfNewApp.bind(e));e.byId("idApplicationTable").attachEvent("updateAppListEvent",e.handleAppListUpdate.bind(e))}function h(e,t){var i,a;i={oParentControl:e.byId("idApplicationTable"),oCoreApi:e.coreApi};a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+t,type:sap.ui.core.mvc.ViewType.XML,viewData:i});e.getView().addDependent(a)}function b(e,t,i,a){e.getView().addDependent(t);var o=new n({text:e.coreApi.getText(i)});t.removeAllContent();t.addContent(o);t.addAriaDescribedBy(o);if(a){t.removeAllCustomData();t.addCustomData(a)}t.open()}function v(e){var t=e.byId("idAppListScrollContainer");var i=e.byId("idApplicationTable");var a=e.getView();i.addEventDelegate({onAfterRendering:function(){var i=jQuery(window).height();var n=jQuery(a.byId("idAppTitle").getDomRef()).height();var o=jQuery(a.byId("idApplicationToolbar").getDomRef()).height();var r=jQuery(a.byId("idAppPage").getDomRef()).find("header").height();var l=jQuery(a.byId("idAppPage").getDomRef()).find("footer").height();var s;if(n>0){n=n+80;s=n+o+r+l+25}else{s=232}t.setHeight(i-s+"px");t.setWidth("100%");p.onResize(function(){if(jQuery(a.getDomRef()).css("display")==="block"){i=jQuery(a.byId("idAppPage").getDomRef()).height();t.setHeight(i-s+"px");t.setWidth("100%")}});sap.ui.core.UIComponent.getRouterFor(e).attachRoutePatternMatched(function(e){if(e.getParameter("name")==="applicationList"){i=jQuery(a.getDomRef()).height();t.setHeight(i-s+"px");t.setWidth("100%")}})}})}function y(e,t){var i=new sap.m.StandardListItem({title:e.coreApi.getText("importDeliveredContent"),type:sap.m.ListType.Active,press:function(){h(e,"importDeliveredContent")}});var a=new sap.m.StandardListItem({title:e.coreApi.getText("importFiles"),type:sap.m.ListType.Active,press:function(){h(e,"importFiles")}});var n=new sap.m.Popover({placement:sap.m.PlacementType.Top,showHeader:false});var o=new sap.m.List({items:[i,a]});n.addContent(o);n.openBy(t.getSource())}return e.extend("sap.apf.modeler.ui.controller.applicationList",{onInit:function(){var e=this;this.actualQuery="";var t=e.getOwnerComponent();if(l.checkIsNotUndefined(t)){e.coreApi=t.oCoreApi;if(!this.coreApi.showSemanticObject()){this.hideSemanticObjectColumn()}g(this);c(e);e.coreApi.getApplicationHandler(function(t,i){e.applicationHandler=t;if(e.applicationHandler&&!l.checkIsNotUndefined(i)){m(e)}else{e.showMessage("11508",i)}})}v(e)},showMessage:function(e,t){var i=this.coreApi.createMessageObject({code:e});if(t){i.setPrevious(t)}this.coreApi.putMessage(i)},hideSemanticObjectColumn:function(){this.byId("idSemanticObjectColumn").setVisible(false)},handleAddNewAppPress:function(){var e=this;if(l.checkIsNotNullOrUndefinedOrBlank(e.applicationHandler)){h(e,"newApplication")}else{e.showMessage("11509")}},handleListItemPress:function(e){var t=this,i;i=e.getParameter("listItem").getBindingContext().getPath().split("/")[2];sap.ui.core.UIComponent.getRouterFor(t).navTo("configurationList",{appId:t.byId("idApplicationTable").getModel().getData().Objects[i].id})},handleTextpoolCleanupPress:function(e){var t;var i=e.getSource().getBindingContext().getObject().id;var a=new sap.ui.core.CustomData({value:{applicationId:i}});var n=this.coreApi.getText;t=sap.ui.xmlfragment("idTextpoolCleanupConfirmationFragment","sap.apf.modeler.ui.fragment.textpoolCleanupConfirmationDialog",this);t.setTitle(n("confirmation"));t.getButtons()[0].setText(n("ok"));t.getButtons()[1].setText(n("cancel"));b(this,t,"textpoolCleanupConfirmation",a)},handleConfirmTextpoolCleanup:function(e){var t=this;var i=sap.ui.core.Fragment.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").getCustomData()[0].getValue().applicationId;t.coreApi.getConfigurationHandler(i,function(e){var a=e.getTextPool();t.coreApi.getUnusedTextKeys(i,function(e,n){if(!l.checkIsNotUndefined(n)){a.removeTexts(e,i,function(e){if(!l.checkIsNotUndefined(e)){t.showMessage("11511")}else{t.showMessage("11507",e)}t.closeTextpoolCleanupConfirmationDialog()})}else{t.showMessage("11506",n);t.closeTextpoolCleanupConfirmationDialog()}})})},closeTextpoolCleanupConfirmationDialog:function(){sap.ui.core.Fragment.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").destroy()},handleCancelTextpoolCleanup:function(e){this.closeTextpoolCleanupConfirmationDialog()},handleEditPress:function(e){var t,i;if(l.checkIsNotNullOrUndefinedOrBlank(this.applicationHandler)){t=e.getSource().getBindingContext().getObject();i={parentControl:this.byId("idApplicationTable"),coreApi:this.coreApi,applicationData:t};sap.ui.view({viewName:"sap.apf.modeler.ui.view.editApplication",type:sap.ui.core.mvc.ViewType.XML,viewData:i,async:true}).loaded().then(function(e){this.getView().addDependent(e)}.bind(this))}},handleDeletePress:function(e){var t=this,i;var a=e.getSource().getBindingContext().getPath().split("/")[2];var n=new sap.ui.core.CustomData({value:{removeId:this.byId("idApplicationTable").getModel().getData().Objects[a].id,sPath:a}});i=sap.ui.xmlfragment("idDeleteConfirmationFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",t);u(t);b(t,i,"deleteApp",n)},handleConfirmDeletion:function(){var e=this;var t=sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").getCustomData()[0].getValue().removeId;if(l.checkIsNotUndefined(t)){e.applicationHandler.removeApplication(t,function(t,i,a){if(!l.checkIsNotUndefined(a)&&typeof t==="string"){m(e);f(e,"11510")}else{e.showMessage("11501",a)}e.closeDialog()})}},closeDialog:function(){sap.ui.core.Fragment.byId("idDeleteConfirmationFragment","idDeleteConfirmation").destroy()},handleNavigationWithSave:function(){var e=this;e.handleSavePress();sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleNavigationWithoutSave:function(){sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handlePreventNavigation:function(){sap.ui.core.Fragment.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleImportPress:function(e){if(this.coreApi.isVendorContentAvailable()){y(this,e)}else{h(this,"importFiles")}},handleSavePress:function(){var e=this,t=[],i,a,n;i=e.applicationHandler.getList();a=e.byId("idApplicationTable").getModel().getData().Objects;for(n=0;n<i.length;n++){if(a[n].description!==i[n].ApplicationName||a[n].semanticObject!==i[n].SemanticObject){t.push(a[n])}}t.forEach(function(t){var i={ApplicationName:t.description,SemanticObject:t.semanticObject};e.applicationHandler.setAndSave(i,function(t,i,a){if(l.checkIsNotUndefined(a)){e.showMessage("11500",a)}},t.id)})},handleNavigationToConfigurationList:function(e){var t=this;var i={listItem:sap.ui.getCore().byId(e.currentTarget.id).getParent(),srcControl:t.byId("idApplicationTable")};t.byId("idApplicationTable").fireItemPress(i)},handleAdditionOfNewApp:function(e){var t=this,i,a,n,o=0,r;i=e.getParameter("appId");m(t);a=t.byId("idApplicationTable").getModel().getData().Objects;f(t,"11512");t.byId("idApplicationTable").rerender();for(n=0;n<a.length;n++){if(a[n].id===i){o=n;break}}r=t.byId("idApplicationTable").getItems();if(r.length){var p=r[o].getDomRef();if(p){p.scrollIntoView()}}if(this.actualQuery!==""){this.filterValues(this.actualQuery)}},handleAppListUpdate:function(){var e=this;m(e)},handleNavBack:function(){window.history.go(-1)},onSearch:function(e){var t=e.getParameters().newValue;this.actualQuery=t;this.filterValues(t)},filterValues:function(e){var t=[];if(e&&e.length>0){var i=new d("description",sap.ui.model.FilterOperator.Contains,e);t.push(i)}var a=this.byId("idApplicationTable");var n=a.getBinding("items");n.filter(t,"Objects")}})});
//# sourceMappingURL=applicationList.controller.js.map
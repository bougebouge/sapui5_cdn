/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/propertyTypeFactory","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/propertyTypeState","sap/apf/modeler/ui/utils/propertyTypeOrchestration"],function(e,t,r,o,a){"use strict";function n(t,r){r.attachEvent(e.events.ADDPROPERTY,t.handlePressOfAdd.bind(t));r.attachEvent(e.events.REMOVEPROPERTY,t.handlePressOfRemove.bind(t));r.attachEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT,r.getController().setNextPropertyInParentObject.bind(r.getController()));t.getView().attachEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT,r.getController().setNextPropertyInParentObject.bind(r.getController()));r.attachEvent(e.events.REMOVECURRENTPROPERTYFROMPARENTOBJECT,r.getController().removePropertyFromParentObject.bind(r.getController()));r.attachEvent(e.events.REMOVEPROPERTYFROMPARENTOBJECT,r.getController().removePropertyFromParentObject.bind(r.getController()));r.attachEvent(e.events.UPDATEPROPERTYVALUESTATE,t.updatePropertyValueState.bind(t));r.attachEvent(e.events.FOCUSONREMOVE,t.handleFocusOnRemove.bind(t));r.attachEvent(e.events.SETFOCUSONREMOVEICON,r.getController().setFocusOnAddRemoveIcons.bind(r.getController()))}function p(e,t){var r=[];var o=e.getView().getViewData().aPropertiesToBeCreated;o.forEach(function(o){var a=i(e,o,e.nCounter,t);r.push(a.getController().initPromise)});e.initPromise=jQuery.when.apply(jQuery,r)}function i(e,r,o,a){var p=jQuery.extend(true,{},e.getView().getViewData().oViewDataForPropertyType);p.oPropertyTypeState=e.oPropertyTypeState;p.oPropertyTypeData=r;p.oPropertyOrchestration=a;p.oPropertyTypeHandlerBackLink=e;var i=e.createId("id"+p.sPropertyType+"View"+e.nCounter);e.oPropertyTypeState.addPropertyAt(r.sProperty,o);e.oPropertyTypeState.addPropertyTypeViewIdAt(i,o);var y=t.createPropertyTypeView(p,i);if(a){a.addPropertyTypeReference(i,r,p.sPropertyType,y)}n(e,y);e.byId("idPropertyTypeVBox").insertItem(y,o);e.nCounter++;return y}var y=sap.ui.controller("sap.apf.modeler.ui.controller.propertyTypeHandler",{_apfName:"propertyTypeHandler",nCounter:0,oPropertyTypeState:{},initPromise:undefined,oPropertyOrchestration:undefined,onInit:function(){var e=this;e.oPropertyOrchestration=e.getView().getViewData().oPropertyOrchestration;e.oPropertyTypeState=new o;p(e,e.oPropertyOrchestration);if(e.oPropertyOrchestration){e.oPropertyOrchestration.updateAllSelectControlsForPropertyType()}},handlePressOfAdd:function(t){var o=this,n={},p;var y=t.getParameter("oSourceView");var P=o.getView().getViewData().oPropertyOrchestration;var s=P.getPropertyTypeRow(y.getId()).sPropertyType;var d=a._mapPropertyType2AggregationRole(s);var T=o.byId("idPropertyTypeVBox").indexOfItem(y)+1;var l=o.getView().getViewData().oViewDataForPropertyType.oParentObject.getId();var v=o.getView().getViewData().oViewDataForPropertyType.oStepPropertyMetadataHandler;var c=v.oStep;var E=c.getType()==="hierarchicalStep";if(E&&s===e.propertyTypes.REPRESENTATIONSORT){d=e.aggregationRoles.MEASURE}a.getConsumableAndAvailablePropertiesAsPromise(l,d,v).then(function(e){var t=a._relativeComplement(e.available,P.getSelectedProperties());var s=t[0];n.sProperty=s;n.sContext=P.getPropertyTypeRow(y.getId()).propertyRowInformation.sContext;if(r.checkIsNotUndefined(n.sProperty)){p=i(o,n,T,P);p.getController().setNextPropertyInParentObject()}return P.updateAllSelectControlsForPropertyType()})},handleFocusOnRemove:function(t){var r=this;var o=r.byId("idPropertyTypeVBox");var a=t.getSource();var n=o.indexOfItem(a);var p=r.byId(r.oPropertyTypeState.aPropertyTypeViewIds[n-1]);p.fireEvent(e.events.SETFOCUSONREMOVEICON)},handlePressOfRemove:function(e){var t=this;var r=e.oSourceView||e.getSource();var o=t.byId("idPropertyTypeVBox");var a=o.indexOfItem(r);t.oPropertyTypeState.removePropertyAt(a);t.oPropertyTypeState.removePropertyTypeViewIdAt(a);o.removeItem(r)},updatePropertyValueState:function(e){var t=this;var r=e.getSource();var o=e.getParameter("sProperty");var a=t.byId("idPropertyTypeVBox").indexOfItem(r);t.oPropertyTypeState.updatePropertyAt(o,a)},handleRemoveOfProperty:function(){var t=this;var o=t.byId("idPropertyTypeVBox");if(r.checkIsNotUndefined(o)){o.getItems().forEach(function(t){t.fireEvent(e.events.REMOVEPROPERTYFROMPARENTOBJECT)})}},handleSettingTopNProperties:function(){var t=this;t.getView().fireEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT)}});return y},true);
//# sourceMappingURL=propertyTypeHandler.controller.js.map
sap.ui.define(["sap/apf/modeler/ui/controller/requestOptions","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/textPoolHelper","sap/ui/thirdparty/jquery"],function(e,t,i,r,jQuery){"use strict";var a=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var o=sap.apf.modeler.ui.utils.nullObjectChecker;var l=sap.apf.modeler.ui.utils.TranslationFormatMap.STEPFILTERPROPERTY_LABEL;function n(e){var t=e.getView().getViewData().oTextReader;var i=e.oParentObject.getFilterPropertyLabelKey()?t("label"):t("label")+" ("+t("default")+")";e.byId("idOptionalSelectedPropertyLabel").setText(i);e.byId("idOptionalSelectedPropertyLabel").setTooltip(i)}function s(e){var t=jQuery.Deferred();var i;var r=e.oParentObject.getFilterPropertyLabelKey();if(!e.getSource()||!e.getEntity()){return t.resolve()}if(o.checkIsNotUndefined(r)){i=e.getView().getViewData().oConfigurationHandler.getTextPool().get(r).TextElementDescription;e.byId("idOptionalSelectedPropertyLabelText").setValue(i);return t.resolve()}e.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(r){var a=e.oParentObject.getFilterProperties()[0];if(e.oParentObject.getType()==="hierarchicalStep"&&a){a=e.oStepPropertyMetadataHandler.getPropertyMetadata(r,a)["hierarchy-node-for"]}if(a){i=e.oStepPropertyMetadataHandler.getDefaultLabel(r,a)}e.byId("idOptionalSelectedPropertyLabelText").setValue(i);t.resolve()});return t}function d(e){e.byId("idOptionalRequestFieldLabel").addStyleClass("filterPropertyLable");e.byId("idOptionalRequestField").addStyleClass("filterProperty");e.byId("idOptionalLabelDisplayOptionType").addStyleClass("filterProperty")}return e.extend("sap.apf.modeler.ui.controller.stepRequest",{setLabelDisplayOptionTypeAsPromise:function(e){var i=jQuery.Deferred();var r,a,o,l,d,p=this,u=[];var c=p.getView().getViewData().oTextReader;r=new sap.apf.modeler.ui.utils.DisplayOptionsValueBuilder(c,e);o=r.getLabelDisplayOptions();a=sap.apf.core.constants.representationMetadata.labelDisplayOptions;l=t.removePrefixText(p.byId("idOptionalRequestField").getSelectedKey(),c(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));n(p);s(p).done(function(){p.byId("idOptionalLabelDisplayOptionType").setEnabled(true);if(l===c("none")){p.byId("idOptionalLabelDisplayOptionType").setModel(o);p.byId("idOptionalLabelDisplayOptionType").setEnabled(false);return i.promise()}d=p.oParentObject.getFilterPropertyLabelDisplayOption();p.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){if((d===a.KEY_AND_TEXT||d===a.TEXT)&&!p.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,l)){o=r.getValidatedLabelDisplayOptions();u=t.addPrefixText([d],c);d=u[0]}p.byId("idOptionalLabelDisplayOptionType").setModel(o);p.byId("idOptionalLabelDisplayOptionType").setSelectedKey(d);i.resolve()})});return i.promise()},enableDisableLabelDisplayOptionTypeAsPromise:function(){var e,i=this;var r=jQuery.Deferred();var a=i.getView().getViewData().oTextReader;var o=i.byId("idOptionalLabelDisplayOptionType");var l=t.removePrefixText(i.byId("idOptionalRequestField").getSelectedKey(),a(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));i.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(t){var a=i.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(t,l);for(e=0;e<o.getItems().length;e++){o.getItems()[e].setEnabled(true);if(e>0&&!a){o.getItems()[e].setEnabled(false)}}r.resolve()});return r.promise()},onBeforeRendering:function(){var e=this;e.byId("idOptionalRequestFieldLabel").setVisible(true);e.byId("idOptionalRequestField").setVisible(true);e.byId("idOptionalLabelDisplayOptionType").setVisible(true);e.byId("idOptionalSelectedPropertyLabel").setVisible(true);e.byId("idOptionalSelectedPropertyLabelText").setVisible(true)},onAfterRendering:function(){var e=this;e.addOrRemoveMandatoryFieldsAndRequiredFlag(true);d(e)},setDisplayText:function(){var e=this;var t=e.getView().getViewData().oTextReader;e.byId("idSourceLabel").setText(t("source"));e.byId("idEntityLabel").setText(t("entity"));e.byId("idSelectPropertiesLabel").setText(t("selectProperties"));e.byId("idOptionalRequestFieldLabel").setText(t("requiredFilters"))},setOptionalRequestFieldProperty:function(){var e=this;var t,i,r,l,n,s=[];var d=e.oParentObject.getFilterProperties();n=[e.getView().getViewData().oTextReader("none")];t=e.byId("idSelectProperties").getSelectedKeys();i=e.oParentObject.getSelectProperties();i.forEach(function(e){if(e===d[0]){r=true}});if(!r&&d.length>0){e.removeOptionalRequestFieldProperty(d);d=e.oParentObject.getFilterProperties()}l=a.convert(n.concat(t));e.byId("idOptionalRequestField").setModel(l);e.byId("idOptionalRequestField").setSelectedKey(n[0]);if(o.checkIsNotNullOrUndefinedOrBlank(d)){s=e.validateSelectedValues(e,d,t);d=s.aSelectedValues;e.byId("idOptionalRequestField").setSelectedKey(d[0])}},addOrRemoveMandatoryFieldsAndRequiredFlag:function(e){var t=this;if(e===false){return}t.byId("idSourceLabel").setRequired(e);t.byId("idEntityLabel").setRequired(e);t.byId("idSelectPropertiesLabel").setRequired(e);t.viewValidator.addFields(["idSource","idEntity","idSelectProperties"])},fireRelevantEvents:function(e){var i=this,r,a;if(e.getSource()!==i.byId("idOptionalRequestField")){r=[t.removePrefixText(i.byId("idOptionalRequestField").getSelectedKey(),i.getView().getViewData().oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE))];if(o.checkIsNotNullOrUndefinedOrBlank(r)){i.updateOptionalRequestFieldProperty(r)}if(i.getSelectProperties().length===0){i.oParentObject.resetTopN()}i.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETDATAREDUCTIONSECTION)}if(e.getSource()===i.byId("idOptionalProperty")){i.setOptionalRequestFieldProperty()}a=i.byId("idOptionalRequestField").getSelectedKey()!==i.getView().getViewData().oTextReader("none")?true:false;i.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.SETVISIBILITYOFFILTERMAPPINGFIELDS,{bShowFilterMappingLayout:a});i.getView().fireEvent(sap.apf.modeler.ui.utils.CONSTANTS.events.step.UPDATEFILTERMAPPINGFIELDS)},getSource:function(){return this.oParentObject.getService()},getAllEntitiesAsPromise:function(e){return this.oConfigurationEditor.getAllEntitySetsOfServiceAsPromise(e)},getEntity:function(){return this.oParentObject.getEntitySet()},getAllEntitySetPropertiesAsPromise:function(e,t){return this.oConfigurationEditor.getAllPropertiesOfEntitySetAsPromise(e,t)},changeLabelDisplayOption:function(e){var t=this;t.oParentObject.setFilterPropertyLabelDisplayOption(e)},changeOptionalSelectedPropertyLabelText:function(e){var t=this;if(e.trim().length===0){t.oParentObject.setFilterPropertyLabelKey(undefined);n(t);s(t);return}t.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(e,l).done(function(e){t.oParentObject.setFilterPropertyLabelKey(e);n(t);s(t)})},resetEntityAndProperties:function(){var e=this;e.clearEntity();e.byId("idEntity").setModel(null);e.byId("idEntity").setSelectedKey(undefined);e.clearSelectProperties();e.byId("idSelectProperties").setModel(null);e.byId("idSelectProperties").setSelectedKeys([]);e.byId("idOptionalRequestField").setModel(null);e.byId("idOptionalRequestField").setSelectedKey(undefined)},clearSource:function(){var e=this;e.oParentObject.setService(undefined);e.clearEntity()},clearEntity:function(){var e=this;e.oParentObject.setEntitySet(undefined);e.clearSelectProperties()},clearSelectProperties:function(){var e=this;var t=e.oParentObject.getSelectProperties();t.forEach(function(t){e.oParentObject.removeSelectProperty(t)});e.clearOptionalRequestFieldProperty()},clearOptionalRequestFieldProperty:function(){var e=this;var t=e.oParentObject.getFilterProperties();t.forEach(function(t){e.oParentObject.removeFilterProperty(t)})},removeSelectProperties:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeSelectProperty(e)})},removeOptionalRequestFieldProperty:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeFilterProperty(e)})},updateSource:function(e){var t=this;t.oParentObject.setService(e)},updateEntity:function(e){var t=this;t.oParentObject.setEntitySet(e)},updateSelectProperties:function(e){var t=this;t.removeSelectProperties(t.oParentObject.getSelectProperties());e.forEach(function(e){t.oParentObject.addSelectProperty(e)})},updateOptionalRequestFieldProperty:function(e){var t=this;var i=t.oParentObject.getFilterPropertyLabelKey();var r=t.oParentObject.getFilterPropertyLabelDisplayOption();var a=t.oParentObject.getFilterProperties();t.removeOptionalRequestFieldProperty(t.oParentObject.getFilterProperties());e.forEach(function(e){if(e!==t.getView().getViewData().oTextReader("none")){t.oParentObject.addFilterProperty(e);if(e===a[0]){t.oParentObject.setFilterPropertyLabelKey(i);t.oParentObject.setFilterPropertyLabelDisplayOption(r)}}})},getSelectProperties:function(){var e=this;return e.oParentObject.getSelectProperties()},getOptionalRequestFieldProperty:function(){var e=this;return e.oParentObject.getFilterProperties()},getValidationState:function(){var e=this;return e.viewValidator.getValidationState()}})});
//# sourceMappingURL=stepRequest.controller.js.map
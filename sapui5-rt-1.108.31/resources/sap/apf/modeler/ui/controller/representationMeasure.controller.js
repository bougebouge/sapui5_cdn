/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/controller/propertyType","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/textManipulator","sap/apf/core/constants"],function(e,t,a,r){"use strict";t=t||sap.apf.modeler.ui.utils.DisplayOptionsValueBuilder;var o=sap.apf.modeler.ui.utils.textManipulator;e.extend("sap.apf.modeler.ui.controller.representationMeasure",{setLabelDisplayOptionTypeAsPromise:function(e){var a=this;var o=a.getView().getViewData().oPropertyTypeData.sProperty;if(!a.oRepresentationTypeHandler.isCombinationChart(a.oRepresentation.getRepresentationType())){if(a.byId("idLabelDisplayOptionType")){a.byId("idLabelDisplayOptionType").destroy();a.byId("idPropertyTypeLayout").setSpan("L4 M4 S4");a.oRepresentation.setMeasureDisplayOption(o,undefined)}}else{var i=new t(a.oTextReader,e);var n=i.getMeasureDisplayOptions();a.byId("idLabelDisplayOptionType").setModel(n);var s=a.oRepresentation.getMeasureDisplayOption(o);if(!s){var p=a.getView().getViewData().oPropertyTypeData.bMandatory?r.representationMetadata.measureDisplayOptions.BAR:r.representationMetadata.measureDisplayOptions.LINE;a.byId("idLabelDisplayOptionType").setSelectedKey(p);a.oRepresentation.setMeasureDisplayOption(o,p)}else{a.byId("idLabelDisplayOptionType").setSelectedKey(s)}}return jQuery.Deferred().resolve()},changeLabelDisplayOption:function(e){var t=this;var a=t.getView().getViewData().oPropertyTypeData.sProperty;t.oRepresentation.setMeasureDisplayOption(a,e)},getAllPropertiesAsPromise:function(){var e=this,t,a,r,i,n=[];var s=e.oStepPropertyMetadataHandler.oStep;var p=sap.apf.modeler.ui.utils.CONSTANTS;var d=jQuery.Deferred();e.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(y){s.getConsumablePropertiesForRepresentation(e.oRepresentation.getId()).done(function(s){t=s.consumable;t.forEach(function(t){if(e.oStepPropertyMetadataHandler.getPropertyMetadata(y,t)){i=e.oStepPropertyMetadataHandler.getPropertyMetadata(y,t)["aggregation-role"];if(i===p.aggregationRoles.MEASURE){n.push(t)}}});a=e.getSelectedProperty();if(a!==undefined){r=n.indexOf(a)!==-1?n:n.concat(a);n=s.available.indexOf(a)!==-1?r:n.concat(o.addPrefixText([a],e.oTextReader));a=s.available.indexOf(a)!==-1?a:o.addPrefixText([a],e.oTextReader)[0]}d.resolve({aAllProperties:n,sSelectedKey:a})})});return d.promise()},getPropertyTextLabelKey:function(e){var t=this;return t.oRepresentation.getMeasureTextLabelKey(e)},updatePropertiesInConfiguration:function(e){var t=this;t.oRepresentation.getMeasures().forEach(function(e){t.oRepresentation.removeMeasure(e)});e.forEach(function(e){t.oRepresentation.addMeasure(e.sProperty);t.oRepresentation.setMeasureKind(e.sProperty,e.sKind);t.oRepresentation.setMeasureTextLabelKey(e.sProperty,e.sTextLabelKey);t.oRepresentation.setMeasureDisplayOption(e.sProperty,e.sMeasureDisplayOption)})},createNewPropertyInfoAsPromise:function(e){var t=this,a={};a.sProperty=e;a.sKind=t.getView().getViewData().oPropertyTypeData.sContext;a.sTextLabelKey=undefined;return sap.apf.utils.createPromise(a)},setPropertyTextLabelKey:function(e,t){var a=this;a.oRepresentation.setMeasureTextLabelKey(e,t)},setNextPropertyInParentObject:function(){var e=this;e.updateOfConfigurationObjectAsPromise().then(function(){e.setDetailData()})},removePropertyFromParentObject:function(){var e=this;e.oRepresentation.removeMeasure(o.removePrefixText(e.byId("idPropertyType").getSelectedKey(),e.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE)))},addPropertyAsPromise:function(){var e=jQuery.Deferred();var t=this,a,r=[];var o=t.oStepPropertyMetadataHandler.oStep;var i=sap.apf.modeler.ui.utils.CONSTANTS;t.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(n){o.getConsumablePropertiesForRepresentation(t.oRepresentation.getId()).done(function(o){o.consumable.forEach(function(e){if(t.oStepPropertyMetadataHandler.getPropertyMetadata(n,e)){a=t.oStepPropertyMetadataHandler.getPropertyMetadata(n,e)["aggregation-role"];if(a===i.aggregationRoles.MEASURE){r.push(e)}}});t.getView().fireEvent(i.events.ADDPROPERTY,{sProperty:r[0],sContext:t.getView().getViewData().oPropertyTypeData.sContext});t.oConfigurationEditor.setIsUnsaved();e.resolve()})});return e.promise()}})});
//# sourceMappingURL=representationMeasure.controller.js.map
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/core/mvc/Controller","sap/apf/modeler/ui/utils/constants","sap/ui/core/syncStyleClass"],function(e,t,i){"use strict";return e.extend("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText()},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"))},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true)}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true)}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false)}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false)}},_setAddMenuText:function(){sap.ui.core.Fragment.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));sap.ui.core.Fragment.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"))},_setExistingStepDialogText:function(){sap.ui.core.Fragment.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"))},_enableDisableAddMenuItems:function(e,i){var n;var o=i.getItems();var a,s={};if(this.oConfigListInstance.configEditor){n=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0]}if(this.oConfigListInstance.configurationHandler.getList().length===0||e===null){a="default"}else{a=e.nodeObjectType}s["default"]=1;s[t.configurationObjectTypes.CONFIGURATION]=4;s[t.configurationObjectTypes.FACETFILTER]=4;s[t.configurationObjectTypes.SMARTFILTERBAR]=4;s[t.configurationObjectTypes.CATEGORY]=5;s[t.configurationObjectTypes.STEP]=6;s[t.configurationObjectTypes.REPRESENTATION]=6;s[t.configurationObjectTypes.NAVIGATIONTARGET]=4;o.forEach(function(e,i){if(i<s[a]){e.setEnabled(true);if(n!==t.configurationObjectTypes.FACETFILTER&&i===1){e.setEnabled(false)}}else{e.setEnabled(false)}})},_handlePressAddButton:function(e){var t;var i=this,n=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){t=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}e.getSource().$().blur();var o=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(t!==undefined){n=typeof t.getValidationState==="function"?t.getValidationState.call(t):true}var a=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=a?a.isSaved():undefined;var s=false;var r=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var g=e.getSource();var d=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText()}var e=sap.ui.core.Popup.Dock;this._enableDisableAddMenuItems(r,this.addMenu);this.addMenu.open(false,g,e.BeginTop,e.BeginBottom,g)};if(!n){o.throwMandatoryPopup(i.oConfigListInstance,{yes:function(){var e=i.oConfigListInstance.oTreeInstance.getParentNodeContext(r);i.oConfigListInstance.configEditor=i.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(e.configId);if(i.oConfigListInstance.bIsSaved===false&&i.oConfigListInstance.configEditor){i.oConfigListInstance.configEditor.setIsUnsaved()}var t=i.oConfigListInstance._navMandatoryResetState(i.oConfigListInstance);if(!t.isNewView){d.call(i)}}});s=true}if(!s){d.call(i)}},_handleAddMenuItemPress:function(e){var i=this.addMenu.getItems();var n=e.getParameters("item");var o;var a={"idAddMenuFragment--idNewFacetFilter":t.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":t.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":t.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":t.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":t.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":t.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":t.configurationObjectTypes.NAVIGATIONTARGET,default:t.configurationObjectTypes.CONFIGURATION};i.forEach(function(e){if(e.getId()===n.id){o=a[e.getId()]}else if(e.getSubmenu()){e.getSubmenu().getItems().forEach(function(e){if(e.getId()===n.id){o=a[e.getId()]}})}});var s=false;if(n.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress()}else if(n.id!=="idAddMenuFragment--idStep"&&o!==undefined){if(n.id==="idAddMenuFragment--idHierarchicalStep"){s=true}this.oConfigListInstance.oTreeInstance.addNodeInTree(o,undefined,s)}},_copyConfiguration:function(e,i){var n=this.oConfigListInstance.configurationHandler.getConfiguration(e);var o={},a;o.AnalyticalConfiguration=n.AnalyticalConfiguration;o.name="< "+n.AnalyticalConfigurationName+" >";o.Application=n.Application;o.type=t.configurationObjectTypes.CONFIGURATION;o.bIsLoaded=false;o.bToggleState=false;o.isSelected=true;o.expanded=true;o.selectable=true;o.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(o);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(i);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getItemNodeByContextWithoutExpand(a.sPath);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred;var s={appId:this.oConfigListInstance.appId,configId:e};sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(o.type,s,true)},_handlePressCopyButton:function(e){var i=jQuery.Deferred();var n,o;var a=this,s=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){n=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}e.getSource().$().blur();var r=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(n!==undefined){s=typeof n.getValidationState==="function"?n.getValidationState.call(n):true}var g=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=g?g.isSaved():undefined;var d=false;var f=function(){var e=this;var n;var s=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelectedItem()||this.selectedNode;var r,g,d,f,c,l,p,I,C,u;d=s.nodeContext;switch(s.nodeObjectType){case t.configurationObjectTypes.FACETFILTER:var h=this.oCoreApi.getText("copyOf")+"  "+s.nodeTitle;var T=this.configEditor.copyFacetFilter(s.nodeAPFId);var v=this.configEditor.getFacetFilter(T);var D=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(h,D).done(function(e){v.setLabelKey(e);c=d.split("/");o=c[2];l=c[6];var t=this.oModel.getData().aConfigDetails[o].configData[0].filters[l];t.isSelected=false;var i=jQuery.extend(true,{},t);i.id=T;i.name="< "+h+" >";i.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[0].filters.length;this.oModel.getData().aConfigDetails[o].configData[0].filters.push(i);c[6]=f;g=c.join("/");K()}.bind(this));break;case t.configurationObjectTypes.CATEGORY:var m=this.oCoreApi.getText("copyOf")+"  "+s.nodeTitle;var y=this.configEditor.copyCategory(s.nodeAPFId);var L=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(m,L).done(function(t){var i={labelKey:t};this.configEditor.setCategory(i,y);c=d.split("/");o=c[2];p=c[6];var a=[];var s=this.configEditor.getSteps();s.forEach(function(t){if(e.configEditor.getCategoriesForStep(t.getId())[0]===y){a.push(t.getId())}});var r=this.oModel.getData().aConfigDetails[o].configData[1].categories[p];r.isSelected=false;var l=jQuery.extend(true,{},r);if(l.steps){for(var I=0;I<l.steps.length;I++){l.steps[I].id=a[I];var C=e.configEditor.getStep(a[I]);n=C.getRepresentations();if(l.steps[I].representations){for(var u=0;u<l.steps[I].representations.length;u++){l.steps[I].representations[u].id=n[u].getId()}}}}l.id=y;l.name="< "+m+" >";l.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[1].categories.length;this.oModel.getData().aConfigDetails[o].configData[1].categories.push(l);c[6]=f;g=c.join("/");K()}.bind(this));break;case t.configurationObjectTypes.NAVIGATIONTARGET:var b=this.oCoreApi.getText("copyOf")+"  "+s.nodeTitle;var A=this.configEditor.copyNavigationTarget(s.nodeAPFId);c=d.split("/");o=c[2];I=c[6];var x=this.oModel.getData().aConfigDetails[o].configData[2].navTargets[I];x.isSelected=false;var E=jQuery.extend(true,{},x);E.id=A;E.name="< "+b+" >";E.isSelected=true;f=this.oModel.getData().aConfigDetails[o].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[o].configData[2].navTargets.push(E);c[6]=f;g=c.join("/");K();a.oConfigListInstance._setNavigationTargetName({configIndexInTree:o});break;case t.configurationObjectTypes.STEP:var S=this.oCoreApi.getText("copyOf")+"  "+s.nodeTitle;var F=this.configEditor.copyStep(s.nodeAPFId);var O=this.configEditor.getCategoriesForStep(F);var N=this.configEditor.getStep(F);var M=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(S,M).done(function(e){var t;N.setTitleId(e);c=d.split("/");o=c[2];p=c[6];C=c[8];var i=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C];i.isSelected=false;var s=jQuery.extend(true,{},i);n=N.getRepresentations();s.id=F;s.name="< "+S+" >";if(s.representations){for(t=0;t<s.representations.length;t++){s.representations[t].id=n[t].getId()}}f=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps.length;c[8]=f;g=c.join("/");for(var r=0;r<O.length;r++){var l=jQuery.extend(true,{},s);var I={arguments:{configId:a.oConfigListInstance.configId,categoryId:O[r]}};var u=a.oConfigListInstance.getSPathFromURL(I).sPath.split("/");var h=u[6];this.oModel.getData().aConfigDetails[o].configData[1].categories[h].steps.push(l)}this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[f].isSelected=true;K()}.bind(this));break;case t.configurationObjectTypes.REPRESENTATION:c=d.split("/");o=c[2];p=c[6];C=c[8];u=c[10];var w=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].id;var P=this.configEditor.getStep(w);var j=this.configEditor.getCategoriesForStep(w);this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[u].isSelected=false;var R=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[u];var _=jQuery.extend(true,{},R);var B=P.copyRepresentation(_.id);_.id=B;f=this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations.length;c[10]=f;g=c.join("/");for(var V=0;V<j.length;V++){var U=jQuery.extend(true,{},_);var G={arguments:{configId:a.oConfigListInstance.configId,categoryId:j[V],stepId:w}};var k=a.oConfigListInstance.getSPathFromURL(G).sPath.split("/");var H=k[6];var Q=k[8];this.oModel.getData().aConfigDetails[o].configData[1].categories[H].steps[Q].representations.push(U)}this.oModel.getData().aConfigDetails[o].configData[1].categories[p].steps[C].representations[f].isSelected=true;K();break;case t.configurationObjectTypes.CONFIGURATION:var Y=this.oCoreApi.getText("copyOf")+"  "+s.nodeTitle;c=d.split("/");o=c[2];var z=this.oModel.getData().aConfigDetails[o];z.isSelected=false;c[2]=this.oModel.getData().aConfigDetails.length;g=c.join("/");this.configurationHandler.copyConfiguration(s.nodeAPFId,function(t){var i={AnalyticalConfigurationName:Y};var n=e.configurationHandler.setConfiguration(i,t);e.configTitle=Y;e.configurationHandler.loadConfiguration(n,function(t){var i=e.configTitle;var n=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;e.configurationHandler.getTextPool().setTextAsPromise(i,n).done(function(e){t.setApplicationTitle(e)})});a._copyConfiguration(t,g)});break;default:break}function K(){e.oModel.updateBindings();r=e.oTreeInstance.getModel().getContext(g);e.selectedNode=e.oTreeInstance.getItemNodeByContextWithoutExpand(r.sPath);var t=e.oTreeInstance.getAPFTreeNodeContext(e.selectedNode);var n=e.oTreeInstance.getParentNodeContext(t);e.navigateToDifferntView(n,t);e.configEditor.setIsUnsaved();i.resolve()}};var c=function(){var e=(new sap.m.Label).addStyleClass("noConfigSelected");e.setText(a.oConfigListInstance.oCoreApi.getText("noConfigSelected"));e.placeAt(a.oConfigListInstance.byId("idConfigDetailData"));a.oConfigListInstance.toolbarController.disableCopyDeleteButton();a.oConfigListInstance._enableDisableExportAndExecuteButton()};var l;if(!s){r.throwMandatoryPopup(a.oConfigListInstance,{yes:function(){var e=a.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(a.oConfigListInstance.oTreeInstance.getSelectedItem());var t=a.oConfigListInstance.oTreeInstance.getParentNodeContext(e);a.oConfigListInstance.bIsDifferntConfig=a.oConfigListInstance.oTreeInstance.isConfigurationSwitched(a.oConfigListInstance.oPreviousSelectedNode,a.oConfigListInstance.selectedNode);a.oConfigListInstance.configEditor=a.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(t.configId);if(a.oConfigListInstance.bIsSaved===false&&a.oConfigListInstance.configEditor){a.oConfigListInstance.configEditor.setIsUnsaved()}if(a.oConfigListInstance.bIsDifferntConfig===false){var i=typeof a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var n=a.oConfigListInstance._isNewSubView(i.getView().getViewData().oParams);if(!n){f.call(a.oConfigListInstance);a.oConfigListInstance._navHandleExpandDelete.call(a.oConfigListInstance,a.oConfigListInstance.oSelectedNodeDetails,t)}else{a.oConfigListInstance.handleConfirmDeletion()}}else{var o=a.oConfigListInstance._navMandatoryResetState(a.oConfigListInstance);if(!o.isNewView){if(o.bIsSaved===false){l(a.oConfigListInstance)}else{f.call(a.oConfigListInstance)}}}}});d=true}var p;if(n.getView().getViewData().oParams.name==="configuration"){p=true}l=function(e){r.throwLossOfDataPopup(e,{yes:function(e){a.oConfigListInstance._navSaveState(function(){e(function(e){if(a.oConfigListInstance.selectedNode){var t=a.oConfigListInstance.selectedNode._getBindingContext().sPath;var i=t.split("/");var n=i[2]}a.oConfigListInstance.oModel.getData().aConfigDetails[n].AnalyticalConfiguration=a.oConfigListInstance.configId;a.oConfigListInstance.oModel.updateBindings();f.call(a.oConfigListInstance)})})},no:function(){var e={appId:a.oConfigListInstance.appId,configId:a.oConfigListInstance.configId};var i=typeof a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?a.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var n=i.getView().getViewData().oParams.name==="configuration"?true:false;if(a.oConfigListInstance.configId.indexOf(t.configurationObjectTypes.ISNEWCONFIG)===0){a.oConfigListInstance._navHandleExpandDelete.call(a.oConfigListInstance,{},e,n);a.oConfigListInstance.clearTitleAndBreadCrumb();a.oConfigListInstance.byId("idConfigDetailData").removeAllContent();c()}else{a.oConfigListInstance._navConfigResetState(a.oConfigListInstance,function(){f.call(a.oConfigListInstance)})}}})};if(a.oConfigListInstance.bIsSaved===false&&s&&p){l(a.oConfigListInstance);d=true}if(!d){f.call(a.oConfigListInstance)}return i.promise()},_handlePressDeleteButton:function(e){var i;var n=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var o=this.oCoreApi.getText(n.nodeObjectType);e.getSource().$().blur();if(n.nodeObjectType===t.configurationObjectTypes.STEP){i=this.oCoreApi.getText("confirmStepDeletion",[n.nodeTitle])}else{i=this.oCoreApi.getText("confirmDeletion",[o,n.nodeTitle])}this._openDeleteConfirmationDialog(i)},_openDeleteConfirmationDialog:function(e){var t=this;var n=jQuery.extend(t.oConfigListInstance,{closeDialog:t.closeDialog.bind(t)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",n);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText()}var o=new sap.m.Text;o.setText(e);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(o);this.confirmationDialog.addAriaDescribedBy(o);i("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open()},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close()}},_setConfirmationDialogText:function(){sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"))},_handlePressMoveUpButton:function(){this.bIsDown=false;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_moveUpOrDown:function(e,i){var n=e.nodeObjectType;var o=e.nodeAPFId;var a=e.nodeContext;var s=a.split("/")[2];var r,g,d,f,c;var l=false;var p=a.split("/")[a.split("/").length-1];switch(n){case t.configurationObjectTypes.FACETFILTER:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[0].filters;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case t.configurationObjectTypes.CATEGORY:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case t.configurationObjectTypes.NAVIGATIONTARGET:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[2].navTargets;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case t.configurationObjectTypes.STEP:var I=a.split("/")[6];var C=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories[I];r=C.steps;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,o,-1);g=parseInt(p,10)-1;l=true}}break;case t.configurationObjectTypes.REPRESENTATION:var u=this.oConfigListInstance.oTreeInstance.getSelectedItem();var h=u.getParentNode();var T=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(h).nodeAPFId;var v=this.oConfigListInstance.configEditor.getStep(T);I=a.split("/")[6];var D=a.split("/")[8];r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories[I].steps[D].representations;c=r.length;if(i){if(parseInt(p,10)!==c-1){v.moveRepresentationUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){v.moveRepresentationUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;default:break}if(l){d=r[p];f=r[g];r[g]=d;r[p]=f;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved()}},_handleAddExistingStepPress:function(){var e=this;var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var i=this.oConfigListInstance.oTreeInstance.getParentNodeContext(t).categoryId;var n=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(i);var o;var a=[];n.forEach(function(t){var i={};var n=e.oConfigListInstance.configEditor.getStep(t);o=e.oConfigListInstance.oTextPool.get(n.getTitleId()).TextElementDescription;i.id=t;i.name=o;a.push(i)});var s=new sap.ui.model.json.JSONModel({existingStepData:a});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText()}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(s);this.addExistingStepDialog.open()},_handleExistingStepDialogOK:function(e){var i=t.configurationObjectTypes.STEP;var n=e.getParameters("listItem").selectedItems;var o=n.length;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var s=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var r=[];for(var g=0;g<o;g++){var d=e.getParameters("selectedItems").selectedContexts[g].sPath.split("/")[2];var f=e.getSource().getModel().getData().existingStepData[d];var c=this.oConfigListInstance.configEditor.getStep(f.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(s,f.id);var l=c.getRepresentations();var p=l.length;var I=[];for(var C=0;C<p;C++){var u={};u.id=l[C].getId();u.name=l[C].getRepresentationType();u.icon=this._getRepresentationIcon(u.name);I.push(u)}var h={};h.step=f;h.representations=I;h.noOfReps=p;r.push(h)}if(o!==0){var T={noOfSteps:o,aExistingStepsToBeAdded:r};this.oConfigListInstance.oTreeInstance.addNodeInTree(i,T)}},_getRepresentationIcon:function(e){var t;var i=this.oCoreApi.getRepresentationTypes();for(var n=0;n<i.length;n++){if(e===i[n].id){t=i[n].picture;break}}return t},_handleExistingStepDialogSearch:function(e){var t=e.getParameter("value");var i=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,t);var n=e.getSource().getBinding("items");n.filter([i])},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([])}}})},true);
//# sourceMappingURL=toolbar.controller.js.map
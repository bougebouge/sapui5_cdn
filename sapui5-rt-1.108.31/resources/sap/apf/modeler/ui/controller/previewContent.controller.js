/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/utils/utils","sap/apf/ui/utils/constants","sap/apf/ui/utils/wrappedChartWithCornerTexts","sap/ui/thirdparty/jquery"],function(e,t,n,jQuery){"use strict";var r,i,o,a,s,u,p,l;var d=sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;function f(e){var t=e&&a.getTextPool().get(e),n;if(t!==undefined){n=t.TextElementDescription}return n}function c(e){var t=f(i[e]());if(t===undefined){t=f(o[e]())}return t}function g(e,t){return e.sort(function(e,n){var r,i;for(i=0;i<t.length;i++){if(e[t[i].property]<n[t[i].property]){r=-1}else if(e[t[i].property]>n[t[i].property]){r=1}r=r*[1,-1][+!t[i].ascending];if(r!==0){return r}}})}function v(e,t){var n=jQuery.Deferred();p.getEntityTypeMetadataAsPromise().done(function(r){var i,o,u=[];t.forEach(function(t){if(t.sProperty!==s("none")&&t.sProperty!==""){o=e(t.sProperty);if(o!==undefined){i=a.getTextPool().get(o).TextElementDescription}else{i=p.getDefaultLabel(r,t.sProperty)}u.push({fieldName:t.sProperty,fieldDesc:i,kind:t.sContext})}});n.resolve(u)});return n.promise()}function y(e){var t=jQuery.Deferred();var n=[];if(e==="properties"&&i.getRepresentationType()===d){v(i.getPropertyTextLabelKey,u.getActualProperties()).done(function(e){n=e})}else if(e==="dimensions"&&i.getRepresentationType()!==d){p.getEntityTypeMetadataAsPromise().done(function(e){v(i.getDimensionTextLabelKey,u.getActualDimensions().concat(u.getActualLegends())).done(function(e){n=e})})}else if(e==="measures"&&i.getRepresentationType()!==d){p.getEntityTypeMetadataAsPromise().done(function(e){v(i.getMeasureTextLabelKey,u.getActualMeasures()).done(function(e){n=e;n.forEach(function(e){var t=i.getMeasureDisplayOption(e.fieldName);if(t){e.measureDisplayOption=t}})})})}t.resolve(n);return t.promise()}function T(){var e=jQuery.Deferred();var t=[],n=[],r=0,o=3;var a=p.getProperties();p.getEntityTypeMetadataAsPromise().done(function(s){var u=p.getDimensionsProperties(s);var l=p.getMeasures(s);var f=i.getRepresentationType();var c=f!==d?Math.pow(o,u.length):7;for(r=0;r<c;r++){var v={};if(f===d){a.forEach(function(e){var t=e+" - "+sap.apf.utils.createRandomNumberString(4);v[e]=t})}else{u.forEach(function(e,t){var n=e+" - "+(Math.floor(r/Math.pow(o,t))%o+1);v[e]=n});l.forEach(function(e){var t=sap.apf.utils.createRandomNumberString(4);v[e]=t})}t.push(v)}n=i.getOrderbySpecifications();if(n&&n.length){t=g(t,n)}e.resolve(t)});return e.promise()}function h(){var e=l.getConstructorOfRepresentationType(i.getRepresentationType());var t=e.replaceAll(".","/");sap.ui.require([t],function(e){return e});var n=sap.apf.utils.extractFunctionFromModulePathString(e);var o={};o.requiredFilters=[];function a(e){return e}function s(){}var u={getTextNotHtmlEncoded:a,getTextHtmlEncoded:a,getEventCallback:s,getExits:function(){var e={};return e},getUiApi:function(){var e={};e.getStepContainer=function(){return undefined};return e},createFilter:function(){return{getOperators:function(){return{EQ:true}},getTopAnd:function(){return{addOr:s}},getInternalFilter:function(){return{getProperties:function(){return[]}}}}},createMessageObject:s,putMessage:s,updatePath:s,selectionChanged:s,getActiveStep:function(){return{getSelectedRepresentation:function(){return{bIsAlternateView:true}}}}};y("dimensions").done(function(e){o.dimensions=e});y("measures").done(function(e){o.measures=e});y("properties").done(function(e){o.properties=e});r=new n(u,o);if(r.chartType===d){r.oTableRepresentation.removeEventDelegate();r.oTableRepresentation.onAfterRendering(function(){return})}var p={getPropertyMetadata:function(e){return{label:e}}};T().done(function(e){r.setData(e,p)})}function w(e){var t=e.byId("idPreviewContentDialog");t.setTitle(s("preview"));t.getEndButton().setText(s("close"))}var C=sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.previewContent",{onInit:function(){var e=this;var t=e.byId("idPreviewContentDialog");i=e.getView().getViewData().oRepresentation;o=e.getView().getViewData().oParentStep;a=e.getView().getViewData().oConfigurationHandler;s=e.getView().getViewData().oCoreApi.getText;u=e.getView().getViewData().oRepresentationHandler;p=e.getView().getViewData().oStepPropertyMetadataHandler;l=e.getView().getViewData().oRepresentationTypeHandler;w(e);h();e._drawContent();t.open()},_drawContent:function(){this._drawMainChart();this._drawLikeStepInCarousel()},_drawLikeStepInCarousel:function(){var e=o.getTitleId();var t=f(e);var i={getSelectedRepresentation:function(){return r}};var a=n.getClonedChart(i);var s={rightLower:c("getRightLowerCornerTextKey"),rightUpper:c("getRightUpperCornerTextKey"),leftLower:c("getLeftLowerCornerTextKey"),leftUpper:c("getLeftUpperCornerTextKey")};var u={mode:"preview",titleText:t,oCornerTexts:s};var p=new n.constructor(null,o,a,u);this._addChart(p.getContent())},_drawMainChart:function(){var e=o.getLongTitleId();var t=a.getTextPool().isInitialTextKey(e);var n=e&&!t?e:o.getTitleId();var i=r.getMainContent(f(n),480,330);var s={interaction:{selectability:{axisLabelSelection:true,legendSelection:true,plotLassoSelection:true,plotStdSelection:true}}};if(i.setVizProperties!==undefined)i.setVizProperties(s);this.byId("idMainChart").addItem(i)},handleCloseButtonOfDialog:function(){var e=this;e.byId("idPreviewContentDialog").close()},handleClose:function(){var e=this;e.byId("idPreviewContentDialog").destroy();e.getView().destroy()},_addChart:function(e){this.byId("idThumbnail").addItem(e)}});return C},true);
//# sourceMappingURL=previewContent.controller.js.map
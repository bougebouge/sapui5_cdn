/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/core/configurationEditor","sap/apf/utils/hashtable","sap/apf/utils/utils","sap/apf/modeler/core/configurationObjects"],function(t,e,n,i){"use strict";sap.apf.modeler.core.ConfigurationHandler=function(t){var e=this;var n=t.instances.messageHandler;var i=t.instances.persistenceProxy;var a=t.constructors.ConfigurationEditor;var o=t.constructors.Hashtable;var r=t.constructors.LazyLoader;var s=new o(n);var c=new o(n);var u=new o(n);var f=new o(n);var l,g;var m={constructors:{Hashtable:o},instances:{messageHandler:n}};this.exportTexts=function(t){var e=this.getConfiguration(t).AnalyticalConfigurationName;return g.exportTexts(e)};this.getTextPool=function(){return g};this.setApplicationIdAndContext=function(t,e,i){g=i||g;s=new o(n);var a,r=e.length;for(a=0;a<r;a++){s.setItem(e[a].AnalyticalConfiguration,e[a]);c.setItem(e[a].AnalyticalConfiguration,e[a].AnalyticalConfigurationName)}l=t};this.getApplicationId=function(){return l};this.setConfiguration=function(t,e){t.AnalyticalConfiguration=e||p();t.Application=l;s.setItem(t.AnalyticalConfiguration,t);return t.AnalyticalConfiguration};this.getList=function(){var t=[];var e=function(e,n){t.push(n)};s.each(e);return t};this.getConfiguration=function(t){return s.getItem(t)};this.loadConfiguration=function(s,c){var f,l=s.id||s;if(!s.updateExisting){f=u.getItem(l)}if(!f){f=new r(m,C);u.setItem(l,f)}f.asyncGetInstance(l,p);function p(t,e,n){c(t,e)}function C(r,c,u){var f={instances:{coreApi:t.instances.coreApi,messageHandler:n,configurationHandler:e,persistenceProxy:i,textPool:g,metadataFactory:t.instances.metadataFactory},constructors:{Hashtable:o,Step:t.constructors.Step,HierarchicalStep:t.constructors.HierarchicalStep,SmartFilterBar:t.constructors.SmartFilterBar,FacetFilter:t.constructors.FacetFilter,NavigationTarget:t.constructors.NavigationTarget,Representation:t.constructors.Representation,ConfigurationObjects:t.constructors.ConfigurationObjects,ElementContainer:t.constructors.ElementContainer,ConfigurationFactory:t.constructors.ConfigurationFactory,RegistryProbe:t.constructors.RegistryProbe}};new a(s,f,function(t,e){c(r,t,e)})}};this.resetConfiguration=function(t){var e;if(u.hasItem(t)){e=s.getItem(t);e.AnalyticalConfigurationName=c.getItem(t);u.removeItem(t);return t}};this.updateConfigurationName=function(t,e){c.setItem(t,e)};this.copyConfiguration=function(t,n){var i=this.getConfiguration(t);if(!i){n(null);return}e.loadConfiguration(t,a);function a(t){var a,o,s,c;c=sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(i);a=p();c.AnalyticalConfiguration=a;e.setConfiguration(c,a);o=t.copy(a);s=new r(m,undefined,{id:a,instance:o});u.setItem(a,s);n(a)}};this.replaceConfigurationId=function(t,e){if(t.indexOf("apf1972-")===0){var n=s.getItem(t);var i=u.getItem(t).getInstance();var a=new r(m,undefined,{id:e,instance:i});n.AnalyticalConfiguration=e;s.setItem(e,n);c.setItem(e,n.AnalyticalConfigurationName);s.removeItem(t);u.setItem(e,a);u.removeItem(t)}};this.exportConfiguration=function(a,o){var r;this.loadConfiguration(a,s);function s(s){if(!s.isSaved()){n.putMessage(n.createMessageObject({code:"11007",aParameters:[a]}));o(null)}else{var c=t.functions.getApplication(l);var u=e.getConfiguration(a).AnalyticalConfigurationName;r=s.serialize();r.configHeader={Application:l,ApplicationName:c.ApplicationName,SemanticObject:c.SemanticObject,AnalyticalConfiguration:a,AnalyticalConfigurationName:u,UI5Version:sap.ui.version};i.readEntity("configuration",function(t,e,i){if(i){n.putMessage(n.createMessageObject({code:"5022",aParameters:[a]}));o(null)}else{r.configHeader.CreationUTCDateTime=t.CreationUTCDateTime;r.configHeader.LastChangeUTCDateTime=t.LastChangeUTCDateTime;r=JSON.stringify(r,null,"\t");o(r,u)}},[{name:"AnalyticalConfiguration",value:a}],["CreationUTCDateTime","LastChangeUTCDateTime"],l)}}};this.memorizeConfiguration=function(t){var e,n;n=u.getItem(t);if(!n){return null}e=n.getInstance();if(e){f.setItem(t,e.copy(t));return t}return null};this.restoreMemorizedConfiguration=function(t){var e,n;n=f.removeItem(t);if(n){e=new r(m,undefined,{id:t,instance:n});u.setItem(t,e);return n}return null};this.removeConfiguration=function(t,e){function n(n,i){if(!i){s.removeItem(t);u.removeItem(t)}e(t,n,i)}if(t.indexOf("apf1972-")!==0){i.remove("configuration",[{name:"AnalyticalConfiguration",value:t}],n,undefined,l)}else{s.removeItem(t);u.removeItem(t);e(t,undefined,undefined)}};this.removeAllConfigurations=function(){s=new o(n)};function p(){return"apf1972-"+sap.apf.utils.createPseudoGuid(32)}}});
//# sourceMappingURL=configurationHandler.js.map
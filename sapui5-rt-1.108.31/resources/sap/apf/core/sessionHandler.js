/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/ajax","sap/apf/utils/filter","sap/apf/core/constants","sap/ui/model/odata/ODataUtils","sap/ui/thirdparty/jquery"],function(e,t,s,a,jQuery){"use strict";sap.apf.core.SessionHandler=function(e){var t=null;var s=false;var a=false;var n=false;var i="";var r="";var f=new sap.apf.utils.Hashtable(e.instances.messageHandler);var o=e.instances.coreApi;var u=e.instances.messageHandler;if(e&&e.functions&&e.functions.serializeApfState&&typeof e.functions.serializeApfState=="function"){s=e.functions.serializeApfState}if(e&&e.functions&&e.functions.deserializeApfState&&typeof e.functions.deserializeApfState=="function"){a=e.functions.deserializeApfState}this.type="sessionHandler";this.ajax=function(e){sap.apf.core.ajax(e)};this.getXsrfToken=function(e){var t=jQuery.Deferred();e=c(e);var s=f.getItem(e);if(s!==undefined&&s!==false){return t.resolve(s)}this.fetchXcsrfToken(e).done(function(s){f.setItem(e,s);t.resolve(s)});return t.promise()};function c(e){var t=o.getStartParameterFacade().getSapSystem();if(t){return sap.ui.model.odata.ODataUtils.setOrigin(e,{force:true,alias:t})}return e}this.fetchXcsrfToken=function(e){var t=jQuery.Deferred();var s="HEAD";if(f.getItem(e)===false){s="GET"}this.ajax({url:o.getUriGenerator().getAbsolutePath(e),type:s,beforeSend:function(e){e.setRequestHeader("x-csrf-token","Fetch")},success:a.bind(this),error:n.bind(this),async:true});function a(e,s,a){r=a.getResponseHeader("x-csrf-token");if(r!==undefined&&r!==null){t.resolve(r)}if(r===null){r="";t.resolve(r)}}function n(s,a,n){if(s.status===405&&f.getItem(e)!==false){f.setItem(e,false);this.fetchXcsrfToken(e).done(function(e){t.resolve(e)})}else{r="";var i=u.createMessageObject({code:5101,aParameters:[]});u.putMessage(i);t.resolve(r)}}return t.promise()};this.setDirtyState=function(e){n=e};this.isDirty=function(){return n};this.setPathName=function(e){if(typeof e!="string"){i="";return}i=e};this.getPathName=function(){return i};this.isApfStateAvailable=function(){if(t===null){return false}return true};this.storeApfState=function(){var e=true;if(s){s(undefined,e).done(function(e){t=e})}};this.restoreApfState=function(){if(this.isApfStateAvailable()&&a){o.resetPath();return a(t)}}}});
//# sourceMappingURL=sessionHandler.js.map
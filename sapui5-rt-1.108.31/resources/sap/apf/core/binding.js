/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/core/utils/filter","sap/apf/core/utils/filterTerm","sap/ui/thirdparty/jquery"],function(e,t,n,jQuery){"use strict";sap.apf.core.Binding=function(e,t,n,r){var i=this;this.type="binding";var a=0;var s=[];var o=[];var d=[];var c;this.oTitle=t.oTitle;this.oLongTitle=t.oLongTitle;var l=t.requiredFilters;var p=t.requiredFilterOptions;this.destroy=function(){s.forEach(function(e){if(e&&e.destroy){e.destroy()}});s=[];o=[];d=[];c=undefined};function u(n,r){if(e.exits&&e.exits.binding&&e.exits.binding.afterGetFilter){return e.exits.binding.afterGetFilter(n,i.getSelectedRepresentation(),e.instances.coreApi,t,r)}return n}this.getFilter=function(t){var n=this.getSelectedRepresentation();var r=sap.apf.core.constants.filterMethodTypes;var i=[];var a;if(n.getFilterMethodType()===r.filter){var s=n.getFilter().getInternalFilter();return u(s,t)}if(n.getSelectionAsArray){i=n.getSelectionAsArray()}else{return u(new sap.apf.core.utils.Filter(e.instances.messageHandler),t)}if(i===undefined){a=sap.apf.core.utils.Filter.createEmptyFilter(e.instances.messageHandler,l);return u(a,t)}if(i.length===d.length||i.length===0){return u(new sap.apf.core.utils.Filter(e.instances.messageHandler),t)}a=sap.apf.core.utils.Filter.createFromArray(e.instances.messageHandler,l,d,i);return u(a,t)};this.getRequiredFilters=function(){return l};this.getRequiredFilterOptions=function(){return p};this.getRequestOptions=function(e){if(jQuery.isFunction(this.getSelectedRepresentation().getRequestOptions)){return this.getSelectedRepresentation().getRequestOptions(e)}return{}};this.setFilterValues=function(e){var t=this.getSelectedRepresentation();t.setFilterValues(e)};this.setData=function(t){e.instances.messageHandler.check(t!==undefined,"aDataResponse is undefined (binding function setData)");d=t.data;c=t.metadata;this.getSelectedRepresentation().setData(t.data,t.metadata,t.count,t.selectionValidation)};this.updateTreetable=function(e,t,n,r){this.getSelectedRepresentation().updateTreetable(e,t,n,r)};this.getSortedSelections=function(){return this.getSelectedRepresentation().getSortedSelections()};this.getRepresentationInfo=function(){var e=jQuery.extend(true,[],o);for(var t=0;t<e.length;t++){delete e[t].id;delete e[t].type;delete e[t].constructor}return e};this.getSelectedRepresentationInfo=function(){e.instances.messageHandler.check(a>=0&&a<o.length,"index in array boundaries");var t=jQuery.extend(true,{},o[a]);delete t.id;delete t.type;delete t.constructor;return t};this.getSelectedRepresentation=function(){e.instances.messageHandler.check(a>=0&&a<s.length,"selectedRepresentation in array boundaries");return s[a]};this.setSelectedRepresentation=function(r){e.instances.messageHandler.check(typeof r==="string","setSelectedRepresentation() - sRepresentationId missing");var i=this;var o=this.getSelectedRepresentation();var l=u(r,t.representations);var p=f(l);a=l.index;if(d!==undefined&&c!==undefined){p.setData(d,c)}if(p.adoptSelection){p.adoptSelection(o)}if(o&&o.onChartSwitch){o.onChartSwitch()}function u(t,r){for(var i=0;i<r.length;i++){if(t===r[i].id){return{config:r[i],constructor:n.getConfigurationById(r[i].representationTypeId).constructor,index:i}}}e.instances.messageHandler.check(false,"Representation config not found")}function f(r){var a;if(s[r.index]===undefined){if(r.config.parameter&&r.config.parameter.alternateRepresentationTypeId){r.config.parameter.alternateRepresentationType=n.getConfigurationById(r.config.parameter.alternateRepresentationTypeId)}r.config.parameter.requiredFilters=t.requiredFilters;r.config.parameter.requiredFilterOptions=t.requiredFilterOptions;a=i.convertSortToOrderBy(r.config.parameter);s[r.index]=e.instances.coreApi.createRepresentation(r.constructor,a);return s[r.index]}return s[r.index]}};this.serialize=function(){return{selectedRepresentation:i.getSelectedRepresentation().serialize(),selectedRepresentationId:i.getSelectedRepresentationInfo().representationId}};this.deserialize=function(e){i.setSelectedRepresentation(e.selectedRepresentationId);i.getSelectedRepresentation().deserialize(e.selectedRepresentation);return i};this.convertSortToOrderBy=function(e){var t;if(e.sort&&!e.orderby){t=jQuery.extend(true,{},e);if(e.alternateRepresentationType){t.alternateRepresentationType=e.alternateRepresentationType}t.orderby=[{property:e.sort.sortField,ascending:!e.sort.descending}];delete t.sort;return t}t=e;return t};s[0]=undefined;var f=false;t.representations.forEach(function(e,t){var i=e.representationTypeId;o[t]=jQuery.extend(true,{},n.getConfigurationById(i));o[t].representationId=e.id;if(r===o[t].representationId){f=true}o[t].representationLabel=e.label;o[t].thumbnail=e.thumbnail;o[t].parameter=jQuery.extend(true,{},e.parameter)});if(f){this.setSelectedRepresentation(r)}else if(o.length>0){this.setSelectedRepresentation(o[0].representationId)}if(!f&&r){e.instances.messageHandler.putMessage(e.instances.messageHandler.createMessageObject({code:"5037",aParameters:[r]}))}}});
//# sourceMappingURL=binding.js.map
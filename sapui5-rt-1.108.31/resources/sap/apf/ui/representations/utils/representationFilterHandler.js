/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/representations/utils/displayOptionHandler","sap/apf/utils/utils","sap/apf/core/metadataProperty","sap/ui/thirdparty/jquery"],function(e,t,r,jQuery){"use strict";function a(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})}function i(e,t,r){var a,i;var s=e.oParameter.requiredFilters[0];if(s){var n=e.oParameter.requiredFilterOptions?e.oParameter.requiredFilterOptions.labelDisplayOption:undefined;var o=e.oDisplayOptionHandler.getColumnNameBasedOnDisplayOption(s,n,t);var l=new sap.apf.core.MetadataProperty(t.getPropertyMetadata(o));e.aFilterValues.forEach(function(t){for(a=0;a<r.length;a++){if(r[a][s]===t){if(r[a]["formatted_"+o]){i=r[a]["formatted_"+o]}else{i=sap.apf.utils.convertToExternalFormat(r[a][o],l)}break}}e.filterValueLookup[t]=i})}}sap.apf.ui.representations.utils.RepresentationFilterHandler=function(e,t,r){this.oApi=e;this.aFilterValues=[];this.oParameter=t;this.sRequiredFilter=this.oParameter.requiredFilters[0];this.oDisplayOptionHandler=new sap.apf.ui.representations.utils.DisplayOptionHandler;this.filterValueLookup={};this.oTimeAxisDateConverter=r};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.constructor=sap.apf.ui.representations.utils.RepresentationFilterHandler;sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.setMetadataAndDataResponse=function(e,t){this.oMetadata=e;this.aDataResponse=t};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.validateFiltersWithDataset=function(){var e=[];var t=this.aDataResponse.map(function(e){return e[this.sRequiredFilter]}.bind(this));e=this.aFilterValues.filter(function(e){return t.indexOf(e)!==-1});this.aFilterValues=e};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.createFilterFromSelectedValues=function(e){var t=this,r=false,i;var s=this.oApi.createFilter();if(e&&e.length>0){this.aFilterValues=a(e.concat(this.aFilterValues))}var n=s.getTopAnd().addOr("exprssionOr");var o=s.getOperators().EQ;r=t.oTimeAxisDateConverter.bIsConversionToDateRequired(this.oParameter.requiredFilters[0],this.oMetadata);this.aFilterValues.forEach(function(e){if(r){i=t.oTimeAxisDateConverter.getConvertedDateLookUp()[e]||e}else{i=e}var a={id:e,name:t.sRequiredFilter,operator:o,value:i};n.addExpression(a)});return s};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.updateFilterFromSelection=function(e){var t=a(e);this.aFilterValues=t.slice(0)};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.clearFilters=function(){this.aFilterValues=[]};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getDisplayInfoForFilters=function(e,t){var r=[],a=this;i(a,e,t);a.aFilterValues.forEach(function(e){var t={id:e,text:a.filterValueLookup[e]};r.push(t)});return r};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getFilterValues=function(){return this.aFilterValues};sap.apf.ui.representations.utils.RepresentationFilterHandler.prototype.getIfSelectedFilterChanged=function(e){var t=jQuery(this.aFilterValues).not(e).length===0&&jQuery(e).not(this.aFilterValues).length===0;return!t}});
//# sourceMappingURL=representationFilterHandler.js.map
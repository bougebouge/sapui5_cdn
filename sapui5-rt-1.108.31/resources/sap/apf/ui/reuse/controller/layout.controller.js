/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
(function(){"use strict";sap.ui.controller("sap.apf.ui.reuse.controller.layout",{onInit:function(){this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;this.oNavigationHandler=this.getView().getViewData().oNavigationHandler;var t;this.oCoreApi.getApplicationConfigProperties().done(function(e){if(e){t=e.appName}this.applicationTitle=this.oCoreApi.getTextNotHtmlEncoded(t);this.getView().byId("applicationPage").setTitle(this.applicationTitle);this.loadLayout()}.bind(this));var e=this;this.oActionListPopover=new sap.m.Popover({id:this.createId("idAnalysisPathMenuPopOver"),showHeader:false,placement:sap.m.PlacementType.Bottom,contentWidth:"165px"});this.oActionListItem=e.oUiApi.getToolbar().addStyleClass("toolbarView");this.oActionListPopover.addContent(this.oActionListItem);this.oSavedPathName=this.getView().byId("analysisPathTitle");if(this.byId("analysisPath")){this.setPathTitle()}},showMenu:function(t){this.oActionListPopover.openBy(t.getSource())},getAnalysisPathTitleText:function(){this.getView.byId("analysisPathTitle")},setPathTitle:function(){var t=this.oCoreApi.getPathName();if(t.length==0){t=this.oCoreApi.getTextNotHtmlEncoded("unsaved")}if(this.oCoreApi.isDirty()){t="*"+t}this.getView().byId("analysisPathTitle").setText(t);this.getView().byId("analysisPathTitle").setTooltip(t)},loadLayout:function(){this.oCoreApi.getSmartFilterBarConfigurationAsPromise().done(function(t){if(sap.ui.Device.system.desktop){this.getView().addStyleClass("sapUiSizeCompact");this.getView().byId("deviceFooter").destroy()}if(t===undefined){this.getView().byId("idSplitterLayoutData").setSize("0px")}var e=this.oUiApi.getStepContainer();var i=this.oUiApi.getAnalysisPath();this.getView().byId("applicationPage").setTitle(this.applicationTitle);this.getView().byId("stepContainer").addContent(e);this.getView().byId("analysisDynamicPage").setContent(i);if(this.getView().byId("menuButton")){this.getView().byId("menuButton").setTooltip(this.oCoreApi.getTextNotHtmlEncoded("options"))}this.addOpenInButton()}.bind(this))},onAfterRendering:function(){var t=this;if(!sap.ui.Device.system.desktop){var e=new sap.m.Button({text:this.oCoreApi.getTextNotHtmlEncoded("showAnalyticalPath"),press:function(){t.getView().byId("applicationView").showMaster()},type:"Transparent"});this.getView().byId("applicationView").attachAfterMasterClose(function(){if(t.getView().byId("masterFooter")&&t.getView().byId("masterFooter").getContentLeft().length===0){t.getView().byId("masterFooter").addContentLeft(e)}});this.getView().byId("applicationView").attachAfterMasterOpen(function(){if(t.getView().byId("masterFooter")){t.getView().byId("masterFooter").removeContentLeft(e)}});if(this.getView().byId("applicationView").isMasterShown()===false&&this.getView().byId("masterFooter").getContentLeft().length===0){this.addMasterFooterContentLeft(e)}}},hideMaster:function(){if(sap.ui.Device.system.phone||sap.ui.Device.system.tablet){this.getView().byId("applicationView").hideMaster();if(sap.ui.Device.system.phone){this.getView().byId("applicationView").toDetail(this.getView().byId("stepContainer").getId())}}},showMasterFooter:function(t,e,i){if(!sap.ui.Device.system.desktop){var o=this;o.getView().byId("analysisPath").showFooter=true;o.getView().byId("analysisPath").enableScrolling=true;o.getView().byId("deviceFooter").addContentLeft(t);o.getView().byId("deviceFooter").addContentLeft(e);o.getView().byId("deviceFooter").addContentLeft(i)}},showMaster:function(){this.getView().byId("applicationView").showMaster()},addMasterFooterContentLeft:function(t){this.getView().byId("masterFooter").addContentLeft(t)},addMasterFooterContentRight:function(t){if(this.getView().byId("masterFooter").getContentRight().length===0){this.getView().byId("masterFooter").insertContentRight(t)}else{this.addMasterFooterContent(t)}},addMasterFooterContent:function(t){var e=this;if(this.oActionListPopover===undefined){this.oActionListPopover=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.Top})}if(typeof t.getWidth==="function"){t.setWidth("100%")}if(this.footerContentButton===undefined){this.getView().byId("masterFooter").getContentRight()[0].setWidth("71%");this.footerContentButton=new sap.m.Button({icon:"sap-icon://overflow",press:function(t){e.oActionListPopover.openBy(t.getSource())},type:"Transparent",tooltip:this.oCoreApi.getTextNotHtmlEncoded("moreIcon")})}this.oActionListPopover.addContent(t);this.getView().byId("masterFooter").insertContentRight(this.footerContentButton,1)},addDetailFooterContentLeft:function(t){this.getView().byId("masterFooter").addContentLeft(t)},addFacetFilter:function(t){this.getView().byId("subHeader").addContent(t)},enableDisableOpenIn:function(){var t=this;if(!t.openInBtn){return}var e=false;var i=this.oNavigationHandler.getNavigationTargets();i.then(function(i){if(i.global.length===0&&i.stepSpecific.length===0){if(t.openInBtn.getEnabled()){e=true;t.openInBtn.setEnabled(false)}}else{if(!t.openInBtn.getEnabled()){e=true;t.openInBtn.setEnabled(true)}}if(e){t.openInBtn.rerender()}})},addOpenInButton:function(){var t=this;if(this.oNavListPopover===undefined){this.oNavListPopover=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.Top})}this.openInBtn=new sap.m.Button({id:this.createId("idOpenInButton"),text:this.oCoreApi.getTextNotHtmlEncoded("openIn"),tooltip:this.oCoreApi.getTextNotHtmlEncoded("openIn"),type:"Transparent",enabled:false,press:function(e){t.oNavTargetsView=sap.ui.view({viewName:"sap.apf.ui.reuse.view.navigationTarget",type:sap.ui.core.mvc.ViewType.JS,viewData:{oNavigationHandler:t.oNavigationHandler,oNavListPopover:t.oNavListPopover,oOpenInButtonEventSource:e.getSource(),oUiApi:t.oUiApi,oCoreApi:t.oCoreApi}})}});this.getView().byId("masterFooter").insertContentRight(this.openInBtn,1);this.enableDisableOpenIn()},doOkOnNavAnalysisPath:function(){var t=this;var e=this.oUiApi.getAnalysisPath().getToolbar();this.oCoreApi.readPaths(function(i,o,n){var a=true;var s=i.paths;if(o!==undefined){e.maxNumberOfSteps=o.getEntityTypeMetadata().maximumNumberOfSteps;e.maxNumberOfPaths=o.getEntityTypeMetadata().maxOccurs}if(n===undefined&&typeof i==="object"){e.getController().getSaveDialog(a,function(){window.history.go(-1)},s)}else{var r=t.oCoreApi.createMessageObject({code:"6005",aParameters:[]});r.setPrevious(n);t.oCoreApi.putMessage(r)}})},handleNavBack:function(){var t=this;if(t.oUiApi.getLayoutView().getController().oSavedPathName.getText().slice(0,1)==="*"&&t.oCoreApi.getSteps().length!==0){var e=new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.newMessageDialog",this);t.getView().byId("idYesButton").attachPress(function(){e.close();t.doOkOnNavAnalysisPath()});t.getView().byId("idNoButton").attachPress(function(){e.close();window.history.go(-1)});var i=new sap.m.Button(t.createId("idCancelButton"),{text:t.oCoreApi.getTextNotHtmlEncoded("cancel"),press:function(){e.close()}});e.addButton(i);if(sap.ui.Device.system.desktop){e.addStyleClass("sapUiSizeCompact")}e.setInitialFocus(e);e.open()}else{window.history.go(-1)}}})})();
//# sourceMappingURL=layout.controller.js.map
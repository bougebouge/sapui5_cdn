sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/library","sap/m/MessageBox","sap/apf/cloudFoundry/ui/utils/LaunchPageUtils","sap/ui/core/Fragment","sap/ui/core/IconPool","sap/ui/core/ValueState"],function(e,t,i,o,r,a,n,s){"use strict";var l="sap.apf.cloudFoundry.ui.sharedialog";return e.extend(l+".controller.ShareDialog",{onInit:function(){var e=this.getOwnerComponent();this.oCoreApi=e.oCoreApi;var t=this.getView();var i=t.getViewData();if(i.oController.configEditor.isSaved()){this.initializeDialog()}else{o.warning(this.translate("unsavedStateWarning"),{onClose:function(){t.destroy();this.destroy()}.bind(this)})}},initializeDialog:function(){var e=this.getDialog();var i=this.getView();var o=i.getViewData();this.config=o.oController._getNodeData({},"configuration").data;this.runtimeLink=r.generateRuntimeLink(this.config.AnalyticalConfiguration);this.ui=new t({TileHeader:this.config.name,TileHeaderDefault:this.config.name,TileSubheader:this.translate("bookmarkSubheaderDefault"),TileIcon:"",TileIconValueState:s.None,TileGroup:""});i.setModel(this.ui,"ui");this.updateTileTooltip();var a=i.byId("tilePreview");a.addDelegate({onAfterRendering:function(){var e=a.getDomRef().id;jQuery("#"+e).attr("tabindex",-1)}});e.open()},updateTileTooltip:function(){var e="";e+=this.translate("bookmarkTooltipHeader",this.ui.getProperty("/TileHeader"));e+="\n"+this.translate("bookmarkTooltipSubheader",this.ui.getProperty("/TileSubheader"));var t=this.ui.getProperty("/TileIcon");if(t!==""){e+="\n"+this.translate("bookmarkTooltipIcon",t)}var i=this.ui.getProperty("/TileGroup");if(i!==""){e+="\n"+this.translate("bookmarkTooltipGroup",i)}this.ui.setProperty("/TileTooltip",e)},selectText:function(e,t,i){var o=document.getElementById(e.getIdForLabel());o.select();o.setSelectionRange(t,i)},showLinkDialog:function(e){var t=this;var i=this.getView();a.load({id:i.getId(),name:l+".fragment.ShowLinkDialog",controller:{getView:function(){return i.byId("showLinkDialog")},translate:t.translate.bind(t),onBeforeOpen:function(){var t=i.byId("textAreaLink");t.setValue(e)},onAfterOpen:function(){var o=i.byId("textAreaLink");if(e!==undefined){t.selectText(o,0,e.length)}},onAfterClose:function(){this.getView().destroy();i.removeDependent(this.getView())},onButtonClosePress:function(){this.getView().close()}}}).then(function(e){i.addDependent(e);e.open()})},getBookmarkLink:function(){var e=this.getView();var t=e.byId("inputHeader").getValue();var i=e.byId("inputSubheader").getValue();var o=e.byId("inputIcon").getValue();var a=e.byId("inputGroup").getValue();var s=n.getIconInfo(o);if(s){o=s.uri}else{o=""}var l=this.runtimeLink;return new Promise(function(e){setTimeout(function(){e()},2e3)}).then(function(){return r.buildBookmarkLink(l,t,i,o,a)})},onShowLink:function(){var e=this.getBookmarkLink();this.showLinkDialog(e)},onSendEmail:function(){var e=this.ui.getProperty("/TileHeader");var t=this.getBookmarkLink();var o=this.translate("helpLink");var r=this.translate("emailTemplateSubject",e);var a=this.translate("emailTemplateText",e,t,o);i.URLHelper.triggerEmail("",r,a)},onMarkFavorite:function(){var e=this.ui.getProperty("/TileHeader");var t=this.ui.getProperty("/TileSubheader");var i=this.ui.getProperty("/TileIcon");var o=this.ui.getProperty("/TileGroup");r.setBookmarkTile(this.runtimeLink,e,t,i,o)},onHeaderChange:function(e){var t=e.getParameters().value;if(t==""){t=this.config.name}this.ui.setProperty("/TileHeader",t);this.updateTileTooltip()},onSubheaderChange:function(e){var t=e.getParameters().value;if(t==""){t=this.translate("bookmarkSubheaderDefault")}this.ui.setProperty("/TileSubheader",t);this.updateTileTooltip()},onIconChange:function(e){var t=e.getParameters().value;var i=n.getIconInfo(t);if(t===""){this.ui.setProperty("/TileIcon","");this.ui.setProperty("/TileIconValueState",s.None)}else if(i){this.ui.setProperty("/TileIcon",i.uri);this.ui.setProperty("/TileIconValueState",s.None)}else{this.ui.setProperty("/TileIcon","");this.ui.setProperty("/TileIconValueState",s.Error)}this.updateTileTooltip()},onGroupChange:function(e){var t=e.getParameters().value;this.ui.setProperty("/TileGroup",t);this.updateTileTooltip()},onClose:function(){this.getDialog().close();this.getDialog().destroy();this.getView().destroy();this.destroy()},getDialog:function(){var e=this.getView();var t=e.byId("shareDialog");if(!t){t=sap.ui.xmlfragment(e.getId(),l+".fragment.ShareDialog",this);e.addDependent(t)}return t},translate:function(e){return this.oCoreApi.getText(e,Array.prototype.slice.call(arguments,1))}})});
//# sourceMappingURL=ShareDialog.controller.js.map